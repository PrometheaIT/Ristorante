import{a as Ae}from"./chunk-WEMV7O4K.js";import{a as Be}from"./chunk-H4AHDI7D.js";import{a as ze,b as oe}from"./chunk-G5SBDMQ5.js";import{a as We}from"./chunk-RDK7LK33.js";import{a as re,b as ae}from"./chunk-3IJ3GTW7.js";import{a as Fe}from"./chunk-6YDTSELL.js";import{a as Ve}from"./chunk-SKQHRKMJ.js";import{a as De}from"./chunk-JIAO5VPU.js";import{a as Re}from"./chunk-653OREL2.js";import{a as He}from"./chunk-2SB6D73G.js";import{a as Pe}from"./chunk-OILXJW2J.js";import{a as ne}from"./chunk-GO2X6ET2.js";import{b as Ee}from"./chunk-MTC3TSRZ.js";import{b as J,d as Y,e as Oe,g as Me,h as K,i as Ie,q as X,r as ee,s as te,v as ke,x as ie}from"./chunk-XWCDBJ2K.js";import"./chunk-PMU7JIES.js";import{c as U,d as Z,e as we,h as Se,i as ye,k as Te,l as G}from"./chunk-COP7W333.js";import{Db as z,Eb as W,Fa as be,Fb as R,Hb as Q,I as he,Ib as o,Ja as l,Jb as y,Kb as v,Lb as P,Mb as q,Oa as me,Ob as b,Pb as C,Qb as w,Tb as A,Wb as T,Yb as M,Za as j,Zb as $,_b as pe,a as F,b as N,ba as fe,cb as g,ga as S,gc as Ce,h,i as ge,kb as m,la as p,lb as i,ma as u,mb as r,nb as H,rb as B,sb as L,tb as x,va as xe,wb as _,yb as c}from"./chunk-2FS7XGGJ.js";var le=class d extends Pe{getTableName(){return"tables"}calculateTableStatus(t){return h(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return[];let n=t.map(I=>I.id),a=new Date().toISOString().split("T")[0],{data:s,error:f}=yield this.supabaseService.getSupabaseClient().from("order_headers").select(`
          *,
          comande (*)
        `).eq("restaurant_id",e).eq("status","active").in("table_id",n);f&&console.error("Errore order headers:",f);let{data:O,error:k}=yield this.supabaseService.getSupabaseClient().from("reservations").select("*").eq("restaurant_id",e).eq("reservation_date",a).in("status",["confirmed","pending"]).in("table_id",n);return k&&console.error("Errore prenotazioni:",k),t.map(I=>{let V=(s||[]).filter(D=>D.table_id===I.id),ue=(O||[]).filter(D=>D.table_id===I.id),se="free",_e=null,ce=[],ve=null;return V.length>0?(se="occupied",ve=V[0].id,V.forEach(D=>{if(D.comande&&D.comande.length>0){let je=D.comande.map(E=>N(F({},E),{restaurant_id:E.restaurant_id||e,order_header_id:E.order_header_id||D.id,table_id:E.table_id||I.id,subtotal:E.subtotal||0,tax_amount:E.tax_amount||0,discount_amount:E.discount_amount||0,total_amount:E.total_amount||0,created_at:E.created_at,updated_at:E.updated_at,customer_name:E.customer_name||null,customer_phone:E.customer_phone||null,customer_notes:E.customer_notes||null,order_type:E.order_type||"dine_in",status:E.status||"ordered"}));ce=ce.concat(je)}})):ue.length>0&&(se="reserved",_e=ue[0]),{table:I,status:se,currentReservation:_e,currentOrders:ce,tavolataId:ve}})}catch(e){return console.error("\u274C Errore calcolo stato tavoli:",e),[]}})}static \u0275fac=(()=>{let t;return function(n){return(t||(t=xe(d)))(n||d)}})();static \u0275prov=fe({token:d,factory:d.\u0275fac,providedIn:"root"})};var Ze=()=>({id:"all",name:"\u{1F37D}\uFE0F Tutti i piatti"}),Ge=()=>[];function Je(d,t){if(d&1&&(i(0,"span",33),o(1),r()),d&2){let e=c(2);l(),v(" Comanda ",e.currentComanda.comanda_number," ")}}function Ye(d,t){if(d&1&&(i(0,"option",35),o(1),r()),d&2){let e=t.$implicit,n=c(3);m("value",e.id),l(),P(" Comanda ",e.comanda_number," (",n.getComandaTotalQuantity(e)," piatti) ")}}function Ke(d,t){if(d&1){let e=x();i(0,"div")(1,"select",34),w("ngModelChange",function(a){p(e);let s=c(2);return C(s.currentComandaId,a)||(s.currentComandaId=a),u(a)}),_("ngModelChange",function(a){p(e);let s=c(2);return u(s.switchComanda(a))}),g(2,Ye,2,3,"option",26),r()()}if(d&2){let e=c(2);l(),b("ngModel",e.currentComandaId),l(),m("ngForOf",e.getComandeForDropdown())}}function Xe(d,t){d&1&&(i(0,"span",43),o(1," Menu Dedicato "),r())}function et(d,t){d&1&&(i(0,"span"),o(1," Seleziona Menu "),r())}function tt(d,t){if(d&1&&(i(0,"div",44)(1,"div",14)(2,"span",45),o(3,"event_available"),r(),i(4,"span",46),o(5),r(),i(6,"span",47),o(7,"Dedicato"),r()()()),d&2){let e=c(3);l(5),y(e.dedicatedMenu.name)}}function it(d,t){d&1&&(i(0,"span",52)(1,"span",53),o(2,"star"),r(),o(3," Default "),r())}function nt(d,t){if(d&1&&(i(0,"div",49)(1,"div",50)(2,"div",14)(3,"span",8),o(4,"restaurant_menu"),r(),i(5,"span",46),o(6),r()(),g(7,it,4,0,"span",51),r()()),d&2){let e=c(4);l(6),y(e.globalMenus[0].name),l(),m("ngIf",e.globalMenus[0].is_default)}}function rt(d,t){if(d&1&&(i(0,"option",54),o(1),r()),d&2){let e=t.$implicit;m("ngValue",e),l(),P(" ",e.is_default?"\u2B50 ":"","",e.name," ")}}function at(d,t){if(d&1){let e=x();i(0,"div")(1,"select",34),w("ngModelChange",function(a){p(e);let s=c(4);return C(s.selectedMenu,a)||(s.selectedMenu=a),u(a)}),_("ngModelChange",function(a){p(e);let s=c(4);return u(s.onMenuSelectChange(a))}),i(2,"option",54),o(3," \u{1F37D}\uFE0F Tutti i piatti "),r(),g(4,rt,2,3,"option",55),r()()}if(d&2){let e=c(4);l(),b("ngModel",e.selectedMenu),l(),m("ngValue",A(3,Ze)),l(2),m("ngForOf",e.globalMenus)}}function ot(d,t){if(d&1&&(i(0,"div"),g(1,nt,8,2,"div",48)(2,at,5,4,"div",15),r()),d&2){let e=c(3);l(),m("ngIf",e.globalMenus.length===1),l(),m("ngIf",e.globalMenus.length>1)}}function lt(d,t){d&1&&(i(0,"div",56)(1,"span",57),o(2,"restaurant_menu"),r(),i(3,"p",58),o(4,"Nessun menu disponibile"),r()())}function dt(d,t){d&1&&(i(0,"span",52)(1,"span",53),o(2,"star"),r(),o(3," Predefinito "),r())}function st(d,t){d&1&&(i(0,"span",62)(1,"span",53),o(2,"event_available"),r(),o(3," Dedicato "),r())}function ct(d,t){if(d&1&&(i(0,"div",59)(1,"span",60),o(2),r(),g(3,dt,4,0,"span",51)(4,st,4,0,"span",61),r()),d&2){let e=c(3);l(2),v("",e.dishes.length," piatti disponibili"),l(),m("ngIf",e.selectedMenu.is_default),l(),m("ngIf",e.selectedMenu.type==="dedicated")}}function mt(d,t){if(d&1&&(i(0,"div",36)(1,"div",37)(2,"label",38)(3,"span",8),o(4,"restaurant_menu"),r(),g(5,Xe,2,0,"span",39)(6,et,2,0,"span",15),r(),g(7,tt,8,1,"div",40)(8,ot,3,2,"div",15)(9,lt,5,0,"div",41)(10,ct,5,3,"div",42),r()()),d&2){let e=c(2);l(5),m("ngIf",e.dedicatedMenu),l(),m("ngIf",!e.dedicatedMenu),l(),m("ngIf",e.dedicatedMenu),l(),m("ngIf",!e.dedicatedMenu&&e.globalMenus.length>0),l(),m("ngIf",!e.hasMenusToShow()),l(),m("ngIf",e.selectedMenu)}}function pt(d,t){if(d&1&&(i(0,"option",35),o(1),T(2,"slice"),r()),d&2){let e=t.$implicit;m("value",e.id),l(),P(" ",$(2,3,e.name,0,10),"",e.name.length>10?"...":""," ")}}function ut(d,t){if(d&1){let e=x();i(0,"div",64),_("click",function(){let a=p(e).$implicit,s=c(3);return u(s.selectedCategory=a.id)}),i(1,"span",8),o(2,"category"),r(),i(3,"span",65),o(4),T(5,"slice"),r(),i(6,"span",13),o(7),r()()}if(d&2){let e=t.$implicit,n=c(3);R("active",n.selectedCategory===e.id),l(4),P("",$(5,5,e.name,0,8),"",e.name.length>8?"...":""),l(3),y(n.getDishesCountByCategory(e.id))}}function _t(d,t){if(d&1&&(i(0,"small",13),o(1),T(2,"slice"),r()),d&2){let e=c().$implicit;l(),P(" ",$(2,2,e.description,0,40),"",e.description.length>40?"...":""," ")}}function vt(d,t){if(d&1){let e=x();i(0,"div",76)(1,"div",67)(2,"div",77)(3,"div",78)(4,"strong",79),o(5),r(),i(6,"div")(7,"button",80),_("click",function(){let a=p(e).$implicit,s=c(5);return u(s.addDishToOrder(a))}),i(8,"span",8),o(9,"add"),r()()()(),i(10,"span",81),o(11),T(12,"number"),r(),g(13,_t,3,6,"small",82),r()()()}if(d&2){let e=t.$implicit,n=c(5);l(5),y(e.name),l(2),m("disabled",!n.orderingStatus.allowed),l(4),v("\u20AC",M(12,4,e.base_price,"1.2-2")),l(2),m("ngIf",e.description)}}function gt(d,t){if(d&1&&(B(0),i(1,"div",70)(2,"div",71)(3,"span",72),o(4,"category"),r(),o(5),r(),i(6,"div",73),o(7),r()(),i(8,"div",74),g(9,vt,14,7,"div",75),r(),L()),d&2){let e=t.$implicit,n=c(4);l(5),v(" ",e.category.name," "),l(2),y(e.dishes.length),l(2),m("ngForOf",e.dishes)("ngForTrackBy",n.trackByDishId)}}function ht(d,t){if(d&1&&(B(0),g(1,gt,10,4,"ng-container",69),L()),d&2){let e=c(3);l(),m("ngForOf",e.getDishesGroupedByCategory())}}function ft(d,t){if(d&1){let e=x();i(0,"div",83)(1,"span",8),o(2,"search_off"),r(),i(3,"p",84),o(4,"Nessun piatto trovato"),r(),i(5,"button",85),_("click",function(){p(e);let a=c(3);return u(a.resetDishFilters())}),o(6," Reset filtri "),r()()}}function xt(d,t){if(d&1){let e=x();i(0,"div",28)(1,"div",63)(2,"div",64),_("click",function(){p(e);let a=c(2);return u(a.selectedCategory="all")}),i(3,"span",8),o(4,"restaurant_menu"),r(),i(5,"span",65),o(6,"Tutti"),r(),i(7,"span",13),o(8),r()(),g(9,ut,8,9,"div",66),r(),i(10,"div",67),g(11,ht,2,1,"ng-container",68)(12,ft,7,0,"ng-template",null,0,pe),r()()}if(d&2){let e=z(13),n=c(2);l(2),R("active",n.selectedCategory==="all"),l(6),y(n.getDishesCountByCategory("all")),l(),m("ngForOf",n.categoryService.data.slice(0,4)),l(2),m("ngIf",n.getDishesGroupedByCategory().length>0)("ngIfElse",e)}}function bt(d,t){if(d&1&&(i(0,"option",54),o(1),r()),d&2){let e=t.$implicit;m("ngValue",e),l(),P(" Comanda ",e.comanda_number," (",(e.order_items==null?null:e.order_items.length)||0," piatti) ")}}function Ct(d,t){if(d&1){let e=x();i(0,"div",93)(1,"select",24),w("ngModelChange",function(a){p(e);let s=c(3);return C(s.currentComanda,a)||(s.currentComanda=a),u(a)}),_("ngModelChange",function(){p(e);let a=c(3);return u(a.switchComanda((a.currentComanda==null?null:a.currentComanda.id)||""))}),g(2,bt,2,3,"option",55),r()()}if(d&2){let e=c(3);l(),b("ngModel",e.currentComanda),l(),m("ngForOf",e.getComandeForDropdown())}}function wt(d,t){if(d&1){let e=x();i(0,"div",99)(1,"div",100)(2,"div",9)(3,"strong"),o(4),r(),i(5,"div",12)(6,"span",13),o(7),T(8,"number"),r(),i(9,"span",13),o(10,"\u2022"),r(),i(11,"span",13),o(12),T(13,"number"),r()()(),i(14,"div",14)(15,"button",101),_("click",function(a){let s=p(e).$implicit;return c(5).updateQuantity(s,-1),u(a.stopPropagation())}),i(16,"span",8),o(17,"remove"),r()(),i(18,"span",102),o(19),r(),i(20,"button",103),_("click",function(a){let s=p(e).$implicit;return c(5).updateQuantity(s,1),u(a.stopPropagation())}),i(21,"span",8),o(22,"add"),r()(),i(23,"button",104),_("click",function(a){let s=p(e).$implicit;return c(5).removeItem(s),u(a.stopPropagation())}),i(24,"span",8),o(25,"delete"),r()()()()()}if(d&2){let e=t.$implicit,n=c(5);l(4),y(e.dish_name||"Piatto"),l(3),v("\u20AC",M(8,5,e.unit_price,"1.2-2")," cad."),l(5),v("Tot: \u20AC",M(13,8,e.unit_price*e.quantity,"1.2-2")),l(7),y(e.quantity),l(),m("disabled",!n.orderingStatus.allowed)}}function St(d,t){if(d&1&&(i(0,"div",87)(1,"span",13),o(2),r(),i(3,"strong",106),o(4),T(5,"number"),r()()),d&2){let e=c(6);l(2),v(" Totale generale (",e.orderHeader.comande.length," comande): "),l(2),v(" \u20AC",M(5,2,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function yt(d,t){if(d&1&&(B(0),g(1,St,6,5,"div",105),L()),d&2){let e=c(5);l(),m("ngIf",e.orderHeader.comande.length>1)}}function Tt(d,t){if(d&1&&(i(0,"div"),g(1,wt,26,11,"div",94),i(2,"div",95)(3,"div",96)(4,"strong",97),o(5,"Totale Comanda:"),r(),i(6,"strong",98),o(7),T(8,"number"),r()(),g(9,yt,2,1,"ng-container",15),r()()),d&2){let e=c(4);l(),m("ngForOf",e.currentComanda.order_items||A(6,Ge)),l(6),v(" \u20AC",M(8,3,e.currentComanda.total_amount,"1.2-2")," "),l(2),m("ngIf",e.orderHeader&&e.orderHeader.comande)}}function Et(d,t){if(d&1&&(B(0),g(1,Tt,10,7,"div",68),L()),d&2){c();let e=z(13),n=c(2);l(),m("ngIf",n.currentComanda.order_items&&n.currentComanda.order_items.length>0)("ngIfElse",e)}}function Ot(d,t){d&1&&(i(0,"div",107)(1,"span",108),o(2,"restaurant_menu"),r(),i(3,"p",84),o(4,"Nessun piatto in questa comanda"),r(),i(5,"p",58),o(6,"Clicca sui piatti per aggiungerli"),r()())}function Mt(d,t){if(d&1&&(i(0,"div",28)(1,"div",86)(2,"div",87)(3,"h3",88)(4,"span",89),o(5,"receipt"),r(),o(6),r(),i(7,"span",90),o(8),r()(),g(9,Ct,3,2,"div",91),r(),i(10,"div",92),g(11,Et,2,2,"ng-container",15)(12,Ot,7,0,"ng-template",null,1,pe),r()()),d&2){let e=c(2);l(6),v(" Comanda ",(e.currentComanda==null?null:e.currentComanda.comanda_number)||"1"," "),l(2),P(" ",e.getComandaItems().length," piatto",e.getComandaItems().length!==1?"i":""," "),l(),m("ngIf",e.shouldShowComandaDropdown()),l(2),m("ngIf",e.currentComanda)}}function It(d,t){if(d&1){let e=x();i(0,"div",3),_("click",function(){p(e);let a=c();return u(a.close())}),i(1,"div",4),_("click",function(a){return p(e),u(a.stopPropagation())}),i(2,"div",5)(3,"div",6)(4,"button",7),_("click",function(){p(e);let a=c();return u(a.close())}),i(5,"span",8),o(6,"arrow_back"),r()(),i(7,"div",9)(8,"h1",10),o(9),g(10,Je,2,1,"span",11),r(),i(11,"div",12)(12,"span",13),o(13),T(14,"number"),r()()()(),i(15,"div",14),g(16,Ke,3,2,"div",15),i(17,"button",7),_("click",function(){p(e);let a=c();return u(a.showComandaPage=!a.showComandaPage)}),i(18,"span",8),o(19),r()(),i(20,"button",16),_("click",function(){p(e);let a=c();return u(a.close())}),i(21,"span",8),o(22,"close"),r()()()(),i(23,"div",17),g(24,mt,11,6,"div",18),i(25,"div",19)(26,"div",20)(27,"div",21)(28,"input",22),w("ngModelChange",function(a){p(e);let s=c();return C(s.dishSearchTerm,a)||(s.dishSearchTerm=a),u(a)}),r()(),i(29,"div",23)(30,"select",24),w("ngModelChange",function(a){p(e);let s=c();return C(s.selectedCategory,a)||(s.selectedCategory=a),u(a)}),i(31,"option",25),o(32,"Tutte"),r(),g(33,pt,3,7,"option",26),r()(),i(34,"div",27)(35,"button",7),_("click",function(){p(e);let a=c();return u(a.resetDishFilters())}),i(36,"span",8),o(37,"refresh"),r()()()()(),i(38,"div",28),g(39,xt,14,6,"div",29)(40,Mt,14,5,"div",29),r()(),i(41,"div",30)(42,"button",31),_("click",function(){p(e);let a=c();return u(a.createNewComanda())}),i(43,"span",8),o(44,"receipt"),r(),o(45," Nuova Comanda "),r(),i(46,"button",32),_("click",function(){p(e);let a=c();return u(a.saveOrder())}),i(47,"span",8),o(48),r(),o(49),r()()()()}if(d&2){let e=c();l(),R("fullscreen-mobile",e.isMobile),l(8),v(" Tavolo ",e.table.table_number," "),l(),m("ngIf",e.currentComanda),l(3),q(" ",e.getComandaItems().length," piatto",e.getComandaItems().length!==1?"i":""," \u2022 \u20AC",M(14,20,e.calcolaTotaleTavolata(),"1.2-2")," "),l(3),m("ngIf",e.shouldShowComandaDropdown()),l(3),y(e.showComandaPage?"restaurant":"receipt_long"),l(5),m("ngIf",e.hasMenusToShow()),l(4),b("ngModel",e.dishSearchTerm),l(2),b("ngModel",e.selectedCategory),l(3),m("ngForOf",e.getCategories()),l(6),m("ngIf",!e.showComandaPage),l(),m("ngIf",e.showComandaPage),l(2),m("disabled",!e.orderHeader),l(4),m("disabled",!e.hasUnsavedChanges&&!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?e.hasUnsavedChanges?"Salva modifiche":"Nessuna modifica da salvare":e.orderingStatus.reason),l(2),y(e.hasUnsavedChanges?"save":"check_circle"),l(),v(" ",e.hasUnsavedChanges?"Salva Modifiche":"Gi\xE0 salvato",`
`)}}function kt(d,t){if(d&1){let e=x();i(0,"div",83)(1,"span",8),o(2,"receipt"),r(),i(3,"h3"),o(4,"Nessun ordine attivo"),r(),i(5,"p",84),o(6,"Non ci sono ordini per questo tavolo"),r(),i(7,"button",120),_("click",function(){p(e);let a=c(2);return u(a.switchToEditMode())}),i(8,"span",8),o(9,"add"),r(),o(10," Crea Primo Ordine "),r()()}}function Pt(d,t){if(d&1&&(i(0,"div",93)(1,"small",84),o(2),r()()),d&2){let e=c().$implicit;l(2),v("Note: ",e.item_notes)}}function Vt(d,t){if(d&1&&(i(0,"div",142)(1,"div",9)(2,"div",143)(3,"strong"),o(4),r(),g(5,Pt,3,1,"div",91),r(),i(6,"div",144)(7,"span"),o(8),T(9,"number"),r(),i(10,"span"),o(11,"\u2022"),r(),i(12,"span"),o(13),r()(),i(14,"span",145),o(15),r()(),i(16,"div",135)(17,"span",46),o(18),T(19,"number"),r(),i(20,"small",133),o(21,"Totale"),r()()()),d&2){let e=t.$implicit,n=c(6);l(4),y(n.getDishName(e)),l(),m("ngIf",e.item_notes),l(3),v("\u20AC",M(9,8,e.unit_price,"1.2-2")," cad."),l(5),v("Quantit\xE0: ",e.quantity),l(),W("background-color",n.getOrderStatusColor(e.status)),l(),v(" ",n.getOrderStatusText(e.status)," "),l(3),v("\u20AC",M(19,11,e.total_price,"1.2-2"))}}function Ft(d,t){if(d&1&&(i(0,"div",140),g(1,Vt,22,14,"div",141),r()),d&2){let e=c(2).$implicit;l(),m("ngForOf",e.order_items)}}function Dt(d,t){d&1&&(i(0,"div",146)(1,"span",8),o(2,"restaurant_menu"),r(),i(3,"p",84),o(4,"Nessun piatto in questa comanda"),r()())}function Rt(d,t){if(d&1&&(i(0,"div",95),g(1,Ft,2,1,"div",137)(2,Dt,5,0,"div",138),i(3,"div",139)(4,"strong",97),o(5),r(),i(6,"strong",98),o(7),T(8,"number"),r()()()),d&2){let e=c().$implicit,n=c(3);l(),m("ngIf",e.order_items&&e.order_items.length>0),l(),m("ngIf",!e.order_items||e.order_items.length===0),l(3),v("Totale Comanda ",e.comanda_number),l(2),v(" \u20AC",M(8,4,n.getComandaTotal(e),"1.2-2")," ")}}function Ht(d,t){if(d&1){let e=x();i(0,"div",127)(1,"div",128),_("click",function(){let a=p(e).$implicit,s=c(3);return u(s.toggleComandaExpansion(a.id))}),i(2,"div",129)(3,"div",130)(4,"div",131)(5,"h3",46),o(6),r(),i(7,"span",132),o(8),r()(),i(9,"div",133),o(10),T(11,"date"),r()()(),i(12,"div",134)(13,"div",135)(14,"span",73),o(15),T(16,"number"),r(),i(17,"span",13),o(18),r()()()(),g(19,Rt,9,7,"div",136),r()}if(d&2){let e=t.$implicit,n=c(3);l(6),v("Comanda ",e.comanda_number),l(),W("background-color",n.getOrderStatusColor(e.status)),l(),v(" ",n.getOrderStatusText(e.status)," "),l(2),v(" ",M(11,9,e.created_at,"dd/MM/yyyy HH:mm")," "),l(5),v(" \u20AC",M(16,12,n.getComandaTotal(e),"1.2-2")," "),l(3),P(" ",(e.order_items==null?null:e.order_items.length)||0," piatto",(e.order_items==null?null:e.order_items.length)!==1?"i":""," "),l(),m("ngIf",n.isComandaExpanded(e.id))}}function zt(d,t){if(d&1&&(i(0,"div",121),g(1,Ht,20,15,"div",122),i(2,"div",123)(3,"div",87)(4,"div")(5,"strong",124),o(6,"TOTALE TAVOLO"),r(),i(7,"p",125),o(8),r()(),i(9,"strong",126),o(10),T(11,"number"),r()()()()),d&2){let e=c(2);l(),m("ngForOf",e.orderHeader.comande),l(7),v(" ",e.getTotalComandeCount()," comande "),l(2),v(" \u20AC",M(11,3,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function Wt(d,t){if(d&1){let e=x();i(0,"div",3),_("click",function(){p(e);let a=c();return u(a.close())}),i(1,"div",109),_("click",function(a){return p(e),u(a.stopPropagation())}),i(2,"div",110)(3,"div",14)(4,"div",111)(5,"span",8),o(6,"receipt_long"),r()(),i(7,"div")(8,"h1",112),o(9),r(),i(10,"div",12)(11,"span",90),o(12),r(),i(13,"span",60),o(14),T(15,"number"),r()()()(),i(16,"button",7),_("click",function(){p(e);let a=c();return u(a.close())}),i(17,"span",8),o(18,"close"),r()()(),i(19,"div",113),g(20,kt,11,0,"div",114)(21,zt,12,6,"div",115),i(22,"div",116)(23,"button",117),_("click",function(){p(e);let a=c();return u(a.generateBill())}),i(24,"span",8),o(25,"receipt"),r(),o(26),r(),i(27,"button",118),_("click",function(){p(e);let a=c();return u(a.switchToEditMode())}),i(28,"span",8),o(29,"add"),r(),o(30," Aggiungi Piatti "),r(),i(31,"button",119),_("click",function(){p(e);let a=c();return u(a.close())}),i(32,"span",8),o(33,"close"),r(),o(34," Chiudi "),r()()()()()}if(d&2){let e=c();l(),R("fullscreen-mobile",e.isMobile),l(8),v("Ordini Tavolo ",e.table.table_number||"N/A"),l(3),P(" ",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)||0," Ordine",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)!==1?"i":""," "),l(2),v(" Totale: \u20AC",M(15,10,e.calcolaTotaleTavolata(),"1.2-2")," "),l(6),m("ngIf",!e.orderHeader||!e.orderHeader.comande||e.orderHeader.comande.length===0),l(),m("ngIf",e.orderHeader&&e.orderHeader.comande&&e.orderHeader.comande.length>0),l(2),m("disabled",!e.isReadyForBill()),l(3),v(" ",e.isReadyForBill()?"STAMPA SCONTRINO":"Non pronto per conto"," ")}}function At(d,t){if(d&1){let e=x();i(0,"div",3),_("click",function(){p(e);let a=c();return u(a.showBillPreviewModal=!1)}),i(1,"div",109),_("click",function(a){return p(e),u(a.stopPropagation())}),i(2,"div",110)(3,"h1",112),o(4,"Anteprima Scontrino"),r(),i(5,"button",7),_("click",function(){p(e);let a=c();return u(a.showBillPreviewModal=!1)}),i(6,"span",8),o(7,"close"),r()()(),H(8,"div",147),i(9,"div",148)(10,"button",119),_("click",function(){p(e);let a=c();return u(a.showBillPreviewModal=!1)}),o(11," Chiudi "),r(),i(12,"button",118),_("click",function(){p(e);let a=c();return u(a.printBill())}),i(13,"span",8),o(14,"print"),r(),o(15," Stampa "),r()()()()}if(d&2){let e=c();l(8),m("innerHTML",e.billPreviewHtml,be)}}var de=class d{orderHelper=S(ze);orderHeaderService=S(oe);comandaService=S(re);orderItemService=S(ae);dishService=S(Ve);loadingService=S(ne);categoryService=S(Fe);menuService=S(We);cdr=S(Ce);table;mode="edit";existingOrderHeader;orderingStatus={allowed:!0,reason:""};saved=new me;closeRequested=new me;orderHeader=null;currentComanda=null;dishes=[];currentComandaId="";searchTerm="";selectedCategory="all";dishSearchTerm="";isMobile=!1;isNewOrder=!1;activeMenus=[];selectedMenu={id:"all",name:"Tutti i piatti"};menuDishes=[];comandeExpanded={};showBillPreviewModal=!1;billPreviewHtml="";showComandaPage=!1;draftOrder=null;localChanges=[];hasUnsavedChanges=!1;constructor(){}ngOnInit(){return h(this,null,function*(){console.log("\u{1F504} OrderEditor init - mode:",this.mode),console.log("\u{1F4CA} Tavolo:",this.table?.table_number),console.log("\u{1F4E6} Existing Order Header:",this.existingOrderHeader?.id),this.dishes=this.dishService.getActiveDishes(),console.log("\u{1F37D}\uFE0F Piatti caricati:",this.dishes.length),yield this.categoryService.loadData(),yield this.loadActiveMenus(),this.mode==="view"&&this.existingOrderHeader?yield this.loadOrderForView():this.mode==="edit"&&(yield this.setupForEdit())})}loadActiveMenus(){return h(this,null,function*(){try{if(yield this.menuService.loadMenus(),this.activeMenus=this.menuService.getCurrentMenus().filter(t=>t.is_active),console.log("\u{1F4CB} Menu attivi:",this.activeMenus.length),this.activeMenus.length>0){let t=this.activeMenus.find(e=>e.is_default);this.selectedMenu=t||this.activeMenus[0],yield this.loadDishesForSelectedMenu()}}catch(t){console.error("\u274C Errore caricamento menu:",t)}})}loadDishesForSelectedMenu(){return h(this,null,function*(){if(this.selectedMenu.id==="all")this.dishes=this.dishService.getActiveDishes(),this.menuDishes=[];else try{this.menuDishes=yield this.menuService.getDishesWithDetailsByMenu(this.selectedMenu.id),this.dishes=this.menuDishes.filter(t=>t.dish&&!t.dish.deleted_at).map(t=>t.dish)}catch(t){console.error("\u274C Errore caricamento piatti menu:",t),this.dishes=this.dishService.getActiveDishes()}})}loadOrderForView(){return h(this,null,function*(){if(this.existingOrderHeader)try{this.loadingService.start(),console.log("\u{1F441}\uFE0F Caricamento ordine per visualizzazione:",this.existingOrderHeader.id);let t=yield this.orderHelper.loadFullOrder(this.existingOrderHeader.id);if(t){if(this.orderHeader=t,console.log("\u2705 Ordine caricato con",t.comande?.length,"comande"),t.comande&&t.comande.length>0){let e=t.comande.find(n=>n.status!=="cancelled");this.currentComanda=e||t.comande[0],console.log("\u{1F4CB} Comanda corrente:",this.currentComanda?.comanda_number)}}else console.error("\u274C Ordine non trovato")}catch(t){console.error("\u274C Errore caricamento ordine:",t)}finally{this.loadingService.stop()}})}setupForEdit(){return h(this,null,function*(){try{if(console.log("\u270F\uFE0F Setup modalit\xE0 edit in DRAFT per tavolo:",this.table.table_number),this.existingOrderHeader)console.log("\u{1F4E6} Carico ordine esistente in draft:",this.existingOrderHeader.id),this.draftOrder=yield this.orderHelper.loadFullOrder(this.existingOrderHeader.id),this.updateOrderHeader(),this.isNewOrder=!1;else{let t=yield this.orderHeaderService.getActiveByTable(this.table.id);t?(console.log("\u2705 Tavolata esistente trovata, carico in draft"),this.draftOrder=yield this.orderHelper.loadFullOrder(t.id),this.updateOrderHeader(),this.isNewOrder=!1):(console.log("\u{1F195} Creo nuova struttura vuota in draft"),this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader(),this.isNewOrder=!0)}if(this.draftOrder?.comande&&this.draftOrder.comande.length>0){let t=this.draftOrder.comande.slice().reverse().find(e=>e.status!=="cancelled");this.currentComanda=t||this.draftOrder.comande[0],this.currentComanda&&(this.currentComandaId=this.currentComanda.id)}this.dishes=this.dishService.getActiveDishes(),yield this.loadActiveMenus()}catch(t){console.error("\u274C Errore setup edit:",t)}})}createEmptyOrderHeader(){return{id:"draft-"+Date.now(),restaurant_id:"",table_id:this.table.id,order_number:"DRAFT-"+this.table.table_number+"-"+Date.now(),status:"draft",customer_name:"Cliente",total_amount:0,comande:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}loadOrderForEdit(t){return h(this,null,function*(){console.log("\u{1F504} Caricamento ordine per edit:",t);let e=yield this.orderHelper.loadFullOrder(t);if(!e){console.error("\u274C Ordine non trovato per edit");return}if(this.orderHeader=e,e.comande&&e.comande.length>0){let n=e.comande.slice().reverse().find(a=>a.status!=="cancelled");this.currentComanda=n||e.comande[0],console.log("\u{1F4CB} Comanda attiva per edit:",this.currentComanda?.comanda_number)}})}createNewOrder(){return h(this,null,function*(){console.log("\u{1F195} Creazione tavolata per tavolo:",this.table.table_number);try{let t=yield this.orderHelper.occupyTable(this.table.id,"Cliente");return!t.orderHeader||!t.comanda?(console.error("\u274C Impossibile creare tavolata"),!1):(this.orderHeader=yield this.orderHelper.loadFullOrder(t.orderHeader.id),this.orderHeader?.comande&&this.orderHeader.comande.length>0&&(this.currentComanda=this.orderHeader.comande[0]),console.log("\u2705 Tavolata creata:",t.orderHeader.id),!0)}catch(t){return console.error("\u274C Errore creazione tavolata:",t),!1}})}createNewComanda(){return h(this,null,function*(){try{console.log("\u{1F195} Creazione nuova comanda in modalit\xE0 DRAFT"),this.draftOrder||(console.log("\u{1F4DD} Creo prima una struttura draft"),this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader()),yield this.createNewComandaLocal(),console.log("\u2705 Nuova comanda creata in draft")}catch(t){console.error("\u274C Errore creazione nuova comanda:",t)}})}addDish(t){return h(this,null,function*(){try{if(console.log("\u2795 Aggiungi piatto in DRAFT:",t.name),this.cdr.detach(),this.draftOrder||(this.draftOrder=this.createEmptyOrderHeader(),this.orderHeader=F({},this.draftOrder),this.orderHeader.comande&&(this.orderHeader.comande=[...this.orderHeader.comande])),this.currentComanda||(yield this.createNewComandaLocal()),this.currentComanda&&this.currentComanda.order_items){let a=this.currentComanda.order_items.find(s=>s.dish_id===t.id);if(a){console.log("\u{1F4C8} Piatto gi\xE0 presente, incremento quantit\xE0"),this.cdr.reattach(),this.cdr.markForCheck(),yield this.updateQuantity(a,1);return}}if(!this.currentComanda){console.error("\u274C currentComanda \xE8 ancora null"),this.cdr.reattach(),this.cdr.markForCheck();return}let e={id:"draft-item-"+Date.now(),order_id:this.currentComanda.id,dish_id:t.id,dish_name:t.name,quantity:1,unit_price:t.base_price,total_price:t.base_price,status:"ordered",item_notes:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};this.currentComanda.order_items||(this.currentComanda.order_items=[]),this.currentComanda.order_items.push(e),this.draftOrder.comande||(this.draftOrder.comande=[]);let n=this.draftOrder.comande.findIndex(a=>a.id===this.currentComanda.id);if(n>=0?this.draftOrder.comande[n]=this.currentComanda:this.draftOrder.comande.push(this.currentComanda),this.orderHeader){let a=t.base_price;this.orderHeader.total_amount=(this.orderHeader.total_amount||0)+a;let s=this.orderHeader.comande?.findIndex(f=>f.id===this.currentComanda.id);s!==void 0&&s>=0&&this.orderHeader.comande&&(this.orderHeader.comande[s]=F({},this.currentComanda))}this.localChanges.push({type:"add",data:e,timestamp:new Date}),this.hasUnsavedChanges=!0,this.updateLocalTotals(),console.log("\u2705 Piatto aggiunto in draft. Modifiche in sospeso:",this.localChanges.length)}catch(e){console.error("\u{1F4A5} Errore in addDish (draft):",e)}finally{this.cdr.reattach(),this.cdr.markForCheck()}})}createNewComandaLocal(){return h(this,null,function*(){this.draftOrder||(this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader()),console.log("\u{1F195} Creo nuova comanda in DRAFT per tavolata:",this.draftOrder.id);let t=(this.draftOrder.comande?.length||0)+1,e={id:"draft-comanda-"+Date.now(),order_number:`${this.draftOrder.order_number}-${t}`,restaurant_id:"",order_header_id:this.draftOrder.id,tavolata_id:this.draftOrder.id,comanda_number:t,table_id:this.table.id,customer_name:this.draftOrder.customer_name,status:"ordered",order_type:"dine_in",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,order_items:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};this.draftOrder.comande||(this.draftOrder.comande=[]),this.draftOrder.comande.push(e),this.currentComanda=e,this.currentComandaId=e.id,this.updateOrderHeader(),this.localChanges.push({type:"new_comanda",data:e,timestamp:new Date}),this.hasUnsavedChanges=!0,console.log("\u2705 Nuova comanda creata in draft:",t)})}addDishToOrder(t){this.addDish(t)}updateQuantity(t,e){return h(this,null,function*(){if(this.currentComanda?.order_items)try{this.cdr.detach();let n=t.quantity+e;if(n<1){this.cdr.reattach(),this.cdr.markForCheck(),yield this.removeItemLocal(t);return}let a=this.currentComanda.order_items.findIndex(f=>f.id===t.id);if(a===-1)return;let s=this.currentComanda.order_items[a];s.quantity=n,s.total_price=s.unit_price*n,this.updateLocalTotals(),this.localChanges.push({type:"update",data:{itemId:t.id,quantity:n},timestamp:new Date}),this.hasUnsavedChanges=!0,console.log("\u{1F4C8} Quantit\xE0 aggiornata in draft:",n)}catch(n){console.error("\u274C Errore in updateQuantity:",n)}finally{this.cdr.reattach(),this.cdr.markForCheck()}})}removeItemLocal(t){return h(this,null,function*(){if(this.currentComanda?.order_items)try{this.cdr.detach();let e=this.currentComanda.order_items.findIndex(n=>n.id===t.id);if(e===-1)return;this.currentComanda.order_items.splice(e,1),this.localChanges.push({type:"delete",data:t,timestamp:new Date}),this.hasUnsavedChanges=!0,this.updateLocalTotals(),console.log("\u{1F5D1}\uFE0F Piatto rimosso in draft:",t.id)}catch(e){console.error("\u274C Errore in removeItemLocal:",e)}finally{this.cdr.reattach(),this.cdr.markForCheck()}})}updateLocalTotals(){!this.currentComanda||!this.currentComanda.order_items||(this.currentComanda.total_amount=this.currentComanda.order_items.reduce((t,e)=>t+(e.total_price||0),0),this.draftOrder&&this.draftOrder.comande&&(this.draftOrder.total_amount=this.draftOrder.comande.reduce((t,e)=>t+(e.total_amount||0),0)))}saveAllToDatabase(){return h(this,null,function*(){try{if(console.log("\u{1F4BE} Salvando tutte le modifiche in database...",this.localChanges.length,"modifiche"),!this.draftOrder)return console.error("\u274C Nessun draft da salvare"),!1;let t=!0,e=this.draftOrder.id;if(this.isNewOrder&&this.draftOrder.id.startsWith("draft-")){console.log("\u{1F195} Creazione nuova tavolata nel database...");let a=yield this.orderHeaderService.createForTable(this.table.id,this.draftOrder.customer_name||"Cliente");if(!a)return console.error("\u274C Impossibile creare order header"),!1;e=a.id,console.log("\u2705 Order header creato:",e)}let n=new Map;for(let a of this.localChanges.filter(s=>s.type==="new_comanda")){let s=a.data;console.log("\u{1F4E6} Creazione comanda nel database...");let f=yield this.comandaService.createForOrderHeader(e,s.comanda_number);f?(n.set(s.id,f.id),console.log(`\u2705 Comanda creata: draft ${s.id} -> real ${f.id}`)):(console.error("\u274C Errore creazione comanda per:",s.id),t=!1)}for(let a of this.localChanges)switch(a.type){case"add":let s=a.data,f=s.order_id;n.has(s.order_id)&&(f=n.get(s.order_id)),console.log("\u2795 Aggiungo piatto al database..."),(yield this.orderItemService.addItemToComanda(f,s.dish_id,s.quantity,s.unit_price,s.item_notes||""))||(console.error("\u274C Errore aggiunta piatto:",s),t=!1);break;case"update":let k=a.data;k.itemId.startsWith("draft-")||(console.log("\u{1F4C8} Aggiorno quantit\xE0 nel database..."),(yield this.orderHelper.updateItemQuantity(k.itemId,k.quantity))||(console.error("\u274C Errore aggiornamento quantit\xE0:",k),t=!1));break;case"delete":let I=a.data;I.id.startsWith("draft-")||(console.log("\u{1F5D1}\uFE0F Rimuovo piatto dal database..."),(yield this.orderHelper.removeItem(I.id))||(console.error("\u274C Errore rimozione piatto:",I),t=!1));break}return t}catch(t){return console.error("\u{1F4A5} Errore durante il salvataggio:",t),!1}})}removeItem(t){return h(this,null,function*(){if(this.currentComanda?.order_items)try{console.log("\u{1F5D1}\uFE0F Rimuovo piatto:",t.id),(yield this.orderHelper.removeItem(t.id))?(this.currentComanda.order_items=this.currentComanda.order_items.filter(n=>n.id!==t.id),this.updateTotals(),console.log("\u2705 Piatto rimosso con successo")):console.error("\u274C Errore rimozione piatto")}catch(e){console.error("\u274C Errore rimozione piatto:",e)}})}updateTotals(){!this.currentComanda||!this.currentComanda.order_items||(this.currentComanda.total_amount=this.currentComanda.order_items.reduce((t,e)=>t+(e.total_price||0),0),this.orderHeader&&this.orderHeader.comande&&(this.orderHeader.total_amount=this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)),console.log("\u{1F4B0} Totale aggiornato:",this.currentComanda.total_amount))}getFilteredDishes(){let t=this.dishes;if(this.selectedCategory!=="all"&&(t=t.filter(e=>e.category_id===this.selectedCategory)),this.dishSearchTerm){let e=this.dishSearchTerm.toLowerCase();t=t.filter(n=>n.name.toLowerCase().includes(e)||n.description?.toLowerCase().includes(e))}return t}getComandaItems(){return this.currentComanda?.order_items||[]}getComandaTotal(t){let e=t||this.currentComanda;return!e||!e.order_items?0:e.order_items.reduce((n,a)=>n+(a.total_price||0),0)}getDishesCountByCategory(t){let e=this.getFilteredDishes();return t==="all"?e.length:e.filter(n=>n.category_id===t).length}getDishesGroupedByCategory(){let t=this.getFilteredDishes(),e=this.categoryService.data,n=[];return e.forEach(a=>{let s=t.filter(f=>f.category_id===a.id);s.length>0&&n.push({category:a,dishes:s})}),n}getCategories(){return this.categoryService.data}shouldShowComandaDropdown(){return(this.orderHeader?.comande?.length||0)>1}getComandeForDropdown(){return this.orderHeader?.comande||[]}getCurrentComande(){return this.orderHeader?.comande||[]}switchComanda(t){if(!t||!this.orderHeader?.comande)return;let e=this.orderHeader.comande.find(n=>n.id===t);e&&(this.currentComanda=e,this.currentComandaId=t,console.log("\u{1F504} Comanda cambiata:",e.comanda_number))}getComandaTotalQuantity(t){let e=t||this.currentComanda;return!e||!e.order_items?0:e.order_items.reduce((n,a)=>n+(a.quantity||1),0)}toggleComandaExpansion(t){this.comandeExpanded[t]=!this.comandeExpanded[t]}isComandaExpanded(t){return this.comandeExpanded[t]||!1}saveOrder(){return h(this,null,function*(){try{if(this.loadingService.start(),console.log("\u{1F4BE} Salvando ordine..."),yield this.saveAllToDatabase()){if(console.log("\u2705 Ordine salvato nel database"),this.draftOrder&&!this.draftOrder.id.startsWith("draft-")){let e=yield this.orderHelper.loadFullOrder(this.draftOrder.id);if(e&&(this.draftOrder=e,this.orderHeader=JSON.parse(JSON.stringify(e)),e.comande&&e.comande.length>0)){let n=e.comande.slice().reverse().find(a=>a.status!=="cancelled");this.currentComanda=n||e.comande[0]}}this.saved.emit(this.orderHeader),this.localChanges=[],this.hasUnsavedChanges=!1,console.log("\u{1F389} Ordine salvato con successo")}else console.error("\u274C Errore durante il salvataggio"),alert("Errore durante il salvataggio dell'ordine")}catch(t){console.error("\u274C Errore salvataggio ordine:",t),alert("Errore durante il salvataggio: "+t.message)}finally{this.loadingService.stop()}})}close(){this.hasUnsavedChanges&&!window.confirm("Hai modifiche non salvate. Vuoi davvero chiudere senza salvare?")||(console.log("\u{1F6AA} Chiusura order editor"),this.closeRequested.emit())}calcolaTotaleTavolata(){return!this.orderHeader||!this.orderHeader.comande?0:this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)}calcolaTotaleOrderHeader(t){return t.total_amount||0}getTotalComandeCount(){return this.orderHeader?.comande?.length||0}getOrderStatusColor(t){return{ordered:"#f39c12",waiting:"#3498db",preparing:"#9b59b6",ready:"#2ecc71",served:"#27ae60",cancelled:"#e74c3c"}[t]||"#95a5a6"}getOrderStatusText(t){return{ordered:"Ordinato",waiting:"In attesa",preparing:"In preparazione",ready:"Pronto",served:"Servito",cancelled:"Cancellato"}[t]||t}getDishName(t){return t.dish_name||"Piatto"}resetDishFilters(){this.dishSearchTerm="",this.selectedCategory="all"}trackByDishId(t,e){return e.id}onMenuSelectChange(t){this.selectedMenu=t,this.loadDishesForSelectedMenu()}generateBill(){this.showBillPreviewModal=!0,this.billPreviewHtml=this.generateBillHtml()}printBill(){let t=window.open("","_blank");t&&(t.document.write(this.billPreviewHtml),t.document.close(),t.print())}isReadyForBill(){return!!(this.orderHeader&&this.orderHeader.comande&&this.orderHeader.comande.length>0)}generateBillHtml(){if(!this.orderHeader)return"";let t=`
      <html>
        <head>
          <title>Scontrino Tavolo ${this.table.table_number}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; }
            .item { margin-bottom: 10px; }
            .total { font-weight: bold; margin-top: 20px; }
          </style>
        </head>
        <body>
          <h1>Ristorante</h1>
          <p>Tavolo: ${this.table.table_number}</p>
          <p>Data: ${new Date().toLocaleDateString()}</p>
          <hr>
    `;return this.orderHeader.comande&&this.orderHeader.comande.forEach(e=>{t+=`<h3>Comanda ${e.comanda_number}</h3>`,e.order_items&&e.order_items.forEach(n=>{t+=`
              <div class="item">
                ${n.quantity} x ${n.dish_name||"Piatto"} - \u20AC${(n.unit_price*n.quantity).toFixed(2)}
              </div>
            `})}),t+=`
          <hr>
          <div class="total">Totale: \u20AC${this.calcolaTotaleTavolata().toFixed(2)}</div>
        </body>
      </html>
    `,t}get dedicatedMenu(){return this.activeMenus.find(t=>t.type==="dedicated")||null}get globalMenus(){return this.activeMenus.filter(t=>t.type==="global")}hasMenusToShow(){return this.activeMenus.length>0}hasDedicatedMenu(){return this.activeMenus.some(t=>t.type==="dedicated")}hasGlobalMenus(){return this.activeMenus.some(t=>t.type==="global")}switchToEditMode(){this.closeRequested.emit()}updateOrderHeader(){this.draftOrder&&(this.orderHeader=F({},this.draftOrder),this.draftOrder.comande&&(this.orderHeader.comande=this.draftOrder.comande.map(t=>N(F({},t),{order_items:t.order_items?[...t.order_items]:[]}))))}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=j({type:d,selectors:[["app-order-editor"]],inputs:{table:"table",mode:"mode",existingOrderHeader:"existingOrderHeader",orderingStatus:"orderingStatus"},outputs:{saved:"saved",closeRequested:"closeRequested"},decls:3,vars:3,consts:[["noDishes",""],["emptyOrder",""],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg","fullscreen-mobile",3,"click"],[1,"modal-header","compact-header"],[1,"flex","items-center","gap-sm","flex-1"],[1,"icon-button",3,"click"],[1,"material-icons"],[1,"flex","flex-col","flex-1"],[1,"section-title","text-md"],["class","chip active ml-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","mt-sm"],[1,"text-muted","text-mini"],[1,"flex","items-center","gap-sm"],[4,"ngIf"],["title","Chiudi",1,"icon-button",3,"click"],[1,"p-lg","mobile-scroll"],["class","menu-selector mb-lg",4,"ngIf"],[1,"search-bar-mobile","mb-md"],[1,"form-row"],[1,"form-group",2,"flex","3"],["type","text","placeholder","Cerca piatto...","autofocus","",1,"form-input","touch-target",3,"ngModelChange","ngModel"],[1,"form-group",2,"flex","1"],[1,"form-input","touch-target",3,"ngModelChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"flex",2,"margin-bottom","var(--gap-sm)"],[1,"flex","flex-col","gap-md"],["class","flex flex-col gap-md",4,"ngIf"],[1,"modal-footer","p-sm"],["title","Crea una nuova comanda nella tavolata corrente",1,"promethea-button","flex-1",3,"click","disabled"],[1,"promethea-button","primary","flex-1",3,"click","disabled","title"],[1,"chip","active","ml-sm"],[1,"form-input",3,"ngModelChange","ngModel"],[3,"value"],[1,"menu-selector","mb-lg"],[1,"form-group"],[1,"standard-label"],["class","text-primary font-semibold",4,"ngIf"],["class","p-sm bg-primary-light rounded mb-md",4,"ngIf"],["class","p-sm bg-smoke rounded text-center",4,"ngIf"],["class","mt-sm flex items-center gap-sm",4,"ngIf"],[1,"text-primary","font-semibold"],[1,"p-sm","bg-primary-light","rounded","mb-md"],[1,"material-icons","text-primary"],[1,"font-semibold"],[1,"chip","bg-primary","ml-sm","text-white"],["class","p-sm bg-glass rounded border",4,"ngIf"],[1,"p-sm","bg-glass","rounded","border"],[1,"flex","items-center","justify-between"],["class","chip bg-glass",4,"ngIf"],[1,"chip","bg-glass"],[1,"material-icons","text-mini"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"p-sm","bg-smoke","rounded","text-center"],[1,"material-icons","text-muted"],[1,"text-muted","text-mini","mt-sm"],[1,"mt-sm","flex","items-center","gap-sm"],[1,"chip"],["class","chip bg-primary text-white",4,"ngIf"],[1,"chip","bg-primary","text-white"],[1,"quick-actions-mobile"],[1,"quick-action-button",3,"click"],[1,"text-mini"],["class","quick-action-button",3,"active","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","gap-sm"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[1,"flex","gap-sm","items-center"],[1,"font-bold","text-md"],[1,"material-icons","text-md"],[1,"font-bold","text-primary","text-md"],[1,"dishes-grid"],["class","card dish-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","dish-card"],[1,"flex","gap-sm","flex-col","flex-1"],[1,"flex","gap-sm","justify-between"],[1,"dish-name"],["title","Aggiungi 1",1,"icon-button","x-small",3,"click","disabled"],[1,"dish-price","text-primary"],["class","text-muted text-mini",4,"ngIf"],[1,"empty-state"],[1,"text-muted"],[1,"promethea-button","ghost","mt-sm",3,"click"],[1,"form-card",2,"margin","0","padding","var(--gap-sm)"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","gap-sm","font-semibold"],[1,"material-icons","text-primary","text-md"],[1,"chip","active"],["class","mt-sm",4,"ngIf"],[1,"form-card","listacomanda",2,"margin","0","overflow-y","auto"],[1,"mt-sm"],["class","mb-sm pb-sm border-b border-[var(--smoke-1)] last:border-0",4,"ngFor","ngForOf"],[1,"mt-md","pt-md","border-t","border-[var(--smoke-1)]"],[1,"flex","justify-between","items-center","mb-sm"],[1,"text-md"],[1,"text-primary","text-md"],[1,"mb-sm","pb-sm","border-b","border-[var(--smoke-1)]","last:border-0"],[1,"flex","justify-between","items-start","gap-sm"],["title","Riduci quantit\xE0",1,"icon-button","x-small",3,"click"],[1,"font-bold","px-2","text-center","text-sm","min-w-[20px]"],["title","Aumenta quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],["title","Elimina piatto",1,"icon-button","x-small","ml-1","text-danger",3,"click"],["class","flex justify-between items-center",4,"ngIf"],[1,"text-secondary"],[1,"empty-state","py-lg"],[1,"material-icons","text-lg"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"header-icon"],[1,"section-title"],[1,"p-lg"],["class","empty-state",4,"ngIf"],["class","flex flex-col gap-lg",4,"ngIf"],[1,"modal-footer","mt-lg"],[1,"promethea-button","success","flex-1",3,"click","disabled"],[1,"promethea-button","primary","flex-1",3,"click"],[1,"promethea-button","ghost","flex-1",3,"click"],[1,"promethea-button","primary","mt-sm",3,"click"],[1,"flex","flex-col","gap-lg"],["class","form-card",4,"ngFor","ngForOf"],[1,"form-card","mt-md","bg-gradient","text-white"],[1,"text-white"],[1,"text-white","text-sm","opacity-80"],[1,"text-white","text-xl"],[1,"form-card"],[1,"flex","justify-between","items-center","cursor-pointer",3,"click"],[1,"flex","items-center","gap-md","flex-1"],[1,"flex","flex-col"],[1,"flex","items-center","gap-sm","flex-wrap"],[1,"chip","small"],[1,"text-muted","mt-sm"],[1,"flex","items-center","gap-md"],[1,"flex","flex-col","items-end"],["class","mt-md pt-md border-t border-[var(--smoke-1)]",4,"ngIf"],["class","space-y-sm",4,"ngIf"],["class","empty-state py-md",4,"ngIf"],[1,"flex","justify-between","items-center","mt-md","pt-md","border-t"],[1,"space-y-sm"],["class","flex justify-between items-start p-sm flex-wrap",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","p-sm","flex-wrap"],[1,"flex","items-start","gap-sm"],[1,"flex","items-center","gap-sm","mt-sm","text-muted"],[1,"chip","x-small","mt-sm",2,"max-width","fit-content"],[1,"empty-state","py-md"],[1,"p-lg",3,"innerHTML"],[1,"modal-footer"]],template:function(e,n){e&1&&g(0,It,50,23,"div",2)(1,Wt,35,13,"div",2)(2,At,16,1,"div",2),e&2&&(m("ngIf",n.mode==="edit"),l(),m("ngIf",n.mode==="view"),l(),m("ngIf",n.showBillPreviewModal))},dependencies:[G,U,Z,ie,ee,te,J,X,Y,K,Te,ye,Se],styles:["@media (max-width: 768px){.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%;width:100%;border-radius:0}}.dishes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(20vw,1fr));gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.dishes-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(40vw,1fr))}.grid-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1);background:var(--background);transition:all .2s ease;min-height:5rem}.dish-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:var(--primary);box-shadow:0 4px 12px var(--smoke-2)}.dish-name[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm);line-height:1.3;color:var(--text-color);margin-bottom:4px}.dish-price[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-sm);color:var(--primary)}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);overflow-x:auto;padding-bottom:var(--gap-sm);margin-bottom:var(--gap-md);-webkit-overflow-scrolling:touch;scrollbar-width:none}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.quick-action-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-sm);min-width:80px;border:1px solid var(--smoke-1);border-radius:12px;background:var(--background);transition:all .2s ease;cursor:pointer;flex-shrink:0}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button.active[_ngcontent-%COMP%]{background:var(--smoke-1);border-color:var(--primary)}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md);margin-bottom:4px}.grid-form[_ngcontent-%COMP%]{display:flex}@media (max-width: 768px){.grid-form.mobile-vertical[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gap-md)}}.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column}}.menu-selector[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;padding:var(--gap-md);margin-bottom:var(--gap-lg)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-lg);color:var(--text-muted);text-align:center}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-lg);margin-bottom:var(--gap-sm);opacity:.5}.bill-preview[_ngcontent-%COMP%]{font-family:Courier New,monospace;background:#fff;color:#000;padding:var(--gap-lg);max-height:60vh;overflow-y:auto}@media print{.bill-preview[_ngcontent-%COMP%]{max-height:none;overflow:visible}}.icon-button[disabled][_ngcontent-%COMP%], .promethea-button[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;pointer-events:none}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-overlay[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.compact-header[_ngcontent-%COMP%]{padding:var(--gap-sm) var(--gap-md)}.compact-header[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:var(--fs-md)}"]})};var Ne=()=>[1,2,3,4,5,6,7,8,9,10];function Bt(d,t){if(d&1&&(i(0,"option",61),o(1),r()),d&2){let e=t.$implicit;m("ngValue",e),l(),y(e.name)}}function Lt(d,t){if(d&1&&(i(0,"option",61),o(1),r()),d&2){let e=t.$implicit;m("ngValue",e),l(),v(" ",e.name," ")}}function qt(d,t){if(d&1){let e=x();i(0,"div",62)(1,"h2",63),o(2),r(),i(3,"div",18)(4,"button",36),_("click",function(){p(e);let a=c();return u(a.zoomOut())}),i(5,"span",37),o(6,"zoom_out"),r()(),i(7,"div",64)(8,"span",39),o(9,"search"),r(),i(10,"span",40),o(11),r()(),i(12,"button",36),_("click",function(){p(e);let a=c();return u(a.zoomIn())}),i(13,"span",37),o(14,"zoom_in"),r()(),i(15,"button",41),_("click",function(){p(e);let a=c();return u(a.resetZoom())}),i(16,"span",37),o(17,"history"),r()(),i(18,"select",65),w("ngModelChange",function(a){p(e);let s=c();return C(s.currentFloorPlan,a)||(s.currentFloorPlan=a),u(a)}),_("ngModelChange",function(a){p(e);let s=c();return u(s.onFloorPlanSelect(a))}),g(19,Lt,2,2,"option",27),r(),i(20,"button",41),_("click",function(){p(e);let a=c();return u(a.safeToggleFullscreen())}),i(21,"span",37),o(22,"fullscreen_exit"),r()()()()}if(d&2){let e=c();l(2),y((e.currentFloorPlan==null?null:e.currentFloorPlan.name)||"Mappa"),l(2),m("disabled",e.zoomLevel<=e.minZoom),l(7),v("",(e.zoomLevel*100).toFixed(0),"%"),l(),m("disabled",e.zoomLevel>=e.maxZoom),l(6),b("ngModel",e.currentFloorPlan),l(),m("ngForOf",e.floorPlans)}}function Nt(d,t){if(d&1&&(i(0,"div",72)(1,"small"),o(2),r()()),d&2){let e=c().$implicit;l(2),v("Pren: ",e.currentReservation.customer_name)}}function jt(d,t){if(d&1&&(i(0,"div",72)(1,"small"),o(2),r()()),d&2){let e=c().$implicit,n=c();l(2),v("Ord: ",n.getTableOrderCount(e.table.id)," piatti")}}function Qt(d,t){if(d&1){let e=x();i(0,"div",66),_("click",function(){let a=p(e).$implicit,s=c();return u(s.onTableClick(a))}),i(1,"div",67)(2,"div",68),o(3),r(),i(4,"div",69)(5,"div",70),o(6),i(7,"span",37),o(8,"person"),r()()(),g(9,Nt,3,1,"div",71)(10,jt,3,1,"div",71),r()()}if(d&2){let e=t.$implicit,n=c();Q(n.getTableClass(e)),m("ngStyle",n.getTableStyle(e.table)),l(),R("text-large",n.isLargeText),l(2),y(e.table.table_number),l(3),y(e.table.capacity),l(3),m("ngIf",e.currentReservation),l(),m("ngIf",e.currentOrders)}}function $t(d,t){d&1&&(i(0,"div",73)(1,"span",37),o(2,"search_off"),r(),i(3,"h3"),o(4,"Nessun tavolo trovato"),r(),i(5,"p",8),o(6,"Modifica i filtri di ricerca"),r()())}function Ut(d,t){if(d&1){let e=x();i(0,"div",83)(1,"button",84),_("click",function(){p(e);let a=c(2);return a.openManualReservationModal(),u(a.showQuickActionsModal=!1)}),i(2,"span",37),o(3,"event"),r(),o(4," Crea Prenotazione "),r(),i(5,"button",85),_("click",function(){p(e);let a=c(2);return u(a.openOrderEditor())}),i(6,"span",37),o(7),r(),o(8),r()()}if(d&2){let e=c(2);l(5),m("disabled",!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?"Crea nuovo ordine":"Disabilitato: fuori orario dei turni"),l(2),y(e.orderingStatus.allowed?"restaurant":"schedule"),l(),v(" ",e.orderingStatus.allowed?"Crea Ordine":"Fuori Turno"," ")}}function Zt(d,t){if(d&1){let e=x();i(0,"div",83)(1,"button",42),_("click",function(){p(e);let a=c(2);return a.openEditReservationModal(),u(a.showQuickActionsModal=!1)}),i(2,"span",37),o(3,"edit"),r(),o(4," Modifica Prenotazione "),r(),i(5,"button",86),_("click",function(){p(e);let a=c(2);return u(a.openOrderEditor())}),i(6,"span",37),o(7,"check"),r(),o(8," Conferma Arrivo (Crea Ordine) "),r()()}if(d&2){let e=c(2);l(5),m("disabled",!e.orderingStatus.allowed)}}function Gt(d,t){if(d&1){let e=x();i(0,"div",83)(1,"button",84),_("click",function(){p(e);let a=c(2);return u(a.openOrderEditor())}),i(2,"span",37),o(3,"receipt"),r(),o(4," Visualizza Ordini "),r(),i(5,"button",87),_("click",function(){p(e);let a=c(2);return u(a.freeTable())}),i(6,"span",37),o(7,"check_circle"),r(),o(8," Libera Tavolo "),r()()}}function Jt(d,t){if(d&1){let e=x();i(0,"div",74)(1,"div",75)(2,"div",76)(3,"div",46)(4,"div",77)(5,"span",37),o(6,"table_restaurant"),r()(),i(7,"div")(8,"h1",7),o(9),r()()(),i(10,"button",41),_("click",function(){p(e);let a=c();return u(a.deselectTable())}),i(11,"span",37),o(12,"close"),r()()(),i(13,"div",78)(14,"div",79)(15,"div",80)(16,"span",81),o(17),r()(),g(18,Ut,9,4,"div",82)(19,Zt,9,1,"div",82)(20,Gt,9,0,"div",82),r()()()()}if(d&2){let e=c();l(9),v("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number),l(7),Q(e.getStatusColorClass((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")),l(),v(" ",e.getStatusText((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")," "),l(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="free"),l(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="reserved"),l(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="occupied")}}function Yt(d,t){if(d&1&&(i(0,"option",101),o(1),r()),d&2){let e=t.$implicit,n=c(2);m("value",e)("disabled",n.selectedTable&&e>n.selectedTable.capacity),l(),q(" ",e," ",e===1?"persona":"persone"," ",n.selectedTable&&e>n.selectedTable.capacity?" (Troppe persone)":""," ")}}function Kt(d,t){if(d&1){let e=x();i(0,"div",74)(1,"div",88)(2,"div",76)(3,"div",46)(4,"div",77)(5,"span",37),o(6,"event"),r()(),i(7,"div")(8,"h2",40),o(9),r()()(),i(10,"button",41),_("click",function(){p(e);let a=c();return u(a.closeManualReservationModal())}),i(11,"span",37),o(12,"close"),r()()(),i(13,"div",78)(14,"form",89,2),_("ngSubmit",function(a){return p(e),c().createManualReservation(),u(a.preventDefault())}),i(16,"div",23)(17,"div",24)(18,"label",25),o(19,"Nome Cliente *"),r(),i(20,"input",90),w("ngModelChange",function(a){p(e);let s=c();return C(s.manualReservationData.customer_name,a)||(s.manualReservationData.customer_name=a),u(a)}),r()(),i(21,"div",24)(22,"label",25),o(23,"Telefono *"),r(),i(24,"input",91),w("ngModelChange",function(a){p(e);let s=c();return C(s.manualReservationData.customer_phone,a)||(s.manualReservationData.customer_phone=a),u(a)}),r()()(),i(25,"div",23)(26,"div",24)(27,"label",25),o(28,"Data *"),r(),i(29,"input",92),w("ngModelChange",function(a){p(e);let s=c();return C(s.manualReservationData.reservation_date,a)||(s.manualReservationData.reservation_date=a),u(a)}),r()(),i(30,"div",24)(31,"label",25),o(32,"Orario *"),r(),i(33,"input",93),w("ngModelChange",function(a){p(e);let s=c();return C(s.manualReservationData.reservation_time,a)||(s.manualReservationData.reservation_time=a),u(a)}),r()()(),i(34,"div",24)(35,"label",25),o(36,"Numero Persone *"),r(),i(37,"select",94),w("ngModelChange",function(a){p(e);let s=c();return C(s.manualReservationData.party_size,a)||(s.manualReservationData.party_size=a),u(a)}),g(38,Yt,2,5,"option",95),r(),i(39,"div",96),o(40),r()(),i(41,"div",24)(42,"label",25),o(43,"Note Speciali"),r(),i(44,"textarea",97),w("ngModelChange",function(a){p(e);let s=c();return C(s.manualReservationData.special_requests,a)||(s.manualReservationData.special_requests=a),u(a)}),r()(),i(45,"div",98)(46,"button",99),_("click",function(){p(e);let a=c();return u(a.closeManualReservationModal())}),o(47," Annulla "),r(),i(48,"button",100)(49,"span",37),o(50,"add"),r(),o(51," Crea Prenotazione "),r()()()()()()}if(d&2){let e=z(15),n=c();l(9),v("Nuova Prenotazione - Tavolo ",n.selectedTable==null?null:n.selectedTable.table_number),l(11),b("ngModel",n.manualReservationData.customer_name),l(4),b("ngModel",n.manualReservationData.customer_phone),l(5),b("ngModel",n.manualReservationData.reservation_date),l(4),b("ngModel",n.manualReservationData.reservation_time),l(4),b("ngModel",n.manualReservationData.party_size),l(),m("ngForOf",A(10,Ne)),l(2),v(" Capacit\xE0 massima tavolo: ",(n.selectedTable==null?null:n.selectedTable.capacity)||0," persone "),l(4),b("ngModel",n.manualReservationData.special_requests),l(4),m("disabled",!e.valid)}}function Xt(d,t){if(d&1&&(i(0,"option",101),o(1),r()),d&2){let e=t.$implicit,n=c(2);m("value",e)("disabled",n.selectedTable&&e>n.selectedTable.capacity),l(),q(" ",e," ",e===1?"persona":"persone"," ",n.selectedTable&&e>n.selectedTable.capacity?" (Troppe persone)":""," ")}}function ei(d,t){if(d&1){let e=x();i(0,"button",104),_("click",function(){p(e);let a=c(2);return u(a.deleteReservation())}),i(1,"span",37),o(2,"delete"),r(),o(3," Elimina "),r()}}function ti(d,t){if(d&1){let e=x();i(0,"div",74)(1,"div",88)(2,"div",76)(3,"div",46)(4,"div",77)(5,"span",37),o(6,"edit"),r()(),i(7,"div")(8,"h1",7),o(9),r()()(),i(10,"button",41),_("click",function(){p(e);let a=c();return u(a.closeEditReservationModal())}),i(11,"span",37),o(12,"close"),r()()(),i(13,"div",78)(14,"form",89,2),_("ngSubmit",function(a){return p(e),c().updateReservation(),u(a.preventDefault())}),i(16,"div",23)(17,"div",24)(18,"label",25),o(19,"Nome Cliente *"),r(),i(20,"input",90),w("ngModelChange",function(a){p(e);let s=c();return C(s.editingReservation.customer_name,a)||(s.editingReservation.customer_name=a),u(a)}),r()(),i(21,"div",24)(22,"label",25),o(23,"Telefono *"),r(),i(24,"input",91),w("ngModelChange",function(a){p(e);let s=c();return C(s.editingReservation.customer_phone,a)||(s.editingReservation.customer_phone=a),u(a)}),r()()(),i(25,"div",23)(26,"div",24)(27,"label",25),o(28,"Data *"),r(),i(29,"input",92),w("ngModelChange",function(a){p(e);let s=c();return C(s.editingReservation.reservation_date,a)||(s.editingReservation.reservation_date=a),u(a)}),r()(),i(30,"div",24)(31,"label",25),o(32,"Orario *"),r(),i(33,"input",93),w("ngModelChange",function(a){p(e);let s=c();return C(s.editingReservation.reservation_time,a)||(s.editingReservation.reservation_time=a),u(a)}),r()()(),i(34,"div",24)(35,"label",25),o(36,"Numero Persone *"),r(),i(37,"select",94),w("ngModelChange",function(a){p(e);let s=c();return C(s.editingReservation.party_size,a)||(s.editingReservation.party_size=a),u(a)}),g(38,Xt,2,5,"option",95),r(),i(39,"div",96),o(40),r()(),i(41,"div",24)(42,"label",25),o(43,"Note Speciali"),r(),i(44,"textarea",97),w("ngModelChange",function(a){p(e);let s=c();return C(s.editingReservation.special_requests,a)||(s.editingReservation.special_requests=a),u(a)}),r()(),i(45,"div",98)(46,"div",102),g(47,ei,4,0,"button",103),i(48,"div",5)(49,"button",99),_("click",function(){p(e);let a=c();return u(a.closeEditReservationModal())}),o(50," Annulla "),r(),i(51,"button",100)(52,"span",37),o(53,"save"),r(),o(54," Salva "),r()()()()()()()()}if(d&2){let e=z(15),n=c();l(9),v("Modifica Prenotazione - Tavolo ",n.selectedTable==null?null:n.selectedTable.table_number),l(11),b("ngModel",n.editingReservation.customer_name),l(4),b("ngModel",n.editingReservation.customer_phone),l(5),b("ngModel",n.editingReservation.reservation_date),l(4),b("ngModel",n.editingReservation.reservation_time),l(4),b("ngModel",n.editingReservation.party_size),l(),m("ngForOf",A(11,Ne)),l(2),v(" Capacit\xE0 massima tavolo: ",(n.selectedTable==null?null:n.selectedTable.capacity)||0," persone "),l(4),b("ngModel",n.editingReservation.special_requests),l(3),m("ngIf",n.isReservationDeletable(n.editingReservation)),l(4),m("disabled",!e.valid)}}function ii(d,t){if(d&1){let e=x();i(0,"app-order-editor",105),_("saved",function(){p(e);let a=c();return u(a.closeOrderEditorModal())})("closeRequested",function(){p(e);let a=c();return u(a.closeOrderEditorModal())}),r()}if(d&2){let e=c();m("table",e.orderEditorData.table)("mode","edit")("existingOrderHeader",e.orderEditorData.existingOrderHeader)}}function ni(d,t){if(d&1){let e=x();i(0,"app-order-editor",106),_("closeRequested",function(){p(e);let a=c();return u(a.closeOrderEditorViewModal())}),r()}if(d&2){let e=c();m("table",e.selectedTable)("mode","view")("existingOrderHeader",e.orderEditorData.existingOrderHeader||null)}}var qe=class d{tableStatusService=S(le);floorManagementService=S(Ae);loadingService=S(ne);tableService=S(Re);floorPlanService=S(De);reservationService=S(He);authService=S(Ee);orderHeaderService=S(oe);shiftService=S(Be);comandaService=S(re);orderItemService=S(ae);zoomLevel=1;minZoom=.5;maxZoom=3;mobileView=!1;isFullscreen=!1;isLargeText=!1;searchTerm="";statusFilter="all";showQuickActionsModal=!1;showManualReservationModal=!1;showEditReservationModal=!1;showAssignReservationModal=!1;showTableReservationsModal=!1;showTableAssignmentModal=!1;showOrderEditorModal=!1;showOrderEditorViewModal=!1;orderEditorData={table:null,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null};currentFloorPlan=null;tableStatuses=[];selectedTable=null;selectedTableStatus=null;currentRestaurant=null;tableOrderCounts=new Map;manualReservationData={customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};editingReservation=null;orderingStatus={allowed:!1,reason:"Caricamento...",currentShift:null};availableReservationsWithoutTable=[];selectedReservationForAssignment=null;assignmentReservation=null;suggestedTablesByFloorPlan={};selectedFloorPlanForAssignment=null;selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}};subscriptions=new ge;get floorPlans(){return this.floorPlanService.data}get dishes(){return[]}ngOnInit(){return h(this,null,function*(){yield this.loadInitialData(),this.checkMobileView(),window.addEventListener("resize",()=>this.checkMobileView()),this.startShiftChecking()})}ngOnDestroy(){this.subscriptions.unsubscribe(),window.removeEventListener("resize",()=>this.checkMobileView())}loadInitialData(){return h(this,null,function*(){this.loadingService.start();try{yield Promise.all([this.floorPlanService.loadFloorPlans(),this.tableService.loadData(),this.floorManagementService.loadTodaysReservations()]);let t=this.tableService.data.filter(e=>!e.is_merged||e.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(t),this.floorPlans.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=this.floorPlans[0],yield this.loadTablesForFloorPlan())}finally{this.loadingService.stop()}})}onTableClick(t){return h(this,null,function*(){this.selectedTable=t.table,this.selectedTableStatus=t,yield this.loadTableReservations(t.table.id),this.showQuickActionsModal=!0})}deselectTable(){this.selectedTable=null,this.selectedTableStatus=null,this.showQuickActionsModal=!1,this.showManualReservationModal=!1,this.showEditReservationModal=!1}openManualReservationModal(){return h(this,null,function*(){if(!this.selectedTable)return;let t=new Date;this.manualReservationData={customer_name:"",customer_phone:"",reservation_date:t.toISOString().split("T")[0],reservation_time:t.toTimeString().split(" ")[0].substring(0,5),party_size:this.selectedTable.capacity||2,special_requests:""},this.showQuickActionsModal=!1,this.showManualReservationModal=!0})}closeManualReservationModal(){this.showManualReservationModal=!1}createManualReservation(){return h(this,null,function*(){if(this.selectedTable)try{let t=yield this.getCurrentRestaurantId();if(!t)return;let e={restaurant_id:t,table_id:this.selectedTable.id,reservation_date:this.manualReservationData.reservation_date,reservation_time:this.manualReservationData.reservation_time,party_size:this.manualReservationData.party_size,special_requests:this.manualReservationData.special_requests,status:"confirmed",customer_name:this.manualReservationData.customer_name,customer_phone:this.manualReservationData.customer_phone};(yield this.reservationService.createRestaurantReservation(e))?(this.closeManualReservationModal(),yield this.loadInitialData(),alert("Prenotazione creata con successo!")):alert("Errore nella creazione della prenotazione")}catch(t){console.error("Error creating manual reservation:",t),alert("Errore durante la creazione della prenotazione: "+t.message)}})}openOrderEditor(){return h(this,null,function*(){if(this.selectedTable)try{this.loadingService.start();let t=yield this.orderHeaderService.getActiveByTable(this.selectedTable.id);t?(this.orderEditorData={table:this.selectedTable,mode:"view",existingOrderHeader:t,orderHeaders:[t],currentTavolataId:t.id},this.showOrderEditorViewModal=!0,console.log("\u{1F441}\uFE0F Apro order editor in modalit\xE0 VIEW")):(this.orderEditorData={table:this.selectedTable,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null},this.showOrderEditorModal=!0,console.log("\u270F\uFE0F Apro order editor in modalit\xE0 EDIT (nuovo)")),this.showQuickActionsModal=!1}catch(t){console.error("\u274C Errore apertura order editor:",t)}finally{this.loadingService.stop()}})}closeOrderEditorModal(){this.showOrderEditorModal=!1,this.loadTablesForFloorPlan()}closeOrderEditorViewModal(){this.showOrderEditorViewModal=!1}loadTableReservations(t){return h(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let n=new Date().toISOString().split("T")[0],a=this.reservationService.data.filter(O=>O.restaurant_id===e&&O.table_id===t&&O.reservation_date===n&&["confirmed","pending"].includes(O.status)).sort((O,k)=>O.reservation_time.localeCompare(k.reservation_time)),s=null,f=[];for(let O of a){let k=new Date(`${O.reservation_date}T${O.reservation_time}`),I=new Date,V=(k.getTime()-I.getTime())/(1e3*60*60);V>=0&&V<=1.5?s=O:V>1.5&&f.push(O)}this.selectedTableReservations={active:s,futureReservations:f,shiftInfo:{current:null,next:null}}}catch(e){console.error("Errore caricamento prenotazioni tavolo:",e),this.selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}}}})}checkMobileView(){this.mobileView=window.innerWidth<=768}getFilteredTables(){let t=this.tableStatuses;if(this.statusFilter!=="all"&&(t=t.filter(e=>e.status===this.statusFilter)),this.searchTerm){let e=this.searchTerm.toLowerCase();t=t.filter(n=>n.table.table_number.toLowerCase().includes(e)||n.table.table_name.toLowerCase().includes(e))}return t}getTableClass(t){let e=this.selectedTable?.id===t.table.id;return`table-element shape-${t.table.shape} ${t.status} ${e?"selected":""}`}getTableStyle(t){return{left:t.position_x+"px",top:t.position_y+"px",width:t.width+"px",height:t.height+"px","border-radius":t.shape==="circle"?"50%":"0px",transform:`rotate(${t.rotation}deg)`}}startShiftChecking(){this.checkCurrentShift(),this.subscriptions.add(he(6e4).subscribe(()=>this.checkCurrentShift()))}checkCurrentShift(){return h(this,null,function*(){let t=yield this.shiftService.getOrderingStatus();this.orderingStatus=t})}getShiftStatusClass(){return this.orderingStatus.allowed?"shift-active":"shift-inactive"}getShiftStatusText(){return this.orderingStatus.allowed?"\u{1F4CB} Orario di turno":"\u23F0 "+this.orderingStatus.reason}getCurrentRestaurantId(){return h(this,null,function*(){try{let t=this.authService.getCurrentStaffRestaurantId();return t||(this.authService.currentUserValue?(yield this.reservationService.loadData(),this.reservationService.data.length>0&&this.reservationService.data[0]?.restaurant_id||null):null)}catch(t){return console.error("Errore in getCurrentRestaurantId:",t),null}})}getStatusColorClass(t=""){return`status-${t}`}getStatusText(t=""){return{free:"Libero",reserved:"Prenotato",occupied:"Occupato"}[t]||t}getTableOrderItemsCount(t){return h(this,null,function*(){try{let e=yield this.orderHeaderService.getActiveByTable(t);if(!e)return 0;let n=yield this.comandaService.loadByOrderHeaderId(e.id),a=0;for(let s of n){let f=yield this.orderItemService.loadByComandaId(s.id);a+=f.length}return a}catch(e){return console.error("Errore conteggio piatti:",e),0}})}onFloorPlanSelect(t){this.currentFloorPlan=t,this.loadTablesForFloorPlan(),this.deselectTable()}safeToggleFullscreen(){return h(this,null,function*(){this.isFullscreen=!this.isFullscreen})}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.25,this.maxZoom)}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.25,this.minZoom)}resetZoom(){this.zoomLevel=1}getScaledWidth(){return(this.currentFloorPlan?.width||1e3)*this.zoomLevel}getScaledHeight(){return(this.currentFloorPlan?.height||800)*this.zoomLevel}updateReservation(){return h(this,null,function*(){if(this.editingReservation)try{(yield this.reservationService.updateReservation(this.editingReservation.id,this.editingReservation))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'aggiornamento della prenotazione")}catch(t){console.error("Errore nell'aggiornamento della prenotazione:",t),alert("Errore durante l'aggiornamento della prenotazione")}})}deleteReservation(){return h(this,null,function*(){if(this.editingReservation&&this.isReservationDeletable(this.editingReservation))try{(yield this.reservationService.deleteReservation(this.editingReservation.id))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'eliminazione della prenotazione")}catch(t){console.error("Errore nell'eliminazione della prenotazione:",t),alert("Errore durante l'eliminazione della prenotazione")}else alert("Impossibile eliminare questa prenotazione")})}isReservationDeletable(t){return!t?.reservation_date||!t?.reservation_time?!1:new Date(`${t.reservation_date}T${t.reservation_time}`)>new Date}openEditReservationModal(){this.selectedTableStatus?.currentReservation&&(this.editingReservation=F({},this.selectedTableStatus.currentReservation),this.showEditReservationModal=!0,this.showQuickActionsModal=!1)}closeEditReservationModal(){this.showEditReservationModal=!1,this.editingReservation=null}getFreeTablesCount(){return this.tableStatuses.filter(t=>t.status==="free").length}getReservedTablesCount(){return this.tableStatuses.filter(t=>t.status==="reserved").length}getOccupiedTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied").length}getTotalTablesCount(){return this.tableStatuses.length}toggleSize(){this.isLargeText=!this.isLargeText}getTableOrderItemsCountSync(t){return 0}loadAllTableOrderCounts(){return h(this,null,function*(){this.tableOrderCounts.clear();let t=this.tableStatuses.map(e=>h(this,null,function*(){try{let n=yield this.getTableOrderItemsCount(e.table.id);this.tableOrderCounts.set(e.table.id,n)}catch(n){console.error(`Errore caricamento ordini per tavolo ${e.table.id}:`,n),this.tableOrderCounts.set(e.table.id,0)}}));yield Promise.all(t)})}getTableOrderCount(t){return this.tableOrderCounts.get(t)||0}loadTablesForFloorPlan(){return h(this,null,function*(){if(!this.currentFloorPlan)return;let e=this.tableService.getTablesByFloorPlan(this.currentFloorPlan.id).filter(n=>!n.is_merged||n.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(e),yield this.loadAllTableOrderCounts()})}getTablesWithOrdersCount(){return Array.from(this.tableOrderCounts.values()).filter(t=>t>0).length}freeTable(){return h(this,null,function*(){if(!this.selectedTable)return;let t=this.selectedTable,e=t.table_number;try{let n=yield this.getTableOrderItemsCount(t.id);if(n>0){if(!confirm(`\u26A0\uFE0F ATTENZIONE!

Il tavolo ${e} ha ${n} piatti ordinati.

Sei sicuro di voler liberare il tavolo?
Questa azione chiuder\xE0 tutti gli ordini attivi.`))return}else if(!confirm(`Vuoi liberare il tavolo ${e}?`))return;this.loadingService.start(),(yield this.orderHeaderService.closeAllActiveHeadersForTable(t.id))?(console.log(`\u2705 Tavolo ${e} liberato`),yield this.loadTablesForFloorPlan(),this.deselectTable(),alert(`\u2705 Tavolo ${e} liberato con successo!`)):alert("\u274C Errore durante la liberazione del tavolo. Riprova.")}catch(n){console.error("\u274C Errore liberazione tavolo:",n),alert("\u274C Errore durante la liberazione del tavolo.")}finally{this.loadingService.stop()}})}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=j({type:d,selectors:[["app-table-map"]],decls:141,vars:40,consts:[["mapContainer","","mapCard",""],["floorPlanCanvas",""],["reservationForm","ngForm"],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","flex-col","gap-md"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"form-card","flex-col","flex","gap-md"],[1,"flex","justify-between","items-center","m-sm02"],[1,"flex","items-center","gap-md"],[1,"flex"],[1,"text-muted","text-sm"],[1,"text-sm","text-muted"],[1,"form-card"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"form-input",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],["value","free"],["value","reserved"],["value","occupied"],["type","text","placeholder","Numero o nome tavolo...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer",2,"margin","0","justify-content","space-between"],[1,"flex","gap-md"],[1,"icon-button",3,"click","disabled"],[1,"material-icons"],[1,"flex","items-center","gap-sm","px-md","py-sm","justify-center"],[1,"material-icons","text-sm"],[1,"font-semibold"],[1,"icon-button",3,"click"],[1,"promethea-button","primary",3,"click"],[1,"form-card","mt-lg",2,"overflow","auto"],["class","fullscreen-header",4,"ngIf"],[1,"flex","justify-between","items-center","mb-md","flex-wrap"],[1,"flex","items-center","gap-sm"],[1,"flex","gap-sm","mr-md"],[1,"legend-color","free"],[1,"text-sm"],[1,"legend-color","reserved"],[1,"legend-color","occupied"],[1,"canvas-container"],[1,"canvas-wrapper"],[1,"floor-plan-canvas"],[1,"grid-overlay"],["class","table-element",3,"class","ngStyle","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"table","mode","existingOrderHeader","saved","closeRequested",4,"ngIf"],[3,"table","mode","existingOrderHeader","closeRequested",4,"ngIf"],[3,"ngValue"],[1,"fullscreen-header"],[1,"font-bold","text-lg"],[1,"flex","items-center","gap-sm","bg-smoke","px-md","py-sm","rounded-full","min-w-32","justify-center"],[1,"form-input","text-sm",3,"ngModelChange","ngModel"],[1,"table-element",3,"click","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-details"],[1,"table-capacity"],["class","table-info",4,"ngIf"],[1,"table-info"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"header-icon"],[1,"p-lg"],[1,"flex","flex-col","gap-lg"],[1,"flex","justify-center"],[1,"chip"],["class","flex flex-col gap-sm",4,"ngIf"],[1,"flex","flex-col","gap-sm"],[1,"promethea-button",3,"click"],[1,"promethea-button","primary",3,"click","disabled","title"],[1,"promethea-button","success",3,"click","disabled"],[1,"promethea-button","ghost",3,"click"],[1,"modal-container","modal-md"],[1,"generic-form",3,"ngSubmit"],["type","text","name","customer_name","required","","placeholder","Inserisci il nome del cliente",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone","required","","placeholder","Inserisci il telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","date","name","reservation_date","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","time","name","reservation_time","required","",1,"form-input",3,"ngModelChange","ngModel"],["name","party_size","required","",1,"form-input",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"text-muted","mt-sm"],["name","special_requests","rows","3","placeholder","Note o richieste speciali...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[3,"value","disabled"],[1,"flex","justify-between","items-center","w-full"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],["type","button",1,"promethea-button","danger",3,"click"],[3,"saved","closeRequested","table","mode","existingOrderHeader"],[3,"closeRequested","table","mode","existingOrderHeader"]],template:function(e,n){if(e&1){let a=x();i(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),o(4,"brunch_dining"),r(),i(5,"h1",7),o(6,"Prenotazioni Tavoli"),r()(),i(7,"p",8),o(8,"Gestisci prenotazioni e ordini in tempo reale"),r()(),i(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"span",13),o(14,"event_available"),r(),i(15,"div",14),o(16,"Tavoli Liberi"),r()(),i(17,"div",15),o(18),r()()(),i(19,"div",10)(20,"div",11)(21,"div",12)(22,"span",13),o(23,"event"),r(),i(24,"div",14),o(25,"Prenotati"),r()(),i(26,"div",15),o(27),r()()(),i(28,"div",10)(29,"div",11)(30,"div",12)(31,"span",13),o(32,"restaurant"),r(),i(33,"div",14),o(34,"Occupati"),r()(),i(35,"div",15),o(36),r()()(),i(37,"div",10)(38,"div",11)(39,"div",12)(40,"span",13),o(41,"table_restaurant"),r(),i(42,"div",14),o(43,"Tavoli Totali"),r()(),i(44,"div",15),o(45),r()()()(),i(46,"div",16)(47,"div",17)(48,"div",18)(49,"div",19),o(50),r(),i(51,"div",20),o(52),r()(),i(53,"div",21),o(54," \u23F0 Si pu\xF2 ordinare 1h prima/dopo il turno "),r()()(),i(55,"div",22)(56,"div",23)(57,"div",24)(58,"label",25),o(59,"Mappa"),r(),i(60,"select",26),w("ngModelChange",function(f){return p(a),C(n.currentFloorPlan,f)||(n.currentFloorPlan=f),u(f)}),_("change",function(){return p(a),u(n.onFloorPlanSelect(n.currentFloorPlan))}),g(61,Bt,2,2,"option",27),r()(),i(62,"div",24)(63,"label",25),o(64,"Stato"),r(),i(65,"select",28),w("ngModelChange",function(f){return p(a),C(n.statusFilter,f)||(n.statusFilter=f),u(f)}),i(66,"option",29),o(67,"Tutti gli stati"),r(),i(68,"option",30),o(69,"Libero"),r(),i(70,"option",31),o(71,"Prenotato"),r(),i(72,"option",32),o(73,"Occupato"),r()()()(),i(74,"div",23)(75,"div",24)(76,"label",25),o(77,"Cerca"),r(),i(78,"input",33),w("ngModelChange",function(f){return p(a),C(n.searchTerm,f)||(n.searchTerm=f),u(f)}),r()(),i(79,"div",24)(80,"label",25),o(81,"Azioni"),r(),i(82,"div",34)(83,"div",35)(84,"button",36),_("click",function(){return p(a),u(n.zoomOut())}),i(85,"span",37),o(86,"zoom_out"),r()(),i(87,"div",38)(88,"span",39),o(89,"search"),r(),i(90,"span",40),o(91),r()(),i(92,"button",36),_("click",function(){return p(a),u(n.zoomIn())}),i(93,"span",37),o(94,"zoom_in"),r()(),i(95,"button",41),_("click",function(){return p(a),u(n.resetZoom())}),i(96,"span",37),o(97,"history"),r()()(),i(98,"button",42),_("click",function(){return p(a),u(n.loadInitialData())}),i(99,"span",37),o(100,"refresh"),r(),o(101," Aggiorna "),r()()()()(),i(102,"div",43,0),g(105,qt,23,6,"div",44),i(106,"div",45)(107,"h2",40),o(108),r(),i(109,"div",46)(110,"div",47)(111,"div",46),H(112,"div",48),i(113,"span",49),o(114,"Libero"),r()(),i(115,"div",46),H(116,"div",50),i(117,"span",49),o(118,"Prenotato"),r()(),i(119,"div",46),H(120,"div",51),i(121,"span",49),o(122,"Occupato"),r()()(),i(123,"button",41),_("click",function(){return p(a),u(n.safeToggleFullscreen())}),i(124,"span",37),o(125),r()(),i(126,"button",41),_("click",function(){return p(a),u(n.toggleSize())}),i(127,"span",37),o(128),r()()()(),i(129,"div",52)(130,"div",53)(131,"div",54,1),H(133,"div",55),g(134,Qt,11,9,"div",56)(135,$t,7,0,"div",57),r()()()(),g(136,Jt,21,7,"div",58)(137,Kt,52,11,"div",58)(138,ti,55,12,"div",58)(139,ii,1,3,"app-order-editor",59)(140,ni,1,3,"app-order-editor",60),r()}e&2&&(l(18),v(" ",n.getFreeTablesCount()," "),l(9),v(" ",n.getReservedTablesCount()," "),l(9),v(" ",n.getOccupiedTablesCount()," "),l(9),v(" ",n.getTotalTablesCount()," "),l(4),Q(n.getShiftStatusClass()),l(),v(" ",n.getShiftStatusText()," "),l(2),v(" ",n.orderingStatus.reason," "),l(8),b("ngModel",n.currentFloorPlan),l(),m("ngForOf",n.floorPlans),l(4),b("ngModel",n.statusFilter),l(13),b("ngModel",n.searchTerm),l(6),m("disabled",n.zoomLevel<=n.minZoom),l(7),v("",(n.zoomLevel*100).toFixed(0),"%"),l(),m("disabled",n.zoomLevel>=n.maxZoom),l(13),m("ngIf",n.isFullscreen),l(3),y(n.currentFloorPlan?n.currentFloorPlan.name:"Mappa"),l(15),R("active",n.isFullscreen),l(2),v(" ",n.isFullscreen?"fullscreen_exit":"fullscreen"," "),l(3),v(" ",n.isLargeText?"text_decrease":"text_increase"," "),l(2),W("width",n.getScaledWidth(),"px")("height",n.getScaledHeight(),"px"),l(),W("width",n.currentFloorPlan?n.currentFloorPlan.width:1e3,"px")("height",n.currentFloorPlan?n.currentFloorPlan.height:800,"px")("transform","scale("+n.zoomLevel+")")("transform-origin","0 0"),l(3),m("ngForOf",n.getFilteredTables()),l(),m("ngIf",n.getFilteredTables().length===0),l(),m("ngIf",n.showQuickActionsModal),l(),m("ngIf",n.showManualReservationModal),l(),m("ngIf",n.showEditReservationModal),l(),m("ngIf",n.showOrderEditorModal),l(),m("ngIf",n.showOrderEditorViewModal))},dependencies:[G,U,Z,we,ie,Ie,ee,te,J,X,Y,Oe,ke,K,Me,de],styles:[".fullscreen-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--background);padding:var(--gap-sm);display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;border-bottom:1px solid var(--smoke-1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);gap:var(--gap-sm)}.fullscreen-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin:0;flex:1;min-width:120px}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{position:absolute!important;inset:70px 0 0!important;height:auto!important;max-height:none!important;min-height:auto!important;border:none!important;margin-top:0!important;border-radius:0!important;padding:var(--gap-md)!important;overflow:auto!important;-webkit-overflow-scrolling:touch!important}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-wrapper[_ngcontent-%COMP%]{width:auto!important;height:auto!important}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{transform-origin:0 0!important}.canvas-container[_ngcontent-%COMP%]{position:relative;width:100%;min-height:400px;border:2px solid var(--smoke-1);border-radius:12px;background-color:var(--background);overflow:auto!important;-webkit-overflow-scrolling:touch!important;padding:var(--gap-sm);box-sizing:border-box}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;min-width:100%;min-height:100%}.floor-plan-canvas[_ngcontent-%COMP%]{position:relative;background-color:var(--background);box-shadow:0 4px 12px var(--smoke-1);border-radius:8px;transform-origin:0 0;transition:transform .2s ease-out}@media (max-width: 768px){.chip.active.ml-sm[_ngcontent-%COMP%]{display:none}.canvas-container[_ngcontent-%COMP%]{min-height:400px;max-height:80vh;overflow:auto!important;-webkit-overflow-scrolling:touch!important;touch-action:pan-x pan-y!important;display:block}}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{display:block!important;width:max-content!important;height:max-content!important;min-width:100%!important;min-height:100%!important;margin:auto!important;transform-origin:center center;transition:transform .2s ease-out;background:var(--background)}@media (max-width: 768px){.fullscreen-header[_ngcontent-%COMP%]{padding:var(--gap-sm)}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{top:80px}}.icon-button[disabled][_ngcontent-%COMP%]{opacity:.4;cursor:not-allowed}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex!important;gap:var(--gap-sm)!important;overflow-x:auto!important;padding-bottom:var(--gap-sm)!important;-webkit-overflow-scrolling:touch!important;scrollbar-width:none!important;flex-wrap:wrap}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none!important}.quick-action-button[_ngcontent-%COMP%]{display:flex!important;flex-direction:column!important;align-items:center!important;justify-content:center!important;padding:var(--gap-sm)!important;min-width:80px!important;border:1px solid var(--smoke-1)!important;border-radius:12px!important;background:var(--background)!important;transition:all .2s ease!important;cursor:pointer!important;flex-shrink:0!important}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button[_ngcontent-%COMP%]:active{background:var(--smoke-1)!important;border-color:var(--primary)!important}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin-bottom:4px!important}.mobile-scroll[_ngcontent-%COMP%]{overflow-y:auto;height:calc(100vh - 200px);max-height:500px;scroll-behavior:auto!important}.dish-card[_ngcontent-%COMP%]{min-height:120px;transition:none!important}.modal-container.modal-lg[_ngcontent-%COMP%]{max-height:90vh;display:flex;flex-direction:column}.modal-container.modal-lg[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{flex:1;overflow:hidden}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1)!important;border-radius:12px!important;padding:var(--gap-sm);background:var(--background);transition:none;cursor:pointer!important}.dish-card[_ngcontent-%COMP%]:hover, .dish-card[_ngcontent-%COMP%]:active{transform:translateY(-2px)!important;border-color:var(--primary)!important;box-shadow:0 4px 12px var(--smoke-2)!important}.dish-card.mobile-card[_ngcontent-%COMP%]{margin-bottom:var(--gap-sm)!important}.dish-name[_ngcontent-%COMP%]{font-weight:600!important;font-size:var(--fs-sm)!important;line-height:1.3!important;color:var(--text-color)!important}.dish-price[_ngcontent-%COMP%]{font-weight:700!important;font-size:var(--fs-sm)!important;color:var(--primary)!important}.bill-preview[_ngcontent-%COMP%]{background:var(--background);color:var(--text-color);max-height:70vh;overflow-y:auto;padding:var(--gap-lg)}.bill-preview[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:var(--gap-lg);padding-bottom:var(--gap-md);border-bottom:2px solid var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;margin-bottom:var(--gap-md);transition:all .3s ease}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]:hover{border-color:var(--secondary);box-shadow:0 4px 12px var(--smoke-2)}.bill-preview[_ngcontent-%COMP%]   .comanda-header[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;border-bottom:1px solid var(--smoke-1);padding-bottom:var(--gap-sm);margin-bottom:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:calc(var(--gap-sm) / 2) 0;border-bottom:1px dashed var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:last-child{border-bottom:none}.bill-preview[_ngcontent-%COMP%]   .comanda-total[_ngcontent-%COMP%]{color:var(--primary);font-weight:600;margin-top:var(--gap-sm);padding-top:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .header-total[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 10%,transparent);padding:var(--gap-sm);border-radius:8px;margin-top:var(--gap-md)}.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:var(--gradiente);color:#fff;padding:var(--gap-lg);border-radius:16px;margin-top:var(--gap-lg);box-shadow:0 8px 24px var(--shadow-2)}@media print{.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.modal-footer[_ngcontent-%COMP%]{display:none!important}}.canvas-wrapper[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.legend-color[_ngcontent-%COMP%]{width:var(--fs-md);height:var(--fs-sm);display:flex;border-radius:var(--gap-sm)}.legend-color.free[_ngcontent-%COMP%]{background:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.occupied[_ngcontent-%COMP%]{background:#ef4444}.legend-color.merged[_ngcontent-%COMP%]{background:#ff6b35}.detail[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm)}.table-suggestion-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm);padding:var(--gap-sm)}.table-suggestion-icon[_ngcontent-%COMP%]{font-size:var(--fs-md)}.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%}.table-card.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.overlay-disabled[_ngcontent-%COMP%]{position:absolute;inset:0;background:var(--background);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}"]})};export{qe as TableMap};
