import{a as Z}from"./chunk-OILXJW2J.js";import"./chunk-GO2X6ET2.js";import"./chunk-MTC3TSRZ.js";import{a as j,b as q,d as R,h as Y,j as U,q as G,r as Q,s as H,t as J,u as K,x as X}from"./chunk-XWCDBJ2K.js";import"./chunk-PMU7JIES.js";import{c as W,d as z,l as N}from"./chunk-COP7W333.js";import{B as P,C as T,Eb as w,Fb as B,Hb as L,Ib as a,Ja as c,Jb as x,Kb as b,Lb as V,Ob as v,Pb as _,Qb as h,Za as O,a as F,ba as I,cb as y,ga as D,h as f,kb as p,la as g,lb as o,ma as m,mb as n,nb as M,o as A,tb as C,wb as u,yb as s}from"./chunk-2FS7XGGJ.js";var E=class d extends Z{statsSubject=new A({total:0,active:0,inventoryValue:0,averagePrice:0,lowStockCount:0});stats$=this.statsSubject.asObservable();categoryInfoSubject=new A([]);categoryInfo$=this.categoryInfoSubject.asObservable();categoryConfigs={vino_rosso:{icon:"wine_bar",color:"#8B0000"},vino_bianco:{icon:"wine_bar",color:"#F5DEB3"},rosato:{icon:"wine_bar",color:"#FFB6C1"},spumante:{icon:"celebration",color:"#FFFACD"},prosecco:{icon:"celebration",color:"#FFF8DC"},champagne:{icon:"celebration",color:"#FFD700"},birra:{icon:"sports_bar",color:"#D2691E"},birra_chiara:{icon:"sports_bar",color:"#FFD700"},birra_scura:{icon:"sports_bar",color:"#8B4513"},birra_artigianale:{icon:"brewery",color:"#CD853F"},lager:{icon:"sports_bar",color:"#DAA520"},ale:{icon:"sports_bar",color:"#8B4513"},stout:{icon:"sports_bar",color:"#000000"},ipa:{icon:"brewery",color:"#FF8C00"},whisky:{icon:"liquor",color:"#8B4513"},vodka:{icon:"liquor",color:"#F0FFFF"},gin:{icon:"liquor",color:"#98FB98"},rum:{icon:"liquor",color:"#DAA520"},tequila:{icon:"liquor",color:"#FFD700"},brandy:{icon:"liquor",color:"#8B0000"},cognac:{icon:"liquor",color:"#A0522D"},cocktail:{icon:"local_cafe",color:"#FF6347"},aperitivo:{icon:"local_bar",color:"#FF4500"},digestivo:{icon:"local_bar",color:"#4B0082"},amaro:{icon:"local_bar",color:"#8B0000"},vermut:{icon:"wine_bar",color:"#800000"},analcolico:{icon:"water_drop",color:"#4682B4"},succo:{icon:"water_drop",color:"#FF6347"},bibita:{icon:"local_drink",color:"#32CD32"},acqua:{icon:"water_drop",color:"#1E90FF"},soda:{icon:"local_drink",color:"#F0F8FF"},caffe:{icon:"coffee",color:"#8B4513"},te:{icon:"coffee",color:"#228B22"},tisana:{icon:"coffee",color:"#D2B48C"},default:{icon:"local_bar",color:"#6B7280"}};beveragesWithCategories$=T([this.data$,this.categoryInfo$]).pipe(P(([t,e])=>(this.calculateStats(t),{beverages:t,categories:e})));getTableName(){return"beverages"}constructor(){super(),this.data$.subscribe(t=>{this.updateCategoriesFromBeverages(t)})}updateCategoriesFromBeverages(t){let e=new Map;t.forEach(r=>{if(r.category&&r.is_active){let l=r.category.toLowerCase().trim();if(!e.has(l)){let k=this.getCategoryConfig(l),ee=this.formatCategoryLabel(l);e.set(l,{value:l,label:ee,icon:k.icon,color:k.color,count:0})}let S=e.get(l);S.count++,e.set(l,S)}});let i=Array.from(e.values()).sort((r,l)=>r.label.localeCompare(l.label));this.categoryInfoSubject.next(i)}getCategoryConfig(t){if(this.categoryConfigs[t])return this.categoryConfigs[t];for(let e in this.categoryConfigs)if(t.includes(e))return this.categoryConfigs[e];return this.categoryConfigs.default}formatCategoryLabel(t){return t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}filterBeverages(t={}){let e=this.data;if(t.category&&(e=e.filter(i=>i.category===t.category)),t.search){let i=t.search.toLowerCase();e=e.filter(r=>r.name.toLowerCase().includes(i)||r.producer?.toLowerCase().includes(i)||r.region?.toLowerCase().includes(i)||r.description?.toLowerCase().includes(i))}return t.minPrice!==void 0&&(e=e.filter(i=>i.price>=t.minPrice)),t.maxPrice!==void 0&&(e=e.filter(i=>i.price<=t.maxPrice)),t.inStock!==void 0&&(e=e.filter(i=>t.inStock?i.current_stock>0:i.current_stock===0)),e}sortBeverages(t,e){let i=[...t];switch(e){case"name":return i.sort((r,l)=>r.name.localeCompare(l.name));case"price_asc":return i.sort((r,l)=>r.price-l.price);case"price_desc":return i.sort((r,l)=>l.price-r.price);case"stock":return i.sort((r,l)=>l.current_stock-r.current_stock);default:return i}}updateStock(t,e){return f(this,null,function*(){let i=this.data.find(l=>l.id===t);if(!i)return!1;let r=Math.max(0,i.current_stock+e);return yield this.update(t,{current_stock:r,is_available:r>0,to_buy:r<=i.minimum_stock,updated_at:new Date().toISOString()})})}createBeverage(t){return f(this,null,function*(){return t.category&&(t.category=t.category.toLowerCase().trim()),yield this.create(t)})}calculateStats(t){let e={total:t.length,active:t.filter(i=>i.is_active).length,inventoryValue:t.reduce((i,r)=>i+r.cost_per_unit*r.current_stock,0),averagePrice:t.length>0?t.reduce((i,r)=>i+r.price,0)/t.length:0,lowStockCount:t.filter(i=>i.current_stock<=i.minimum_stock).length};this.statsSubject.next(e)}countBeveragesByCategory(t){return t.reduce((e,i)=>(i.category&&(e[i.category]=(e[i.category]||0)+1),e),{})}getBeveragesByCategory(){let t=new Map;return this.data.forEach(e=>{e.category&&(t.has(e.category)||t.set(e.category,[]),t.get(e.category).push(e))}),t}getLowStockBeverages(){return this.data.filter(t=>t.current_stock<=t.minimum_stock&&t.is_active&&t.is_available)}canDeleteCategory(t){return!this.data.some(e=>e.category===t)}addCustomCategoryConfig(t,e,i){this.categoryConfigs[t.toLowerCase()]={icon:e,color:i},this.updateCategoriesFromBeverages(this.data)}getCategoryConfigs(){return F({},this.categoryConfigs)}static \u0275fac=function(e){return new(e||d)};static \u0275prov=I({token:d,factory:d.\u0275fac,providedIn:"root"})};function ie(d,t){if(d&1&&(o(0,"option",41),a(1),n()),d&2){let e=t.$implicit;p("value",e.value),c(),V(" ",e.label," (",e.count,") ")}}function re(d,t){d&1&&(o(0,"tr")(1,"td",42)(2,"div",43)(3,"span",44),a(4,"refresh"),n(),o(5,"span"),a(6,"Caricamento bevande..."),n()()()())}function oe(d,t){if(d&1&&(o(0,"div",68),a(1),n()),d&2){let e=s().$implicit;c(),b(" ",e.description," ")}}function ne(d,t){if(d&1&&(o(0,"div",69),a(1),n()),d&2){let e=s().$implicit,i=s();c(),b(" Costo: \u20AC",i.formatPrice(e.cost_per_unit)," ")}}function ae(d,t){if(d&1){let e=C();o(0,"tr",45)(1,"td")(2,"div",46)(3,"div",47)(4,"span",48),a(5),n()(),o(6,"div")(7,"strong"),a(8),n(),y(9,oe,2,1,"div",49),n()()(),o(10,"td")(11,"span",50)(12,"span",51),a(13),n(),a(14),n()(),o(15,"td")(16,"span",6),a(17),n()(),o(18,"td")(19,"span",6),a(20),n()(),o(21,"td")(22,"span",6),a(23),n()(),o(24,"td")(25,"div")(26,"strong",52),a(27),n(),y(28,ne,2,1,"div",53),n()(),o(29,"td")(30,"div",54)(31,"div",55)(32,"div",56)(33,"div",57),M(34,"div",58),n()(),o(35,"span"),a(36),n()(),o(37,"div",59),a(38),n()()(),o(39,"td")(40,"span",60),a(41),n()(),o(42,"td")(43,"div",61)(44,"div",62)(45,"button",63),u("click",function(){let r=g(e).$implicit,l=s();return m(l.updateStock(r.id,-1))}),o(46,"span",48),a(47,"remove"),n()(),o(48,"span",64),a(49),n(),o(50,"button",65),u("click",function(){let r=g(e).$implicit,l=s();return m(l.updateStock(r.id,1))}),o(51,"span",48),a(52,"add"),n()()(),o(53,"button",66),u("click",function(){let r=g(e).$implicit,l=s();return m(l.editBeverage(r))}),o(54,"span",48),a(55,"edit"),n()(),o(56,"button",67),u("click",function(){let r=g(e).$implicit,l=s();return m(l.deleteBeverage(r.id))}),o(57,"span",48),a(58,"delete"),n()()()()()}if(d&2){let e=t.$implicit,i=s();B("bg-red-50",e.current_stock<=e.minimum_stock)("bg-green-50",e.current_stock>e.minimum_stock*2),c(3),w("background-color",i.getCategoryColor(e.category)+"20"),c(),w("color",i.getCategoryColor(e.category)),c(),b(" ",i.getCategoryIcon(e.category)," "),c(3),x(e.name),c(),p("ngIf",e.description),c(2),w("background-color",i.getCategoryColor(e.category)),c(2),b(" ",i.getCategoryIcon(e.category)," "),c(),b(" ",i.getCategoryLabel(e.category)," "),c(3),x(e.producer||"N/D"),c(3),x(e.region||"N/D"),c(3),x(e.vintage||"-"),c(4),b("\u20AC",i.formatPrice(e.price)),c(),p("ngIf",e.cost_per_unit>0),c(6),w("width",i.getStockPercentage(e)+"%")("background-color",i.getStockColor(e)),c(),B("text-red-500",e.current_stock<=e.minimum_stock)("font-bold",e.current_stock<=e.minimum_stock),c(),b(" ",e.current_stock," "),c(2),V(" ",e.bottle_format||"pz"," / min: ",e.minimum_stock," "),c(2),L(i.getStockStatus(e).class),c(),b(" ",i.getStockStatus(e).text," "),c(4),p("disabled",e.current_stock<=0),c(4),x(e.current_stock)}}function le(d,t){d&1&&(o(0,"p",6),a(1," Prova a modificare i filtri di ricerca "),n())}function ce(d,t){if(d&1&&(o(0,"tr")(1,"td",70)(2,"div",71)(3,"span",72),a(4,"wine_bar"),n(),o(5,"h3"),a(6,"Nessuna bevanda trovata"),n(),y(7,le,2,0,"p",73),n()()()),d&2){let e=s();c(7),p("ngIf",e.searchTerm||e.selectedCategory||e.showLowStockOnly||e.showAvailableOnly)}}function se(d,t){if(d&1&&(o(0,"option",41),a(1),n()),d&2){let e=t.$implicit;p("value",e.value),c(),b(" ",e.label," ")}}function de(d,t){if(d&1){let e=C();o(0,"div",74),u("click",function(){g(e);let r=s();return m(r.closeBeverageModal())}),o(1,"div",75),u("click",function(r){return g(e),m(r.stopPropagation())}),o(2,"div",76)(3,"div",77)(4,"div",78)(5,"span",19),a(6),n()(),o(7,"div")(8,"h1",5),a(9),n()()(),o(10,"button",79),u("click",function(){g(e);let r=s();return m(r.closeBeverageModal())}),o(11,"span",19),a(12,"close"),n()()(),o(13,"div",80)(14,"div",81)(15,"div",82)(16,"label",18),a(17,"Nome Bevanda *"),n(),o(18,"input",83),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.name,r)||(l.beverageForm.name=r),m(r)}),n()(),o(19,"div",82)(20,"label",18),a(21,"Categoria *"),n(),o(22,"select",84),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.category,r)||(l.beverageForm.category=r),m(r)}),o(23,"option",22),a(24,"Seleziona categoria"),n(),y(25,se,2,2,"option",23),n()()(),o(26,"div",85)(27,"div",82)(28,"label",18),a(29,"Produttore"),n(),o(30,"input",86),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.producer,r)||(l.beverageForm.producer=r),m(r)}),n()(),o(31,"div",82)(32,"label",18),a(33,"Regione/Paese"),n(),o(34,"input",87),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.region,r)||(l.beverageForm.region=r),m(r)}),n()()(),o(35,"div",85)(36,"div",82)(37,"label",18),a(38,"Prezzo di vendita (\u20AC) *"),n(),o(39,"input",88),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.price,r)||(l.beverageForm.price=r),m(r)}),n()(),o(40,"div",82)(41,"label",18),a(42,"Costo unitario (\u20AC)"),n(),o(43,"input",88),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.cost_per_unit,r)||(l.beverageForm.cost_per_unit=r),m(r)}),n()()(),o(44,"div",85)(45,"div",82)(46,"label",18),a(47,"Stock attuale"),n(),o(48,"input",89),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.current_stock,r)||(l.beverageForm.current_stock=r),m(r)}),n()(),o(49,"div",82)(50,"label",18),a(51,"Stock minimo"),n(),o(52,"input",89),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.minimum_stock,r)||(l.beverageForm.minimum_stock=r),m(r)}),n()()(),o(53,"div",90)(54,"div",82)(55,"label",18),a(56,"Annata"),n(),o(57,"input",91),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.vintage,r)||(l.beverageForm.vintage=r),m(r)}),n()(),o(58,"div",82)(59,"label",18),a(60,"Gradazione (%)"),n(),o(61,"input",92),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.alcohol_percentage,r)||(l.beverageForm.alcohol_percentage=r),m(r)}),n()(),o(62,"div",82)(63,"label",18),a(64,"Formato"),n(),o(65,"input",93),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.bottle_format,r)||(l.beverageForm.bottle_format=r),m(r)}),n()()(),o(66,"div",94)(67,"label",18),a(68,"Descrizione"),n(),o(69,"textarea",95),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.description,r)||(l.beverageForm.description=r),m(r)}),n()(),o(70,"div",90)(71,"label",29)(72,"input",96),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.is_active,r)||(l.beverageForm.is_active=r),m(r)}),n(),o(73,"span"),a(74,"Attivo"),n()(),o(75,"label",29)(76,"input",96),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.is_available,r)||(l.beverageForm.is_available=r),m(r)}),n(),o(77,"span"),a(78,"Disponibile"),n()(),o(79,"label",29)(80,"input",96),h("ngModelChange",function(r){g(e);let l=s();return _(l.beverageForm.display_in_menu,r)||(l.beverageForm.display_in_menu=r),m(r)}),n(),o(81,"span"),a(82,"In menu"),n()()()(),o(83,"div",97)(84,"button",98),u("click",function(){g(e);let r=s();return m(r.closeBeverageModal())}),a(85," Annulla "),n(),o(86,"button",99),u("click",function(){g(e);let r=s();return m(r.showEditModal?r.updateBeverage():r.addBeverage())}),o(87,"span",19),a(88,"check"),n(),a(89),n()()()()}if(d&2){let e=s();c(6),x(e.showEditModal?"edit":"add_circle"),c(3),b("",e.showEditModal?"Modifica":"Nuova"," Bevanda"),c(9),v("ngModel",e.beverageForm.name),c(4),v("ngModel",e.beverageForm.category),c(3),p("ngForOf",e.categories),c(5),v("ngModel",e.beverageForm.producer),c(4),v("ngModel",e.beverageForm.region),c(5),v("ngModel",e.beverageForm.price),c(4),v("ngModel",e.beverageForm.cost_per_unit),c(5),v("ngModel",e.beverageForm.current_stock),c(4),v("ngModel",e.beverageForm.minimum_stock),c(5),v("ngModel",e.beverageForm.vintage),p("max",e.currentYear),c(4),v("ngModel",e.beverageForm.alcohol_percentage),c(4),v("ngModel",e.beverageForm.bottle_format),c(4),v("ngModel",e.beverageForm.description),c(3),v("ngModel",e.beverageForm.is_active),c(4),v("ngModel",e.beverageForm.is_available),c(4),v("ngModel",e.beverageForm.display_in_menu),c(9),b(" ",e.showEditModal?"Aggiorna":"Crea"," Bevanda ")}}function ge(d,t){if(d&1){let e=C();o(0,"button",107),u("click",function(){let r=g(e).$implicit,l=s(2);return m(l.categoryForm.icon=r)}),o(1,"span",19),a(2),n()()}if(d&2){let e=t.$implicit,i=s(2);B("selected",i.categoryForm.icon===e),p("title",e),c(2),x(e)}}function me(d,t){if(d&1){let e=C();o(0,"button",108),u("click",function(){let r=g(e).$implicit,l=s(2);return m(l.categoryForm.color=r)}),n()}if(d&2){let e=t.$implicit,i=s(2);w("background-color",e),B("selected",i.categoryForm.color===e),p("title",e)}}function ue(d,t){if(d&1){let e=C();o(0,"div",74),u("click",function(){g(e);let r=s();return m(r.showAddCategoryModal=!1)}),o(1,"div",100),u("click",function(r){return g(e),m(r.stopPropagation())}),o(2,"div",76)(3,"div",77)(4,"div",78)(5,"span",19),a(6,"add_circle"),n()(),o(7,"div")(8,"h1",5),a(9,"Nuova Categoria"),n()()(),o(10,"button",79),u("click",function(){g(e);let r=s();return m(r.showAddCategoryModal=!1)}),o(11,"span",19),a(12,"close"),n()()(),o(13,"div",80)(14,"div",82)(15,"label",18),a(16,"Nome Categoria *"),n(),o(17,"input",101),h("ngModelChange",function(r){g(e);let l=s();return _(l.categoryForm.name,r)||(l.categoryForm.name=r),m(r)}),u("input",function(){g(e);let r=s();return m(r.generateCategoryValue())}),n()(),o(18,"div",82)(19,"label",18),a(20,"Valore (automatico)"),n(),o(21,"input",102),h("ngModelChange",function(r){g(e);let l=s();return _(l.categoryForm.value,r)||(l.categoryForm.value=r),m(r)}),n(),o(22,"small",6),a(23,"Usato internamente per identificare la categoria"),n()(),o(24,"div",82)(25,"label",18),a(26,"Icona"),n(),o(27,"div",103),y(28,ge,3,4,"button",104),n()(),o(29,"div",82)(30,"label",18),a(31,"Colore"),n(),o(32,"div",105),y(33,me,1,5,"button",106),n()()(),o(34,"div",97)(35,"button",98),u("click",function(){g(e);let r=s();return m(r.showAddCategoryModal=!1)}),a(36," Annulla "),n(),o(37,"button",99),u("click",function(){g(e);let r=s();return m(r.addCategory())}),o(38,"span",19),a(39,"check"),n(),a(40," Crea Categoria "),n()()()()}if(d&2){let e=s();c(17),v("ngModel",e.categoryForm.name),c(4),v("ngModel",e.categoryForm.value),c(7),p("ngForOf",e.availableIcons),c(5),p("ngForOf",e.availableColors)}}function pe(d,t){if(d&1){let e=C();o(0,"div",74),u("click",function(){g(e);let r=s();return m(r.showConfirmModal=!1)}),o(1,"div",109),u("click",function(r){return g(e),m(r.stopPropagation())}),o(2,"div",110)(3,"span",111),a(4,"warning"),n(),o(5,"h3",112),a(6,"Conferma eliminazione"),n(),o(7,"p",113),a(8,"Sei sicuro di voler eliminare questa bevanda?"),M(9,"br"),a(10,"L'azione non pu\xF2 essere annullata."),n()(),o(11,"div",97)(12,"button",98),u("click",function(){g(e);let r=s();return m(r.showConfirmModal=!1)}),a(13," Annulla "),n(),o(14,"button",114),u("click",function(){g(e);let r=s();return m(r.confirmDelete())}),o(15,"span",19),a(16,"delete"),n(),a(17," Elimina "),n()()()()}}var $=class d{beverageService=D(E);subscriptions=[];allBeverages=[];filteredBeverages=[];categories=[];totalProducts=0;activeProducts=0;inventoryValue=0;averagePrice=0;lowStockCount=0;topRatedCount=0;searchTerm="";selectedCategory="";sortBy="name";showAvailableOnly=!1;showLowStockOnly=!1;isLoading=!0;showAddModal=!1;showEditModal=!1;showAddCategoryModal=!1;showConfirmModal=!1;beverageForm=this.getEmptyBeverageForm();categoryForm={name:"",value:"",icon:"local_bar",color:"#6B7280"};currentYear=new Date().getFullYear();beverageToDeleteId=null;editingBeverage=null;availableIcons=["wine_bar","local_bar","sports_bar","liquor","local_cafe","restaurant","celebration","emoji_food_beverage","local_drink","water_drop","coffee","brewery","grain","agriculture"];availableColors=["#8B0000","#B22222","#DC143C","#FF0000","#FF6347","#FF4500","#FF8C00","#FFA500","#FFD700","#F0E68C","#9ACD32","#32CD32","#006400","#008080","#20B2AA","#4682B4","#1E90FF","#0000FF","#00008B","#4B0082","#483D8B","#8B008B","#800080","#8B0A50","#C71585","#FF1493","#FF69B4","#FFB6C1","#A0522D","#8B4513","#D2691E","#CD853F","#F4A460","#DAA520","#B8860B","#696969"];ngOnInit(){this.loadData(),this.subscribeToData()}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}subscribeToData(){let t=this.beverageService.beveragesWithCategories$.subscribe(({beverages:i,categories:r})=>{this.allBeverages=i,this.categories=r,this.updateStatistics(),this.applyFilters(),this.isLoading=!1},i=>{console.error("Error loading beverages:",i),this.isLoading=!1}),e=this.beverageService.stats$.subscribe(i=>{i&&(this.totalProducts=i.total,this.activeProducts=i.active,this.inventoryValue=i.inventoryValue,this.averagePrice=i.averagePrice,this.lowStockCount=i.lowStockCount)});this.subscriptions.push(t,e)}createDefaultCategories(t){let e=[...new Set(t.map(l=>l.category).filter(Boolean))],i=["#8B0000","#F5DEB3","#D2691E","#FF6347","#8B4513","#FFFACD"],r=["wine_bar","sports_bar","local_cafe","liquor","celebration","local_bar"];this.categories=e.map((l,S)=>({value:l,label:l.charAt(0).toUpperCase()+l.slice(1).replace(/_/g," "),icon:r[S%r.length],color:i[S%i.length],count:t.filter(k=>k.category===l).length})),this.categories.length===0&&(this.categories=[{value:"vino_rosso",label:"Vino Rosso",icon:"wine_bar",color:"#8B0000",count:0},{value:"vino_bianco",label:"Vino Bianco",icon:"wine_bar",color:"#F5DEB3",count:0},{value:"birra",label:"Birra",icon:"sports_bar",color:"#D2691E",count:0},{value:"cocktail",label:"Cocktail",icon:"local_cafe",color:"#FF6347",count:0},{value:"distillati",label:"Distillati",icon:"liquor",color:"#8B4513",count:0},{value:"spumante",label:"Spumante",icon:"celebration",color:"#FFFACD",count:0}])}loadData(){this.isLoading=!0,this.beverageService.loadData()}onSearchChange(t){this.searchTerm=t,this.applyFilters()}onCategoryFilterChange(t){this.selectedCategory=t,this.applyFilters()}onSortChange(t){this.sortBy=t,this.applyFilters()}toggleAvailableFilter(){this.showAvailableOnly=!this.showAvailableOnly,this.applyFilters()}toggleLowStockFilter(){this.showLowStockOnly=!this.showLowStockOnly,this.applyFilters()}applyFilters(){let t=[...this.allBeverages];if(this.searchTerm.trim()){let e=this.searchTerm.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(e)||i.producer?.toLowerCase().includes(e)||i.region?.toLowerCase().includes(e)||i.description?.toLowerCase().includes(e))}this.selectedCategory&&(t=t.filter(e=>e.category===this.selectedCategory)),this.showAvailableOnly&&(t=t.filter(e=>e.is_available&&e.current_stock>0)),this.showLowStockOnly&&(t=t.filter(e=>e.current_stock<=e.minimum_stock)),this.filteredBeverages=this.beverageService.sortBeverages(t,this.sortBy)}getEmptyBeverageForm(){return{name:"",category:this.categories[0]?.value||"",price:0,cost_per_unit:0,current_stock:0,minimum_stock:10,alcohol_percentage:13,bottle_format:"750ml",is_active:!0,is_available:!0,display_in_menu:!0,alert_enabled:!0,to_buy:!1,menu_position:0}}createBeverage(){return f(this,null,function*(){if(this.validateBeverageForm()){this.beverageForm.category&&(this.beverageForm.category=this.beverageForm.category.toLowerCase().trim());try{(yield this.beverageService.createBeverage(this.beverageForm))?(this.showAddModal=!1,this.resetBeverageForm()):alert("Errore nella creazione della bevanda")}catch(t){console.error("Error adding beverage:",t),alert("Errore nella creazione della bevanda")}}})}addBeverage(){return f(this,null,function*(){if(this.validateBeverageForm())try{(yield this.beverageService.createBeverage(this.beverageForm))?(this.showAddModal=!1,this.resetBeverageForm()):alert("Errore nella creazione della bevanda. Verifica che la categoria esista.")}catch(t){console.error("Error adding beverage:",t),alert("Errore nella creazione della bevanda")}})}editBeverage(t){this.editingBeverage=t,this.beverageForm=F({},t),this.showEditModal=!0}updateBeverage(){return f(this,null,function*(){if(!(!this.validateBeverageForm()||!this.editingBeverage))try{(yield this.beverageService.update(this.editingBeverage.id,this.beverageForm))?(this.showEditModal=!1,this.resetBeverageForm()):alert("Errore nell'aggiornamento della bevanda")}catch(t){console.error("Error updating beverage:",t),alert("Errore nell'aggiornamento della bevanda")}})}deleteBeverage(t){this.beverageToDeleteId=t,this.showConfirmModal=!0}confirmDelete(){return f(this,null,function*(){if(this.beverageToDeleteId)try{(yield this.beverageService.delete(this.beverageToDeleteId))?(this.showConfirmModal=!1,this.beverageToDeleteId=null):alert("Errore nell'eliminazione della bevanda")}catch(t){console.error("Error deleting beverage:",t),alert("Errore nell'eliminazione della bevanda")}})}addCategory(){return f(this,null,function*(){if(!this.categoryForm.name.trim()){alert("Inserisci un nome per la categoria");return}this.categoryForm.value.trim()||this.generateCategoryValue();let t=this.categoryForm.value.toLowerCase().trim();if(this.allBeverages.some(i=>i.category===t)){alert("Questa categoria \xE8 gi\xE0 in uso nelle bevande!");return}this.beverageService.addCustomCategoryConfig(t,this.categoryForm.icon,this.categoryForm.color);let e={value:t,label:this.categoryForm.name,icon:this.categoryForm.icon,color:this.categoryForm.color,count:0};this.categories.push(e),this.categories.sort((i,r)=>i.label.localeCompare(r.label)),this.showAddCategoryModal=!1,this.resetCategoryForm(),console.log("Nuova categoria aggiunta:",e),alert("Categoria aggiunta con successo! Ora puoi usarla per nuove bevande.")})}updateStock(t,e){return f(this,null,function*(){try{yield this.beverageService.updateStock(t,e)}catch(i){console.error("Error updating stock:",i),alert("Errore nell'aggiornamento dello stock")}})}generateCategoryValue(){this.categoryForm.name.trim()&&(this.categoryForm.value=this.categoryForm.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").replace(/\s+/g,"_").replace(/_{2,}/g,"_").replace(/^_|_$/g,""))}validateBeverageForm(){return this.beverageForm.name?.trim()?this.beverageForm.category?!this.beverageForm.price||this.beverageForm.price<=0?(alert("Inserisci un prezzo valido"),!1):!0:(alert("Seleziona una categoria"),!1):(alert("Il nome della bevanda \xE8 obbligatorio"),!1)}resetBeverageForm(){this.beverageForm=this.getEmptyBeverageForm(),this.editingBeverage=null}resetCategoryForm(){this.categoryForm={name:"",value:"",icon:"local_bar",color:"#6B7280"}}closeBeverageModal(){this.showAddModal=!1,this.showEditModal=!1,this.resetBeverageForm()}getCategoryLabel(t){return this.categories.find(i=>i.value===t)?.label||t}getCategoryIcon(t){return this.categories.find(i=>i.value===t)?.icon||"local_bar"}getCategoryColor(t){return this.categories.find(i=>i.value===t)?.color||"#6B7280"}getStockColor(t){return t.current_stock===0?"#FF6B6B":t.current_stock<=t.minimum_stock?"#FFA726":"#4CAF50"}getStockPercentage(t){let e=Math.max(t.current_stock,t.minimum_stock*2);return Math.min(t.current_stock/e*100,100)}getStockStatus(t){return t.current_stock===0?{class:"chip-error",text:"Esaurito"}:t.current_stock<=t.minimum_stock?{class:"chip-warning",text:"Scorta bassa"}:{class:"chip-success",text:"Disponibile"}}formatPrice(t){return t.toFixed(2).replace(".",",")}formatNumber(t){return t.toFixed(2).replace(".",",")}updateStatistics(){this.totalProducts=this.allBeverages.length,this.activeProducts=this.allBeverages.filter(t=>t.is_active).length,this.inventoryValue=this.allBeverages.reduce((t,e)=>t+e.cost_per_unit*e.current_stock,0),this.averagePrice=this.allBeverages.length>0?this.allBeverages.reduce((t,e)=>t+e.price,0)/this.allBeverages.length:0,this.lowStockCount=this.allBeverages.filter(t=>t.current_stock<=t.minimum_stock).length,this.topRatedCount=this.allBeverages.filter(t=>t.rating&&t.rating>=4).length}getTopRatedCount(){return this.topRatedCount}static \u0275fac=function(e){return new(e||d)};static \u0275cmp=O({type:d,selectors:[["app-alcoholic-beverages"]],decls:133,vars:19,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm","items-center","justify-between"],[1,"flex","gap-sm","items-center"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"card-footer","text-muted"],[1,"form-card","mt-lg"],[1,"flex","flex-col","md:flex-row","justify-between","items-start"],[1,"form-row"],[1,"form-group","mb-lg"],[1,"standard-label"],[1,"material-icons"],["type","text","placeholder","Cerca per nome, produttore, regione...",3,"input","value"],[3,"change","value"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","name"],["value","price_asc"],["value","price_desc"],["value","stock"],[1,"form-group",2,"justify-content","center"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"checkbox-content"],[1,"modal-footer","p-md0"],[1,"promethea-button",3,"click"],[1,"promethea-button","ghost",3,"click"],[1,"mt-lg","bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"table-section"],[1,"crm-table"],[4,"ngIf"],["class","beverage-row",3,"bg-red-50","bg-green-50",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value"],["colspan","9",1,"text-center","p-xl"],[1,"flex","flex-col","items-center","justify-center","gap-md"],[1,"material-icons","animate-spin"],[1,"beverage-row"],[1,"flex","items-center","gap-sm"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center"],[1,"material-icons","text-sm"],["class","text-xs text-muted truncate max-w-xs",4,"ngIf"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",2,"color","white"],[1,"material-icons","text-xs","mr-1"],[1,"text-primary"],["class","text-xs text-muted",4,"ngIf"],[1,"flex","flex-col"],[1,"flex","items-center","gap-2"],[1,"w-20"],[1,"h-2","bg-gray-200","rounded-full","overflow-hidden"],[1,"h-full","rounded-full","transition-all"],[1,"text-xs","text-muted","mt-1"],[1,"chip"],[1,"flex","gap-1"],[1,"flex","items-center","border","rounded-lg","overflow-hidden"],["title","Diminuisci stock",1,"p-1","hover:bg-gray-100","disabled:opacity-50",3,"click","disabled"],[1,"px-2","text-xs"],["title","Aumenta stock",1,"p-1","hover:bg-gray-100",3,"click"],["title","Modifica",1,"icon-button","x-small",3,"click"],["title","Elimina",1,"icon-button","x-small","danger",3,"click"],[1,"text-xs","text-muted","truncate","max-w-xs"],[1,"text-xs","text-muted"],["colspan","9",1,"empty-state-row"],[1,"empty-state","mb-lg"],[1,"material-icons","text-4xl","text-gray-300","mb-4"],["class","text-muted",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"flex"],[1,"header-icon"],[1,"icon-button",3,"click"],[1,"form-card"],[1,"grid","grid-cols-2","gap-md"],[1,"form-group"],["type","text","placeholder","Es: Chianti Classico",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-input",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-2","gap-md","mt-sm"],["type","text","placeholder","Nome produttore",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","Es: Toscana, Italia",1,"form-input",3,"ngModelChange","ngModel"],["type","number","step","0.01","min","0",1,"form-input",3,"ngModelChange","ngModel"],["type","number","min","0",1,"form-input",3,"ngModelChange","ngModel"],[1,"grid","grid-cols-3","gap-md","mt-sm"],["type","number","min","1900",1,"form-input",3,"ngModelChange","ngModel","max"],["type","number","step","0.1","min","0","max","100",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","Es: 750ml, 1L",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-group","mt-sm"],["rows","2","placeholder","Note di degustazione, abbinamenti...",1,"form-input",3,"ngModelChange","ngModel"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"promethea-button","ghost","flex-1",3,"click"],[1,"promethea-button","primary","flex-1",3,"click"],[1,"modal-container","modal-sm",3,"click"],["type","text","placeholder","Es: Superalcolici, Analcolici, ecc.","autofocus","",1,"form-input",3,"ngModelChange","input","ngModel"],["type","text","placeholder","Verr\xE0 generato automaticamente","readonly","",1,"form-input",3,"ngModelChange","ngModel"],[1,"icon-grid"],["class","icon-grid-button",3,"selected","title","click",4,"ngFor","ngForOf"],[1,"color-grid"],["class","color-grid-button",3,"background-color","selected","title","click",4,"ngFor","ngForOf"],[1,"icon-grid-button",3,"click","title"],[1,"color-grid-button",3,"click","title"],[1,"modal-container","modal-xs",3,"click"],[1,"modal-body","text-center"],[1,"material-icons","text-4xl","text-red-500","mb-sm"],[1,"text-md","font-bold","mb-sm"],[1,"text-muted","mb-md"],[1,"promethea-button","danger","flex-1",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),a(5,"wine_bar"),n(),o(6,"h1",5),a(7,"Alcolici"),n()()(),o(8,"p",6),a(9,"Gestisci la tua selezione di vini, birre e bevande speciali"),n()(),o(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",10),a(14,"inventory"),n(),o(15,"h3",11),a(16,"Prodotti Totali"),n()(),o(17,"div",12),a(18),n(),o(19,"div",13),a(20),n()(),o(21,"div",8)(22,"div",9)(23,"span",10),a(24,"euro"),n(),o(25,"h3",11),a(26,"Valore Inventario"),n()(),o(27,"div",12),a(28),n(),o(29,"div",13),a(30),n()(),o(31,"div",8)(32,"div",9)(33,"span",10),a(34,"trending_up"),n(),o(35,"h3",11),a(36,"Top Rating"),n()(),o(37,"div",12),a(38),n(),o(39,"div",13),a(40,"Prodotti con rating \u2265 4"),n()(),o(41,"div",8)(42,"div",9)(43,"span",10),a(44,"warning"),n(),o(45,"h3",11),a(46,"Scorte Basse"),n()(),o(47,"div",12),a(48),n(),o(49,"div",13),a(50),n()()(),o(51,"div",14)(52,"div",15)(53,"div",16)(54,"div",17)(55,"label",18)(56,"span",19),a(57,"search"),n(),a(58," Cerca Prodotto "),n(),o(59,"input",20),u("input",function(l){return i.onSearchChange(l.target.value)}),n()(),o(60,"div",17)(61,"label",18)(62,"span",19),a(63,"category"),n(),a(64," Filtra per Categoria "),n(),o(65,"select",21),u("change",function(l){return i.onCategoryFilterChange(l.target.value)}),o(66,"option",22),a(67,"Tutte le categorie"),n(),y(68,ie,2,3,"option",23),n()(),o(69,"div",17)(70,"label",18)(71,"span",19),a(72,"sort"),n(),a(73," Ordina per "),n(),o(74,"select",21),u("change",function(l){return i.onSortChange(l.target.value)}),o(75,"option",24),a(76,"Nome"),n(),o(77,"option",25),a(78,"Prezzo crescente"),n(),o(79,"option",26),a(80,"Prezzo decrescente"),n(),o(81,"option",27),a(82,"Disponibilit\xE0"),n()()()(),o(83,"div",16)(84,"div",28)(85,"label",29)(86,"input",30),u("change",function(){return i.toggleAvailableFilter()}),n(),o(87,"div",31),a(88,"Mostra solo disponibili "),n()()(),o(89,"div",28)(90,"label",29)(91,"input",30),u("change",function(){return i.toggleLowStockFilter()}),n(),o(92,"div",31),a(93,"Mostra solo scorte basse "),n()()()(),o(94,"div",32)(95,"button",33),u("click",function(){return i.showAddModal=!0}),o(96,"span",19),a(97,"add"),n(),a(98," Nuova Bevanda "),n(),o(99,"button",34),u("click",function(){return i.showAddCategoryModal=!0}),o(100,"span",19),a(101,"add_circle"),n(),a(102," Aggiungi Categoria "),n()()()(),o(103,"div",35)(104,"div",36)(105,"table",37)(106,"thead")(107,"tr")(108,"th"),a(109,"Prodotto"),n(),o(110,"th"),a(111,"Categoria"),n(),o(112,"th"),a(113,"Produttore"),n(),o(114,"th"),a(115,"Regione"),n(),o(116,"th"),a(117,"Annata"),n(),o(118,"th"),a(119,"Prezzo"),n(),o(120,"th"),a(121,"Stock"),n(),o(122,"th"),a(123,"Stato"),n(),o(124,"th"),a(125,"Azioni"),n()()(),o(126,"tbody"),y(127,re,7,0,"tr",38)(128,ae,59,36,"tr",39)(129,ce,8,1,"tr",38),n()()()()(),y(130,de,90,20,"div",40)(131,ue,41,4,"div",40)(132,pe,18,0,"div",40)),e&2&&(c(18),x(i.totalProducts),c(2),b("",i.activeProducts," attivi"),c(8),b("\u20AC",i.formatNumber(i.inventoryValue)),c(2),b("Costo medio: \u20AC",i.formatNumber(i.averagePrice)),c(8),x(i.getTopRatedCount()),c(10),x(i.lowStockCount),c(2),b(" ",i.lowStockCount>0?"Riordina presto":"Tutto ok"," "),c(9),p("value",i.searchTerm),c(6),p("value",i.selectedCategory||""),c(3),p("ngForOf",i.categories),c(6),p("value",i.sortBy),c(12),p("checked",i.showAvailableOnly),c(5),p("checked",i.showLowStockOnly),c(36),p("ngIf",i.isLoading),c(),p("ngForOf",i.filteredBeverages),c(),p("ngIf",!i.isLoading&&i.filteredBeverages.length===0),c(),p("ngIf",i.showAddModal||i.showEditModal),c(),p("ngIf",i.showAddCategoryModal),c(),p("ngIf",i.showConfirmModal))},dependencies:[N,W,z,X,Q,H,q,U,j,G,R,K,J,Y],styles:[".icon-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;max-height:200px;overflow-y:auto;padding:8px;background:var(--smoke-0);border-radius:8px}.icon-grid-button[_ngcontent-%COMP%]{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border:2px solid transparent;border-radius:6px;background:transparent;cursor:pointer;transition:all .2s}.icon-grid-button[_ngcontent-%COMP%]:hover{background:var(--smoke-1);transform:translateY(-2px)}.icon-grid-button.selected[_ngcontent-%COMP%]{border-color:var(--primary);background:var(--primary-light)}.color-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;max-height:120px;overflow-y:auto;padding:8px;background:var(--smoke-0);border-radius:8px}.color-grid-button[_ngcontent-%COMP%]{width:30px;height:30px;border:2px solid transparent;border-radius:50%;cursor:pointer;transition:all .2s}.color-grid-button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.color-grid-button.selected[_ngcontent-%COMP%]{border-color:var(--dark);transform:scale(1.1);box-shadow:0 2px 8px #0003}.chip.warning[_ngcontent-%COMP%]{background:#ffa726;color:#fff;font-size:12px;padding:4px 8px;border-radius:12px;display:inline-flex;align-items:center;gap:4px}.icon-button.danger[_ngcontent-%COMP%]{background:#ff6b6b;color:#fff}.icon-button.danger[_ngcontent-%COMP%]:hover{background:#ff5252}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px;border-radius:6px;transition:background .2s}.checkbox-label[_ngcontent-%COMP%]:hover{background:var(--smoke-0)}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;border-radius:4px;border:2px solid var(--gray-3);cursor:pointer}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked{background-color:var(--primary);border-color:var(--primary)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;background:var(--smoke-0);border-radius:12px;border:2px dashed var(--gray-3)}@media (max-width: 768px){.modal-container.modal-md[_ngcontent-%COMP%]{width:95%;margin:20px auto}.icon-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(4,1fr)}.color-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(6,1fr)}}"]})};export{$ as AlcoholicBeverages};
