import{a as L}from"./chunk-BR3YGOLJ.js";import{a as M,b as N,c as x,d as V,e as T,i as z,l as P,o as G,v as O,x as A}from"./chunk-HTWH3NPU.js";import{d as k,e as C,l as I}from"./chunk-KBL2L3GY.js";import{Cb as v,Gb as p,Hb as u,Na as a,Qb as y,Sb as w,Tb as n,Ub as _,Vb as h,cb as F,f as g,ga as b,hb as S,la as m,ma as c,tb as d,ub as i,vb as e,wb as f}from"./chunk-UE7YVF6I.js";function q(s,r){s&1&&(i(0,"tr")(1,"td",21),f(2,"div",22),i(3,"span"),n(4,"Caricamento fornitori..."),e()()())}function $(s,r){if(s&1){let t=v();i(0,"tr",23)(1,"td")(2,"strong"),n(3),e()(),i(4,"td")(5,"span",6),n(6),e()(),i(7,"td")(8,"span",6),n(9),e()(),i(10,"td")(11,"span",6),n(12),e()(),i(13,"td")(14,"span",6),n(15),e()(),i(16,"td")(17,"span",24),n(18),e()(),i(19,"td")(20,"div",25)(21,"button",26),p("click",function(){let l=m(t).$implicit,E=u();return c(E.editSupplier(l))}),i(22,"span",3),n(23,"edit"),e()(),i(24,"button",27),p("click",function(){let l=m(t).$implicit,E=u();return c(E.deleteSupplier(l.id))}),i(25,"span",3),n(26,"delete"),e()()()()()}if(s&2){let t=r.$implicit;a(3),_(t.company_name),a(3),_(t.contact_name||"Nessun contatto"),a(3),_(t.email||"Nessuna email"),a(3),_(t.phone||"Nessun telefono"),a(3),_(t.address||"Nessun indirizzo"),a(2),w(t.is_platform_supplier?"active":"warning"),a(),h(" ",t.is_platform_supplier?"Piattaforma":"Locale"," ")}}function j(s,r){if(s&1){let t=v();i(0,"tr")(1,"td",28)(2,"span",3),n(3,"local_shipping"),e(),i(4,"h3"),n(5,"Nessun fornitore trovato"),e(),i(6,"button",14),p("click",function(){m(t);let l=u();return c(l.newSupplier())}),i(7,"span",3),n(8,"add"),e(),n(9," Aggiungi il primo fornitore "),e()()()}}function B(s,r){s&1&&(i(0,"div",51)(1,"span"),n(2,"Il nome dell'azienda \xE8 obbligatorio"),e()())}function R(s,r){s&1&&(i(0,"div",51)(1,"span"),n(2,"Inserisci un indirizzo email valido"),e()())}function H(s,r){if(s&1){let t=v();i(0,"div",29),p("click",function(){m(t);let l=u();return c(l.resetForm())}),i(1,"div",30),p("click",function(l){return m(t),c(l.stopPropagation())}),i(2,"div",9)(3,"span",3),n(4),e(),i(5,"h2",10),n(6),e(),i(7,"button",31),p("click",function(){m(t);let l=u();return c(l.resetForm())}),i(8,"span",3),n(9,"close"),e()()(),i(10,"form",32),p("ngSubmit",function(){m(t);let l=u();return c(l.onSubmit())}),i(11,"div",33)(12,"div",34)(13,"label",35)(14,"span",3),n(15,"business"),e(),n(16," Nome Azienda * "),e(),f(17,"input",36),S(18,B,3,0,"div",37),e(),i(19,"div",34)(20,"label",38)(21,"span",3),n(22,"person"),e(),n(23," Nome Contatto "),e(),f(24,"input",39),e()(),i(25,"div",33)(26,"div",34)(27,"label",40)(28,"span",3),n(29,"email"),e(),n(30," Email "),e(),f(31,"input",41),S(32,R,3,0,"div",37),e(),i(33,"div",34)(34,"label",42)(35,"span",3),n(36,"phone"),e(),n(37," Telefono "),e(),f(38,"input",43),e()(),i(39,"div",34)(40,"label",44)(41,"span",3),n(42,"place"),e(),n(43," Indirizzo "),e(),f(44,"textarea",45),e(),i(45,"div",34)(46,"label",46),f(47,"input",47),i(48,"div")(49,"strong"),n(50,"Fornitore della piattaforma"),e(),i(51,"div",6),n(52,"Seleziona se \xE8 un fornitore della piattaforma Promethea"),e()()()(),i(53,"div",48)(54,"button",49),p("click",function(){m(t);let l=u();return c(l.resetForm())}),n(55," Annulla "),e(),i(56,"button",50)(57,"span",3),n(58),e(),n(59),e()()()()()}if(s&2){let t=u();a(4),_(t.isEditing?"edit":"add_circle"),a(2),h(" ",t.isEditing?"Modifica Fornitore":"Nuovo Fornitore"," "),a(4),d("formGroup",t.supplierForm),a(7),y("error",(t.company_name==null?null:t.company_name.invalid)&&(t.company_name==null?null:t.company_name.touched)),a(),d("ngIf",(t.company_name==null?null:t.company_name.invalid)&&(t.company_name==null?null:t.company_name.touched)),a(13),y("error",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),a(),d("ngIf",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),a(24),d("disabled",t.supplierForm.invalid),a(2),_(t.isEditing?"save":"add"),a(),h(" ",t.isEditing?"Aggiorna":"Crea"," Fornitore ")}}var D=class s{supplierService=b(L);fb=b(O);suppliers=[];showSupplierForm=!1;isEditing=!1;currentSupplierId=null;supplierForm;isLoading=!0;constructor(){this.supplierForm=this.fb.group({company_name:["",[x.required,x.minLength(2)]],contact_name:[""],email:["",[x.email]],phone:[""],address:[""],is_platform_supplier:[!1]})}ngOnInit(){return g(this,null,function*(){yield this.loadSuppliers()})}loadSuppliers(){return g(this,null,function*(){this.isLoading=!0;try{yield this.supplierService.loadSuppliers(),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r,this.isLoading=!1})}catch(r){console.error("Error loading suppliers:",r),this.isLoading=!1}})}onSubmit(){return g(this,null,function*(){if(this.supplierForm.invalid){this.markFormGroupTouched();return}try{this.isEditing&&this.currentSupplierId?(yield this.updateSupplier(this.currentSupplierId,this.supplierForm.value))&&(console.log("Fornitore aggiornato con successo"),this.resetForm()):(yield this.supplierService.createSupplier(this.supplierForm.value))&&(console.log("Fornitore creato con successo"),this.resetForm())}catch(r){console.error("Errore durante il salvataggio:",r)}})}updateSupplier(r,t){return g(this,null,function*(){try{let{data:o,error:l}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").update(t).eq("id",r).select().single();if(l)throw l;return yield this.loadSuppliers(),!0}catch(o){return console.error("Error updating supplier:",o),!1}})}deleteSupplier(r){return g(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questo fornitore?"))try{let{error:t}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").delete().eq("id",r);if(t)throw t;yield this.loadSuppliers(),console.log("Fornitore eliminato")}catch(t){console.error("Error deleting supplier:",t)}})}editSupplier(r){this.isEditing=!0,this.currentSupplierId=r.id,this.supplierForm.patchValue({company_name:r.company_name,contact_name:r.contact_name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",is_platform_supplier:r.is_platform_supplier}),this.showSupplierForm=!0}newSupplier(){this.resetForm(),this.showSupplierForm=!0,this.isEditing=!1}resetForm(){this.supplierForm.reset({company_name:"",contact_name:"",email:"",phone:"",address:"",is_platform_supplier:!1}),this.isEditing=!1,this.currentSupplierId=null,this.showSupplierForm=!1}markFormGroupTouched(){Object.keys(this.supplierForm.controls).forEach(r=>{this.supplierForm.get(r)?.markAsTouched()})}get company_name(){return this.supplierForm.get("company_name")}get email(){return this.supplierForm.get("email")}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=F({type:s,selectors:[["app-supplier-manager"]],decls:49,vars:5,consts:[[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"filters-section",2,"margin-top","var(--gutter-md)"],[1,"actions-container"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngIf"],["class","supplier-row",4,"ngFor","ngForOf"],["class","supplier-modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"loading-container"],[1,"loading-spinner"],[1,"supplier-row"],[1,"chip"],[1,"action-buttons"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state"],[1,"supplier-modal-overlay",3,"click"],[1,"form-card","supplier-modal",3,"click"],[1,"icon-button",3,"click"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],["for","company_name",1,"form-label"],["id","company_name","formControlName","company_name","type","text","placeholder","Es: Fornitore Srl"],["class","status-message error",4,"ngIf"],["for","contact_name",1,"form-label"],["id","contact_name","formControlName","contact_name","type","text","placeholder","Nome del referente"],["for","email",1,"form-label"],["id","email","formControlName","email","type","email","placeholder","email@fornitore.com"],["for","phone",1,"form-label"],["id","phone","formControlName","phone","type","tel","placeholder","+39 012 345 6789"],["for","address",1,"form-label"],["id","address","formControlName","address","rows","2","placeholder","Indirizzo completo del fornitore"],[1,"checkbox-label","large"],["type","checkbox","formControlName","is_platform_supplier"],[1,"form-actions"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"status-message","error"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"local_shipping"),e()(),i(5,"div",4)(6,"h1",5),n(7,"Gestione Fornitori"),e(),i(8,"p",6),n(9,"Gestisci i fornitori del tuo ristorante"),e()()(),i(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",3),n(14,"business"),e(),i(15,"h3",10),n(16,"Fornitori Totali"),e()(),i(17,"div",11),n(18),e()()(),i(19,"div",12)(20,"div",13)(21,"button",14),p("click",function(){return o.newSupplier()}),i(22,"span",3),n(23,"add"),e(),n(24," Nuovo Fornitore "),e()()(),i(25,"div",15)(26,"div",16)(27,"table",17)(28,"thead")(29,"tr")(30,"th"),n(31,"Nome Azienda"),e(),i(32,"th"),n(33,"Contatto"),e(),i(34,"th"),n(35,"Email"),e(),i(36,"th"),n(37,"Telefono"),e(),i(38,"th"),n(39,"Indirizzo"),e(),i(40,"th"),n(41,"Tipo"),e(),i(42,"th"),n(43,"Azioni"),e()()(),i(44,"tbody"),S(45,q,5,0,"tr",18)(46,$,27,8,"tr",19)(47,j,10,0,"tr",18),e()()()(),S(48,H,60,12,"div",20),e()),t&2&&(a(18),_(o.suppliers.length),a(27),d("ngIf",o.isLoading),a(),d("ngForOf",o.suppliers),a(),d("ngIf",!o.isLoading&&o.suppliers.length===0),a(),d("ngIf",o.showSupplierForm))},dependencies:[I,k,C,A,z,N,M,V,T,P,G],styles:[".supplier-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.supplier-modal[_ngcontent-%COMP%]{width:90%;max-height:90vh;overflow-y:auto;padding:var(--gutter-md);background:var(--background)}.supplier-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}"]})};export{D as SupplierManager};
