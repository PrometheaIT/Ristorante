import{a as n}from"./chunk-5BFIQ7BP.js";import{$ as s,f as a,xa as l}from"./chunk-K5RDB55Y.js";var c=class o extends n{getTableName(){return"tables"}loadData(){return a(this,null,function*(){try{let r=yield this.getCurrentRestaurantId();if(!r)return;let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",r).eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;this.dataSubject.next(e||[])}catch(r){console.error(`Error loading ${this.getTableName()}:`,r)}})}getTables(){return this.dataSubject.value}getTablesByFloorPlan(r){return this.dataSubject.value.filter(e=>e.floor_plan_id===r)}createTable(r){return a(this,null,function*(){try{console.log("\u{1F4DD} Creating table with shape:",r.shape);let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from("tables").insert(r).select().single();if(t)throw console.error("\u274C Error creating table:",t),console.error("\u274C Error details:",t.details),t;return console.log("\u2705 Table created successfully"),yield this.loadData(),e}catch(e){return console.error("\u{1F4A5} Error in createTable:",e),null}})}updateTable(r,e){return a(this,null,function*(){try{let{error:t}=yield this.supabaseService.getSupabaseClient().from("tables").update(e).eq("id",r);if(t)throw t;return yield this.loadData(),!0}catch(t){return console.error("\u274C Error updating table:",t),!1}})}deleteTable(r){return a(this,null,function*(){try{let{error:e}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_active:!1}).eq("id",r);if(e)throw e;return yield this.loadData(),!0}catch(e){return console.error("\u274C Error deleting table:",e),!1}})}checkTableOverlap(r,e){let t=this.getTablesByFloorPlan(r.floor_plan_id).filter(i=>i.id!==e);for(let i of t)if(this.doTablesOverlap(r,i))return!0;return!1}doTablesOverlap(r,e){return!(r.position_x+r.width<=e.position_x||r.position_x>=e.position_x+e.width||r.position_y+r.height<=e.position_y||r.position_y>=e.position_y+e.height)}updateTableOnlineBookable(r,e){return a(this,null,function*(){try{let{error:t}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_online_bookable:e}).eq("id",r);if(t)throw t;return yield this.loadData(),!0}catch(t){return console.error("\u274C Error updating table online bookable status:",t),!1}})}getTablesAvailableForOnlineBooking(r){return this.getTablesByFloorPlan(r).filter(e=>e.is_online_bookable&&!e.is_merged&&e.is_active)}getVisibleTablesByFloorPlan(r){return this.getTablesByFloorPlan(r).filter(e=>!e.is_merged||e.parent_table_id===null)}static \u0275fac=(()=>{let r;return function(t){return(r||(r=l(o)))(t||o)}})();static \u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a};
