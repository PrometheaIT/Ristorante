import{a as ie}from"./chunk-GKNZLVDN.js";import{a as j,b as $,c as v,d as B,e as q,h as U,i as H,k as J,n as K,o as Q,p as X,q as Y,u as Z,v as ee,w as te}from"./chunk-Y4TUQNZC.js";import{a as L}from"./chunk-KNL3CWA3.js";import{A as G,d as D,e as A,k as W}from"./chunk-DCWKKS33.js";import{Db as f,Eb as m,Ia as P,La as s,Nb as F,Pb as N,Qb as a,Rb as I,Sb as S,Tb as z,Vb as y,Wa as k,Wb as w,Xb as E,_b as C,ab as R,ea as V,f as h,fb as _,ja as u,ka as g,qb as d,rb as i,sb as e,tb as p,zb as b}from"./chunk-K5RDB55Y.js";var O=()=>({standalone:!0});function ae(l,n){if(l&1&&(i(0,"option",37),a(1),e()),l&2){let t=n.$implicit;d("value",t),s(),I(t)}}function re(l,n){if(l&1&&(i(0,"div",38),p(1,"img",39),e()),l&2){let t=m();s(),d("src",t.logoPreview,P)}}function oe(l,n){if(l&1&&(i(0,"div",38),p(1,"img",40),e()),l&2){let t=m();s(),d("src",t.coverPreview,P)}}function se(l,n){if(l&1){let t=b();i(0,"button",53),f("click",function(){u(t);let o=m().index,c=m();return g(c.deleteShift(o))}),i(1,"span",2),a(2,"delete"),e()()}}function le(l,n){if(l&1&&(i(0,"label",54),p(1,"input",55),a(2),e()),l&2){let t=n.$implicit,r=n.index,o=m().$implicit,c=m();s(),d("checked",c.isDaySelected(o.days_of_week,r)),s(),S(" ",t," ")}}function ce(l,n){if(l&1){let t=b();i(0,"div",41)(1,"div",42)(2,"h3",43),a(3),e(),i(4,"div",44)(5,"button",45),f("click",function(){let o=u(t).index,c=m();return g(c.toggleShiftActive(o))}),i(6,"span",2),a(7),e(),a(8),e(),i(9,"button",46),f("click",function(){let o=u(t).index,c=m();return g(c.editShift(o))}),i(10,"span",2),a(11,"edit"),e()(),_(12,se,3,0,"button",47),e()(),i(13,"div",48)(14,"div",49)(15,"span",2),a(16,"access_time"),e(),i(17,"span"),a(18),e()(),i(19,"div",50),a(20),e()(),i(21,"div",51),_(22,le,3,2,"label",52),e()()}if(l&2){let t=n.$implicit,r=m();s(3),I(t.name),s(2),N(t.is_active?"btn-deactivate":"btn-activate"),d("title",t.is_active?"Disattiva turno":"Attiva turno"),s(2),S(" ",t.is_active?"pause":"play_arrow"," "),s(),S(" ",t.is_active?"Disattiva":"Attiva"," "),s(4),d("ngIf",r.shifts.length>1),s(6),z("",t.start_time.substring(0,5)," - ",t.end_time.substring(0,5)),s(),F("active",t.is_active),s(),S(" ",t.is_active?"Attivo":"Disattivato"," "),s(2),d("ngForOf",r.weekDays)}}function de(l,n){if(l&1){let t=b();i(0,"label",54)(1,"input",65),f("change",function(o){let c=u(t).index,M=m(2);return g(M.toggleCurrentShiftDay(c,o))}),e(),a(2),e()}if(l&2){let t=n.$implicit,r=n.index,o=m(2);s(),d("checked",o.isDaySelected(o.currentShift.days_of_week,r)),s(),S(" ",t," ")}}function me(l,n){if(l&1){let t=b();i(0,"div",56)(1,"h4"),a(2),e(),i(3,"div",9)(4,"div",10)(5,"label",11),a(6,"Nome Turno *"),e(),i(7,"input",57),E("ngModelChange",function(o){u(t);let c=m();return w(c.currentShift.name,o)||(c.currentShift.name=o),g(o)}),e()(),i(8,"div",10)(9,"label",11),a(10,"Ora Inizio *"),e(),i(11,"input",58),E("ngModelChange",function(o){u(t);let c=m();return w(c.currentShift.start_time,o)||(c.currentShift.start_time=o),g(o)}),e()(),i(12,"div",10)(13,"label",11),a(14,"Ora Fine *"),e(),i(15,"input",58),E("ngModelChange",function(o){u(t);let c=m();return w(c.currentShift.end_time,o)||(c.currentShift.end_time=o),g(o)}),e()(),i(16,"div",10)(17,"label",54)(18,"input",59),E("ngModelChange",function(o){u(t);let c=m();return w(c.currentShift.is_active,o)||(c.currentShift.is_active=o),g(o)}),e(),a(19," Turno attivo "),e()(),i(20,"div",60)(21,"label",11),a(22,"Giorni Attivi"),e(),i(23,"div",61),_(24,de,3,2,"label",52),e()()(),i(25,"div",62)(26,"button",63),f("click",function(){u(t);let o=m();return g(o.saveShift())}),i(27,"span",2),a(28,"save"),e(),a(29),e(),i(30,"button",64),f("click",function(){u(t);let o=m();return g(o.cancelEditShift())}),i(31,"span",2),a(32,"cancel"),e(),a(33," Annulla "),e()()()}if(l&2){let t=m();s(2),I(t.editingShift==="new"?"Aggiungi Nuovo Turno":"Modifica Turno"),s(5),y("ngModel",t.currentShift.name),d("ngModelOptions",C(12,O)),s(4),y("ngModel",t.currentShift.start_time),d("ngModelOptions",C(13,O)),s(4),y("ngModel",t.currentShift.end_time),d("ngModelOptions",C(14,O)),s(3),y("ngModel",t.currentShift.is_active),d("ngModelOptions",C(15,O)),s(6),d("ngForOf",t.weekDays),s(2),d("disabled",!t.isCurrentShiftValid()),s(3),S(" ",t.editingShift==="new"?"Aggiungi Turno":"Salva Modifiche"," ")}}function pe(l,n){if(l&1){let t=b();i(0,"button",64),f("click",function(){u(t);let o=m();return g(o.addNewShift())}),i(1,"span",2),a(2,"add"),e(),a(3," Aggiungi Nuovo Turno "),e()}}function ue(l,n){l&1&&(i(0,"span",2),a(1,"sync"),e())}function ge(l,n){l&1&&(i(0,"span",2),a(1,"save"),e())}function fe(l,n){l&1&&(i(0,"span"),a(1,"Salvataggio..."),e())}function _e(l,n){l&1&&(i(0,"span"),a(1,"Salva Impostazioni"),e())}var ne=class l{constructor(n,t,r){this.fb=n;this.supabaseService=t;this.auth=r;this.supabaseClient=this.supabaseService.getSupabaseClient()}settingsForm;loading=!1;restaurantId;logoPreview;coverPreview;shiftService=V(ie);shiftsSubscription;shifts=[];editingShift=null;currentShift=this.createEmptyShift();weekDays=["Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato","Domenica"];cuisineTypes=["Italiana","Giapponese","Cinese","Indiana","Messicana","Francese","Spagnola","Thailandese","Greca","Americana","Vegetariana","Vegana"];supabaseClient;ngOnInit(){return h(this,null,function*(){this.initForm(),yield this.loadRestaurantData(),this.setupShiftsSubscription()})}ngOnDestroy(){this.shiftsSubscription&&this.shiftsSubscription.unsubscribe()}setupShiftsSubscription(){this.shiftsSubscription=this.shiftService.shifts$.subscribe(n=>{this.shifts=n})}initForm(){this.settingsForm=this.fb.group({name:["",[v.required,v.minLength(2)]],description:[""],address:["",v.required],phone:["",[v.required,v.pattern(/^\+?\d{8,15}$/)]],email:["",[v.required,v.email]],cuisine_type:[""],accepts_delivery:[!1],accepts_takeaway:[!1],allow_table_selection:[!1],is_active:[!0]})}loadRestaurantData(){return h(this,null,function*(){this.loading=!0;try{let n=this.auth.currentUserValue;if(!n)throw new Error("Utente non loggato");let{data:t,error:r}=yield this.supabaseClient.from("restaurants").select("*").eq("owner_id",n.id).single();if(r)throw r;if(!t)throw new Error("Ristorante non trovato");this.restaurantId=t.id,this.patchForm(t),this.logoPreview=t.logo_url||void 0,this.coverPreview=t.cover_image_url||void 0}catch(n){alert("Errore caricamento: "+(n.message||"Impossibile caricare i dati")),console.error(n)}finally{this.loading=!1}})}patchForm(n){this.settingsForm.patchValue({name:n.name,description:n.description||"",address:n.address,phone:n.phone,email:n.email,cuisine_type:n.cuisine_type||"",accepts_delivery:n.accepts_delivery,accepts_takeaway:n.accepts_takeaway,allow_table_selection:n.allow_table_selection,is_active:n.is_active})}createEmptyShift(){return{name:"",start_time:"12:00",end_time:"15:00",days_of_week:[1,2,3,4,5,6,7],is_active:!0}}addNewShift(){this.currentShift=this.createEmptyShift(),this.editingShift="new"}editShift(n){let t=this.shifts[n];this.currentShift={name:t.name,start_time:t.start_time.substring(0,5),end_time:t.end_time.substring(0,5),days_of_week:[...t.days_of_week],is_active:t.is_active},this.editingShift=n}cancelEditShift(){this.editingShift=null,this.currentShift=this.createEmptyShift()}saveShift(){return h(this,null,function*(){if(this.isCurrentShiftValid()){this.loading=!0;try{if(this.editingShift==="new"){if(!(yield this.shiftService.createShift(this.currentShift)))throw new Error("Errore nella creazione del turno")}else{let n=this.shifts[this.editingShift].id;if(!(yield this.shiftService.updateShift(n,this.currentShift)))throw new Error("Errore nell'aggiornamento del turno")}this.cancelEditShift(),alert("Turno salvato con successo!")}catch(n){alert("Errore salvataggio turno: "+n.message),console.error(n)}finally{this.loading=!1}}})}deleteShift(n){return h(this,null,function*(){if(!confirm("Sei sicuro di voler eliminare questo turno?"))return;let t=this.shifts[n].id;if(t){this.loading=!0;try{let{error:r}=yield this.supabaseClient.from("shifts").delete().eq("id",t);if(r)throw r;yield this.shiftService.loadShifts(),alert("Turno eliminato con successo!")}catch(r){alert("Errore eliminazione turno: "+r.message),console.error(r)}finally{this.loading=!1}}})}toggleCurrentShiftDay(n,t){let r=t.target.checked,o=n+1;r?this.currentShift.days_of_week.includes(o)||this.currentShift.days_of_week.push(o):this.currentShift.days_of_week=this.currentShift.days_of_week.filter(c=>c!==o)}isCurrentShiftValid(){return!!(this.currentShift.name&&this.currentShift.start_time&&this.currentShift.end_time&&this.currentShift.days_of_week.length>0)}isDaySelected(n,t){let r=t+1;return n.includes(r)}onFileSelect(n,t){return h(this,null,function*(){let r=n.target;if(!r.files?.length||!this.restaurantId)return;let o=r.files[0],c=5*1024*1024;if(o.size>c){alert("Immagine troppo grande (max 5MB)");return}let M=`restaurants/${this.restaurantId}/${t}s/${Date.now()}_${o.name}`;this.loading=!0;try{let{error:x}=yield this.supabaseClient.storage.from("restaurant-images").upload(M,o,{upsert:!0});if(x)throw x;let{data:{publicUrl:T}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(M);t==="logo"?this.logoPreview=T:this.coverPreview=T,alert(`${t==="logo"?"Logo":"Copertina"} caricata!`)}catch(x){alert("Errore upload: "+x.message),console.error(x)}finally{this.loading=!1}})}onSubmit(){return h(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId)){this.loading=!0;try{let n=this.settingsForm.value,t={name:n.name,description:n.description||null,address:n.address,phone:n.phone,email:n.email,cuisine_type:n.cuisine_type||null,accepts_delivery:n.accepts_delivery,accepts_takeaway:n.accepts_takeaway,allow_table_selection:n.allow_table_selection,is_active:n.is_active,updated_at:new Date().toISOString()};this.logoPreview&&(t.logo_url=this.logoPreview),this.coverPreview&&(t.cover_image_url=this.coverPreview);let{error:r}=yield this.supabaseClient.from("restaurants").update(t).eq("id",this.restaurantId);if(r)throw r;alert("Impostazioni salvate con successo!")}catch(n){alert("Errore salvataggio: "+n.message),console.error(n)}finally{this.loading=!1}}})}toggleShiftActive(n){return h(this,null,function*(){let t=this.shifts[n],r=!t.is_active;if(confirm(`Sei sicuro di voler ${r?"attivare":"disattivare"} il turno "${t.name}"?`)){this.loading=!0;try{if(!(yield this.shiftService.updateShift(t.id,{is_active:r})))throw new Error(`Errore nella ${r?"attivazione":"disattivazione"} del turno`);alert(`Turno "${t.name}" ${r?"attivato":"disattivato"} con successo!`)}catch(o){alert(`Errore: ${o.message}`),console.error(o)}finally{this.loading=!1}}})}static \u0275fac=function(t){return new(t||l)(k(Z),k(G),k(L))};static \u0275cmp=R({type:l,selectors:[["app-restaurant-settings"]],decls:136,vars:12,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],["type","text","formControlName","name","placeholder","Es: Trattoria da Mario"],["type","email","formControlName","email","placeholder","info@ristorante.it"],["type","tel","formControlName","phone","placeholder","+39 123 456 7890"],["formControlName","cuisine_type"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","md:col-span-2"],["type","text","formControlName","address","placeholder","Via Roma 123, Milano"],["formControlName","description","rows","3","placeholder","Racconta la storia del tuo ristorante..."],[1,"mt-2"],["type","file","accept","image/*",1,"w-full",3,"change"],["class","mt-3",4,"ngIf"],[1,"space-y-4"],[1,"checkbox-label","large"],["type","checkbox","formControlName","accepts_delivery"],["type","checkbox","formControlName","accepts_takeaway"],["type","checkbox","formControlName","allow_table_selection"],["type","checkbox","formControlName","is_active"],["class","shift-item",4,"ngFor","ngForOf"],["class","shift-form",4,"ngIf"],["type","button","class","promethea-button secondary",3,"click",4,"ngIf"],[1,"form-actions"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"mt-3"],[1,"w-32","h-32","object-cover","rounded-lg","shadow",3,"src"],[1,"w-full","h-48","object-cover","rounded-lg","shadow",3,"src"],[1,"shift-item"],[1,"shift-header"],[1,"shift-name"],[1,"actions-container"],["type","button",3,"click","title"],["type","button",1,"btn-edit",3,"click"],["type","button","class","btn-delete",3,"click",4,"ngIf"],[1,"shift-times"],[1,"time-slot"],[1,"shift-status"],[1,"shift-days"],["class","checkbox-label",4,"ngFor","ngForOf"],["type","button",1,"btn-delete",3,"click"],[1,"checkbox-label"],["type","checkbox","disabled","",3,"checked"],[1,"shift-form"],["type","text","placeholder","Es: Pranzo, Cena",3,"ngModelChange","ngModel","ngModelOptions"],["type","time",3,"ngModelChange","ngModel","ngModelOptions"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"form-group","md:col-span-3"],[1,"days-grid"],[1,"shift-form-actions"],["type","button",1,"promethea-button",3,"click","disabled"],["type","button",1,"promethea-button","secondary",3,"click"],["type","checkbox",3,"change","checked"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"span",2),a(3,"settings"),e(),i(4,"div",3)(5,"h1"),a(6,"Impostazioni Ristorante"),e(),i(7,"p",4),a(8,"Gestisci le informazioni e i servizi del tuo ristorante"),e()()(),i(9,"form",5),f("ngSubmit",function(){return r.onSubmit()}),i(10,"div",6)(11,"div",7)(12,"span",2),a(13,"info"),e(),i(14,"h2",8),a(15,"Informazioni Base"),e()(),i(16,"div",9)(17,"div",10)(18,"label",11)(19,"span",2),a(20,"restaurant"),e(),a(21," Nome Ristorante * "),e(),p(22,"input",12),e(),i(23,"div",10)(24,"label",11)(25,"span",2),a(26,"email"),e(),a(27," Email * "),e(),p(28,"input",13),e(),i(29,"div",10)(30,"label",11)(31,"span",2),a(32,"phone"),e(),a(33," Telefono * "),e(),p(34,"input",14),e(),i(35,"div",10)(36,"label",11)(37,"span",2),a(38,"local_dining"),e(),a(39," Tipo di Cucina "),e(),i(40,"select",15)(41,"option",16),a(42,"Seleziona..."),e(),_(43,ae,2,2,"option",17),e()(),i(44,"div",18)(45,"label",11)(46,"span",2),a(47,"location_on"),e(),a(48," Indirizzo * "),e(),p(49,"input",19),e(),i(50,"div",18)(51,"label",11)(52,"span",2),a(53,"description"),e(),a(54," Descrizione "),e(),p(55,"textarea",20),e()()(),i(56,"div",6)(57,"div",7)(58,"span",2),a(59,"image"),e(),i(60,"h2",8),a(61,"Immagini"),e()(),i(62,"div",9)(63,"div",10)(64,"label",11)(65,"span",2),a(66,"photo_camera"),e(),a(67," Logo "),e(),i(68,"div",21)(69,"input",22),f("change",function(c){return r.onFileSelect(c,"logo")}),e(),_(70,re,2,1,"div",23),e()(),i(71,"div",10)(72,"label",11)(73,"span",2),a(74,"panorama"),e(),a(75," Copertina "),e(),i(76,"div",21)(77,"input",22),f("change",function(c){return r.onFileSelect(c,"cover")}),e(),_(78,oe,2,1,"div",23),e()()()(),i(79,"div",6)(80,"div",7)(81,"span",2),a(82,"room_service"),e(),i(83,"h2",8),a(84,"Servizi Offerti"),e()(),i(85,"div",24)(86,"label",25),p(87,"input",26),i(88,"div")(89,"strong"),a(90,"Consegna a domicilio"),e(),i(91,"div",4),a(92,"I clienti possono ordinare con consegna"),e()()(),i(93,"label",25),p(94,"input",27),i(95,"div")(96,"strong"),a(97,"Asporto"),e(),i(98,"div",4),a(99,"I clienti possono ritirare in loco"),e()()(),i(100,"label",25),p(101,"input",28),i(102,"div")(103,"strong"),a(104,"Prenotazione tavolo"),e(),i(105,"div",4),a(106,"I clienti possono scegliere il tavolo"),e()()()()(),i(107,"div",6)(108,"div",7)(109,"span",2),a(110,"visibility"),e(),i(111,"h2",8),a(112,"Stato Ristorante"),e()(),i(113,"label",25),p(114,"input",29),i(115,"div")(116,"strong"),a(117,"Ristorante attivo"),e(),i(118,"div",4),a(119,"Visibile ai clienti e accettazione ordini"),e()()()(),i(120,"div",6)(121,"div",7)(122,"span",2),a(123,"schedule"),e(),i(124,"h2",8),a(125,"Turni di Lavoro"),e()(),i(126,"div",24),_(127,ce,23,13,"div",30)(128,me,34,16,"div",31)(129,pe,4,0,"button",32),e()(),i(130,"div",33)(131,"button",34),_(132,ue,2,0,"span",35)(133,ge,2,0,"span",35)(134,fe,2,0,"span",36)(135,_e,2,0,"span",36),e()()()()),t&2&&(s(9),d("formGroup",r.settingsForm),s(34),d("ngForOf",r.cuisineTypes),s(27),d("ngIf",r.logoPreview),s(8),d("ngIf",r.coverPreview),s(49),d("ngForOf",r.shifts),s(),d("ngIf",r.editingShift!==null),s(),d("ngIf",r.editingShift===null),s(2),d("disabled",r.loading||r.settingsForm.invalid),s(),d("ngIf",r.loading),s(),d("ngIf",!r.loading),s(),d("ngIf",r.loading),s(),d("ngIf",!r.loading))},dependencies:[W,D,A,te,H,X,Y,$,j,Q,B,q,J,K,ee,U],styles:[".shift-item[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:8px;padding:16px;margin-bottom:12px}.shift-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.shift-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin:0}.shift-status[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;font-size:.875rem;font-weight:500}.shift-status.active[_ngcontent-%COMP%]{background-color:#c6f6d5;color:#22543d}.shift-status[_ngcontent-%COMP%]:not(.active){background-color:#fed7d7;color:#742a2a}.btn-edit[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%]{padding:6px;border:none;border-radius:4px;cursor:pointer;display:flex;align-items:center}.btn-edit[_ngcontent-%COMP%]{background:#e2e8f0;color:#4a5568}.btn-delete[_ngcontent-%COMP%]{background:#fed7d7;color:#c53030}.shift-times[_ngcontent-%COMP%]{margin-bottom:12px}.time-slot[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:500}.shift-days[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}.shift-form[_ngcontent-%COMP%]{border:2px dashed #cbd5e0;border-radius:8px;padding:16px;margin:16px 0}.shift-form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#4a5568}.days-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;margin-top:8px}.shift-form-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:16px}.btn-activate[_ngcontent-%COMP%], .btn-deactivate[_ngcontent-%COMP%]{padding:6px 12px;border:none;border-radius:4px;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:.875rem;font-weight:500;transition:all .2s}.btn-activate[_ngcontent-%COMP%]{background:#c6f6d5;color:#22543d}.btn-activate[_ngcontent-%COMP%]:hover{background:#9ae6b4}.btn-deactivate[_ngcontent-%COMP%]{background:#fed7d7;color:#c53030}.btn-deactivate[_ngcontent-%COMP%]:hover{background:#feb2b2}"]})};export{ne as RestaurantSettings};
