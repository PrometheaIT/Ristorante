import{a as X}from"./chunk-DWZOGMN6.js";import{a as W}from"./chunk-GISRQR7J.js";import{a as H}from"./chunk-QIN6DJXF.js";import{Ta as J,Ua as K}from"./chunk-PTJ2A6G7.js";import{a as z,b as N,c as x,d as q,e as A,i as U,j as D,m as L,p as j,q as B,r as G,s as $,u as Y,w as Q,y as R}from"./chunk-22BNR7AL.js";import"./chunk-UOPXUV3F.js";import{f as V}from"./chunk-6GCWWUP3.js";import{j as F,k as O,p as M,s as T}from"./chunk-N5RTTLWI.js";import{Fb as P,Ha as o,Hb as I,Ib as n,Jb as v,Kb as h,Lb as E,Wb as C,Xa as w,Yb as k,ab as u,ca as b,ia as g,ib as d,ja as _,jb as i,kb as t,lb as m,rb as y,ub as s,wb as p}from"./chunk-R56C6QW6.js";import{j as S}from"./chunk-4ZZIO3ZI.js";function ee(l,r){l&1&&(i(0,"tr")(1,"td",29),m(2,"div",30),i(3,"span"),n(4,"Caricamento prodotti..."),t()()())}function te(l,r){if(l&1){let e=y();i(0,"tr",31)(1,"td")(2,"strong"),n(3),t()(),i(4,"td")(5,"span",4),n(6),t()(),i(7,"td")(8,"strong"),n(9),C(10,"number"),t()(),i(11,"td")(12,"span"),n(13),t()(),i(14,"td")(15,"span",4),n(16),t()(),i(17,"td")(18,"span",32),n(19),t()(),i(20,"td")(21,"div",20)(22,"button",33),s("click",function(){let c=g(e).$implicit,f=p();return _(f.editProduct(c))}),i(23,"span",2),n(24,"edit"),t()(),i(25,"button",34),s("click",function(){let c=g(e).$implicit,f=p();return _(f.deleteProduct(c.id))}),m(26,"lucide-angular",35),t()()()()}if(l&2){let e=r.$implicit,a=p();o(3),v(e.product_name),o(3),v(e.description||"Nessuna descrizione"),o(3),h("\u20AC",k(10,9,e.unit_price,"1.2-2")),o(4),v(e.package_quantity),o(3),v(a.getUnitSymbol(e.unit_id)),o(2),I(a.getProductStatus(e).class),o(),h(" ",a.getProductStatus(e).text," "),o(7),d("size",20)}}function ie(l,r){l&1&&(i(0,"p"),n(1," Prova a modificare i filtri di ricerca "),t())}function ne(l,r){if(l&1){let e=y();i(0,"tr")(1,"td",36)(2,"span",2),n(3,"storefront"),t(),i(4,"h3"),n(5,"Nessun prodotto trovato"),t(),u(6,ie,2,0,"p",26),i(7,"button",21),s("click",function(){g(e);let c=p();return _(c.newProduct())}),m(8,"lucide-angular",22),n(9," Aggiungi il primo prodotto "),t()()()}if(l&2){let e=p();o(6),d("ngIf",e.searchTerm||e.showAvailableOnly),o(2),d("size",20)}}function re(l,r){l&1&&(i(0,"div",67)(1,"span"),n(2,"Il nome del prodotto \xE8 obbligatorio e deve essere di almeno 2 caratteri"),t()())}function oe(l,r){l&1&&(i(0,"div",67)(1,"span"),n(2,"Il prezzo unitario \xE8 obbligatorio"),t()())}function ae(l,r){l&1&&(i(0,"div",67)(1,"span"),n(2,"La quantit\xE0 per confezione \xE8 obbligatoria"),t()())}function le(l,r){if(l&1&&(i(0,"option",68),n(1),t()),l&2){let e=r.$implicit;d("value",e.id),o(),E(" ",e.name," (",e.symbol,") ")}}function de(l,r){if(l&1&&(i(0,"option",68),n(1),t()),l&2){let e=r.$implicit;d("value",e.id),o(),E(" ",e.name," (",e.symbol,") ")}}function ce(l,r){if(l&1&&(i(0,"option",68),n(1),t()),l&2){let e=r.$implicit;d("value",e.id),o(),E(" ",e.name," (",e.symbol,") ")}}function se(l,r){if(l&1){let e=y();i(0,"div",37),s("click",function(){g(e);let c=p();return _(c.resetForm())}),i(1,"div",38),s("click",function(c){return g(e),_(c.stopPropagation())}),i(2,"div",39)(3,"h2",40)(4,"span",2),n(5),t(),n(6),t(),i(7,"button",41),s("click",function(){g(e);let c=p();return _(c.resetForm())}),i(8,"span",2),n(9,"close"),t()()(),i(10,"div",42)(11,"form",43),s("ngSubmit",function(){g(e);let c=p();return _(c.onSubmit())}),i(12,"div",44)(13,"div",45)(14,"label",46)(15,"span",2),n(16,"label"),t(),n(17," Nome Prodotto * "),t(),m(18,"input",47),u(19,re,3,0,"div",48),t(),i(20,"div",45)(21,"label",49)(22,"span",2),n(23,"description"),t(),n(24," Descrizione "),t(),m(25,"textarea",50),t()(),i(26,"div",44)(27,"div",45)(28,"label",51)(29,"span",2),n(30,"euro"),t(),n(31," Prezzo Unitario * "),t(),m(32,"input",52),u(33,oe,3,0,"div",48),t(),i(34,"div",45)(35,"label",53)(36,"span",2),n(37,"format_list_numbered"),t(),n(38," Quantit\xE0 per Confezione * "),t(),m(39,"input",54),u(40,ae,3,0,"div",48),t()(),i(41,"div",44)(42,"div",45)(43,"label",55)(44,"span",2),n(45,"straighten"),t(),n(46," Unit\xE0 di Misura "),t(),i(47,"select",56)(48,"option",57),n(49,"Seleziona unit\xE0"),t(),i(50,"optgroup",58),u(51,le,2,3,"option",59),t(),i(52,"optgroup",60),u(53,de,2,3,"option",59),t(),i(54,"optgroup",61),u(55,ce,2,3,"option",59),t()()(),i(56,"div",45)(57,"label",62),m(58,"input",63),i(59,"div")(60,"strong"),n(61,"Prodotto disponibile"),t(),i(62,"div",4),n(63,"Il prodotto \xE8 attualmente disponibile per la vendita"),t()()()()(),i(64,"div",64)(65,"button",65),s("click",function(){g(e);let c=p();return _(c.resetForm())}),n(66," Annulla "),t(),i(67,"button",66)(68,"span",2),n(69),t(),n(70),t()()()()()()}if(l&2){let e=p();o(5),v(e.isEditing?"edit":"add_circle"),o(),h(" ",e.isEditing?"Modifica Prodotto":"Nuovo Prodotto"," "),o(5),d("formGroup",e.productForm),o(7),P("error",(e.product_name==null?null:e.product_name.invalid)&&(e.product_name==null?null:e.product_name.touched)),o(),d("ngIf",(e.product_name==null?null:e.product_name.invalid)&&(e.product_name==null?null:e.product_name.touched)),o(13),P("error",(e.unit_price==null?null:e.unit_price.invalid)&&(e.unit_price==null?null:e.unit_price.touched)),o(),d("ngIf",(e.unit_price==null?null:e.unit_price.invalid)&&(e.unit_price==null?null:e.unit_price.touched)),o(6),P("error",(e.package_quantity==null?null:e.package_quantity.invalid)&&(e.package_quantity==null?null:e.package_quantity.touched)),o(),d("ngIf",(e.package_quantity==null?null:e.package_quantity.invalid)&&(e.package_quantity==null?null:e.package_quantity.touched)),o(11),d("ngForOf",e.getUnitsByType("weight")),o(2),d("ngForOf",e.getUnitsByType("volume")),o(2),d("ngForOf",e.getUnitsByType("piece")),o(12),d("disabled",e.productForm.invalid),o(2),v(e.isEditing?"save":"add"),o(),h(" ",e.isEditing?"Aggiorna":"Crea"," Prodotto ")}}var Z=class l{supplierAuthService=b(W);supplierProductsService=b(X);unitService=b(H);fb=b(Q);router=b(V);products=[];units=[];filteredProducts=[];showProductForm=!1;isEditing=!1;currentProductId=null;searchTerm="";isLoading=!0;showAvailableOnly=!1;sortBy="name";productForm;get availableProductsCount(){return this.products.filter(r=>r.is_available).length}get totalProductsValue(){return this.products.reduce((r,e)=>r+e.unit_price,0)}constructor(){this.productForm=this.fb.group({product_name:["",[x.required,x.minLength(2)]],description:[""],unit_price:[0,[x.required,x.min(0)]],package_quantity:[1,[x.required,x.min(.001)]],unit_id:[""],is_available:[!0]})}ngOnInit(){return S(this,null,function*(){yield this.loadData()})}loadData(){return S(this,null,function*(){this.isLoading=!0;try{this.unitService.units$.subscribe(r=>{this.units=r}),yield this.supplierProductsService.loadSupplierProducts(),this.supplierProductsService.products$.subscribe(r=>{this.products=r,this.applyFilters(),this.isLoading=!1})}catch(r){console.error("Error loading data:",r),this.isLoading=!1}})}applyFilters(){let r=this.products;this.searchTerm&&(r=r.filter(e=>e.product_name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description?.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.showAvailableOnly&&(r=r.filter(e=>e.is_available)),r=[...r].sort((e,a)=>{switch(this.sortBy){case"name":return e.product_name.localeCompare(a.product_name);case"price":return e.unit_price-a.unit_price;default:return 0}}),this.filteredProducts=r}onSearchChange(r){this.searchTerm=r,this.applyFilters()}toggleAvailableFilter(){this.showAvailableOnly=!this.showAvailableOnly,this.applyFilters()}onSortChange(r){this.sortBy=r,this.applyFilters()}onSubmit(){return S(this,null,function*(){if(this.productForm.invalid){this.markFormGroupTouched();return}try{this.isEditing&&this.currentProductId?(yield this.supplierProductsService.updateProduct(this.currentProductId,this.productForm.value))&&(console.log("Prodotto aggiornato con successo"),this.resetForm()):(yield this.supplierProductsService.createProduct(this.productForm.value))&&(console.log("Prodotto creato con successo"),this.resetForm())}catch(r){console.error("Errore durante il salvataggio:",r)}})}editProduct(r){this.isEditing=!0,this.currentProductId=r.id,this.productForm.patchValue({product_name:r.product_name,description:r.description||"",unit_price:r.unit_price,package_quantity:r.package_quantity,unit_id:r.unit_id||"",is_available:r.is_available}),this.showProductForm=!0}deleteProduct(r){return S(this,null,function*(){confirm("Sei sicuro di voler eliminare questo prodotto?")&&(yield this.supplierProductsService.deleteProduct(r))&&console.log("Prodotto eliminato")})}newProduct(){this.resetForm(),this.showProductForm=!0,this.isEditing=!1}resetForm(){this.productForm.reset({product_name:"",description:"",unit_price:0,package_quantity:1,unit_id:"",is_available:!0}),this.isEditing=!1,this.currentProductId=null,this.showProductForm=!1}getUnitSymbol(r){if(!r)return"";let e=this.units.find(a=>a.id===r);return e?e.symbol:""}getProductStatus(r){return r.is_available?{class:"active",text:"Disponibile"}:{class:"inactive",text:"Non disponibile"}}getUnitsByType(r){return this.units.filter(e=>e.type===r)}markFormGroupTouched(){Object.keys(this.productForm.controls).forEach(r=>{this.productForm.get(r)?.markAsTouched()})}get product_name(){return this.productForm.get("product_name")}get unit_price(){return this.productForm.get("unit_price")}get package_quantity(){return this.productForm.get("package_quantity")}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=w({type:l,selectors:[["app-supplier-ingredients"]],decls:81,vars:14,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","text-amber-500","justify-center","flex"],[1,"flex","justify-between","items-end","gap-lg","mb-lg","flex-wrap"],[1,"flex","gap-md","flex-wrap","flex-1","p-sm","mt-md"],[1,"flex","flex-col","min-w-150"],[1,"standard-label"],["type","text","placeholder","Cerca per nome o descrizione...",1,"search-input",3,"input","value"],[1,"filter-select",3,"change","value"],["value","name"],["value","price"],[1,"flex","items-center","gap-sm","cursor-pointer","p-sm","rounded","transition","hover:bg-[var(--smoke-1)]"],["type","checkbox",3,"change","checked"],[1,"flex","gap-sm"],[1,"promethea-button",3,"click"],["name","plus",3,"size"],[1,"table-section"],[1,"bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"crm-table"],[4,"ngIf"],["class","product-row",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"flex","flex-col","items-center","justify-center","p-xl","gap-md"],[1,"loading-spinner"],[1,"product-row"],[1,"chip"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["name","trash-2",3,"size"],["colspan","7",1,"text-center","p-xl","opacity-70"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"p-md","border-t","border-b","border-[var(--smoke-1)]","flex","justify-between","items-center"],[1,"modal-title"],["type","button",1,"icon-button","close-button",3,"click"],[1,"p-lg","flex-1","overflow-y-auto"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"flex","flex-col","gap-1","flex-1","min-w-300"],["for","product_name",1,"standard-label"],["id","product_name","formControlName","product_name","type","text","placeholder","Es: Pomodoro San Marzano DOP"],["class","p-sm my-sm rounded flex items-center justify-center gap-sm bg-[color-mix(in srgb,#ef444410%,transparent)] text-red-500 border border-[color-mix(in srgb,#ef444430%,transparent)]",4,"ngIf"],["for","description",1,"standard-label"],["id","description","formControlName","description","rows","3","placeholder","Descrizione opzionale del prodotto"],["for","unit_price",1,"standard-label"],["id","unit_price","formControlName","unit_price","type","number","step","0.001","min","0","placeholder","0.000"],["for","package_quantity",1,"standard-label"],["id","package_quantity","formControlName","package_quantity","type","number","step","0.001","min","0.001","placeholder","1"],["for","unit_id",1,"standard-label"],["id","unit_id","formControlName","unit_id"],["value",""],["label","Peso"],[3,"value",4,"ngFor","ngForOf"],["label","Volume"],["label","Conteggio"],[1,"flex","items-center","gap-sm","cursor-pointer","p-sm","rounded","transition","hover:bg-[var(--smoke-1)]","large"],["type","checkbox","formControlName","is_available"],[1,"flex","justify-between","items-center","gap-md","mt-lg","pt-md","border-t","border-[var(--smoke-1)]"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"p-sm","my-sm","rounded","flex","items-center","justify-center","gap-sm","bg-[color-mix(in","srgb,#ef444410%,transparent)]","text-red-500","border","border-[color-mix(in","srgb,#ef444430%,transparent)]"],[3,"value"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"span",2),n(3,"storefront"),t(),i(4,"div",3)(5,"h1"),n(6,"Catalogo Prodotti"),t(),i(7,"p",4),n(8,"Gestisci i prodotti del tuo catalogo fornitore"),t()()(),i(9,"div",5)(10,"div",6)(11,"div",7)(12,"span",2),n(13,"inventory"),t(),i(14,"h3",8),n(15,"Prodotti Totali"),t()(),i(16,"div",9),n(17),t()(),i(18,"div",6)(19,"div",7)(20,"span",2),n(21,"check_circle"),t(),i(22,"h3",8),n(23,"Prodotti Disponibili"),t()(),i(24,"div",9),n(25),t()(),i(26,"div",6)(27,"div",7)(28,"span",2),n(29,"euro"),t(),i(30,"h3",8),n(31,"Valore Catalogo"),t()(),i(32,"div",9),n(33),C(34,"number"),t()()(),i(35,"div",10)(36,"div",11)(37,"div",12)(38,"label",13),n(39,"Cerca Prodotti"),t(),i(40,"input",14),s("input",function(f){return a.onSearchChange(f.target.value)}),t()(),i(41,"div",12)(42,"label",13),n(43,"Ordina per"),t(),i(44,"select",15),s("change",function(f){return a.onSortChange(f.target.value)}),i(45,"option",16),n(46,"Nome"),t(),i(47,"option",17),n(48,"Prezzo"),t()()(),i(49,"div",12)(50,"label",18)(51,"input",19),s("change",function(){return a.toggleAvailableFilter()}),t(),n(52," Mostra solo prodotti disponibili "),t()()(),i(53,"div",20)(54,"button",21),s("click",function(){return a.newProduct()}),m(55,"lucide-angular",22),n(56," Nuovo Prodotto "),t()()(),i(57,"div",23)(58,"div",24)(59,"table",25)(60,"thead")(61,"tr")(62,"th"),n(63,"Nome Prodotto"),t(),i(64,"th"),n(65,"Descrizione"),t(),i(66,"th"),n(67,"Prezzo Unitario"),t(),i(68,"th"),n(69,"Quantit\xE0 Confezione"),t(),i(70,"th"),n(71,"Unit\xE0"),t(),i(72,"th"),n(73,"Stato"),t(),i(74,"th"),n(75,"Azioni"),t()()(),i(76,"tbody"),u(77,ee,5,0,"tr",26)(78,te,27,12,"tr",27)(79,ne,10,2,"tr",26),t()()()(),u(80,se,71,18,"div",28),t()),e&2&&(o(17),v(a.products.length),o(8),v(a.availableProductsCount),o(8),h("\u20AC",k(34,11,a.totalProductsValue,"1.2-2")),o(7),d("value",a.searchTerm),o(4),d("value",a.sortBy),o(7),d("checked",a.showAvailableOnly),o(4),d("size",20),o(22),d("ngIf",a.isLoading),o(),d("ngForOf",a.filteredProducts),o(),d("ngIf",!a.isLoading&&a.filteredProducts.length===0),o(),d("ngIf",a.showProductForm))},dependencies:[T,F,O,R,U,G,$,N,D,z,B,q,A,Y,L,j,K,J,M],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:1000;padding:var(--gap-sm);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.modal-content[_ngcontent-%COMP%]{background:var(--background);border-radius:24px;padding:var(--gap-lg);max-width:800px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 40px #0000004d,0 0 0 1px var(--smoke-1);animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.2,.9,.2,1);position:relative}.modal-close[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:var(--gap-sm);border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.modal-close[_ngcontent-%COMP%]:hover{background:var(--smoke-1);color:var(--text-color)}.modal-body[_ngcontent-%COMP%]{padding:var(--gap-md) 0}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.ingredient-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:700px}.product-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:600px}.supplier-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:500px}.confirmation-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:400px;text-align:center}.confirmation-modal[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);justify-content:center;margin-top:var(--gap-lg)}.full-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh}@media (max-width: 768px){.modal-overlay[_ngcontent-%COMP%]{padding:var(--gap-sm);align-items:flex-end}.modal-content[_ngcontent-%COMP%]{border-radius:24px 24px 0 0;max-height:85vh;animation:slideUpMobile .3s cubic-bezier(.2,.9,.2,1)}@keyframes slideUpMobile{0%{opacity:0;transform:translateY(100%)}to{opacity:1;transform:translateY(0)}}.modal-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:var(--gap-sm)}.modal-close[_ngcontent-%COMP%]{position:absolute;top:var(--gap-md);right:var(--gap-md)}}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--smoke-1);border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary);border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:color-mix(in srgb,var(--primary) 80%,black)}"]})};export{Z as SupplierIngredients};
