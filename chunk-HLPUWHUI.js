import{a as n}from"./chunk-XJU7QOT3.js";import{ba as s,f as o,za as l}from"./chunk-UE7YVF6I.js";var c=class i extends n{getTableName(){return"tables"}loadData(){return o(this,null,function*(){try{let r=yield this.getCurrentRestaurantId();if(!r)return;let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",r).eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;this.dataSubject.next(e||[])}catch(r){console.error(`Error loading ${this.getTableName()}:`,r)}})}getTables(){return this.dataSubject.value}getTablesByFloorPlan(r){return this.dataSubject.value.filter(e=>e.floor_plan_id===r)}createTable(r){return o(this,null,function*(){try{console.log("\u{1F4DD} Creating table with shape:",r.shape);let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from("tables").insert(r).select().single();if(t)throw console.error("\u274C Error creating table:",t),console.error("\u274C Error details:",t.details),t;return console.log("\u2705 Table created successfully"),yield this.loadData(),e}catch(e){return console.error("\u{1F4A5} Error in createTable:",e),null}})}updateTable(r,e){return o(this,null,function*(){try{let{error:t}=yield this.supabaseService.getSupabaseClient().from("tables").update(e).eq("id",r);if(t)throw t;return yield this.loadData(),!0}catch(t){return console.error("\u274C Error updating table:",t),!1}})}deleteTable(r){return o(this,null,function*(){try{let{error:e}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_active:!1}).eq("id",r);if(e)throw e;return yield this.loadData(),!0}catch(e){return console.error("\u274C Error deleting table:",e),!1}})}checkTableOverlap(r,e){let t=this.getTablesByFloorPlan(r.floor_plan_id).filter(a=>a.id!==e);for(let a of t)if(this.doTablesOverlap(r,a))return!0;return!1}doTablesOverlap(r,e){return!(r.position_x+r.width<=e.position_x||r.position_x>=e.position_x+e.width||r.position_y+r.height<=e.position_y||r.position_y>=e.position_y+e.height)}updateTableOnlineBookable(r,e){return o(this,null,function*(){try{let{error:t}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_online_bookable:e}).eq("id",r);if(t)throw t;return yield this.loadData(),!0}catch(t){return console.error("\u274C Error updating table online bookable status:",t),!1}})}getTablesAvailableForOnlineBooking(r){return this.getTablesByFloorPlan(r).filter(e=>e.is_online_bookable&&!e.is_merged&&e.is_active)}getVisibleTablesByFloorPlan(r){let e=this.getTablesByFloorPlan(r),t=e.filter(a=>!a.is_merged||a.parent_table_id===null);return console.log("\u{1F50D} DEBUG getVisibleTablesByFloorPlan:",{floorPlanId:r,allTablesCount:e.length,visibleTablesCount:t.length,allTables:e,visibleTables:t}),t}static \u0275fac=(()=>{let r;return function(t){return(r||(r=l(i)))(t||i)}})();static \u0275prov=s({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};
