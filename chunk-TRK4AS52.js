import{a as A}from"./chunk-DJ6AUBQX.js";import{a as U}from"./chunk-VNQV2R5V.js";import{b as F,d as N,h as $,q as D,r as Q,s as j,x as B}from"./chunk-I5RQKTUS.js";import{b as z}from"./chunk-76ZPEF4E.js";import{b as V}from"./chunk-PJAEBTL6.js";import{e as L}from"./chunk-WICVJICE.js";import{j as k,k as I,s as T}from"./chunk-TSXPCGVK.js";import{Ab as R,Ba as P,Db as a,Ea as o,Eb as h,Fb as f,Jb as S,Kb as O,Lb as w,Ua as b,Vb as E,Za as g,ba as x,fb as c,ga as m,gb as r,ha as _,hb as i,ob as v,rb as u,t as y,tb as d,yb as M}from"./chunk-HZF257L5.js";import{j as C}from"./chunk-4ZZIO3ZI.js";function H(n,t){if(n&1&&(r(0,"option",28),a(1),i()),n&2){let e=t.$implicit;c("value",e),o(),f(" ",e," ")}}function Y(n,t){if(n&1&&(r(0,"option",28),a(1),i()),n&2){let e=t.$implicit;c("value",e.code),o(),f(" ",e.name," ")}}function G(n,t){if(n&1){let e=v();r(0,"button",29),u("click",function(){let l=m(e).$implicit,p=d();return _(p.onCuisineFilter(l))}),a(1),i()}if(n&2){let e=t.$implicit,s=d();R("active",s.selectedCuisine===e),o(),f(" ",e," ")}}function J(n,t){n&1&&(r(0,"p"),a(1," Prova a modificare i filtri di ricerca "),i())}function K(n,t){n&1&&(r(0,"p"),a(1," Al momento non ci sono ristoranti disponibili "),i())}function X(n,t){if(n&1){let e=v();r(0,"button",33),u("click",function(){m(e);let l=d(2);return _(l.resetFilters())}),r(1,"span",13),a(2,"refresh"),i(),a(3," Mostra tutti i ristoranti "),i()}}function Z(n,t){if(n&1&&(r(0,"div",30)(1,"span",13),a(2,"restaurant"),i(),r(3,"h3"),a(4,"Nessun ristorante trovato"),i(),g(5,J,2,0,"p",31)(6,K,2,0,"p",31)(7,X,4,0,"button",32),i()),n&2){let e=d();o(5),c("ngIf",e.searchQuery||e.selectedCuisine),o(),c("ngIf",!e.searchQuery&&!e.selectedCuisine),o(),c("ngIf",e.searchQuery||e.selectedCuisine)}}function ee(n,t){if(n&1){let e=v();r(0,"img",52),u("error",function(l){m(e);let p=d(3);return _(p.onImageError(l))}),i()}if(n&2){let e=d().$implicit;c("src",e.cover_image_url,P)("alt",e.name)}}function te(n,t){n&1&&(r(0,"div",53)(1,"span",13),a(2,"restaurant"),i(),r(3,"p"),a(4,"Immagine non disponibile"),i()())}function ie(n,t){if(n&1){let e=v();r(0,"div",54)(1,"img",52),u("error",function(l){m(e);let p=d(3);return _(p.onLogoError(l))}),i()()}if(n&2){let e=d().$implicit;o(),c("src",e.logo_url,P)("alt",e.name)}}function ne(n,t){if(n&1&&(r(0,"p",55),a(1),i()),n&2){let e=d().$implicit;o(),f(" ",e.cuisine_type," ")}}function re(n,t){if(n&1&&(r(0,"p",56),a(1),i()),n&2){let e=d().$implicit,s=d(2);o(),f(" ",s.truncateText(e.description,120)," ")}}function ae(n,t){if(n&1&&(r(0,"div",57)(1,"span",13),a(2,"place"),i(),r(3,"span",58),a(4),i()()),n&2){let e=d().$implicit,s=d(2);o(4),h(s.truncateText(e.address,30))}}function se(n,t){if(n&1&&(r(0,"div",57)(1,"span",13),a(2,"phone"),i(),r(3,"span",58),a(4),i()()),n&2){let e=d().$implicit;o(4),h(e.phone)}}function oe(n,t){n&1&&(r(0,"span",59)(1,"span",13),a(2,"event_available"),i(),a(3," Prenotazioni "),i())}function le(n,t){n&1&&(r(0,"span",59)(1,"span",13),a(2,"table_restaurant"),i(),a(3," Selezione Tavolo "),i())}function ce(n,t){n&1&&(r(0,"span",59)(1,"span",13),a(2,"delivery_dining"),i(),a(3," Delivery "),i())}function pe(n,t){n&1&&(r(0,"span",59)(1,"span",13),a(2,"takeout_dining"),i(),a(3," Takeaway "),i())}function de(n,t){if(n&1){let e=v();r(0,"div",36),u("click",function(){let l=m(e).$implicit,p=d(2);return _(p.viewRestaurantDetails(l.id))}),r(1,"div",37),g(2,ee,1,2,"img",38)(3,te,5,0,"ng-template",null,0,E),r(5,"div",39)(6,"button",40),u("click",function(l){let p=m(e).$implicit,q=d(2);return _(q.viewRestaurantMap(p.id,l))}),r(7,"span",13),a(8,"map"),i(),a(9," Visualizza Mappa "),i()()(),r(10,"div",41)(11,"div",42),g(12,ie,2,2,"div",43),r(13,"div",44)(14,"h3",45),a(15),i(),g(16,ne,2,1,"p",46),i()(),g(17,re,2,1,"p",47),r(18,"div",48),g(19,ae,5,1,"div",49)(20,se,5,1,"div",49),i(),r(21,"div",50),g(22,oe,4,0,"span",51)(23,le,4,0,"span",51)(24,ce,4,0,"span",51)(25,pe,4,0,"span",51),i()()()}if(n&2){let e=t.$implicit,s=M(4);o(2),c("ngIf",e.cover_image_url)("ngIfElse",s),o(10),c("ngIf",e.logo_url),o(3),h(e.name),o(),c("ngIf",e.cuisine_type),o(),c("ngIf",e.description),o(2),c("ngIf",e.address),o(),c("ngIf",e.phone),o(2),c("ngIf",e.allow_table_selection),o(),c("ngIf",e.allow_table_selection),o(),c("ngIf",e.accepts_delivery),o(),c("ngIf",e.accepts_takeaway)}}function ge(n,t){if(n&1&&(r(0,"div",34),g(1,de,26,12,"div",35),i()),n&2){let e=d();o(),c("ngForOf",e.paginatedRestaurants)}}function ue(n,t){if(n&1){let e=v();r(0,"div",60)(1,"button",61),u("click",function(){m(e);let l=d();return _(l.previousPage())}),r(2,"span",13),a(3,"chevron_left"),i(),a(4," Precedente "),i(),r(5,"span",62),a(6),i(),r(7,"button",61),u("click",function(){m(e);let l=d();return _(l.nextPage())}),a(8," Successivo "),r(9,"span",13),a(10,"chevron_right"),i()()()}if(n&2){let e=d();o(),c("disabled",e.currentPage===1),o(5),f(" Pagina ",e.currentPage," "),o(),c("disabled",e.currentPage*e.pageSize>=e.filteredRestaurants.length)}}var W=class n{restaurantPublicService=x(U);geographyService=x(A);authService=x(z);supabaseService=x(V);router=x(L);restaurants=[];filteredRestaurants=[];loading=!0;imageErrorCount=0;maxRetries=2;searchQuery="";selectedCuisine="";cuisineTypes=[];regions=[];filteredProvinces=[];selectedRegion="";selectedProvince="";allProvinces=[];showMapModal=!1;selectedRestaurantName="";restaurantMaps=[];loadingMaps=!1;currentPage=1;pageSize=9;ngOnInit(){return C(this,null,function*(){this.restaurants=yield this.restaurantPublicService.loadRestaurantsByCuisine(),this.filteredRestaurants=[...this.restaurants];let t=yield y(this.geographyService.getFilteredProvinces());this.allProvinces=t,this.regions=[...new Set(t.map(e=>e.region))].sort(),yield this.setDefaultUserProvince(t),this.filterRestaurants(),this.cuisineTypes=[...new Set(this.restaurants.map(e=>e.cuisine_type).filter(Boolean))],this.loading=!1})}filterRestaurants(){let t=this.restaurants;if(this.searchQuery){let e=this.searchQuery.toLowerCase();t=t.filter(s=>s.name?.toLowerCase().includes(e)||s.cuisine_type?.toLowerCase().includes(e)||s.address?.toLowerCase().includes(e)||s.description?.toLowerCase().includes(e))}this.selectedCuisine&&(t=t.filter(e=>e.cuisine_type===this.selectedCuisine)),this.selectedProvince&&(t=t.filter(e=>e.province===this.selectedProvince)),this.filteredRestaurants=t,this.currentPage=1}onSearchChange(){this.filterRestaurants()}onCuisineFilter(t){this.selectedCuisine=t===this.selectedCuisine?"":t,this.filterRestaurants()}nextPage(){this.currentPage*this.pageSize<this.filteredRestaurants.length&&this.currentPage++}previousPage(){this.currentPage>1&&this.currentPage--}get paginatedRestaurants(){let t=(this.currentPage-1)*this.pageSize;return this.filteredRestaurants.slice(t,t+this.pageSize)}viewRestaurantMap(t,e){e&&e.stopPropagation(),console.log("Navigating to restaurant map:",t),this.router.navigate(["/customer/restaurant",t,"map"])}truncateText(t,e){return t?t.length<=e?t:t.substring(0,e)+"...":""}onImageError(t){let e=t.target;if(this.imageErrorCount++,this.imageErrorCount>this.maxRetries||e.src.includes("placeholder")){e.style.display="none";return}e.src="assets/images/restaurant-placeholder.jpg"}onLogoError(t){let e=t.target;e.style.display="none"}viewRestaurantDetails(t){this.router.navigate(["/customer/restaurant",t])}loadRegions(){this.geographyService.getFilteredProvinces().subscribe(t=>{this.regions=[...new Set(t.map(e=>e.region))].sort()})}filterProvincesByRegion(t){this.filteredProvinces=t?this.allProvinces.filter(e=>e.region===t):[...this.allProvinces]}setDefaultUserProvince(t){return C(this,null,function*(){let e=this.authService.currentUserValue;if(!e){this.filteredProvinces=t;return}let s=e.province;if(!s)try{let{data:l,error:p}=yield this.supabaseService.getSupabaseClient().from("users").select("province").eq("id",e.id).single();!p&&l&&(s=l.province)}catch(l){console.warn("Errore nel recupero provincia utente",l)}if(s){this.selectedProvince=s;let l=t.find(p=>p.code===s);l?(this.selectedRegion=l.region,this.filteredProvinces=t.filter(p=>p.region===this.selectedRegion)):(this.selectedRegion="",this.filteredProvinces=t)}else this.filteredProvinces=t})}onRegionChange(t){this.selectedRegion=t,this.selectedProvince="",this.filterProvincesByRegion(t),this.filterRestaurants()}onProvinceChange(t){this.selectedProvince=t,t?this.geographyService.getFilteredProvinces().subscribe(e=>{let s=e.find(l=>l.code===t);s&&(this.selectedRegion=s.region,this.filterProvincesByRegion(this.selectedRegion)),this.filterRestaurants()}):this.filterRestaurants()}resetFilters(){this.searchQuery="",this.selectedCuisine="",this.selectedRegion="",this.selectedProvince="",this.filteredProvinces=this.allProvinces,this.filterRestaurants()}applyFilters(){let t=this.restaurants;this.selectedProvince&&(t=t.filter(e=>e.province===this.selectedProvince)),this.filteredRestaurants=t}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["app-restaurant-list"]],decls:55,vars:9,consts:[["placeholderImage",""],[1,"restaurant-list-page"],[1,"page-container"],[1,"header-card"],[1,"section-header","ricercaristoranti"],[1,"flex","gap-sm"],[1,"avatartondo","bg-gradient"],[1,"material-icons","text-md"],[1,"section-title"],[1,"header-subtitle"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"material-icons"],[1,"standard-select",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-sm"],[1,"material-icons","text-md","text-primary"],["type","text","placeholder","Cerca ristorante, cucina, zona...",1,"search-input",3,"ngModelChange","input","ngModel"],[1,"flex-col"],[1,"flex","flex-wrap","gap-sm"],["class","filter-chip",3,"active","click",4,"ngFor","ngForOf"],[1,"flex","p-lg"],[1,"promethea-button","ghost",3,"click"],["class","text-center p-xl opacity-70",4,"ngIf"],["class","restaurants-grid",4,"ngIf"],["class","pagination",4,"ngIf"],[3,"value"],[1,"filter-chip",3,"click"],[1,"text-center","p-xl","opacity-70"],[4,"ngIf"],["class","promethea-button primary",3,"click",4,"ngIf"],[1,"promethea-button","primary",3,"click"],[1,"restaurants-grid"],["class","restaurant-card",3,"click",4,"ngFor","ngForOf"],[1,"restaurant-card",3,"click"],[1,"restaurant-image"],[3,"src","alt","error",4,"ngIf","ngIfElse"],[1,"restaurant-overlay"],[1,"view-map-button",3,"click"],[1,"restaurant-info"],[1,"restaurant-header-inner"],["class","restaurant-logo",4,"ngIf"],[1,"restaurant-details"],[1,"card-title"],["class","restaurant-cuisine",4,"ngIf"],["class","restaurant-description",4,"ngIf"],[1,"restaurant-meta"],["class","meta-item",4,"ngIf"],[1,"restaurant-features"],["class","feature-tag",4,"ngIf"],[3,"error","src","alt"],[1,"image-placeholder"],[1,"restaurant-logo"],[1,"restaurant-cuisine"],[1,"restaurant-description"],[1,"meta-item"],[1,"meta-text"],[1,"feature-tag"],[1,"pagination"],[1,"pagination-button",3,"click","disabled"],[1,"pagination-info"]],template:function(e,s){e&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"span",7),a(7,"restaurant"),i()(),r(8,"div")(9,"h1",8),a(10,"Scopri i Ristoranti"),i(),r(11,"p",9),a(12,"Trova il ristorante perfetto per la tua serata"),i()()()()(),r(13,"div",10)(14,"div",11)(15,"label",12)(16,"span",13),a(17,"public"),i(),a(18," Regione "),i(),r(19,"select",14),u("ngModelChange",function(p){return s.onRegionChange(p)}),r(20,"option",15),a(21,"Tutte le regioni"),i(),g(22,H,2,2,"option",16),i()(),r(23,"div",11)(24,"label",12)(25,"span",13),a(26,"map"),i(),a(27," Provincia "),i(),r(28,"select",14),u("ngModelChange",function(p){return s.onProvinceChange(p)}),r(29,"option",15),a(30,"Tutte le province"),i(),g(31,Y,2,2,"option",16),i()()(),r(32,"div",10)(33,"div",11)(34,"div",12),a(35,"Ricerca Ristoranti:"),i(),r(36,"div",17)(37,"span",18),a(38,"search"),i(),r(39,"input",19),w("ngModelChange",function(p){return O(s.searchQuery,p)||(s.searchQuery=p),p}),u("input",function(){return s.onSearchChange()}),i()()(),r(40,"div",11)(41,"div",20)(42,"div",12),a(43,"Filtra per cucina:"),i(),r(44,"div",21),g(45,G,2,3,"button",22),i()()(),r(46,"div",23)(47,"button",24),u("click",function(){return s.resetFilters()}),r(48,"span",13),a(49,"clear"),i(),a(50," Reset "),i()()()(),r(51,"div",2),g(52,Z,8,3,"div",25)(53,ge,2,1,"div",26)(54,ue,11,3,"div",27),i()()),e&2&&(o(19),c("ngModel",s.selectedRegion),o(3),c("ngForOf",s.regions),o(6),c("ngModel",s.selectedProvince),o(3),c("ngForOf",s.filteredProvinces),o(8),S("ngModel",s.searchQuery),o(6),c("ngForOf",s.cuisineTypes),o(7),c("ngIf",!s.loading&&s.filteredRestaurants.length===0),o(),c("ngIf",!s.loading&&s.filteredRestaurants.length>0),o(),c("ngIf",s.filteredRestaurants.length>0))},dependencies:[T,k,I,B,Q,j,F,D,N,$],styles:[".restaurant-list-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--background)}.restaurant-header[_ngcontent-%COMP%]{margin-bottom:var(--gap-lg)}.ricercaristoranti[_ngcontent-%COMP%]{background:var(--smoke-1)}.restaurants-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:var(--gap-lg);margin-bottom:var(--gap-lg)}.restaurant-card[_ngcontent-%COMP%]{background:var(--background);border-radius:16px;overflow:hidden;box-shadow:0 4px 12px var(--smoke-1);transition:all .3s cubic-bezier(.2,.9,.2,1);cursor:pointer;border:1px solid var(--smoke-1);position:relative}.restaurant-card[_ngcontent-%COMP%]:hover{transform:translateY(-8px);box-shadow:0 8px 24px var(--shadow-2);border-color:var(--primary)}.restaurant-image[_ngcontent-%COMP%]{position:relative;height:200px;overflow:hidden;border-radius:16px 16px 0 0}.restaurant-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transition:transform .3s ease}.restaurant-card[_ngcontent-%COMP%]:hover   .restaurant-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:scale(1.05)}.restaurant-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease;border-radius:16px 16px 0 0}.restaurant-card[_ngcontent-%COMP%]:hover   .restaurant-overlay[_ngcontent-%COMP%]{opacity:1}.view-map-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);padding:var(--gap-md) var(--gap-lg);background:var(--primary);color:#fff;border:none;border-radius:50px;font-weight:600;cursor:pointer;transition:all .3s ease}.view-map-button[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 80%,black);transform:scale(1.05)}.restaurant-info[_ngcontent-%COMP%]{padding:var(--gap-lg)}.restaurant-header-inner[_ngcontent-%COMP%]{display:flex;gap:var(--gap-md);margin-bottom:var(--gap-md)}.restaurant-logo[_ngcontent-%COMP%]{flex-shrink:0}.restaurant-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:8px;object-fit:cover;border:2px solid var(--smoke-1)}.restaurant-details[_ngcontent-%COMP%]{flex:1;min-width:0}.restaurant-cuisine[_ngcontent-%COMP%]{font-size:var(--fs-sm);color:var(--primary);font-weight:600;margin:0}.restaurant-description[_ngcontent-%COMP%]{color:var(--text-muted);margin:0 0 var(--gap-md) 0;line-height:1.5}.restaurant-meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm);margin-bottom:var(--gap-md)}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);font-size:var(--fs-sm)}.meta-item[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px;color:var(--text-muted);flex-shrink:0}.meta-text[_ngcontent-%COMP%]{color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.restaurant-features[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:var(--gap-sm)}.feature-tag[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:4px 8px;background:var(--smoke-1);border-radius:6px;font-size:.75rem;color:var(--text-color)}.feature-tag[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:14px}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:var(--gap-xl);color:var(--text-muted)}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:40px;height:40px;border:3px solid color-mix(in srgb,var(--primary) 15%,transparent);border-radius:50%;border-top-color:var(--primary);animation:_ngcontent-%COMP%_spin 1s ease-in-out infinite;margin-bottom:var(--gap-md)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--gap-xl);color:var(--text-muted)}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:64px;margin-bottom:var(--gap-md);opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 var(--gap-sm) 0;color:var(--text-color)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 var(--gap-lg) 0}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:var(--gap-lg);padding:var(--gap-lg) 0}.pagination-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);padding:var(--gap-sm) var(--gap-md);background:var(--background);border:1px solid var(--smoke-1);border-radius:8px;color:var(--text-color);cursor:pointer;transition:all .3s cubic-bezier(.2,.9,.2,1)}.pagination-button[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--primary);color:var(--primary);transform:translateY(-2px)}.pagination-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.pagination-info[_ngcontent-%COMP%]{color:var(--text-muted);font-size:var(--fs-sm)}.image-placeholder[_ngcontent-%COMP%]{width:100%;height:200px;background:var(--smoke-1);display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-muted);border-radius:16px 16px 0 0}.image-placeholder[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:8px;color:var(--text-muted)}.image-placeholder[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.filter-chip[_ngcontent-%COMP%]{border-radius:999px;font-size:var(--fs-sm);font-weight:600;background:var(--smoke-1);border:1px solid var(--smoke-1);text-transform:capitalize;align-items:center;text-align:center;color:var(--text-color);padding:calc(var(--gap-sm) /2) var(--gap-sm)}.filter-chip[_ngcontent-%COMP%]:active, .filter-chip[_ngcontent-%COMP%]:focus{background:var(--gradiente)!important}@media (max-width: 768px){.restaurants-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.restaurant-header-inner[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:var(--gap-sm)}.restaurant-logo[_ngcontent-%COMP%]{align-self:center}.pagination[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gap-md)}}@media (max-width: 480px){.restaurant-info[_ngcontent-%COMP%]{padding:var(--gap-md)}.restaurant-features[_ngcontent-%COMP%]{justify-content:center}.empty-state[_ngcontent-%COMP%]{padding:var(--gap-lg)}}"]})};export{W as RestaurantList};
