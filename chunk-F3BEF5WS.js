import{a as Ke}from"./chunk-NUBJZEUZ.js";import{a as Xe}from"./chunk-A73SDPYO.js";import{a as et}from"./chunk-D2R4X6CG.js";import{a as Ge}from"./chunk-6M52EGRH.js";import{a as Ue}from"./chunk-UDDH3K6K.js";import{a as me,b as ue,c as Ye,d as pe}from"./chunk-UGJ6CWPF.js";import{a as Ze}from"./chunk-M7LRT77K.js";import{a as Je}from"./chunk-2PH3SMNA.js";import{a as tt}from"./chunk-TC3GERLA.js";import{a as _e}from"./chunk-O3MMBNXC.js";import{a as Qe}from"./chunk-U54A6EW2.js";import"./chunk-VUEJXLA3.js";import{a as $e}from"./chunk-ET44XX2C.js";import{a as We}from"./chunk-AMYEPXIV.js";import{a as Q}from"./chunk-SY2ZWW6D.js";import{Ab as ce,zb as se}from"./chunk-N3VPFYDE.js";import{a as je}from"./chunk-H4E5DJY3.js";import{A as le,b as ie,d as re,e as Le,g as Ne,i as ae,j as qe,s as ne,t as oe,u as de,x as Be}from"./chunk-45CSFDAZ.js";import{b as ze,d as $}from"./chunk-TB7INTC7.js";import"./chunk-Q3EITIAW.js";import"./chunk-RC3HHTXM.js";import{k as X,l as ee,o as Ve,r as He,s as Re,u as Ae,v as te}from"./chunk-MPTEMNWF.js";import{Eb as Ce,Fb as we,Gb as Se,Hb as z,Ib as l,Jb as D,Kb as v,La as d,Lb as L,Mb as B,Ob as y,Pb as T,Qb as E,Sb as W,Va as U,Vb as M,Xb as k,Y as j,Yb as ye,Zb as Y,_a as f,a as Ie,ca as b,dc as J,gb as m,hb as q,ib as F,kb as Z,la as u,lc as K,ma as p,na as Pe,qb as a,rb as n,sa as be,sb as O,ta as G,tb as H,ub as R,vb as w,wa as De,xa as Fe,yb as g,z as ke,zb as c}from"./chunk-5BU4UD4M.js";import{a as V,b as N,g as h}from"./chunk-RA2WU32H.js";var ve=class o extends We{getTableName(){return"tables"}calculateTableStatus(t){return h(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return[];let i=t.map(S=>S.id),r=new Date().toISOString().split("T")[0],{data:s,error:_}=yield this.supabaseService.getSupabaseClient().from("order_headers").select(`
          *,
          comande (*)
        `).eq("restaurant_id",e).eq("status","active").in("table_id",i);_&&console.error("Errore order headers:",_);let{data:x,error:C}=yield this.supabaseService.getSupabaseClient().from("reservations").select("*").eq("restaurant_id",e).eq("reservation_date",r).in("status",["confirmed","pending"]).in("table_id",i);return C&&console.error("Errore prenotazioni:",C),t.map(S=>{let I=(s||[]).filter(A=>A.table_id===S.id),Ee=(x||[]).filter(A=>A.table_id===S.id),fe="free",Oe=null,xe=[],Me=null;return I.length>0?(fe="occupied",Me=I[0].id,I.forEach(A=>{if(A.comande&&A.comande.length>0){let at=A.comande.map(P=>N(V({},P),{restaurant_id:P.restaurant_id||e,order_header_id:P.order_header_id||A.id,table_id:P.table_id||S.id,subtotal:P.subtotal||0,tax_amount:P.tax_amount||0,discount_amount:P.discount_amount||0,total_amount:P.total_amount||0,created_at:P.created_at,updated_at:P.updated_at,customer_name:P.customer_name||null,customer_phone:P.customer_phone||null,customer_notes:P.customer_notes||null,order_type:P.order_type||"dine_in",status:P.status||"ordered"}));xe=xe.concat(at)}})):Ee.length>0&&(fe="reserved",Oe=Ee[0]),{table:S,status:fe,currentReservation:Oe,currentOrders:xe,tavolataId:Me}})}catch(e){return console.error("\u274C Errore calcolo stato tavoli:",e),[]}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Pe(o)))(i||o)}})();static \u0275prov=j({token:o,factory:o.\u0275fac,providedIn:"root"})};var st=()=>({id:"all",name:"\u{1F37D}\uFE0F Tutti i piatti"}),ct=()=>[];function mt(o,t){o&1&&O(0,"app-loader",35),o&2&&m("isLoading",!0)}function ut(o,t){if(o&1&&(a(0,"option",36),l(1),M(2,"number"),n()),o&2){let e=t.$implicit,i=c(2);m("value",e.id),d(),B(" Comanda ",e.comanda_number," (",i.getComandaTotalQuantity(e)," piatti) - \u20AC",k(2,4,i.getComandaTotal(e),"1.2-2")," ")}}function pt(o,t){o&1&&(a(0,"span",44),l(1," Menu Dedicato "),n())}function _t(o,t){o&1&&(a(0,"span"),l(1," Seleziona Menu "),n())}function vt(o,t){if(o&1&&(a(0,"div",45)(1,"div",46)(2,"span",47),l(3,"event_available"),n(),a(4,"span",48),l(5),n(),a(6,"span",49),l(7,"Dedicato"),n()()()),o&2){let e=c(3);d(5),D(e.dedicatedMenu.name)}}function gt(o,t){o&1&&(a(0,"span",54)(1,"span",55),l(2,"star"),n(),l(3," Default "),n())}function ht(o,t){if(o&1&&(a(0,"div",51)(1,"div",52)(2,"div",46)(3,"span",15),l(4,"restaurant_menu"),n(),a(5,"span",48),l(6),n()(),f(7,gt,4,0,"span",53),n()()),o&2){let e=c(4);d(6),D(e.globalMenus[0].name),d(),m("ngIf",e.globalMenus[0].is_default)}}function ft(o,t){if(o&1&&(a(0,"option",56),l(1),n()),o&2){let e=t.$implicit;m("ngValue",e),d(),L(" ",e.is_default?"\u2B50 ":"","",e.name," ")}}function xt(o,t){if(o&1){let e=w();a(0,"div")(1,"select",21),E("ngModelChange",function(r){u(e);let s=c(4);return T(s.selectedMenu,r)||(s.selectedMenu=r),p(r)}),g("ngModelChange",function(r){u(e);let s=c(4);return p(s.onMenuSelectChange(r))}),a(2,"option",56),l(3," \u{1F37D}\uFE0F Tutti i piatti "),n(),f(4,ft,2,3,"option",57),n()()}if(o&2){let e=c(4);d(),y("ngModel",e.selectedMenu),d(),m("ngValue",W(3,st)),d(2),m("ngForOf",e.globalMenus)}}function bt(o,t){if(o&1&&(a(0,"div"),f(1,ht,8,2,"div",50)(2,xt,5,4,"div",40),n()),o&2){let e=c(3);d(),m("ngIf",e.globalMenus.length===1),d(),m("ngIf",e.globalMenus.length>1)}}function Ct(o,t){o&1&&(a(0,"div",58)(1,"span",59),l(2,"restaurant_menu"),n(),a(3,"p",60),l(4,"Nessun menu disponibile"),n()())}function wt(o,t){o&1&&(a(0,"span",62)(1,"span",55),l(2,"event_available"),n(),l(3," Dedicato "),n())}function St(o,t){if(o&1&&(a(0,"div",46),f(1,wt,4,0,"span",61),n()),o&2){let e=c(3);d(),m("ngIf",e.selectedMenu.type==="dedicated")}}function yt(o,t){if(o&1&&(a(0,"div",37)(1,"div",30)(2,"label",38)(3,"span",15),l(4,"restaurant_menu"),n(),f(5,pt,2,0,"span",39)(6,_t,2,0,"span",40),n(),f(7,vt,8,1,"div",41)(8,bt,3,2,"div",40)(9,Ct,5,0,"div",42)(10,St,2,1,"div",43),n()()),o&2){let e=c(2);d(5),m("ngIf",e.dedicatedMenu),d(),m("ngIf",!e.dedicatedMenu),d(),m("ngIf",e.dedicatedMenu),d(),m("ngIf",!e.dedicatedMenu&&e.globalMenus.length>0),d(),m("ngIf",!e.hasMenusToShow()),d(),m("ngIf",e.selectedMenu)}}function Tt(o,t){if(o&1){let e=w();a(0,"div",64),g("click",function(){let r=u(e).$implicit,s=c(3);return p(s.selectedCategory=r.id)}),a(1,"span",65),l(2),M(3,"slice"),n(),a(4,"span",66),l(5),n()()}if(o&2){let e=t.$implicit,i=c(3);F("active",i.selectedCategory===e.id),d(2),L("",ye(3,5,e.name,0,15),"",e.name.length>15?"...":"",""),d(3),D(i.getDishesCountByCategory(e.id))}}function Et(o,t){if(o&1&&(a(0,"small",66),l(1),M(2,"slice"),n()),o&2){let e=c().$implicit;d(),L(" ",ye(2,2,e.description,0,200),"",e.description.length>200?"...":""," ")}}function Ot(o,t){if(o&1){let e=w();a(0,"div",77)(1,"div",78)(2,"div",79)(3,"div",80)(4,"strong",81),l(5),n(),a(6,"div")(7,"button",82),g("click",function(){let r=u(e).$implicit,s=c(5);return p(s.addDishToOrder(r))}),O(8,"lucide-angular",83),n()()(),a(9,"span",84),l(10),M(11,"number"),n(),f(12,Et,3,6,"small",85),n()()()}if(o&2){let e=t.$implicit,i=c(5);d(5),D(e.name),d(2),m("disabled",!i.orderingStatus.allowed||!i.canAddItemsToCurrentComanda())("title",i.canAddItemsToCurrentComanda()?i.orderingStatus.allowed?"Aggiungi 1":i.orderingStatus.reason:"Comanda in stato avanzato, non modificabile"),d(),m("size",20),d(2),v("\u20AC",k(11,6,e.base_price,"1.2-2"),""),d(2),m("ngIf",i.showDescriptions&&e.description)}}function Mt(o,t){if(o&1&&(H(0),a(1,"div",71)(2,"div",72)(3,"span",73),l(4,"category"),n(),l(5),n(),a(6,"div",74),l(7),n()(),a(8,"div",75),f(9,Ot,13,9,"div",76),n(),R()),o&2){let e=t.$implicit,i=c(4);d(5),v(" ",e.category.name," "),d(2),D(e.dishes.length),d(2),m("ngForOf",e.dishes)("ngForTrackBy",i.trackByDishId)}}function It(o,t){if(o&1&&(H(0),f(1,Mt,10,4,"ng-container",70),R()),o&2){let e=c(3);d(),m("ngForOf",e.getDishesGroupedByCategory())("ngForTrackBy",e.trackByCategoryId)}}function kt(o,t){if(o&1){let e=w();a(0,"div",86)(1,"span",15),l(2,"search_off"),n(),a(3,"p",87),l(4,"Nessun piatto trovato"),n(),a(5,"button",88),g("click",function(){u(e);let r=c(3);return p(r.resetDishFilters())}),l(6," Reset filtri "),n()()}}function Pt(o,t){if(o&1){let e=w();a(0,"div",30)(1,"div",63)(2,"div",64),g("click",function(){u(e);let r=c(2);return p(r.selectedCategory="all")}),a(3,"span",65),l(4,"Tutti"),n(),a(5,"span",66),l(6),n()(),f(7,Tt,6,9,"div",67),n(),a(8,"div",68),f(9,It,2,2,"ng-container",69)(10,kt,7,0,"ng-template",null,0,Y),n()()}if(o&2){let e=z(11),i=c(2);d(2),F("active",i.selectedCategory==="all"),d(4),D(i.getDishesCountByCategory("all")),d(),m("ngForOf",i.categoryService.data.slice(0,4)),d(2),m("ngIf",i.getDishesGroupedByCategory().length>0)("ngIfElse",e)}}function Dt(o,t){if(o&1&&(a(0,"option",36),l(1),n()),o&2){let e=t.$implicit;m("value",e.id),d(),L(" Comanda ",e.comanda_number," (",(e.order_items==null?null:e.order_items.length)||0," piatti) ")}}function Ft(o,t){if(o&1&&(a(0,"div",102)(1,"span",48),l(2,"Riepilogo di tutte le comande"),n(),a(3,"span",103),l(4),n()()),o&2){let e=c(4);d(4),v(" (",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)||0," comande) ")}}function Vt(o,t){if(o&1){let e=w();H(0),a(1,"button",112),g("click",function(){u(e);let r=c().$implicit,s=c().$implicit,_=c(6);return p(_.startMoveItem(r,s.id))}),O(2,"lucide-icon",113),n(),R()}}function Ht(o,t){if(o&1&&(a(0,"option",36),l(1),n()),o&2){let e=t.$implicit;m("value",e.id),d(),v(" Comanda ",e.comanda_number," ")}}function Rt(o,t){if(o&1){let e=w();H(0),a(1,"select",114,3),g("change",function(){u(e);let r=z(2),s=c(8);return p(s.executeMove(r.value))})("blur",function(){u(e);let r=c(8);return p(r.cancelMove())}),a(3,"option",115),l(4,"Sposta in..."),n(),f(5,Ht,2,2,"option",23),n(),a(6,"button",116),g("click",function(){u(e);let r=c(8);return p(r.cancelMove())}),a(7,"span",15),l(8,"close"),n()(),R()}if(o&2){let e=c(2).$implicit,i=c(6);d(5),m("ngForOf",i.getOtherComandas(e.id))}}function At(o,t){if(o&1&&(a(0,"div",108)(1,"div",109)(2,"div",110),l(3),a(4,"div",111)(5,"span",66),l(6),M(7,"number"),n(),a(8,"span",66),l(9,"\u2022"),n(),a(10,"span",66),l(11),M(12,"number"),n()()(),a(13,"div",46),f(14,Vt,3,0,"ng-container",40)(15,Rt,9,1,"ng-container",40),n()()()),o&2){let e=t.$implicit,i=c(7);d(3),v(" ",e.dish_name||"Piatto"," "),d(3),v("\u20AC",k(7,5,e.unit_price,"1.2-2")," cad."),d(5),v("Tot: \u20AC",k(12,8,e.unit_price*e.quantity,"1.2-2"),""),d(3),m("ngIf",!i.movingItem||i.movingItem.item.id!==e.id),d(),m("ngIf",(i.movingItem==null||i.movingItem.item==null?null:i.movingItem.item.id)===e.id)}}function zt(o,t){if(o&1&&(a(0,"div",105)(1,"div",106)(2,"span",48),l(3),n(),a(4,"span",66),l(5),n()(),f(6,At,16,11,"div",107),n()),o&2){let e=t.$implicit,i=c(6);d(3),v("Comanda ",e.comanda_number,""),d(2),v("(",i.getComandaTotalQuantity(e)," piatti)"),d(),m("ngForOf",e.order_items||W(3,ct))}}function Lt(o,t){if(o&1&&(H(0),f(1,zt,7,4,"div",104),R()),o&2){let e=c(5);d(),m("ngForOf",e.orderHeader==null?null:e.orderHeader.comande)}}function Nt(o,t){if(o&1&&(H(0),f(1,Lt,2,1,"ng-container",40),R()),o&2){let e=c(4);d(),m("ngIf",e.orderHeader==null?null:e.orderHeader.comande)}}function qt(o,t){if(o&1){let e=w();a(0,"div",118)(1,"div",109)(2,"div",110)(3,"strong"),l(4),n(),a(5,"div",111)(6,"span",66),l(7),M(8,"number"),n(),a(9,"span",66),l(10,"\u2022"),n(),a(11,"span",66),l(12),M(13,"number"),n()()(),a(14,"div",46)(15,"button",119),g("click",function(r){let s=u(e).$implicit;return c(5).updateQuantity(s,-1),p(r.stopPropagation())}),a(16,"span",15),l(17,"remove"),n()(),a(18,"span",120),l(19),n(),a(20,"button",121),g("click",function(r){let s=u(e).$implicit;return c(5).updateQuantity(s,1),p(r.stopPropagation())}),O(21,"lucide-angular",83),n(),a(22,"button",122),g("click",function(r){let s=u(e).$implicit;return c(5).removeItemLocal(s),p(r.stopPropagation())}),O(23,"lucide-angular",123),n()()()()}if(o&2){let e=t.$implicit,i=c(5);d(4),D(e.dish_name||"Piatto"),d(3),v("\u20AC",k(8,9,e.unit_price,"1.2-2")," cad."),d(5),v("Tot: \u20AC",k(13,12,e.unit_price*e.quantity,"1.2-2"),""),d(3),m("disabled",!i.isItemEditable(e)),d(4),D(e.quantity),d(),m("disabled",!i.isItemEditable(e)||!i.orderingStatus.allowed),d(),m("size",20),d(),m("disabled",!i.isItemEditable(e)),d(),m("size",20)}}function Bt(o,t){if(o&1&&f(0,qt,24,15,"div",117),o&2){let e=c(4);m("ngForOf",e.displayItems)}}function Wt(o,t){if(o&1&&(H(0),a(1,"div",124)(2,"span"),l(3),n(),a(4,"strong",125),l(5),M(6,"number"),n()(),R()),o&2){let e=c(4);d(3),v("Totale generale (",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)||0," comande):"),d(2),v("\u20AC",k(6,2,e.calcolaTotaleTavolata(),"1.2-2"),"")}}function $t(o,t){if(o&1&&(H(0),f(1,Ft,5,1,"div",97)(2,Nt,2,1,"ng-container",69)(3,Bt,1,1,"ng-template",null,2,Y),a(5,"div",98)(6,"div",99)(7,"strong",100),l(8),n(),a(9,"strong",101),l(10),M(11,"number"),n()(),f(12,Wt,7,5,"ng-container",40),n(),R()),o&2){let e=z(4),i=c(3);d(),m("ngIf",i.currentComandaId==="all"),d(),m("ngIf",i.currentComandaId==="all")("ngIfElse",e),d(6),v(" ",i.currentComandaId==="all"?"Totale generale":"Totale Comanda",": "),d(2),v("\u20AC",k(11,6,i.displayTotal,"1.2-2"),""),d(2),m("ngIf",i.currentComandaId!=="all"&&i.hasMultipleComande)}}function Qt(o,t){o&1&&(a(0,"p",60),l(1," Clicca sui piatti per aggiungerli "),n())}function jt(o,t){if(o&1&&(a(0,"div",126)(1,"span",127),l(2,"restaurant_menu"),n(),a(3,"p",87),l(4),n(),f(5,Qt,2,0,"p",128),n()),o&2){let e=c(3);d(4),v(" ",e.currentComandaId==="all"?"Nessun piatto in nessuna comanda":"Nessun piatto in questa comanda"," "),d(),m("ngIf",e.currentComandaId!=="all")}}function Gt(o,t){if(o&1){let e=w();a(0,"div",89)(1,"div",90)(2,"div",91)(3,"h3",92)(4,"span",93),l(5,"receipt"),n(),l(6),n(),a(7,"span",94),l(8),n()(),a(9,"div",95)(10,"select",96),E("ngModelChange",function(r){u(e);let s=c(2);return T(s.currentComandaId,r)||(s.currentComandaId=r),p(r)}),g("ngModelChange",function(r){u(e);let s=c(2);return p(s.switchComanda(r))}),a(11,"option",22),l(12,"\u{1F4CB} Tutte le comande (riepilogo)"),n(),f(13,Dt,2,3,"option",23),n()()(),a(14,"div",90),f(15,$t,13,9,"ng-container",69)(16,jt,6,2,"ng-template",null,1,Y),n()()}if(o&2){let e=z(17),i=c(2);d(6),v(" Comanda ",(i.currentComanda==null?null:i.currentComanda.comanda_number)||"1"," "),d(2),L(" ",i.getComandaItems().length," piatt",i.getComandaItems().length!==1?"i":"o"," "),d(2),y("ngModel",i.currentComandaId),d(3),m("ngForOf",i.getComandeForDropdown()),d(2),m("ngIf",i.displayItems.length>0)("ngIfElse",e)}}function Ut(o,t){if(o&1){let e=w();a(0,"div",6),g("click",function(){u(e);let r=c();return p(r.close())}),a(1,"div",7),g("click",function(r){return u(e),p(r.stopPropagation())}),f(2,mt,1,1,"app-loader",8),a(3,"div",9)(4,"div",10)(5,"h1",11),l(6),n(),a(7,"div",12)(8,"button",13),g("click",function(){u(e);let r=c();return p(r.toggleDescriptions())}),O(9,"lucide-angular",14),n(),a(10,"button",13),g("click",function(){u(e);let r=c();return p(r.toggleComandaPage())}),a(11,"span",15),l(12),n()(),a(13,"button",16),g("click",function(){u(e);let r=c();return p(r.createNewComanda())}),a(14,"span",15),l(15,"post_add"),n()(),a(16,"button",17),g("click",function(){u(e);let r=c();return p(r.close())}),a(17,"span",15),l(18,"close"),n()()()(),a(19,"div",18)(20,"span",19),l(21),M(22,"number"),n(),a(23,"div",20)(24,"select",21),E("ngModelChange",function(r){u(e);let s=c();return T(s.currentComandaId,r)||(s.currentComandaId=r),p(r)}),g("ngModelChange",function(r){u(e);let s=c();return p(s.switchComanda(r))}),a(25,"option",22),l(26),n(),f(27,ut,3,7,"option",23),n()()()(),a(28,"div",24),f(29,yt,11,6,"div",25),a(30,"div",26)(31,"div",27)(32,"input",28),E("ngModelChange",function(r){u(e);let s=c();return T(s.dishSearchTerm,r)||(s.dishSearchTerm=r),p(r)}),n(),a(33,"div",29)(34,"button",13),g("click",function(){u(e);let r=c();return p(r.resetDishFilters())}),a(35,"span",15),l(36,"refresh"),n()()()()(),a(37,"div",30),f(38,Pt,12,6,"div",31)(39,Gt,18,7,"div",32),n()(),a(40,"div",33)(41,"button",34),g("click",function(){u(e);let r=c();return p(r.saveOrder())}),a(42,"span",15),l(43),n(),l(44),n()()()()}if(o&2){let e=c();d(),F("fullscreen-mobile",e.isMobile),d(),m("ngIf",e.isLoading),d(4),v(" Tavolo ",e.table.table_number," "),d(2),F("active",e.showDescriptions),d(),F("text-primary",e.showDescriptions),d(3),D(e.showComandaPage?"restaurant":"receipt_long"),d(),m("disabled",!e.orderHeader||!e.isComandaEditable())("title",e.isComandaEditable()?"Crea una nuova comanda nella tavolata corrente":"La comanda corrente \xE8 in stato avanzato, completa prima di crearne una nuova"),d(8),B(" ",e.getTotalePiattiTutteComande()," piatt",e.getTotalePiattiTutteComande()!==1?"i":"o"," \u2022 \u20AC",k(22,25,e.totaleTavolata,"1.2-2")," "),d(3),y("ngModel",e.currentComandaId),d(2),v(" \u{1F4CB} Tutte le comande (",e.getTotalePiattiTutteComande()," piatti) "),d(),m("ngForOf",e.getComandeForDropdown()),d(2),m("ngIf",e.hasMenusToShow()),d(3),y("ngModel",e.dishSearchTerm),d(6),m("ngIf",!e.showComandaPage),d(),m("ngIf",e.showComandaPage),d(2),m("disabled",!e.hasUnsavedChanges&&!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?e.hasUnsavedChanges?"Salva modifiche":"Nessuna modifica da salvare":e.orderingStatus.reason),d(2),D(e.hasUnsavedChanges?"save":"check_circle"),d(),v(" ",e.hasUnsavedChanges?"Salva Modifiche":"Gi\xE0 salvato"," ")}}function Zt(o,t){o&1&&O(0,"app-loader",35),o&2&&m("isLoading",!0)}function Yt(o,t){if(o&1){let e=w();a(0,"div",86)(1,"span",15),l(2,"receipt"),n(),a(3,"h3"),l(4,"Nessun ordine attivo"),n(),a(5,"p",87),l(6,"Non ci sono ordini per questo tavolo"),n(),a(7,"button",140),g("click",function(){u(e);let r=c(2);return p(r.switchToEditMode())}),O(8,"lucide-angular",83),l(9," Crea Primo Ordine "),n()()}o&2&&(d(8),m("size",20))}function Jt(o,t){if(o&1&&(a(0,"div",95)(1,"small",87),l(2),n()()),o&2){let e=c().$implicit;d(2),v("Note: ",e.item_notes,"")}}function Kt(o,t){if(o&1&&(a(0,"div",159)(1,"div",110)(2,"div",160)(3,"strong"),l(4),n(),f(5,Jt,3,1,"div",161),n(),a(6,"div",162)(7,"span"),l(8),M(9,"number"),n(),a(10,"span"),l(11,"\u2022"),n(),a(12,"span"),l(13),n()(),a(14,"span",163),l(15),n()(),a(16,"div",152)(17,"span",48),l(18),M(19,"number"),n(),a(20,"small",150),l(21,"Totale"),n()()()),o&2){let e=t.$implicit,i=c(6);d(4),D(i.getDishName(e)),d(),m("ngIf",e.item_notes),d(3),v("\u20AC",k(9,8,e.unit_price,"1.2-2")," cad."),d(5),v("Quantit\xE0: ",e.quantity,""),d(),q("background-color",i.getOrderStatusColor(e.status)),d(),v(" ",i.getOrderStatusText(e.status)," "),d(3),v("\u20AC",k(19,11,e.total_price,"1.2-2"),"")}}function Xt(o,t){if(o&1&&(a(0,"div",157),f(1,Kt,22,14,"div",158),n()),o&2){let e=c(2).$implicit;d(),m("ngForOf",e.order_items)}}function ei(o,t){o&1&&(a(0,"div",164)(1,"span",15),l(2,"restaurant_menu"),n(),a(3,"p",87),l(4,"Nessun piatto in questa comanda"),n()())}function ti(o,t){if(o&1&&(a(0,"div",98),f(1,Xt,2,1,"div",154)(2,ei,5,0,"div",155),a(3,"div",156)(4,"strong",100),l(5),n(),a(6,"strong",101),l(7),M(8,"number"),n()()()),o&2){let e=c().$implicit,i=c(3);d(),m("ngIf",e.order_items&&e.order_items.length>0),d(),m("ngIf",!e.order_items||e.order_items.length===0),d(3),v("Totale Comanda ",e.comanda_number,""),d(2),v(" \u20AC",k(8,4,i.getComandaTotal(e),"1.2-2")," ")}}function ii(o,t){if(o&1){let e=w();a(0,"div",145)(1,"div",146),g("click",function(){let r=u(e).$implicit,s=c(3);return p(s.toggleComandaExpansion(r.id))}),a(2,"div",147)(3,"div",30)(4,"div",148)(5,"h3",48),l(6),n(),a(7,"span",149),l(8),n()(),a(9,"div",150),l(10),M(11,"date"),n()()(),a(12,"div",151)(13,"div",152)(14,"span",74),l(15),M(16,"number"),n(),a(17,"span",66),l(18),n()()()(),f(19,ti,9,7,"div",153),n()}if(o&2){let e=t.$implicit,i=c(3);d(6),v("Comanda ",e.comanda_number,""),d(),q("background-color",i.getOrderStatusColor(e.status)),d(),v(" ",i.getOrderStatusText(e.status)," "),d(2),v(" ",k(11,9,e.created_at,"dd/MM/yyyy HH:mm")," "),d(5),v(" \u20AC",k(16,12,i.getComandaTotal(e),"1.2-2")," "),d(3),L(" ",(e.order_items==null?null:e.order_items.length)||0," piatto",(e.order_items==null?null:e.order_items.length)!==1?"i":""," "),d(),m("ngIf",i.isComandaExpanded(e.id))}}function ri(o,t){if(o&1&&(a(0,"div",78),f(1,ii,20,15,"div",141),a(2,"div",142)(3,"div",91)(4,"div")(5,"strong",143),l(6,"TOTALE TAVOLO"),n(),a(7,"p",144),l(8),n()(),a(9,"strong",100),l(10),M(11,"number"),n()()()()),o&2){let e=c(2);d(),m("ngForOf",e.orderHeader.comande),d(7),v(" ",e.getTotalComandeCount()," comande "),d(2),v(" \u20AC",k(11,3,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function ai(o,t){if(o&1){let e=w();a(0,"div",6),g("click",function(){u(e);let r=c();return p(r.close())}),a(1,"div",129),g("click",function(r){return u(e),p(r.stopPropagation())}),f(2,Zt,1,1,"app-loader",8),a(3,"div",130)(4,"div",46)(5,"div",131)(6,"span",15),l(7,"receipt_long"),n()(),a(8,"div")(9,"h1",132),l(10),n(),a(11,"div",111)(12,"span",94),l(13),n(),a(14,"span",133),l(15),M(16,"number"),n()()()(),a(17,"button",13),g("click",function(){u(e);let r=c();return p(r.close())}),a(18,"span",15),l(19,"close"),n()()(),a(20,"div",134),f(21,Yt,10,1,"div",135)(22,ri,12,6,"div",136),a(23,"div",137)(24,"button",138),g("click",function(){u(e);let r=c();return p(r.printBillAndFreeTable())}),a(25,"span",15),l(26,"receipt"),n(),l(27," STAMPA SCONTRINO "),n(),a(28,"button",139),g("click",function(){u(e);let r=c();return p(r.close())}),a(29,"span",15),l(30,"close"),n(),l(31," Chiudi "),n()()()()()}if(o&2){let e=c();d(),F("fullscreen-mobile",e.isMobile),d(),m("ngIf",e.isLoading),d(8),v("Ordini Tavolo ",e.table.table_number||"N/A",""),d(3),L(" ",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)||0," Ordine",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)!==1?"i":""," "),d(2),v(" Totale: \u20AC",k(16,10,e.calcolaTotaleTavolata(),"1.2-2")," "),d(6),m("ngIf",!e.orderHeader||!e.orderHeader.comande||e.orderHeader.comande.length===0),d(),m("ngIf",e.orderHeader&&e.orderHeader.comande&&e.orderHeader.comande.length>0),d(2),m("disabled",!e.orderHeader||!e.orderHeader.comande||e.orderHeader.comande.length===0)}}var ge=class o{orderHelper=b(Ye);orderHeaderService=b(pe);comandaService=b(me);orderItemService=b(ue);dishService=b($e);loadingService=b(Q);categoryService=b(Qe);menuService=b(Je);cdr=b(J);restaurantPublicService=b(je);authService=b($);orderStateService=b(Ke);tutorialService=b(_e);isTutorialStep=Fe(!1);ngZone=b(G);cachedDishGroups=[];lastDishesLength=0;lastCategoryId="";lastSearchTerm="";table;mode="edit";existingOrderHeader;orderingStatus={allowed:!0,reason:""};selectedComandaId;saved=new be;closeRequested=new be;orderHeader=null;currentComanda=null;dishes=[];currentComandaId="";isLoading=!1;restaurantData=null;movingItem=null;showDescriptions=!1;searchTerm="";selectedCategory="all";dishSearchTerm="";isMobile=!1;isNewOrder=!1;activeMenus=[];selectedMenu={id:"all",name:"Tutti i piatti"};menuDishes=[];comandeExpanded={};showComandaPage=!1;draftOrder=null;localChanges=[];hasUnsavedChanges=!1;constructor(){K(()=>{let e=this.tutorialService.currentStepData()?.id==="order-editor";e!==this.isTutorialStep()&&setTimeout(()=>{this.isTutorialStep.set(e),e&&setTimeout(()=>{this.tutorialService.refreshTooltip()},1e3)})})}ngOnInit(){return h(this,null,function*(){console.log("\u{1F504} OrderEditor init - mode:",this.mode),this.loadingService.start(),this.isLoading=!0;try{console.log("\u{1F4CA} Tavolo:",this.table?.table_number),console.log("\u{1F4E6} Existing Order Header:",this.existingOrderHeader?.id),console.log("\u{1F37D}\uFE0F Caricamento piatti..."),yield this.dishService.loadData();let t=this.dishService.getDishes(),e=this.dishService.getActiveDishes();console.log(`\u{1F50D} DEBUG Piatti: Totali=${t.length}, Attivi=${e.length}`);let i=t.filter(s=>s.deleted_at);i.length>0&&console.warn("\u26A0\uFE0F Piatti eliminati trovati:",i.map(s=>({id:s.id,name:s.name,deleted_at:s.deleted_at}))),this.dishes=this.dishService.getActiveDishes(),console.log("\u2705 Piatti attivi per order-editor:",this.dishes.length),yield this.categoryService.loadData(),yield this.loadActiveMenus(),this.mode==="view"&&this.existingOrderHeader?yield this.loadOrderForView():this.mode==="edit"&&(yield this.setupForEdit()),this.initializeComandaDropdown();let r=yield this.authService.getCurrentRestaurantId();r&&(this.restaurantData=yield this.restaurantPublicService.loadRestaurantById(r),console.log("\u{1F3E2} Dati ristorante caricati:",this.restaurantData))}catch(t){console.error("\u274C Errore inizializzazione order-editor:",t)}finally{this.loadingService.stop(),this.isLoading=!1,this.cdr.markForCheck()}})}initializeComandaDropdown(){(!this.orderHeader?.comande||this.orderHeader.comande.length===0)&&this.mode==="edit"&&this.createNewComandaLocal(),this.currentComanda?this.currentComandaId=this.currentComanda.id:this.orderHeader?.comande&&this.orderHeader.comande.length>0&&(this.currentComanda=this.orderHeader.comande[0],this.currentComandaId=this.currentComanda.id)}loadActiveMenus(){return h(this,null,function*(){try{if(yield this.menuService.loadMenus(),this.activeMenus=this.menuService.getCurrentMenus().filter(t=>t.is_active),console.log("\u{1F4CB} Menu attivi:",this.activeMenus.length),this.activeMenus.length>0){let t=this.activeMenus.find(e=>e.is_default);this.selectedMenu=t||this.activeMenus[0],yield this.loadDishesForSelectedMenu()}}catch(t){console.error("\u274C Errore caricamento menu:",t)}})}loadDishesForSelectedMenu(){return h(this,null,function*(){if(this.selectedMenu.id==="all")this.dishes=this.dishService.getActiveDishes(),this.menuDishes=[],console.log(`\u2705 Menu 'Tutti i piatti': ${this.dishes.length} piatti attivi`);else try{this.menuDishes=yield this.menuService.getDishesWithDetailsByMenu(this.selectedMenu.id),this.dishes=this.menuDishes.filter(t=>{let e=t.dish&&t.dish.id,i=t.dish?.deleted_at,r=t.dish?.status==="available"&&!i;return e&&r}).map(t=>t.dish),console.log(`\u2705 Menu '${this.selectedMenu.name}': ${this.dishes.length} piatti attivi`)}catch(t){console.error("\u274C Errore caricamento piatti menu:",t),this.dishes=this.dishService.getActiveDishes()}this.cachedDishGroups=[],this.cdr.markForCheck()})}loadOrderForView(){return h(this,null,function*(){if(this.existingOrderHeader)try{this.loadingService.start(),this.isLoading=!0,console.log("\u{1F441}\uFE0F Caricamento ordine per visualizzazione:",this.existingOrderHeader.id);let t=yield this.orderHelper.loadFullOrder(this.existingOrderHeader.id);if(t){if(this.orderHeader=t,console.log("\u2705 Ordine caricato con",t.comande?.length,"comande"),t.comande&&t.comande.forEach((e,i)=>{console.log(`\u{1F4CA} Comanda ${i+1}:`,{comanda_number:e.comanda_number,total_amount:e.total_amount,items_count:e.order_items?.length,items_total:e.order_items?.reduce((r,s)=>r+(s.total_price||0),0)})}),t.comande&&t.comande.length>0){let e=t.comande.find(i=>i.status!=="cancelled");this.currentComanda=e||t.comande[0],console.log("\u{1F4CB} Comanda corrente:",this.currentComanda?.comanda_number)}}else console.error("\u274C Ordine non trovato")}catch(t){console.error("\u274C Errore caricamento ordine:",t)}finally{this.loadingService.stop(),this.isLoading=!1}})}setupForEdit(){return h(this,null,function*(){try{if(console.log("\u270F\uFE0F Setup modalit\xE0 edit in DRAFT per tavolo:",this.table.table_number),this.existingOrderHeader)console.log("\u{1F4E6} Carico ordine esistente in draft:",this.existingOrderHeader.id),this.draftOrder=yield this.orderHelper.loadFullOrder(this.existingOrderHeader.id),this.updateOrderHeader(),this.isNewOrder=!1;else{let t=yield this.orderHeaderService.getActiveByTable(this.table.id);t?(console.log("\u2705 Tavolata esistente trovata, carico in draft"),this.draftOrder=yield this.orderHelper.loadFullOrder(t.id),this.updateOrderHeader(),this.isNewOrder=!1):(console.log("\u{1F195} Creo nuova struttura vuota in draft"),this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader(),this.isNewOrder=!0)}if(this.draftOrder?.comande&&this.draftOrder.comande.length>0){if(this.selectedComandaId){let t=this.draftOrder.comande.find(e=>e.id===this.selectedComandaId);this.currentComanda=t||this.draftOrder.comande[0],console.log("\u{1F3AF} Comanda selezionata tramite ID:",this.selectedComandaId)}else{let t=this.draftOrder.comande.slice().reverse().find(e=>e.status!=="cancelled");this.currentComanda=t||this.draftOrder.comande[0]}this.currentComanda&&(this.currentComandaId=this.currentComanda.id)}this.dishes=this.dishService.getActiveDishes(),yield this.loadActiveMenus()}catch(t){console.error("\u274C Errore setup edit:",t)}})}createEmptyOrderHeader(){return{id:"draft-"+Date.now(),restaurant_id:"",table_id:this.table.id,order_number:"DRAFT-"+this.table.table_number+"-"+Date.now(),status:"draft",customer_name:"Cliente",total_amount:0,comande:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}loadOrderForEdit(t){return h(this,null,function*(){console.log("\u{1F504} Caricamento ordine per edit:",t);let e=yield this.orderHelper.loadFullOrder(t);if(!e){console.error("\u274C Ordine non trovato per edit");return}if(this.orderHeader=e,e.comande&&e.comande.length>0){let i=e.comande.slice().reverse().find(r=>r.status!=="cancelled");this.currentComanda=i||e.comande[0],console.log("\u{1F4CB} Comanda attiva per edit:",this.currentComanda?.comanda_number)}})}createNewOrder(){return h(this,null,function*(){console.log("\u{1F195} Creazione tavolata per tavolo:",this.table.table_number);try{let t=yield this.orderHelper.occupyTable(this.table.id,"Cliente");return!t.orderHeader||!t.comanda?(console.error("\u274C Impossibile creare tavolata"),!1):(this.orderHeader=yield this.orderHelper.loadFullOrder(t.orderHeader.id),this.orderHeader?.comande&&this.orderHeader.comande.length>0&&(this.currentComanda=this.orderHeader.comande[0]),console.log("\u2705 Tavolata creata:",t.orderHeader.id),!0)}catch(t){return console.error("\u274C Errore creazione tavolata:",t),!1}})}createNewComanda(){return h(this,null,function*(){try{console.log("\u{1F195} Creazione nuova comanda in modalit\xE0 DRAFT"),this.draftOrder||(console.log("\u{1F4DD} Creo prima una struttura draft"),this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader()),yield this.createNewComandaLocal(),console.log("\u2705 Nuova comanda creata in draft")}catch(t){console.error("\u274C Errore creazione nuova comanda:",t)}})}addDish(t){return h(this,null,function*(){try{if(console.log("\u2795 Aggiungi piatto in DRAFT:",t.name),this.draftOrder||(this.draftOrder=this.createEmptyOrderHeader(),this.orderHeader=V({},this.draftOrder),this.orderHeader.comande&&(this.orderHeader.comande=[...this.orderHeader.comande])),this.currentComanda||(yield this.createNewComandaLocal()),this.currentComanda&&this.currentComanda.order_items){let r=this.currentComanda.order_items.find(s=>s.dish_id===t.id);if(r){console.log("\u{1F4C8} Piatto gi\xE0 presente, incremento quantit\xE0"),this.cdr.markForCheck(),yield this.updateQuantity(r,1);return}}if(!this.currentComanda){console.error("\u274C currentComanda \xE8 ancora null"),this.cdr.markForCheck();return}let e={id:"draft-item-"+Date.now(),order_id:this.currentComanda.id,dish_id:t.id,dish_name:t.name,quantity:1,unit_price:t.base_price,total_price:t.base_price,status:"ordered",item_notes:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};this.currentComanda.order_items||(this.currentComanda.order_items=[]),this.currentComanda.order_items.push(e),this.draftOrder.comande||(this.draftOrder.comande=[]);let i=this.draftOrder.comande.findIndex(r=>r.id===this.currentComanda.id);i>=0?this.draftOrder.comande[i]=this.currentComanda:this.draftOrder.comande.push(this.currentComanda),this.localChanges.push({type:"add",data:e,timestamp:new Date}),this.hasUnsavedChanges=!0,this.updateLocalTotals(),console.log("\u2705 Piatto aggiunto in draft. Modifiche in sospeso:",this.localChanges.length)}catch(e){console.error("\u{1F4A5} Errore in addDish (draft):",e)}finally{this.cdr.markForCheck()}})}createNewComandaLocal(){return h(this,null,function*(){this.draftOrder||(this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader()),console.log("\u{1F195} Creo nuova comanda in DRAFT per tavolata:",this.draftOrder.id);let t=(this.draftOrder.comande?.length||0)+1,e={id:"draft-comanda-"+Date.now(),order_number:`${this.draftOrder.order_number}-${t}`,restaurant_id:"",order_header_id:this.draftOrder.id,tavolata_id:this.draftOrder.id,comanda_number:t,table_id:this.table.id,customer_name:this.draftOrder.customer_name,status:"ordered",order_type:"dine_in",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,order_items:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};this.draftOrder.comande||(this.draftOrder.comande=[]),this.draftOrder.comande.push(e),this.currentComanda=e,this.currentComandaId=e.id,this.updateOrderHeader(),this.localChanges.push({type:"new_comanda",data:e,timestamp:new Date}),this.hasUnsavedChanges=!0,console.log("\u2705 Nuova comanda creata in draft:",t)})}addDishToOrder(t){this.addDish(t)}updateQuantity(t,e){return h(this,null,function*(){if(this.currentComanda?.order_items)try{let i=t.quantity+e;if(i<1){this.cdr.markForCheck(),yield this.removeItemLocal(t);return}let r=this.currentComanda.order_items.findIndex(_=>_.id===t.id);if(r===-1)return;let s=this.currentComanda.order_items[r];s.quantity=i,s.total_price=s.unit_price*i,this.updateLocalTotals(),this.localChanges.push({type:"update",data:{itemId:t.id,quantity:i},timestamp:new Date}),this.hasUnsavedChanges=!0,console.log("\u{1F4C8} Quantit\xE0 aggiornata in draft:",i)}catch(i){console.error("\u274C Errore in updateQuantity:",i)}finally{this.cdr.markForCheck()}})}removeItemLocal(t){return h(this,null,function*(){if(this.currentComanda?.order_items)try{let e=this.currentComanda.order_items.findIndex(i=>i.id===t.id);if(e===-1)return;this.currentComanda.order_items.splice(e,1),this.localChanges.push({type:"delete",data:t,timestamp:new Date}),this.hasUnsavedChanges=!0,this.updateLocalTotals(),console.log("\u{1F5D1}\uFE0F Piatto rimosso in draft:",t.id)}catch(e){console.error("\u274C Errore in removeItemLocal:",e)}finally{this.cdr.markForCheck()}})}updateLocalTotals(){if(!(!this.currentComanda||!this.currentComanda.order_items)&&(this.recalculateComandaTotal(this.currentComanda),this.draftOrder&&this.draftOrder.comande&&(this.draftOrder.comande.forEach(t=>{this.recalculateComandaTotal(t)}),this.draftOrder.total_amount=this.draftOrder.comande.reduce((t,e)=>t+(e.total_amount||0),0),this.orderHeader))){this.orderHeader.total_amount=this.draftOrder.total_amount;let t=this.orderHeader.comande?.findIndex(e=>e.id===this.currentComanda?.id);t!==void 0&&t>=0&&this.orderHeader.comande&&(this.orderHeader.comande[t].total_amount=this.currentComanda.total_amount,this.orderHeader.comande[t].order_items=this.currentComanda.order_items)}}saveAllToDatabase(){return h(this,null,function*(){try{if(console.log("\u{1F4BE} Salvando tutte le modifiche in database...",this.localChanges.length,"modifiche"),!this.draftOrder)return console.error("\u274C Nessun draft da salvare"),!1;if(this.draftOrder.comande&&(this.draftOrder.comande=this.draftOrder.comande.filter(r=>r.order_items&&r.order_items.length>0)),(!this.draftOrder.comande||this.draftOrder.comande.length===0)&&(console.log("\u26A0\uFE0F Nessuna comanda con piatti da salvare"),this.isNewOrder))return console.log("\u2705 Nessun ordine creato (tutte le comande erano vuote)"),!0;let t=!0,e=this.draftOrder.id;if(this.isNewOrder&&this.draftOrder.id.startsWith("draft-")){console.log("\u{1F195} Creazione nuova tavolata nel database...");let r=yield this.orderHeaderService.createForTable(this.table.id,this.draftOrder.customer_name||"Cliente");if(!r)return console.error("\u274C Impossibile creare order header"),!1;e=r.id,console.log("\u2705 Order header creato:",e)}let i=new Map;for(let r of this.localChanges.filter(s=>s.type==="new_comanda")){let s=r.data;console.log("\u{1F4E6} Creazione comanda nel database...");let _=yield this.comandaService.createForOrderHeader(e,s.comanda_number);_?(i.set(s.id,_.id),console.log(`\u2705 Comanda creata: draft ${s.id} -> real ${_.id}`)):(console.error("\u274C Errore creazione comanda per:",s.id),t=!1)}for(let r of this.localChanges)switch(r.type){case"add":let s=r.data,_=s.order_id;i.has(s.order_id)&&(_=i.get(s.order_id)),console.log("\u2795 Aggiungo piatto al database..."),(yield this.orderItemService.addItemToComanda(_,s.dish_id,s.quantity,s.unit_price,s.item_notes||""))||(console.error("\u274C Errore aggiunta piatto:",s),t=!1);break;case"update":let C=r.data;C.itemId.startsWith("draft-")||(console.log("\u{1F4C8} Aggiorno quantit\xE0 nel database..."),(yield this.orderHelper.updateItemQuantity(C.itemId,C.quantity))||(console.error("\u274C Errore aggiornamento quantit\xE0:",C),t=!1));break;case"delete":let S=r.data;S.id.startsWith("draft-")||(console.log("\u{1F5D1}\uFE0F Rimuovo piatto dal database..."),(yield this.orderHelper.removeItem(S.id))||(console.error("\u274C Errore rimozione piatto:",S),t=!1));break}return t}catch(t){return console.error("\u{1F4A5} Errore durante il salvataggio:",t),!1}})}confirmRemoveItem(t){window.confirm(`Vuoi eliminare "${t.dish_name}" dalla comanda?`)&&this.removeItemLocal(t)}updateTotals(){!this.currentComanda||!this.currentComanda.order_items||(this.currentComanda.total_amount=this.currentComanda.order_items.reduce((t,e)=>t+(e.total_price||0),0),this.orderHeader&&this.orderHeader.comande&&(this.orderHeader.total_amount=this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)),console.log("\u{1F4B0} Totale aggiornato:",this.currentComanda.total_amount))}getFilteredDishes(){let t=this.dishes.filter(e=>{let i=e.deleted_at!==null&&e.deleted_at!==void 0,r=e.status==="available";return i?(console.warn(`\u26A0\uFE0F Piatto eliminato filtrato: ${e.name} (ID: ${e.id})`),!1):r&&!i});if(console.log(`\u{1F50D} Dopo filtro eliminati: ${t.length} piatti`),this.selectedCategory!=="all"&&(t=t.filter(e=>e.category_id===this.selectedCategory)),this.dishSearchTerm){let e=this.dishSearchTerm.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(e)||i.description?.toLowerCase().includes(e))}return t}getComandaItems(){return this.currentComanda?.order_items||[]}getComandaTotal(t){let e=t||this.currentComanda;if(!e||!e.order_items)return 0;if(e.total_amount===0&&e.order_items.length>0){let i=e.order_items.reduce((r,s)=>{let _=s.total_price||s.unit_price*s.quantity;return r+_},0);return e.total_amount=i,i}return e.total_amount||0}getDishesCountByCategory(t){let e=this.getFilteredDishes();return t==="all"?e.length:e.filter(i=>i.category_id===t).length}debugRealTimeGroups(){console.log("\u{1F50D} [DEBUG REAL-TIME] Analisi immediata dei gruppi:");let t=this.getDishesGroupedByCategory();t.forEach((i,r)=>{console.log(`
\u{1F4C1} Categoria: ${i.category.name} (${i.dishes.length} piatti)`);let s=i.dishes.filter(_=>_.deleted_at);s.length>0&&(console.error(`\u274C\u274C\u274C PIATTI ELIMINATI TROVATI in ${i.category.name}:`),s.forEach((_,x)=>{console.error(`   ${x+1}. ${_.name} - deleted_at: ${_.deleted_at}`)}))});let e=t.flatMap(i=>i.dishes).filter(i=>i.deleted_at).length;console.log(`
\u{1F4CA} TOTALE PIATTI ELIMINATI NEI GRUPPI: ${e}`),e>0&&console.error("\u{1F525}\u{1F525}\u{1F525} PROBLEMA CONFERMATO: Piatti eliminati nei gruppi visualizzati!")}getDishesGroupedByCategory(){console.log("\u{1F504} Ricreazione gruppi piatti..."),this.cachedDishGroups=[],this.lastCategoryId="",this.lastSearchTerm="",this.lastDishesLength=0;let t=this.getFilteredDishes();console.log(`\u{1F4CA} Gruppi: ${t.length} piatti filtrati`);let e=t.filter(s=>s.deleted_at);e.length>0&&console.error("\u274C\u274C\u274C PIATTI ELIMINATI NEI FILTRATI:",e.map(s=>s.name));let i=this.categoryService.data,r=[];return i.forEach(s=>{let _=t.filter(x=>{let C=x.category_id===s.id,S=!x.deleted_at,I=x.status==="available";return C&&(!S||!I)&&console.warn(`\u26A0\uFE0F Piatto problematico in categoria ${s.name}:`,{name:x.name,deleted_at:x.deleted_at,status:x.status}),C&&S&&I});_.length>0&&r.push({category:s,dishes:_})}),this.cachedDishGroups=r,r}getCategories(){return this.categoryService.data}getComandeForDropdown(){return this.orderHeader?.comande||[]}getCurrentComande(){return this.orderHeader?.comande||[]}switchComanda(t){if(t==="all"){this.currentComanda=null,this.currentComandaId="all",this.cdr.markForCheck();return}let e=this.orderHeader?.comande?.find(i=>i.id===t);e&&(this.currentComanda=e,this.currentComandaId=t,this.recalculateComandaTotal(this.currentComanda),this.cdr.markForCheck())}get displayItems(){return this.currentComandaId==="all"?this.orderHeader?.comande?.flatMap(t=>t.order_items||[])||[]:this.currentComanda?.order_items||[]}get displayTotal(){return this.currentComandaId==="all"?this.orderHeader?.total_amount||0:this.currentComanda?.total_amount||0}get displayQuantity(){return this.currentComandaId==="all"?this.getTotalePiattiTutteComande():this.getComandaTotalQuantity(this.currentComanda)}get isSingleComandaMode(){return this.currentComandaId!=="all"}recalculateComandaTotal(t){if(!t.order_items||t.order_items.length===0){t.total_amount=0;return}let e=t.order_items.reduce((i,r)=>{let s=r.total_price||r.unit_price*r.quantity;return i+s},0);t.total_amount=e,console.log(`\u{1F4B0} Comanda ${t.comanda_number} totale ricalcolato:`,e)}getComandaTotalQuantity(t){return!t||!t.order_items||t.order_items.length===0?0:t.order_items.reduce((e,i)=>e+(i.quantity||1),0)}getTotalePiattiTutteComande(){if(!this.orderHeader?.comande)return 0;let t=0;for(let e of this.orderHeader.comande)t+=this.getComandaTotalQuantity(e);return t}toggleComandaExpansion(t){this.comandeExpanded[t]=!this.comandeExpanded[t]}isComandaExpanded(t){return this.comandeExpanded[t]||!1}saveOrder(){return h(this,null,function*(){try{let t=this.getEmptyComande();if(t.length>0){let r=`Le seguenti comande sono vuote: ${t.map(_=>_.comanda_number).join(", ")}. 
Se procedi, queste comande vuote verranno eliminate dal salvataggio. 
Vuoi continuare comunque?`;if(!window.confirm(r)){console.log("\u274C Salvataggio annullato dall'utente");return}this.removeEmptyComandeFromDraft(t)}if(this.loadingService.start(),this.isLoading=!0,console.log("\u{1F4BE} Salvando ordine..."),yield this.saveAllToDatabase()){if(console.log("\u2705 Ordine salvato nel database"),this.draftOrder&&!this.draftOrder.id.startsWith("draft-")){let i=yield this.orderHelper.loadFullOrder(this.draftOrder.id);if(i&&(this.draftOrder=i,this.orderHeader=JSON.parse(JSON.stringify(i)),i.comande&&i.comande.length>0)){let r=i.comande.slice().reverse().find(s=>s.status!=="cancelled");this.currentComanda=r||i.comande[0]}}this.saved.emit(this.orderHeader),this.localChanges=[],this.hasUnsavedChanges=!1,console.log("\u{1F389} Ordine salvato con successo")}else console.error("\u274C Errore durante il salvataggio"),alert("Errore durante il salvataggio dell'ordine")}catch(t){console.error("\u274C Errore salvataggio ordine:",t),alert("Errore durante il salvataggio: "+t.message)}finally{this.loadingService.stop(),this.isLoading=!1}})}removeEmptyComandeFromDraft(t){if(this.draftOrder?.comande){if(console.log("\u{1F5D1}\uFE0F Rimozione comande vuote dal draft:",t.map(e=>e.comanda_number)),this.draftOrder.comande=this.draftOrder.comande.filter(e=>!t.some(i=>i.id===e.id)),this.updateOrderHeader(),this.currentComanda&&t.some(e=>e.id===this.currentComanda.id)){let e=this.draftOrder.comande.find(i=>i.order_items&&i.order_items.length>0);this.currentComanda=e||this.draftOrder.comande[0]||null}this.localChanges=this.localChanges.filter(e=>!(e.type==="new_comanda"&&t.some(i=>i.id===e.data.id)||e.type==="add"&&t.some(i=>i.id===e.data.order_id))),console.log("\u2705 Comande vuote rimosse dal draft")}}close(){this.hasUnsavedChanges&&!window.confirm("Hai modifiche non salvate. Vuoi davvero chiudere senza salvare?")||(console.log("\u{1F6AA} Chiusura order editor"),this.closeRequested.emit())}calcolaTotaleTavolata(){return!this.orderHeader||!this.orderHeader.comande?0:this.orderHeader.comande.reduce((t,e)=>t+this.getComandaTotal(e),0)}calcolaTotaleOrderHeader(t){return t.total_amount||0}getTotalComandeCount(){return this.orderHeader?.comande?.length||0}getOrderStatusColor(t){return{ordered:"#f39c12",waiting:"#3498db",preparing:"#9b59b6",ready:"#2ecc71",served:"#27ae60",cancelled:"#e74c3c",error:"#e74c3c"}[t]||"#95a5a6"}getOrderStatusText(t){return{ordered:"Ordinato",waiting:"In attesa",preparing:"In preparazione",ready:"Pronto",served:"Servito",cancelled:"Cancellato"}[t]||t}getDishName(t){return t.dish_name||"Piatto"}resetDishFilters(){this.dishSearchTerm="",this.selectedCategory="all",this.cachedDishGroups=[]}trackByDishId(t,e){return e.id}trackByCategoryId(t,e){return e.category.id}onMenuSelectChange(t){this.selectedMenu=t,this.cachedDishGroups=[],this.loadDishesForSelectedMenu()}printBillAndFreeTable(){return h(this,null,function*(){if(window.confirm(`Vuoi stampare lo scontrino e liberare il tavolo ${this.table.table_number}?`))try{this.loadingService.start();let e=this.generateProfessionalBill(),i=window.open("","_blank","width=800,height=600");if(!i){alert("Impossibile aprire la finestra di stampa. Controlla il blocco popup.");return}i.document.write(e),i.document.close(),i.onload=()=>{i.print(),i.onafterprint=()=>h(this,null,function*(){i.close(),yield this.freeTableAfterBill()})}}catch(e){console.error("\u274C Errore stampa scontrino:",e),alert("Errore durante la stampa dello scontrino")}finally{this.loadingService.stop()}})}freeTableAfterBill(){return h(this,null,function*(){try{if(console.log("\u{1F193} Liberazione tavolo dopo scontrino per tavolo:",this.table.table_number),!this.orderHeader){console.error("\u274C Nessun order header da chiudere");return}if(yield this.orderHelper.closeTavolata(this.orderHeader.id)){if(console.log("\u2705 Tavolata chiusa con successo"),this.orderHeader.comande)for(let e of this.orderHeader.comande)e.status!=="cancelled"&&e.status!=="served"&&(yield this.orderHelper.updateComandaStatus(e.id,"served"),console.log(`\u2705 Comanda ${e.comanda_number} aggiornata a 'served'`));this.saved.emit(this.orderHeader),this.closeRequested.emit(),console.log("\u2705 Tavolo liberato con successo")}else console.error("\u274C Errore nella chiusura della tavolata"),alert("Errore nella chiusura del tavolo")}catch(t){console.error("\u{1F4A5} Errore in freeTableAfterBill:",t),alert("Errore nella chiusura del tavolo: "+t.message)}})}generateProfessionalBill(){let t=new Date,e=t.toLocaleDateString("it-IT"),i=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),r=this.restaurantData?.logo_url?`<img src="${this.restaurantData.logo_url}" alt="Logo" style="max-width: 150px; margin: 0 auto 20px;">`:"",s=`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>Scontrino - Tavolo ${this.table.table_number}</title>
      <style>
        @media print {
          @page { margin: 0; size: 80mm auto; }
          body { margin: 0; padding: 10mm; }
        }
        
        body {
          font-family: 'Courier New', monospace;
          font-size: 12px;
          line-height: 1.4;
          max-width: 80mm;
          margin: 0 auto;
          padding: 10px;
        }
        
        .header {
          text-align: center;
          border-bottom: 2px dashed #000;
          padding-bottom: 10px;
          margin-bottom: 15px;
        }
        
        .restaurant-name {
          font-size: 18px;
          font-weight: bold;
          margin: 10px 0;
        }
        
        .restaurant-info {
          font-size: 10px;
          margin: 3px 0;
        }
        
        .receipt-info {
          margin: 15px 0;
          font-size: 11px;
        }
        
        .comanda-section {
          margin: 15px 0;
          border-top: 1px solid #000;
          padding-top: 10px;
        }
        
        .comanda-title {
          font-weight: bold;
          margin-bottom: 8px;
        }
        
        .item-row {
          display: flex;
          justify-content: space-between;
          margin: 5px 0;
        }
        
        .item-name {
          flex: 1;
        }
        
        .item-price {
          text-align: right;
          min-width: 60px;
        }
        
        .totals {
          border-top: 2px solid #000;
          margin-top: 15px;
          padding-top: 10px;
        }
        
        .total-row {
          display: flex;
          justify-content: space-between;
          margin: 5px 0;
          font-size: 14px;
        }
        
        .grand-total {
          font-weight: bold;
          font-size: 16px;
          border-top: 2px dashed #000;
          margin-top: 10px;
          padding-top: 10px;
        }
        
        .footer {
          text-align: center;
          margin-top: 20px;
          padding-top: 15px;
          border-top: 2px dashed #000;
          font-size: 10px;
        }
      </style>
    </head>
    <body>
      <div class="header">
        ${r}
        <div class="restaurant-name">${this.restaurantData?.name||"RISTORANTE"}</div>
        ${this.restaurantData?.address?`<div class="restaurant-info">${this.restaurantData.address}</div>`:""}
        ${this.restaurantData?.phone?`<div class="restaurant-info">Tel: ${this.restaurantData.phone}</div>`:""}
        ${this.restaurantData?.email?`<div class="restaurant-info">${this.restaurantData.email}</div>`:""}
      </div>
      
      <div class="receipt-info">
        <div><strong>Tavolo:</strong> ${this.table.table_number}</div>
        <div><strong>Data:</strong> ${e}</div>
        <div><strong>Ora:</strong> ${i}</div>
        <div><strong>Scontrino:</strong> #${this.orderHeader?.order_number||"N/A"}</div>
      </div>
  `;this.orderHeader?.comande&&this.orderHeader.comande.forEach((x,C)=>{s+=`
        <div class="comanda-section">
          <div class="comanda-title">COMANDA ${x.comanda_number}</div>
      `,x.order_items&&x.order_items.forEach(S=>{let I=S.unit_price*S.quantity;s+=`
            <div class="item-row">
              <span class="item-name">${S.quantity}x ${S.dish_name}</span>
              <span class="item-price">\u20AC ${I.toFixed(2)}</span>
            </div>
          `}),s+=`
          <div class="item-row" style="margin-top: 8px; font-weight: bold;">
            <span>Subtotale Comanda ${x.comanda_number}:</span>
            <span class="item-price">\u20AC ${(x.total_amount||0).toFixed(2)}</span>
          </div>
        </div>
      `});let _=this.calcolaTotaleTavolata();return s+=`
      <div class="totals">
        <div class="total-row grand-total">
          <span>TOTALE DA PAGARE</span>
          <span>\u20AC ${_.toFixed(2)}</span>
        </div>
      </div>
      
      <div class="footer">
        <div>Grazie per la visita!</div>
        <div style="margin-top: 5px;">Arrivederci</div>
      </div>
    </body>
    </html>
  `,s}get dedicatedMenu(){return this.activeMenus.find(t=>t.type==="dedicated")||null}get globalMenus(){return this.activeMenus.filter(t=>t.type==="global")}hasMenusToShow(){return this.activeMenus.length>0}hasDedicatedMenu(){return this.activeMenus.some(t=>t.type==="dedicated")}hasGlobalMenus(){return this.activeMenus.some(t=>t.type==="global")}switchToEditMode(){this.closeRequested.emit()}updateOrderHeader(){this.draftOrder&&(this.orderHeader=N(V({},this.draftOrder),{comande:this.draftOrder.comande}))}trackByOrderItemId(t,e){return e.id}get comandaItemsCount(){return this.currentComanda?.order_items?.length||0}get totaleTavolata(){return!this.orderHeader||!this.orderHeader.comande?0:this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)}isComandaEditable(t){let e=t||this.currentComanda;return e?["ordered","waiting","draft"].includes(e.status):!0}isItemEditable(t){return["ordered","waiting","draft"].includes(t.status)}canAddItemsToCurrentComanda(){return this.currentComanda?this.isComandaEditable(this.currentComanda):!0}getEmptyComande(){return this.draftOrder?.comande?this.draftOrder.comande.filter(t=>!t.order_items||t.order_items.length===0):[]}ngAfterViewInit(){this.tutorialService.currentStepData()?.id==="order-editor"&&setTimeout(()=>{this.tutorialService.refreshTooltip(),setTimeout(()=>this.tutorialService.refreshTooltip(),200)},400)}get hasMultipleComande(){return(this.orderHeader?.comande?.length??0)>1}toggleComandaPage(){let t=this.showComandaPage;if(this.showComandaPage=!this.showComandaPage,t&&this.currentComandaId==="all"){let e=this.orderHeader?.comande?.find(i=>i.status!=="cancelled")||this.orderHeader?.comande?.[0];e&&this.switchComanda(e.id)}}startMoveItem(t,e){this.movingItem={item:t,fromComandaId:e}}cancelMove(){this.movingItem=null}executeMove(t){return h(this,null,function*(){if(!this.movingItem)return;let{item:e,fromComandaId:i}=this.movingItem,r=this.orderHeader?.comande?.find(C=>C.id===i),s=this.orderHeader?.comande?.find(C=>C.id===t);if(!r||!s)return;let _=r.order_items?.findIndex(C=>C.id===e.id)??-1;if(_===-1)return;r.order_items?.splice(_,1),this.recalculateComandaTotal(r);let x=N(V({},e),{id:"draft-item-"+Date.now()+"-"+Math.random().toString(36).substr(2,5),order_id:s.id,comanda_id:s.id});s.order_items||(s.order_items=[]),s.order_items.push(x),this.recalculateComandaTotal(s),this.orderHeader&&(this.orderHeader.total_amount=this.orderHeader.comande?.reduce((C,S)=>C+(S.total_amount||0),0)||0),this.localChanges.push({type:"update",data:{moved:e.id,from:i,to:t},timestamp:new Date}),this.hasUnsavedChanges=!0,this.movingItem=null,this.cdr.markForCheck()})}getOtherComandas(t){return this.orderHeader?.comande?.filter(e=>e.id!==t)||[]}toggleDescriptions(){this.showDescriptions=!this.showDescriptions}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=U({type:o,selectors:[["app-order-editor"]],inputs:{table:"table",mode:"mode",existingOrderHeader:"existingOrderHeader",orderingStatus:"orderingStatus",selectedComandaId:"selectedComandaId"},outputs:{saved:"saved",closeRequested:"closeRequested"},decls:3,vars:2,consts:[["noDishes",""],["emptyOrder",""],["singleComandaList",""],["moveSelect",""],["data-tutorial","order-editor",1,"order-editor-container"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg","fullscreen-mobile",3,"click"],[3,"isLoading",4,"ngIf"],[1,"modal-header","modal-header-order"],[1,"flex","justify-between","items-center","w-100"],[1,"section-title","text-md"],["data-tutorial","order-editor-button",1,"flex","gap-sm"],[1,"icon-button",3,"click"],["name","info"],[1,"material-icons"],[1,"icon-button",3,"click","disabled","title"],["title","Chiudi",1,"icon-button",3,"click"],[1,"flex","justify-between","items-center","gap-sm","mt-sm","w-100"],["data-tutorial","order-editor-riepilogo",1,"numeropiatti","font-semibold"],["data-tutorial","order-editor-cart"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-content-scroll"],["class","p-sm","data-tutorial","order-editor-menu",4,"ngIf"],[1,"search-bar-mobile"],[1,"flex","gap-sm","items-center","p-sm"],["type","text","placeholder","Cerca piatto...","autofocus","",1,"form-input","touch-target",3,"ngModelChange","ngModel"],[1,"flex"],[1,"flex","flex-col"],["class","flex flex-col",4,"ngIf"],["class","flex flex-col gap-md",4,"ngIf"],[1,"modal-footer","p-sm"],["data-tutorial","order-editor-send",1,"promethea-button","primary","flex-1",3,"click","disabled","title"],[3,"isLoading"],[3,"value"],["data-tutorial","order-editor-menu",1,"p-sm"],[1,"standard-label"],["class","text-primary font-semibold",4,"ngIf"],[4,"ngIf"],["class","p-sm bg-primary-light rounded mb-md",4,"ngIf"],["class","p-sm bg-smoke rounded text-center",4,"ngIf"],["class","flex items-center gap-sm",4,"ngIf"],[1,"text-primary","font-semibold"],[1,"p-sm","bg-primary-light","rounded","mb-md"],[1,"flex","items-center","gap-sm"],[1,"material-icons","text-primary"],[1,"font-semibold"],[1,"chip","bg-primary","ml-sm","text-white"],["class","p-sm bg-smoke rounded border",4,"ngIf"],[1,"p-sm","bg-smoke","rounded","border"],[1,"flex","items-center","justify-between"],["class","chip bg-glass",4,"ngIf"],[1,"chip","bg-glass"],[1,"material-icons","text-mini"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"p-sm","bg-smoke","rounded","text-center"],[1,"material-icons","text-muted"],[1,"text-muted","text-mini","mt-sm"],["class","chip bg-primary text-white",4,"ngIf"],[1,"chip","bg-primary","text-white"],[1,"quick-actions-mobile"],[1,"quick-action-button",3,"click"],[1,"text-mini"],[1,"text-muted","text-mini"],["class","quick-action-button",3,"active","click",4,"ngFor","ngForOf"],["data-tutorial","order-editor-dish",1,"flex","flex-col","gap-sm","p-sm"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","gap-sm","items-center","mb-sm","mt-lg"],[1,"font-bold","text-md"],[1,"material-icons","text-md"],[1,"font-bold","text-primary","text-md"],[1,"dishes-grid"],["class","card dish-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","dish-card"],[1,"flex","flex-col","gap-sm"],[1,"flex","gap-sm","flex-col","flex-1"],[1,"flex","gap-sm","justify-between"],[1,"dish-name"],[1,"icon-button","x-small",3,"click","disabled","title"],["name","plus",3,"size"],[1,"dish-price","text-primary"],["class","text-muted text-mini",4,"ngIf"],[1,"empty-state"],[1,"text-muted"],[1,"promethea-button","ghost","mt-sm",3,"click"],[1,"flex","flex-col","gap-md"],[1,"form-card",2,"margin","0","padding","var(--gap-sm)"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","gap-sm","font-semibold"],[1,"material-icons","text-primary","text-md"],[1,"chip","active"],[1,"mt-sm"],[1,"form-input","touch-target",3,"ngModelChange","ngModel"],["class","mb-sm p-sm bg-smoke-1 rounded",4,"ngIf"],[1,"mt-md","pt-md","border-t","border-[var(--smoke-1)]"],[1,"flex","justify-between","items-center","mb-sm"],[1,"text-md"],[1,"text-primary","text-md"],[1,"mb-sm","p-sm","bg-smoke-1","rounded"],[1,"text-muted","text-mini","ml-sm"],["class","mb-md",4,"ngFor","ngForOf"],[1,"mb-md"],[1,"flex","items-center","gap-sm","p-sm","rounded-lg","bg-smoke"],["class"," p-sm ",4,"ngFor","ngForOf"],[1,"p-sm"],[1,"flex","justify-between","items-start","gap-sm"],[1,"flex","flex-col","flex-1"],[1,"flex","items-center","gap-sm","mt-sm"],["title","Sposta in altra comanda",1,"icon-button","x-small",3,"click"],["name","move","size","16"],[1,"form-input","small",2,"width","auto","min-width","150px",3,"change","blur"],["value","","disabled","","selected",""],["title","Annulla",1,"icon-button","x-small",3,"click"],["class","mb-sm pb-sm border-b border-[var(--smoke-1)] last:border-0",4,"ngFor","ngForOf"],[1,"mb-sm","pb-sm","border-b","border-[var(--smoke-1)]","last:border-0"],["title","Riduci quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],[1,"font-bold","px-2","text-center","text-sm","min-w-[20px]"],["title","Aumenta quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],["title","Elimina piatto",1,"icon-button","x-small","ml-1","text-danger",3,"click","disabled"],["name","trash-2",3,"size"],[1,"flex","justify-between","items-center","text-muted","text-mini"],[1,"text-secondary"],[1,"empty-state","py-lg"],[1,"material-icons","text-lg"],["class","text-muted text-mini mt-sm",4,"ngIf"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"header-icon"],[1,"section-title"],[1,"chip"],[1,"p-lg"],["class","empty-state",4,"ngIf"],["class","flex flex-col gap-sm",4,"ngIf"],[1,"modal-footer","mt-lg"],[1,"promethea-button","success","flex-1",3,"click","disabled"],[1,"promethea-button","ghost","flex-1",3,"click"],[1,"promethea-button","primary","mt-sm",3,"click"],["class","form-card",4,"ngFor","ngForOf"],[1,"form-card","mt-md","bg-gradient","text-white"],[1,"text-white"],[1,"text-white","text-sm","opacity-80"],[1,"form-card"],[1,"flex","justify-between","items-center","cursor-pointer",3,"click"],[1,"flex","items-center","gap-md","flex-1"],[1,"flex","items-center","gap-sm","flex-wrap"],[1,"chip","small"],[1,"text-muted","mt-sm"],[1,"flex","items-center","gap-md"],[1,"flex","flex-col","items-end"],["class","mt-md pt-md border-t border-[var(--smoke-1)]",4,"ngIf"],["class","space-y-sm",4,"ngIf"],["class","empty-state py-md",4,"ngIf"],[1,"flex","justify-between","items-center","mt-md","pt-md","border-t"],[1,"space-y-sm"],["class","flex justify-between items-start p-sm flex-wrap",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","p-sm","flex-wrap"],[1,"flex","items-start","gap-sm"],["class","mt-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","mt-sm","text-muted"],[1,"chip","x-small","mt-sm",2,"max-width","fit-content"],[1,"empty-state","py-md"]],template:function(e,i){e&1&&(a(0,"div",4),f(1,Ut,45,28,"div",5)(2,ai,32,13,"div",5),n()),e&2&&(d(),m("ngIf",i.mode==="edit"),d(),m("ngIf",i.mode==="view"))},dependencies:[te,X,ee,Ae,Re,He,le,oe,de,ie,ne,re,ae,tt,ce,se],styles:[".numeropiatti[_ngcontent-%COMP%]{font-size:var(--fs-mini)}@media (max-width: 768px){.numeropiatti[_ngcontent-%COMP%]{margin-left:var(--gap-md)}.modal-header-order[_ngcontent-%COMP%]{padding:var(--gap-sm) var(--gap-md);flex-direction:column;align-items:normal;backdrop-filter:blur(20px)}.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%;width:100%;border-radius:0}}.dishes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(20vw,1fr));gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.dishes-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(40vw,1fr))}.grid-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1);background:var(--background);transition:all .2s ease;min-height:5rem}.dish-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:var(--primary);box-shadow:0 4px 12px var(--smoke-2)}.dish-name[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm);line-height:1.3;color:var(--text-color);margin-bottom:4px}.dish-price[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-sm);color:var(--primary)}.quick-actions-mobile[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:0;z-index:100;display:flex;gap:var(--gap-sm);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding:var(--gap-sm)}.modal-content-scroll[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.quick-action-button[_ngcontent-%COMP%]{display:flex;padding:var(--gap-sm);gap:var(--gap-sm);backdrop-filter:blur(15px);border:1px solid var(--smoke-1);border-radius:12px;background:var(--background);font-weight:800;transition:all .2s ease;cursor:pointer;box-shadow:3px 3px 5px var(--shadow-2)}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button.active[_ngcontent-%COMP%]{background:var(--background2);border-color:var(--primary)}.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column}}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-lg);color:var(--text-muted);text-align:center}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-lg);margin-bottom:var(--gap-sm);opacity:.5}.bill-preview[_ngcontent-%COMP%]{font-family:Courier New,monospace;background:#fff;color:#000;padding:var(--gap-lg);max-height:60vh;overflow-y:auto}@media print{.bill-preview[_ngcontent-%COMP%]{max-height:none;overflow:visible}}.icon-button[disabled][_ngcontent-%COMP%], .promethea-button[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;pointer-events:none}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-overlay[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.order-editor-wrapper[_ngcontent-%COMP%]{width:100%;height:100%}"],changeDetection:0})};var he=class o{supabase=b(ze).getSupabaseClient();authService=b($);loadingService=b(Q);occupyTable(t,e){return h(this,null,function*(){try{this.loadingService.start();let i=yield this.authService.getCurrentRestaurantId();if(!i)return null;let r=yield this.generateOrderNumber(i),{data:s,error:_}=yield this.supabase.from("order_headers").insert({restaurant_id:i,table_id:t,order_number:r,status:"active",customer_name:e||"Cliente",total_amount:0}).select().single();if(_)throw _;let x=yield this.createComanda(s.id);return yield this.loadTavolata(s.id)}catch(i){return console.error("\u274C Errore occupazione tavolo:",i),null}finally{this.loadingService.stop()}})}createComanda(t){return h(this,null,function*(){try{this.loadingService.start();let e=yield this.authService.getCurrentRestaurantId();if(!e)return null;let{data:i,error:r}=yield this.supabase.from("order_headers").select("table_id, order_number, customer_name, status").eq("id",t).single();if(r)throw r;let s=yield this.getNextComandaNumber(t),_=`${i.order_number}-${s}`,{data:x,error:C}=yield this.supabase.from("comande").insert({restaurant_id:e,order_header_id:t,comanda_number:s,order_number:_,status:"ordered",table_id:i.table_id,order_type:"dine_in",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,customer_name:i.customer_name||"Cliente"}).select().single();if(C)throw C;return x}catch(e){return console.error("\u274C Errore creazione comanda:",e),null}finally{this.loadingService.stop()}})}addItemToComanda(t,e,i=1,r=""){return h(this,null,function*(){try{this.loadingService.start();let s=yield this.authService.getCurrentRestaurantId();if(!s)return null;let{data:_,error:x}=yield this.supabase.from("dishes").select("base_price, name").eq("id",e).single();if(x)throw x;let C=_.base_price*i,{data:S,error:I}=yield this.supabase.from("order_items").insert({order_id:t,dish_id:e,quantity:i,unit_price:_.base_price,total_price:C,item_notes:r,status:"ordered",restaurant_id:s}).select().single();if(I)throw I;return yield this.updateComandaTotal(t),N(V({},S),{dish_name:_.name})}catch(s){return console.error("\u274C Errore aggiunta piatto:",s),null}finally{this.loadingService.stop()}})}loadTavolata(t){return h(this,null,function*(){try{this.loadingService.start();let{data:e,error:i}=yield this.supabase.from("order_headers").select(`
          *,
          comande (
            *,
            order_items (
              *,
              dish:dish_id (
                id,
                name,
                base_price,
                category_id
              )
            )
          )
        `).eq("id",t).single();if(i)throw i;return e}catch(e){return console.error("\u274C Errore caricamento tavolata:",e),null}finally{this.loadingService.stop()}})}getActiveTavolataByTable(t){return h(this,null,function*(){try{let e=yield this.authService.getCurrentRestaurantId();if(!e)return null;let{data:i,error:r}=yield this.supabase.from("order_headers").select(`
          *,
          comande (
            *,
            order_items (
              *,
              dish:dish_id (
                id,
                name,
                base_price
              )
            )
          )
        `).eq("restaurant_id",e).eq("table_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(1).single();if(r){if(r.code==="PGRST116")return null;throw r}return i}catch(e){return console.error("\u274C Errore caricamento tavolata attiva:",e),null}})}updateComandaStatus(t,e){return h(this,null,function*(){try{let{error:i}=yield this.supabase.from("comande").update({status:e,updated_at:new Date().toISOString()}).eq("id",t);return!i}catch(i){return console.error("\u274C Errore aggiornamento stato comanda:",i),!1}})}updateItemQuantity(t,e){return h(this,null,function*(){try{let{data:i,error:r}=yield this.supabase.from("order_items").select("unit_price, order_id").eq("id",t).single();if(r)throw r;let s=i.unit_price*e,{error:_}=yield this.supabase.from("order_items").update({quantity:e,total_price:s,updated_at:new Date().toISOString()}).eq("id",t);if(_)throw _;return i.order_id&&(yield this.updateComandaTotal(i.order_id)),!0}catch(i){return console.error("\u274C Errore aggiornamento quantit\xE0:",i),!1}})}removeItem(t){return h(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.from("order_items").select("order_id").eq("id",t).single();if(i)throw i;let{error:r}=yield this.supabase.from("order_items").delete().eq("id",t);if(r)throw r;return e.order_id&&(yield this.updateComandaTotal(e.order_id)),!0}catch(e){return console.error("\u274C Errore rimozione piatto:",e),!1}})}closeTavolata(t){return h(this,null,function*(){try{let{error:e}=yield this.supabase.from("order_headers").update({status:"completed",updated_at:new Date().toISOString()}).eq("id",t);return!e}catch(e){return console.error("\u274C Errore chiusura tavolata:",e),!1}})}generateOrderNumber(t){return h(this,null,function*(){let e=new Date,i=e.getFullYear().toString().slice(-2),r=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),{count:_}=yield this.supabase.from("order_headers").select("*",{count:"exact",head:!0}).eq("restaurant_id",t).gte("created_at",`${e.getFullYear()}-${r}-${s}T00:00:00`).lte("created_at",`${e.getFullYear()}-${r}-${s}T23:59:59`),x=(_||0)+1;return`TAV-${i}${r}${s}-${x.toString().padStart(3,"0")}`})}getNextComandaNumber(t){return h(this,null,function*(){let{data:e,error:i}=yield this.supabase.from("comande").select("comanda_number").eq("order_header_id",t).order("comanda_number",{ascending:!1}).limit(1);return i?(console.error("Errore calcolo prossima comanda:",i),1):e&&e.length>0?e[0].comanda_number+1:1})}updateComandaTotal(t){return h(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.from("order_items").select("total_price").eq("order_id",t);if(i)throw i;let r=(e||[]).reduce((s,_)=>s+(_.total_price||0),0);yield this.supabase.from("comande").update({total_amount:r,subtotal:r,updated_at:new Date().toISOString()}).eq("id",t)}catch(e){console.error("Errore aggiornamento totale comanda:",e)}})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=j({token:o,factory:o.\u0275fac,providedIn:"root"})};var ni=["mapCard"],oi=["tableMapContainer"],rt=()=>[1,2,3,4,5,6,7,8,9,10];function di(o,t){if(o&1&&(a(0,"option",54),l(1),n()),o&2){let e=t.$implicit;m("ngValue",e),d(),v(" ",e.name," ")}}function li(o,t){if(o&1){let e=w();a(0,"select",52),E("ngModelChange",function(r){u(e);let s=c();return T(s.currentFloorPlan,r)||(s.currentFloorPlan=r),p(r)}),g("ngModelChange",function(r){u(e);let s=c();return p(s.onFloorPlanSelect(r))}),f(1,di,2,2,"option",53),n()}if(o&2){let e=c();y("ngModel",e.currentFloorPlan),d(),m("ngForOf",e.floorPlans)}}function si(o,t){if(o&1&&(a(0,"div",62)(1,"small"),l(2),n()()),o&2){let e=c().$implicit,i=c();F("text-large",i.isLargeText),d(2),v("Pren: ",e.currentReservation.customer_name,"")}}function ci(o,t){if(o&1&&(a(0,"div",62)(1,"small"),l(2),n()()),o&2){let e=c().$implicit,i=c();F("text-large",i.isLargeText),d(2),v("Ord: ",i.getTableOrderCount(e.table.id)," piatti")}}function mi(o,t){if(o&1){let e=w();a(0,"div",55),g("click",function(){let r=u(e).$implicit,s=c();return p(s.onTableClick(r))}),a(1,"div",56)(2,"div",57),l(3),n(),a(4,"div",58)(5,"div",59),l(6),O(7,"lucide-angular",60),n()(),f(8,si,3,3,"div",61)(9,ci,3,3,"div",61),n()()}if(o&2){let e=t.$implicit,i=c();Z(i.getTableClass(e)),m("ngStyle",i.getTableStyle(e.table)),d(),F("text-large",i.isLargeText),d(2),D(e.table.table_number),d(3),v("",e.table.capacity," "),d(),m("size",20),d(),m("ngIf",e.currentReservation),d(),m("ngIf",e.currentOrders)}}function ui(o,t){o&1&&(a(0,"div",63)(1,"span",29),l(2,"search_off"),n(),a(3,"h3"),l(4,"Nessun tavolo trovato"),n(),a(5,"p",64),l(6,"Modifica i filtri di ricerca"),n()())}function pi(o,t){if(o&1){let e=w();a(0,"div",75)(1,"button",76),g("click",function(){u(e);let r=c(2);return r.openManualReservationModal(),p(r.showQuickActionsModal=!1)}),a(2,"span",29),l(3,"event"),n(),l(4," Crea Prenotazione "),n(),a(5,"button",77),g("click",function(){u(e);let r=c(2);return p(r.openOrderEditor())}),a(6,"span",29),l(7),n(),l(8),n()()}if(o&2){let e=c(2);d(5),m("disabled",!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?"Crea nuovo ordine":"Disabilitato: fuori orario dei turni"),d(2),D(e.orderingStatus.allowed?"restaurant":"schedule"),d(),v(" ",e.orderingStatus.allowed?"Crea Ordine":"Fuori Turno"," ")}}function _i(o,t){if(o&1){let e=w();a(0,"div",75)(1,"button",78),g("click",function(){u(e);let r=c(2);return r.openEditReservationModal(),p(r.showQuickActionsModal=!1)}),a(2,"span",29),l(3,"edit"),n(),l(4," Modifica Prenotazione "),n(),a(5,"button",79),g("click",function(){u(e);let r=c(2);return p(r.openOrderEditor())}),a(6,"span",29),l(7,"check"),n(),l(8," Conferma Arrivo (Crea Ordine) "),n()()}if(o&2){let e=c(2);d(5),m("disabled",!e.orderingStatus.allowed)}}function vi(o,t){if(o&1){let e=w();a(0,"div",75)(1,"button",76),g("click",function(){u(e);let r=c(2);return p(r.openOrderEditor())}),a(2,"span",29),l(3,"receipt"),n(),l(4," Visualizza Ordini "),n(),a(5,"button",77),g("click",function(){u(e);let r=c(2);return p(r.addNewComandaToTable())}),O(6,"lucide-angular",80),l(7," Nuova Comanda "),n(),a(8,"button",81),g("click",function(){u(e);let r=c(2);return p(r.freeTable())}),a(9,"span",29),l(10,"check_circle"),n(),l(11," Libera Tavolo "),n()()}if(o&2){let e=c(2);d(5),m("disabled",!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?"Aggiungi una nuova comanda alla tavolata corrente":e.orderingStatus.reason),d(),m("size",20)}}function gi(o,t){if(o&1){let e=w();a(0,"div",65)(1,"div",66)(2,"div",67)(3,"div",40)(4,"div",68)(5,"span",29),l(6,"table_restaurant"),n()(),a(7,"div")(8,"h1",69),l(9),n()()(),a(10,"button",33),g("click",function(){u(e);let r=c();return p(r.deselectTable())}),a(11,"span",29),l(12,"close"),n()()(),a(13,"div",70)(14,"div",71)(15,"div",72)(16,"span",73),l(17),n()()()(),f(18,pi,9,4,"div",74)(19,_i,9,1,"div",74)(20,vi,12,3,"div",74),n()()}if(o&2){let e=c();d(9),v("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number,""),d(7),Z(e.getStatusColorClass((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")),d(),v(" ",e.getStatusText((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")," "),d(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="free"),d(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="reserved"),d(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="occupied")}}function hi(o,t){if(o&1&&(a(0,"option",95),l(1),n()),o&2){let e=t.$implicit,i=c(2);m("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),d(),B(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function fi(o,t){if(o&1){let e=w();a(0,"div",65)(1,"div",82)(2,"div",67)(3,"div",40)(4,"div",68)(5,"span",29),l(6,"event"),n()(),a(7,"div")(8,"h2",32),l(9),n()()(),a(10,"button",33),g("click",function(){u(e);let r=c();return p(r.closeManualReservationModal())}),a(11,"span",29),l(12,"close"),n()()(),a(13,"div",70)(14,"form",83,2),g("ngSubmit",function(r){return u(e),c().createManualReservation(),p(r.preventDefault())}),a(16,"div",84)(17,"div",18)(18,"label",19),l(19,"Nome Cliente *"),n(),a(20,"input",85),E("ngModelChange",function(r){u(e);let s=c();return T(s.manualReservationData.customer_name,r)||(s.manualReservationData.customer_name=r),p(r)}),n()(),a(21,"div",18)(22,"label",19),l(23,"Telefono *"),n(),a(24,"input",86),E("ngModelChange",function(r){u(e);let s=c();return T(s.manualReservationData.customer_phone,r)||(s.manualReservationData.customer_phone=r),p(r)}),n()()(),a(25,"div",84)(26,"div",18)(27,"label",19),l(28,"Data *"),n(),a(29,"input",87),E("ngModelChange",function(r){u(e);let s=c();return T(s.manualReservationData.reservation_date,r)||(s.manualReservationData.reservation_date=r),p(r)}),n()(),a(30,"div",18)(31,"label",19),l(32,"Orario *"),n(),a(33,"input",88),E("ngModelChange",function(r){u(e);let s=c();return T(s.manualReservationData.reservation_time,r)||(s.manualReservationData.reservation_time=r),p(r)}),n()()(),a(34,"div",18)(35,"label",19),l(36,"Numero Persone *"),n(),a(37,"select",89),E("ngModelChange",function(r){u(e);let s=c();return T(s.manualReservationData.party_size,r)||(s.manualReservationData.party_size=r),p(r)}),f(38,hi,2,5,"option",90),n(),a(39,"div",91),l(40),n()(),a(41,"div",18)(42,"label",19),l(43,"Note Speciali"),n(),a(44,"textarea",92),E("ngModelChange",function(r){u(e);let s=c();return T(s.manualReservationData.special_requests,r)||(s.manualReservationData.special_requests=r),p(r)}),n()(),a(45,"div",75)(46,"button",93),g("click",function(){u(e);let r=c();return p(r.closeManualReservationModal())}),l(47," Annulla "),n(),a(48,"button",94),O(49,"lucide-angular",80),l(50," Crea Prenotazione "),n()()()()()()}if(o&2){let e=z(15),i=c();d(9),v("Nuova Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number,""),d(11),y("ngModel",i.manualReservationData.customer_name),d(4),y("ngModel",i.manualReservationData.customer_phone),d(5),y("ngModel",i.manualReservationData.reservation_date),d(4),y("ngModel",i.manualReservationData.reservation_time),d(4),y("ngModel",i.manualReservationData.party_size),d(),m("ngForOf",W(11,rt)),d(2),v(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),d(4),y("ngModel",i.manualReservationData.special_requests),d(4),m("disabled",!e.valid),d(),m("size",20)}}function xi(o,t){if(o&1&&(a(0,"option",95),l(1),n()),o&2){let e=t.$implicit,i=c(2);m("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),d(),B(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function bi(o,t){if(o&1){let e=w();a(0,"button",100),g("click",function(){u(e);let r=c(2);return p(r.deleteReservation())}),O(1,"lucide-angular",101),l(2," Elimina "),n()}o&2&&(d(),m("size",20))}function Ci(o,t){if(o&1){let e=w();a(0,"div",65)(1,"div",82)(2,"div",67)(3,"div",40)(4,"div",68)(5,"span",29),l(6,"edit"),n()(),a(7,"div")(8,"h1",69),l(9),n()()(),a(10,"button",33),g("click",function(){u(e);let r=c();return p(r.closeEditReservationModal())}),a(11,"span",29),l(12,"close"),n()()(),a(13,"div",70)(14,"form",83,2),g("ngSubmit",function(r){return u(e),c().updateReservation(),p(r.preventDefault())}),a(16,"div",84)(17,"div",18)(18,"label",19),l(19,"Nome Cliente *"),n(),a(20,"input",85),E("ngModelChange",function(r){u(e);let s=c();return T(s.editingReservation.customer_name,r)||(s.editingReservation.customer_name=r),p(r)}),n()(),a(21,"div",18)(22,"label",19),l(23,"Telefono *"),n(),a(24,"input",86),E("ngModelChange",function(r){u(e);let s=c();return T(s.editingReservation.customer_phone,r)||(s.editingReservation.customer_phone=r),p(r)}),n()()(),a(25,"div",84)(26,"div",18)(27,"label",19),l(28,"Data *"),n(),a(29,"input",87),E("ngModelChange",function(r){u(e);let s=c();return T(s.editingReservation.reservation_date,r)||(s.editingReservation.reservation_date=r),p(r)}),n()(),a(30,"div",18)(31,"label",19),l(32,"Orario *"),n(),a(33,"input",88),E("ngModelChange",function(r){u(e);let s=c();return T(s.editingReservation.reservation_time,r)||(s.editingReservation.reservation_time=r),p(r)}),n()()(),a(34,"div",18)(35,"label",19),l(36,"Numero Persone *"),n(),a(37,"select",89),E("ngModelChange",function(r){u(e);let s=c();return T(s.editingReservation.party_size,r)||(s.editingReservation.party_size=r),p(r)}),f(38,xi,2,5,"option",90),n(),a(39,"div",91),l(40),n()(),a(41,"div",18)(42,"label",19),l(43,"Note Speciali"),n(),a(44,"textarea",92),E("ngModelChange",function(r){u(e);let s=c();return T(s.editingReservation.special_requests,r)||(s.editingReservation.special_requests=r),p(r)}),n()(),a(45,"div",75)(46,"div",96),f(47,bi,3,1,"button",97),a(48,"div",98)(49,"button",93),g("click",function(){u(e);let r=c();return p(r.closeEditReservationModal())}),l(50," Annulla "),n(),a(51,"button",94),O(52,"lucide-angular",99),l(53," Salva "),n()()()()()()()()}if(o&2){let e=z(15),i=c();d(9),v("Modifica Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number,""),d(11),y("ngModel",i.editingReservation.customer_name),d(4),y("ngModel",i.editingReservation.customer_phone),d(5),y("ngModel",i.editingReservation.reservation_date),d(4),y("ngModel",i.editingReservation.reservation_time),d(4),y("ngModel",i.editingReservation.party_size),d(),m("ngForOf",W(11,rt)),d(2),v(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),d(4),y("ngModel",i.editingReservation.special_requests),d(3),m("ngIf",i.isReservationDeletable(i.editingReservation)),d(4),m("disabled",!e.valid)}}function wi(o,t){if(o&1){let e=w();a(0,"div",65)(1,"app-order-editor",102),g("saved",function(r){u(e);let s=c();return p(s.onOrderSaved(r))})("closeRequested",function(){u(e);let r=c();return p(r.closeOrderEditorModal())}),n()()}if(o&2){let e=c();d(),m("table",e.orderEditorData.table)("mode",e.orderEditorData.mode)("existingOrderHeader",e.orderEditorData.existingOrderHeader)("selectedComandaId",e.orderEditorData.selectedComandaId)("orderingStatus",e.orderingStatus)}}function Si(o,t){if(o&1){let e=w();a(0,"div",65)(1,"app-order-editor",102),g("saved",function(r){u(e);let s=c();return p(s.onOrderSaved(r))})("closeRequested",function(){u(e);let r=c();return p(r.closeOrderEditorViewModal())}),n()()}if(o&2){let e=c();d(),m("table",e.orderEditorData.table)("mode",e.orderEditorData.mode)("existingOrderHeader",e.orderEditorData.existingOrderHeader)("selectedComandaId",e.orderEditorData.selectedComandaId)("orderingStatus",e.orderingStatus)}}var it=class o{tableStatusService=b(ve);floorManagementService=b(Xe);loadingService=b(Q);tableService=b(Ue);floorPlanService=b(Ge);reservationService=b(Ze);authService=b($);orderHeaderService=b(pe);shiftService=b(et);comandaService=b(me);orderItemService=b(ue);orderManagerService=b(he);cdr=b(J);elementRef=b(De);tutorialService=b(_e);tutorialEditorOpened=!1;pendingTutorialStep=null;ngZone=b(G);mapCardElement;tableMapContainer;zoomLevel=1;minZoom=.5;maxZoom=3;mobileView=!1;isFullscreen=!1;isLargeText=!1;searchTerm="";statusFilter="all";showQuickActionsModal=!1;showManualReservationModal=!1;showEditReservationModal=!1;showAssignReservationModal=!1;showTableReservationsModal=!1;showTableAssignmentModal=!1;showOrderEditorModal=!1;showOrderEditorViewModal=!1;orderEditorData={table:null,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null,selectedComandaId:void 0};currentFloorPlan=null;tableStatuses=[];selectedTable=null;selectedTableStatus=null;currentRestaurant=null;tableOrderCounts=new Map;manualReservationData={customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};editingReservation=null;orderingStatus={allowed:!1,reason:"Caricamento...",currentShift:null};availableReservationsWithoutTable=[];selectedReservationForAssignment=null;assignmentReservation=null;suggestedTablesByFloorPlan={};selectedFloorPlanForAssignment=null;selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}};subscriptions=new Ie;constructor(){K(()=>{let t=this.tutorialService.currentStepData();t?.id==="order-editor"&&!this.tutorialEditorOpened?this.tableService.data.length===0?this.pendingTutorialStep="order-editor":Promise.resolve().then(()=>{this.openOrderEditorForTutorial()}):t?.id!=="order-editor"&&(this.tutorialEditorOpened=!1,this.pendingTutorialStep=null)})}openOrderEditorForTutorial(){let t=this.tableService.data[0];if(!t){console.warn("[Tutorial] Nessun tavolo disponibile, passo allo step successivo"),this.tutorialService.nextStep();return}this.orderEditorData={table:t,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null,selectedComandaId:void 0},this.showOrderEditorModal=!0,console.log("[Tutorial] showOrderEditorModal impostato a true",this.showOrderEditorModal)}get floorPlans(){return this.floorPlanService.data}get dishes(){return[]}ngOnInit(){return h(this,null,function*(){yield this.loadInitialData(),this.checkMobileView(),window.addEventListener("resize",()=>this.checkMobileView()),this.startShiftChecking(),this.setupFullscreenListeners()})}ngOnDestroy(){this.subscriptions.unsubscribe(),window.removeEventListener("resize",()=>this.checkMobileView()),document.removeEventListener("fullscreenchange",this.handleFullscreenChange.bind(this)),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange.bind(this)),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange.bind(this))}loadInitialData(){return h(this,null,function*(){this.loadingService.start();try{yield Promise.all([this.floorPlanService.loadFloorPlans(),this.tableService.loadData(),this.floorManagementService.loadTodaysReservations()]);let t=this.tableService.data.filter(e=>!e.is_merged||e.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(t),this.floorPlans.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=this.floorPlans[0],yield this.loadTablesForFloorPlan()),this.pendingTutorialStep==="order-editor"&&!this.tutorialEditorOpened&&Promise.resolve().then(()=>{this.openOrderEditorForTutorial()})}finally{this.loadingService.stop()}})}onTableClick(t){return h(this,null,function*(){this.selectedTable=t.table,this.selectedTableStatus=t,yield this.loadTableReservations(t.table.id),this.showQuickActionsModal=!0})}deselectTable(){this.selectedTable=null,this.selectedTableStatus=null,this.showQuickActionsModal=!1,this.showManualReservationModal=!1,this.showEditReservationModal=!1}openManualReservationModal(){return h(this,null,function*(){if(!this.selectedTable)return;let t=new Date;this.manualReservationData={customer_name:"",customer_phone:"",reservation_date:t.toISOString().split("T")[0],reservation_time:t.toTimeString().split(" ")[0].substring(0,5),party_size:this.selectedTable.capacity||2,special_requests:""},this.showQuickActionsModal=!1,this.showManualReservationModal=!0})}closeManualReservationModal(){this.showManualReservationModal=!1}createManualReservation(){return h(this,null,function*(){if(this.selectedTable)try{let t=yield this.getCurrentRestaurantId();if(!t)return;let e={restaurant_id:t,table_id:this.selectedTable.id,reservation_date:this.manualReservationData.reservation_date,reservation_time:this.manualReservationData.reservation_time,party_size:this.manualReservationData.party_size,special_requests:this.manualReservationData.special_requests,status:"confirmed",customer_name:this.manualReservationData.customer_name,customer_phone:this.manualReservationData.customer_phone};(yield this.reservationService.createRestaurantReservation(e))?(this.closeManualReservationModal(),yield this.loadInitialData(),alert("Prenotazione creata con successo!")):alert("Errore nella creazione della prenotazione")}catch(t){console.error("Error creating manual reservation:",t),alert("Errore durante la creazione della prenotazione: "+t.message)}})}openOrderEditor(){return h(this,null,function*(){if(this.selectedTable)try{this.loadingService.start();let t=yield this.orderHeaderService.getActiveByTable(this.selectedTable.id);t?(this.orderEditorData={table:this.selectedTable,mode:"view",existingOrderHeader:t,orderHeaders:[t],currentTavolataId:t.id,selectedComandaId:void 0},this.showOrderEditorViewModal=!0,console.log("\u{1F441}\uFE0F Apro order editor in modalit\xE0 VIEW")):(this.orderEditorData={table:this.selectedTable,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null,selectedComandaId:void 0},this.showOrderEditorModal=!0,console.log("\u270F\uFE0F Apro order editor in modalit\xE0 EDIT (nuovo)")),this.showQuickActionsModal=!1}catch(t){console.error("\u274C Errore apertura order editor:",t)}finally{this.loadingService.stop()}})}closeOrderEditorModal(){this.showOrderEditorModal=!1,this.loadTablesForFloorPlan()}closeOrderEditorViewModal(){this.showOrderEditorViewModal=!1}loadTableReservations(t){return h(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let i=new Date().toISOString().split("T")[0],r=this.reservationService.data.filter(x=>x.restaurant_id===e&&x.table_id===t&&x.reservation_date===i&&["confirmed","pending"].includes(x.status)).sort((x,C)=>x.reservation_time.localeCompare(C.reservation_time)),s=null,_=[];for(let x of r){let C=new Date(`${x.reservation_date}T${x.reservation_time}`),S=new Date,I=(C.getTime()-S.getTime())/(1e3*60*60);I>=0&&I<=1.5?s=x:I>1.5&&_.push(x)}this.selectedTableReservations={active:s,futureReservations:_,shiftInfo:{current:null,next:null}}}catch(e){console.error("Errore caricamento prenotazioni tavolo:",e),this.selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}}}})}checkMobileView(){this.mobileView=window.innerWidth<=768}getFilteredTables(){let t=this.tableStatuses;if(this.statusFilter!=="all"&&(t=t.filter(e=>e.status===this.statusFilter)),this.searchTerm){let e=this.searchTerm.toLowerCase();t=t.filter(i=>i.table.table_number.toLowerCase().includes(e)||i.table.table_name.toLowerCase().includes(e))}return t}getTableClass(t){let e=this.selectedTable?.id===t.table.id;return`table-element shape-${t.table.shape} ${t.status} ${e?"selected":""}`}getTableStyle(t){return{left:t.position_x+"px",top:t.position_y+"px",width:t.width+"px",height:t.height+"px","border-radius":t.shape==="circle"?"50%":"0px",transform:`rotate(${t.rotation}deg)`}}startShiftChecking(){this.checkCurrentShift(),this.subscriptions.add(ke(6e4).subscribe(()=>this.checkCurrentShift()))}checkCurrentShift(){return h(this,null,function*(){let t=yield this.shiftService.getOrderingStatus();this.orderingStatus=t})}getShiftStatusClass(){return this.orderingStatus.allowed?"shift-active":"shift-inactive"}getShiftStatusText(){return this.orderingStatus.allowed?"\u{1F4CB} Orario di turno":"\u23F0 "+this.orderingStatus.reason}getCurrentRestaurantId(){return h(this,null,function*(){try{let t=this.authService.getCurrentStaffRestaurantId();return t||(this.authService.currentUserValue?(yield this.reservationService.loadData(),this.reservationService.data.length>0&&this.reservationService.data[0]?.restaurant_id||null):null)}catch(t){return console.error("Errore in getCurrentRestaurantId:",t),null}})}getStatusColorClass(t=""){return`status-${t}`}getStatusText(t=""){return{free:"Libero",reserved:"Prenotato",occupied:"Occupato"}[t]||t}getTableOrderItemsCount(t){return h(this,null,function*(){try{let e=yield this.orderHeaderService.getActiveByTable(t);if(!e)return 0;let i=yield this.comandaService.loadByOrderHeaderId(e.id),r=0;for(let s of i){let _=yield this.orderItemService.loadByComandaId(s.id);r+=_.length}return r}catch(e){return console.error("Errore conteggio piatti:",e),0}})}onFloorPlanSelect(t){this.currentFloorPlan=t,this.loadTablesForFloorPlan(),this.deselectTable()}safeToggleFullscreen(){return h(this,null,function*(){try{if(document.fullscreenElement)document.exitFullscreen?yield document.exitFullscreen():document.webkitExitFullscreen?yield document.webkitExitFullscreen():document.msExitFullscreen&&(yield document.msExitFullscreen()),this.isFullscreen=!1;else{let t=this.tableMapContainer?.nativeElement||document.documentElement;this.cdr.detectChanges(),t.requestFullscreen?yield t.requestFullscreen():t.webkitRequestFullscreen?yield t.webkitRequestFullscreen():t.msRequestFullscreen&&(yield t.msRequestFullscreen()),this.isFullscreen=!0}this.cdr.detectChanges()}catch(t){console.error("Errore fullscreen:",t),this.isFullscreen=!this.isFullscreen,this.cdr.detectChanges()}})}setupFullscreenListeners(){document.addEventListener("fullscreenchange",this.handleFullscreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.handleFullscreenChange.bind(this))}handleFullscreenChange(){let t=this.isFullscreen;this.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement),setTimeout(()=>{this.cdr.detectChanges()},0)}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.25,this.maxZoom)}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.25,this.minZoom)}resetZoom(){this.zoomLevel=1}getScaledWidth(){return(this.currentFloorPlan?.width||1e3)*this.zoomLevel}getScaledHeight(){return(this.currentFloorPlan?.height||800)*this.zoomLevel}updateReservation(){return h(this,null,function*(){if(this.editingReservation)try{(yield this.reservationService.updateReservation(this.editingReservation.id,this.editingReservation))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'aggiornamento della prenotazione")}catch(t){console.error("Errore nell'aggiornamento della prenotazione:",t),alert("Errore durante l'aggiornamento della prenotazione")}})}deleteReservation(){return h(this,null,function*(){if(this.editingReservation&&this.isReservationDeletable(this.editingReservation))try{(yield this.reservationService.deleteReservation(this.editingReservation.id))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'eliminazione della prenotazione")}catch(t){console.error("Errore nell'eliminazione della prenotazione:",t),alert("Errore durante l'eliminazione della prenotazione")}else alert("Impossibile eliminare questa prenotazione")})}isReservationDeletable(t){return!t?.reservation_date||!t?.reservation_time?!1:new Date(`${t.reservation_date}T${t.reservation_time}`)>new Date}openEditReservationModal(){this.selectedTableStatus?.currentReservation&&(this.editingReservation=V({},this.selectedTableStatus.currentReservation),this.showEditReservationModal=!0,this.showQuickActionsModal=!1)}closeEditReservationModal(){this.showEditReservationModal=!1,this.editingReservation=null}getFreeTablesCount(){return this.tableStatuses.filter(t=>t.status==="free").length}getReservedTablesCount(){return this.tableStatuses.filter(t=>t.status==="reserved").length}getOccupiedTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied").length}getTotalTablesCount(){return this.tableStatuses.length}toggleSize(){this.isLargeText=!this.isLargeText}getTableOrderItemsCountSync(t){return 0}loadAllTableOrderCounts(){return h(this,null,function*(){this.tableOrderCounts.clear();let t=this.tableStatuses.map(e=>h(this,null,function*(){try{let i=yield this.getTableOrderItemsCount(e.table.id);this.tableOrderCounts.set(e.table.id,i)}catch(i){console.error(`Errore caricamento ordini per tavolo ${e.table.id}:`,i),this.tableOrderCounts.set(e.table.id,0)}}));yield Promise.all(t)})}getTableOrderCount(t){return this.tableOrderCounts.get(t)||0}loadTablesForFloorPlan(){return h(this,null,function*(){if(!this.currentFloorPlan)return;let t=this.currentFloorPlan.current_version??1,i=this.tableService.getTablesByFloorPlan(this.currentFloorPlan.id,t).filter(r=>!r.is_merged||r.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(i),yield this.loadAllTableOrderCounts()})}getTablesWithOrdersCount(){return Array.from(this.tableOrderCounts.values()).filter(t=>t>0).length}freeTable(){return h(this,null,function*(){if(!this.selectedTable)return;let t=this.selectedTable,e=t.table_number;try{let i=yield this.getTableOrderItemsCount(t.id);if(i>0){if(!confirm(`\u26A0\uFE0F ATTENZIONE!

Il tavolo ${e} ha ${i} piatti ordinati.

Sei sicuro di voler liberare il tavolo?
Questa azione chiuder\xE0 tutti gli ordini attivi.`))return}else if(!confirm(`Vuoi liberare il tavolo ${e}?`))return;this.loadingService.start(),(yield this.orderHeaderService.closeAllActiveHeadersForTable(t.id))?(console.log(`\u2705 Tavolo ${e} liberato`),yield this.loadTablesForFloorPlan(),this.deselectTable(),alert(`\u2705 Tavolo ${e} liberato con successo!`)):alert("\u274C Errore durante la liberazione del tavolo. Riprova.")}catch(i){console.error("\u274C Errore liberazione tavolo:",i),alert("\u274C Errore durante la liberazione del tavolo.")}finally{this.loadingService.stop()}})}addNewComandaToTable(){return h(this,null,function*(){if(this.selectedTable)try{this.loadingService.start(),console.log("\u{1F195} Aggiunta nuova comanda al tavolo:",this.selectedTable.table_number);let t=yield this.orderHeaderService.getActiveByTable(this.selectedTable.id);if(!t){console.error("\u274C Nessuna tavolata attiva trovata per questo tavolo"),alert("Prima crea una tavolata per questo tavolo");return}console.log("\u2705 Tavolata trovata:",t.order_number);let e=yield this.orderManagerService.createComanda(t.id);if(!e){console.error("\u274C Errore nella creazione della nuova comanda"),alert("Errore nella creazione della nuova comanda");return}console.log("\u2705 Nuova comanda creata:",e.comanda_number);let i=yield this.orderManagerService.loadTavolata(t.id);if(!i){console.error("\u274C Impossibile caricare l'ordine completo"),alert("Errore nel caricamento dell'ordine");return}this.orderEditorData={table:this.selectedTable,mode:"edit",existingOrderHeader:i,orderHeaders:[i],currentTavolataId:i.id,selectedComandaId:e.id},this.showOrderEditorModal=!0,this.showQuickActionsModal=!1,console.log("\u{1F4CB} Aperto order editor con nuova comanda:",e.comanda_number)}catch(t){console.error("\u{1F4A5} Errore in addNewComandaToTable:",t),alert("Errore: "+t.message)}finally{this.loadingService.stop()}})}onOrderSaved(t){console.log("\u2705 Ordine salvato, aggiorno la mappa"),this.loadTablesForFloorPlan(),this.closeOrderEditorModal(),this.closeOrderEditorViewModal()}get isLoading(){return this.loadingService.isLoadingSync()}get isFullscreenMode(){return this.isFullscreen}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=U({type:o,selectors:[["app-table-map"]],viewQuery:function(e,i){if(e&1&&(Ce(ni,5),Ce(oi,5)),e&2){let r;we(r=Se())&&(i.mapCardElement=r.first),we(r=Se())&&(i.tableMapContainer=r.first)}},hostVars:2,hostBindings:function(e,i){e&2&&F("fullscreen-mode",i.isFullscreenMode)},decls:121,vars:37,consts:[["tableMapContainer",""],["floorPlanCanvas",""],["reservationForm","ngForm"],[1,"page-container"],["data-tutorial","table-map-legend",1,"grid-cards","p-sm","mt-lg"],[1,"card"],[1,"flex","flex-col","gap-md"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"form-card","mt-lg"],["data-tutorial","table-map-shift",1,"flex-col","flex","gap-md"],[1,"flex","justify-between","items-center"],[1,"flex"],[1,"text-muted","text-sm"],[1,"text-sm","text-muted"],["data-tutorial","table-map-search",1,"form-row","mt-lg"],[1,"form-group"],[1,"standard-label"],["type","text","placeholder","Numero o nome tavolo...",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],["value","free"],["value","reserved"],["value","occupied"],[1,"form-group","mt-sm"],[1,"flex","gap-md"],[1,"icon-button",3,"click","disabled"],[1,"material-icons"],[1,"flex","items-center","gap-sm","px-md","py-sm","justify-center"],[1,"material-icons","text-sm"],[1,"font-semibold"],[1,"icon-button",3,"click"],[1,"form-card"],[1,"flex","justify-between","items-center","mb-md","gap-sm","flex-wrap"],[1,"flex","items-center","gap-sm","flex-wrap"],["class","form-input","style","width: auto; min-width: 180px;",3,"ngModel","ngModelChange",4,"ngIf"],[1,"flex","flex-wrap","items-center","gap-sm"],[1,"flex","gap-sm","mr-md","flex-wrap"],[1,"flex","items-center","gap-sm"],[1,"legend-color","free"],[1,"text-sm"],[1,"legend-color","reserved"],[1,"legend-color","occupied"],["data-tutorial","table-map-floor",1,"canvas-container"],[1,"canvas-wrapper"],[1,"floor-plan-canvas"],[1,"grid-overlay"],["class","table-element",3,"class","ngStyle","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"form-input",2,"width","auto","min-width","180px",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"table-element",3,"click","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-details"],[1,"table-capacity"],["name","user",1,"nav-icon",3,"size"],["class","table-info",3,"text-large",4,"ngIf"],[1,"table-info"],[1,"empty-state"],[1,"text-muted"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"header-icon"],[1,"section-title"],[1,"p-lg"],[1,"flex","flex-col","gap-lg"],[1,"flex","justify-center"],[1,"chip"],["class","modal-footer",4,"ngIf"],[1,"modal-footer"],[1,"promethea-button",3,"click"],[1,"promethea-button","primary",3,"click","disabled","title"],[1,"promethea-button","primary",3,"click"],[1,"promethea-button","success",3,"click","disabled"],["name","plus",3,"size"],[1,"promethea-button","ghost",3,"click"],[1,"modal-container","modal-md"],[1,"generic-form",3,"ngSubmit"],[1,"form-row"],["type","text","name","customer_name","required","","placeholder","Inserisci il nome del cliente",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone","required","","placeholder","Inserisci il telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","date","name","reservation_date","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","time","name","reservation_time","required","",1,"form-input",3,"ngModelChange","ngModel"],["name","party_size","required","",1,"form-input",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"text-muted","mt-sm"],["name","special_requests","rows","3","placeholder","Note o richieste speciali...",1,"form-input",3,"ngModelChange","ngModel"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[3,"value","disabled"],[1,"flex","justify-between","items-center","w-full"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],[1,"flex","gap-sm"],["name","save"],["type","button",1,"promethea-button","danger",3,"click"],["name","trash-2",3,"size"],[3,"saved","closeRequested","table","mode","existingOrderHeader","selectedComandaId","orderingStatus"]],template:function(e,i){if(e&1){let r=w();a(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"span",8),l(6,"event_available"),n(),a(7,"div",9),l(8,"Tavoli Liberi"),n()(),a(9,"div",10),l(10),n()()(),a(11,"div",5)(12,"div",6)(13,"div",7)(14,"span",8),l(15,"event"),n(),a(16,"div",9),l(17,"Prenotati"),n()(),a(18,"div",10),l(19),n()()(),a(20,"div",5)(21,"div",6)(22,"div",7)(23,"span",8),l(24,"restaurant"),n(),a(25,"div",9),l(26,"Occupati"),n()(),a(27,"div",10),l(28),n()()(),a(29,"div",5)(30,"div",6)(31,"div",7)(32,"span",8),l(33,"table_restaurant"),n(),a(34,"div",9),l(35,"Tavoli Totali"),n()(),a(36,"div",10),l(37),n()()()(),a(38,"div",11)(39,"div",12)(40,"div",13)(41,"div",14),l(42),n(),a(43,"div",15),l(44),n()(),a(45,"div",16),l(46," \u23F0 Si pu\xF2 ordinare 1h prima/dopo il turno "),n()(),a(47,"div",17)(48,"div",18)(49,"label",19),l(50,"Cerca"),n(),a(51,"input",20),E("ngModelChange",function(_){return u(r),T(i.searchTerm,_)||(i.searchTerm=_),p(_)}),n()(),a(52,"div",18)(53,"label",19),l(54,"Stato"),n(),a(55,"select",21),E("ngModelChange",function(_){return u(r),T(i.statusFilter,_)||(i.statusFilter=_),p(_)}),a(56,"option",22),l(57,"Tutti gli stati"),n(),a(58,"option",23),l(59,"Libero"),n(),a(60,"option",24),l(61,"Prenotato"),n(),a(62,"option",25),l(63,"Occupato"),n()()()(),a(64,"div",26)(65,"label",19),l(66,"Azioni"),n(),a(67,"div",27)(68,"button",28),g("click",function(){return u(r),p(i.zoomOut())}),a(69,"span",29),l(70,"zoom_out"),n()(),a(71,"div",30)(72,"span",31),l(73,"search"),n(),a(74,"span",32),l(75),n()(),a(76,"button",28),g("click",function(){return u(r),p(i.zoomIn())}),a(77,"span",29),l(78,"zoom_in"),n()(),a(79,"button",33),g("click",function(){return u(r),p(i.resetZoom())}),a(80,"span",29),l(81,"history"),n()()()()(),a(82,"div",34,0)(84,"div",35)(85,"div",36)(86,"h2",32),l(87,"Mappa:"),n(),f(88,li,2,2,"select",37),n(),a(89,"div",38)(90,"div",39)(91,"div",40),O(92,"div",41),a(93,"span",42),l(94,"Libero"),n()(),a(95,"div",40),O(96,"div",43),a(97,"span",42),l(98,"Prenotato"),n()(),a(99,"div",40),O(100,"div",44),a(101,"span",42),l(102,"Occupato"),n()()(),a(103,"button",33),g("click",function(){return u(r),p(i.safeToggleFullscreen())}),a(104,"span",29),l(105),n()(),a(106,"button",33),g("click",function(){return u(r),p(i.toggleSize())}),a(107,"span",29),l(108),n()()()(),a(109,"div",45)(110,"div",46)(111,"div",47,1),O(113,"div",48),f(114,mi,10,10,"div",49)(115,ui,7,0,"div",50),n()()(),f(116,gi,21,7,"div",51)(117,fi,51,12,"div",51)(118,Ci,54,12,"div",51)(119,wi,2,5,"div",51)(120,Si,2,5,"div",51),n()()}e&2&&(d(10),v(" ",i.getFreeTablesCount()," "),d(9),v(" ",i.getReservedTablesCount()," "),d(9),v(" ",i.getOccupiedTablesCount()," "),d(9),v(" ",i.getTotalTablesCount()," "),d(4),Z(i.getShiftStatusClass()),d(),v(" ",i.getShiftStatusText()," "),d(2),v(" ",i.orderingStatus.reason," "),d(7),y("ngModel",i.searchTerm),d(4),y("ngModel",i.statusFilter),d(13),m("disabled",i.zoomLevel<=i.minZoom),d(7),v("",(i.zoomLevel*100).toFixed(0),"%"),d(),m("disabled",i.zoomLevel>=i.maxZoom),d(12),m("ngIf",i.floorPlans.length>0),d(15),F("active",i.isFullscreen),d(2),v(" ",i.isFullscreen?"fullscreen_exit":"fullscreen"," "),d(3),v(" ",i.isLargeText?"text_decrease":"text_increase"," "),d(2),q("width",i.getScaledWidth(),"px")("height",i.getScaledHeight(),"px"),d(),q("width",i.currentFloorPlan?i.currentFloorPlan.width:1e3,"px")("height",i.currentFloorPlan?i.currentFloorPlan.height:800,"px")("transform","scale("+i.zoomLevel+")")("transform-origin","0 0"),d(3),m("ngForOf",i.getFilteredTables()),d(),m("ngIf",i.getFilteredTables().length===0),d(),m("ngIf",i.showQuickActionsModal),d(),m("ngIf",i.showManualReservationModal),d(),m("ngIf",i.showEditReservationModal),d(),m("ngIf",i.showOrderEditorModal),d(),m("ngIf",i.showOrderEditorViewModal))},dependencies:[te,X,ee,Ve,le,qe,oe,de,ie,ne,re,Le,Be,ae,Ne,ge,ce,se],styles:[".fullscreen-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--background);padding:var(--gap-sm);display:flex;flex-wrap:wrap;flex-direction:column;border-bottom:1px solid var(--smoke-1);backdrop-filter:blur(10px);gap:var(--gap-sm)}.fullscreen-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin:0;flex:1;min-width:120px}.legend-color[_ngcontent-%COMP%]{width:var(--fs-md);height:var(--fs-sm);display:flex;border-radius:var(--gap-sm)}.legend-color.free[_ngcontent-%COMP%]{background:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.occupied[_ngcontent-%COMP%]{background:#ef4444}.legend-color.merged[_ngcontent-%COMP%]{background:#ff6b35}[_ngcontent-%COMP%]:fullscreen{background-color:var(--background)!important}[_ngcontent-%COMP%]:fullscreen   .floor-plan-canvas[_ngcontent-%COMP%]{position:absolute;top:70px}.fullscreen-mode[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh;width:100vw;overflow:hidden;background:var(--background)}.fullscreen-mode[_nghost-%COMP%]   .fullscreen-header[_ngcontent-%COMP%]{position:static;flex-shrink:0;width:100%;z-index:auto;border-bottom:1px solid var(--smoke-1)}.fullscreen-mode[_nghost-%COMP%]   .canvas-container[_ngcontent-%COMP%]{flex:1;overflow:auto;height:auto;border:none;border-radius:0;padding:var(--gap-sm)}[_ngcontent-%COMP%]:fullscreen   .floor-plan-canvas[_ngcontent-%COMP%]{top:auto}"]})};export{it as TableMap};
