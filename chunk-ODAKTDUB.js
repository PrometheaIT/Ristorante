import{a as ee}from"./chunk-WYLNEMQW.js";import{a as te}from"./chunk-KYOIGWSF.js";import{a as Z}from"./chunk-MQHGUKSF.js";import{a as L,b as j,d as Y,h as H,q as J,r as K,s as Q,v as U,x as X}from"./chunk-7VSFVQGQ.js";import{a as $}from"./chunk-SSJAIGRQ.js";import"./chunk-VOCUDH6H.js";import"./chunk-QMR2VPJU.js";import"./chunk-TAPIY3IR.js";import"./chunk-HZAFCD3S.js";import{c as G,d as A,m as q}from"./chunk-VYE6ILYG.js";import{$a as m,Bb as E,Eb as l,Fb as M,Ga as c,Gb as b,Hb as P,Ib as F,Jb as v,Kb as h,Lb as f,Ob as N,Wa as z,a as k,b as V,da as R,g as w,h as W,hb as _,ia as g,ib as n,ja as p,jb as a,nb as S,ob as T,pb as y,sb as u,ub as d,zb as B}from"./chunk-3SWAHN2Y.js";var ae=()=>[1,2,3,4,5,6,7,8,9,10];function re(s,t){if(s&1&&(n(0,"option",38),l(1),a()),s&2){let e=t.$implicit;_("value",e.name),c(),F(" ",e.name," (",e.start_time.substring(0,5)," - ",e.end_time.substring(0,5),") ")}}function oe(s,t){if(s&1&&(n(0,"span",39),l(1),a()),s&2){let e=d();c(),b(" ",e.getActiveFiltersInfo().text," ")}}function se(s,t){if(s&1){let e=y();n(0,"div",40)(1,"span",5),l(2,"error"),a(),l(3),n(4,"button",41),u("click",function(){g(e);let r=d();return p(r.error=null)}),n(5,"span",5),l(6,"close"),a()()()}if(s&2){let e=d();c(3),b(" ",e.error," ")}}function le(s,t){if(s&1&&(n(0,"div",61),l(1),a()),s&2){let e=d().$implicit;c(),b(" ",e.customer_email," ")}}function ce(s,t){if(s&1&&(n(0,"option",70),l(1),a()),s&2){let e=t.$implicit,i=d(6).$implicit;_("value",e.id)("title","Capacit\xE0: "+e.capacity+" posti"),c(),F(" ",e.table_name||"Tavolo "+e.table_number," (",e.capacity," posti) ",e.capacity===i.party_size?"\u2B50":""," ")}}function de(s,t){if(s&1&&(n(0,"optgroup",68),m(1,ce,2,5,"option",69),a()),s&2){let e=d().$implicit;_("label",e.floorPlan.name),c(),_("ngForOf",e.tables)}}function _e(s,t){if(s&1&&(S(0),m(1,de,2,2,"optgroup",67),T()),s&2){let e=t.$implicit;c(),_("ngIf",e.tables&&e.tables.length>0)}}function me(s,t){if(s&1&&(S(0),m(1,_e,2,1,"ng-container",48),T()),s&2){let e=d(3).$implicit,i=d(3);c(),_("ngForOf",i.getFilteredTableGroups(e.party_size))}}function ue(s,t){if(s&1&&(n(0,"option",38),l(1),a()),s&2){let e=t.$implicit,i=d(4).$implicit;_("value",e.id),c(),F(" ",e.table_name||"Tavolo "+e.table_number," (",e.capacity," posti) ",e.capacity===i.party_size?"\u2B50":""," ")}}function ge(s,t){if(s&1&&(S(0),m(1,ue,2,4,"option",27),T()),s&2){let e=d(3).$implicit,i=d(3);c(),_("ngForOf",i.getFilteredTables(e.party_size))}}function pe(s,t){s&1&&(n(0,"option",71),l(1," Nessun tavolo disponibile "),a())}function ve(s,t){if(s&1){let e=y();n(0,"select",63,0),u("change",function(){g(e);let r=B(1),o=d(2).$implicit,x=d(3);return p(x.assignTable(o.id,r.value))}),n(2,"option",64),l(3,"Assegna tavolo..."),a(),m(4,me,2,1,"ng-container",65)(5,ge,2,1,"ng-container",65)(6,pe,2,0,"option",66),a()}if(s&2){let e=d(5);c(4),_("ngIf",e.tableGroups&&e.tableGroups.length>0),c(),_("ngIf",(!e.tableGroups||e.tableGroups.length===0)&&e.tables.length>0),c(),_("ngIf",e.tables.length===0&&e.tableGroups.length===0)}}function he(s,t){if(s&1&&(n(0,"div",31),m(1,ve,7,3,"select",62),a()),s&2){let e=d().$implicit;c(),_("ngIf",!e.table_id)}}function fe(s,t){s&1&&(n(0,"span",61),l(1," Nessun tavolo "),a())}function be(s,t){if(s&1){let e=y();n(0,"button",72),u("click",function(){g(e);let r=d().$implicit,o=d(3);return p(o.unassignTable(r.id))}),n(1,"span",5),l(2,"close"),a()()}}function xe(s,t){if(s&1){let e=y();n(0,"button",73),u("click",function(){g(e);let r=d().$implicit,o=d(3);return p(o.updateStatus(r.id,"confirmed"))}),n(1,"span",5),l(2,"check"),a()()}}function we(s,t){if(s&1){let e=y();n(0,"button",74),u("click",function(){g(e);let r=d().$implicit,o=d(3);return p(o.updateStatus(r.id,"pending"))}),n(1,"span",5),l(2,"schedule"),a()()}}function ye(s,t){if(s&1){let e=y();n(0,"tr")(1,"td"),l(2),a(),n(3,"td"),l(4),a(),n(5,"td")(6,"div",49)(7,"strong"),l(8),a(),m(9,le,2,1,"div",50),n(10,"span",51),l(11),a()()(),n(12,"td"),l(13),a(),n(14,"td"),l(15),a(),n(16,"td")(17,"div",52)(18,"div",53)(19,"span"),l(20),a(),m(21,he,2,1,"div",54)(22,fe,2,0,"span",50),a(),m(23,be,3,0,"button",55),a()(),n(24,"td")(25,"span",56),l(26),a()(),n(27,"td")(28,"span",56),l(29),a()(),n(30,"td")(31,"div",31),m(32,xe,3,0,"button",57)(33,we,3,0,"button",58),n(34,"button",59),u("click",function(){let r=g(e).$implicit,o=d(3);return p(o.openEditModal(r))}),n(35,"span",5),l(36,"edit"),a()(),n(37,"button",60),u("click",function(){let r=g(e).$implicit,o=d(3);return p(o.deleteReservation(r.id))}),n(38,"span",5),l(39,"delete"),a()()()()()}if(s&2){let e=t.$implicit,i=d(3);c(2),M(i.formatDate(e.reservation_date)),c(2),M(i.formatTime(e.reservation_time)),c(4),M(i.getCustomerFullName(e)),c(),_("ngIf",e.customer_email),c(),E("active",e.customer_id),c(),b(" ",e.customer_id?"Cliente Registrato":"Nuovo Cliente"," "),c(2),M(i.getCustomerContact(e)),c(2),M(e.party_size),c(5),M(i.getTableName(e)),c(),_("ngIf",i.tables.length>0||i.tableGroups.length>0),c(),_("ngIf",i.tables.length===0&&i.tableGroups.length===0),c(),_("ngIf",e.table_id),c(2),E("active",i.getStatusColor(e.status)),c(),b(" ",i.getStatusText(e.status)," "),c(2),E("active",i.getReservationShift(e)!=="N/D"),c(),b(" ",i.getReservationShift(e)," "),c(3),_("ngIf",e.status!=="confirmed"),c(),_("ngIf",e.status!=="pending")}}function Me(s,t){if(s&1&&(n(0,"table",45)(1,"thead")(2,"tr")(3,"th"),l(4,"Data"),a(),n(5,"th"),l(6,"Ora"),a(),n(7,"th"),l(8,"Cliente"),a(),n(9,"th",46)(10,"span",47),l(11,"phone_enabled"),a()(),n(12,"th",46)(13,"span",47),l(14,"groups"),a()(),n(15,"th",46)(16,"span",47),l(17,"table_restaurant"),a()(),n(18,"th"),l(19,"Stato"),a(),n(20,"th"),l(21,"Turno"),a(),n(22,"th"),l(23,"Azioni"),a()()(),n(24,"tbody"),m(25,ye,40,21,"tr",48),a()()),s&2){let e=d(2);c(25),_("ngForOf",e.filteredReservations)}}function Ce(s,t){if(s&1){let e=y();n(0,"div",75)(1,"span",5),l(2,"event_busy"),a(),n(3,"p",6),l(4,"Nessuna prenotazione trovata con i filtri selezionati"),a(),n(5,"button",76),u("click",function(){g(e);let r=d(2);return p(r.openCreateModal())}),l(6," Crea la prima prenotazione "),a()()}}function Re(s,t){if(s&1&&(n(0,"div",42),m(1,Me,26,1,"table",43)(2,Ce,7,0,"div",44),a()),s&2){let e=d();c(),_("ngIf",e.filteredReservations.length>0),c(),_("ngIf",e.filteredReservations.length===0)}}function Se(s,t){if(s&1&&(n(0,"option",98),l(1),a()),s&2){let e=t.$implicit,i=d(2);_("value",e)("selected",e===i.newReservation.reservation_time),c(),b(" ",e," ")}}function Te(s,t){if(s&1&&(n(0,"option",38),l(1),a()),s&2){let e=t.$implicit;_("value",e),c(),P(" ",e," ",e===1?"persona":"persone"," ")}}function Ee(s,t){if(s&1&&(n(0,"option",98),l(1),a()),s&2){let e=t.$implicit,i=d(3);_("value",e.id)("selected",e.id===i.newReservation.table_id),c(),P(" ",e.table_name||"Tavolo "+e.table_number," (",e.capacity," posti) ")}}function Pe(s,t){if(s&1&&(n(0,"optgroup",99),m(1,Ee,2,4,"option",89),a()),s&2){let e=d(2);c(),_("ngForOf",e.getTablesByExactCapacity(e.newReservation.party_size))}}function Fe(s,t){if(s&1&&(n(0,"option",98),l(1),a()),s&2){let e=t.$implicit,i=d(3);_("value",e.id)("selected",e.id===i.newReservation.table_id),c(),P(" ",e.table_name||"Tavolo "+e.table_number," (",e.capacity," posti) ")}}function Ie(s,t){if(s&1&&(n(0,"optgroup",100),m(1,Fe,2,4,"option",89),a()),s&2){let e=d(2);c(),_("ngForOf",e.getTablesByGreaterCapacity(e.newReservation.party_size))}}function Oe(s,t){if(s&1&&(n(0,"option",71),l(1),a()),s&2){let e=d(2);c(),b(" Nessun tavolo disponibile per ",e.newReservation.party_size," persone ")}}function De(s,t){if(s&1&&(n(0,"small",6),l(1),a()),s&2){let e=d(2);c(),b(" Capacit\xE0 tavolo: ",e.getSelectedTableCapacity()," posti ")}}function ke(s,t){if(s&1&&(n(0,"small",6),l(1),a()),s&2){let e=d(2);c(),b(" \u2B50 Mostra tavoli con capacit\xE0 esatta per ",e.newReservation.party_size," persone ")}}function Ve(s,t){s&1&&(n(0,"span",5),l(1,"refresh"),a())}function We(s,t){if(s&1){let e=y();n(0,"div",77)(1,"div",78)(2,"div",79)(3,"h2",3)(4,"span",5),l(5),a(),l(6),a(),n(7,"button",80),u("click",function(){g(e);let r=d();return p(r.closeCreateModal())}),n(8,"span",5),l(9,"close"),a()()(),n(10,"div",81)(11,"div",40)(12,"span",5),l(13,"info"),a(),n(14,"span"),l(15,"Stai creando una prenotazione per un cliente (registrato o nuovo)"),a()(),n(16,"div",82)(17,"div",9)(18,"label",10),l(19,"Nome *"),a(),n(20,"input",83),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.customer_name,r)||(o.newReservation.customer_name=r),p(r)}),a()(),n(21,"div",9)(22,"label",10),l(23,"Cognome *"),a(),n(24,"input",84),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.customer_surname,r)||(o.newReservation.customer_surname=r),p(r)}),a()()(),n(25,"div",82)(26,"div",9)(27,"label",10),l(28,"Telefono *"),a(),n(29,"input",85),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.customer_phone,r)||(o.newReservation.customer_phone=r),p(r)}),a()(),n(30,"div",9)(31,"label",10),l(32,"Email (opzionale)"),a(),n(33,"input",86),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.customer_email,r)||(o.newReservation.customer_email=r),p(r)}),a()()(),n(34,"div",82)(35,"div",9)(36,"label",10),l(37,"Data *"),a(),n(38,"input",87),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.reservation_date,r)||(o.newReservation.reservation_date=r),p(r)}),a()(),n(39,"div",9)(40,"label",10),l(41,"Ora *"),a(),n(42,"select",88),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.reservation_time,r)||(o.newReservation.reservation_time=r),p(r)}),m(43,Se,2,3,"option",89),a()()(),n(44,"div",82)(45,"div",9)(46,"label",10),l(47,"Numero Persone *"),a(),n(48,"select",88),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.party_size,r)||(o.newReservation.party_size=r),p(r)}),m(49,Te,2,3,"option",27),a()(),n(50,"div",9)(51,"label",10),l(52,"Stato"),a(),n(53,"select",90),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.status,r)||(o.newReservation.status=r),p(r)}),n(54,"option",24),l(55,"Confermata"),a(),n(56,"option",25),l(57,"In attesa"),a()()()(),n(58,"div",82)(59,"div",9)(60,"label",10),l(61,"Tavolo (opzionale)"),a(),n(62,"select",90),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.table_id,r)||(o.newReservation.table_id=r),p(r)}),n(63,"option",38),l(64,"Nessun tavolo assegnato"),a(),m(65,Pe,2,1,"optgroup",91)(66,Ie,2,1,"optgroup",92)(67,Oe,2,1,"option",66),a(),m(68,De,2,1,"small",93)(69,ke,2,1,"small",93),a()(),n(70,"div",8)(71,"div",9)(72,"label",10),l(73,"Richieste Speciali"),a(),n(74,"textarea",94),f("ngModelChange",function(r){g(e);let o=d();return h(o.newReservation.special_requests,r)||(o.newReservation.special_requests=r),p(r)}),a()()()(),n(75,"div",95)(76,"button",76),u("click",function(){g(e);let r=d();return p(r.closeCreateModal())}),l(77," Annulla "),a(),n(78,"button",96),u("click",function(){g(e);let r=d();return p(r.createReservation())}),m(79,Ve,2,0,"span",97),l(80),a()()()()}if(s&2){let e=d();c(5),M(e.isEditing?"edit":"add_circle"),c(),b(" ",e.isEditing?"Modifica Prenotazione":"Nuova Prenotazione Ristorante"," "),c(14),v("ngModel",e.newReservation.customer_name),_("required",!e.newReservation.customer_id),c(4),v("ngModel",e.newReservation.customer_surname),_("required",!e.newReservation.customer_id),c(5),v("ngModel",e.newReservation.customer_phone),_("required",!e.newReservation.customer_id),c(4),v("ngModel",e.newReservation.customer_email),c(5),v("ngModel",e.newReservation.reservation_date),c(4),v("ngModel",e.newReservation.reservation_time),c(),_("ngForOf",e.getAvailableTimes()),c(5),v("ngModel",e.newReservation.party_size),c(),_("ngForOf",N(26,ae)),c(4),v("ngModel",e.newReservation.status),c(9),v("ngModel",e.newReservation.table_id),c(),_("value",void 0),c(2),_("ngIf",e.getTablesByExactCapacity(e.newReservation.party_size).length>0),c(),_("ngIf",e.getTablesByGreaterCapacity(e.newReservation.party_size).length>0),c(),_("ngIf",e.getTablesByExactCapacity(e.newReservation.party_size).length===0&&e.getTablesByGreaterCapacity(e.newReservation.party_size).length===0),c(),_("ngIf",e.newReservation.table_id),c(),_("ngIf",!e.newReservation.table_id),c(5),v("ngModel",e.newReservation.special_requests),c(4),_("disabled",!e.isFormValid()||e.loading),c(),_("ngIf",e.loading),c(),b(" ",e.isEditing?"Aggiorna Prenotazione":"Crea Prenotazione"," ")}}var ie=class s{reservationService=R($);tableService=R(Z);floorManagementService=R(ee);subscriptions=new W;allRestaurantReservations=[];filteredReservations=[];tables=[];tableGroups=[];loading=!1;error=null;showCreateModal=!1;newReservation={restaurant_id:"",customer_name:"",customer_surname:"",customer_phone:"",customer_email:"",reservation_date:"",reservation_time:"19:00",party_size:2,special_requests:"",table_id:void 0,status:"confirmed"};selectedDate=null;startDate=null;endDate=null;statusFilter="all";viewMode="future";useDateFilter=!1;useDateRangeFilter=!1;shiftFilter="all";isEditing=!1;editingReservationId=null;shiftService=R(te);shifts=[];ngOnInit(){this.loadData(),this.subscriptions.add(this.reservationService.restaurantReservations$.subscribe(t=>{this.allRestaurantReservations=t,this.filterReservations()})),this.subscriptions.add(this.shiftService.shifts$.subscribe(t=>{this.shifts=t,console.log("\u{1F504} Turni caricati:",t.length)})),this.subscriptions.add(this.tableService.data$.subscribe(t=>{this.tables=t,console.log("Tavoli caricati:",t.length)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}loadData(){return w(this,null,function*(){this.loading=!0;try{yield this.reservationService.loadRestaurantReservations(),yield this.shiftService.loadShifts(),yield this.tableService.loadData(),yield this.loadTablesGroupedByFloorPlan()}catch(t){console.error("Error loading data:",t),this.error="Errore nel caricamento dei dati"}finally{this.loading=!1}})}onDateFilterToggle(){this.useDateFilter&&(this.useDateRangeFilter=!1),this.filterReservations()}onDateRangeFilterToggle(){this.useDateRangeFilter&&(this.useDateFilter=!1),this.filterReservations()}openCreateModal(){this.newReservation={restaurant_id:"",customer_name:"",customer_surname:"",customer_phone:"",customer_email:"",reservation_date:this.selectedDate||new Date().toISOString().split("T")[0],reservation_time:"19:00",party_size:2,special_requests:"",table_id:void 0,status:"confirmed"},this.showCreateModal=!0}closeCreateModal(){this.showCreateModal=!1,this.isEditing=!1,this.editingReservationId=null}createReservation(){return w(this,null,function*(){if(this.isFormValid()){this.loading=!0;try{let t;this.isEditing&&this.editingReservationId?t=yield this.updateExistingReservation(this.editingReservationId,this.newReservation):t=yield this.reservationService.createRestaurantReservation(this.newReservation),t?(this.closeCreateModal(),this.error=null):this.error="Errore durante il salvataggio della prenotazione"}catch(t){console.error("Error saving reservation:",t),this.error=t.message||"Errore durante il salvataggio della prenotazione"}finally{this.loading=!1}}})}updateExistingReservation(t,e){return w(this,null,function*(){try{let i={customer_name:e.customer_name,customer_surname:e.customer_surname,customer_phone:e.customer_phone,customer_email:e.customer_email,reservation_date:e.reservation_date,reservation_time:e.reservation_time,party_size:e.party_size,special_requests:e.special_requests,table_id:e.table_id,status:e.status};return e.customer_id&&(i.customer_id=e.customer_id),yield this.reservationService.updateReservation(t,i)}catch(i){throw console.error("Error updating reservation:",i),i}})}isFormValid(){return this.newReservation.customer_id?!!(this.newReservation.customer_id&&this.newReservation.reservation_date&&this.newReservation.reservation_time&&this.newReservation.party_size):!!(this.newReservation.customer_name&&this.newReservation.customer_surname&&this.newReservation.customer_phone&&this.newReservation.reservation_date&&this.newReservation.reservation_time&&this.newReservation.party_size)}assignTable(t,e){return w(this,null,function*(){if(e){this.loading=!0;try{(yield this.reservationService.assignTableToReservation(t,e))||(this.error="Errore nell'assegnazione del tavolo")}catch(i){console.error("Error assigning table:",i),this.error="Errore nell'assegnazione del tavolo"}finally{this.loading=!1}}})}unassignTable(t){return w(this,null,function*(){this.loading=!0;try{(yield this.reservationService.removeTableFromReservation(t))||(this.error="Errore nella rimozione del tavolo")}catch(e){console.error("Error unassigning table:",e),this.error="Errore nella rimozione del tavolo"}finally{this.loading=!1}})}updateStatus(t,e){return w(this,null,function*(){this.loading=!0;try{(yield this.reservationService.updateReservationStatus(t,e))||(this.error="Errore nell'aggiornamento dello stato")}catch(i){console.error("Error updating status:",i),this.error="Errore nell'aggiornamento dello stato"}finally{this.loading=!1}})}deleteReservation(t){return w(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questa prenotazione?")){this.loading=!0;try{(yield this.reservationService.deleteReservation(t))||(this.error="Errore nell'eliminazione della prenotazione")}catch(e){console.error("Error deleting reservation:",e),this.error="Errore nell'eliminazione della prenotazione"}finally{this.loading=!1}}})}getSelectedTableCapacity(){if(!this.newReservation.table_id)return 0;for(let e of this.tableGroups){let i=e.tables.find(r=>r.id===this.newReservation.table_id);if(i)return i.capacity}let t=this.tables.find(e=>e.id===this.newReservation.table_id);return t?t.capacity:0}formatTime(t){return t.substring(0,5)}formatDate(t){if(!t)return"";let e=new Date(t),i=e.getDate().toString().padStart(2,"0"),r=(e.getMonth()+1).toString().padStart(2,"0"),o=e.getFullYear();return`${i}/${r}/${o}`}getCustomerName(t){return this.reservationService.getCustomerName(t)}getCustomerContact(t){return this.reservationService.getCustomerContact(t)}getTableName(t){return this.reservationService.getTableInfo(t)}getStatusColor(t){switch(t){case"confirmed":return"active";case"pending":return"";case"cancelled":return"";default:return""}}getStatusText(t){switch(t){case"confirmed":return"Confermata";case"pending":return"In attesa";case"cancelled":return"Cancellata";default:return t}}getAvailableTimes(){return["12:00","12:30","13:00","13:30","14:00","19:00","19:30","20:00","20:30","21:00","21:30"]}onDateChange(){this.filterReservations()}onStatusFilterChange(){this.filterReservations()}onViewModeChange(){this.filterReservations()}refreshData(){this.loadData()}loadTablesGroupedByFloorPlan(){return w(this,null,function*(){try{this.tableGroups=yield this.floorManagementService.getAllTablesGroupedByFloorPlan(),console.log("Table groups:",this.tableGroups),(!this.tableGroups||this.tableGroups.length===0)&&(yield this.groupTablesManually())}catch(t){console.error("Error loading tables grouped by floor plan:",t),yield this.groupTablesManually()}})}groupTablesManually(){return w(this,null,function*(){console.log("\u26A0\uFE0F Raggruppamento manuale dei tavoli...");let t={};this.tables.forEach(e=>{let i=e.floor_plan_id||"no-floor-plan";t[i]||(t[i]={floorPlan:{id:i,name:`Mappa ${i==="no-floor-plan"?"senza nome":i}`},tables:[]}),t[i].tables.push(e)}),this.tableGroups=Object.values(t),console.log("\u2705 Tavoli raggruppati manualmente:",this.tableGroups)})}getFilteredTables(t){return!this.tables||this.tables.length===0?[]:this.tables.filter(i=>i.capacity>=t).sort((i,r)=>i.capacity===t&&r.capacity!==t?-1:i.capacity!==t&&r.capacity===t?1:i.capacity-r.capacity)}getFilteredTableGroups(t){return!this.tableGroups||this.tableGroups.length===0?[]:this.tableGroups.map(e=>{let i=e.tables.filter(r=>r.capacity>=t).sort((r,o)=>r.capacity===t&&o.capacity!==t?-1:r.capacity!==t&&o.capacity===t?1:r.capacity-o.capacity);return V(k({},e),{tables:i})}).filter(e=>e.tables.length>0)}getTablesByExactCapacity(t){return!this.tables||this.tables.length===0?[]:this.tables.filter(e=>e.capacity===t)}getTablesByGreaterCapacity(t){if(!this.tables||this.tables.length===0)return[];let e=this.tables.filter(o=>o.capacity>=t).sort((o,x)=>o.capacity-x.capacity),i=this.getTablesByExactCapacity(t),r=new Set(i.map(o=>o.id));return e.filter(o=>!r.has(o.id))}getAllAvailableTables(t){return!this.tables||this.tables.length===0?[]:this.tables.filter(e=>e.capacity>=t).sort((e,i)=>e.capacity===t&&i.capacity!==t?-1:e.capacity!==t&&i.capacity===t?1:e.capacity-i.capacity)}getCustomerFullName(t){return t.users?`${t.users.first_name||""} ${t.users.last_name||""}`.trim():t.customer_name||t.customer_surname?`${t.customer_name||""} ${t.customer_surname||""}`.trim():"Cliente"}openEditModal(t){this.isEditing=!0,this.editingReservationId=t.id,this.newReservation={restaurant_id:t.restaurant_id||"",customer_name:t.customer_name||"",customer_surname:t.customer_surname||"",customer_phone:t.customer_phone||"",customer_email:t.customer_email||"",reservation_date:t.reservation_date,reservation_time:this.formatTimeForInput(t.reservation_time),party_size:t.party_size,special_requests:t.special_requests||"",table_id:t.table_id||void 0,status:t.status,customer_id:t.customer_id||void 0},console.log("\u{1F4DD} Apertura modifica prenotazione:",{id:t.id,oraOriginale:t.reservation_time,oraFormattata:this.formatTimeForInput(t.reservation_time),datiInseriti:this.newReservation}),this.showCreateModal=!0}formatTimeForInput(t){return t?t.length>5?t.substring(0,5):t:"19:00"}getReservationShift(t){if(!this.shifts||this.shifts.length===0)return"N/D";let i=new Date(t.reservation_date).getDay(),r=i===0?7:i,o=t.reservation_time.substring(0,5),x=this.timeToSeconds(o);for(let C of this.shifts)if(C.is_active&&C.days_of_week.includes(r)){let I=this.timeToSeconds(C.start_time.substring(0,5)),O=this.timeToSeconds(C.end_time.substring(0,5));if(x>=I&&x<=O)return C.name}return this.getClosestShift(o,r)||"N/D"}timeToSeconds(t){let[e,i]=t.split(":").map(Number);return e*3600+i*60}getClosestShift(t,e){let i=null,r=1/0,o=this.timeToSeconds(t);for(let x of this.shifts){if(!x.is_active||!x.days_of_week.includes(e))continue;let C=this.timeToSeconds(x.start_time.substring(0,5)),I=this.timeToSeconds(x.end_time.substring(0,5)),O=Math.abs(o-C),ne=Math.abs(o-I),D=Math.min(O,ne);D<r&&(r=D,i=x)}return i&&r<=3600?`${i.name} (\u2248)`:null}get activeShifts(){return this.shifts.filter(t=>t.is_active)}getReservationShiftName(t){return this.getReservationShift(t)}filterReservations(){let t=this.allRestaurantReservations,e=new Date().toISOString().split("T")[0];switch(this.viewMode){case"today":t=this.reservationService.getActiveReservations(t);break;case"future":t=this.reservationService.getFutureReservations(t);break;case"all":break}this.useDateFilter&&this.selectedDate&&(t=t.filter(i=>i.reservation_date===this.selectedDate)),this.useDateRangeFilter&&this.startDate&&this.endDate&&(t=t.filter(i=>i.reservation_date>=this.startDate&&i.reservation_date<=this.endDate)),this.statusFilter!=="all"&&(t=t.filter(i=>i.status===this.statusFilter)),this.shiftFilter!=="all"&&(t=t.filter(i=>this.getReservationShiftName(i)===this.shiftFilter)),this.filteredReservations=t}resetFilters(){this.viewMode="future",this.selectedDate=null,this.startDate=null,this.endDate=null,this.statusFilter="all",this.shiftFilter="all",this.useDateFilter=!1,this.useDateRangeFilter=!1,this.filterReservations()}getActiveFiltersInfo(){let t=this.getActiveFiltersCount();return t===1?{count:t,text:"1 filtro attivo"}:t>1?{count:t,text:`${t} filtri attivi`}:{count:0,text:""}}getActiveFiltersCount(){let t=0;return this.viewMode!=="future"&&t++,this.useDateFilter&&this.selectedDate&&t++,this.useDateRangeFilter&&this.startDate&&this.endDate&&t++,this.statusFilter!=="all"&&t++,this.shiftFilter!=="all"&&t++,t}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=z({type:s,selectors:[["app-reservation-manager"]],decls:73,vars:16,consts:[["tableSelect",""],[1,"page-container"],[1,"section-header"],[1,"section-title"],[1,"header-icon"],[1,"material-icons"],[1,"text-muted"],[1,"form-card","mb-lg"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"p-sm",3,"ngModelChange","change","ngModel"],["value","today"],["value","future"],["value","all"],[1,"flex","align-center","gap-sm"],["type","checkbox","id","dateFilter",3,"ngModelChange","change","ngModel"],["for","dateFilter",1,"standard-label"],["type","date",1,"p-sm","mt-xs",3,"ngModelChange","change","ngModel","disabled"],["type","checkbox","id","dateRangeFilter",3,"ngModelChange","change","ngModel"],["for","dateRangeFilter",1,"standard-label"],[1,"flex","gap-sm","flex-wrap"],["type","date","placeholder","Da",1,"p-sm",3,"ngModelChange","change","ngModel","disabled"],["type","date","placeholder","A",1,"p-sm",3,"ngModelChange","change","ngModel","disabled"],["value","confirmed"],["value","pending"],["value","cancelled"],[3,"value",4,"ngFor","ngForOf"],["value","N/D"],[1,"modal-footer",2,"width","100%"],["class","filter-badge",4,"ngIf"],[1,"flex","gap-sm"],["title","Resetta filtri",1,"icon-button",3,"click"],["title","Aggiorna",1,"icon-button",3,"click"],[1,"promethea-button",3,"click"],["class","info-message mb-lg",4,"ngIf"],["class","table-section",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"filter-badge"],[1,"info-message","mb-lg"],[1,"icon-button","x-small",3,"click"],[1,"table-section"],["class","crm-table custom-widths",4,"ngIf"],["class","empty-state p-lg",4,"ngIf"],[1,"crm-table","custom-widths"],[2,"text-align","center"],[1,"material-icons","text-md"],[4,"ngFor","ngForOf"],[1,"flex","gap-sm","justify-between","flex-wrap","items-center"],["class","text-mini text-muted",4,"ngIf"],[1,"chip","text-mini",2,"max-width","fit-content"],[1,"flex","gap-sm","items-center"],[1,"flex","flex-wrap","justify-between","items-center","gap-sm"],["class","flex gap-sm",4,"ngIf"],["class","icon-button x-small","title","Rimuovi tavolo",3,"click",4,"ngIf"],[1,"chip"],["class","icon-button x-small","title","Conferma",3,"click",4,"ngIf"],["class","icon-button x-small","title","Metti in attesa",3,"click",4,"ngIf"],["title","Modifica",1,"icon-button","x-small",3,"click"],["title","Elimina",1,"icon-button","x-small",3,"click"],[1,"text-mini","text-muted"],["style","max-width: fit-content;","class","text-mini x-small custom-select",3,"change",4,"ngIf"],[1,"text-mini","x-small","custom-select",2,"max-width","fit-content",3,"change"],["value",""],[4,"ngIf"],["disabled","",4,"ngIf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value","title",4,"ngFor","ngForOf"],[3,"value","title"],["disabled",""],["title","Rimuovi tavolo",1,"icon-button","x-small",3,"click"],["title","Conferma",1,"icon-button","x-small",3,"click"],["title","Metti in attesa",1,"icon-button","x-small",3,"click"],[1,"empty-state","p-lg"],[1,"promethea-button","ghost",3,"click"],[1,"modal-overlay"],[1,"modal-container","modal-lg"],[1,"modal-header"],[1,"icon-button",3,"click"],[1,"form-card"],[1,"form-row","mb-md"],["type","text","placeholder","Inserisci nome",1,"p-sm",3,"ngModelChange","ngModel","required"],["type","text","placeholder","Inserisci cognome",1,"p-sm",3,"ngModelChange","ngModel","required"],["type","tel","placeholder","Inserisci telefono",1,"p-sm",3,"ngModelChange","ngModel","required"],["type","email","placeholder","Inserisci email",1,"p-sm",3,"ngModelChange","ngModel"],["type","date","required","",1,"p-sm",3,"ngModelChange","ngModel"],["required","",1,"p-sm",3,"ngModelChange","ngModel"],[3,"value","selected",4,"ngFor","ngForOf"],[1,"p-sm",3,"ngModelChange","ngModel"],["label","Tavoli con capacit\xE0 esatta \u2B50",4,"ngIf"],["label","Tavoli con capacit\xE0 maggiore",4,"ngIf"],["class","text-muted",4,"ngIf"],["placeholder","Note o richieste speciali del cliente...","rows","3",1,"p-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"],[3,"value","selected"],["label","Tavoli con capacit\xE0 esatta \u2B50"],["label","Tavoli con capacit\xE0 maggiore"]],template:function(e,i){e&1&&(n(0,"div",1)(1,"div",2)(2,"h1",3)(3,"span",4)(4,"span",5),l(5,"event_available"),a()(),l(6," Gestione Prenotazioni "),a(),n(7,"p",6),l(8,"Gestisci le prenotazioni del ristorante - Clienti registrati e nuovi clienti"),a()(),n(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),l(13,"Visualizza"),a(),n(14,"select",11),f("ngModelChange",function(o){return h(i.viewMode,o)||(i.viewMode=o),o}),u("change",function(){return i.filterReservations()}),n(15,"option",12),l(16,"Oggi"),a(),n(17,"option",13),l(18,"Prenotazioni Future"),a(),n(19,"option",14),l(20,"Tutte le Prenotazioni"),a()()(),n(21,"div",9)(22,"div",15)(23,"input",16),f("ngModelChange",function(o){return h(i.useDateFilter,o)||(i.useDateFilter=o),o}),u("change",function(){return i.onDateFilterToggle()}),a(),n(24,"label",17),l(25,"Data specifica"),a()(),n(26,"input",18),f("ngModelChange",function(o){return h(i.selectedDate,o)||(i.selectedDate=o),o}),u("change",function(){return i.filterReservations()}),a()(),n(27,"div",9)(28,"div",15)(29,"input",19),f("ngModelChange",function(o){return h(i.useDateRangeFilter,o)||(i.useDateRangeFilter=o),o}),u("change",function(){return i.onDateRangeFilterToggle()}),a(),n(30,"label",20),l(31,"Intervallo date"),a()(),n(32,"div",21)(33,"input",22),f("ngModelChange",function(o){return h(i.startDate,o)||(i.startDate=o),o}),u("change",function(){return i.filterReservations()}),a(),n(34,"input",23),f("ngModelChange",function(o){return h(i.endDate,o)||(i.endDate=o),o}),u("change",function(){return i.filterReservations()}),a()()()(),n(35,"div",8)(36,"div",9)(37,"label",10),l(38,"Stato"),a(),n(39,"select",11),f("ngModelChange",function(o){return h(i.statusFilter,o)||(i.statusFilter=o),o}),u("change",function(){return i.filterReservations()}),n(40,"option",14),l(41,"Tutti"),a(),n(42,"option",24),l(43,"Confermate"),a(),n(44,"option",25),l(45,"In attesa"),a(),n(46,"option",26),l(47,"Cancellate"),a()()(),n(48,"div",9)(49,"label",10),l(50,"Turno"),a(),n(51,"select",11),f("ngModelChange",function(o){return h(i.shiftFilter,o)||(i.shiftFilter=o),o}),u("change",function(){return i.filterReservations()}),n(52,"option",14),l(53,"Tutti i turni"),a(),m(54,re,2,4,"option",27),n(55,"option",28),l(56,"Fuori orario"),a()()(),n(57,"div",29),m(58,oe,2,1,"span",30),n(59,"div",31)(60,"button",32),u("click",function(){return i.resetFilters()}),n(61,"span",5),l(62,"filter_alt_off"),a()(),n(63,"button",33),u("click",function(){return i.refreshData()}),n(64,"span",5),l(65,"refresh"),a()(),n(66,"button",34),u("click",function(){return i.openCreateModal()}),n(67,"span",5),l(68,"add"),a(),l(69," Nuova Prenotazione "),a()()()()(),m(70,se,7,1,"div",35)(71,Re,3,2,"div",36)(72,We,81,27,"div",37),a()),e&2&&(c(14),v("ngModel",i.viewMode),c(9),v("ngModel",i.useDateFilter),c(3),v("ngModel",i.selectedDate),_("disabled",!i.useDateFilter),c(3),v("ngModel",i.useDateRangeFilter),c(4),v("ngModel",i.startDate),_("disabled",!i.useDateRangeFilter),c(),v("ngModel",i.endDate),_("disabled",!i.useDateRangeFilter),c(5),v("ngModel",i.statusFilter),c(12),v("ngModel",i.shiftFilter),c(3),_("ngForOf",i.activeShifts),c(4),_("ngIf",i.getActiveFiltersInfo().count>0),c(12),_("ngIf",i.error),c(),_("ngIf",!i.loading),c(),_("ngIf",i.showCreateModal))},dependencies:[q,G,A,X,K,Q,j,L,J,Y,U,H],styles:["select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]{font-weight:600;background-color:var(--smoke-1);padding:var(--gap-sm);border-bottom:1px solid var(--smoke-2)}select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{font-weight:400;padding-left:var(--gap-sm);background-color:var(--background)}select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:hover{background-color:var(--smoke-1)}select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:disabled{font-style:italic;background-color:var(--smoke-1)}select[_ngcontent-%COMP%]:focus   optgroup[_ngcontent-%COMP%]{background-color:var(--smoke-1)}.filter-badge[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-weight:500;padding:var(--gap-sm);background:var(--smoke-1);border-radius:12px}.custom-select[_ngcontent-%COMP%]{max-width:fit-content!important;min-width:150px;overflow:hidden;text-overflow:ellipsis}.custom-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.custom-select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]{max-width:200px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(1), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){width:8%;min-width:90px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(2), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){width:6%;min-width:70px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){width:25%;min-width:250px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(4), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:8%;min-width:80px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(5), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(5){width:6%;min-width:70px;text-align:center}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(6), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(6){width:15%;min-width:150px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(7), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(7){width:12%;min-width:120px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(8), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8){width:10%;min-width:100px}.crm-table.custom-widths[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(9), .crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(9){width:10%;min-width:140px;text-align:center}.crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gap-sm) calc(var(--gap-sm) / 2)}.crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){padding:var(--gap-sm)}.crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3)   .flex-col[_ngcontent-%COMP%]{gap:4px}.crm-table.custom-widths[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3)   strong[_ngcontent-%COMP%]{white-space:normal;line-height:1.3;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}"]})};export{ie as ReservationManager};
