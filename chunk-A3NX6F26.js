import{a as h}from"./chunk-KNL3CWA3.js";import{A as d}from"./chunk-DCWKKS33.js";import{$ as p,G as u,M as b,ea as i,f as o,m as c}from"./chunk-K5RDB55Y.js";var f=class s{supabaseService=i(d);authService=i(h);tablesSubject=new c([]);tables$=this.tablesSubject.asObservable();constructor(){this.authService.currentUser$.pipe(u(e=>!!e),b(1)).subscribe(()=>{this.loadTables()})}loadTables(){return o(this,null,function*(){try{let e=this.authService.currentUserValue;if(!e)return;let{data:r,error:t}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",e.id).limit(1);if(t||!r?.length){console.error("\u274C No restaurant found for user:",e.id);return}let a=r[0].id,{data:l,error:n}=yield this.supabaseService.getSupabaseClient().from("tables").select("*").eq("restaurant_id",a).eq("is_active",!0).order("created_at",{ascending:!1});if(n){console.error("\u274C Error loading tables:",n);return}this.tablesSubject.next(l||[])}catch(e){console.error("\u{1F4A5} Error in loadTables:",e)}})}createTable(e){return o(this,null,function*(){try{console.log("\u{1F4DD} Creating table with shape:",e.shape);let{data:r,error:t}=yield this.supabaseService.getSupabaseClient().from("tables").insert(e).select().single();if(t)throw console.error("\u274C Error creating table:",t),console.error("\u274C Error details:",t.details),t;return console.log("\u2705 Table created successfully"),yield this.loadTables(),r}catch(r){return console.error("\u{1F4A5} Error in createTable:",r),null}})}updateTable(e,r){return o(this,null,function*(){try{let{error:t}=yield this.supabaseService.getSupabaseClient().from("tables").update(r).eq("id",e);if(t)throw t;return yield this.loadTables(),!0}catch(t){return console.error("\u274C Error updating table:",t),!1}})}deleteTable(e){return o(this,null,function*(){try{let{error:r}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_active:!1}).eq("id",e);if(r)throw r;return yield this.loadTables(),!0}catch(r){return console.error("\u274C Error deleting table:",r),!1}})}getTables(){return this.tablesSubject.value}getTablesByFloorPlan(e){return this.tablesSubject.value.filter(r=>r.floor_plan_id===e)}checkTableOverlap(e,r){let t=this.getTablesByFloorPlan(e.floor_plan_id).filter(a=>a.id!==r);for(let a of t)if(this.doTablesOverlap(e,a))return!0;return!1}doTablesOverlap(e,r){return!(e.position_x+e.width<=r.position_x||e.position_x>=r.position_x+r.width||e.position_y+e.height<=r.position_y||e.position_y>=r.position_y+r.height)}static \u0275fac=function(r){return new(r||s)};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{f as a};
