import{a as Q}from"./chunk-4QWMJ6KB.js";import{a as K}from"./chunk-ZZFA3ZHU.js";import{a as O,b as W,d as N,e as D,g as L,h as A,i as B,j as z,k as j,q,r as G,s as R,u as Y,v as H,x as J}from"./chunk-V2Z2AUIN.js";import"./chunk-MMFTZZDS.js";import"./chunk-IJR26JUT.js";import"./chunk-L36FCDRV.js";import"./chunk-JJFJLBC4.js";import{c as k,d as I,m as P}from"./chunk-QY7CV2FB.js";import{$a as f,Bb as w,Eb as i,Fb as v,Ga as s,Gb as y,Jb as _,Kb as u,Lb as h,Wa as V,a as S,b as C,da as b,g as M,gb as T,hb as g,ia as m,ib as n,ja as c,jb as t,kb as F,pb as E,sb as x,ub as d}from"./chunk-PX5DELEN.js";function X(p,r){if(p&1&&(n(0,"div",29)(1,"div",30)(2,"div",31)(3,"span",32),i(4,"payments"),t(),n(5,"h3",33),i(6,"Spese Fisse"),t()(),n(7,"div",34)(8,"div",35),i(9),t()()(),n(10,"div",30)(11,"div",31)(12,"span",32),i(13,"receipt"),t(),n(14,"h3",33),i(15,"Spese Variabili"),t()(),n(16,"div",34)(17,"div",35),i(18),t()()(),n(19,"div",30)(20,"div",31)(21,"span",32),i(22,"account_balance"),t(),n(23,"h3",33),i(24,"Totale Mese"),t()(),n(25,"div",34)(26,"div",35),i(27),t()()()()),p&2){let e=d();s(9),v(e.formatCurrency(e.monthlyStats.fisse)),s(9),v(e.formatCurrency(e.monthlyStats.variabili)),s(9),v(e.formatCurrency(e.monthlyStats.totale))}}function Z(p,r){if(p&1){let e=E();n(0,"div",10)(1,"label",11),i(2,"Mese"),t(),n(3,"button",20),x("click",function(){m(e);let a=d();return c(a.openMonthsModal())}),n(4,"span",21),i(5,"calendar_today"),t(),i(6),t()()}if(p&2){let e=d();s(6),y(" ",e.formatMonth(e.selectedMonth)," ")}}function $(p,r){if(p&1){let e=E();n(0,"button",20),x("click",function(){m(e);let a=d();return c(a.copyFixedExpensesFromPreviousMonth())}),n(1,"span",21),i(2,"content_copy"),t(),i(3," Copia Spese Fisse "),t()}}function ee(p,r){p&1&&(n(0,"th"),i(1,"Mese"),t())}function te(p,r){if(p&1&&(n(0,"span",44),i(1),t()),p&2){let e=d().$implicit,o=d();s(),y(" ",o.getSupplierName(e.supplier_id)," ")}}function ne(p,r){p&1&&(n(0,"span",5),i(1,"-"),t())}function ie(p,r){if(p&1&&(n(0,"td"),i(1),t()),p&2){let e=d().$implicit,o=d();s(),v(o.formatMonth(e.month))}}function ae(p,r){if(p&1){let e=E();n(0,"tr",36)(1,"td")(2,"div",37)(3,"strong"),i(4),t()()(),n(5,"td")(6,"span",38),i(7),t()(),n(8,"td"),i(9),t(),n(10,"td")(11,"strong"),i(12),t()(),n(13,"td"),f(14,te,2,1,"span",39)(15,ne,2,0,"span",40),t(),f(16,ie,2,1,"td",26),n(17,"td",41),i(18),t(),n(19,"td")(20,"div",2)(21,"button",42),x("click",function(){let a=m(e).$implicit,l=d();return c(l.openEditExpenseModal(a))}),n(22,"span",21),i(23,"edit"),t()(),n(24,"button",43),x("click",function(){let a=m(e).$implicit,l=d();return c(l.deleteExpense(a))}),n(25,"span",21),i(26,"delete"),t()()()()()}if(p&2){let e=r.$implicit,o=d();s(4),v(e.name),s(2),w("active",e.type==="fissa"),s(),y(" ",e.type==="fissa"?"Fissa":"Variabile"," "),s(2),v(e.category),s(3),v(o.formatCurrency(e.amount)),s(2),g("ngIf",e.supplier_id),s(),g("ngIf",!e.supplier_id),s(),g("ngIf",o.viewMode==="all"),s(2),v(e.notes||"-")}}function re(p,r){if(p&1&&(n(0,"p",5),i(1),t()),p&2){let e=d(2);s(),y('Nessuna spesa trovata per "',e.searchTerm,'"')}}function oe(p,r){p&1&&(n(0,"p",5),i(1,"Nessuna spesa registrata"),t())}function le(p,r){if(p&1){let e=E();n(0,"tr")(1,"td",45)(2,"div",46)(3,"span",47),i(4,"receipt_long"),t(),f(5,re,2,1,"p",40)(6,oe,2,0,"p",40),n(7,"button",48),x("click",function(){m(e);let a=d();return c(a.openAddExpenseModal())}),n(8,"span",21),i(9,"add"),t(),i(10," Aggiungi la prima spesa "),t()()()()}if(p&2){let e=d();s(),T("colspan",e.viewMode==="all"?8:7),s(4),g("ngIf",e.searchTerm),s(),g("ngIf",!e.searchTerm)}}function se(p,r){if(p&1&&(n(0,"option",73),i(1),t()),p&2){let e=r.$implicit;g("value",e),s(),y(" ",e," ")}}function pe(p,r){if(p&1&&(n(0,"span"),i(1),t()),p&2){let e=d().$implicit;s(),y("- ",e.contact_name)}}function de(p,r){if(p&1&&(n(0,"option",73),i(1),f(2,pe,2,1,"span",26),t()),p&2){let e=r.$implicit;g("value",e.id),s(),y(" ",e.company_name," "),s(),g("ngIf",e.contact_name)}}function me(p,r){if(p&1){let e=E();n(0,"div",82)(1,"div",69)(2,"label",83)(3,"span",21),i(4,"calendar_today"),t(),i(5," Mese * "),t(),n(6,"input",84),h("ngModelChange",function(a){m(e);let l=d(2);return u(l.expenseForm.month,a)||(l.expenseForm.month=a),c(a)}),t()(),n(7,"div",69)(8,"label",85)(9,"input",86),h("ngModelChange",function(a){m(e);let l=d(2);return u(l.expenseForm.is_recurring,a)||(l.expenseForm.is_recurring=a),c(a)}),t(),n(10,"span"),i(11,"Spesa ricorrente (ogni mese)"),t()()()()}if(p&2){let e=d(2);s(6),_("ngModel",e.expenseForm.month),s(3),_("ngModel",e.expenseForm.is_recurring)}}function ce(p,r){if(p&1){let e=E();n(0,"div",49)(1,"div",50)(2,"div",51)(3,"div",52)(4,"div",53)(5,"span",21),i(6),t()(),n(7,"div")(8,"h1",4),i(9),t()()(),n(10,"button",54),x("click",function(){m(e);let a=d();return c(a.closeExpenseModal())}),n(11,"span",21),i(12,"close"),t()()(),n(13,"div",7)(14,"form",55),x("submit",function(a){return m(e),d().saveExpense(),c(a.preventDefault())}),n(15,"div",56)(16,"div",10)(17,"label",57)(18,"span",21),i(19,"title"),t(),i(20," Nome Spesa * "),t(),n(21,"input",58),h("ngModelChange",function(a){m(e);let l=d();return u(l.expenseForm.name,a)||(l.expenseForm.name=a),c(a)}),t()(),n(22,"div",10)(23,"label",59)(24,"span",21),i(25,"euro"),t(),i(26," Importo (\u20AC) * "),t(),n(27,"input",60),h("ngModelChange",function(a){m(e);let l=d();return u(l.expenseForm.amount,a)||(l.expenseForm.amount=a),c(a)}),t()()(),n(28,"div",56)(29,"div",10)(30,"label",61)(31,"span",21),i(32,"category"),t(),i(33," Tipo * "),t(),n(34,"select",62),h("ngModelChange",function(a){m(e);let l=d();return u(l.expenseForm.type,a)||(l.expenseForm.type=a),c(a)}),x("change",function(){m(e);let a=d();return c(a.onExpenseTypeChange())}),n(35,"option",63),i(36,"Spesa Fissa"),t(),n(37,"option",64),i(38,"Spesa Variabile"),t()()(),n(39,"div",10)(40,"label",65)(41,"span",21),i(42,"label"),t(),i(43," Categoria * "),t(),n(44,"select",66),h("ngModelChange",function(a){m(e);let l=d();return u(l.expenseForm.category,a)||(l.expenseForm.category=a),c(a)}),n(45,"option",67),i(46,"Seleziona categoria"),t(),f(47,se,2,2,"option",68),t()()(),n(48,"div",69)(49,"label",70)(50,"span",21),i(51,"local_shipping"),t(),i(52," Fornitore "),t(),n(53,"div",71)(54,"select",72),h("ngModelChange",function(a){m(e);let l=d();return u(l.expenseForm.supplier_id,a)||(l.expenseForm.supplier_id=a),c(a)}),n(55,"option",73),i(56,"Nessun fornitore"),t(),f(57,de,3,3,"option",68),t(),n(58,"div",74)(59,"button",75),x("click",function(){m(e);let a=d();return c(a.openSupplierModal())}),n(60,"span",21),i(61,"add"),t(),i(62," Nuovo "),t()()()(),f(63,me,12,2,"div",76),n(64,"div",69)(65,"label",77)(66,"span",21),i(67,"notes"),t(),i(68," Note "),t(),n(69,"textarea",78),h("ngModelChange",function(a){m(e);let l=d();return u(l.expenseForm.notes,a)||(l.expenseForm.notes=a),c(a)}),t()()()(),n(70,"div",79)(71,"button",80),x("click",function(){m(e);let a=d();return c(a.closeExpenseModal())}),i(72," Annulla "),t(),n(73,"button",81),i(74),t()()()()}if(p&2){let e=d();s(6),v(e.editingExpense?"edit":"add"),s(3),v(e.editingExpense?"Modifica Spesa":"Nuova Spesa"),s(12),_("ngModel",e.expenseForm.name),s(6),_("ngModel",e.expenseForm.amount),s(7),_("ngModel",e.expenseForm.type),s(10),_("ngModel",e.expenseForm.category),s(3),g("ngForOf",e.getCategoriesByType(e.expenseForm.type)),s(7),_("ngModel",e.expenseForm.supplier_id),s(),g("value",null),s(2),g("ngForOf",e.suppliers),s(6),g("ngIf",e.viewMode==="monthly"),s(6),_("ngModel",e.expenseForm.notes),s(5),y(" ",e.editingExpense?"Aggiorna":"Crea"," Spesa ")}}function ge(p,r){if(p&1){let e=E();n(0,"button",20),x("click",function(){let a=m(e).$implicit,l=d(2);return c(l.changeMonth(a))}),i(1),t()}if(p&2){let e=r.$implicit,o=d(2);w("active",e===o.selectedMonth),s(),y(" ",o.formatMonth(e)," ")}}function xe(p,r){if(p&1){let e=E();n(0,"div",49)(1,"div",87)(2,"div",88)(3,"h2",89)(4,"span",21),i(5,"calendar_today"),t(),i(6," Seleziona Mese "),t(),n(7,"button",54),x("click",function(){m(e);let a=d();return c(a.closeMonthsModal())}),n(8,"span",21),i(9,"close"),t()()(),n(10,"div",90)(11,"div",91),f(12,ge,2,3,"button",92),t(),n(13,"div",93)(14,"button",22),x("click",function(){m(e);let a=d();return c(a.closeMonthsModal())}),i(15," Chiudi "),t()()()()()}if(p&2){let e=d();s(12),g("ngForOf",e.availableMonths)}}function _e(p,r){if(p&1&&(n(0,"div",107)(1,"span",108),i(2),t(),n(3,"span",38),i(4),t()()),p&2){let e=r.$implicit;s(2),v(e.name),s(),w("active",e.type==="fissa")("warning",e.type==="variabile"),s(),y(" ",e.type==="entrambi"?"Entrambi":e.type==="fissa"?"Fisse":"Variabili"," ")}}function ue(p,r){p&1&&(n(0,"div",45)(1,"p"),i(2,"Nessuna categoria personalizzata creata"),t()())}function he(p,r){if(p&1){let e=E();n(0,"div",49)(1,"div",94)(2,"div",51)(3,"div",52)(4,"div",53)(5,"span",21),i(6,"category"),t()(),n(7,"div")(8,"h1",4),i(9,"Gestione Categorie"),t()()(),n(10,"button",54),x("click",function(){m(e);let a=d();return c(a.closeCategoryModal())}),n(11,"span",21),i(12,"close"),t()()(),n(13,"div",90)(14,"div",95)(15,"h3",96)(16,"span",21),i(17,"add"),t(),i(18," Nuova Categoria "),t(),n(19,"form",55),x("submit",function(a){return m(e),d().saveCategory(),c(a.preventDefault())}),n(20,"div",82)(21,"div",69)(22,"label",97)(23,"span",21),i(24,"title"),t(),i(25," Nome Categoria * "),t(),n(26,"input",98),h("ngModelChange",function(a){m(e);let l=d();return u(l.categoryForm.name,a)||(l.categoryForm.name=a),c(a)}),t()(),n(27,"div",69)(28,"label",99)(29,"span",21),i(30,"filter_alt"),t(),i(31," Tipo "),t(),n(32,"select",100),h("ngModelChange",function(a){m(e);let l=d();return u(l.categoryForm.type,a)||(l.categoryForm.type=a),c(a)}),n(33,"option",101),i(34,"Entrambi i tipi"),t(),n(35,"option",63),i(36,"Solo Spese Fisse"),t(),n(37,"option",64),i(38,"Solo Spese Variabili"),t()()()(),n(39,"div",102)(40,"button",80),x("click",function(){m(e);let a=d();return c(a.closeCategoryModal())}),i(41," Annulla "),t(),n(42,"button",81),i(43," Crea Categoria "),t()()()(),n(44,"div",103)(45,"h3",96)(46,"span",21),i(47,"list"),t(),i(48," Categorie Esistenti "),t(),n(49,"div",104),f(50,_e,5,6,"div",105)(51,ue,3,0,"div",106),t()()()()()}if(p&2){let e=d();s(26),_("ngModel",e.categoryForm.name),s(6),_("ngModel",e.categoryForm.type),s(18),g("ngForOf",e.categories),s(),g("ngIf",e.categories.length===0)}}function fe(p,r){if(p&1&&(n(0,"span",5),i(1),t()),p&2){let e=d().$implicit;s(),y("- ",e.contact_name)}}function ve(p,r){if(p&1&&(n(0,"span",128),i(1),t()),p&2){let e=d().$implicit;s(),v(e.email)}}function Me(p,r){if(p&1&&(n(0,"span",129),i(1),t()),p&2){let e=d().$implicit;s(),v(e.phone)}}function ye(p,r){if(p&1&&(n(0,"div",123)(1,"div",124)(2,"strong"),i(3),t(),f(4,fe,2,1,"span",40),t(),n(5,"div",125),f(6,ve,2,1,"span",126)(7,Me,2,1,"span",127),t()()),p&2){let e=r.$implicit;s(3),v(e.company_name),s(),g("ngIf",e.contact_name),s(2),g("ngIf",e.email),s(),g("ngIf",e.phone)}}function Ee(p,r){p&1&&(n(0,"div",45)(1,"p"),i(2,"Nessun fornitore creato"),t()())}function we(p,r){if(p&1){let e=E();n(0,"div",49)(1,"div",50)(2,"div",88)(3,"h2",89)(4,"span",21),i(5,"local_shipping"),t(),i(6," Gestione Fornitori "),t(),n(7,"button",54),x("click",function(){m(e);let a=d();return c(a.closeSupplierModal())}),n(8,"span",21),i(9,"close"),t()()(),n(10,"div",90)(11,"div",103)(12,"h3",96)(13,"span",21),i(14,"add"),t(),i(15," Nuovo Fornitore "),t(),n(16,"form",55),x("submit",function(a){return m(e),d().saveSupplier(),c(a.preventDefault())}),n(17,"div",82)(18,"div",69)(19,"label",109)(20,"span",21),i(21,"business"),t(),i(22," Nome Ditta * "),t(),n(23,"input",110),h("ngModelChange",function(a){m(e);let l=d();return u(l.supplierForm.company_name,a)||(l.supplierForm.company_name=a),c(a)}),t()(),n(24,"div",69)(25,"label",111)(26,"span",21),i(27,"person"),t(),i(28," Referente "),t(),n(29,"input",112),h("ngModelChange",function(a){m(e);let l=d();return u(l.supplierForm.contact_name,a)||(l.supplierForm.contact_name=a),c(a)}),t()()(),n(30,"div",82)(31,"div",69)(32,"label",113)(33,"span",21),i(34,"email"),t(),i(35," Email "),t(),n(36,"input",114),h("ngModelChange",function(a){m(e);let l=d();return u(l.supplierForm.email,a)||(l.supplierForm.email=a),c(a)}),t()(),n(37,"div",69)(38,"label",115)(39,"span",21),i(40,"phone"),t(),i(41," Telefono "),t(),n(42,"input",116),h("ngModelChange",function(a){m(e);let l=d();return u(l.supplierForm.phone,a)||(l.supplierForm.phone=a),c(a)}),t()()(),n(43,"div",69)(44,"label",117)(45,"span",21),i(46,"location_on"),t(),i(47," Indirizzo "),t(),n(48,"textarea",118),h("ngModelChange",function(a){m(e);let l=d();return u(l.supplierForm.address,a)||(l.supplierForm.address=a),c(a)}),t()(),n(49,"div",69)(50,"label",119)(51,"span",21),i(52,"notes"),t(),i(53," Descrizione "),t(),n(54,"textarea",120),h("ngModelChange",function(a){m(e);let l=d();return u(l.supplierForm.description,a)||(l.supplierForm.description=a),c(a)}),t()(),n(55,"div",102)(56,"button",80),x("click",function(){m(e);let a=d();return c(a.closeSupplierModal())}),i(57," Annulla "),t(),n(58,"button",81),i(59," Crea Fornitore "),t()()()(),n(60,"div",103)(61,"h3",96)(62,"span",21),i(63,"list"),t(),i(64," Fornitori Esistenti "),t(),n(65,"div",121),f(66,ye,8,4,"div",122)(67,Ee,3,0,"div",106),t()()()()()}if(p&2){let e=d();s(23),_("ngModel",e.supplierForm.company_name),s(6),_("ngModel",e.supplierForm.contact_name),s(7),_("ngModel",e.supplierForm.email),s(6),_("ngModel",e.supplierForm.phone),s(6),_("ngModel",e.supplierForm.address),s(6),_("ngModel",e.supplierForm.description),s(12),g("ngForOf",e.suppliers),s(),g("ngIf",e.suppliers.length===0)}}var U=class p{expenseService=b(Q);supplierService=b(K);expenses=[];availableMonths=[];categories=[];suppliers=[];selectedMonth=this.getCurrentMonth();viewMode="monthly";searchTerm="";showExpenseModal=!1;showMonthsModal=!1;showCategoryModal=!1;showSupplierModal=!1;editingExpense=null;expenseForm={name:"",amount:0,type:"fissa",category:"",month:this.getCurrentMonth(),notes:"",is_recurring:!1,supplier_id:null};categoryForm={name:"",type:"entrambi"};supplierForm={company_name:"",contact_name:"",email:"",phone:"",address:"",description:""};get monthlyStats(){return this.expenseService.calculateMonthlyTotal(this.filteredExpenses)}get filteredExpenses(){let r=this.expenses;return this.searchTerm&&(r=r.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.category.toLowerCase().includes(this.searchTerm.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(this.searchTerm.toLowerCase()))),r}get allCategories(){let r=this.expenseService.getDefaultCategories(),e=this.categories.map(o=>o.name);return[...new Set([...r,...e])].sort()}getCategoriesByType(r){return this.allCategories.filter(e=>{let o=this.categories.find(a=>a.name===e);return o?o.type==="entrambi"||o.type===r:!0})}ngOnInit(){this.loadData()}loadData(){return M(this,null,function*(){yield this.loadExpenses(),yield this.loadAvailableMonths(),yield this.loadCategories(),yield this.loadSuppliers()})}loadSuppliers(){return M(this,null,function*(){yield this.supplierService.loadSuppliers(),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r})})}loadExpenses(){return M(this,null,function*(){if(this.viewMode==="monthly")yield this.expenseService.loadExpensesForMonth(this.selectedMonth),this.expenseService.data$.subscribe(r=>{this.expenses=r});else{let r=yield this.expenseService.loadExpensesForDateRange("2000-01-01","2030-12-01");this.expenses=r}})}loadAvailableMonths(){return M(this,null,function*(){this.availableMonths=yield this.expenseService.getAvailableMonths()})}loadCategories(){return M(this,null,function*(){yield this.expenseService.loadCategories(),this.expenseService.categories$.subscribe(r=>{this.categories=r})})}getCurrentMonth(){let r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-01`}formatMonthForInput(r){return r.substring(0,7)}formatMonthForDatabase(r){return r.match(/^\d{4}-\d{2}-\d{2}$/)?r:`${r}-01`}formatMonthDisplay(r){return new Date(this.formatMonthForDatabase(r)).toLocaleDateString("it-IT",{month:"long",year:"numeric"})}formatCurrency(r){return`\u20AC${r.toFixed(2)}`}getSupplierName(r){if(!r)return"Nessun fornitore";let e=this.suppliers.find(o=>o.id===r);return e?e.company_name:"Fornitore sconosciuto"}openAddExpenseModal(){this.editingExpense=null,this.expenseForm={name:"",amount:0,type:"fissa",category:"",month:this.formatMonthForInput(this.selectedMonth),notes:"",is_recurring:!1,supplier_id:null},this.showExpenseModal=!0}openEditExpenseModal(r){this.editingExpense=r,this.expenseForm={name:r.name,amount:r.amount,type:r.type,category:r.category,month:this.formatMonthForInput(r.month),notes:r.notes||"",is_recurring:r.is_recurring,supplier_id:r.supplier_id||null},this.showExpenseModal=!0}openCategoryModal(){this.categoryForm={name:"",type:"entrambi"},this.showCategoryModal=!0}openSupplierModal(){this.supplierForm={company_name:"",contact_name:"",email:"",phone:"",address:"",description:""},this.showSupplierModal=!0}closeExpenseModal(){this.showExpenseModal=!1,this.editingExpense=null}closeMonthsModal(){this.showMonthsModal=!1}closeCategoryModal(){this.showCategoryModal=!1}closeSupplierModal(){this.showSupplierModal=!1}saveExpense(){return M(this,null,function*(){if(!this.expenseForm.name||!this.expenseForm.amount||!this.expenseForm.category){alert("Compila tutti i campi obbligatori");return}try{let r=C(S({},this.expenseForm),{month:this.formatMonthForDatabase(this.expenseForm.month)});this.editingExpense?yield this.expenseService.update(this.editingExpense.id,r):yield this.expenseService.create(r),this.closeExpenseModal(),yield this.loadData()}catch(r){console.error("Error saving expense:",r),alert("Errore nel salvataggio della spesa: "+r.message)}})}saveCategory(){return M(this,null,function*(){if(!this.categoryForm.name){alert("Inserisci un nome per la categoria");return}try{let r=C(S({},this.categoryForm),{is_active:!0});yield this.expenseService.createCategory(r),this.closeCategoryModal(),yield this.loadCategories()}catch(r){console.error("Error saving category:",r),alert("Errore nella creazione della categoria")}})}saveSupplier(){return M(this,null,function*(){if(!this.supplierForm.company_name){alert("Inserisci il nome della ditta fornitrice");return}try{let r=C(S({},this.supplierForm),{user_id:null,is_platform_supplier:!1,is_approved:!0});yield this.supplierService.createSupplier(r),this.closeSupplierModal(),yield this.loadSuppliers(),alert("Fornitore creato con successo!")}catch(r){console.error("Error saving supplier:",r),alert("Errore nella creazione del fornitore")}})}openMonthsModal(){this.showMonthsModal=!0}formatMonth(r){return this.formatMonthDisplay(r)}deleteExpense(r){return M(this,null,function*(){if(confirm(`Sei sicuro di voler eliminare la spesa "${r.name}"?`))try{let{error:e}=yield this.expenseService.supabaseService.getSupabaseClient().from("expenses").delete().eq("id",r.id);if(e)throw e;yield this.loadData()}catch(e){console.error("Error deleting expense:",e),alert("Errore nell'eliminazione della spesa")}})}changeMonth(r){return M(this,null,function*(){this.selectedMonth=r,this.viewMode="monthly",yield this.loadExpenses(),this.closeMonthsModal()})}changeViewMode(r){return M(this,null,function*(){this.viewMode=r,yield this.loadExpenses()})}copyFixedExpensesFromPreviousMonth(){return M(this,null,function*(){if(confirm("Vuoi copiare le spese fisse dal mese precedente?"))try{let r=new Date(this.formatMonthForDatabase(this.selectedMonth));r.setMonth(r.getMonth()-1);let e=r.toISOString().split("T")[0],a=(yield this.expenseService.loadExpensesForDateRange(e,e)).filter(l=>l.type==="fissa");for(let l of a)yield this.expenseService.create({name:l.name,amount:l.amount,type:l.type,category:l.category,month:this.selectedMonth,notes:l.notes||"",is_recurring:l.is_recurring,supplier_id:l.supplier_id});yield this.loadData(),alert(`Copiate ${a.length} spese fisse dal mese precedente`)}catch(r){console.error("Error copying fixed expenses:",r),alert("Errore nella copia delle spese fisse")}})}onExpenseTypeChange(){this.expenseForm.category=""}static \u0275fac=function(e){return new(e||p)};static \u0275cmp=V({type:p,selectors:[["app-expense-management"]],decls:73,vars:19,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],["class","grid-cards",4,"ngIf"],[1,"form-card"],[1,"flex","justify-between","items-end","gap-lg","flex-wrap"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"flex","gap-md","flex-wrap"],[1,"radio-label"],["type","radio","name","viewMode",3,"ngModelChange","change","value","ngModel"],[1,"radio-checkmark"],["class","form-group",4,"ngIf"],["type","text","placeholder","Cerca per nome, categoria, fornitore...",3,"ngModelChange","ngModel"],[1,"flex","gap-sm","flex-wrap","justify-end"],["class","promethea-button ghost",3,"click",4,"ngIf"],[1,"promethea-button","ghost",3,"click"],[1,"material-icons"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"crm-table"],[4,"ngIf"],["class","hover-lift transition",4,"ngFor","ngForOf"],["class","modal-overlay",4,"ngIf"],[1,"grid-cards"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"flex","flex-col","gap-md"],[1,"text-md","font-bold","text-primary","text-amber-500","justify-center","flex"],[1,"hover-lift","transition"],[1,"flex","items-center","gap-sm"],[1,"chip"],["class","chip primary",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"notes-preview"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],[1,"chip","primary"],[1,"text-center","p-xl","opacity-70"],[1,"flex","flex-col","items-center","gap-md"],[1,"material-icons","text-muted",2,"font-size","3rem"],[1,"promethea-button","ghost","small",3,"click"],[1,"modal-overlay"],[1,"modal-container","modal-lg"],[1,"modal-header"],[1,"flex"],[1,"header-icon"],[1,"icon-button","close-button",3,"click"],[1,"generic-form",3,"submit"],[1,"form-row","mb-md"],["for","expense-name",1,"standard-label"],["type","text","id","expense-name","name","name","required","","placeholder","Es. Affitto locale",3,"ngModelChange","ngModel"],["for","expense-amount",1,"standard-label"],["type","number","id","expense-amount","name","amount","step","0.01","min","0","required","",3,"ngModelChange","ngModel"],["for","expense-type",1,"standard-label"],["id","expense-type","name","type","required","",3,"ngModelChange","change","ngModel"],["value","fissa"],["value","variabile"],["for","expense-category",1,"standard-label"],["id","expense-category","name","category","required","",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"flex","flex-col","gap-1","flex-1","min-w-300"],["for","expense-supplier",1,"standard-label"],[1,"input-group"],["id","expense-supplier","name","supplier_id",1,"form-input",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","gap-sm",2,"margin","var(--gap-md) 0"],["type","button",1,"promethea-button","secondary","small",3,"click"],["class","grid gap-md flex flex-wrap",4,"ngIf"],["for","expense-notes",1,"standard-label"],["id","expense-notes","name","notes","rows","3","placeholder","Note aggiuntive...",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button"],[1,"grid","gap-md","flex","flex-wrap"],["for","expense-month",1,"standard-label"],["type","month","id","expense-month","name","month","required","",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-sm","cursor-pointer","p-sm","rounded","transition","hover:bg-[var(--smoke-1)]","large"],["type","checkbox","name","is_recurring",3,"ngModelChange","ngModel"],[1,"modal-container","modal-sm"],[1,"p-md","border-t","border-b","border-[var(--smoke-1)]","flex","justify-between","items-center"],[1,"modal-title"],[1,"p-lg","flex-1","overflow-y-auto"],[1,"months-list"],["class","promethea-button ghost",3,"active","click",4,"ngFor","ngForOf"],[1,"form-footer"],[1,"modal-container","modal-md"],[1,"border","rounded-lg","p-lg","bg-gradient-light","shadow-card","m-sm02","my-md"],[1,"flex","items-center","gap-sm","mb-md","font-bold","text-[calc(var(--fs-sm)*1.2)]"],["for","category-name",1,"standard-label"],["type","text","id","category-name","name","name","required","","placeholder","Es. Manutenzione impianti",3,"ngModelChange","ngModel"],["for","category-type",1,"standard-label"],["id","category-type","name","type","required","",3,"ngModelChange","ngModel"],["value","entrambi"],[1,"flex","justify-between","items-center","gap-md","mt-lg","pt-md","border-t","border-[var(--smoke-1)]"],[1,"border","rounded-lg","p-lg","bg-gradient-light","shadow-card","my-md"],[1,"categories-list"],["class","category-item",4,"ngFor","ngForOf"],["class","text-center p-xl opacity-70",4,"ngIf"],[1,"category-item"],[1,"category-name"],["for","supplier-company",1,"standard-label"],["type","text","id","supplier-company","name","company_name","required","","placeholder","Nome della ditta fornitrice",3,"ngModelChange","ngModel"],["for","supplier-contact",1,"standard-label"],["type","text","id","supplier-contact","name","contact_name","placeholder","Nome del referente",3,"ngModelChange","ngModel"],["for","supplier-email",1,"standard-label"],["type","email","id","supplier-email","name","email","placeholder","email@fornitore.com",3,"ngModelChange","ngModel"],["for","supplier-phone",1,"standard-label"],["type","tel","id","supplier-phone","name","phone","placeholder","Numero di telefono",3,"ngModelChange","ngModel"],["for","supplier-address",1,"standard-label"],["id","supplier-address","name","address","rows","2","placeholder","Indirizzo del fornitore",3,"ngModelChange","ngModel"],["for","supplier-description",1,"standard-label"],["id","supplier-description","name","description","rows","3","placeholder","Note aggiuntive sul fornitore",3,"ngModelChange","ngModel"],[1,"suppliers-list"],["class","supplier-item",4,"ngFor","ngForOf"],[1,"supplier-item"],[1,"supplier-info"],[1,"supplier-details"],["class","chip active",4,"ngIf"],["class","chip secondary",4,"ngIf"],[1,"chip","active"],[1,"chip","secondary"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),i(4,"account_balance"),t(),n(5,"h1",4),i(6,"Gestione Spese"),t()(),n(7,"p",5),i(8,"Gestisci le spese fisse e variabili del tuo ristorante"),t()(),f(9,X,28,3,"div",6),n(10,"div",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"label",11),i(15,"Periodo"),t(),n(16,"div",12)(17,"label",13)(18,"input",14),h("ngModelChange",function(l){return u(o.viewMode,l)||(o.viewMode=l),l}),x("change",function(){return o.changeViewMode("monthly")}),t(),F(19,"span",15),n(20,"span"),i(21,"Mensile"),t()(),n(22,"label",13)(23,"input",14),h("ngModelChange",function(l){return u(o.viewMode,l)||(o.viewMode=l),l}),x("change",function(){return o.changeViewMode("all")}),t(),F(24,"span",15),n(25,"span"),i(26,"Tutti i Mesi"),t()()()(),f(27,Z,7,1,"div",16),n(28,"div",10)(29,"label",11),i(30,"Cerca"),t(),n(31,"input",17),h("ngModelChange",function(l){return u(o.searchTerm,l)||(o.searchTerm=l),l}),t()()(),n(32,"div",18),f(33,$,4,0,"button",19),n(34,"button",20),x("click",function(){return o.openCategoryModal()}),n(35,"span",21),i(36,"category"),t(),i(37," Aggiungi Categorie "),t(),n(38,"button",20),x("click",function(){return o.openSupplierModal()}),n(39,"span",21),i(40,"local_shipping"),t(),i(41," Aggiungi Fornitori "),t(),n(42,"button",22),x("click",function(){return o.openAddExpenseModal()}),n(43,"span",21),i(44,"add"),t(),i(45," Nuova Spesa "),t()()()(),n(46,"div",23)(47,"div",24)(48,"table",25)(49,"thead")(50,"tr")(51,"th"),i(52,"Nome"),t(),n(53,"th"),i(54,"Tipo"),t(),n(55,"th"),i(56,"Categoria"),t(),n(57,"th"),i(58,"Importo"),t(),n(59,"th"),i(60,"Fornitore"),t(),f(61,ee,2,0,"th",26),n(62,"th"),i(63,"Note"),t(),n(64,"th"),i(65,"Azioni"),t()()(),n(66,"tbody"),f(67,ae,27,10,"tr",27)(68,le,11,3,"tr",26),t()()()(),f(69,ce,75,13,"div",28)(70,xe,16,1,"div",28)(71,he,52,4,"div",28)(72,we,68,8,"div",28),t()),e&2&&(s(9),g("ngIf",o.viewMode==="monthly"),s(8),w("active",o.viewMode==="monthly"),s(),g("value","monthly"),_("ngModel",o.viewMode),s(4),w("active",o.viewMode==="all"),s(),g("value","all"),_("ngModel",o.viewMode),s(4),g("ngIf",o.viewMode==="monthly"),s(4),_("ngModel",o.searchTerm),s(2),g("ngIf",o.viewMode==="monthly"),s(28),g("ngIf",o.viewMode==="all"),s(6),g("ngForOf",o.filteredExpenses),s(),g("ngIf",o.filteredExpenses.length===0),s(),g("ngIf",o.showExpenseModal),s(),g("ngIf",o.showMonthsModal),s(),g("ngIf",o.showCategoryModal),s(),g("ngIf",o.showSupplierModal))},dependencies:[P,k,I,J,B,G,R,W,z,O,q,j,N,D,H,Y,A,L],styles:['.radio-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);padding:var(--gap-sm) var(--gap-md);border:1px solid var(--smoke-1);border-radius:12px;cursor:pointer;transition:all .3s ease;background:var(--background)}.radio-label[_ngcontent-%COMP%]:hover{border-color:var(--primary);transform:translateY(-2px)}.radio-label.active[_ngcontent-%COMP%]{background:var(--smoke-2);border-color:var(--primary);color:var(--primary)}.radio-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{display:none}.radio-checkmark[_ngcontent-%COMP%]{width:18px;height:18px;border:2px solid var(--smoke-1);border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.radio-label.active[_ngcontent-%COMP%]   .radio-checkmark[_ngcontent-%COMP%]{border-color:var(--primary);background:var(--primary)}.radio-label.active[_ngcontent-%COMP%]   .radio-checkmark[_ngcontent-%COMP%]:after{content:"";width:8px;height:8px;background:#fff;border-radius:50%}.table-section[_ngcontent-%COMP%]{margin-top:var(--gap-lg)}.chip.small[_ngcontent-%COMP%]{padding:.125rem .5rem;font-size:.75rem}.chip.primary[_ngcontent-%COMP%]{background:var(--smoke-2);color:var(--primary);border-color:var(--smoke-2)}.notes-preview[_ngcontent-%COMP%]{max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text-muted)}.input-group[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);align-items:stretch}.input-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1;min-width:0}.input-group[_ngcontent-%COMP%]   .promethea-button.small[_ngcontent-%COMP%]{padding:var(--gap-sm);white-space:nowrap;flex-shrink:0}.months-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:var(--gap-sm);margin-bottom:var(--gap-lg)}.categories-list[_ngcontent-%COMP%], .suppliers-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm)}.category-item[_ngcontent-%COMP%], .supplier-item[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:center;padding:var(--gap-sm);border:1px solid var(--smoke-1);border-radius:12px;transition:all .3s ease}.category-item[_ngcontent-%COMP%]:hover, .supplier-item[_ngcontent-%COMP%]:hover{border-color:var(--primary);transform:translate(4px)}.supplier-info[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:var(--gap-sm)}.supplier-details[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);flex-wrap:wrap}@media (max-width: 768px){.flex.justify-between[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child{align-self:stretch}.input-group[_ngcontent-%COMP%]{flex-direction:column}.supplier-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:var(--gap-sm)}.supplier-details[_ngcontent-%COMP%]{align-self:stretch;justify-content:flex-start}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus, button[_ngcontent-%COMP%]:focus{outline:2px solid var(--primary);outline-offset:2px}.loading[_ngcontent-%COMP%]{opacity:.6;pointer-events:none;position:relative}.loading[_ngcontent-%COMP%]:after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;border:2px solid var(--smoke-1);border-top:2px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite}']})};export{U as ExpenseManagement};
