import{b as M,c as p,d as I,e as x,i as F,j as O,m as k,p as A,w as T,y as L}from"./chunk-7VSFVQGQ.js";import{b as P}from"./chunk-IHSWM4ZR.js";import"./chunk-FBJM6ARG.js";import{d as w,m as R,p as C,r as S,s as E}from"./chunk-VYE6ILYG.js";import{$a as d,Bb as c,Eb as s,Fb as h,Ga as o,Gb as v,Wa as N,da as g,g as b,hb as l,ib as a,jb as r,kb as u,sb as y,ub as f}from"./chunk-3SWAHN2Y.js";function z(n,t){n&1&&(a(0,"div",29),s(1," Il nome \xE8 obbligatorio "),r())}function D(n,t){n&1&&(a(0,"div",29),s(1," Il cognome \xE8 obbligatorio "),r())}function V(n,t){n&1&&(a(0,"span"),s(1,"Email obbligatoria"),r())}function G(n,t){n&1&&(a(0,"span"),s(1,"Email non valida"),r())}function j(n,t){if(n&1&&(a(0,"div",29),d(1,V,2,0,"span",28)(2,G,2,0,"span",28),r()),n&2){let i=f();o(),l("ngIf",i.email==null||i.email.errors==null?null:i.email.errors.required),o(),l("ngIf",i.email==null||i.email.errors==null?null:i.email.errors.email)}}function Y(n,t){n&1&&(a(0,"div",29),s(1," Il nome del ristorante \xE8 obbligatorio "),r())}function U(n,t){if(n&1&&(a(0,"div",8)(1,"h2",9)(2,"span",30),s(3,"business"),r(),s(4," Informazioni Ristorante "),r(),a(5,"div",12)(6,"label",13),s(7,"Nome Ristorante *"),r(),u(8,"input",31),d(9,Y,2,0,"div",15),r()()),n&2){let i=f();o(8),c("error",(i.restaurantName==null?null:i.restaurantName.invalid)&&(i.restaurantName==null?null:i.restaurantName.touched)),o(),l("ngIf",(i.restaurantName==null?null:i.restaurantName.invalid)&&(i.restaurantName==null?null:i.restaurantName.touched))}}function B(n,t){n&1&&(a(0,"div",29),s(1," Password obbligatoria (min. 6 caratteri) "),r())}function H(n,t){n&1&&(a(0,"div",29),s(1," Le password non coincidono "),r())}function J(n,t){if(n&1&&(a(0,"div",32),s(1),r()),n&2){let i=f();o(),v(" ",i.errorMessage," ")}}function K(n,t){n&1&&u(0,"span",33)}function Q(n,t){if(n&1&&(a(0,"span"),s(1),r()),n&2){let i=f();o(),h(i.isRestaurant?"Registra Ristorante":"Crea Account")}}var q=class n{fb=g(T);authService=g(P);router=g(S);route=g(C);registerForm;isLoading=!1;errorMessage="";isRestaurant=!1;isSupplier=!1;ngOnInit(){let t=this.route.snapshot.paramMap.get("role");this.isRestaurant=t==="restaurant",this.isSupplier=t==="supplier",this.initializeForm()}initializeForm(){this.registerForm=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(6)]],confirmPassword:["",[p.required]],firstName:["",[p.required]],lastName:["",[p.required]],phone:[""],restaurantName:[(this.isRestaurant,""),this.isRestaurant?p.required:[]],companyName:[(this.isSupplier,""),this.isSupplier?p.required:[]],contactName:[(this.isSupplier,""),this.isSupplier?p.required:[]],supplierAddress:[(this.isSupplier,"")],supplierDescription:[(this.isSupplier,"")]},{validators:this.passwordMatchValidator})}passwordMatchValidator(t){let i=t.get("password")?.value,e=t.get("confirmPassword")?.value;return i===e?null:{passwordMismatch:!0}}onSubmit(){return b(this,null,function*(){if(this.registerForm.invalid||this.isLoading)return;this.isLoading=!0,this.errorMessage="";let t=this.registerForm.value;try{let i=this.determineUserRole(),e={email:t.email.toLowerCase().trim(),password:t.password,user_data:{first_name:t.firstName,last_name:t.lastName,phone:t.phone,role:i},restaurant_data:this.isRestaurant?{name:t.restaurantName,address:"",phone:t.phone||"",email:t.email,description:"",cuisine_type:"",allow_table_selection:!1,accepts_delivery:!1,accepts_takeaway:!1}:void 0,supplier_data:this.isSupplier?{company_name:t.companyName,contact_name:t.contactName,email:t.email,phone:t.phone||"",address:t.supplierAddress,description:t.supplierDescription}:void 0},m=yield this.authService.register(e);if(m.error){if(typeof m.error=="string")this.errorMessage=m.error;else if(m.error&&typeof m.error=="object"){let _=m.error;this.errorMessage=_.message||_.toString()}else this.errorMessage="Errore durante la registrazione";console.error("Registration error details:",m.error)}else m.user&&(console.log("\u2705 Registration successful, user:",m.user.id),this.errorMessage="Registrazione completata! Reindirizzamento...",this.redirectAfterRegistration(m))}catch(i){i instanceof Error?this.errorMessage="Errore durante la registrazione: "+i.message:typeof i=="string"?this.errorMessage="Errore durante la registrazione: "+i:this.errorMessage="Errore sconosciuto durante la registrazione",console.error("Registration exception:",i)}finally{this.isLoading=!1}})}determineUserRole(){return this.isRestaurant?"restaurant_owner":this.isSupplier?"supplier":"customer"}redirectAfterRegistration(t){setTimeout(()=>{this.isRestaurant&&t.restaurant?this.router.navigate(["/restaurant/dashboard"]):this.isSupplier?this.router.navigate(["/supplier/dashboard"]):this.router.navigate(["/customer/menu-display"])},2e3)}get email(){return this.registerForm.get("email")}get password(){return this.registerForm.get("password")}get confirmPassword(){return this.registerForm.get("confirmPassword")}get firstName(){return this.registerForm.get("firstName")}get lastName(){return this.registerForm.get("lastName")}get restaurantName(){return this.registerForm.get("restaurantName")}get companyName(){return this.registerForm.get("companyName")}get contactName(){return this.registerForm.get("contactName")}get supplierAddress(){return this.registerForm.get("supplierAddress")}get supplierDescription(){return this.registerForm.get("supplierDescription")}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=N({type:n,selectors:[["app-register"]],decls:61,vars:24,consts:[[1,"gradient-container"],[1,"form-card","modal-md"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-card"],[1,"text-md","font-semibold","mb-md"],[1,"material-icons","text-md"],[1,"form-row","mb-md"],[1,"form-group"],[1,"standard-label"],["formControlName","firstName","placeholder","Il tuo nome","type","text"],["class","error-message",4,"ngIf"],["formControlName","lastName","placeholder","Il tuo cognome","type","text"],["formControlName","email","type","email","placeholder","tua.email@esempio.com"],["formControlName","phone","placeholder","+39 123 456 7890","type","number"],["class","form-card",4,"ngIf"],[1,"form-row"],["formControlName","password","type","password","placeholder","Almeno 6 caratteri"],["formControlName","confirmPassword","type","password","placeholder","Ripeti la password"],["class","error-message","style","margin: 1rem 0; padding: 1rem; background: #fee;",4,"ngIf"],[1,"flex","justify-between","items-center","gap-md","mt-lg","pt-md"],["routerLink","/login",1,"link"],["type","submit",1,"promethea-button",3,"disabled"],["class","loading-spinner",4,"ngIf"],[4,"ngIf"],[1,"error-message"],[1,"material-icons"],["formControlName","restaurantName","placeholder","Il nome del tuo ristorante","type","text"],[1,"error-message",2,"margin","1rem 0","padding","1rem","background","#fee"],[1,"loading-spinner"]],template:function(i,e){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),s(5),r(),a(6,"h1",5),s(7),r()(),a(8,"p",6),s(9),r()(),a(10,"form",7),y("ngSubmit",function(){return e.onSubmit()}),a(11,"div",8)(12,"h2",9)(13,"span",10),s(14,"person"),r(),s(15," Informazioni Personali "),r(),a(16,"div",11)(17,"div",12)(18,"label",13),s(19,"Nome *"),r(),u(20,"input",14),d(21,z,2,0,"div",15),r(),a(22,"div",12)(23,"label",13),s(24,"Cognome *"),r(),u(25,"input",16),d(26,D,2,0,"div",15),r()(),a(27,"div",11)(28,"div",12)(29,"label",13),s(30,"Email *"),r(),u(31,"input",17),d(32,j,3,2,"div",15),r(),a(33,"div",12)(34,"label",13),s(35,"Telefono"),r(),u(36,"input",18),r()()(),d(37,U,10,3,"div",19),a(38,"div",8)(39,"h2",9)(40,"span",10),s(41,"lock"),r(),s(42," Password "),r(),a(43,"div",20)(44,"div",12)(45,"label",13),s(46,"Password *"),r(),u(47,"input",21),d(48,B,2,0,"div",15),r(),a(49,"div",12)(50,"label",13),s(51,"Conferma Password *"),r(),u(52,"input",22),d(53,H,2,0,"div",15),r()()(),d(54,J,2,1,"div",23),a(55,"div",24)(56,"a",25),s(57," \u2190 Hai gi\xE0 un account? Accedi "),r(),a(58,"button",26),d(59,K,1,0,"span",27)(60,Q,2,1,"span",28),r()()()()()),i&2&&(o(5),h(e.isRestaurant?"restaurant":"person"),o(2),h(e.isRestaurant?"Registra il tuo Ristorante":"Crea Account"),o(2),v(" ",e.isRestaurant?"Crea il tuo account business":"Crea il tuo account personale"," "),o(),l("formGroup",e.registerForm),o(10),c("error",(e.firstName==null?null:e.firstName.invalid)&&(e.firstName==null?null:e.firstName.touched)),o(),l("ngIf",(e.firstName==null?null:e.firstName.invalid)&&(e.firstName==null?null:e.firstName.touched)),o(4),c("error",(e.lastName==null?null:e.lastName.invalid)&&(e.lastName==null?null:e.lastName.touched)),o(),l("ngIf",(e.lastName==null?null:e.lastName.invalid)&&(e.lastName==null?null:e.lastName.touched)),o(5),c("error",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),o(),l("ngIf",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),o(5),l("ngIf",e.isRestaurant),o(10),c("error",(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),o(),l("ngIf",(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),o(4),c("error",(e.registerForm.errors==null?null:e.registerForm.errors.passwordMismatch)&&(e.confirmPassword==null?null:e.confirmPassword.touched)),o(),l("ngIf",(e.registerForm.errors==null?null:e.registerForm.errors.passwordMismatch)&&(e.confirmPassword==null?null:e.confirmPassword.touched)),o(),l("ngIf",e.errorMessage),o(4),l("disabled",e.isLoading),o(),l("ngIf",e.isLoading),o(),l("ngIf",!e.isLoading))},dependencies:[R,w,L,F,M,O,I,x,k,A,E],styles:['.gradient-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--background);padding:var(--gutter-sm);position:relative;overflow:hidden}.gradient-container[_ngcontent-%COMP%]:before, .gradient-container[_ngcontent-%COMP%]:after, .gradient-container[_ngcontent-%COMP%]   .floating-blob[_ngcontent-%COMP%]{content:"";position:absolute;border-radius:50%;filter:blur(90px);opacity:.22;pointer-events:none;animation:vapor 28s ease-in-out infinite}.gradient-container[_ngcontent-%COMP%]:before{width:700px;height:700px;background:radial-gradient(circle at 30%,var(--primary) 0%,transparent 65%);top:-20%;left:-15%;animation-delay:0s}.gradient-container[_ngcontent-%COMP%]:after{width:600px;height:600px;background:radial-gradient(circle at 40%,var(--secondary) 0%,transparent 70%);bottom:-10%;right:-10%;animation-delay:-9s}.gradient-container[_ngcontent-%COMP%]   .floating-blob[_ngcontent-%COMP%]{width:700px;height:700px;background:radial-gradient(circle at 30% 40%,var(--tertiary) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-14s;opacity:.15;filter:blur(100px)}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0) translate(0) rotate(0)}33%{transform:translateY(-40px) translate(30px) rotate(120deg)}66%{transform:translateY(30px) translate(-40px) rotate(240deg)}}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]{position:absolute;width:4px;height:4px;background:var(--secondary);border-radius:50%;opacity:0;animation:_ngcontent-%COMP%_sparkle 8s linear infinite}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(1){top:20%;left:15%;animation-delay:1s}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(2){top:70%;right:20%;animation-delay:3s}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(3){bottom:30%;left:30%;animation-delay:5s}@keyframes _ngcontent-%COMP%_sparkle{0%,to{opacity:0;transform:scale(0)}50%{opacity:.8;transform:scale(1)}}.gradient-container[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{border-radius:var(--fs-md)}']})};export{q as Register};
