import{B as f,D as h}from"./chunk-KBL2L3GY.js";import{a as c,b as l,ba as S,f as u,ga as o,m as d}from"./chunk-UE7YVF6I.js";var m=class s{supabaseService=o(f);authService=o(h);suppliersSubject=new d([]);suppliers$=this.suppliersSubject.asObservable();loadSuppliers(){return u(this,null,function*(){try{let e=this.authService.currentUserValue;if(!e){console.error("No user authenticated");return}let{data:r,error:t}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",e.id).limit(1);if(t||!r?.length){console.error("\u274C No restaurant found for user:",e.id);return}let a=r[0].id,{data:n,error:i}=yield this.supabaseService.getSupabaseClient().from("suppliers").select("*").eq("restaurant_id",a).order("company_name");if(i)throw i;this.suppliersSubject.next(n||[])}catch(e){console.error("Error loading suppliers:",e)}})}createSupplier(e){return u(this,null,function*(){try{let r=this.authService.currentUserValue;if(!r)return console.error("No user authenticated"),null;let{data:t,error:a}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",r.id).limit(1);if(a||!t?.length)return console.error("\u274C No restaurant found for user:",r.id),null;let n=t[0].id,i=l(c({},e),{restaurant_id:n}),{data:b,error:p}=yield this.supabaseService.getSupabaseClient().from("suppliers").insert(i).select().single();if(p)throw p;return yield this.loadSuppliers(),b}catch(r){return console.error("Error creating supplier:",r),null}})}getSuppliers(){return this.suppliersSubject.value}getSupplierById(e){return this.suppliersSubject.value.find(r=>r.id===e)}static \u0275fac=function(r){return new(r||s)};static \u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})};export{m as a};
