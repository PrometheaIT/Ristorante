import{a as b}from"./chunk-GS53O7WG.js";import{Aa as d,a as l,g as s,ga as c}from"./chunk-HCHBVVTJ.js";var u=class n extends b{getTableName(){return"tables"}loadData(){return s(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let{data:r,error:t}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",e).eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;this.dataSubject.next(r||[])}catch(e){console.error(`Error loading ${this.getTableName()}:`,e),this.errorSubject.next(e.message),this.dataSubject.next([])}})}getTables(){return this.dataSubject.value}getTablesByFloorPlan(e){return this.dataSubject.value.filter(r=>r.floor_plan_id===e)}createTable(e){return s(this,null,function*(){try{console.log("\u{1F4DD} Creating table with shape:",e.shape);let{data:r,error:t}=yield this.supabaseService.getSupabaseClient().from("tables").insert(e).select().single();if(t)throw console.error("\u274C Error creating table:",t),console.error("\u274C Error details:",t.details),t;return console.log("\u2705 Table created successfully"),yield this.loadData(),r}catch(r){return console.error("\u{1F4A5} Error in createTable:",r),null}})}updateTable(e,r){return s(this,null,function*(){try{console.log(`\u{1F4BE} updateTable for table ${e}:`,r);let t=this.dataSubject.value,a=t.map(i=>i.id===e?l(l({},i),r):i);this.dataSubject.next(a);let{error:o}=yield this.supabaseService.getSupabaseClient().from("tables").update(r).eq("id",e);if(o)throw console.error("\u274C Database error updating table:",o),this.dataSubject.next(t),o;return console.log(`\u2705 Table ${e} updated successfully`),!0}catch(t){return console.error("\u274C Error updating table:",t),yield this.loadData(),!1}})}deleteTable(e){return s(this,null,function*(){try{let{error:r}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_active:!1}).eq("id",e);if(r)throw r;return yield this.loadData(),!0}catch(r){return console.error("\u274C Error deleting table:",r),!1}})}checkTableOverlap(e,r){let t=this.getTablesByFloorPlan(e.floor_plan_id),a=Array.isArray(r)?r:r?[r]:[];for(let o of t){if(a.includes(o.id))continue;if(this.doTablesOverlap(e,o))return!0}return!1}doTablesOverlap(e,r){return!(e.position_x+e.width<=r.position_x||e.position_x>=r.position_x+r.width||e.position_y+e.height<=r.position_y||e.position_y>=r.position_y+r.height)}updateTableOnlineBookable(e,r){return s(this,null,function*(){try{let{error:t}=yield this.supabaseService.getSupabaseClient().from("tables").update({is_online_bookable:r}).eq("id",e);if(t)throw t;return yield this.loadData(),!0}catch(t){return console.error("\u274C Error updating table online bookable status:",t),!1}})}getTablesAvailableForOnlineBooking(e){return this.getTablesByFloorPlan(e).filter(r=>r.is_online_bookable&&!r.is_merged&&r.is_active)}getVisibleTablesByFloorPlan(e){let r=this.getTablesByFloorPlan(e),t=r.filter(a=>!a.is_merged||a.parent_table_id===null);return console.log("\u{1F50D} DEBUG getVisibleTablesByFloorPlan:",{floorPlanId:e,allTablesCount:r.length,visibleTablesCount:t.length,allTables:r,visibleTables:t}),t}getTableStyle(e){let r;e.border_radius!==void 0&&e.border_radius!==null?r=e.border_radius===50?"50%":`${e.border_radius}px`:r=e.shape==="circle"?"50%":"8px";let t=e.rotation||0,a={left:e.position_x+"px",top:e.position_y+"px",width:e.width+"px",height:e.height+"px","border-radius":r,transform:`rotate(${t}deg)`};return t!==0&&console.log(`\u{1F3A8} Tavolo ${e.table_number}: applicata rotazione di ${t}\xB0`),e.is_merged&&(a.border="3px dashed #ff6b35",a.background="rgba(255, 107, 53, 0.1)"),e.is_online_bookable||(a.background="repeating-linear-gradient(45deg, var(--shadow-1), var(--shadow-2) 10px, var(--shadow-3) 10px, var(--shadow-1) 20px)"),a}getTableClass(e,r,t,a){let o=["table-element",`shape-${e.shape}`];return r?.id===e.id&&o.push("selected"),t.some(i=>i.id===e.id)&&o.push("merge-selected"),e.is_merged&&e.parent_table_id?o.push("merged-child","hidden-table"):e.merged_tables_ids&&e.merged_tables_ids.length>0&&o.push("merged-parent"),e.is_online_bookable||o.push("not-online-bookable"),o.join(" ")}generateNextTableNumber(e){let r=e.map(t=>parseInt(t.table_number)).filter(t=>!isNaN(t));return r.length>0?Math.max(...r)+1:1}rotateTable(e,r){return s(this,null,function*(){try{let t=(r%360+360)%360;console.log(`\u{1F504} Rotating table ${e} to ${t}\xB0`);let{error:a}=yield this.supabaseService.getSupabaseClient().from("tables").update({rotation:t,updated_at:new Date().toISOString()}).eq("id",e);return a?(console.error("\u274C Database error rotating table:",a),!1):(console.log(`\u2705 Table ${e} rotated successfully to ${t}\xB0`),!0)}catch(t){return console.error("\u274C Error rotating table:",t),!1}})}getAllTablesByFloorPlan(e){return this.dataSubject.value.filter(r=>r.floor_plan_id===e)}static \u0275fac=(()=>{let e;return function(t){return(e||(e=d(n)))(t||n)}})();static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{u as a};
