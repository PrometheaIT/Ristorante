import{a as P,b as F,c as u,d as I,e as T,i as N,l as O,o as R,v as D,x as A}from"./chunk-HTWH3NPU.js";import{A as M,B as k,D as L,e as y,l as E,u as S,v as C}from"./chunk-KBL2L3GY.js";import{Gb as b,Hb as g,Na as s,Qb as f,Tb as i,Ub as x,Vb as w,cb as _,f as h,ga as c,hb as d,tb as l,ub as n,vb as e,wb as p}from"./chunk-UE7YVF6I.js";function z(o,a){o&1&&(n(0,"span"),i(1,"L'email \xE8 obbligatoria"),e())}function j(o,a){o&1&&(n(0,"span"),i(1,"Inserisci un'email valida"),e())}function q(o,a){if(o&1&&(n(0,"div",37)(1,"span",11),i(2,"error"),e(),d(3,z,2,0,"span",38)(4,j,2,0,"span",38),e()),o&2){let t=g();s(3),l("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.required),s(),l("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.email)}}function B(o,a){o&1&&(n(0,"span"),i(1,"La password \xE8 obbligatoria"),e())}function Y(o,a){o&1&&(n(0,"span"),i(1,"Minimo 6 caratteri"),e())}function U(o,a){if(o&1&&(n(0,"div",37)(1,"span",11),i(2,"error"),e(),d(3,B,2,0,"span",38)(4,Y,2,0,"span",38),e()),o&2){let t=g();s(3),l("ngIf",t.password==null||t.password.errors==null?null:t.password.errors.required),s(),l("ngIf",t.password==null||t.password.errors==null?null:t.password.errors.minlength)}}function $(o,a){if(o&1&&(n(0,"div",39)(1,"span",11),i(2),e(),i(3),e()),o&2){let t=g();f("error",!t.errorMessage.includes("effettuato"))("success",t.errorMessage.includes("effettuato")),s(2),w(" ",t.errorMessage.includes("effettuato")?"check_circle":"warning"," "),s(),w(" ",t.errorMessage," ")}}function H(o,a){o&1&&p(0,"span",40)}function J(o,a){o&1&&(n(0,"span",11),i(1,"login"),e())}var G=class o{fb=c(D);authService=c(L);router=c(S);supabaseService=c(k);loginForm;isLoading=!1;errorMessage="";showPassword=!1;constructor(){this.loginForm=this.fb.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]],rememberMe:[!1]}),this.isProduction||this.prefillDemoCredentials()}onSubmit(){return h(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="";let{email:a,password:t,rememberMe:r}=this.loginForm.value;try{let m=yield this.authService.login(a,t,r);if(m.error){let v=m.error instanceof Error?m.error.message:String(m.error);this.errorMessage=this.getErrorMessage(v)}else if(m.data?.user){console.log("\u2705 Login effettuato con successo"),yield this.checkStaffMembership(a);let v=this.authService.getCurrentContext(),V={staff:"Dipendente",supplier:"Fornitore",customer:"Cliente"};this.errorMessage=`Accesso effettuato come ${V[v]}! Reindirizzamento...`,setTimeout(()=>{this.navigateBasedOnContext()},1e3)}}catch(m){console.error("Login error:",m),this.errorMessage="Errore durante il login. Riprova pi\xF9 tardi."}finally{this.isLoading=!1}})}checkStaffMembership(a){return h(this,null,function*(){try{let{data:t,error:r}=yield this.supabaseService.getSupabaseClient().from("restaurant_staff").select("*").eq("email",a.toLowerCase()).eq("is_active",!0).in("invitation_status",["accepted","active"]);t&&t.length>0&&console.log("\u{1F3AF} Utente trovato come staff member:",t)}catch{console.log("\u2139\uFE0F Utente non \xE8 staff member o errore nel controllo")}})}navigateBasedOnContext(){switch(this.authService.getCurrentContext()){case"staff":this.router.navigate(["/restaurant/dashboard"]);break;case"supplier":this.router.navigate(["/supplier/dashboard"]);break;case"customer":default:this.router.navigate(["/customer"]);break}}togglePasswordVisibility(){this.showPassword=!this.showPassword}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(a=>{this.loginForm.get(a)?.markAsTouched()})}getErrorMessage(a){return{"Invalid login credentials":"Email o password non validi.","Email not confirmed":"Email non confermata. Controlla la tua casella di posta.","Invalid email":"Email non valida.","Network error":"Errore di rete. Controlla la tua connessione.","Email rate limit exceeded":"Troppi tentativi. Riprova pi\xF9 tardi."}[a]||`Errore: ${a}`}prefillDemoCredentials(){console.log("Modalit\xE0 sviluppo: credenziali demo disponibili")}useDemoCredentials(a){a==="restaurant"?this.loginForm.patchValue({email:"ristorante@demo.com",password:"demodemo"}):this.loginForm.patchValue({email:"cliente@demo.com",password:"demodemo"})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}get isProduction(){return M.production}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=_({type:o,selectors:[["app-login"]],decls:65,vars:14,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","440px","width","100%","margin","var(--gutter-xl) auto"],[1,"section-header",2,"border-bottom","2px solid var(--smoke-color-1)","padding-bottom","var(--gutter-lg)","text-align","center"],[2,"display","flex","flex-direction","column","align-items","center","gap","var(--gutter-md)","width","100%"],[1,"material-icons",2,"font-size","var(--fs-lg)","color","var(--coloretitlenav)"],[1,"section-titles"],[2,"margin","0","font-size","var(--fs-md)","color","var(--coloretitlenav)"],[1,"text-muted",2,"margin","0"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","email",1,"form-label"],[1,"material-icons"],["id","email","formControlName","email","type","email","placeholder","tua.email@esempio.com"],["class","status-message error",4,"ngIf"],["for","password",1,"form-label"],[2,"position","relative"],["id","password","formControlName","password","placeholder","La tua password",2,"padding-right","50px",3,"type"],["type","button",1,"icon-button",2,"position","absolute","right","var(--gutter-sm)","top","50%","transform","translateY(-50%)","background","none","border","none","color","var(--text-muted)","cursor","pointer",3,"click"],[2,"display","flex","justify-content","space-between","align-items","center","margin","var(--gutter-md) 0"],[1,"checkbox-label"],["id","rememberMe","formControlName","rememberMe","type","checkbox"],["routerLink","/forgot-password",1,"link",2,"font-size","var(--fs-sm)","display","none"],["class","status-message",3,"error","success",4,"ngIf"],["type","submit",1,"promethea-button",2,"width","100%","margin-top","var(--gutter-md)",3,"disabled"],["class","loading-spinner","style","width: 16px; height: 16px; border-width: 2px;",4,"ngIf"],["class","material-icons",4,"ngIf"],[1,"form-footer",2,"margin","var(--gutter-lg) 0"],[2,"display","flex","align-items","center","gap","var(--gutter-md)","width","100%"],[2,"flex","1","height","1px","background","var(--smoke-color-1)"],[1,"text-muted",2,"font-size","var(--fs-sm)"],[2,"text-align","center"],[1,"text-muted",2,"margin-bottom","var(--gutter-md)"],[1,"actions-container"],["routerLink","/register/restaurant",1,"promethea-button","outline",2,"justify-content","center"],["routerLink","/register/supplier",1,"promethea-button","secondary",2,"justify-content","center"],[1,"actions-container",2,"margin-top","var(--gutter-md)","align-items","center","flex-direction","column"],["routerLink","/register/customer",1,"promethea-button","secondary",2,"justify-content","center"],[1,"status-message","error"],[4,"ngIf"],[1,"status-message"],[1,"loading-spinner",2,"width","16px","height","16px","border-width","2px"]],template:function(t,r){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),i(5,"restaurant"),e(),n(6,"div",5)(7,"h1",6),i(8,"Bentornato"),e(),n(9,"p",7),i(10,"Accedi al tuo account"),e()()()(),n(11,"form",8),b("ngSubmit",function(){return r.onSubmit()}),n(12,"div",9)(13,"label",10)(14,"span",11),i(15,"email"),e(),i(16," Email * "),e(),p(17,"input",12),d(18,q,5,2,"div",13),e(),n(19,"div",9)(20,"label",14)(21,"span",11),i(22,"lock"),e(),i(23," Password * "),e(),n(24,"div",15),p(25,"input",16),n(26,"button",17),b("click",function(){return r.togglePasswordVisibility()}),n(27,"span",11),i(28),e()()(),d(29,U,5,2,"div",13),e(),n(30,"div",18)(31,"label",19),p(32,"input",20),i(33," Ricordami "),e(),n(34,"a",21),i(35," Password dimenticata? "),e()(),d(36,$,4,6,"div",22),n(37,"button",23),d(38,H,1,0,"span",24)(39,J,2,0,"span",25),n(40,"span"),i(41),e()(),n(42,"div",26)(43,"div",27),p(44,"div",28),n(45,"span",29),i(46,"oppure"),e(),p(47,"div",28),e()(),n(48,"div",30)(49,"p",31),i(50," Non hai un account? "),e(),n(51,"div",32)(52,"a",33)(53,"span",11),i(54,"restaurant"),e(),i(55," Registra Ristorante "),e(),n(56,"a",34)(57,"span",11),i(58,"local_shipping"),e(),i(59," Registrati come Fornitore "),e()(),n(60,"div",35)(61,"a",36)(62,"span",11),i(63,"person"),e(),i(64," Registrati come Cliente "),e()()()()()()),t&2&&(s(11),l("formGroup",r.loginForm),s(6),f("error",(r.email==null?null:r.email.invalid)&&(r.email==null?null:r.email.touched)),s(),l("ngIf",(r.email==null?null:r.email.invalid)&&(r.email==null?null:r.email.touched)),s(7),f("error",(r.password==null?null:r.password.invalid)&&(r.password==null?null:r.password.touched)),l("type",r.showPassword?"text":"password"),s(3),x(r.showPassword?"visibility_off":"visibility"),s(),l("ngIf",(r.password==null?null:r.password.invalid)&&(r.password==null?null:r.password.touched)),s(7),l("ngIf",r.errorMessage),s(),l("disabled",r.isLoading||r.loginForm.invalid),s(),l("ngIf",r.isLoading),s(),l("ngIf",!r.isLoading),s(2),x(r.isLoading?"Accesso in corso...":"Accedi"))},dependencies:[E,y,A,N,F,P,I,T,O,R,C],styles:["[_nghost-%COMP%]{display:block;width:100%}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 3px color-mix(in srgb,#ef4444 20%,transparent)}@media (max-width: 768px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}}input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted);opacity:.7}input[_ngcontent-%COMP%]:focus{border-color:var(--primary);box-shadow:0 0 0 3px color-mix(in srgb,var(--primary) 20%,transparent);transform:translateY(-1px)}.password-toggle[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;position:absolute;right:var(--gutter-sm);top:50%;transform:translateY(-50%)}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary);background:var(--smoke-color-1)}@media (max-width: 480px){.form-card[_ngcontent-%COMP%]{margin:var(--gutter-md) auto;border-radius:16px}.section-header[_ngcontent-%COMP%]{padding:var(--gutter-md)}}"]})};export{G as Login};
