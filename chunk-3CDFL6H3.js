import{a as D}from"./chunk-R4HKTFGP.js";import{ya as P,za as G}from"./chunk-KZMQ65O4.js";import{b as M,c as v,d as N,e as T,i as V,m as z,p as L,w as A,y as O}from"./chunk-PZ6IGEMS.js";import"./chunk-HOOEJZZY.js";import"./chunk-37GYPR4T.js";import{j as I,k,s as C}from"./chunk-PWZZTUE6.js";import{$a as g,Eb as b,Ga as a,Gb as w,Hb as n,Ib as d,Jb as y,Wa as F,ba as h,ha as c,hb as p,ia as u,ib as i,jb as t,kb as _,qb as E,tb as m,vb as f}from"./chunk-DU5L5MFQ.js";import{j as S}from"./chunk-4ZZIO3ZI.js";function q(s,r){s&1&&(i(0,"tr")(1,"td",20)(2,"div",21)(3,"span",22),n(4,"refresh"),t(),i(5,"span"),n(6,"Caricamento fornitori..."),t()()()())}function $(s,r){if(s&1){let e=E();i(0,"tr",23)(1,"td")(2,"strong"),n(3),t()(),i(4,"td")(5,"span",24),n(6),t()(),i(7,"td")(8,"span",24),n(9),t()(),i(10,"td")(11,"span",24),n(12),t()(),i(13,"td")(14,"span",24),n(15),t()(),i(16,"td")(17,"span",25),n(18),t()(),i(19,"td")(20,"div",2)(21,"button",26),m("click",function(){let l=c(e).$implicit,x=f();return u(x.editSupplier(l))}),i(22,"span",14),n(23,"edit"),t()(),i(24,"button",27),m("click",function(){let l=c(e).$implicit,x=f();return u(x.deleteSupplier(l.id))}),i(25,"span",14),n(26,"delete"),t()()()()()}if(s&2){let e=r.$implicit;a(3),d(e.company_name),a(3),d(e.contact_name||"Nessun contatto"),a(3),d(e.email||"Nessuna email"),a(3),d(e.phone||"Nessun telefono"),a(3),d(e.address||"Nessun indirizzo"),a(2),w(e.is_platform_supplier?"active":"warning"),a(),y(" ",e.is_platform_supplier?"Piattaforma":"Locale"," ")}}function B(s,r){s&1&&(i(0,"tr")(1,"td",28)(2,"div",29)(3,"span",14),n(4,"local_shipping"),t(),i(5,"h3"),n(6,"Nessun fornitore trovato"),t()()()())}function R(s,r){s&1&&(i(0,"div",57),n(1," Il nome dell'azienda \xE8 obbligatorio "),t())}function H(s,r){s&1&&(i(0,"div",57),n(1," Inserisci un indirizzo email valido "),t())}function J(s,r){if(s&1){let e=E();i(0,"div",30),m("click",function(){c(e);let l=f();return u(l.resetForm())}),i(1,"div",31),m("click",function(l){return c(e),u(l.stopPropagation())}),i(2,"div",32)(3,"div",33)(4,"div",34)(5,"span",14),n(6),t()(),i(7,"div")(8,"h1",4),n(9),t()()(),i(10,"button",35),m("click",function(){c(e);let l=f();return u(l.resetForm())}),i(11,"span",14),n(12,"close"),t()()(),i(13,"div",36)(14,"form",37),m("ngSubmit",function(){c(e);let l=f();return u(l.onSubmit())}),i(15,"div",38)(16,"div",39)(17,"label",40)(18,"span",14),n(19,"business"),t(),n(20," Nome Azienda * "),t(),_(21,"input",41),g(22,R,2,0,"div",42),t(),i(23,"div",39)(24,"label",43),_(25,"lucide-angular",44),n(26," Nome Contatto "),t(),_(27,"input",45),t()(),i(28,"div",46)(29,"div",39)(30,"label",47),_(31,"lucide-angular",48),n(32," Email "),t(),_(33,"input",49),g(34,H,2,0,"div",42),t(),i(35,"div",39)(36,"label",50)(37,"span",14),n(38,"phone"),t(),n(39," Telefono "),t(),_(40,"input",51),t()(),i(41,"div",39)(42,"label",52)(43,"span",14),n(44,"place"),t(),n(45," Indirizzo "),t(),_(46,"textarea",53),t()()(),i(47,"div",54)(48,"button",55),m("click",function(){c(e);let l=f();return u(l.resetForm())}),i(49,"span",14),n(50,"close"),t(),n(51," Annulla "),t(),i(52,"button",56),m("click",function(){c(e);let l=f();return u(l.onSubmit())}),i(53,"span",14),n(54),t(),n(55),t()()()()}if(s&2){let e=f();a(6),d(e.isEditing?"edit":"add_circle"),a(3),d(e.isEditing?"Modifica Fornitore":"Nuovo Fornitore"),a(5),p("formGroup",e.supplierForm),a(7),b("border-red-500",(e.company_name==null?null:e.company_name.invalid)&&(e.company_name==null?null:e.company_name.touched)),a(),p("ngIf",(e.company_name==null?null:e.company_name.invalid)&&(e.company_name==null?null:e.company_name.touched)),a(3),p("size",20),a(6),p("size",20),a(2),b("border-red-500",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),a(),p("ngIf",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),a(18),p("disabled",e.supplierForm.invalid),a(2),d(e.isEditing?"save":"add"),a(),y(" ",e.isEditing?"Aggiorna":"Crea"," Fornitore ")}}var j=class s{supplierService=h(D);fb=h(A);suppliers=[];showSupplierForm=!1;isEditing=!1;currentSupplierId=null;supplierForm;isLoading=!0;constructor(){this.supplierForm=this.fb.group({company_name:["",[v.required,v.minLength(2)]],contact_name:[""],email:["",[v.email]],phone:[""],address:[""]})}ngOnInit(){return S(this,null,function*(){yield this.loadSuppliers()})}loadSuppliers(){return S(this,null,function*(){this.isLoading=!0;try{yield this.supplierService.loadSuppliers(),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r,this.isLoading=!1})}catch(r){console.error("Error loading suppliers:",r),this.isLoading=!1}})}onSubmit(){return S(this,null,function*(){if(this.supplierForm.invalid){this.markFormGroupTouched();return}try{this.isEditing&&this.currentSupplierId?(yield this.updateSupplier(this.currentSupplierId,this.supplierForm.value))&&(console.log("Fornitore aggiornato con successo"),this.resetForm()):(yield this.supplierService.createSupplier(this.supplierForm.value))&&(console.log("Fornitore creato con successo"),this.resetForm())}catch(r){console.error("Errore durante il salvataggio:",r)}})}updateSupplier(r,e){return S(this,null,function*(){try{let{data:o,error:l}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").update(e).eq("id",r).select().single();if(l)throw l;return yield this.loadSuppliers(),!0}catch(o){return console.error("Error updating supplier:",o),!1}})}deleteSupplier(r){return S(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questo fornitore?"))try{let{error:e}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").delete().eq("id",r);if(e)throw e;yield this.loadSuppliers(),console.log("Fornitore eliminato")}catch(e){console.error("Error deleting supplier:",e)}})}editSupplier(r){this.isEditing=!0,this.currentSupplierId=r.id,this.supplierForm.patchValue({company_name:r.company_name,contact_name:r.contact_name||"",email:r.email||"",phone:r.phone||"",address:r.address||""}),this.showSupplierForm=!0}newSupplier(){this.resetForm(),this.showSupplierForm=!0,this.isEditing=!1}resetForm(){this.supplierForm.reset({company_name:"",contact_name:"",email:"",phone:"",address:""}),this.isEditing=!1,this.currentSupplierId=null,this.showSupplierForm=!1}markFormGroupTouched(){Object.keys(this.supplierForm.controls).forEach(r=>{this.supplierForm.get(r)?.markAsTouched()})}get company_name(){return this.supplierForm.get("company_name")}get email(){return this.supplierForm.get("email")}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=F({type:s,selectors:[["app-supplier-manager"]],decls:45,vars:5,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],["name","truck"],[1,"section-title"],[1,"grid-cards","p-sm"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"text-muted","card-footer"],[1,"p-md0","modal-footer"],[1,"promethea-button",3,"click"],[1,"material-icons"],[1,"table-section","p-sm"],[1,"crm-table"],[4,"ngIf"],["class","supplier-row",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"text-center","p-xl"],[1,"flex","flex-col","items-center","justify-center","gap-md"],[1,"material-icons","animate-spin"],[1,"supplier-row"],[1,"text-muted"],[1,"chip"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state-row"],[1,"empty-state","p-md0"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"flex"],[1,"header-icon"],[1,"icon-button",3,"click"],[1,"modal-content"],[1,"form-card",3,"ngSubmit","formGroup"],[1,"grid-form","gap-md","mt-lg"],[1,"flex","flex-col","gap-sm"],["for","company_name",1,"standard-label"],["id","company_name","formControlName","company_name","type","text","placeholder","Es: Fornitore Srl"],["class","text-red-500 text-sm",4,"ngIf"],["for","contact_name",1,"standard-label"],["name","user",1,"nav-icon",3,"size"],["id","contact_name","formControlName","contact_name","type","text","placeholder","Nome del referente"],[1,"grid-form","gap-md"],["for","email",1,"standard-label"],["name","mail",1,"nav-icon",3,"size"],["id","email","formControlName","email","type","email","placeholder","email@fornitore.com"],["for","phone",1,"standard-label"],["id","phone","formControlName","phone","type","tel","placeholder","+39 012 345 6789"],["for","address",1,"standard-label"],["id","address","formControlName","address","rows","2","placeholder","Indirizzo completo del fornitore"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"click","disabled"],[1,"text-red-500","text-sm"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),_(3,"lucide-angular",3),i(4,"h1",4),n(5,"Fornitori"),t()()(),i(6,"div",5)(7,"div",6)(8,"div",7)(9,"span",8),n(10,"business"),t(),i(11,"h3",9),n(12,"Fornitori Totali"),t()(),i(13,"div",10),n(14),t(),i(15,"span",11),n(16,"Fornitori registrati"),t()()(),i(17,"div",12)(18,"button",13),m("click",function(){return o.newSupplier()}),i(19,"span",14),n(20,"add"),t(),n(21," Nuovo Fornitore "),t()(),i(22,"div",15)(23,"table",16)(24,"thead")(25,"tr")(26,"th"),n(27,"Nome Azienda"),t(),i(28,"th"),n(29,"Contatto"),t(),i(30,"th"),n(31,"Email"),t(),i(32,"th"),n(33,"Telefono"),t(),i(34,"th"),n(35,"Indirizzo"),t(),i(36,"th"),n(37,"Tipo"),t(),i(38,"th"),n(39,"Azioni"),t()()(),i(40,"tbody"),g(41,q,7,0,"tr",17)(42,$,27,8,"tr",18)(43,B,7,0,"tr",17),t()()()(),g(44,J,56,14,"div",19)),e&2&&(a(14),d(o.suppliers.length),a(27),p("ngIf",o.isLoading),a(),p("ngForOf",o.suppliers),a(),p("ngIf",!o.isLoading&&o.suppliers.length===0),a(),p("ngIf",o.showSupplierForm))},dependencies:[C,I,k,O,V,M,N,T,z,L,G,P],styles:[".supplier-row[_ngcontent-%COMP%]{transition:all .2s ease}.supplier-row[_ngcontent-%COMP%]:hover{background:var(--smoke-1)}"]})};export{j as SupplierManager};
