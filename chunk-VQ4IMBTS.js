import{a as ee}from"./chunk-3IY4UHOG.js";import{a as te,b as ie}from"./chunk-LKHJ66WT.js";import"./chunk-GKNZLVDN.js";import"./chunk-5BFIQ7BP.js";import{b as W,d as Q,h as G,p as H,q as J,r as X,w as Y}from"./chunk-77SKEQNN.js";import{a as Z}from"./chunk-ACSXOFRZ.js";import{a as L}from"./chunk-KNL3CWA3.js";import{A as j,d as $,e as B,i as q,k as U}from"./chunk-DCWKKS33.js";import{$ as O,$b as K,Db as g,E as F,Eb as l,La as c,Lb as E,Mb as A,Pb as I,Qb as s,Rb as b,Sb as p,Tb as C,Vb as M,Wb as P,Xb as T,ab as V,bc as R,ea as y,ec as D,f as _,fb as u,ja as f,ka as v,qb as m,rb as r,sb as n,tb as z,zb as S}from"./chunk-K5RDB55Y.js";var k=class a{statusConfig={waiting:{label:"In Attesa",color:"warning",icon:"schedule"},preparing:{label:"In Preparazione",color:"primary",icon:"kitchen"},ready:{label:"Pronto",color:"success",icon:"done"},served:{label:"Servito",color:"secondary",icon:"local_shipping"},out_of_stock:{label:"Esaurito",color:"danger",icon:"block"}};getStatusConfig(e){return this.statusConfig[e]||this.statusConfig.waiting}calculateElapsedTime(e){let t=new Date(e).getTime(),i=new Date().getTime();return Math.floor((i-t)/(1e3*60))}getPreparationTimeColor(e,t){let i=e/t*100;return i<50?"success":i<75?"warning":"danger"}formatTime(e){return new Date(e).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=O({token:a,factory:a.\u0275fac,providedIn:"root"})};var w=class a{validTransitions={waiting:["preparing","out_of_stock"],preparing:["ready","out_of_stock"],ready:["served"],served:[],out_of_stock:[]};canTransition(e,t){let i=this.validTransitions[e];return i?i.includes(t):!1}getNextValidStatuses(e){return this.validTransitions[e]||[]}static \u0275fac=function(t){return new(t||a)};static \u0275prov=O({token:a,factory:a.\u0275fac,providedIn:"root"})};function oe(a,e){a&1&&(r(0,"div",33)(1,"span",5),s(2,"restaurant_menu"),n(),r(3,"h3"),s(4,"Nessun ordine attivo"),n(),r(5,"p",8),s(6,"Tutti gli ordini sono stati completati"),n()())}function de(a,e){if(a&1&&(r(0,"span",67),s(1),n()),a&2){let t=l().$implicit,i=l(2);c(),p(" (",t.preparation_time-i.getElapsedTime(t)," min rimanenti) ")}}function ce(a,e){if(a&1&&(r(0,"div",68)(1,"small"),s(2),n()()),a&2){let t=l().$implicit;c(2),b(t.notes)}}function le(a,e){if(a&1){let t=S();r(0,"button",69),g("click",function(){f(t);let o=l().$implicit,d=l(2);return v(d.updateItemStatus(o,"preparing"))}),r(1,"span",5),s(2,"play_arrow"),n(),s(3," Inizia "),n()}}function me(a,e){if(a&1){let t=S();r(0,"button",70),g("click",function(){f(t);let o=l().$implicit,d=l(2);return v(d.updateItemStatus(o,"ready"))}),r(1,"span",5),s(2,"check"),n(),s(3," Pronto "),n()}}function pe(a,e){if(a&1){let t=S();r(0,"button",71),g("click",function(){f(t);let o=l().$implicit,d=l(2);return v(d.updateItemStatus(o,"served"))}),r(1,"span",5),s(2,"local_shipping"),n(),s(3," Servito "),n()}}function ue(a,e){if(a&1){let t=S();r(0,"div",49)(1,"div",50)(2,"div",51)(3,"h4",52),s(4),n(),r(5,"div",53)(6,"span",54),s(7),n(),r(8,"span",55)(9,"span",5),s(10,"schedule"),n(),s(11),n(),r(12,"span",56),s(13),u(14,de,2,1,"span",57),n()(),u(15,ce,3,1,"div",58),n(),r(16,"div",59)(17,"span",60),s(18),n(),r(19,"div",61),u(20,le,4,0,"button",62)(21,me,4,0,"button",63)(22,pe,4,0,"button",64),r(23,"button",65),g("click",function(){let o=f(t).$implicit,d=l(2);return v(d.openRecipeModal(o))}),r(24,"span",5),s(25,"menu_book"),n(),s(26," Ricetta "),n(),r(27,"button",66),g("click",function(){let o=f(t).$implicit,d=l(2);return v(d.markItemAsOutOfStock(o))}),r(28,"span",5),s(29,"block"),n(),s(30," Esaurito "),n()()()()()}if(a&2){let t=e.$implicit,i=l(2);I("status-"+t.status),c(4),b(t.dish_name),c(3),p("x",t.quantity),c(4),p(" ",t.preparation_time," min "),c(),I(i.getPreparationTimeColor(i.getElapsedTime(t),t.preparation_time)),c(),C(" ",i.getElapsedTime(t),"/",t.preparation_time," min "),c(),m("ngIf",t.status==="preparing"),c(),m("ngIf",t.notes),c(2),I(i.getStatusColor(t.status)),c(),p(" ",i.getStatusText(t.status)," "),c(2),m("ngIf",t.status==="waiting"),c(),m("ngIf",t.status==="preparing"),c(),m("ngIf",t.status==="ready"),c(5),m("disabled",t.status==="out_of_stock")}}function ge(a,e){if(a&1){let t=S();r(0,"div",72)(1,"button",73),g("click",function(){f(t);let o=l().$implicit,d=l();return v(d.markOrderAsReady(o))}),r(2,"span",5),s(3,"done_all"),n(),s(4," Segna tutto come pronto "),n()()}if(a&2){let t=l().$implicit;c(),m("disabled",t.status==="ready")}}function _e(a,e){if(a&1&&(r(0,"div",34)(1,"div",12)(2,"div",35)(3,"div",36)(4,"div",7),s(5),n(),r(6,"div",37)(7,"span",38),s(8),n(),r(9,"span",39),s(10),n(),r(11,"span",40),s(12),n()()(),r(13,"div",41)(14,"div",42)(15,"span"),s(16),n(),r(17,"span",43),s(18),K(19,"number"),n()(),r(20,"div",44),z(21,"div",45),n()()()(),r(22,"div",11)(23,"div",46),u(24,ue,31,18,"div",47),n(),u(25,ge,5,1,"div",48),n()()),a&2){let t=e.$implicit,i=l();c(5),p("Ordine #",t.order_number),c(3),p("Tavolo ",t.table_number),c(2),b(i.formatTime(t.created_at)),c(),I(i.getStatusColor(t.status)),c(),p(" ",i.getStatusText(t.status)," "),c(4),C("",t.completed_items,"/",t.total_items," piatti"),c(2),p("",R(19,15,t.progress_percentage,"1.0-0"),"%"),c(3),I(i.getStatusColor(t.status)),A("width",t.progress_percentage,"%"),c(3),m("ngForOf",i.getNonServedItems(t.items)),c(),m("ngIf",t.items.length>0)}}function he(a,e){if(a&1&&(r(0,"div",97),s(1),K(2,"number"),n()),a&2){let t=l().$implicit,i=l(4);c(),p(" Costo: \u20AC",R(2,1,i.getIngredientCost(t),"1.2-2")," ")}}function fe(a,e){if(a&1&&(r(0,"div",98)(1,"label",18)(2,"span",5),s(3,"notes"),n(),s(4," Note di preparazione: "),n(),r(5,"div",99),s(6),n()()),a&2){let t=l().$implicit,i=l(4);c(6),p(" ",i.getIngredientNotes(t)," ")}}function ve(a,e){if(a&1&&(r(0,"div",90)(1,"div",91)(2,"div",92)(3,"strong",93),s(4),n(),r(5,"span",94),s(6),n()(),u(7,he,3,4,"div",95),n(),u(8,fe,7,1,"div",96),n()),a&2){let t=e.$implicit,i=l(4);c(4),p(" ",i.getIngredientName(t)," "),c(2),C(" ",i.getIngredientQuantity(t)," ",i.getIngredientUnit(t)," "),c(),m("ngIf",i.getIngredientCost(t)>0),c(),m("ngIf",i.getIngredientNotes(t))}}function xe(a,e){if(a&1&&(r(0,"div",88),u(1,ve,9,5,"div",89),n()),a&2){let t=l(3);c(),m("ngForOf",t.getRecipe(t.selectedRecipeItem.dish_id))}}function ye(a,e){a&1&&(r(0,"div",33)(1,"span",5),s(2,"info"),n(),r(3,"p"),s(4,"Nessun ingrediente definito per questo piatto"),n()())}function be(a,e){if(a&1&&(r(0,"div",83)(1,"h4",84)(2,"span",5),s(3,"menu_book"),n(),s(4," Istruzioni di Preparazione "),n(),r(5,"div",100)(6,"p"),s(7),n()()()),a&2){let t=l(3);c(7),b(t.getRecipeInstructions(t.selectedRecipeItem.dish_id))}}function Se(a,e){a&1&&(r(0,"div",33)(1,"span",5),s(2,"info"),n(),r(3,"p"),s(4,"Nessuna istruzione di preparazione disponibile"),n()())}function Ie(a,e){if(a&1&&(r(0,"div")(1,"div",83)(2,"h4",84)(3,"span",5),s(4,"list_alt"),n(),s(5," Ingredienti "),r(6,"span",85),s(7),n()(),u(8,xe,2,1,"div",86)(9,ye,5,0,"ng-template",null,1,D),n(),u(11,be,8,1,"div",87)(12,Se,5,0,"div",30),n()),a&2){let t=E(10),i=l(2);c(7),p(" ",i.getRecipe(i.selectedRecipeItem.dish_id).length," "),c(),m("ngIf",i.getRecipe(i.selectedRecipeItem.dish_id).length>0)("ngIfElse",t),c(3),m("ngIf",i.getRecipeInstructions(i.selectedRecipeItem.dish_id)!=="Nessuna istruzione disponibile"),c(),m("ngIf",!i.getRecipeInstructions(i.selectedRecipeItem.dish_id))}}function Oe(a,e){a&1&&(r(0,"div",33)(1,"span",5),s(2,"info"),n(),r(3,"p"),s(4,"Nessuna ricetta disponibile per questo piatto"),n()())}function Ce(a,e){if(a&1){let t=S();r(0,"div",74),g("click",function(){f(t);let o=l();return v(o.closeRecipeModal())}),r(1,"div",75),g("click",function(o){return f(t),v(o.stopPropagation())}),r(2,"div",76)(3,"h2",77)(4,"span",5),s(5,"menu_book"),n(),s(6),r(7,"span",78),s(8),n()(),r(9,"button",79),g("click",function(){f(t);let o=l();return v(o.closeRecipeModal())}),r(10,"span",5),s(11,"close"),n()()(),r(12,"div",80),u(13,Ie,13,5,"div",81)(14,Oe,5,0,"ng-template",null,0,D),n(),r(16,"div",82)(17,"button",28),g("click",function(){f(t);let o=l();return v(o.closeRecipeModal())}),r(18,"span",5),s(19,"close"),n(),s(20," Chiudi "),n()()()()}if(a&2){let t=E(15),i=l();c(6),p(" Ricetta - ",i.selectedRecipeItem==null?null:i.selectedRecipeItem.dish_name," "),c(2),p(" ",i.selectedRecipeItem==null?null:i.selectedRecipeItem.preparation_time," min "),c(5),m("ngIf",i.selectedRecipeItem)("ngIfElse",t)}}var re=class a{supabaseService=y(j);orderService=y(ie);dishService=y(Z);tableService=y(ee);authService=y(L);kitchenUtils=y(k);orderStatusService=y(w);notificationService=y(te);notificationSubscription;kitchenOrders=[];filteredOrders=[];selectedTableStatus=null;statusFilter="all";searchTerm="";refreshSubscription;timers={};elapsedTimes={};showRecipeModal=!1;selectedRecipeItem=null;get waitingOrdersCount(){return this.kitchenOrders.filter(e=>this.getNonServedItems(e.items).some(i=>i.status==="waiting")).length}get preparingOrdersCount(){return this.kitchenOrders.filter(e=>this.getNonServedItems(e.items).some(i=>i.status==="preparing")).length}get readyOrdersCount(){return this.kitchenOrders.filter(e=>this.getNonServedItems(e.items).some(i=>i.status==="ready")).length}get totalActiveOrders(){return this.kitchenOrders.filter(e=>this.getNonServedItems(e.items).length>0).length}ngOnInit(){console.log("\u{1F3C1} KitchenDisplay initialized"),this.loadKitchenData(),this.refreshSubscription=F(3e4).subscribe(()=>{this.loadKitchenData()}),this.notificationSubscription=this.notificationService.orderUpdates$.subscribe(e=>{e==="refresh_all"?this.loadKitchenData():this.refreshSingleOrder(e)})}ngOnDestroy(){this.refreshSubscription&&this.refreshSubscription.unsubscribe(),this.notificationSubscription&&this.notificationSubscription.unsubscribe(),Object.keys(this.timers).forEach(e=>{clearInterval(this.timers[e])}),this.timers={}}refreshSingleOrder(e){return _(this,null,function*(){try{let{data:t,error:i}=yield this.supabaseService.getSupabaseClient().from("orders").select(`
          *,
          order_items (*, dishes(name, preparation_time)),
          tables(table_number)
        `).eq("id",e).single();if(i)throw i;let o=this.kitchenOrders.findIndex(d=>d.id===e);if(o!==-1){let d=yield this.transformOrderForKitchen(t);this.kitchenOrders[o]=d,this.applyFilters()}}catch(t){console.error("Error refreshing single order:",t)}})}loadKitchenData(){return _(this,null,function*(){try{console.log("\u{1F504} Loading kitchen data..."),yield Promise.all([this.loadActiveKitchenOrders(),this.dishService.loadDishes(),this.tableService.loadData()]),console.log("\u2705 Kitchen data loaded successfully")}catch(e){console.error("\u{1F4A5} Error loading kitchen data:",e)}})}loadActiveKitchenOrders(){return _(this,null,function*(){try{let e=yield this.orderService.loadActiveOrders();console.log("\u{1F50D} Active orders for kitchen:",e.length);let t=new Map;this.kitchenOrders.forEach(i=>{i.items.forEach(o=>{t.set(o.id,o.status)})}),this.kitchenOrders=yield Promise.all(e.map(i=>_(this,null,function*(){return yield this.transformOrderForKitchen(i)}))),this.kitchenOrders.forEach(i=>{i.items.forEach(o=>{let d=t.get(o.id);d&&d!=="waiting"&&(o.status=d)}),i.status=this.determineOverallOrderStatus(i.items,i.status)}),this.kitchenOrders.sort((i,o)=>new Date(i.created_at).getTime()-new Date(o.created_at).getTime()),this.applyFilters()}catch(e){console.error("\u274C Error loading kitchen orders:",e),this.kitchenOrders=[]}})}transformOrderForKitchen(e){return _(this,null,function*(){let t=e.order_items||[],i=e.tables||{},o=yield Promise.all(t.map(x=>_(this,null,function*(){let N=this.dishService.getDishById(x.dish_id)||x.dishes,se=x.status||"waiting",ae=this.kitchenUtils.calculateElapsedTime(x.created_at||e.created_at);return{id:x.id,dish_id:x.dish_id,dish_name:x.dish_name||N?.name||"Piatto sconosciuto",quantity:x.quantity,status:se,order_id:e.id,table_number:i?.table_number||"N/A",table_id:e.table_id,preparation_time:N?.preparation_time||15,elapsed_time:ae,notes:x.item_notes,created_at:x.created_at||e.created_at}}))),d=this.orderService.getOrderProgress(o),h=this.orderService.calculateOverallOrderStatus(o);return{id:e.id,order_number:e.order_number,table_id:e.table_id,table_number:i?.table_number||"N/A",status:h,items:o,created_at:e.created_at,total_items:d.total,completed_items:d.completed,progress_percentage:d.percentage}})}determineOverallOrderStatus(e,t){return e.length===0?t:e.every(h=>h.status==="ready"||h.status==="served")?"ready":e.some(h=>h.status==="preparing")||e.some(h=>h.status==="ready")?"preparing":t}getTableById(e){return _(this,null,function*(){return e?this.tableService.getTables().find(i=>i.id===e):null})}getStatusText(e){return this.kitchenUtils.getStatusConfig(e).label}getStatusColor(e){return this.kitchenUtils.getStatusConfig(e).color}getPreparationTimeColor(e,t){return this.kitchenUtils.getPreparationTimeColor(e,t)}formatTime(e){return this.kitchenUtils.formatTime(e)}updateItemStatus(e,t){return _(this,null,function*(){try{let i;if(typeof t=="string"?i=t:i=t.target.value,console.log(`\u{1F504} Tentativo transizione da ${e.status} a ${i}`),!this.orderStatusService.canTransition(e.status,i)){console.warn(`\u274C Transizione non valida da ${e.status} a ${i}`),alert(`Transizione non valida! Da "${this.getStatusText(e.status)}" a "${this.getStatusText(i)}"`);return}console.log(`\u2705 Transizione valida, aggiornamento item ${e.id} a ${i}`);let o=e.status;e.status=i;let d=!1;try{d=yield this.orderService.updateOrderItemStatus(e.id,i),d||(console.log("\u{1F504} Trying fallback update..."),d=yield this.orderService.updateOrderItemStatusDirect(e.id,i))}catch{console.error("\u274C Primary update failed, trying fallback..."),d=yield this.orderService.updateOrderItemStatusDirect(e.id,i)}if(!d)throw e.status=o,new Error("Failed to update status in database after multiple attempts");if((i==="ready"||i==="served"||i==="out_of_stock")&&this.stopTimer(e.id),i==="preparing"&&(this.elapsedTimes[e.id]=this.kitchenUtils.calculateElapsedTime(e.created_at),this.startTimer(e)),i==="out_of_stock"){let h=this.dishService.getDishById(e.dish_id);h&&(yield this.dishService.updateDish(h.id,{status:"out_of_stock"}))}this.updateLocalOrderStatus(e.order_id),this.notificationService.notifyOrderUpdate(e.order_id),console.log("\u2705 Item status updated successfully")}catch(i){console.error("\u274C Error updating item status:",i),alert("Errore durante l'aggiornamento dello stato. Riprova.")}})}debugTableStructure(){return _(this,null,function*(){yield this.orderService.checkTableStructure()})}getNextValidStatuses(e){return this.orderStatusService.getNextValidStatuses(e)}startTimer(e){this.timers[e.id]&&clearInterval(this.timers[e.id]),this.timers[e.id]=setInterval(()=>{this.elapsedTimes[e.id]===void 0?this.elapsedTimes[e.id]=this.kitchenUtils.calculateElapsedTime(e.created_at):this.elapsedTimes[e.id]++,this.elapsedTimes[e.id]>=e.preparation_time&&e.status==="preparing"&&this.autoCompletePreparation(e)},6e4)}stopTimer(e){this.timers[e]&&(clearInterval(this.timers[e]),delete this.timers[e])}autoCompletePreparation(e){console.log(`\u23F0 Auto-completing preparation for ${e.dish_name}`),this.updateItemStatus(e,"ready")}updateLocalOrderStatus(e){let t=this.kitchenOrders.find(i=>i.id===e);if(t){let i=this.getNonServedItems(t.items);if(i.length===0){this.kitchenOrders=this.kitchenOrders.filter(d=>d.id!==e),this.applyFilters();return}t.status=this.determineOverallOrderStatus(i,t.status);let o=i.filter(d=>d.status==="ready"||d.status==="served").length;t.completed_items=o,t.total_items=i.length,t.progress_percentage=t.total_items>0?o/t.total_items*100:0}}getElapsedTime(e){return this.elapsedTimes[e.id]!==void 0?this.elapsedTimes[e.id]:this.kitchenUtils.calculateElapsedTime(e.created_at)}getNonServedItems(e){return e.filter(t=>t.status!=="served")}applyFilters(){let e=this.kitchenOrders;if(this.statusFilter!=="all"&&(e=e.filter(t=>t.status===this.statusFilter)),this.searchTerm){let t=this.searchTerm.toLowerCase();e=e.filter(i=>i.order_number.toLowerCase().includes(t)||i.table_number.toLowerCase().includes(t)||i.items.some(o=>o.dish_name.toLowerCase().includes(t)))}e=e.filter(t=>t.items.some(i=>i.status!=="served"&&i.status!=="out_of_stock")),this.filteredOrders=e}onStatusFilterChange(){this.applyFilters()}onSearchChange(){this.applyFilters()}markOrderAsReady(e){return _(this,null,function*(){try{console.log(`\u{1F504} Marking order ${e.order_number} as ready`);for(let t of e.items)t.status!=="served"&&(yield this.updateItemStatus(t,"ready"));console.log("\u2705 Order marked as ready")}catch(t){console.error("\u274C Error marking order as ready:",t)}})}markItemAsOutOfStock(e){return _(this,null,function*(){try{console.log(`\u{1F504} Marking item ${e.dish_name} as out of stock`);let t=this.dishService.getDishById(e.dish_id);t&&(yield this.dishService.updateDish(t.id,{status:"out_of_stock"})),yield this.updateItemStatus(e,"out_of_stock"),console.log("\u2705 Item marked as out of stock")}catch(t){console.error("\u274C Error marking item as out of stock:",t)}})}openRecipeModal(e){this.selectedRecipeItem=e,this.showRecipeModal=!0}closeRecipeModal(){this.selectedRecipeItem=null,this.showRecipeModal=!1}getRecipe(e){return e?this.dishService.getDishById(e)?.ingredients_composition||[]:[]}getRecipeInstructions(e){return e&&this.dishService.getDishById(e)?.recipe_instructions||""}forceRefresh(){return _(this,null,function*(){yield this.loadKitchenData()})}getIngredientName(e){if(!e)return"Ingrediente";if(e.name&&e.quantity&&e.unit)return e.name;let t=this.selectedRecipeItem?.dish_id;if(!t)return console.warn("Nessun dish_id disponibile per cercare gli ingredienti"),e.ingredient_name||"Ingrediente";let i=this.dishService.getDishById(t);if(!i||!i.ingredients_composition)return e.ingredient_name||"Ingrediente";let o=i.ingredients_composition.find(d=>d.ingredient_id===e.ingredient_id);return o?.name||o?.ingredient_name||"Ingrediente"}getIngredientQuantity(e){if(!e)return 0;if(e.quantity!==void 0)return e.quantity;let t=this.selectedRecipeItem?.dish_id;if(!t)return 0;let i=this.dishService.getDishById(t);return!i||!i.ingredients_composition?0:i.ingredients_composition.find(d=>d.ingredient_id===e.ingredient_id)?.quantity||0}getIngredientUnit(e){if(!e)return"";if(e.unit_symbol||e.unit)return e.unit_symbol||e.unit||"";let t=this.selectedRecipeItem?.dish_id;if(!t)return"";let i=this.dishService.getDishById(t);if(!i||!i.ingredients_composition)return"";let o=i.ingredients_composition.find(d=>d.ingredient_id===e.ingredient_id);return o?.unit_symbol||o?.unit||""}getIngredientCost(e){if(!e)return 0;if(e.cost!==void 0)return e.cost;let t=this.selectedRecipeItem?.dish_id;if(!t)return 0;let i=this.dishService.getDishById(t);return!i||!i.ingredients_composition?0:i.ingredients_composition.find(d=>d.ingredient_id===e.ingredient_id)?.cost||0}getIngredientNotes(e){if(!e)return"";if(e.recipe_notes||e.notes)return e.recipe_notes||e.notes||"";let t=this.selectedRecipeItem?.dish_id;if(!t)return"";let i=this.dishService.getDishById(t);if(!i||!i.ingredients_composition)return"";let o=i.ingredients_composition.find(d=>d.ingredient_id===e.ingredient_id);return o?.recipe_notes||o?.notes||""}getIngredientDetails(e){if(!e)return null;if(e.name&&e.quantity&&e.unit)return e;let t=this.selectedRecipeItem?.dish_id;if(!t)return console.warn("Nessun dish_id disponibile per cercare gli ingredienti"),e;let i=this.dishService.getDishById(t);return!i||!i.ingredients_composition?e:i.ingredients_composition.find(d=>d.ingredient_id===e.ingredient_id)||e}getOrderProgress(e){return!e||!e.order_items?{completed:0,total:0,percentage:0}:this.orderService.getOrderProgress(e.order_items)}getOrderStatusColor(e){return{waiting:"warning",preparing:"primary",ready:"success",served:"secondary",out_of_stock:"danger",received:"info"}[e]||"secondary"}getOverallOrderStatus(e){return!e||!e.order_items||e.order_items.length===0?e?.status||"received":this.orderService.calculateOverallOrderStatus(e.order_items)}getOrderStatusText(e){return{waiting:"In Attesa",preparing:"In Preparazione",ready:"Pronto",served:"Servito",out_of_stock:"Esaurito",received:"Ricevuto"}[e]||e}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=V({type:a,selectors:[["app-kitchen-display"]],decls:78,vars:9,consts:[["noRecipe",""],["noIngredients",""],[1,"kitchen-display-container","page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-content"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],[1,"form-input",3,"ngModelChange","change","ngModel"],["value","all"],["value","pending"],["value","confirmed"],["value","active"],["value","preparing"],["value","ready"],["type","text","placeholder","Numero ordine, tavolo o piatto...",1,"form-input",3,"ngModelChange","input","ngModel"],[1,"actions-container"],[1,"promethea-button","primary",3,"click"],[1,"orders-section"],["class","empty-state",4,"ngIf"],["class","order-card card",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"empty-state"],[1,"order-card","card"],[1,"order-header"],[1,"order-info"],[1,"order-details"],[1,"table-badge"],[1,"time-badge"],[1,"chip"],[1,"order-progress"],[1,"progress-info"],[1,"progress-percentage"],[1,"progress-bar"],[1,"progress-fill"],[1,"order-items"],["class","order-item",3,"class",4,"ngFor","ngForOf"],["class","order-actions",4,"ngIf"],[1,"order-item"],[1,"item-main"],[1,"item-info"],[1,"item-name"],[1,"item-details"],[1,"quantity"],[1,"preparation-time"],[1,"elapsed-time"],["class","time-remaining",4,"ngIf"],["class","item-notes",4,"ngIf"],[1,"item-actions"],[1,"item-status","chip"],[1,"action-buttons"],["class","promethea-button primary small",3,"click",4,"ngIf"],["class","promethea-button success small",3,"click",4,"ngIf"],["class","promethea-button secondary small",3,"click",4,"ngIf"],[1,"promethea-button","ghost","small","info",3,"click"],[1,"promethea-button","ghost","small","danger",3,"click","disabled"],[1,"time-remaining"],[1,"item-notes"],[1,"promethea-button","primary","small",3,"click"],[1,"promethea-button","success","small",3,"click"],[1,"promethea-button","secondary","small",3,"click"],[1,"order-actions"],[1,"promethea-button","success",3,"click","disabled"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"preparation-badge","chip","active"],[1,"modal-close",3,"click"],[1,"modal-body"],[4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"form-section"],[1,"subsection-title"],[1,"chip","active"],["class","settings-grid",4,"ngIf","ngIfElse"],["class","form-section",4,"ngIf"],[1,"settings-grid"],["class","form-subsection ingredient-card",4,"ngFor","ngForOf"],[1,"form-subsection","ingredient-card"],[1,"ingredient-header"],[1,"ingredient-main-info"],[1,"ingredient-name"],[1,"ingredient-quantity","chip","active"],["class","ingredient-cost text-muted",4,"ngIf"],["class","form-group",4,"ngIf"],[1,"ingredient-cost","text-muted"],[1,"form-group"],[1,"ingredient-notes-content"],[1,"recipe-instructions-content"]],template:function(t,i){t&1&&(r(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),s(4,"restaurant"),n()(),r(5,"div",6)(6,"h1",7),s(7,"Display Cucina"),n(),r(8,"p",8),s(9,"Gestisci gli ordini in tempo reale"),n()()(),r(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"span",5),s(15,"schedule"),n(),r(16,"div",13),s(17,"In Attesa"),n()(),r(18,"div",14),s(19),n()()(),r(20,"div",10)(21,"div",11)(22,"div",12)(23,"span",5),s(24,"kitchen"),n(),r(25,"div",13),s(26,"In Preparazione"),n()(),r(27,"div",14),s(28),n()()(),r(29,"div",10)(30,"div",11)(31,"div",12)(32,"span",5),s(33,"done"),n(),r(34,"div",13),s(35,"Pronti"),n()(),r(36,"div",14),s(37),n()()(),r(38,"div",10)(39,"div",11)(40,"div",12)(41,"span",5),s(42,"list_alt"),n(),r(43,"div",13),s(44,"Ordini Totali"),n()(),r(45,"div",14),s(46),n()()()(),r(47,"div",15)(48,"div",16)(49,"div",17)(50,"label",18),s(51,"Stato:"),n(),r(52,"select",19),T("ngModelChange",function(d){return P(i.statusFilter,d)||(i.statusFilter=d),d}),g("change",function(){return i.onStatusFilterChange()}),r(53,"option",20),s(54,"Tutti gli ordini"),n(),r(55,"option",21),s(56,"In Attesa"),n(),r(57,"option",22),s(58,"Confermati"),n(),r(59,"option",23),s(60,"Attivi"),n(),r(61,"option",24),s(62,"In Preparazione"),n(),r(63,"option",25),s(64,"Pronti"),n()()(),r(65,"div",17)(66,"label",18),s(67,"Cerca:"),n(),r(68,"input",26),T("ngModelChange",function(d){return P(i.searchTerm,d)||(i.searchTerm=d),d}),g("input",function(){return i.onSearchChange()}),n()()(),r(69,"div",27)(70,"button",28),g("click",function(){return i.forceRefresh()}),r(71,"span",5),s(72,"refresh"),n(),s(73," Aggiorna "),n()()(),r(74,"div",29),u(75,oe,7,0,"div",30)(76,_e,26,18,"div",31),n()(),u(77,Ce,21,4,"div",32)),t&2&&(c(19),b(i.waitingOrdersCount),c(9),b(i.preparingOrdersCount),c(9),b(i.readyOrdersCount),c(9),b(i.totalActiveOrders),c(6),M("ngModel",i.statusFilter),c(16),M("ngModel",i.searchTerm),c(7),m("ngIf",i.filteredOrders.length===0),c(),m("ngForOf",i.filteredOrders),c(),m("ngIf",i.showRecipeModal))},dependencies:[U,$,B,Y,J,X,W,H,Q,G,q],styles:[".kitchen-display-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-lg)}.order-card[_ngcontent-%COMP%]{margin-bottom:var(--gutter-md);border-left:4px solid var(--primary);transition:all .3s ease}.order-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px var(--shadow)}.order-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:var(--gutter-md);border-bottom:1px solid var(--smoke-color-1);background:var(--smoke-color-0)}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:var(--gutter-md);flex-wrap:wrap}.order-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 var(--gutter-sm) 0;font-size:var(--fs-lg);color:var(--text-color);font-weight:600}.order-details[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);align-items:center;flex-wrap:wrap}.table-badge[_ngcontent-%COMP%]{background:var(--primary);color:#fff;padding:4px 8px;border-radius:6px;font-weight:600;font-size:var(--fs-sm)}.time-badge[_ngcontent-%COMP%]{background:var(--smoke-color-1);color:var(--text-muted);padding:4px 8px;border-radius:6px;font-size:var(--fs-sm)}.order-progress[_ngcontent-%COMP%]{min-width:200px;flex-shrink:0}.progress-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:4px;font-size:var(--fs-sm);color:var(--text-muted)}.progress-percentage[_ngcontent-%COMP%]{font-weight:600;color:var(--primary)}.progress-bar[_ngcontent-%COMP%]{width:100%;height:8px;background:var(--smoke-color-1);border-radius:4px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s ease;border-radius:4px}.progress-fill.success[_ngcontent-%COMP%]{background:var(--success)}.progress-fill.warning[_ngcontent-%COMP%]{background:var(--warning)}.progress-fill.info[_ngcontent-%COMP%]{background:var(--info)}.progress-fill.primary[_ngcontent-%COMP%]{background:var(--primary)}.order-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.order-item[_ngcontent-%COMP%]{padding:var(--gutter-md);border-radius:8px;border:1px solid var(--smoke-color-1);transition:all .3s ease;background:var(--background);transition:all .3s ease-in-out}.order-item[_ngcontent-%COMP%]:hover{border-color:var(--primary);box-shadow:0 2px 8px var(--shadow)}.order-item.status-waiting[_ngcontent-%COMP%]{border-left:4px solid var(--warning)}.order-item.status-preparing[_ngcontent-%COMP%]{border-left:4px solid var(--info)}.order-item.status-ready[_ngcontent-%COMP%]{border-left:4px solid var(--success)}.order-item.status-out_of_stock[_ngcontent-%COMP%]{border-left:4px solid var(--danger);opacity:.7}.item-main[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:var(--gutter-md);flex-wrap:wrap}.item-info[_ngcontent-%COMP%]{flex:1}.item-name[_ngcontent-%COMP%]{margin:0 0 var(--gutter-sm) 0;font-size:var(--fs-md);font-weight:600;color:var(--text-color)}.item-details[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-md);align-items:center;flex-wrap:wrap;margin-bottom:var(--gutter-sm)}.quantity[_ngcontent-%COMP%]{background:var(--primary);color:#fff;padding:2px 6px;border-radius:4px;font-size:var(--fs-sm);font-weight:600}.preparation-time[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:var(--text-muted);font-size:var(--fs-sm)}.elapsed-time[_ngcontent-%COMP%]{font-size:var(--fs-sm);padding:2px 6px;border-radius:4px}.elapsed-time.success[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success) 15%,transparent);color:var(--success)}.elapsed-time.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--warning) 15%,transparent);color:var(--warning)}.elapsed-time.danger[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--danger) 15%,transparent);color:var(--danger)}.item-notes[_ngcontent-%COMP%]{color:var(--text-muted);font-style:italic;margin-top:var(--gutter-sm)}.item-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:var(--gutter-sm);min-width:200px}.item-status[_ngcontent-%COMP%]{font-size:var(--fs-sm);font-weight:600}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);flex-wrap:wrap;justify-content:flex-end}.order-actions[_ngcontent-%COMP%]{margin-top:var(--gutter-md);padding-top:var(--gutter-md);border-top:1px solid var(--smoke-color-1);display:flex;justify-content:flex-end}@media (max-width: 768px){.order-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.order-progress[_ngcontent-%COMP%]{width:100%;margin-top:var(--gutter-sm)}.item-main[_ngcontent-%COMP%]{flex-direction:column}.item-actions[_ngcontent-%COMP%]{width:100%;align-items:stretch}.action-buttons[_ngcontent-%COMP%]{justify-content:space-between}}.chip.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--warning) 15%,transparent);color:var(--warning)}.chip.info[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--info) 15%,transparent);color:var(--info)}.chip.primary[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 15%,transparent);color:var(--primary)}.chip.success[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--success) 15%,transparent);color:var(--success)}.chip.secondary[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--secondary) 15%,transparent);color:var(--secondary)}.chip.danger[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--danger) 15%,transparent);color:var(--danger)}.time-remaining[_ngcontent-%COMP%]{font-size:.8em;opacity:.8;margin-left:4px}.status-selector[_ngcontent-%COMP%]{max-width:150px;font-size:var(--fs-sm)}.status-selector.form-input.small[_ngcontent-%COMP%]{padding:4px 8px;height:32px}.preparation-badge[_ngcontent-%COMP%]{margin-left:var(--gutter-sm)}.ingredient-notes-content[_ngcontent-%COMP%]{background:var(--smoke-color-1);padding:var(--gutter-sm);border-radius:8px;border-left:3px solid var(--primary);font-style:italic}.recipe-instructions-content[_ngcontent-%COMP%]{background:var(--smoke-color-1);padding:var(--gutter-md);border-radius:8px;border-left:3px solid var(--secondary);white-space:pre-line;line-height:1.6}.order-item.status-waiting[_ngcontent-%COMP%]{border-left:4px solid var(--warning-color, #f59e0b)}.order-item.status-preparing[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.order-item.status-ready[_ngcontent-%COMP%]{border-left:4px solid var(--success-color, #10b981)}.order-item.status-served[_ngcontent-%COMP%]{border-left:4px solid var(--secondary)}.order-item.status-out_of_stock[_ngcontent-%COMP%]{border-left:4px solid var(--danger-color, #ef4444)}@media (max-width: 768px){.status-selector[_ngcontent-%COMP%]{max-width:100%;margin-top:var(--gutter-sm)}.action-buttons[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-sm)}}.order-item.fading-out[_ngcontent-%COMP%]{opacity:0;transform:translate(-20px);max-height:0;overflow:hidden;margin:0;padding:0}.order-card[_ngcontent-%COMP%]{transition:all .4s ease-in-out}.order-card.fading-out[_ngcontent-%COMP%]{opacity:0;max-height:0;overflow:hidden;margin:0;padding:0}.pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #28a745b3}70%{box-shadow:0 0 0 10px #28a74500}to{box-shadow:0 0 #28a74500}}.chip.small[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.75rem}.order-item-detail[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border-bottom:1px solid #eee}.order-item-detail[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}"]})};export{re as KitchenDisplay};
