import{a as U}from"./chunk-WUX2K4S7.js";import{b as $,d as j,h as Q,j as Y,p as q,q as G,r as H,w as J}from"./chunk-77SKEQNN.js";import{a as K}from"./chunk-ACSXOFRZ.js";import"./chunk-KNL3CWA3.js";import{d as N,e as R,i as V,j as W,k as A,t as L}from"./chunk-DCWKKS33.js";import{$b as g,Db as u,Eb as m,La as o,Nb as k,Pb as w,Qb as n,Rb as B,Sb as d,Tb as P,Vb as v,Wb as b,Xb as S,ab as I,bc as h,cc as T,ea as E,f as M,fb as _,ja as C,ka as y,qb as p,rb as i,sb as t,xb as O,yb as z,zb as D}from"./chunk-K5RDB55Y.js";function Z(l,a){if(l&1&&(i(0,"option",42),n(1),t()),l&2){let e=a.$implicit;p("value",e.id),o(),d(" ",e.name," ")}}function ee(l,a){if(l&1&&(i(0,"span",43),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function te(l,a){if(l&1&&(i(0,"span",43),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ie(l,a){if(l&1&&(i(0,"span",43),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ne(l,a){if(l&1&&(i(0,"span",43),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ae(l,a){if(l&1&&(i(0,"tr",44)(1,"td",45)(2,"div",46)(3,"span",3),n(4,"folder"),t(),n(5),i(6,"span",47),n(7),t()()()()),l&2){let e=m().$implicit,r=m();o(5),d(" ",e.name," "),o(2),d(" ",r.getDishesByCategory(e.id).length," piatti ")}}function re(l,a){if(l&1&&(i(0,"div",55),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),P(" ",T(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function oe(l,a){if(l&1&&(i(0,"span",6),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function le(l,a){l&1&&(i(0,"span",6),n(1,"-"),t())}function se(l,a){if(l&1){let e=D();i(0,"tr")(1,"td")(2,"div",48)(3,"div",49)(4,"strong",50),u("click",function(){let c=C(e).$implicit,s=m(2);return y(s.editDish(c.id))}),n(5),t(),_(6,re,3,6,"div",51),t()()(),i(7,"td"),n(8),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"select",52),u("ngModelChange",function(c){let s=C(e).$implicit,f=m(2);return y(f.updateDishStatus(s,c))}),i(22,"option",22),n(23,"Disponibile"),t(),i(24,"option",23),n(25,"Non disponibile"),t(),i(26,"option",24),n(27,"Esaurito"),t()()(),i(28,"td"),_(29,oe,2,1,"span",53)(30,le,2,0,"span",53),t(),i(31,"td")(32,"button",54),u("click",function(){let c=C(e).$implicit,s=m(2);return y(s.confirmDeleteDish(c))}),i(33,"span",3),n(34,"delete"),t(),n(35," Elimina "),t()()()}if(l&2){let e=a.$implicit,r=m(2);o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(2),B(r.getCategoryName(e.category_id||"")),o(3),d("\u20AC",h(12,17,e.base_price,"1.2-2")),o(3),d("",h(15,20,r.calculateFoodCostPercentage(e),"1.0-1"),"%"),o(3),w(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",h(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),k("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),p("ngModel",e.status),o(8),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function ce(l,a){if(l&1&&(O(0),_(1,ae,8,2,"tr",38)(2,se,36,26,"tr",37),z()),l&2){let e=a.$implicit,r=m();o(),p("ngIf",r.getDishesByCategory(e.id).length>0),o(),p("ngForOf",r.getDishesByCategory(e.id))}}function de(l,a){if(l&1&&(i(0,"tr",44)(1,"td",56)(2,"div",46)(3,"span",3),n(4,"folder_open"),t(),n(5," Senza Categoria "),i(6,"span",47),n(7),t()()()()),l&2){let e=m();o(7),d(" ",e.getDishesByCategory("").length," piatti ")}}function pe(l,a){if(l&1&&(i(0,"div",55),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),P(" ",T(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function me(l,a){if(l&1&&(i(0,"span",6),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function ue(l,a){l&1&&(i(0,"span",6),n(1,"-"),t())}function ge(l,a){if(l&1){let e=D();i(0,"tr")(1,"td")(2,"div",48)(3,"div",49)(4,"strong",50),u("click",function(){let c=C(e).$implicit,s=m();return y(s.editDish(c.id))}),n(5),t(),_(6,pe,3,6,"div",51),t()()(),i(7,"td",6),n(8,"-"),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"span"),n(22),g(23,"number"),t()(),i(24,"td")(25,"span",57),n(26),t()(),i(27,"td"),_(28,me,2,1,"span",53)(29,ue,2,0,"span",53),t()()}if(l&2){let e=a.$implicit,r=m();o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(5),d("\u20AC",h(12,17,e.base_price,"1.2-2")),o(3),d("\u20AC",h(15,20,e.food_cost,"1.2-2")),o(3),w(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",h(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),w(r.calculateMarginPercentage(e)>=0?"text-muted":"error"),o(),d(" ",h(23,26,r.calculateMarginPercentage(e),"1.0-0"),"% "),o(3),k("active",e.status==="available")("inactive",e.status!=="available"),o(),d(" ",r.getStatusText(e.status)," "),o(2),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function _e(l,a){l&1&&(i(0,"tr")(1,"td",58)(2,"span",59),n(3,"search_off"),t(),i(4,"h3"),n(5,"Nessun piatto trovato"),t(),i(6,"p"),n(7,"Prova a modificare i filtri di ricerca"),t()()())}var X=class l{dishService=E(K);categoryService=E(U);router=E(L);dishes=[];categories=[];filteredDishes=[];stats={totalDishes:0,totalCategories:0,averageFoodCost:0,averageMargin:0,averagePrice:0};searchTerm="";selectedCategory="all";statusFilter="all";priceRange={min:null,max:null};sortField="name";sortDirection="asc";ngOnInit(){this.loadData()}loadData(){return M(this,null,function*(){yield this.dishService.loadDishes(),yield this.categoryService.loadCategories(),this.dishService.dishes$.subscribe(a=>{this.dishes=a,this.applyFilters(),this.calculateStats()}),this.categoryService.categories$.subscribe(a=>{this.categories=a,this.calculateStats()})})}calculateStats(){let a=this.dishes.length,e=this.categories.length,r=this.dishes.reduce((f,x)=>f+(x.food_cost||0),0),c=this.dishes.reduce((f,x)=>f+(x.base_price||0),0),s=this.dishes.reduce((f,x)=>{let F=(x.base_price||0)-(x.food_cost||0);return f+(F>0?F:0)},0);this.stats={totalDishes:a,totalCategories:e,averageFoodCost:a>0?r/a:0,averageMargin:a>0?s/a:0,averagePrice:a>0?c/a:0}}applyFilters(){let a=[...this.dishes];this.searchTerm&&(a=a.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description?.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.selectedCategory!=="all"&&(a=a.filter(e=>e.category_id===this.selectedCategory)),this.statusFilter!=="all"&&(a=a.filter(e=>e.status===this.statusFilter)),this.priceRange.min!==null&&(a=a.filter(e=>e.base_price>=this.priceRange.min)),this.priceRange.max!==null&&(a=a.filter(e=>e.base_price<=this.priceRange.max)),a.sort((e,r)=>{let c,s;switch(this.sortField){case"name":c=e.name.toLowerCase(),s=r.name.toLowerCase();break;case"price":c=e.base_price,s=r.base_price;break;case"food_cost":c=e.food_cost,s=r.food_cost;break;case"margin":c=e.base_price-e.food_cost,s=r.base_price-r.food_cost;break;default:c=e.name.toLowerCase(),s=r.name.toLowerCase()}return c<s?this.sortDirection==="asc"?-1:1:c>s?this.sortDirection==="asc"?1:-1:0}),this.filteredDishes=a}onSort(a){this.sortField===a?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=a,this.sortDirection="asc"),a==="food_cost_percentage"&&(this.sortField="food_cost"),this.applyFilters()}getCategoryName(a){return this.categories.find(r=>r.id===a)?.name||"Senza categoria"}calculateMargin(a){return a.base_price-a.food_cost}calculateMarginPercentage(a){return a.base_price===0?0:(a.base_price-a.food_cost)/a.base_price*100}getDishesByCategory(a){return this.filteredDishes.filter(e=>e.category_id===a)}resetFilters(){this.searchTerm="",this.selectedCategory="all",this.statusFilter="all",this.priceRange={min:null,max:null},this.applyFilters()}getStatusText(a){return{available:"Disponibile",unavailable:"Non disponibile",out_of_stock:"Esaurito"}[a]||a}editDish(a){this.router.navigate(["/food-cost-calculator",a])}createNewDish(){this.router.navigate(["/food-cost-calculator"])}calculateFoodCostPercentage(a){return!a.base_price||a.base_price===0?0:a.food_cost/a.base_price*100}updateDishStatus(a,e){return M(this,null,function*(){try{let r=a.status;e==="available"||e==="unavailable"||e==="out_of_stock"?(a.status=e,(yield this.dishService.updateDish(a.id,{status:e}))?(console.log(`Stato piatto ${a.name} aggiornato a: ${e}`),this.calculateStats()):(a.status=r,console.error("Errore nell'aggiornamento dello stato del piatto"),alert("Errore durante l'aggiornamento dello stato. Riprova."))):(console.error("Stato non valido:",e),alert("Stato non valido selezionato."))}catch(r){console.error("Errore durante l'aggiornamento dello stato:",r),alert("Errore durante l'aggiornamento dello stato.")}})}confirmDeleteDish(a){return M(this,null,function*(){let e=`Sei sicuro di voler eliminare il piatto "${a.name}"?

Questa azione non pu\xF2 essere annullata.`;confirm(e)&&(yield this.deleteDish(a.id))})}deleteDish(a){return M(this,null,function*(){try{(yield this.dishService.deleteDish(a))?console.log("\u2705 Piatto eliminato con successo"):alert("Errore durante l'eliminazione del piatto")}catch(e){console.error("\u274C Errore durante l'eliminazione:",e),alert("Errore durante l'eliminazione del piatto")}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=I({type:l,selectors:[["app-menu-builder"]],decls:155,vars:28,consts:[[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-content"],[1,"card-number"],[1,"form-card",2,"margin-top","var(--gutter-lg)"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Cerca per nome o descrizione...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["value","available"],["value","unavailable"],["value","out_of_stock"],[2,"display","flex","gap","var(--gutter-sm)"],["type","number","placeholder","Min",2,"width","80px",3,"ngModelChange","input","ngModel"],[2,"align-self","center"],["type","number","placeholder","Max",2,"width","80px",3,"ngModelChange","input","ngModel"],[1,"actions-container"],[1,"promethea-button","ghost",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[2,"cursor","pointer",3,"click"],["class","material-icons","style","font-size: 14px;",4,"ngIf"],[2,"width","100px"],[4,"ngFor","ngForOf"],["class","category-header",4,"ngIf"],[4,"ngIf"],[1,"actions-container",2,"margin-top","var(--gutter-lg)"],[1,"promethea-button",3,"click"],[3,"value"],[1,"material-icons",2,"font-size","14px"],[1,"category-header"],["colspan","8",2,"background","var(--smoke-color-2)","font-weight","800"],[1,"section-title",2,"margin","0","border","none"],[1,"chip",2,"margin-left","auto"],[1,"user-info-compact"],[1,"nomedescpiatto"],[1,"clickable-dish-name",3,"click"],["class","text-muted","style","font-size: 0.8rem;",4,"ngIf"],[1,"status-select",3,"ngModelChange","ngModel"],["class","text-muted",4,"ngIf"],["title","Elimina piatto",1,"promethea-button","danger","small",3,"click"],[1,"text-muted",2,"font-size","0.8rem"],["colspan","8",2,"background","var(--smoke-color-1)","font-weight","800"],[1,"chip"],["colspan","8",1,"empty-state"],[1,"material-icons",2,"font-size","48px","opacity","0.5"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"dashboard"),t()(),i(5,"div",4)(6,"h1",5),n(7,"Men\xF9"),t(),i(8,"p",6),n(9,"Panoramica completa delle attivit\xE0 del tuo ristorante"),t()()(),i(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",3),n(14,"restaurant"),t(),i(15,"h3",10),n(16,"Totale Piatti"),t()(),i(17,"div",11)(18,"div",12),n(19),t(),i(20,"span",6),n(21,"Piatti nel men\xF9"),t()()(),i(22,"div",8)(23,"div",9)(24,"span",3),n(25,"category"),t(),i(26,"h3",10),n(27,"Categorie"),t()(),i(28,"div",11)(29,"div",12),n(30),t(),i(31,"span",6),n(32,"Categorie attive"),t()()(),i(33,"div",8)(34,"div",9)(35,"span",3),n(36,"euro"),t(),i(37,"h3",10),n(38,"Prezzo Medio"),t()(),i(39,"div",11)(40,"div",12),n(41),g(42,"number"),t(),i(43,"span",6),n(44,"Prezzo medio piatto"),t()()(),i(45,"div",8)(46,"div",9)(47,"span",3),n(48,"trending_up"),t(),i(49,"h3",10),n(50,"Margine Medio"),t()(),i(51,"div",11)(52,"div",12),n(53),g(54,"number"),t(),i(55,"span",6),n(56,"Margine medio piatto"),t()()(),i(57,"div",8)(58,"div",9)(59,"span",3),n(60,"account_balance"),t(),i(61,"h3",10),n(62,"Food Cost Medio"),t()(),i(63,"div",11)(64,"div",12),n(65),g(66,"number"),t(),i(67,"span",6),n(68,"Costo medio piatto"),t()()()(),i(69,"div",13)(70,"div",14)(71,"div",15)(72,"div",16)(73,"label",17)(74,"span",3),n(75,"search"),t(),n(76," Cerca "),t(),i(77,"input",18),S("ngModelChange",function(s){return b(r.searchTerm,s)||(r.searchTerm=s),s}),u("input",function(){return r.applyFilters()}),t()(),i(78,"div",16)(79,"label",17)(80,"span",3),n(81,"category"),t(),n(82," Categoria "),t(),i(83,"select",19),S("ngModelChange",function(s){return b(r.selectedCategory,s)||(r.selectedCategory=s),s}),u("change",function(){return r.applyFilters()}),i(84,"option",20),n(85,"Tutte le categorie"),t(),_(86,Z,2,2,"option",21),t()(),i(87,"div",16)(88,"label",17)(89,"span",3),n(90,"visibility"),t(),n(91," Stato "),t(),i(92,"select",19),S("ngModelChange",function(s){return b(r.statusFilter,s)||(r.statusFilter=s),s}),u("change",function(){return r.applyFilters()}),i(93,"option",20),n(94,"Tutti gli stati"),t(),i(95,"option",22),n(96,"Disponibile"),t(),i(97,"option",23),n(98,"Non disponibile"),t(),i(99,"option",24),n(100,"Esaurito"),t()()(),i(101,"div",16)(102,"label",17)(103,"span",3),n(104,"euro"),t(),n(105," Prezzo "),t(),i(106,"div",25)(107,"input",26),S("ngModelChange",function(s){return b(r.priceRange.min,s)||(r.priceRange.min=s),s}),u("input",function(){return r.applyFilters()}),t(),i(108,"span",27),n(109,"-"),t(),i(110,"input",28),S("ngModelChange",function(s){return b(r.priceRange.max,s)||(r.priceRange.max=s),s}),u("input",function(){return r.applyFilters()}),t()()()(),i(111,"div",29)(112,"button",30),u("click",function(){return r.resetFilters()}),i(113,"span",3),n(114,"refresh"),t(),n(115," Reset "),t()()()(),i(116,"div",31)(117,"div",32)(118,"table",33)(119,"thead")(120,"tr")(121,"th",34),u("click",function(){return r.onSort("name")}),n(122," Nome "),_(123,ee,2,1,"span",35),t(),i(124,"th"),n(125,"Categoria"),t(),i(126,"th",34),u("click",function(){return r.onSort("price")}),n(127," Prezzo "),_(128,te,2,1,"span",35),t(),i(129,"th",34),u("click",function(){return r.onSort("food_cost_percentage")}),n(130," Food Cost % "),_(131,ie,2,1,"span",35),t(),i(132,"th",34),u("click",function(){return r.onSort("margin")}),n(133," Margine (\u20AC) "),_(134,ne,2,1,"span",35),t(),i(135,"th"),n(136,"Stato"),t(),i(137,"th"),n(138,"Tempo Prep."),t(),i(139,"th",36),n(140,"Azioni"),t()()(),i(141,"tbody"),_(142,ce,3,2,"ng-container",37)(143,de,8,1,"tr",38)(144,ge,30,29,"tr",37)(145,_e,8,0,"tr",39),t()()()(),i(146,"div",40)(147,"button",41),u("click",function(){return r.createNewDish()}),i(148,"span",3),n(149,"add"),t(),n(150," Nuovo Piatto "),t(),i(151,"button",30),u("click",function(){return r.resetFilters()}),i(152,"span",3),n(153,"refresh"),t(),n(154," Reset Filtri "),t()()()),e&2&&(o(19),B(r.stats.totalDishes),o(11),B(r.stats.totalCategories),o(11),d("\u20AC",h(42,19,r.stats.averagePrice,"1.2-2")),o(12),d("\u20AC",h(54,22,r.stats.averageMargin,"1.2-2")),o(12),d("\u20AC",h(66,25,r.stats.averageFoodCost,"1.2-2")),o(12),v("ngModel",r.searchTerm),o(6),v("ngModel",r.selectedCategory),o(3),p("ngForOf",r.categories),o(6),v("ngModel",r.statusFilter),o(15),v("ngModel",r.priceRange.min),o(3),v("ngModel",r.priceRange.max),o(13),p("ngIf",r.sortField==="name"),o(5),p("ngIf",r.sortField==="price"),o(3),p("ngIf",r.sortField==="food_cost_percentage"),o(3),p("ngIf",r.sortField==="margin"),o(8),p("ngForOf",r.categories),o(),p("ngIf",r.getDishesByCategory("").length>0),o(),p("ngForOf",r.getDishesByCategory("")),o(),p("ngIf",r.filteredDishes.length===0))},dependencies:[A,N,R,J,G,H,$,Y,q,j,Q,W,V],styles:[".category-header[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.category-header[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gutter-md)!important}.crm-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(.category-header):hover{background:var(--smoke-color-1)}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.nomedescpiatto[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:calc(var(--gutter-sm) / 2)}.clickable-dish-name[_ngcontent-%COMP%]{cursor:pointer;color:var(--primary);transition:color .2s ease;text-decoration:none;border-bottom:1px solid transparent}.clickable-dish-name[_ngcontent-%COMP%]:hover{color:var(--tertiary);border-bottom:1px solid var(--tertiary)}.clickable-dish-name[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.crm-table[_ngcontent-%COMP%]{min-width:800px}}.status-select[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;border:1px solid #ddd;font-size:.875rem;cursor:pointer;transition:all .2s ease;background:#fff}.status-select.available[_ngcontent-%COMP%]{border-color:var(--success-color, #28a745);background-color:#28a7451a}.status-select.unavailable[_ngcontent-%COMP%]{border-color:var(--warning-color, #ffc107);background-color:#ffc1071a}.status-select.out_of_stock[_ngcontent-%COMP%]{border-color:var(--danger-color, #dc3545);background-color:#dc35451a}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}.chip.active[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.chip.inactive[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}"]})};export{X as MenuBuilder};
