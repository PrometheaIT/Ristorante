import{a as V}from"./chunk-G4UPU7PX.js";import{qb as j,rb as q}from"./chunk-7ARAJ5DM.js";import{B as L,a as R,b as k,c as p,d as O,e as E,j as z,k as I,o as F,r as T,z as A}from"./chunk-YO2SNT5L.js";import{d as S}from"./chunk-MEEOFM4U.js";import{c as C,e as N,f as M}from"./chunk-RD7WPZ3N.js";import"./chunk-JDHQCX3C.js";import{l as P,v as x}from"./chunk-RJWLMJIA.js";import{Ib as l,Jb as w,Kb as y,La as o,Va as _,_a as g,ca as u,gb as s,ib as c,qb as n,rb as i,sb as m,yb as f,zb as v}from"./chunk-KIAVC6JW.js";import{g as b}from"./chunk-RA2WU32H.js";function G(a,t){a&1&&(n(0,"div",42),l(1," Il nome \xE8 obbligatorio "),i())}function H(a,t){a&1&&(n(0,"div",42),l(1," Il cognome \xE8 obbligatorio "),i())}function U(a,t){a&1&&(n(0,"span"),l(1,"Email obbligatoria"),i())}function B(a,t){a&1&&(n(0,"span"),l(1,"Email non valida"),i())}function J(a,t){if(a&1&&(n(0,"div",42),g(1,U,2,0,"span",43)(2,B,2,0,"span",43),i()),a&2){let r=v();o(),s("ngIf",r.email==null||r.email.errors==null?null:r.email.errors.required),o(),s("ngIf",r.email==null||r.email.errors==null?null:r.email.errors.email)}}function K(a,t){a&1&&(n(0,"div",42),l(1," Il nome del ristorante \xE8 obbligatorio "),i())}function Q(a,t){if(a&1&&(n(0,"div",44)(1,"h2",11),m(2,"lucide-icon",45),l(3," Informazioni Ristorante "),i(),n(4,"div",14)(5,"label",15),l(6,"Nome Ristorante *"),i(),m(7,"input",46),g(8,K,2,0,"div",17),i()()),a&2){let r=v();o(2),s("size",20),o(5),c("error",(r.restaurantName==null?null:r.restaurantName.invalid)&&(r.restaurantName==null?null:r.restaurantName.touched)),o(),s("ngIf",(r.restaurantName==null?null:r.restaurantName.invalid)&&(r.restaurantName==null?null:r.restaurantName.touched))}}function W(a,t){a&1&&(n(0,"div",42),l(1," Password obbligatoria (min. 6 caratteri) "),i())}function X(a,t){a&1&&(n(0,"div",42),l(1," Le password non coincidono "),i())}function Y(a,t){if(a&1&&(n(0,"div",47),m(1,"lucide-icon",48),l(2),i()),a&2){let r=v();o(),s("size",16),o(),y(" ",r.errorMessage," ")}}function Z(a,t){a&1&&m(0,"span",49)}function $(a,t){a&1&&m(0,"lucide-icon",50),a&2&&s("size",18)}var D=class a{fb=u(A);authService=u(S);router=u(N);route=u(C);registerForm;isLoading=!1;errorMessage="";isRestaurant=!1;isSupplier=!1;showPassword=!1;showConfirmPassword=!1;ngOnInit(){let t=this.route.snapshot.paramMap.get("role");this.isRestaurant=t==="restaurant",this.isSupplier=t==="supplier",this.initializeForm()}initializeForm(){this.registerForm=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(6)]],confirmPassword:["",[p.required]],firstName:["",[p.required]],lastName:["",[p.required]],phone:[""],policy:[!1,[p.requiredTrue]],restaurantName:[(this.isRestaurant,""),this.isRestaurant?p.required:[]],companyName:[(this.isSupplier,""),this.isSupplier?p.required:[]],contactName:[(this.isSupplier,""),this.isSupplier?p.required:[]],supplierAddress:[(this.isSupplier,"")],supplierDescription:[(this.isSupplier,"")]},{validators:this.passwordMatchValidator})}get rememberMe(){return this.registerForm.get("policy")}passwordMatchValidator(t){let r=t.get("password")?.value,e=t.get("confirmPassword")?.value;return r===e?null:{passwordMismatch:!0}}onSubmit(){return b(this,null,function*(){if(this.registerForm.invalid||this.isLoading)return;this.isLoading=!0,this.errorMessage="";let t=this.registerForm.value;try{let r=this.determineUserRole(),e={email:t.email.toLowerCase().trim(),password:t.password,user_data:{first_name:t.firstName,last_name:t.lastName,phone:t.phone,role:r},restaurant_data:this.isRestaurant?{name:t.restaurantName,address:"",phone:t.phone||"",email:t.email,description:"",cuisine_type:"",allow_table_selection:!1,accepts_delivery:!1,accepts_takeaway:!1}:void 0,supplier_data:this.isSupplier?{company_name:t.companyName,contact_name:t.contactName,email:t.email,phone:t.phone||"",address:t.supplierAddress,description:t.supplierDescription}:void 0},d=yield this.authService.register(e);if(d.error){if(typeof d.error=="string")this.errorMessage=d.error;else if(d.error&&typeof d.error=="object"){let h=d.error;this.errorMessage=h.message||h.toString()}else this.errorMessage="Errore durante la registrazione";console.error("Registration error details:",d.error)}else d.user&&(console.log("\u2705 Registration successful, user:",d.user.id),this.errorMessage="Registrazione completata! Reindirizzamento...",this.redirectAfterRegistration(d))}catch(r){r instanceof Error?this.errorMessage="Errore durante la registrazione: "+r.message:typeof r=="string"?this.errorMessage="Errore durante la registrazione: "+r:this.errorMessage="Errore sconosciuto durante la registrazione",console.error("Registration exception:",r)}finally{this.isLoading=!1}})}determineUserRole(){return this.isRestaurant?"restaurant_owner":this.isSupplier?"supplier":"customer"}redirectAfterRegistration(t){setTimeout(()=>{this.isRestaurant&&t.restaurant?this.router.navigate(["/restaurant/dashboard"]):this.isSupplier?this.router.navigate(["/supplier/dashboard"]):this.router.navigate(["/customer/menu-display"])},2e3)}get email(){return this.registerForm.get("email")}get password(){return this.registerForm.get("password")}get confirmPassword(){return this.registerForm.get("confirmPassword")}get firstName(){return this.registerForm.get("firstName")}get lastName(){return this.registerForm.get("lastName")}get restaurantName(){return this.registerForm.get("restaurantName")}get companyName(){return this.registerForm.get("companyName")}get contactName(){return this.registerForm.get("contactName")}get supplierAddress(){return this.registerForm.get("supplierAddress")}get supplierDescription(){return this.registerForm.get("supplierDescription")}togglePasswordVisibility(){this.showPassword=!this.showPassword}toggleConfirmPasswordVisibility(){this.showConfirmPassword=!this.showConfirmPassword}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=_({type:a,selectors:[["app-register"]],decls:74,vars:33,consts:[[3,"title","icon","showToggle"],[1,"login-page","page-container"],["aria-hidden","true",1,"login-bg"],[1,"login-blob","login-blob--1"],[1,"login-blob","login-blob--2"],[1,"login-blob","login-blob--3"],[1,"login-aurora"],[1,"login-grid"],[1,"register-center"],[1,"login-card","register-card"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"text-md","font-semibold","mb-md","flex","gap-sm","items-center"],["name","user",1,"nav-icon",3,"size"],[1,"form-row","mb-md"],[1,"form-group"],[1,"standard-label"],["formControlName","firstName","placeholder","Il tuo nome","type","text"],["class","login-field-error",4,"ngIf"],["formControlName","lastName","placeholder","Il tuo cognome","type","text"],["formControlName","email","type","email","placeholder","tua.email@esempio.com"],["formControlName","phone","placeholder","+39 123 456 7890","type","number"],["class","mb-md",4,"ngIf"],[1,"mt-lg","mb-md"],["name","lock",1,"nav-icon",3,"size"],[1,"form-row"],[1,"login-input-wrap"],["formControlName","password","placeholder","Almeno 6 caratteri",3,"type"],["type","button",1,"login-eye-btn",3,"click"],[3,"name","size"],["formControlName","confirmPassword","placeholder","Ripeti la password",3,"type"],[1,"flex","items-center","my-md"],[1,"checkbox-label"],["type","checkbox","formControlName","policy"],[1,"checkbox-content","text-muted"],["href","#/policy",1,"link"],["class","login-message login-message--error mb-md",4,"ngIf"],[1,"login-divider","mb-md"],[1,"flex","justify-between","items-center","gap-md"],["routerLink","/login",1,"link"],["type","submit",1,"promethea-button",3,"disabled"],["class","loading-spinner",4,"ngIf"],["name","user-check",3,"size",4,"ngIf"],[1,"login-field-error"],[4,"ngIf"],[1,"mb-md"],["name","building-2",1,"nav-icon",3,"size"],["formControlName","restaurantName","placeholder","Il nome del tuo ristorante","type","text"],[1,"login-message","login-message--error","mb-md"],["name","alert-triangle",3,"size"],[1,"loading-spinner"],["name","user-check",3,"size"]],template:function(r,e){r&1&&(m(0,"app-header",0),n(1,"div",1)(2,"div",2),m(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7),i(),n(8,"div",8)(9,"div",9)(10,"form",10),f("ngSubmit",function(){return e.onSubmit()}),n(11,"h2",11),m(12,"lucide-icon",12),l(13," Informazioni Personali "),i(),n(14,"div",13)(15,"div",14)(16,"label",15),l(17,"Nome *"),i(),m(18,"input",16),g(19,G,2,0,"div",17),i(),n(20,"div",14)(21,"label",15),l(22,"Cognome *"),i(),m(23,"input",18),g(24,H,2,0,"div",17),i()(),n(25,"div",13)(26,"div",14)(27,"label",15),l(28,"Email *"),i(),m(29,"input",19),g(30,J,3,2,"div",17),i(),n(31,"div",14)(32,"label",15),l(33,"Telefono"),i(),m(34,"input",20),i()(),g(35,Q,9,4,"div",21),n(36,"div",22)(37,"h2",11),m(38,"lucide-icon",23),l(39," Password "),i(),n(40,"div",24)(41,"div",14)(42,"label",15),l(43,"Password *"),i(),n(44,"div",25),m(45,"input",26),n(46,"button",27),f("click",function(){return e.togglePasswordVisibility()}),m(47,"lucide-icon",28),i()(),g(48,W,2,0,"div",17),i(),n(49,"div",14)(50,"label",15),l(51,"Conferma Password *"),i(),n(52,"div",25),m(53,"input",29),n(54,"button",27),f("click",function(){return e.toggleConfirmPasswordVisibility()}),m(55,"lucide-icon",28),i()(),g(56,X,2,0,"div",17),i()()(),n(57,"div",30)(58,"label",31),m(59,"input",32),n(60,"div",33),l(61," Dichiaro di aver letto, compreso e accettato la "),n(62,"a",34),l(63,"Privacy Policy e i Termini e Condizioni"),i()()()(),g(64,Y,3,2,"div",35),m(65,"div",36),n(66,"div",37)(67,"a",38),l(68," \u2190 Hai gi\xE0 un account? "),i(),n(69,"button",39),g(70,Z,1,0,"span",40)(71,$,1,1,"lucide-icon",41),n(72,"span"),l(73),i()()()()()()()),r&2&&(s("title",e.isRestaurant?"Registra il tuo Ristorante":"Crea Account")("icon",e.isRestaurant?"utensils-crossed":"user")("showToggle",!1),o(10),s("formGroup",e.registerForm),o(2),s("size",20),o(6),c("error",(e.firstName==null?null:e.firstName.invalid)&&(e.firstName==null?null:e.firstName.touched)),o(),s("ngIf",(e.firstName==null?null:e.firstName.invalid)&&(e.firstName==null?null:e.firstName.touched)),o(4),c("error",(e.lastName==null?null:e.lastName.invalid)&&(e.lastName==null?null:e.lastName.touched)),o(),s("ngIf",(e.lastName==null?null:e.lastName.invalid)&&(e.lastName==null?null:e.lastName.touched)),o(5),c("error",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),o(),s("ngIf",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),o(5),s("ngIf",e.isRestaurant),o(3),s("size",20),o(7),c("error",(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),s("type",e.showPassword?"text":"password"),o(2),s("name",e.showPassword?"eye-off":"eye")("size",18),o(),s("ngIf",(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),o(5),c("error",(e.registerForm.errors==null?null:e.registerForm.errors.passwordMismatch)&&(e.confirmPassword==null?null:e.confirmPassword.touched)),s("type",e.showConfirmPassword?"text":"password"),o(2),s("name",e.showConfirmPassword?"eye-off":"eye")("size",18),o(),s("ngIf",(e.registerForm.errors==null?null:e.registerForm.errors.passwordMismatch)&&(e.confirmPassword==null?null:e.confirmPassword.touched)),o(8),s("ngIf",e.errorMessage),o(5),s("disabled",e.registerForm.invalid||e.isLoading),o(),s("ngIf",e.isLoading),o(),s("ngIf",!e.isLoading),o(2),w(e.isRestaurant?"Registra Ristorante":"Crea Account"))},dependencies:[x,P,L,z,k,I,R,O,E,F,T,M,q,j,V],styles:['.login-page[_ngcontent-%COMP%]{position:relative;min-height:100dvh;overflow:hidden;background:var(--background)}.login-bg[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:0;pointer-events:none}.login-blob[_ngcontent-%COMP%]{position:absolute;border-radius:50%;filter:blur(80px);opacity:.35;animation:_ngcontent-%COMP%_blobFloat 12s ease-in-out infinite alternate}.login-blob--1[_ngcontent-%COMP%]{width:55vw;height:55vw;top:-15%;left:-10%;background:radial-gradient(circle,var(--primary),transparent 70%);animation-duration:14s}.login-blob--2[_ngcontent-%COMP%]{width:45vw;height:45vw;bottom:-15%;right:-5%;background:radial-gradient(circle,var(--secondary),transparent 70%);animation-duration:10s;animation-delay:-4s}.login-blob--3[_ngcontent-%COMP%]{width:30vw;height:30vw;top:40%;left:35%;background:radial-gradient(circle,var(--tertiary),transparent 70%);opacity:.2;animation-duration:16s;animation-delay:-8s}.login-grid[_ngcontent-%COMP%]{position:absolute;inset:0;background-image:linear-gradient(var(--smoke-1) 1px,transparent 1px),linear-gradient(90deg,var(--smoke-1) 1px,transparent 1px);background-size:48px 48px;mask-image:radial-gradient(ellipse 80% 80% at 50% 50%,black 30%,transparent 100%)}@keyframes _ngcontent-%COMP%_blobFloat{0%{transform:translate(0) scale(1) rotate(0)}33%{transform:translate(2%,4%) scale(1.05) rotate(3deg)}66%{transform:translate(-2%,2%) scale(.97) rotate(-2deg)}to{transform:translate(3%,-3%) scale(1.08) rotate(5deg)}}.login-aurora[_ngcontent-%COMP%]{position:absolute;inset:0;background:repeating-linear-gradient(-45deg,transparent 0px,transparent 60px,color-mix(in srgb,var(--primary) 3%,transparent) 60px,color-mix(in srgb,var(--primary) 3%,transparent) 61px);animation:_ngcontent-%COMP%_auroraShift 20s linear infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_auroraShift{0%{background-position:0 0}to{background-position:120px 120px}}.login-split[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:1fr 1fr;min-height:100dvh}.login-brand[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding:clamp(2rem,5vw,4rem)}.login-form-panel[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:clamp(1.5rem,4vw,3rem)}.login-card[_ngcontent-%COMP%]{width:100%;margin:0 var(--gap-lg);border:1px solid var(--smoke-1);border-radius:24px;padding:var(--gap-md);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);box-shadow:0 0 0 1px var(--smoke-1),0 32px 64px -16px color-mix(in srgb,var(--primary) 20%,transparent),0 8px 32px -8px color-mix(in srgb,var(--text-color) 10%,transparent)}.login-avatar[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 20px var(--shadow-1)}.login-input-wrap[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.login-input-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:3rem}.login-eye-btn[_ngcontent-%COMP%]{position:absolute;right:var(--gap-sm);background:transparent;border:none;cursor:pointer;color:var(--text-muted);display:flex;align-items:center;padding:0;transition:color .2s}.login-eye-btn[_ngcontent-%COMP%]:hover{color:var(--primary)}.login-field-error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);margin-top:calc(var(--gap-sm) / 2);font-size:var(--fs-mini);color:#ef4444}.login-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);padding:var(--gap-sm);border-radius:12px;font-size:var(--fs-mini);border:1px solid transparent}.login-message--error[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 10%,transparent);border-color:color-mix(in srgb,#ef4444 30%,transparent);color:#ef4444}.login-message--success[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 10%,transparent);border-color:color-mix(in srgb,#10b981 30%,transparent);color:#10b981}.login-divider[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);text-align:center}.login-divider[_ngcontent-%COMP%]:before, .login-divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--smoke-1)}.login-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:var(--fs-mini);white-space:nowrap}@media (max-width: 768px){.login-split[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto 1fr}.login-brand[_ngcontent-%COMP%]{padding:clamp(1.5rem,5vw,2rem);flex-direction:row;align-items:center;justify-content:space-between;gap:var(--gap-md);border-bottom:1px solid var(--smoke-1)}.login-brand[_ngcontent-%COMP%]   .flex.flex-wrap[_ngcontent-%COMP%]{display:none}.login-form-panel[_ngcontent-%COMP%]{align-items:flex-start;padding:var(--gap-lg) var(--gap-md)}.login-card[_ngcontent-%COMP%]{max-width:100%;border-radius:16px}}.login-brand[_ngcontent-%COMP%]   img.logopiccolo[_ngcontent-%COMP%]{height:clamp(64px,15vw,200px);width:fit-content;object-fit:contain;object-position:left center}.immaginebrand[_ngcontent-%COMP%]{justify-content:center;display:flex;width:100%}.register-center[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;justify-content:center;align-items:flex-start;padding:var(--gap-lg) var(--gap-md)}']})};export{D as Register};
