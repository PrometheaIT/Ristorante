import{a as Me}from"./chunk-Y4O4RGFI.js";import{a as X}from"./chunk-6SRTQ6XE.js";import{a as me,b as ue,d as pe,e as he,g as ge,h as be,i as ve,j as _e,l as fe,q as xe,r as Te,s as Se,t as we,u as Ee,x as Pe}from"./chunk-XXXLA76A.js";import"./chunk-GS53O7WG.js";import"./chunk-EBEBQMEP.js";import{b as Y,d as ce}from"./chunk-N3KHNVQY.js";import{d as le,e as se,n as de}from"./chunk-I5JNAJO4.js";import{Eb as F,Hb as g,Jb as p,Lb as Z,Mb as Q,Nb as K,Oa as d,Pb as O,Qb as W,Rb as oe,Sb as re,Tb as l,Ub as A,Vb as M,Wb as L,Xb as j,Ya as ie,Yb as S,Zb as w,_b as E,a as f,b as x,cb as ne,g as T,ga as B,h as te,hb as k,la as I,ob as ae,qa as m,ra as u,sc as P,vb as _,wb as a,xa as z,xb as o,yb as U}from"./chunk-HCHBVVTJ.js";var q=class c{supabaseService=I(Y);mergeTables(t,e,n,i){return T(this,null,function*(){try{let r=t.map(v=>v.id),s={restaurant_id:i,floor_plan_id:n,table_name:e.table_name,table_number:e.table_number,capacity:e.capacity,shape:"rectangle",position_x:e.position_x,position_y:e.position_y,width:e.width,height:e.height,rotation:0,is_active:!0,is_online_bookable:!0,is_merged:!1,parent_table_id:null,merged_tables_ids:r},{data:h,error:b}=yield this.supabaseService.getSupabaseClient().from("tables").insert(s).select().single();if(b)throw b;for(let v of t){let y={is_online_bookable:!1,is_merged:!0,parent_table_id:h.id},{error:V}=yield this.supabaseService.getSupabaseClient().from("tables").update(y).eq("id",v.id);if(V)throw V}return h}catch(r){return console.error("\u274C Error merging tables:",r),null}})}splitMergedTable(t){return T(this,null,function*(){try{console.log("\u{1F50D} Cerco tavoli figli per:",t.id);let{data:e,error:n}=yield this.supabaseService.getSupabaseClient().from("tables").select("*").eq("parent_table_id",t.id);if(n)throw console.error("\u274C Errore nel fetch dei tavoli figli:",n),n;console.log("\u{1F4CB} Tavoli figli trovati:",e?.length);for(let r of e||[]){let s={is_online_bookable:!0,is_merged:!1,parent_table_id:null};console.log("\u{1F504} Ripristino tavolo:",r.table_number);let{error:h}=yield this.supabaseService.getSupabaseClient().from("tables").update(s).eq("id",r.id);if(h)throw console.error("\u274C Errore nell'aggiornamento del tavolo:",h),h}console.log("\u{1F5D1}\uFE0F Elimino tavolo unito principale:",t.id);let{error:i}=yield this.supabaseService.getSupabaseClient().from("tables").delete().eq("id",t.id);if(i)throw console.error("\u274C Errore nell'eliminazione del tavolo unito:",i),i;return console.log("\u2705 Separazione completata con successo"),!0}catch(e){return console.error("\u274C Error splitting merged table:",e),!1}})}getMergedTableChildren(t){return T(this,null,function*(){try{let{data:e,error:n}=yield this.supabaseService.getSupabaseClient().from("tables").select("*").eq("parent_table_id",t);if(n)throw n;return e||[]}catch(e){return console.error("\u274C Error fetching merged table children:",e),[]}})}static \u0275fac=function(e){return new(e||c)};static \u0275prov=B({token:c,factory:c.\u0275fac,providedIn:"root"})};var H=class c{state=z({floorPlans:[],currentFloorPlan:null,tables:[],selectedTable:null,selectedTables:[],isDrawing:!1,isMergeMode:!1,showTableModal:!1,showEditTableModal:!1,showMergeModal:!1,showDimensionsModal:!1,tableForm:this.getDefaultTableForm()});floorPlans=P(()=>this.state().floorPlans);currentFloorPlan=P(()=>this.state().currentFloorPlan);tables=P(()=>this.state().tables);selectedTable=P(()=>this.state().selectedTable);selectedTables=P(()=>this.state().selectedTables);isDrawing=P(()=>this.state().isDrawing);isMergeMode=P(()=>this.state().isMergeMode);showTableModal=P(()=>this.state().showTableModal);showEditTableModal=P(()=>this.state().showEditTableModal);showMergeModal=P(()=>this.state().showMergeModal);showDimensionsModal=P(()=>this.state().showDimensionsModal);tableForm=P(()=>this.state().tableForm);setFloorPlans(t){this.state.update(e=>x(f({},e),{floorPlans:t}))}setCurrentFloorPlan(t){this.state.update(e=>x(f({},e),{currentFloorPlan:t}))}setTables(t){this.state.update(e=>x(f({},e),{tables:t}))}setSelectedTable(t){this.state.update(e=>x(f({},e),{selectedTable:t}))}setSelectedTables(t){this.state.update(e=>x(f({},e),{selectedTables:t}))}setIsDrawing(t){this.state.update(e=>x(f({},e),{isDrawing:t}))}setIsMergeMode(t){this.state.update(e=>x(f({},e),{isMergeMode:t}))}setShowTableModal(t){this.state.update(e=>x(f({},e),{showTableModal:t}))}setShowEditTableModal(t){this.state.update(e=>x(f({},e),{showEditTableModal:t}))}setShowMergeModal(t){this.state.update(e=>x(f({},e),{showMergeModal:t}))}setShowDimensionsModal(t){this.state.update(e=>x(f({},e),{showDimensionsModal:t}))}updateTableForm(t){this.state.update(e=>x(f({},e),{tableForm:f(f({},e.tableForm),t)}))}resetTableForm(){this.state.update(t=>x(f({},t),{tableForm:this.getDefaultTableForm()}))}addToSelectedTables(t){this.state.update(e=>x(f({},e),{selectedTables:[...e.selectedTables,t]}))}removeFromSelectedTables(t){this.state.update(e=>x(f({},e),{selectedTables:e.selectedTables.filter(n=>n.id!==t)}))}clearSelectedTables(){this.state.update(t=>x(f({},t),{selectedTables:[]}))}initializeTableFormForShape(t){let e=this.getDefaultTableForm();switch(t){case"circle":e.borderRadius=50,e.gridHeight=e.gridWidth;break;case"square":e.borderRadius=12,e.gridHeight=e.gridWidth;break;case"rectangle":e.borderRadius=8;break}this.state.update(n=>x(f({},n),{tableForm:e}))}updateAutoTableNumber(t){this.state.update(e=>x(f({},e),{tableForm:x(f({},e.tableForm),{tableNumber:t.toString()})}))}resetState(){this.state.set({floorPlans:[],currentFloorPlan:null,tables:[],selectedTable:null,selectedTables:[],isDrawing:!1,isMergeMode:!1,showTableModal:!1,showEditTableModal:!1,showMergeModal:!1,showDimensionsModal:!1,tableForm:this.getDefaultTableForm()})}getDefaultTableForm(){return{shape:"rectangle",gridWidth:6,gridHeight:4,capacity:2,borderRadius:8,tableName:"",tableNumber:"",isOnlineBookable:!0}}resetForNewFloorPlan(){this.state.update(t=>x(f({},t),{tables:[],selectedTable:null,selectedTables:[],isDrawing:!1,isMergeMode:!1,showTableModal:!1,showEditTableModal:!1,showMergeModal:!1,showDimensionsModal:!1}))}static \u0275fac=function(e){return new(e||c)};static \u0275prov=B({token:c,factory:c.\u0275fac,providedIn:"root"})};var G=class c{stateService=I(H);tableService=I(X);dragState=null;rafId=null;startTableDrag(t,e,n,i=1){let r=this.tableService.getTables(),s=r.find(D=>D.id===t);if(!s){console.error("\u274C Tavolo non trovato:",t);return}let h=n.getBoundingClientRect(),b=(e.clientX-h.left)/i,v=(e.clientY-h.top)/i;console.log("\u{1F7E2} START DRAG per tavolo:",s.table_number,"scale:",i);let y=this.getTablesInMergeGroup(s,r),V=new Map(y.map(D=>[D.id,{x:D.position_x,y:D.position_y}])),C=D=>{this.dragState?.isDragging&&(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.handlePointerMove(n,D,r,i)}))},R=()=>this.handlePointerUp();this.dragState={isDragging:!0,startX:b,startY:v,initialPositions:V,moveHandler:C,upHandler:R},document.addEventListener("pointermove",C),document.addEventListener("pointerup",R,{once:!0});let N=e.target;if(N)try{N.setPointerCapture(e.pointerId),N.style.touchAction="none"}catch{console.warn("Pointer capture not supported")}}handlePointerMove(t,e,n,i){if(!this.dragState?.isDragging)return;let r=t.getBoundingClientRect(),s=(e.clientX-r.left)/i,h=(e.clientY-r.top)/i,b=s-this.dragState.startX,v=h-this.dragState.startY,y=this.stateService.currentFloorPlan();if(!y)return;let V=this.stateService.tables().map(C=>{let R=this.dragState.initialPositions.get(C.id);if(!R)return C;let N=R.x+b,D=R.y+v;N=Math.round(N/20)*20,D=Math.round(D/20)*20;let ye=y.width-C.width,Ce=y.height-C.height,$=Math.max(0,Math.min(N,ye)),ee=Math.max(0,Math.min(D,Ce)),De=x(f({},C),{position_x:$,position_y:ee}),ke=Array.from(this.dragState.initialPositions.keys());return this.tableService.checkTableOverlap(De,ke)?C:x(f({},C),{position_x:$,position_y:ee})});this.stateService.setTables(V)}handlePointerUp(){return T(this,null,function*(){if(!this.dragState?.isDragging)return;console.log("\u{1F7E2} HANDLE POINTER UP - Saving final positions");let t=[];for(let[e,n]of this.dragState.initialPositions){let i=this.stateService.tables().find(r=>r.id===e);i&&(i.position_x!==n.x||i.position_y!==n.y)&&(console.log(`\u{1F4BE} Saving table ${i.table_number}: (${n.x}, ${n.y}) \u2192 (${i.position_x}, ${i.position_y})`),t.push(this.tableService.updateTable(e,{position_x:i.position_x,position_y:i.position_y})))}try{yield Promise.all(t),console.log("\u2705 All table positions saved successfully")}catch(e){console.error("\u274C Error saving table positions:",e)}this.cleanupDrag()})}cleanupDrag(){this.dragState?.moveHandler&&document.removeEventListener("pointermove",this.dragState.moveHandler),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.dragState=null}getTablesInMergeGroup(t,e){let n=[t];if(t.merged_tables_ids&&t.merged_tables_ids.length>0&&!t.parent_table_id)t.merged_tables_ids.forEach(i=>{let r=e.find(s=>s.id===i);r&&n.push(r)});else if(t.parent_table_id){let i=e.find(r=>r.id===t.parent_table_id);i&&(n.find(r=>r.id===i.id)||n.push(i),i.merged_tables_ids&&i.merged_tables_ids.forEach(r=>{if(r!==t.id){let s=e.find(h=>h.id===r);s&&!n.find(h=>h.id===s.id)&&n.push(s)}}))}return n}handleCanvasClick(t,e){if(!this.stateService.isDrawing())return null;let n=e.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top,s=i,h=r;return s=Math.round(i/20)*20,h=Math.round(r/20)*20,{x:s,y:h}}areTablesAdjacent(t,e,n=10){let i=t.position_x,r=t.position_x+t.width,s=t.position_y,h=t.position_y+t.height,b=e.position_x,v=e.position_x+e.width,y=e.position_y,V=e.position_y+e.height,C=i<=v+n&&r>=b-n,R=s<=V+n&&h>=y-n,N=Math.abs(r-b)<=n||Math.abs(i-v)<=n,D=Math.abs(h-y)<=n||Math.abs(s-V)<=n;return N&&R||D&&C}areSelectedTablesAdjacent(t,e){if(t.length<2)return!0;let n=new Map;t.forEach(s=>{n.set(s.id,[])});for(let s=0;s<t.length;s++)for(let h=s+1;h<t.length;h++)this.areTablesAdjacent(t[s],t[h])&&(n.get(t[s].id).push(t[h].id),n.get(t[h].id).push(t[s].id));let i=new Set,r=[t[0].id];for(;r.length>0;){let s=r.shift();i.has(s)||(i.add(s),(n.get(s)||[]).forEach(b=>{i.has(b)||r.push(b)}))}return i.size===t.length}getAdjacentTablesToSelection(t,e){if(t.length===0)return[];let n=[],i=t.map(r=>r.id);return e.forEach(r=>{if(!(i.includes(r.id)||r.is_merged)){for(let s of t)if(this.areTablesAdjacent(r,s)){n.push(r);break}}}),n}showAdjacencyWarning(t,e){let n=`Il Tavolo ${t.table_number} non \xE8 vicino ai tavoli selezionati. 
  Seleziona solo tavoli che si toccano tra loro.`;alert(n)}findTableAtPosition(t,e,n){for(let r of t){let s=r.position_x,h=r.position_x+r.width,b=r.position_y,v=r.position_y+r.height;if(e>=s-15&&e<=h+15&&n>=b-15&&n<=v+15)return r}return null}static \u0275fac=function(e){return new(e||c)};static \u0275prov=B({token:c,factory:c.\u0275fac,providedIn:"root"})};var Ve=["floorPlanCanvas"],Ie=["canvasContainer"];function Ne(c,t){if(c&1&&(a(0,"option",44),l(1),o()),c&2){let e=t.$implicit;_("ngValue",e.id),d(),j(" ",e.name," (",e.width,"\xD7",e.height,") ")}}function Re(c,t){if(c&1){let e=F();a(0,"div",45)(1,"div",12)(2,"input",46),E("ngModelChange",function(i){m(e);let r=p();return w(r.editedFloorPlanName,i)||(r.editedFloorPlanName=i),u(i)}),g("keyup.enter",function(){m(e);let i=p();return u(i.saveFloorPlanName())})("keyup.escape",function(){m(e);let i=p();return u(i.cancelEditFloorPlanName())}),o(),a(3,"div",4)(4,"button",47),g("click",function(){m(e);let i=p();return u(i.saveFloorPlanName())}),a(5,"span",17),l(6,"check"),o()(),a(7,"button",48),g("click",function(){m(e);let i=p();return u(i.cancelEditFloorPlanName())}),a(8,"span",17),l(9,"close"),o()()()(),a(10,"div",49),l(11," Premi Invio per salvare, Esc per annullare "),o()()}if(c&2){let e=p();d(2),S("ngModel",e.editedFloorPlanName)}}function ze(c,t){if(c&1){let e=F();a(0,"div",4)(1,"button",63),g("click",function(){m(e);let i=p(2);return u(i.rotateToAngle(0))}),a(2,"span",17),l(3,"north"),o()(),a(4,"button",64),g("click",function(){m(e);let i=p(2);return u(i.rotateToAngle(90))}),a(5,"span",17),l(6,"east"),o()(),a(7,"button",65),g("click",function(){m(e);let i=p(2);return u(i.rotateToAngle(180))}),a(8,"span",17),l(9,"south"),o()(),a(10,"button",66),g("click",function(){m(e);let i=p(2);return u(i.rotateToAngle(270))}),a(11,"span",17),l(12,"west"),o()()()}}function We(c,t){c&1&&(a(0,"div",67)(1,"span",68),l(2,"info"),o(),l(3," Premi Ctrl + rotellina del mouse per ruotare di \xB15\xB0 "),o())}function Ae(c,t){if(c&1){let e=F();a(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",53)(4,"span",17),l(5,"rotate_right"),o(),a(6,"div")(7,"strong"),l(8,"Rotazione Tavolo"),o(),a(9,"div",7),l(10,"Ruota il tavolo selezionato"),o()()(),a(11,"div",12),k(12,ze,13,0,"div",54),a(13,"div",55)(14,"button",56),g("click",function(){m(e);let i=p();return u(i.rotateSelectedTable(-30))}),a(15,"span",17),l(16,"rotate_left"),o()(),a(17,"div",57)(18,"span",58),l(19),o(),a(20,"span",59),l(21,"Rotazione"),o()(),a(22,"button",60),g("click",function(){m(e);let i=p();return u(i.rotateSelectedTable(30))}),a(23,"span",17),l(24,"rotate_right"),o()()(),a(25,"button",61),g("click",function(){m(e);let i=p();return u(i.rotateToAngle(0))}),a(26,"span",17),l(27,"restart_alt"),o()()()(),k(28,We,4,0,"div",62),o()()}if(c&2){let e=p();d(12),_("ngIf",!e.isMobileView()),d(2),_("disabled",e.isRotating),d(5),M("",e.selectedTable().rotation||0,"\xB0"),d(3),_("disabled",e.isRotating),d(3),_("disabled",e.isRotating),d(3),_("ngIf",e.selectedTable()&&!e.isDrawing()&&!e.isMobileView())}}function Be(c,t){c&1&&(a(0,"span",73),l(1," Unito "),o())}function Oe(c,t){if(c&1){let e=F();a(0,"button",74),g("click",function(){m(e);let i=p(2);return u(i.onSplitTable(i.selectedTable()))}),a(1,"span",17),l(2,"call_split"),o(),l(3," Separa "),o()}}function He(c,t){if(c&1){let e=F();a(0,"div",69)(1,"div",52)(2,"div",70)(3,"strong"),l(4,"Tavolo Selezionato"),o(),a(5,"span",7),l(6),k(7,Be,2,0,"span",71),o()(),a(8,"div",4)(9,"button",28),g("click",function(){m(e);let i=p();return u(i.openEditTableModal())}),a(10,"span",17),l(11,"edit"),o(),l(12," Modifica "),o(),k(13,Oe,4,0,"button",72),a(14,"button",31),g("click",function(){m(e);let i=p();return u(i.deselectAll())}),a(15,"span",17),l(16,"close"),o(),l(17," Deseleziona "),o()()()()}if(c&2){let e=p();d(6),L(" Tavolo ",e.selectedTable().table_number," - ",e.selectedTable().capacity," persone "),d(),_("ngIf",e.selectedTable().merged_tables_ids&&e.selectedTable().merged_tables_ids.length>0),d(6),_("ngIf",e.selectedTable().merged_tables_ids&&e.selectedTable().merged_tables_ids.length>0)}}function Le(c,t){if(c&1&&U(0,"div",81),c&2){let e=p(2);O("background-size",e.gridSize,"px")}}function je(c,t){if(c&1){let e=F();a(0,"div",82),g("pointerdown",function(i){let r=m(e).$implicit,s=p(2);return u(s.onTablePointerDown(i,r))}),a(1,"div",83)(2,"div",84),l(3),o(),a(4,"div",85),l(5),o()()()}if(c&2){let e=t.$implicit,n=p(2);oe(n.getTableStyle(e)),re(n.getTableClass(e)),ae("data-table-id",e.id),d(3),A(e.table_number),d(2),M("",e.capacity," p")}}function Ye(c,t){c&1&&(a(0,"div",86)(1,"span",17),l(2,"table_restaurant"),o(),a(3,"h3"),l(4,"Nessun tavolo configurato"),o(),a(5,"p"),l(6,'Clicca su "Aggiungi" per creare il primo tavolo'),o()())}function Xe(c,t){if(c&1){let e=F();a(0,"div",75)(1,"div",76,1),g("click",function(i){m(e);let r=p();return u(r.onCanvasClick(i))}),U(3,"div",77),k(4,Le,1,2,"div",78)(5,je,6,7,"div",79)(6,Ye,7,0,"div",80),o()()}if(c&2){let e=p();d(),O("width",e.floorPlanWidth(),"px")("height",e.floorPlanHeight(),"px")("transform","scale("+e.canvasScale()+")")("transform-origin","center center"),d(3),_("ngIf",e.snapToGrid),d(),_("ngForOf",e.tables())("ngForTrackBy",e.trackByTableId),d(),_("ngIf",e.tables().length===0)}}function qe(c,t){if(c&1){let e=F();a(0,"div",87)(1,"span",17),l(2,"map"),o(),a(3,"h3"),l(4,"Nessuna mappa selezionata"),o(),a(5,"p"),l(6,"Crea una nuova mappa o seleziona una esistente"),o(),a(7,"button",88),g("click",function(){m(e);let i=p();return u(i.createNewFloorPlan())}),a(8,"span",17),l(9,"add"),o(),l(10," Crea Nuova Mappa "),o()()}}function Ge(c,t){if(c&1){let e=F();a(0,"div",10)(1,"label",11),l(2,"Border Radius (px)"),o(),a(3,"input",114),E("ngModelChange",function(i){m(e);let r=p(2);return w(r.selectedTable().border_radius,i)||(r.selectedTable().border_radius=i),u(i)}),o(),a(4,"div",115)(5,"span"),l(6,"0px (spigoli vivi)"),o(),a(7,"span")(8,"strong"),l(9),o()(),a(10,"span"),l(11,"50px (molto arrotondato)"),o()()()}if(c&2){let e=p(2);d(3),S("ngModel",e.selectedTable().border_radius),d(6),M("",e.selectedTable().border_radius||0,"px")}}function Ue(c,t){c&1&&(a(0,"div",10)(1,"div",116)(2,"span",17),l(3,"info"),o(),a(4,"span"),l(5,"Per i tavoli circolari il border radius \xE8 automaticamente impostato al 50%"),o()()())}function Ze(c,t){if(c&1){let e=F();a(0,"div",8)(1,"div",117)(2,"strong"),l(3,"Tavolo Unito"),o(),a(4,"span",7),l(5,"Questo tavolo \xE8 composto da pi\xF9 tavoli uniti insieme"),o(),a(6,"button",118),g("click",function(){m(e);let i=p(2);return u(i.onSplitTable(i.selectedTable()))}),a(7,"span",17),l(8,"call_split"),o(),l(9," Separa Tavolo "),o()()()}}function Qe(c,t){if(c&1){let e=F();a(0,"div",89)(1,"div",90)(2,"div",91)(3,"div",53)(4,"div",92)(5,"span",17),l(6,"edit"),o()(),a(7,"div")(8,"h1",6),l(9),o()()(),a(10,"button",93),g("click",function(){m(e);let i=p();return u(i.deselectAll())}),a(11,"span",17),l(12,"close"),o()()(),a(13,"div")(14,"form",94)(15,"div",8)(16,"div",95)(17,"div",10)(18,"label",11),l(19,"Nome Tavolo"),o(),a(20,"input",96),E("ngModelChange",function(i){m(e);let r=p();return w(r.selectedTable().table_name,i)||(r.selectedTable().table_name=i),u(i)}),o()()(),a(21,"div",95)(22,"div",10)(23,"label",11),l(24,"Numero"),o(),a(25,"input",97),E("ngModelChange",function(i){m(e);let r=p();return w(r.selectedTable().table_number,i)||(r.selectedTable().table_number=i),u(i)}),o()(),a(26,"div",10)(27,"label",11),l(28,"Capacit\xE0"),o(),a(29,"input",98),E("ngModelChange",function(i){m(e);let r=p();return w(r.selectedTable().capacity,i)||(r.selectedTable().capacity=i),u(i)}),o()()(),a(30,"div",95)(31,"div",10)(32,"label",11),l(33,"Larghezza (px)"),o(),a(34,"input",99),E("ngModelChange",function(i){m(e);let r=p();return w(r.selectedTable().width,i)||(r.selectedTable().width=i),u(i)}),g("change",function(){m(e);let i=p();return u(i.onDimensionChange())}),o(),a(35,"span",7),l(36,"Min: 20px, Max: 1000px"),o()(),a(37,"div",10)(38,"label",11),l(39,"Altezza (px)"),o(),a(40,"input",100),E("ngModelChange",function(i){m(e);let r=p();return w(r.selectedTable().height,i)||(r.selectedTable().height=i),u(i)}),g("change",function(){m(e);let i=p();return u(i.onDimensionChange())}),o(),a(41,"span",7),l(42,"Min: 20px, Max: 1000px"),o()()(),a(43,"div",95),k(44,Ge,12,2,"div",101)(45,Ue,6,0,"div",101),o(),a(46,"div",102)(47,"strong"),l(48,"Anteprima"),o(),a(49,"div",103)(50,"div",104)(51,"div",105)(52,"span",84),l(53),o(),a(54,"span",85),l(55),o()()()(),a(56,"div",106),l(57),o()(),a(58,"div",10)(59,"label",107)(60,"input",108),E("ngModelChange",function(i){m(e);let r=p();return w(r.selectedTable().is_online_bookable,i)||(r.selectedTable().is_online_bookable=i),u(i)}),o(),a(61,"div",26)(62,"strong"),l(63,"Prenotabile online"),o(),a(64,"span",7),l(65,"Se deselezionato, prenotabile solo dal personale"),o()()()(),k(66,Ze,10,0,"div",109),o(),a(67,"div",110)(68,"button",111),g("click",function(){m(e);let i=p();return u(i.deselectAll())}),l(69," Annulla "),o(),a(70,"button",112),g("click",function(){m(e);let i=p();return u(i.onUpdateTable())}),a(71,"span",17),l(72,"save"),o(),l(73," Aggiorna "),o(),a(74,"button",113),g("click",function(){m(e);let i=p();return u(i.onDeleteTable())}),a(75,"span",17),l(76,"delete"),o(),l(77," Elimina Tavolo "),o()()()()()()}if(c&2){let e=p();d(9),M("Modifica Tavolo ",e.selectedTable().table_number),d(11),S("ngModel",e.selectedTable().table_name),d(5),S("ngModel",e.selectedTable().table_number),d(4),S("ngModel",e.selectedTable().capacity),d(5),S("ngModel",e.selectedTable().width),d(6),S("ngModel",e.selectedTable().height),_("disabled",e.selectedTable().shape==="circle"),d(4),_("ngIf",e.selectedTable().shape!=="circle"),d(),_("ngIf",e.selectedTable().shape==="circle"),d(5),O("width",e.selectedTable().width,"px")("height",e.selectedTable().height,"px")("border-radius",e.getEditPreviewBorderRadius()),W("shape-circle",e.selectedTable().shape==="circle"),d(3),A(e.selectedTable().table_number),d(2),M("",e.selectedTable().capacity," p"),d(2),j(" ",e.selectedTable().width," \xD7 ",e.selectedTable().height," px | Border Radius: ",e.getEditPreviewBorderRadiusValue()," "),d(3),S("ngModel",e.selectedTable().is_online_bookable),d(6),_("ngIf",e.selectedTable().is_merged)}}function Ke(c,t){if(c&1){let e=F();a(0,"div",126),g("click",function(){let i=m(e).$implicit,r=p(2);return u(r.onShapeSelect(i))}),a(1,"div",127)(2,"span",17),l(3),o(),a(4,"strong"),l(5),o()()()}if(c&2){let e=t.$implicit,n=p(2);W("active",n.tableForm().shape===e.type),d(3),A(e.icon),d(2),A(e.name)}}function Je(c,t){if(c&1){let e=F();a(0,"div",10)(1,"label",11),l(2,"Bordo"),o(),a(3,"input",114),E("ngModelChange",function(i){m(e);let r=p(2);return w(r.tableForm().borderRadius,i)||(r.tableForm().borderRadius=i),u(i)}),o(),a(4,"div",115)(5,"span"),l(6,"0px (spigoli vivi)"),o(),a(7,"span"),l(8),o(),a(9,"span"),l(10,"50px (molto arrotondato)"),o()()()}if(c&2){let e=p(2);d(3),S("ngModel",e.tableForm().borderRadius),d(5),M("",e.tableForm().borderRadius,"px")}}function $e(c,t){c&1&&(a(0,"div",10)(1,"div",116)(2,"span",17),l(3,"info"),o(),a(4,"span"),l(5,"Per i tavoli circolari il border radius \xE8 automaticamente impostato al 50%"),o()()())}function et(c,t){if(c&1){let e=F();a(0,"div",89)(1,"div",90)(2,"div",91)(3,"div",53)(4,"div",92)(5,"span",17),l(6,"add_circle"),o()(),a(7,"div")(8,"h1",6),l(9,"Crea Nuovo Tavolo"),o()()(),a(10,"button",93),g("click",function(){m(e);let i=p();return u(i.onCancelCreateTable())}),a(11,"span",17),l(12,"close"),o()()(),a(13,"div",70)(14,"form")(15,"div",8)(16,"div",119)(17,"label",11),l(18,"Forma del Tavolo"),o(),a(19,"div",120),k(20,Ke,6,4,"div",121),o()(),a(21,"div",95)(22,"div",10)(23,"label",11),l(24,"Larghezza (quadrati)"),o(),a(25,"input",122),E("ngModelChange",function(i){m(e);let r=p();return w(r.tableForm().gridWidth,i)||(r.tableForm().gridWidth=i),u(i)}),o(),a(26,"span",7),l(27),o()(),a(28,"div",10)(29,"label",11),l(30,"Altezza (quadrati)"),o(),a(31,"input",123),E("ngModelChange",function(i){m(e);let r=p();return w(r.tableForm().gridHeight,i)||(r.tableForm().gridHeight=i),u(i)}),o(),a(32,"span",7),l(33),o()()(),a(34,"div",95),k(35,Je,11,2,"div",101)(36,$e,6,0,"div",101),o(),a(37,"div",27)(38,"div",10)(39,"label",11),l(40,"Numero Tavolo"),o(),a(41,"input",124),E("ngModelChange",function(i){m(e);let r=p();return w(r.tableForm().tableNumber,i)||(r.tableForm().tableNumber=i),u(i)}),o()(),a(42,"div",10)(43,"label",11),l(44,"Capacit\xE0"),o(),a(45,"input",125),E("ngModelChange",function(i){m(e);let r=p();return w(r.tableForm().capacity,i)||(r.tableForm().capacity=i),u(i)}),o()()(),a(46,"div",102)(47,"strong"),l(48,"Anteprima"),o(),a(49,"div",103)(50,"div",104)(51,"div",105)(52,"span",84),l(53),o(),a(54,"span",85),l(55),o()()()(),a(56,"div",106),l(57),o()()(),a(58,"div",110)(59,"button",111),g("click",function(){m(e);let i=p();return u(i.onCancelCreateTable())}),l(60," Annulla "),o(),a(61,"button",112),g("click",function(){m(e);let i=p();return u(i.onCreateTable())}),a(62,"span",17),l(63,"add"),o(),l(64," Crea Tavolo "),o()()()()()()}if(c&2){let e=p();d(20),_("ngForOf",e.tableShapes),d(5),S("ngModel",e.tableForm().gridWidth),_("disabled",e.tableForm().shape==="circle"),d(2),M("1 quadrato = ",e.gridSize,"px"),d(4),S("ngModel",e.tableForm().gridHeight),_("disabled",e.tableForm().shape==="circle"||e.tableForm().shape==="square"),d(2),M("1 quadrato = ",e.gridSize,"px"),d(2),_("ngIf",e.tableForm().shape!=="circle"),d(),_("ngIf",e.tableForm().shape==="circle"),d(5),S("ngModel",e.tableForm().tableNumber),d(4),S("ngModel",e.tableForm().capacity),d(5),O("width",e.tableForm().gridWidth*20,"px")("height",e.tableForm().gridHeight*20,"px")("border-radius",e.getPreviewBorderRadius()),W("shape-circle",e.tableForm().shape==="circle"),d(3),A(e.tableForm().tableNumber||"1"),d(2),M("",e.tableForm().capacity," p"),d(2),j(" ",e.tableForm().gridWidth*e.gridSize," \xD7 ",e.tableForm().gridHeight*e.gridSize," px | Border Radius: ",e.getPreviewBorderRadiusValue()," ")}}function tt(c,t){if(c&1){let e=F();a(0,"div",89)(1,"div",90)(2,"div",91)(3,"div",128)(4,"div",92)(5,"span",129),l(6,"aspect_ratio"),o()(),a(7,"h1",130),l(8,"Dimensioni Sala"),o()(),a(9,"button",93),g("click",function(){m(e);let i=p();return u(i.onCancelDimensionsModal())}),a(10,"span",17),l(11,"close"),o()()(),a(12,"div",131)(13,"form",94)(14,"div",95)(15,"div",10)(16,"label",11),l(17,"Larghezza (px)"),o(),a(18,"input",132),E("ngModelChange",function(i){m(e);let r=p();return w(r.dimensionsForm.width,i)||(r.dimensionsForm.width=i),u(i)}),o(),a(19,"span",7),l(20,"Min: 500px, Max: 5000px"),o()(),a(21,"div",10)(22,"label",11),l(23,"Altezza (px)"),o(),a(24,"input",133),E("ngModelChange",function(i){m(e);let r=p();return w(r.dimensionsForm.height,i)||(r.dimensionsForm.height=i),u(i)}),o(),a(25,"span",7),l(26,"Min: 500px, Max: 5000px"),o()()(),a(27,"div",119)(28,"label",134),l(29,"Dimensioni Predefinite"),o(),a(30,"div",4)(31,"button",135),g("click",function(){m(e);let i=p();return u(i.setDimensions(1e3,800))}),l(32," Piccola (1000\xD7800) "),o(),a(33,"button",135),g("click",function(){m(e);let i=p();return u(i.setDimensions(1500,1200))}),l(34," Media (1500\xD71200) "),o(),a(35,"button",135),g("click",function(){m(e);let i=p();return u(i.setDimensions(2e3,1600))}),l(36," Grande (2000\xD71600) "),o()()(),a(37,"div",102)(38,"strong",136),l(39,"Anteprima Dimensioni"),o(),a(40,"div",137)(41,"div",138)(42,"div",139),l(43),o()()()(),a(44,"div",110)(45,"button",111),g("click",function(){m(e);let i=p();return u(i.onCancelDimensionsModal())}),l(46," Annulla "),o(),a(47,"button",112),g("click",function(){m(e);let i=p();return u(i.onSaveDimensions())}),a(48,"span",17),l(49,"save"),o(),l(50," Salva Dimensioni "),o()()()()()()}if(c&2){let e=p();d(18),S("ngModel",e.dimensionsForm.width),d(6),S("ngModel",e.dimensionsForm.height),d(17),O("width",e.dimensionsForm.width*.1,"px")("height",e.dimensionsForm.height*.1,"px"),d(2),L(" ",e.dimensionsForm.width," \xD7 ",e.dimensionsForm.height," px ")}}function it(c,t){if(c&1&&(a(0,"div",147)(1,"span",17),l(2,"table_restaurant"),o(),a(3,"div",148)(4,"strong"),l(5),o(),a(6,"div",7),l(7),o()()()),c&2){let e=t.$implicit;d(5),M("Tavolo ",e.table_number),d(2),M("",e.capacity," persone")}}function nt(c,t){if(c&1){let e=F();a(0,"div",89)(1,"div",90)(2,"div",91)(3,"div",53)(4,"div",92)(5,"span",17),l(6,"merge"),o()(),a(7,"div")(8,"h1",6),l(9,"Unisci Tavoli"),o()()(),a(10,"button",93),g("click",function(){m(e);let i=p();return u(i.closeMergeModal())}),a(11,"span",17),l(12,"close"),o()()(),a(13,"div")(14,"form",94)(15,"div",119)(16,"label",11),l(17,"Tavoli da unire"),o(),a(18,"div",117),k(19,it,8,2,"div",140),o()(),a(20,"div",95)(21,"div",10)(22,"label",11),l(23,"Numero Nuovo Tavolo"),o(),a(24,"input",141),E("ngModelChange",function(i){m(e);let r=p();return w(r.mergeForm.tableNumber,i)||(r.mergeForm.tableNumber=i),u(i)}),o()(),a(25,"div",10)(26,"label",11),l(27,"Capacit\xE0 Totale"),o(),a(28,"input",142),E("ngModelChange",function(i){m(e);let r=p();return w(r.mergeForm.capacity,i)||(r.mergeForm.capacity=i),u(i)}),o()()(),a(29,"div",10)(30,"label",11),l(31,"Nome Tavolo Unito"),o(),a(32,"input",143),E("ngModelChange",function(i){m(e);let r=p();return w(r.mergeForm.tableName,i)||(r.mergeForm.tableName=i),u(i)}),o()(),a(33,"div",8)(34,"div",144),l(35,"Riepilogo Capacit\xE0"),o(),a(36,"div",145)(37,"span",7),l(38,"Capacit\xE0 originale:"),o(),a(39,"span"),l(40),o()(),a(41,"div",146)(42,"span",7),l(43,"Nuova capacit\xE0:"),o(),a(44,"span"),l(45),o()()(),a(46,"div",110)(47,"button",111),g("click",function(){m(e);let i=p();return u(i.closeMergeModal())}),l(48," Annulla "),o(),a(49,"button",112),g("click",function(){m(e);let i=p();return u(i.onMergeTables())}),a(50,"span",17),l(51,"merge"),o(),l(52," Crea Tavolo Unito "),o()()()()()()}if(c&2){let e=p();d(19),_("ngForOf",e.selectedTables()),d(5),S("ngModel",e.mergeForm.tableNumber),d(4),S("ngModel",e.mergeForm.capacity),d(4),S("ngModel",e.mergeForm.tableName),d(8),M("",e.getTotalCapacity()," persone"),d(5),M("",e.mergeForm.capacity," persone")}}var Fe=class c{floorPlanService=I(Me);tableService=I(X);tableMergeService=I(q);authService=I(ce);supabaseService=I(Y);stateService=I(H);interactionService=I(G);renderer=I(ie);canvasRef;containerRef;isDragging=!1;isRotating=!1;resizeObserver;destroyed=!1;subscriptions=new te;currentRestaurantId=null;canvasScale=z(1);containerWidth=z(0);containerHeight=z(0);isMobileView=z(!1);userZoomed=z(!1);floorPlanWidth=P(()=>this.currentFloorPlan()?.width||1e3);floorPlanHeight=P(()=>this.currentFloorPlan()?.height||800);visualWidth=P(()=>this.floorPlanWidth()*this.canvasScale());visualHeight=P(()=>this.floorPlanHeight()*this.canvasScale());floorPlans=this.stateService.floorPlans;currentFloorPlan=this.stateService.currentFloorPlan;tables=this.stateService.tables;selectedTable=this.stateService.selectedTable;selectedTables=this.stateService.selectedTables;isDrawing=this.stateService.isDrawing;isMergeMode=this.stateService.isMergeMode;showTableModal=this.stateService.showTableModal;showEditTableModal=this.stateService.showEditTableModal;showMergeModal=this.stateService.showMergeModal;showDimensionsModal=this.stateService.showDimensionsModal;tableForm=this.stateService.tableForm;currentFloorPlanId=P(()=>this.currentFloorPlan()?.id||null);gridSize=20;snapToGrid=!0;isLargeText=!1;isEditingFloorPlanName=!1;modalPosition={x:0,y:0};dimensionsForm={width:1e3,height:800};mergeForm={tableName:"",tableNumber:"",capacity:4};editingFloorPlan=null;editedFloorPlanName="";tableShapes=[];visualGridSize=P(()=>20/this.canvasScale());ngOnInit(){return T(this,null,function*(){console.log("\u{1F3C1} FloorPlanEditor ngOnInit"),this.tableShapes=this.floorPlanService.getTableShapes(),yield this.loadInitialData(),this.subscriptions.add(this.floorPlanService.data$.subscribe(e=>{if(this.stateService.setFloorPlans(e),e.length>0){let n=this.currentFloorPlan();if(!n||!e.find(i=>i.id===n.id)){let i=e[0];this.stateService.setCurrentFloorPlan(i),this.loadTablesForFloorPlan()}}else e.length===0&&this.createDefaultFloorPlan()})),this.subscriptions.add(this.tableService.data$.subscribe(()=>{!this.isRotating&&!this.isDragging&&this.loadTablesForFloorPlan()}));let t=this.generateNextTableNumber();this.stateService.updateAutoTableNumber(t)})}loadInitialData(){return T(this,null,function*(){try{let t=this.authService.currentUserValue;if(t){let{data:e,error:n}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",t.id).limit(1);if(n){console.error("\u274C Error loading restaurants:",n);return}e&&e.length>0&&(this.currentRestaurantId=e[0].id)}yield this.floorPlanService.loadData(),yield this.tableService.loadData()}catch(t){console.error("\u{1F4A5} Error in loadInitialData:",t)}})}ngAfterViewInit(){setTimeout(()=>{if(!this.canvasRef||!this.containerRef){console.warn("Elementi non disponibili, riprovo..."),setTimeout(()=>this.ngAfterViewInit(),100);return}this.setupCanvasInteractions(),this.setupResponsiveCanvas(),this.setupPinchToZoom(),this.updateCanvasDimensions()},300)}ngOnDestroy(){this.subscriptions.unsubscribe(),this.resizeObserver&&this.resizeObserver.disconnect(),this.destroyed=!0}setupResponsiveCanvas(){let t=this.containerRef?.nativeElement;t&&(this.resizeObserver=new ResizeObserver(e=>{for(let n of e)this.containerWidth.set(n.contentRect.width),this.containerHeight.set(n.contentRect.height),this.isMobileView.set(n.contentRect.width<768),this.updateCanvasDimensions()}),this.resizeObserver.observe(t))}canvasWidth=z(1e3);canvasHeight=z(800);updateCanvasDimensions(){let t=this.containerWidth(),e=this.containerHeight();if(t===0||e===0)return;let n=this.currentFloorPlan();if(n){if(!this.userZoomed()){let i=this.isMobileView()?20:40,r=t-i,s=e-i,h=r/n.width,b=s/n.height,v=Math.min(h,b);v=Math.max(.1,Math.min(v,2)),this.canvasScale.set(v)}this.canvasWidth.set(n.width),this.canvasHeight.set(n.height),console.log("\u{1F4D0} Canvas updated:",{userZoomed:this.userZoomed(),container:`${t}x${e}`,floorPlan:`${n.width}x${n.height}`,scale:this.canvasScale(),visual:`${this.visualWidth()}x${this.visualHeight()}`})}}refreshCanvasSize(){this.updateCanvasDimensions()}zoomIn(){let t=Math.min(this.canvasScale()*1.2,3);this.canvasScale.set(t),this.userZoomed.set(!0)}zoomOut(){let t=Math.max(this.canvasScale()*.8,.1);this.canvasScale.set(t),this.userZoomed.set(!0)}resetCanvasZoom(){this.userZoomed.set(!1),this.updateCanvasDimensions()}loadTablesForFloorPlan(){let t=this.currentFloorPlan();if(!t){this.stateService.setTables([]);return}let e=this.tableService.getVisibleTablesByFloorPlan(t.id);console.log("\u{1F4CA} Loading tables for floor plan:",{floorPlanId:t.id,floorPlanName:t.name,tablesCount:e.length,tables:e.map(n=>({id:n.id,number:n.table_number}))}),this.stateService.setTables(e)}onFloorPlanSelect(t){this.isEditingFloorPlanName&&this.cancelEditFloorPlanName(),this.userZoomed.set(!1),this.stateService.setCurrentFloorPlan(t),this.loadTablesForFloorPlan(),this.deselectAll(),this.cancelEditFloorPlan(),setTimeout(()=>this.updateCanvasDimensions(),50)}onFloorPlanSelectById(t){let e=this.floorPlans().find(n=>n.id===t);e&&this.onFloorPlanSelect(e)}selectTable(t){if(this.isMergeMode()){this.toggleTableSelection(t);return}this.deselectAll(),this.stateService.setSelectedTable(t)}deselectAll(){this.stateService.setSelectedTable(null),this.stateService.setShowEditTableModal(!1)}openEditTableModal(t){(t||this.selectedTable())&&(t&&t.id!==this.selectedTable()?.id&&this.stateService.setSelectedTable(t),this.stateService.setShowEditTableModal(!0))}onUpdateTable(){return T(this,null,function*(){let t=this.selectedTable();if(!(!t||!this.currentFloorPlan()))try{let e=this.currentFloorPlan();if(t.position_x<0||t.position_y<0||t.position_x+t.width>e.width||t.position_y+t.height>e.height){alert("Il tavolo esce dai confini della mappa. Riduci le dimensioni o sposta il tavolo.");return}if(this.tables().filter(b=>b.id!==t.id).some(b=>this.checkTablesOverlap(t,b))){alert("Il tavolo si sovrappone a un altro tavolo. Modifica le dimensioni o la posizione.");return}let s=x(f({},t),{border_radius:t.border_radius||0,width:t.width,height:t.height});(yield this.tableService.updateTable(t.id,s))?(console.log("\u2705 Tavolo aggiornato con successo"),this.deselectAll()):console.error("\u274C Errore nell'aggiornamento del tavolo")}catch(e){console.error("\u274C Error updating table:",e)}})}onDeleteTable(){return T(this,null,function*(){let t=this.selectedTable();if(t&&confirm("Sei sicuro di voler eliminare questo tavolo?"))try{(yield this.tableService.deleteTable(t.id))&&this.deselectAll()}catch(e){console.error("\u274C Error deleting table:",e)}})}onShapeSelect(t){this.stateService.initializeTableFormForShape(t.type)}onCreateTable(){return T(this,null,function*(){let t=this.currentFloorPlan();if(!t||!this.currentRestaurantId){console.error("\u274C Missing required data");return}try{let e=this.tableForm(),n=e.gridWidth*this.gridSize,i=e.gridHeight*this.gridSize,r={restaurant_id:this.currentRestaurantId,floor_plan_id:t.id,table_name:e.tableName||`Tavolo ${e.tableNumber}`,table_number:e.tableNumber,capacity:e.capacity,shape:e.shape,position_x:this.modalPosition.x,position_y:this.modalPosition.y,width:n,height:i,rotation:0,is_active:!0,is_online_bookable:!0,is_merged:!1,parent_table_id:null,merged_tables_ids:[],border_radius:e.borderRadius};if(this.tableService.checkTableOverlap(r)){alert("Il tavolo si sovrappone a un altro tavolo. Scegli una posizione diversa.");return}console.log("\u{1F4DD} Creating table:",r),(yield this.tableService.createTable(r))?(console.log("\u2705 Table created successfully"),this.stateService.setShowTableModal(!1),this.stateService.setIsDrawing(!1)):console.error("\u274C Table creation failed")}catch(e){console.error("\u{1F4A5} Error creating table:",e)}})}onCancelCreateTable(){this.stateService.setShowTableModal(!1),this.stateService.setIsDrawing(!1)}createNewFloorPlan(){return T(this,null,function*(){if(this.currentRestaurantId)try{let t=this.floorPlanService.getDefaultDimensions(),e={restaurant_id:this.currentRestaurantId,name:`Mappa ${this.floorPlans().length+1}`,width:t.width,height:t.height,is_active:!0},n=yield this.floorPlanService.createFloorPlan(e);n&&(this.stateService.resetForNewFloorPlan(),this.stateService.setCurrentFloorPlan(n),this.stateService.setTables([]),this.userZoomed.set(!1),setTimeout(()=>{this.openDimensionsModal(),setTimeout(()=>this.updateCanvasDimensions(),50)},100))}catch(t){console.error("\u{1F4A5} Error creating floor plan:",t)}})}onDeleteFloorPlan(t,e){return T(this,null,function*(){if(e.stopPropagation(),!!confirm(`Sei sicuro di voler eliminare la mappa "${t.name}"?`))try{if((yield this.floorPlanService.deleteFloorPlan(t.id))&&this.currentFloorPlan()?.id===t.id){let i=this.floorPlans().find(r=>r.id!==t.id)||null;this.stateService.setCurrentFloorPlan(i),this.loadTablesForFloorPlan()}}catch(n){console.error("\u{1F4A5} Error deleting floor plan:",n)}})}rotateSelectedTable(t=30){return T(this,null,function*(){let e=this.selectedTable();if(!(!e||this.isRotating)){this.isRotating=!0;try{let n=this.getMainTableForRotation(e);if(!n)throw new Error("Tavolo non valido per la rotazione");console.log("\u{1F504} Rotazione tavolo:",n.table_number,"di",t,"gradi");let r=this.stateService.tables().map(b=>{if(b.id===n.id){let v=(b.rotation+t)%360;return console.log("\u{1F4D0} Nuova rotazione per",b.table_number,":",v),x(f({},b),{rotation:v})}return b});if(this.stateService.setTables(r),!(yield this.tableService.rotateTable(n.id,n.rotation+t)))throw new Error("Errore nel salvataggio della rotazione");console.log("\u2705 Tavolo ruotato con successo");let h=r.find(b=>b.id===e.id);h&&this.stateService.setSelectedTable(h)}catch(n){console.error("\u274C Errore nella rotazione del gruppo:",n);try{yield this.tableService.loadData(),this.loadTablesForFloorPlan()}catch(i){console.error("\u274C Errore nel ricaricare i dati:",i)}alert("Errore durante la rotazione: "+(n.message||"Errore sconosciuto"))}finally{this.isRotating=!1}}})}getMainTableForRotation(t){let e=this.tableService.getAllTablesByFloorPlan(this.currentFloorPlan().id);if(console.log("\u{1F50D} Cerca tavolo principale per rotazione:",{tableId:t.id,isMerged:t.is_merged,parentId:t.parent_table_id}),t.parent_table_id){console.log("\u{1F476} Tavolo figlio, cerco il parent");let n=e.find(i=>i.id===t.parent_table_id);if(n)return console.log("\u2705 Trovato parent:",n.id),n}return console.log("\u2705 Usa il tavolo stesso come principale"),t}updateTablesRotationLocal(t,e){return this.stateService.tables().map(i=>{if(t.find(s=>s.id===i.id)){let s=(i.rotation+e)%360;return x(f({},i),{rotation:s})}return i})}getTablesInRotationGroup(t){let e=this.tableService.getAllTablesByFloorPlan(this.currentFloorPlan().id),n=[t];if(t.merged_tables_ids&&t.merged_tables_ids.length>0&&!t.parent_table_id)t.merged_tables_ids.forEach(r=>{let s=e.find(h=>h.id===r);s&&n.push(s)});else if(t.parent_table_id){let r=e.find(s=>s.id===t.parent_table_id);r&&(n.push(r),r.merged_tables_ids&&r.merged_tables_ids.forEach(s=>{if(s!==t.id){let h=e.find(b=>b.id===s);h&&n.push(h)}}))}return n.filter((r,s,h)=>s===h.findIndex(b=>b.id===r.id))}rotateToAngle(t){let e=this.selectedTable();if(!e||this.isRotating)return;let n=e.rotation||0,r=(t-n+180)%360-180;this.rotateSelectedTable(r)}onMouseWheel(t){if(!(!this.selectedTable()||this.isDrawing())&&t.ctrlKey){t.preventDefault();let e=t.deltaY>0?-5:5;this.rotateSelectedTable(e)}}updateTablesRotation(t,e){let i=this.stateService.tables().map(s=>{if(t.find(b=>b.id===s.id)){let b=(s.rotation+e)%360;return x(f({},s),{rotation:b})}return s});this.stateService.setTables(i);let r=this.selectedTable();if(r&&t.some(s=>s.id===r.id)){let s=i.find(h=>h.id===r.id);s&&this.stateService.setSelectedTable(s)}}toggleDrawingMode(){this.stateService.setIsDrawing(!this.isDrawing()),this.isDrawing()||this.deselectAll()}toggleMergeMode(){this.stateService.setIsMergeMode(!this.isMergeMode()),this.isMergeMode()||this.stateService.clearSelectedTables(),this.deselectAll()}setDrawingMode(t){this.stateService.setIsDrawing(t)}closeMergeModal(){this.stateService.setShowMergeModal(!1)}toggleTableSelection(t){if(!this.isMergeMode()||t.is_merged)return;let e=this.selectedTables();e.findIndex(i=>i.id===t.id)>-1?this.stateService.removeFromSelectedTables(t.id):e.length===0||e.some(i=>this.areTablesAdjacent(i,t))?e.length<4&&this.stateService.addToSelectedTables(t):this.showAdjacencyWarning(t)}canMergeTables(){let t=this.selectedTables();return t.length>=2&&t.length<=4&&t.every(n=>!n.is_merged)&&this.areSelectedTablesAdjacent()}openMergeModal(){this.canMergeTables()&&(this.mergeForm={tableName:this.getMergedTableName(),tableNumber:this.getMergedTableNumber(),capacity:this.getTotalCapacity()},this.stateService.setShowMergeModal(!0))}onMergeTables(){return T(this,null,function*(){let t=this.currentFloorPlan();if(!(!t||!this.currentRestaurantId||!this.canMergeTables()))try{let e=this.selectedTables(),n=Math.min(...e.map(v=>v.position_x)),i=Math.min(...e.map(v=>v.position_y)),r=Math.max(...e.map(v=>v.position_x+v.width)),s=Math.max(...e.map(v=>v.position_y+v.height)),h={table_name:this.mergeForm.tableName,table_number:this.mergeForm.tableNumber,capacity:this.mergeForm.capacity,position_x:n,position_y:i,width:r-n,height:s-i};(yield this.tableMergeService.mergeTables(e,h,t.id,this.currentRestaurantId))&&(this.stateService.setShowMergeModal(!1),this.stateService.setIsMergeMode(!1),this.stateService.clearSelectedTables(),yield this.tableService.loadData(),this.loadTablesForFloorPlan())}catch(e){console.error("\u274C Error merging tables:",e)}})}onSplitTable(t){return T(this,null,function*(){if(!t.merged_tables_ids||t.merged_tables_ids.length===0){console.log("\u274C Questo tavolo non \xE8 un tavolo unito");return}if(confirm("Sei sicuro di voler separare questo tavolo?"))try{console.log("\u{1F527} Separando tavolo unito:",t.table_number),(yield this.tableMergeService.splitMergedTable(t))?(console.log("\u2705 Tavolo separato con successo"),yield this.tableService.loadData(),this.loadTablesForFloorPlan(),this.deselectAll()):(console.error("\u274C Errore durante la separazione del tavolo"),alert("Errore durante la separazione del tavolo. Riprova."))}catch(e){console.error("\u274C Error splitting table:",e),alert("Errore durante la separazione del tavolo: "+e.message)}})}openDimensionsModal(){let t=this.currentFloorPlan();t&&(this.dimensionsForm={width:t.width,height:t.height},console.log("\u{1F4CF} Opening dimensions modal for:",{floorPlanId:t.id,name:t.name,currentTables:this.tables().length,dimensions:this.dimensionsForm}),this.stateService.setShowDimensionsModal(!0))}onCancelDimensionsModal(){this.stateService.setShowDimensionsModal(!1)}onSaveDimensions(){return T(this,null,function*(){let t=this.currentFloorPlan();if(t)try{let e=this.tables().filter(i=>i.floor_plan_id===t.id);if(e.length>0){let i=e.filter(r=>r.position_x+r.width>this.dimensionsForm.width||r.position_y+r.height>this.dimensionsForm.height);if(i.length>0){if(!confirm(`${i.length} tavolo(i) escono dai nuovi bordi della mappa. Vuoi continuare? I tavoli verranno spostati automaticamente.`))return;for(let s of i)s.position_x=Math.min(s.position_x,this.dimensionsForm.width-s.width),s.position_y=Math.min(s.position_y,this.dimensionsForm.height-s.height),yield this.tableService.updateTable(s.id,{position_x:s.position_x,position_y:s.position_y})}}if(yield this.floorPlanService.updateFloorPlan(t.id,{width:this.dimensionsForm.width,height:this.dimensionsForm.height})){let i=f(f({},t),this.dimensionsForm);this.stateService.setCurrentFloorPlan(i),this.stateService.setShowDimensionsModal(!1),this.updateCanvasDimensions(),console.log("\u2705 Dimensioni mappa aggiornate con successo")}}catch(e){console.error("\u274C Error updating floor plan dimensions:",e)}})}setDimensions(t,e){this.dimensionsForm.width=t,this.dimensionsForm.height=e}startEditFloorPlan(t,e){e.stopPropagation(),t&&(this.editingFloorPlan=t,this.editedFloorPlanName=t.name)}cancelEditFloorPlan(){this.editingFloorPlan=null}createDefaultFloorPlan(){return T(this,null,function*(){if(this.currentRestaurantId)try{let t=this.floorPlanService.getDefaultDimensions(),e={restaurant_id:this.currentRestaurantId,name:"Mappa Principale",width:t.width,height:t.height,is_active:!0},n=yield this.floorPlanService.createFloorPlan(e);n&&this.stateService.setCurrentFloorPlan(n)}catch(t){console.error("\u{1F4A5} Error creating default floor plan:",t)}})}generateNextTableNumber(){return this.tableService.generateNextTableNumber(this.tables())}areTablesAdjacent(t,e,n=10){let i=t.position_x,r=t.position_x+t.width,s=t.position_y,h=t.position_y+t.height,b=e.position_x,v=e.position_x+e.width,y=e.position_y,V=e.position_y+e.height,C=i<=v+n&&r>=b-n,R=s<=V+n&&h>=y-n,N=Math.abs(r-b)<=n||Math.abs(i-v)<=n,D=Math.abs(h-y)<=n||Math.abs(s-V)<=n;return N&&R||D&&C}areSelectedTablesAdjacent(){return this.interactionService.areSelectedTablesAdjacent(this.selectedTables(),this.tables())}getAdjacentTablesToSelection(){let t=this.selectedTables();if(t.length===0)return[];let e=[],n=t.map(i=>i.id);return this.tables().forEach(i=>{if(!(n.includes(i.id)||i.is_merged)){for(let r of t)if(this.areTablesAdjacent(i,r)){e.push(i);break}}}),e}showAdjacencyWarning(t){this.interactionService.showAdjacencyWarning(t,this.selectedTables())}highlightAdjacentTables(){this.getAdjacentTablesToSelection().forEach(e=>{let n=this.getTableElement(e);n&&(n.classList.add("adjacent-highlight"),setTimeout(()=>{n.classList.remove("adjacent-highlight")},2e3))})}getTableStyle(t){let e=this.tableService.getTableStyle(t);return e.position="absolute",e["z-index"]="10",e}getTableClass(t){return this.tableService.getTableClass(t,this.selectedTable(),this.selectedTables(),this.isMergeMode())}getPreviewBorderRadius(){let t=this.tableForm();return this.floorPlanService.getPreviewBorderRadius(t.shape,t.borderRadius)}getPreviewBorderRadiusValue(){let t=this.tableForm();return this.floorPlanService.getPreviewBorderRadiusValue(t.shape,t.borderRadius)}getEditPreviewBorderRadius(){let t=this.selectedTable();return t?this.floorPlanService.getPreviewBorderRadius(t.shape,t.border_radius??8):"8px"}getEditPreviewBorderRadiusValue(){let t=this.selectedTable();return t?this.floorPlanService.getPreviewBorderRadiusValue(t.shape,t.border_radius??8):"8px"}getTotalCapacity(){return this.floorPlanService.getTotalCapacity(this.selectedTables())}getSelectedTableNumbers(){return this.selectedTables().map(t=>t.table_number).join("-")}getMergedTableName(){return this.floorPlanService.getMergedTableName(this.selectedTables())}getMergedTableNumber(){return this.floorPlanService.getMergedTableNumber(this.selectedTables())}getTableElement(t){return this.canvasRef.nativeElement.querySelector(`[data-table-id="${t.id}"]`)}setupCanvasInteractions(){if(!this.canvasRef?.nativeElement){console.warn("Canvas ref non disponibile, rimando l'inizializzazione"),setTimeout(()=>this.setupCanvasInteractions(),100);return}let t=this.canvasRef.nativeElement;this.renderer.listen(t,"click",e=>this.onCanvasClick(e)),this.renderer.listen(t,"pointerdown",e=>this.onCanvasPointerDown(e)),this.renderer.listen(t,"touchstart",e=>{this.onCanvasTouchStart(e)},{passive:!1}),this.renderer.listen(document,"pointermove",()=>{this.isDragging&&t.classList.add("dragging-active")}),this.renderer.listen(document,"pointerup",()=>{this.isDragging=!1,t.classList.remove("dragging-active")})}onCanvasClick(t){if(!this.isDrawing()||!this.currentFloorPlan())return;let n=this.canvasRef.nativeElement.getBoundingClientRect(),i=this.canvasScale(),r=this.floorPlanWidth(),s=this.floorPlanHeight(),h=n.left+n.width/2,b=n.top+n.height/2,v=t.clientX-h,y=t.clientY-b,V=v/i+r/2,C=y/i+s/2,R=this.snapToGrid?Math.round(V/this.gridSize)*this.gridSize:V,N=this.snapToGrid?Math.round(C/this.gridSize)*this.gridSize:C;this.modalPosition={x:R,y:N},this.stateService.setShowTableModal(!0),this.stateService.resetTableForm(),t.stopPropagation()}onCanvasPointerDown(t){if(this.isDrawing())return;let n=t.target.closest(".table-element");if(n){this.isDragging=!0;let i=n.getAttribute("data-table-id"),r=this.tables().find(s=>s.id===i);r&&(console.log("\u{1F7E2} START DRAG for table:",r.table_number),n.classList.add("dragging"),n.style.transition="none",this.selectTable(r),this.interactionService.startTableDrag(r.id,t,this.canvasRef.nativeElement,this.canvasScale()))}else this.deselectAll();t.preventDefault(),t.stopPropagation()}onCanvasTouchStart(t){if(this.isDrawing())return;let n=t.target.closest(".table-element");if(n){t.preventDefault();let i=n.getAttribute("data-table-id"),r=this.tables().find(s=>s.id===i);if(r){this.isDragging=!0;let s=t.touches[0],h=new PointerEvent("pointerdown",{clientX:s.clientX,clientY:s.clientY,pointerId:1});n.classList.add("dragging"),n.style.transition="none",this.selectTable(r),this.interactionService.startTableDrag(r.id,h,this.canvasRef.nativeElement)}}else this.deselectAll()}setupPinchToZoom(){if(!this.canvasRef?.nativeElement){console.warn("Canvas ref non disponibile per pinch-to-zoom, rimando l'inizializzazione"),setTimeout(()=>this.setupPinchToZoom(),100);return}let t=this.canvasRef.nativeElement,e=0,n=0;this.renderer.listen(t,"touchstart",i=>{if(i.touches.length===2){i.preventDefault();let r=i.touches[0],s=i.touches[1];e=Math.hypot(s.clientX-r.clientX,s.clientY-r.clientY),n=this.canvasScale()}},{passive:!1}),this.renderer.listen(t,"touchmove",i=>{if(i.touches.length===2){i.preventDefault();let r=i.touches[0],s=i.touches[1],h=Math.hypot(s.clientX-r.clientX,s.clientY-r.clientY);if(e>0){let b=h/e,v=n*b,y=Math.max(.3,Math.min(v,3));this.canvasScale.set(y),this.updateCanvasDimensions()}}},{passive:!1}),this.renderer.listen(t,"touchend",()=>{e=0,n=0})}toggleSize(){this.isLargeText=!this.isLargeText}trackByTableId(t,e){return e.id}trackByFloorPlanId(t,e){return e.id}logCanvasInfo(){console.log("\u{1F4D0} Canvas Info:",{floorPlanWidth:this.floorPlanWidth(),floorPlanHeight:this.floorPlanHeight(),canvasScale:this.canvasScale(),visualWidth:this.visualWidth(),visualHeight:this.visualHeight(),isMobile:this.isMobileView()})}onTablePointerDown(t,e){if(t.stopPropagation(),t.preventDefault(),!this.isDrawing()){if(this.isMergeMode()){this.toggleTableSelection(e);return}this.selectTable(e),t.pointerType==="mouse"&&t.button===0&&this.startTableDrag(t,e)}}startTableDrag(t,e){if(!this.canvasRef?.nativeElement)return;this.isDragging=!0;let n=this.canvasRef.nativeElement,i=this.canvasScale();console.log("\u{1F7E2} START DRAG for table:",e.table_number,"Scale:",i);let r=t.target;r&&(r.classList.add("dragging"),r.style.transition="none"),this.interactionService.startTableDrag(e.id,t,n,i)}onDimensionChange(){let t=this.selectedTable();t&&((t.shape==="circle"||t.shape==="square")&&(t.height=t.width),t.width<20&&(t.width=20),t.width>1e3&&(t.width=1e3),t.height<20&&(t.height=20),t.height>1e3&&(t.height=1e3))}checkTablesOverlap(t,e){return!(t.position_x+t.width<=e.position_x||t.position_x>=e.position_x+e.width||t.position_y+t.height<=e.position_y||t.position_y>=e.position_y+e.height)}startEditFloorPlanName(){let t=this.currentFloorPlan();t&&(this.isEditingFloorPlanName=!0,this.editedFloorPlanName=t.name)}saveFloorPlanName(){return T(this,null,function*(){let t=this.currentFloorPlan();if(!(!t||!this.editedFloorPlanName.trim()))try{if(yield this.floorPlanService.updateFloorPlan(t.id,{name:this.editedFloorPlanName})){let n=x(f({},t),{name:this.editedFloorPlanName});this.stateService.setCurrentFloorPlan(n),yield this.floorPlanService.loadData(),this.isEditingFloorPlanName=!1,this.editedFloorPlanName=""}}catch(e){console.error("\u274C Error saving floor plan name:",e)}})}cancelEditFloorPlanName(){this.isEditingFloorPlanName=!1,this.editedFloorPlanName=""}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=ne({type:c,selectors:[["app-floor-plan"]],viewQuery:function(e,n){if(e&1&&(Z(Ve,5),Z(Ie,5)),e&2){let i;Q(i=K())&&(n.canvasRef=i.first),Q(i=K())&&(n.containerRef=i.first)}},hostBindings:function(e,n){e&1&&g("wheel",function(r){return n.onMouseWheel(r)})},decls:109,vars:32,consts:[["canvasContainer",""],["floorPlanCanvas",""],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"form-card"],[1,"form-row","mb-md"],[1,"form-group"],[1,"standard-label"],[1,"flex","gap-sm","items-center"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],["title","Modifica nome mappa",1,"icon-button",3,"click","disabled"],[1,"material-icons"],["title","Elimina mappa",1,"icon-button",3,"click","disabled"],["class","mt-sm",4,"ngIf"],["title","Zoom -",1,"icon-button",3,"click"],[1,"text-sm"],["title","Zoom +",1,"icon-button",3,"click"],["title","Reset zoom",1,"icon-button",3,"click"],[1,"checkbox-label","ml-sm"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"checkbox-content"],[1,"form-row"],[1,"promethea-button","primary","small",3,"click"],[1,"promethea-button","ghost","small",3,"click","disabled"],[1,"promethea-button",3,"click"],[1,"promethea-button","ghost","small",3,"click"],["class","form-row","style","padding: var(--gap-sm) 0;",4,"ngIf"],["class","rounded m-sm02 p-md","style","background-color: var(--smoke-1); border: 1px solid var(--smoke-2);",4,"ngIf"],[1,"form-card","mt-lg"],[1,"canvas-container"],["class","canvas-wrapper",4,"ngIf"],["class","empty-floorplan",4,"ngIf"],[1,"dimensions-info"],[1,"grid-cards"],[1,"dimension-item"],[1,"dimension-label"],[1,"dimension-value"],["class","modal-overlay",4,"ngIf"],[3,"ngValue"],[1,"mt-sm"],["type","text","placeholder","Nuovo nome mappa","autofocus","",1,"form-input",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],["title","Salva",1,"icon-button","success",3,"click"],["title","Annulla",1,"icon-button",3,"click"],[1,"text-sm","text-muted","mt-sm"],[1,"form-row",2,"padding","var(--gap-sm) 0"],[1,"form-group","mt-md"],[1,"flex","justify-between","items-center","flex-wrap","gap-md"],[1,"flex","items-center","gap-sm"],["class","flex gap-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","border-l","pl-sm"],["title","Ruota di -30\xB0",1,"icon-button",3,"click","disabled"],[1,"flex","flex-col","items-center"],[1,"text-sm","font-bold"],[1,"text-xs","text-muted"],["title","Ruota di +30\xB0",1,"icon-button",3,"click","disabled"],["title","Reset rotazione a 0\xB0",1,"icon-button",3,"click","disabled"],["class","text-xs text-muted mt-sm text-center",4,"ngIf"],["title","0\xB0",1,"icon-button",3,"click"],["title","90\xB0",1,"icon-button",3,"click"],["title","180\xB0",1,"icon-button",3,"click"],["title","270\xB0",1,"icon-button",3,"click"],[1,"text-xs","text-muted","mt-sm","text-center"],[1,"material-icons","text-xs"],[1,"rounded","m-sm02","p-md",2,"background-color","var(--smoke-1)","border","1px solid var(--smoke-2)"],[1,"flex","flex-col"],["class","chip active small ml-sm",4,"ngIf"],["class","promethea-button warning small",3,"click",4,"ngIf"],[1,"chip","active","small","ml-sm"],[1,"promethea-button","warning","small",3,"click"],[1,"canvas-wrapper"],[1,"floor-plan-canvas",3,"click"],[1,"canvas-background"],["class","grid-overlay",3,"background-size",4,"ngIf"],["class","table-element",3,"class","style","pointerdown",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],[1,"grid-overlay"],[1,"table-element",3,"pointerdown"],[1,"table-content"],[1,"table-number"],[1,"table-capacity"],[1,"empty-state"],[1,"empty-floorplan"],[1,"promethea-button","primary","mt-md",3,"click"],[1,"modal-overlay"],[1,"modal-container","modal-md"],[1,"modal-header"],[1,"header-icon"],[1,"icon-button",3,"click"],[1,"generic-form"],[1,"form-row","mb-lg"],["type","text","name","tableName","placeholder","Nome tavolo",1,"form-input",3,"ngModelChange","ngModel"],["type","text","name","tableNumber","placeholder","Numero",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","tableCapacity","min","1","max","20",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","tableWidth","min","20","max","1000","step","10",1,"form-input",3,"ngModelChange","change","ngModel"],["type","number","name","tableHeight","min","20","max","1000","step","10",1,"form-input",3,"ngModelChange","change","ngModel","disabled"],["class","form-group",4,"ngIf"],[1,"form-card","text-center"],[1,"flex","justify-center","mt-md"],[1,"table-preview"],[1,"preview-content"],[1,"text-muted","mt-sm","mt-lg","justify-center","flex"],[1,"checkbox-label"],["type","checkbox","name","isOnlineBookable",3,"ngModelChange","ngModel"],["class","form-card",4,"ngIf"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","button",1,"promethea-button",3,"click"],[1,"promethea-button","danger","full-width",3,"click"],["type","range","name","borderRadius","min","0","max","50","step","1",1,"form-input",3,"ngModelChange","ngModel"],[1,"flex","justify-between","text-sm","text-muted"],[1,"info-message"],[1,"flex","flex-col","gap-sm"],[1,"promethea-button","warning",3,"click"],[1,"form-group","mb-lg"],[1,"grid-cards","mb-md"],["class","card text-center hover-lift",3,"active","click",4,"ngFor","ngForOf"],["type","number","name","gridWidth","min","2","max","20",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","number","name","gridHeight","min","2","max","20",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","text","name","tableNumber","placeholder","Es: 1",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","capacity","min","1","max","100",1,"form-input",3,"ngModelChange","ngModel"],[1,"card","text-center","hover-lift",3,"click"],[1,"flex","flex-col","items-center","gap-sm"],[1,"flex","items-center","gap-md"],[1,"material-icons","text-lg"],[1,"section-title","modal-header-title"],[1,"p-lg"],["type","number","name","floorPlanWidth","min","500","max","5000","step","50",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","floorPlanHeight","min","500","max","5000","step","50",1,"form-input",3,"ngModelChange","ngModel"],[1,"standard-label","mb-md"],["type","button",1,"promethea-button","ghost","x-small",3,"click"],[1,"font-semibold"],[1,"flex","justify-center","mt-lg"],[1,"dimension-preview","border","shadow-card","rounded-lg","bg-smoke"],[1,"text-muted","p-sm"],["class","flex items-center gap-sm p-sm border rounded",4,"ngFor","ngForOf"],["type","text","name","mergedTableNumber","placeholder","Es: U123",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","mergedTableCapacity","min","2","max","50",1,"form-input",3,"ngModelChange","ngModel"],["type","text","name","mergedTableName","placeholder","Es: Tavolo Unito per Gruppo",1,"form-input",3,"ngModelChange","ngModel"],[1,"mb-md","font-bold"],[1,"flex","justify-between","mt-sm"],[1,"flex","justify-between"],[1,"flex","items-center","gap-sm","p-sm","border","rounded"],[1,"flex-1"]],template:function(e,n){if(e&1){let i=F();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),l(4,"map"),o(),a(5,"h1",6),l(6,"Mappa Ristorante"),o()(),a(7,"p",7),l(8,"Crea e modifica la disposizione dei tavoli nel tuo ristorante"),o()(),a(9,"div",8)(10,"div",9)(11,"div",10)(12,"label",11),l(13,"Mappa"),o(),a(14,"div",12)(15,"select",13),g("ngModelChange",function(s){return m(i),u(n.onFloorPlanSelectById(s))}),a(16,"option",14),l(17,"Seleziona mappa"),o(),k(18,Ne,2,4,"option",15),o(),a(19,"div",4)(20,"button",16),g("click",function(){return m(i),u(n.startEditFloorPlanName())}),a(21,"span",17),l(22,"edit"),o()(),a(23,"button",18),g("click",function(s){return m(i),u(n.onDeleteFloorPlan(n.currentFloorPlan(),s))}),a(24,"span",17),l(25,"delete"),o()()()(),k(26,Re,12,1,"div",19),o(),a(27,"div",10)(28,"label",11),l(29,"Zoom"),o(),a(30,"div",12)(31,"button",20),g("click",function(){return m(i),u(n.zoomOut())}),a(32,"span",17),l(33,"zoom_out"),o()(),a(34,"span",21),l(35),o(),a(36,"button",22),g("click",function(){return m(i),u(n.zoomIn())}),a(37,"span",17),l(38,"zoom_in"),o()(),a(39,"button",23),g("click",function(){return m(i),u(n.resetCanvasZoom())}),a(40,"span",17),l(41,"refresh"),o()(),a(42,"label",24)(43,"input",25),E("ngModelChange",function(s){return m(i),w(n.snapToGrid,s)||(n.snapToGrid=s),u(s)}),g("change",function(){return m(i),u(n.refreshCanvasSize())}),o(),a(44,"div",26)(45,"span",7),l(46),o()()()()()(),a(47,"div",27)(48,"div",10)(49,"label",11),l(50,"Mappa"),o(),a(51,"div",4)(52,"button",28),g("click",function(){return m(i),u(n.createNewFloorPlan())}),a(53,"span",17),l(54,"add"),o(),l(55," Nuova Mappa "),o(),a(56,"button",29),g("click",function(){return m(i),u(n.openDimensionsModal())}),a(57,"span",17),l(58,"aspect_ratio"),o(),l(59," Dimensioni "),o()()(),a(60,"div",10)(61,"label",11),l(62,"Tavoli"),o(),a(63,"div",4)(64,"button",30),g("click",function(){return m(i),u(n.toggleDrawingMode())}),a(65,"span",17),l(66,"add_circle"),o(),l(67),o(),a(68,"button",31),g("click",function(){return m(i),u(n.setDrawingMode(!1))}),a(69,"span",17),l(70,"open_with"),o(),l(71," Sposta "),o(),a(72,"button",31),g("click",function(){return m(i),u(n.toggleMergeMode())}),a(73,"span",17),l(74,"merge"),o(),l(75),o()()()(),k(76,Ae,29,6,"div",32)(77,He,18,4,"div",33),o(),a(78,"div",34)(79,"div",35,0),k(81,Xe,7,12,"div",36)(82,qe,11,0,"div",37),o(),a(83,"div",38)(84,"div",39)(85,"div",40)(86,"span",41),l(87,"Dimensioni mappa:"),o(),a(88,"span",42),l(89),o()(),a(90,"div",40)(91,"span",41),l(92,"Visualizzato:"),o(),a(93,"span",42),l(94),o()(),a(95,"div",40)(96,"span",41),l(97,"Scala:"),o(),a(98,"span",42),l(99),o()(),a(100,"div",40)(101,"span",41),l(102,"Tavoli:"),o(),a(103,"span",42),l(104),o()()()()()(),k(105,Qe,78,24,"div",43)(106,et,65,24,"div",43)(107,tt,51,8,"div",43)(108,nt,53,6,"div",43)}e&2&&(d(15),_("ngModel",n.currentFloorPlanId())("disabled",n.floorPlans().length===0||n.isEditingFloorPlanName),d(3),_("ngForOf",n.floorPlans()),d(2),_("disabled",!n.currentFloorPlan()||n.isEditingFloorPlanName),d(3),_("disabled",!n.currentFloorPlan()||n.isEditingFloorPlanName),d(3),_("ngIf",n.isEditingFloorPlanName&&n.currentFloorPlan()),d(9),M("",(n.canvasScale()*100).toFixed(0),"%"),d(8),S("ngModel",n.snapToGrid),d(3),M("Griglia (",n.gridSize,"px)"),d(10),_("disabled",!n.currentFloorPlan()),d(8),W("active",n.isDrawing()),d(3),M(" ",n.isDrawing()?"Annulla":"Aggiungi"," "),d(),W("active",!n.isDrawing()),d(4),W("active",n.isMergeMode()),d(3),M(" ",n.isMergeMode()?"Annulla":"Unisci"," "),d(),_("ngIf",n.selectedTable()&&!n.isDrawing()),d(),_("ngIf",n.selectedTable()&&!n.isDrawing()),d(4),_("ngIf",n.currentFloorPlan()),d(),_("ngIf",!n.currentFloorPlan()),d(7),L("",n.floorPlanWidth()," \xD7 ",n.floorPlanHeight()," px"),d(5),L("",n.visualWidth().toFixed(0)," \xD7 ",n.visualHeight().toFixed(0)," px"),d(5),M("",(n.canvasScale()*100).toFixed(0),"%"),d(5),A(n.tables().length),d(),_("ngIf",n.showEditTableModal()&&n.selectedTable()),d(),_("ngIf",n.showTableModal()),d(),_("ngIf",n.showDimensionsModal()),d(),_("ngIf",n.showMergeModal()))},dependencies:[de,le,se,Pe,ve,Te,Se,ue,_e,fe,me,xe,pe,he,Ee,we,be,ge],styles:[".canvas-container[_ngcontent-%COMP%]{position:relative;width:100%;min-height:500px;max-height:80vh;border:2px solid var(--smoke-1);border-radius:12px;background-color:var(--background);overflow:auto;padding:var(--gap-sm);box-sizing:border-box}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;display:block;margin:0;min-width:min-content;min-height:min-content}.floor-plan-canvas[_ngcontent-%COMP%]{position:relative;background-color:var(--background);box-shadow:0 4px 12px var(--smoke-1);border-radius:8px;transform-origin:0 0;overflow:hidden;margin:0}.grid-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;pointer-events:none;z-index:2;background-image:linear-gradient(to right,var(--smoke-1) 1px,transparent 1px),linear-gradient(to bottom,var(--smoke-1) 1px,transparent 1px);opacity:.4;background-size:20px 20px;width:100%;height:100%}.table-element[_ngcontent-%COMP%]{position:absolute;border:2px solid var(--smoke-1);background:var(--vetro);cursor:grab;display:flex;align-items:center;justify-content:center;transition:transform .2s ease-out;z-index:10;transform-origin:center;border-radius:inherit}.table-element.selected[_ngcontent-%COMP%]{border-color:var(--primary);background:var(--gradiente);z-index:30;box-shadow:0 8px 32px var(--shadow-2)}.table-content[_ngcontent-%COMP%]{text-align:center;padding:var(--gap-sm);width:100%;display:flex;flex-direction:column;gap:calc(var(--gap-sm) / 2)}.table-number[_ngcontent-%COMP%]{font-weight:800;font-size:var(--fs-sm);color:var(--text-color);line-height:1}.table-capacity[_ngcontent-%COMP%]{font-size:calc(var(--fs-sm) * .8);color:var(--text-muted);display:flex;justify-content:center;font-weight:600;line-height:1}@media (max-width: 768px){.canvas-container[_ngcontent-%COMP%]{height:60vh;min-height:400px;max-height:600px;padding:8px}.grid-overlay[_ngcontent-%COMP%]{background-size:30px 30px!important}}.dimensions-info[_ngcontent-%COMP%]{background-color:var(--smoke-1);border-radius:8px;padding:var(--gap-sm);margin-top:var(--gap-sm)}.dimension-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.dimension-label[_ngcontent-%COMP%]{color:var(--text-muted);margin-bottom:var(--gap-sm)}.dimension-value[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color)}"]})};export{Fe as FloorPlanEditor};
