import{b as C,c as u,d as F,e as P,i as M,j as T,l as x,o as L,v as q,x as A}from"./chunk-HTWH3NPU.js";import{D as y,e as w,l as E,s as b,u as S,v as I}from"./chunk-KBL2L3GY.js";import{Gb as R,Hb as f,Na as l,Qb as c,Tb as s,Ub as v,Vb as h,cb as N,f as _,ga as g,hb as m,tb as o,ub as n,vb as t,wb as d}from"./chunk-UE7YVF6I.js";function G(r,a){r&1&&(n(0,"div",27),s(1," Il nome \xE8 obbligatorio "),t())}function V(r,a){r&1&&(n(0,"div",27),s(1," Il cognome \xE8 obbligatorio "),t())}function z(r,a){r&1&&(n(0,"span"),s(1,"Email obbligatoria"),t())}function D(r,a){r&1&&(n(0,"span"),s(1,"Email non valida"),t())}function O(r,a){if(r&1&&(n(0,"div",27),m(1,z,2,0,"span",26)(2,D,2,0,"span",26),t()),r&2){let i=f();l(),o("ngIf",i.email==null||i.email.errors==null?null:i.email.errors.required),l(),o("ngIf",i.email==null||i.email.errors==null?null:i.email.errors.email)}}function j(r,a){r&1&&(n(0,"div",27),s(1," Il nome del ristorante \xE8 obbligatorio "),t())}function B(r,a){if(r&1&&(n(0,"div",9)(1,"h2",6)(2,"span",4),s(3,"business"),t(),s(4," Informazioni Ristorante "),t(),n(5,"div",11)(6,"label",12),s(7,"Nome Ristorante *"),t(),d(8,"input",28),m(9,j,2,0,"div",14),t()()),r&2){let i=f();l(8),c("error",(i.restaurantName==null?null:i.restaurantName.invalid)&&(i.restaurantName==null?null:i.restaurantName.touched)),l(),o("ngIf",(i.restaurantName==null?null:i.restaurantName.invalid)&&(i.restaurantName==null?null:i.restaurantName.touched))}}function H(r,a){r&1&&(n(0,"div",27),s(1," Password obbligatoria (min. 6 caratteri) "),t())}function J(r,a){r&1&&(n(0,"div",27),s(1," Le password non coincidono "),t())}function K(r,a){if(r&1&&(n(0,"div",29),s(1),t()),r&2){let i=f();l(),h(" ",i.errorMessage," ")}}function Q(r,a){r&1&&d(0,"span",30)}function U(r,a){if(r&1&&(n(0,"span"),s(1),t()),r&2){let i=f();l(),v(i.isRestaurant?"Registra Ristorante":"Crea Account")}}var k=class r{fb=g(q);authService=g(y);router=g(S);route=g(b);registerForm;isLoading=!1;errorMessage="";isRestaurant=!1;ngOnInit(){let a=this.route.snapshot.paramMap.get("role");this.isRestaurant=a==="restaurant",this.registerForm=this.fb.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]],confirmPassword:["",[u.required]],firstName:["",[u.required]],lastName:["",[u.required]],phone:[""],restaurantName:[(this.isRestaurant,""),this.isRestaurant?u.required:[]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(a){let i=a.get("password")?.value,e=a.get("confirmPassword")?.value;return i===e?null:{passwordMismatch:!0}}onSubmit(){return _(this,null,function*(){if(this.registerForm.invalid||this.isLoading)return;this.isLoading=!0,this.errorMessage="";let a=this.registerForm.value;try{let i=this.isRestaurant?"restaurant_owner":"customer",e={email:a.email.toLowerCase().trim(),password:a.password,user_data:{first_name:a.firstName,last_name:a.lastName,phone:a.phone,role:i},restaurant_data:this.isRestaurant?{name:a.restaurantName,address:"",phone:a.phone||"",email:a.email,description:"",cuisine_type:"",allow_table_selection:!1,accepts_delivery:!1,accepts_takeaway:!1}:void 0},p=yield this.authService.register(e);p.error?(this.errorMessage=p.error,console.error("Registration error details:",p.error)):p.user&&(console.log("\u2705 Registration successful, user:",p.user.id),this.errorMessage="Registrazione completata! Reindirizzamento...",setTimeout(()=>{this.isRestaurant&&p.restaurant?this.router.navigate(["/restaurant/dashboard"]):this.router.navigate(["/customer"])},2e3))}catch(i){this.errorMessage="Errore durante la registrazione: "+i.message,console.error("Registration exception:",i)}finally{this.isLoading=!1}})}get email(){return this.registerForm.get("email")}get password(){return this.registerForm.get("password")}get confirmPassword(){return this.registerForm.get("confirmPassword")}get firstName(){return this.registerForm.get("firstName")}get lastName(){return this.registerForm.get("lastName")}get restaurantName(){return this.registerForm.get("restaurantName")}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=N({type:r,selectors:[["app-register"]],decls:61,vars:24,consts:[[1,"gradient-container"],[1,"form-card"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],["formControlName","firstName","placeholder","Il tuo nome","type","text"],["class","error-message",4,"ngIf"],["formControlName","lastName","placeholder","Il tuo cognome","type","text"],["formControlName","email","type","email","placeholder","tua.email@esempio.com"],["formControlName","phone","placeholder","+39 123 456 7890","type","number"],["class","form-section",4,"ngIf"],["formControlName","password","type","password","placeholder","Almeno 6 caratteri"],["formControlName","confirmPassword","type","password","placeholder","Ripeti la password"],["class","error-message","style","margin: 1rem 0; padding: 1rem; background: #fee;",4,"ngIf"],[1,"form-actions"],["routerLink","/login",1,"link"],["type","submit",1,"promethea-button",3,"disabled"],["class","loading-spinner",4,"ngIf"],[4,"ngIf"],[1,"error-message"],["formControlName","restaurantName","placeholder","Il nome del tuo ristorante","type","text"],[1,"error-message",2,"margin","1rem 0","padding","1rem","background","#fee"],[1,"loading-spinner"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),s(5),t()(),n(6,"div",5)(7,"h1",6),s(8),t(),n(9,"p",7),s(10),t()()(),n(11,"form",8),R("ngSubmit",function(){return e.onSubmit()}),n(12,"div",9)(13,"h2",6)(14,"span",4),s(15,"person"),t(),s(16," Informazioni Personali "),t(),n(17,"div",10)(18,"div",11)(19,"label",12),s(20,"Nome *"),t(),d(21,"input",13),m(22,G,2,0,"div",14),t(),n(23,"div",11)(24,"label",12),s(25,"Cognome *"),t(),d(26,"input",15),m(27,V,2,0,"div",14),t()(),n(28,"div",11)(29,"label",12),s(30,"Email *"),t(),d(31,"input",16),m(32,O,3,2,"div",14),t(),n(33,"div",11)(34,"label",12),s(35,"Telefono"),t(),d(36,"input",17),t()(),m(37,B,10,3,"div",18),n(38,"div",9)(39,"h2",6)(40,"span",4),s(41,"lock"),t(),s(42," Password "),t(),n(43,"div",10)(44,"div",11)(45,"label",12),s(46,"Password *"),t(),d(47,"input",19),m(48,H,2,0,"div",14),t(),n(49,"div",11)(50,"label",12),s(51,"Conferma Password *"),t(),d(52,"input",20),m(53,J,2,0,"div",14),t()()(),m(54,K,2,1,"div",21),n(55,"div",22)(56,"a",23),s(57," \u2190 Hai gi\xE0 un account? Accedi "),t(),n(58,"button",24),m(59,Q,1,0,"span",25)(60,U,2,1,"span",26),t()()()()()),i&2&&(l(5),v(e.isRestaurant?"restaurant":"person"),l(3),v(e.isRestaurant?"Registra il tuo Ristorante":"Crea Account"),l(2),h(" ",e.isRestaurant?"Crea il tuo account business":"Crea il tuo account personale"," "),l(),o("formGroup",e.registerForm),l(10),c("error",(e.firstName==null?null:e.firstName.invalid)&&(e.firstName==null?null:e.firstName.touched)),l(),o("ngIf",(e.firstName==null?null:e.firstName.invalid)&&(e.firstName==null?null:e.firstName.touched)),l(4),c("error",(e.lastName==null?null:e.lastName.invalid)&&(e.lastName==null?null:e.lastName.touched)),l(),o("ngIf",(e.lastName==null?null:e.lastName.invalid)&&(e.lastName==null?null:e.lastName.touched)),l(4),c("error",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),l(),o("ngIf",(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),l(5),o("ngIf",e.isRestaurant),l(10),c("error",(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),l(),o("ngIf",(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),l(4),c("error",(e.registerForm.errors==null?null:e.registerForm.errors.passwordMismatch)&&(e.confirmPassword==null?null:e.confirmPassword.touched)),l(),o("ngIf",(e.registerForm.errors==null?null:e.registerForm.errors.passwordMismatch)&&(e.confirmPassword==null?null:e.confirmPassword.touched)),l(),o("ngIf",e.errorMessage),l(4),o("disabled",e.isLoading),l(),o("ngIf",e.isLoading),l(),o("ngIf",!e.isLoading))},dependencies:[E,w,A,M,C,T,F,P,x,L,I],encapsulation:2})};export{k as Register};
