import{a as le}from"./chunk-LDOS2BDR.js";import{a as Q,b as X,c as y,d as J,e as K,h as Y,i as Z,m as ee,p as te,q as ie,r as ne,s as re,w as oe,x as ae,y as se}from"./chunk-B4OL4BIV.js";import{b as H}from"./chunk-OPNETFGM.js";import{b as G}from"./chunk-L3BVOY7C.js";import{c as U,d as W,m as q}from"./chunk-JKK4MZBS.js";import{Ab as A,Bb as j,Eb as C,Fb as B,Ga as V,Gb as L,Hb as a,Ib as w,Ja as c,Jb as b,Kb as F,Nb as P,Ob as k,Pb as I,Tb as E,Ua as M,Za as D,a as O,b as z,cb as _,ga as N,h as v,kb as u,la as m,lb as o,ma as p,mb as r,nb as S,sb as g,vb as h,xb as d,zb as $}from"./chunk-G3XPJWB3.js";var de=["fileInput"],ue=()=>[1,2,3,4,5,6,7,8],R=()=>({standalone:!0});function me(l,t){if(l&1&&(o(0,"option",39),a(1),r()),l&2){let e=t.$implicit;u("value",e),c(),w(e)}}function pe(l,t){if(l&1){let e=g();o(0,"button",52),h("click",function(){m(e);let n=d().index,s=d();return p(s.deleteShift(n))}),o(1,"span",14),a(2,"delete"),r()()}}function he(l,t){if(l&1&&(o(0,"span",45),a(1),r()),l&2){let e=t.$implicit,i=t.index,n=d().$implicit,s=d();C("active",s.isDaySelected(n.days_of_week,i)),c(),b(" ",e," ")}}function fe(l,t){if(l&1){let e=g();o(0,"div",40)(1,"div",41)(2,"div",42)(3,"h3",43),a(4),r(),o(5,"div",44)(6,"span",45)(7,"span",46),a(8,"access_time"),r(),a(9),r(),o(10,"span",45),a(11),r()()(),o(12,"div",3)(13,"button",47),h("click",function(){let n=m(e).index,s=d();return p(s.toggleShiftActive(n))}),o(14,"span",14),a(15),r()(),o(16,"button",48),h("click",function(){let n=m(e).index,s=d();return p(s.editShift(n))}),o(17,"span",14),a(18,"edit"),r()(),_(19,pe,3,0,"button",49),r()(),o(20,"div",50),_(21,he,2,3,"span",51),r()()}if(l&2){let e=t.$implicit,i=d();c(4),w(e.name),c(5),F(" ",e.start_time.substring(0,5)," - ",e.end_time.substring(0,5)," "),c(),L(e.is_active?"active":"warning"),c(),b(" ",e.is_active?"Attivo":"Disattivato"," "),c(2),C("text-green-500",!e.is_active)("text-orange-500",e.is_active),u("title",e.is_active?"Disattiva turno":"Attiva turno"),c(2),b(" ",e.is_active?"pause":"play_arrow"," "),c(4),u("ngIf",i.shifts.length>1),c(2),u("ngForOf",i.weekDays)}}function _e(l,t){if(l&1){let e=g();o(0,"button",53),h("click",function(){m(e);let n=d();return p(n.addNewShift())}),o(1,"span",14),a(2,"add"),r(),a(3," Aggiungi Nuovo Turno "),r()}}function ge(l,t){if(l&1&&(o(0,"option",73),a(1),r()),l&2){let e=t.$implicit,i=d(2).$implicit;u("value",e)("selected",(i==null?null:i.display_order)===e),c(),b(" ",e," ")}}function ve(l,t){if(l&1){let e=g();o(0,"div",69)(1,"label",70),a(2,"Posizione:"),r(),o(3,"select",71),h("change",function(n){m(e);let s=d().index,f=d(2);return p(f.onPhotoOrderChange(s,n))}),_(4,ge,2,3,"option",72),r()()}if(l&2){let e=d(3);c(3),u("disabled",e.loadingPhotos),c(),u("ngForOf",E(2,ue))}}function xe(l,t){if(l&1){let e=g();o(0,"div",74)(1,"img",75),h("error",function(n){m(e);let s=d().index,f=d(2);return p(f.onImageError(n,s))}),r(),o(2,"div",76)(3,"span",14),a(4,"zoom_in"),r()()()}if(l&2){let e=d().$implicit;c(),u("src",e.url,V)("alt","Foto "+e.display_order)}}function Se(l,t){if(l&1&&(o(0,"div",77)(1,"span",78),a(2,"add_photo_alternate"),r(),o(3,"p",79),a(4),r()()),l&2){let e=d().index;c(4),b("Slot ",e+1," vuoto")}}function be(l,t){if(l&1){let e=g();o(0,"button",80),h("click",function(){m(e);let n=d().index,s=d(2);return p(s.deletePhoto(n))}),o(1,"span",14),a(2,"delete"),r()()}if(l&2){let e=d(3);u("disabled",e.loadingPhotos)}}function ye(l,t){if(l&1){let e=g();o(0,"div",60)(1,"div",61)(2,"div",45),a(3),r(),_(4,ve,5,3,"div",62),r(),o(5,"div",63),h("click",function(){let n=m(e),s=n.$implicit,f=n.index,x=d(2);return p(s?x.openPhoto(s,f):null)}),_(6,xe,5,2,"div",64)(7,Se,5,1,"div",65),r(),o(8,"div",66)(9,"button",67),h("click",function(){let n=m(e).index,s=d(2);return p(s.triggerFileInput(n))}),o(10,"span",14),a(11),r()(),_(12,be,3,1,"button",68),r()()}if(l&2){let e=t.$implicit,i=t.index,n=d(2);c(3),w(i+1),c(),u("ngIf",e),c(),B(e?"border: 2px solid var(--smoke-2); background: transparent;":"border: 2px dashed var(--smoke-1); background: var(--smoke-1);"),C("has-photo",e),c(),u("ngIf",e),c(),u("ngIf",!e),c(2),u("title",e?"Sostituisci foto":"Aggiungi foto")("disabled",n.loadingPhotos),c(2),w(e?"camera_alt":"add_a_photo"),c(),u("ngIf",e)}}function we(l,t){l&1&&(o(0,"div",81),S(1,"div",82),o(2,"p",6),a(3,"Caricamento in corso..."),r()())}function Ee(l,t){if(l&1){let e=g();o(0,"div",8)(1,"div",23)(2,"span",10),a(3,"photo_library"),r(),o(4,"h2",11),a(5,"Galleria Foto del Ristorante"),r()(),o(6,"p",54),a(7," Carica fino a 5 foto (max 10MB ciascuna) per mostrare il tuo ristorante ai clienti. Solo immagini sono permesse. "),r(),o(8,"input",55,0),h("change",function(n){m(e);let s=d();return p(s.onPhotoFileSelected(n))}),r(),o(10,"div",56)(11,"div",57),_(12,ye,13,12,"div",58),r(),_(13,we,4,0,"div",59),r()()}if(l&2){let e=d();c(8),u("disabled",e.loadingPhotos),c(2),C("loading",e.loadingPhotos),c(2),u("ngForOf",e.photos)("ngForTrackBy",e.trackByIndex),c(),u("ngIf",e.loadingPhotos)}}function Ce(l,t){if(l&1){let e=g();o(0,"button",95),h("click",function(n){return m(e),d(2).navigateFullscreenPhoto("prev"),p(n.stopPropagation())}),o(1,"span",14),a(2,"chevron_left"),r()()}}function Pe(l,t){if(l&1){let e=g();o(0,"button",96),h("click",function(n){return m(e),d(2).navigateFullscreenPhoto("next"),p(n.stopPropagation())}),o(1,"span",14),a(2,"chevron_right"),r()()}}function ke(l,t){if(l&1&&(o(0,"div",97),a(1),r()),l&2){let e=d(2);c(),F(" ",e.currentPhotoIndex+1," / ",e.photos.length," ")}}function Ie(l,t){if(l&1){let e=g();o(0,"div",83),h("click",function(){m(e);let n=d();return p(n.closeFullscreenPhoto())}),o(1,"div",84),h("click",function(n){return m(e),p(n.stopPropagation())}),o(2,"div",85)(3,"h2",86)(4,"span",14),a(5,"photo"),r(),a(6," Galleria Foto "),r(),o(7,"button",87),h("click",function(){m(e);let n=d();return p(n.closeFullscreenPhoto())}),o(8,"span",14),a(9,"close"),r()()(),o(10,"div",88)(11,"div",89),_(12,Ce,3,0,"button",90),o(13,"div",91),S(14,"img",92),r(),_(15,Pe,3,0,"button",93)(16,ke,2,2,"div",94),r()()()()}if(l&2){let e=d();c(12),u("ngIf",e.hasMultiplePhotos),c(2),u("src",e.fullscreenPhoto,V)("alt","Foto galleria "+(e.currentPhotoIndex||0)),c(),u("ngIf",e.hasMultiplePhotos),c(),u("ngIf",e.currentPhotoIndex!==null)}}function Me(l,t){l&1&&(o(0,"span",14),a(1,"sync"),r())}function Re(l,t){l&1&&(o(0,"span",14),a(1,"save"),r())}function Ve(l,t){l&1&&(o(0,"span"),a(1,"Salvataggio..."),r())}function Fe(l,t){l&1&&(o(0,"span"),a(1,"Salva Impostazioni"),r())}function Te(l,t){if(l&1){let e=g();o(0,"label",25)(1,"input",107),h("change",function(n){let s=m(e).index,f=d(2);return p(f.toggleCurrentShiftDay(s,n))}),r(),o(2,"div",27)(3,"strong"),a(4),r()()()}if(l&2){let e=t.$implicit,i=t.index,n=d(2);c(),u("checked",n.isDaySelected(n.currentShift.days_of_week,i)),c(3),w(e)}}function Oe(l,t){if(l&1){let e=g();o(0,"div",83),h("click",function(){m(e);let n=d();return p(n.closeShiftModal())}),o(1,"div",98),h("click",function(n){return m(e),p(n.stopPropagation())}),o(2,"div",85)(3,"h2",99)(4,"span",14),a(5,"schedule"),r(),a(6),r(),o(7,"button",87),h("click",function(){m(e);let n=d();return p(n.closeShiftModal())}),o(8,"span",14),a(9,"close"),r()()(),o(10,"div",100)(11,"div",8)(12,"div",9)(13,"label",13)(14,"span",14),a(15,"badge"),r(),a(16," Nome Turno * "),r(),o(17,"input",101),I("ngModelChange",function(n){m(e);let s=d();return k(s.currentShift.name,n)||(s.currentShift.name=n),p(n)}),r()(),o(18,"div",9)(19,"div",12)(20,"label",13)(21,"span",14),a(22,"schedule"),r(),a(23," Ora Inizio * "),r(),o(24,"input",102),I("ngModelChange",function(n){m(e);let s=d();return k(s.currentShift.start_time,n)||(s.currentShift.start_time=n),p(n)}),r()(),o(25,"div",12)(26,"label",13)(27,"span",14),a(28,"schedule"),r(),a(29," Ora Fine * "),r(),o(30,"input",102),I("ngModelChange",function(n){m(e);let s=d();return k(s.currentShift.end_time,n)||(s.currentShift.end_time=n),p(n)}),r()()(),o(31,"div",9)(32,"label",25)(33,"input",103),I("ngModelChange",function(n){m(e);let s=d();return k(s.currentShift.is_active,n)||(s.currentShift.is_active=n),p(n)}),r(),o(34,"div",27)(35,"strong"),a(36,"Turno attivo"),r(),o(37,"div",6),a(38,"Il turno sar\xE0 disponibile per le prenotazioni"),r()()()(),o(39,"div",42)(40,"label",13)(41,"span",14),a(42,"event"),r(),a(43," Giorni Attivi * "),r(),o(44,"div",57),_(45,Te,5,2,"label",104),r()()()(),o(46,"div",105)(47,"button",53),h("click",function(){m(e);let n=d();return p(n.closeShiftModal())}),o(48,"span",14),a(49,"close"),r(),a(50," Annulla "),r(),o(51,"button",106),h("click",function(){m(e);let n=d();return p(n.saveShift())}),o(52,"span",14),a(53,"save"),r(),a(54),r()()()()}if(l&2){let e=d();c(6),b(" ",e.editingShift==="new"?"Aggiungi Nuovo Turno":"Modifica Turno"," "),c(11),P("ngModel",e.currentShift.name),u("ngModelOptions",E(12,R)),c(7),P("ngModel",e.currentShift.start_time),u("ngModelOptions",E(13,R)),c(6),P("ngModel",e.currentShift.end_time),u("ngModelOptions",E(14,R)),c(3),P("ngModel",e.currentShift.is_active),u("ngModelOptions",E(15,R)),c(12),u("ngForOf",e.weekDays),c(6),u("disabled",!e.isCurrentShiftValid()),c(3),b(" ",e.editingShift==="new"?"Aggiungi Turno":"Salva Modifiche"," ")}}var ce=class l{constructor(t,e,i){this.fb=t;this.supabaseService=e;this.auth=i;this.supabaseClient=this.supabaseService.getSupabaseClient()}settingsForm;loading=!1;restaurantId;logoPreview;coverPreview;showShiftModal=!1;fileInput;currentSlotIndex=null;shiftService=N(le);shiftsSubscription;shifts=[];editingShift=null;currentShift=this.createEmptyShift();weekDays=["Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato","Domenica"];cuisineTypes=["Italiana","Giapponese","Cinese","Indiana","Messicana","Francese","Spagnola","Thailandese","Greca","Americana","Vegetariana","Vegana"];photos=Array(8).fill(null);loadingPhotos=!1;fullscreenPhoto=null;canManagePhotos=!1;currentPhotoIndex=null;supabaseClient;ngOnInit(){return v(this,null,function*(){this.initForm(),yield this.loadRestaurantData(),this.setupShiftsSubscription()})}ngOnDestroy(){this.shiftsSubscription&&this.shiftsSubscription.unsubscribe()}setupShiftsSubscription(){this.shiftsSubscription=this.shiftService.shifts$.subscribe(t=>{this.shifts=t})}initForm(){this.settingsForm=this.fb.group({name:["",[y.required,y.minLength(2)]],description:[""],address:["",y.required],phone:["",[y.required,y.pattern(/^\+?\d{8,15}$/)]],email:["",[y.required,y.email]],cuisine_type:[""],accepts_delivery:[!1],accepts_takeaway:[!1],allow_table_selection:[!1],is_active:[!0]})}loadRestaurantData(){return v(this,null,function*(){this.loading=!0;try{let t=this.auth.currentUserValue;if(!t)throw new Error("Utente non loggato");let{data:e,error:i}=yield this.supabaseClient.from("restaurants").select("*").eq("owner_id",t.id).single();if(i)throw i;if(!e)throw new Error("Ristorante non trovato");this.restaurantId=e.id,this.patchForm(e),this.logoPreview=e.logo_url||void 0,this.coverPreview=e.cover_image_url||void 0,this.restaurantId&&(this.canManagePhotos=yield this.supabaseService.canUserManageRestaurantPhotos(this.restaurantId),this.canManagePhotos&&(yield this.loadRestaurantPhotos()))}catch(t){alert("Errore caricamento: "+(t.message||"Impossibile caricare i dati")),console.error(t)}finally{this.loading=!1}})}patchForm(t){this.settingsForm.patchValue({name:t.name,description:t.description||"",address:t.address,phone:t.phone,email:t.email,cuisine_type:t.cuisine_type||"",accepts_delivery:t.accepts_delivery,accepts_takeaway:t.accepts_takeaway,allow_table_selection:t.allow_table_selection,is_active:t.is_active})}createEmptyShift(){return{name:"",start_time:"12:00",end_time:"15:00",days_of_week:[1,2,3,4,5,6,7],is_active:!0}}addNewShift(){this.editingShift="new",this.currentShift=this.createEmptyShift(),this.showShiftModal=!0}editShift(t){this.editingShift=t;let e=this.shifts[t];this.currentShift={name:e.name,start_time:e.start_time,end_time:e.end_time,days_of_week:[...e.days_of_week],is_active:e.is_active},this.showShiftModal=!0}closeShiftModal(){this.showShiftModal=!1,this.editingShift=null}saveShift(){return v(this,null,function*(){if(!(!this.isCurrentShiftValid()||!this.restaurantId)){this.loading=!0;try{if(this.editingShift==="new")if(yield this.shiftService.createShift(this.currentShift))alert("Turno creato con successo!"),this.closeShiftModal();else throw new Error("Errore nella creazione del turno");else if(typeof this.editingShift=="number"){let t=this.shifts[this.editingShift].id;if(yield this.shiftService.updateShift(t,this.currentShift))alert("Turno aggiornato con successo!"),this.closeShiftModal();else throw new Error("Errore nell'aggiornamento del turno")}}catch(t){alert("Errore salvataggio turno: "+t.message),console.error(t)}finally{this.loading=!1}}})}deleteShift(t){return v(this,null,function*(){if(!confirm("Sei sicuro di voler eliminare questo turno?"))return;let e=this.shifts[t].id;if(e){this.loading=!0;try{if(yield this.shiftService.deleteShift(e))alert("Turno eliminato con successo!");else throw new Error("Errore nell'eliminazione del turno")}catch(i){alert("Errore eliminazione turno: "+i.message),console.error(i)}finally{this.loading=!1}}})}toggleCurrentShiftDay(t,e){let i=e.target.checked,n=t+1;i?this.currentShift.days_of_week.includes(n)||this.currentShift.days_of_week.push(n):this.currentShift.days_of_week=this.currentShift.days_of_week.filter(s=>s!==n)}isCurrentShiftValid(){return!!(this.currentShift.name&&this.currentShift.start_time&&this.currentShift.end_time&&this.currentShift.days_of_week.length>0)}isDaySelected(t,e){let i=e+1;return t.includes(i)}onFileSelect(t,e){return v(this,null,function*(){let i=t.target;if(!i.files?.length||!this.restaurantId)return;let n=i.files[0],s=5*1024*1024;if(n.size>s){alert("Immagine troppo grande (max 5MB)");return}let f=`restaurants/${this.restaurantId}/${e}s/${Date.now()}_${n.name}`;this.loading=!0;try{let{error:x}=yield this.supabaseClient.storage.from("restaurant-images").upload(f,n,{upsert:!0});if(x)throw x;let{data:{publicUrl:T}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(f);e==="logo"?this.logoPreview=T:this.coverPreview=T,alert(`${e==="logo"?"Logo":"Copertina"} caricata!`)}catch(x){alert("Errore upload: "+x.message),console.error(x)}finally{this.loading=!1}})}onSubmit(){return v(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId)){this.loading=!0;try{let t=this.settingsForm.value,e={name:t.name,description:t.description||null,address:t.address,phone:t.phone,email:t.email,cuisine_type:t.cuisine_type||null,accepts_delivery:t.accepts_delivery,accepts_takeaway:t.accepts_takeaway,allow_table_selection:t.allow_table_selection,is_active:t.is_active,updated_at:new Date().toISOString()};this.logoPreview&&(e.logo_url=this.logoPreview),this.coverPreview&&(e.cover_image_url=this.coverPreview);let{error:i}=yield this.supabaseClient.from("restaurants").update(e).eq("id",this.restaurantId);if(i)throw i;alert("Impostazioni salvate con successo!")}catch(t){alert("Errore salvataggio: "+t.message),console.error(t)}finally{this.loading=!1}}})}toggleShiftActive(t){return v(this,null,function*(){let e=this.shifts[t],i=!e.is_active;if(confirm(`Sei sicuro di voler ${i?"attivare":"disattivare"} il turno "${e.name}"?`)){this.loading=!0;try{if(!(yield this.shiftService.updateShift(e.id,{is_active:i})))throw new Error(`Errore nella ${i?"attivazione":"disattivazione"} del turno`);alert(`Turno "${e.name}" ${i?"attivato":"disattivato"} con successo!`)}catch(n){alert(`Errore: ${n.message}`),console.error(n)}finally{this.loading=!1}}})}toggleRestaurantActive(){return v(this,null,function*(){if(!this.restaurantId)return;let t=this.settingsForm.get("is_active")?.value,e=!t;if(!t&&!confirm(`Sei sicuro di voler disattivare il ristorante?

I clienti non potranno pi\xF9 vederlo n\xE9 effettuare ordini fino a quando non lo riattiverai.`)){this.settingsForm.patchValue({is_active:e},{emitEvent:!1});return}this.loading=!0;try{let{error:i}=yield this.supabaseClient.from("restaurants").update({is_active:t,updated_at:new Date().toISOString()}).eq("id",this.restaurantId);if(i)throw i;alert(t?"Ristorante riattivato! Ora \xE8 visibile ai clienti.":"Ristorante disattivato correttamente.")}catch(i){alert("Errore: "+i.message),this.settingsForm.patchValue({is_active:e},{emitEvent:!1})}finally{this.loading=!1}})}loadRestaurantPhotos(){return v(this,null,function*(){if(!this.restaurantId){console.error("restaurantId non definito");return}this.loadingPhotos=!0;try{let t=yield this.supabaseService.getRestaurantPhotos(this.restaurantId);console.log("Foto ottenute dal servizio:",t),this.photos=Array(8).fill(null),t.forEach(e=>{let i=e.display_order-1;if(i>=0&&i<8){if(!e.url&&e.file_path){let{data:{publicUrl:n}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(e.file_path);e.url=n}this.photos[i]=e}}),console.log("Photos array dopo caricamento:",this.photos)}catch(t){console.error("Errore caricamento foto:",t),alert("Errore nel caricamento delle foto")}finally{this.loadingPhotos=!1}})}onImageError(t,e){let i=t.target;console.error(`Errore caricamento immagine slot ${e}:`,i.src),i.style.display="none";let n=i.parentElement;if(n){let s=document.createElement("div");s.className="error-placeholder",s.style.cssText="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: var(--danger); font-size: 12px;",s.textContent="Errore caricamento",n.appendChild(s)}}onPhotoFileSelect(t,e){return v(this,null,function*(){if(!this.restaurantId){alert("Ristorante non trovato");return}if(t.size>10*1024*1024){alert("File troppo grande (max 10MB)");return}if(!t.type.startsWith("image/")){alert("Solo file immagine sono permessi");return}this.loadingPhotos=!0;try{let i=e+1;console.log("Inizio upload foto per slot",e,"ordine",i);let n=yield this.supabaseService.uploadRestaurantPhoto(this.restaurantId,t,i);if(!n)throw new Error("Upload fallito");console.log("Upload completato:",n);let s=yield this.supabaseService.saveRestaurantPhotoRecord({restaurant_id:this.restaurantId,file_path:n.filePath,display_order:i});if(!s)throw new Error("Salvataggio record fallito");let f=z(O({},s),{url:n.publicUrl});console.log("Record salvato, URL:",f.url),this.photos[e]=f,alert(`Foto ${i} caricata con successo!`)}catch(i){console.error("Errore upload foto:",i),alert("Errore durante l'upload: "+i.message)}finally{this.loadingPhotos=!1}})}deletePhoto(t){return v(this,null,function*(){if(!this.restaurantId){alert("Ristorante non trovato");return}let e=this.photos[t];if(!(!e||!confirm("Sei sicuro di voler eliminare questa foto?"))){this.loadingPhotos=!0;try{if(yield this.supabaseService.deleteRestaurantPhoto(e.id,e.file_path))this.photos[t]=null,alert("Foto eliminata con successo!");else throw new Error("Eliminazione fallita")}catch(i){console.error("Errore eliminazione foto:",i),alert("Errore durante l'eliminazione: "+i.message)}finally{this.loadingPhotos=!1}}})}changePhotoOrder(t,e){return v(this,null,function*(){if(!this.restaurantId)throw alert("Ristorante non trovato"),new Error("Ristorante non trovato");let i=this.photos[t];if(!i)throw new Error("Nessuna foto in questo slot");let n=i.display_order;if(n!==e){this.loadingPhotos=!0;try{console.log(`\u{1F4F8} Cambio ordine: Slot ${t}, Foto ID ${i.id}, Da ${n} a ${e}`);let s=this.photos.find(f=>f&&f.display_order===e);s?(yield Promise.all([this.supabaseService.updatePhotoOrder(i.id,e),this.supabaseService.updatePhotoOrder(s.id,n)]),i.display_order=e,s.display_order=n,console.log(`\u{1F504} Scambiato con foto ID ${s.id}`)):(yield this.supabaseService.updatePhotoOrder(i.id,e),i.display_order=e),this.reorganizePhotosByOrder(),console.log("\u2705 Ordine aggiornato nel database e localmente")}catch(s){throw console.error("\u274C Errore aggiornamento ordine:",s),alert("Errore durante l'aggiornamento: "+s.message),i.display_order=n,s}finally{this.loadingPhotos=!1}}})}reorganizePhotosByOrder(){let t=this.photos.filter(i=>i!==null).sort((i,n)=>i.display_order-n.display_order),e=Array(8).fill(null);t.forEach(i=>{let n=i.display_order-1;n>=0&&n<8&&(e[n]=i)}),this.photos=e,console.log("\u{1F504} Foto riorganizzate:",this.photos.map((i,n)=>i?`Slot ${n+1}: ordine ${i.display_order}`:`Slot ${n+1}: vuoto`))}openFullscreenPhoto(t,e){this.fullscreenPhoto=t,this.currentPhotoIndex=e}openPhotoIfAvailable(t,e){t?.url&&this.openFullscreenPhoto(t.url,e)}openPhoto(t,e){t?.url&&this.openFullscreenPhoto(t.url,e)}onPhotoOrderChange(t,e){let i=e.target,n=Number(i.value);if(n<1||n>8){alert("Ordine non valido. Deve essere tra 1 e 8.");let x=this.photos[t];x&&(i.value=x.display_order.toString());return}let s=this.photos[t];if(!s){alert("Nessuna foto in questo slot");return}if(s.display_order===n)return;console.log(`\u{1F504} Cambio ordine richiesto: slot ${t}, da ${s.display_order} a ${n}`);let f=s.display_order;i.value=n.toString(),this.changePhotoOrder(t,n).then(()=>{console.log("\u2705 Cambio ordine completato con successo")}).catch(x=>{console.error("\u274C Errore cambio ordine:",x),i.value=f.toString()})}get loadedPhotosCount(){return this.photos.filter(t=>t!==null).length}get hasMultiplePhotos(){return this.loadedPhotosCount>1}closeFullscreenPhoto(){this.fullscreenPhoto=null,this.currentPhotoIndex=null}navigateFullscreenPhoto(t){if(this.currentPhotoIndex===null||!this.photos)return;let e=t==="next"?this.currentPhotoIndex+1:this.currentPhotoIndex-1;e<0&&(e=this.photos.length-1),e>=this.photos.length&&(e=0);let i=!1,n=0;for(;!i&&n<this.photos.length;){let s=this.photos[e];s?.url?(this.fullscreenPhoto=s.url,this.currentPhotoIndex=e,i=!0):(e=t==="next"?e+1:e-1,e<0&&(e=this.photos.length-1),e>=this.photos.length&&(e=0),n++)}}triggerFileInput(t){this.currentSlotIndex=t,this.fileInput.nativeElement.click()}onPhotoFileSelected(t){let e=t.target;if(!e.files?.length||this.currentSlotIndex===null||!this.restaurantId)return;let i=e.files[0],n=this.currentSlotIndex;this.currentSlotIndex=null,e.value="",this.onPhotoFileSelect(i,n)}trackByIndex(t,e){return t}static \u0275fac=function(e){return new(e||l)(M(oe),M(G),M(H))};static \u0275cmp=D({type:l,selectors:[["app-restaurant-settings"]],viewQuery:function(e,i){if(e&1&&$(de,5),e&2){let n;A(n=j())&&(i.fileInput=n.first)}},decls:117,vars:12,consts:[["fileInput",""],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"flex","flex-col","gap-sm",3,"ngSubmit","formGroup"],[1,"form-card"],[1,"form-row","mb-md"],[1,"material-icons","text-md"],[1,"text-md","font-semibold","m-0"],[1,"form-group"],[1,"standard-label"],[1,"material-icons"],["type","text","formControlName","name","placeholder","Es: Trattoria da Mario"],["type","email","formControlName","email","placeholder","info@ristorante.it"],["type","tel","formControlName","phone","placeholder","+39 123 456 7890"],["formControlName","cuisine_type"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","address","placeholder","Via Roma 123, Milano"],["formControlName","description","rows","3","placeholder","Racconta la storia del tuo ristorante..."],[1,"flex","items-center","gap-sm","mb-md"],[1,"flex","flex-col","gap-md"],[1,"checkbox-label"],["type","checkbox","formControlName","accepts_delivery"],[1,"checkbox-content"],["type","checkbox","formControlName","accepts_takeaway"],["type","checkbox","formControlName","allow_table_selection"],["type","checkbox","formControlName","is_active",3,"change"],["class","shift-item",4,"ngFor","ngForOf"],["type","button","class","promethea-button ghost",3,"click",4,"ngIf"],["class","form-card",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-footer","p-md0"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"shift-item"],[1,"flex","justify-between","items-start","mb-sm","p-sm"],[1,"flex","flex-col","gap-sm"],[1,"font-semibold"],[1,"flex","flex-wrap","gap-sm"],[1,"chip"],[1,"material-icons","text-sm"],["type","button",1,"icon-button",3,"click","title"],["type","button","title","Modifica turno",1,"icon-button",3,"click"],["type","button","class","icon-button","title","Elimina turno",3,"click",4,"ngIf"],[1,"flex","flex-wrap","gap-sm","mt-sm","p-sm0"],["class","chip",3,"active",4,"ngFor","ngForOf"],["type","button","title","Elimina turno",1,"icon-button",3,"click"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"text-muted","mb-md"],["type","file","accept","image/*",2,"display","none",3,"change","disabled"],[1,"gallery-container"],[1,"grid-cards"],["class","card",4,"ngFor","ngForOf","ngForTrackBy"],["style","position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center;",4,"ngIf"],[1,"card"],[1,"flex","justify-between","items-center","mb-sm"],["class","order-selector flex items-center gap-sm",4,"ngIf"],[1,"photo-preview","rounded-lg","border","transition","cursor-pointer","mb-sm",2,"min-height","150px","display","flex","align-items","center","justify-content","center","overflow","hidden","position","relative",3,"click"],["class","w-full h-full",4,"ngIf"],["class","empty-photo-slot flex flex-col items-center justify-center p-md",4,"ngIf"],[1,"card-footer","gap-sm"],["type","button",1,"icon-button","x-small",3,"click","title","disabled"],["type","button","class","icon-button x-small","title","Elimina foto","style","color: var(--primary);",3,"disabled","click",4,"ngIf"],[1,"order-selector","flex","items-center","gap-sm"],[1,"text-mini"],[1,"text-mini",3,"change","disabled"],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],[1,"w-full","h-full"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"error","src","alt"],[1,"photo-hover-overlay"],[1,"empty-photo-slot","flex","flex-col","items-center","justify-center","p-md"],[1,"material-icons","empty-icon",2,"font-size","48px","color","var(--smoke-3)","margin-bottom","8px"],[1,"text-sm","text-muted"],["type","button","title","Elimina foto",1,"icon-button","x-small",2,"color","var(--primary)",3,"click","disabled"],[2,"position","absolute","top","0","left","0","right","0","bottom","0","background","rgba(255,255,255,0.9)","z-index","10","display","flex","flex-direction","column","align-items","center","justify-content","center"],[1,"spinner",2,"width","40px","height","40px","border","3px solid var(--smoke-1)","border-top-color","var(--primary)","border-radius","50%","animation","spin 1s linear infinite","margin-bottom","var(--gap-sm)"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"text-md","font-semibold","m-0","flex","items-center","gap-sm"],[1,"icon-button",3,"click"],[1,"modal-content","p-lg","flex","items-center","justify-center",2,"min-height","60vh"],[2,"position","relative","width","100%","height","100%","display","flex","align-items","center","justify-content","center"],["style","position: absolute; left: 0; z-index: 20; background: var(--smoke-2); margin: 0 var(--gap-sm);","class","icon-button",3,"click",4,"ngIf"],[2,"max-width","64rem","max-height","70vh","display","flex","align-items","center","justify-content","center"],[2,"max-width","100%","max-height","70vh","object-fit","contain","border-radius","12px",3,"src","alt"],["style","position: absolute; right: 0; z-index: 20; background: var(--smoke-2); margin: 0 var(--gap-sm);","class","icon-button",3,"click",4,"ngIf"],["style","position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 0.25rem 1rem; border-radius: 999px; font-size: 0.875rem;",4,"ngIf"],[1,"icon-button",2,"position","absolute","left","0","z-index","20","background","var(--smoke-2)","margin","0 var(--gap-sm)",3,"click"],[1,"icon-button",2,"position","absolute","right","0","z-index","20","background","var(--smoke-2)","margin","0 var(--gap-sm)",3,"click"],[2,"position","absolute","bottom","1rem","left","50%","transform","translateX(-50%)","background","rgba(0,0,0,0.7)","color","white","padding","0.25rem 1rem","border-radius","999px","font-size","0.875rem"],[1,"modal-container",3,"click"],[1,"section-title","m-0"],[1,"modal-content"],["type","text","placeholder","Es: Pranzo, Cena","autofocus","",3,"ngModelChange","ngModel","ngModelOptions"],["type","time",3,"ngModelChange","ngModel","ngModelOptions"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],["class","checkbox-label",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"promethea-button",3,"click","disabled"],["type","checkbox",3,"change","checked"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),a(4,"settings"),r(),o(5,"h1",5),a(6,"Impostazioni Ristorante"),r()(),o(7,"p",6),a(8,"Gestisci le informazioni e i servizi del tuo ristorante"),r()(),o(9,"form",7),h("ngSubmit",function(){return i.onSubmit()}),o(10,"div",8)(11,"div",9)(12,"span",10),a(13,"info"),r(),o(14,"h2",11),a(15,"Informazioni Base"),r()(),o(16,"div",9)(17,"div",12)(18,"label",13)(19,"span",14),a(20,"restaurant"),r(),a(21," Nome Ristorante * "),r(),S(22,"input",15),r()(),o(23,"div",9)(24,"div",12)(25,"label",13)(26,"span",14),a(27,"email"),r(),a(28," Email * "),r(),S(29,"input",16),r(),o(30,"div",12)(31,"label",13)(32,"span",14),a(33,"phone"),r(),a(34," Telefono * "),r(),S(35,"input",17),r()(),o(36,"div",9)(37,"div",12)(38,"label",13)(39,"span",14),a(40,"local_dining"),r(),a(41," Tipo di Cucina "),r(),o(42,"select",18)(43,"option",19),a(44,"Seleziona..."),r(),_(45,me,2,2,"option",20),r()(),o(46,"div",12)(47,"label",13)(48,"span",14),a(49,"location_on"),r(),a(50," Indirizzo * "),r(),S(51,"input",21),r()(),o(52,"div",9)(53,"label",13)(54,"span",14),a(55,"description"),r(),a(56," Descrizione "),r(),S(57,"textarea",22),r()(),o(58,"div",8)(59,"div",23)(60,"span",10),a(61,"room_service"),r(),o(62,"h2",11),a(63,"Servizi Offerti"),r()(),o(64,"div",24)(65,"label",25),S(66,"input",26),o(67,"div",27)(68,"strong"),a(69,"Consegna a domicilio"),r(),o(70,"div",6),a(71,"I clienti possono ordinare con consegna"),r()()(),o(72,"label",25),S(73,"input",28),o(74,"div",27)(75,"strong"),a(76,"Asporto"),r(),o(77,"div",6),a(78,"I clienti possono ritirare in loco"),r()()(),o(79,"label",25),S(80,"input",29),o(81,"div",27)(82,"strong"),a(83,"Prenotazione tavolo"),r(),o(84,"div",6),a(85,"I clienti possono scegliere il tavolo"),r()()()()(),o(86,"div",8)(87,"div",23)(88,"span",10),a(89,"visibility"),r(),o(90,"h2",11),a(91,"Stato Ristorante"),r()(),o(92,"label",25)(93,"input",30),h("change",function(){return i.toggleRestaurantActive()}),r(),o(94,"div",27)(95,"strong"),a(96,"Ristorante attivo"),r(),o(97,"div",6),a(98,"Visibile ai clienti e accettazione ordini"),r()()()(),o(99,"div",8)(100,"div",23)(101,"span",10),a(102,"schedule"),r(),o(103,"h2",11),a(104,"Turni di Lavoro"),r()(),o(105,"div",24),_(106,fe,22,14,"div",31)(107,_e,4,0,"button",32),r()(),_(108,Ee,14,6,"div",33)(109,Ie,17,5,"div",34),o(110,"div",35)(111,"button",36),_(112,Me,2,0,"span",37)(113,Re,2,0,"span",37)(114,Ve,2,0,"span",38)(115,Fe,2,0,"span",38),r()()()(),_(116,Oe,55,16,"div",34)),e&2&&(c(9),u("formGroup",i.settingsForm),c(36),u("ngForOf",i.cuisineTypes),c(61),u("ngForOf",i.shifts),c(),u("ngIf",i.editingShift===null),c(),u("ngIf",i.canManagePhotos),c(),u("ngIf",i.fullscreenPhoto),c(2),u("disabled",i.loading||i.settingsForm.invalid),c(),u("ngIf",i.loading),c(),u("ngIf",!i.loading),c(),u("ngIf",i.loading),c(),u("ngIf",!i.loading),c(),u("ngIf",i.showShiftModal))},dependencies:[q,U,W,se,Z,ne,re,X,Q,ie,J,K,ee,te,ae,Y],styles:[".shift-item[_ngcontent-%COMP%]{padding:var(--gap-md);border:1px solid var(--smoke-1);border-radius:12px;transition:all .2s ease}.shift-item[_ngcontent-%COMP%]:hover{border-color:var(--secondary);background:var(--smoke-1)}.shift-form[_ngcontent-%COMP%]{border:2px solid var(--smoke-2)}.chip.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.text-green-500[_ngcontent-%COMP%]{color:#10b981}.text-orange-500[_ngcontent-%COMP%]{color:#f59e0b}.material-icons[_ngcontent-%COMP%]{transition:all .2s ease}@media (max-width: 768px){.shift-item[_ngcontent-%COMP%]{padding:var(--gap-sm)}.shift-item[_ngcontent-%COMP%]   .flex-wrap[_ngcontent-%COMP%]{justify-content:flex-start}}@media (max-width: 480px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr}.md\\\\[_ngcontent-%COMP%]:col-span-2{grid-column:1}}.gallery-container[_ngcontent-%COMP%]{position:relative;min-height:300px}.photo-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.photo-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;border-radius:8px}.photo-hover-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease;border-radius:8px;pointer-events:none}.photo-preview[_ngcontent-%COMP%]:hover   .photo-hover-overlay[_ngcontent-%COMP%]{opacity:1}.photo-hover-overlay[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#fff;font-size:2rem}.empty-photo-slot[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-muted);padding:var(--gap-lg)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:var(--gap-sm);opacity:.5}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--smoke-1);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:var(--gap-sm)}.nav-button[_ngcontent-%COMP%]{background:var(--smoke-2);margin:0 var(--gap-sm)}.nav-button[_ngcontent-%COMP%]:hover{background:var(--smoke-3)}.photo-counter[_ngcontent-%COMP%]{background:#000000b3;color:#fff;padding:.25rem 1rem;border-radius:999px;font-size:.875rem}@media (max-width: 768px){.grid-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))!important}.photo-preview[_ngcontent-%COMP%]{min-height:120px!important}}"]})};export{ce as RestaurantSettings};
