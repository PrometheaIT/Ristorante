import{b}from"./chunk-4GBXVLF4.js";import{Y as p,ba as _,g}from"./chunk-DU5L5MFQ.js";import{j as s}from"./chunk-4ZZIO3ZI.js";var m=class l{supabaseService=_(b);restaurantSubject=new g(null);restaurant$=this.restaurantSubject.asObservable();loadRestaurantById(t){return s(this,null,function*(){try{let e=this.supabaseService.getSupabaseClient(),{data:r,error:i}=yield e.from("restaurants").select("*").eq("id",t).eq("is_active",!0).single();if(i)throw i;if(r){if(r.logo_url){let{data:{publicUrl:n}}=e.storage.from("restaurant-images").getPublicUrl(r.logo_url);r.logo_url=n}if(r.cover_image_url){let{data:{publicUrl:n}}=e.storage.from("restaurant-images").getPublicUrl(r.cover_image_url);r.cover_image_url=n}}return r}catch(e){return console.error("\u274C Error loading restaurant by ID:",e),null}})}loadRestaurant(t){return s(this,null,function*(){let e=yield this.loadRestaurantById(t);return this.restaurantSubject.next(e),e})}loadRestaurantsByCuisine(t){return s(this,null,function*(){try{let e=this.supabaseService.getSupabaseClient().from("restaurants").select("*").eq("is_active",!0).order("name");t&&(e=e.eq("cuisine_type",t));let{data:r,error:i}=yield e;if(i)throw i;return r||[]}catch(e){return console.error("\u274C Error loading restaurants:",e),[]}})}loadRestaurantShifts(t){return s(this,null,function*(){try{let{data:e,error:r}=yield this.supabaseService.getSupabaseClient().from("shifts").select("*").eq("restaurant_id",t).eq("is_active",!0).order("start_time");if(r)throw r;return e||[]}catch(e){return console.error("\u274C Error loading restaurant shifts:",e),[]}})}loadRestaurantDishes(r){return s(this,arguments,function*(t,e={}){let{includeCategories:i=!1,onlyActive:n=!0}=e;try{let o=this.supabaseService.getSupabaseClient().from("dishes").select(`
          id,
          name,
          description,
          base_price,
          delivery_price,
          takeaway_price,
          image_url,
          preparation_time,
          status,
          category_id,
          categories ( id, name )
        `).eq("restaurant_id",t);n&&(o=o.eq("status","available"));let{data:u,error:c}=yield o.order("name");if(c)throw c;return(u||[]).map(a=>{let d={id:a.id,name:a.name,description:a.description,base_price:a.base_price,delivery_price:a.delivery_price,takeaway_price:a.takeaway_price,image_url:a.image_url,preparation_time:a.preparation_time,status:a.status,category_id:a.category_id};return i&&a.categories&&a.categories.length>0&&(d.category_name=a.categories[0].name),d})}catch(o){return console.error("\u274C Error loading restaurant dishes:",o),[]}})}loadRestaurantCategories(t){return s(this,null,function*(){try{let{data:e,error:r}=yield this.supabaseService.getSupabaseClient().from("categories").select("*").eq("restaurant_id",t).order("order_index");if(r)throw r;return e||[]}catch(e){return console.error("\u274C Error loading restaurant categories:",e),[]}})}loadRestaurantPhotos(t){return s(this,null,function*(){try{let e=this.supabaseService.getSupabaseClient(),{data:r,error:i}=yield e.from("restaurant_photos").select("file_path").eq("restaurant_id",t).order("display_order",{ascending:!0});if(i)throw i;return(r||[]).map(n=>e.storage.from("restaurant-images").getPublicUrl(n.file_path).data.publicUrl)}catch(e){return console.error("\u274C Error loading restaurant photos:",e),[]}})}loadRestaurantMenus(t){return s(this,null,function*(){try{let{data:e,error:r}=yield this.supabaseService.getSupabaseClient().from("menus").select("*").eq("restaurant_id",t).eq("is_active",!0).order("display_order");if(r)throw r;return e||[]}catch(e){return console.error("\u274C Error loading restaurant menus:",e),[]}})}loadMenuDishes(t){return s(this,null,function*(){try{let{data:e,error:r}=yield this.supabaseService.getSupabaseClient().from("menu_dishes").select(`
          dish:dishes!dish_id (
            id, name, description, base_price, delivery_price,
            takeaway_price, image_url, preparation_time, status, category_id
          )
        `).eq("menu_id",t).eq("is_active",!0).order("display_order");if(r)throw r;return(e||[]).filter(i=>i.dish&&!i.dish.deleted_at).map(i=>i.dish)}catch(e){return console.error("\u274C Error loading menu dishes:",e),[]}})}loadActiveMenuDishes(t){return s(this,null,function*(){try{let e=this.supabaseService.getSupabaseClient(),{data:r,error:i}=yield e.from("menus").select("id").eq("restaurant_id",t).eq("is_active",!0);if(i)throw i;if(!r?.length)return[];let n=r.map(a=>a.id),{data:o,error:u}=yield e.from("menu_dishes").select(`
          dish:dishes!dish_id (
            id, name, description, base_price, delivery_price,
            takeaway_price, image_url, preparation_time, status, category_id
          )
        `).in("menu_id",n).eq("is_active",!0);if(u)throw u;let c=new Map;return(o||[]).forEach(a=>{a.dish&&!a.dish.deleted_at&&a.dish.status==="available"&&c.set(a.dish.id,a.dish)}),Array.from(c.values())}catch(e){return console.error("\u274C Error loading active menu dishes:",e),[]}})}getRestaurantFloorPlans(t){return s(this,null,function*(){try{let{data:e,error:r}=yield this.supabaseService.getSupabaseClient().from("restaurant_floor_plans").select("id, name").eq("restaurant_id",t).eq("is_active",!0).order("name");if(r)throw r;return e||[]}catch(e){return console.error("\u274C Error loading floor plans:",e),[]}})}static \u0275fac=function(e){return new(e||l)};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})};export{m as a};
