import{qb as A,rb as G}from"./chunk-7ARAJ5DM.js";import{B as N,a as O,b as E,c,d as z,e as L,j as F,o as I,r as T,z as j}from"./chunk-YO2SNT5L.js";import{a as P,b as k,d as S}from"./chunk-MEEOFM4U.js";import{e as C,f as M}from"./chunk-RD7WPZ3N.js";import"./chunk-JDHQCX3C.js";import{l as w,v as y}from"./chunk-RJWLMJIA.js";import{Ib as l,Kb as h,La as r,Va as _,_a as g,ca as p,gb as o,ib as u,qb as t,rb as n,sb as m,yb as x,zb as f}from"./chunk-KIAVC6JW.js";import{g as b}from"./chunk-RA2WU32H.js";function V(a,s){a&1&&(t(0,"span"),l(1,"L'email \xE8 obbligatoria"),n())}function q(a,s){a&1&&(t(0,"span"),l(1,"Inserisci un'email valida"),n())}function B(a,s){if(a&1&&(t(0,"div",56),m(1,"lucide-angular",57),g(2,V,2,0,"span",58)(3,q,2,0,"span",58),n()),a&2){let e=f();r(),o("size",14),r(),o("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),r(),o("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function U(a,s){a&1&&(t(0,"span"),l(1,"La password \xE8 obbligatoria"),n())}function $(a,s){a&1&&(t(0,"span"),l(1,"Minimo 6 caratteri"),n())}function H(a,s){if(a&1&&(t(0,"div",56),m(1,"lucide-angular",57),g(2,U,2,0,"span",58)(3,$,2,0,"span",58),n()),a&2){let e=f();r(),o("size",14),r(),o("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.required),r(),o("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.minlength)}}function J(a,s){if(a&1&&(t(0,"div",59),m(1,"lucide-angular",37),l(2),n()),a&2){let e=f();u("login-message--error",!e.errorMessage.includes("effettuato"))("login-message--success",e.errorMessage.includes("effettuato")),r(),o("name",e.errorMessage.includes("effettuato")?"check-circle":"alert-triangle")("size",16),r(),h(" ",e.errorMessage," ")}}function K(a,s){a&1&&m(0,"span",60)}function Q(a,s){a&1&&m(0,"lucide-angular",61),a&2&&o("size",18)}var R=class a{fb=p(j);authService=p(S);router=p(C);supabaseService=p(k);loginForm;isLoading=!1;errorMessage="";showPassword=!1;constructor(){this.loginForm=this.fb.group({email:["",[c.required,c.email]],password:["",[c.required,c.minLength(6)]],rememberMe:[!1]}),this.isProduction||this.prefillDemoCredentials()}onSubmit(){return b(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="";let{email:s,password:e,rememberMe:i}=this.loginForm.value;try{let d=yield this.authService.login(s,e,i);if(d.error){let v=d.error instanceof Error?d.error.message:String(d.error);this.errorMessage=this.getErrorMessage(v)}else if(d.data?.user){console.log("\u2705 Login effettuato con successo");let v=this.authService.getCurrentContext(),D={staff:"Dipendente",supplier:"Fornitore",customer:"Cliente"};this.errorMessage=`Accesso effettuato come ${D[v]}! Reindirizzamento...`,setTimeout(()=>{this.navigateBasedOnContext()},1e3)}}catch(d){console.error("Login error:",d),this.errorMessage="Errore durante il login. Riprova pi\xF9 tardi."}finally{this.isLoading=!1}})}checkStaffMembership(s){return b(this,null,function*(){try{let{data:e,error:i}=yield this.supabaseService.getSupabaseClient().from("restaurant_staff").select("*").eq("email",s.toLowerCase()).in("invitation_status",["accepted","pending"]);e&&e.length>0?console.log("\u{1F3AF} Utente trovato come staff member:",e):console.log("\u2139\uFE0F Utente non \xE8 staff member")}catch(e){console.log("\u2139\uFE0F Errore nel controllo staff membership:",e)}})}navigateBasedOnContext(){switch(this.authService.getCurrentContext()){case"staff":this.router.navigate(["/restaurant/dashboard"]);break;case"supplier":this.router.navigate(["/supplier/dashboard"]);break;case"customer":default:this.router.navigate(["/customer"]);break}}togglePasswordVisibility(){this.showPassword=!this.showPassword}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(s=>{this.loginForm.get(s)?.markAsTouched()})}getErrorMessage(s){return{"Invalid login credentials":"Email o password non validi.","Email not confirmed":"Email non confermata. Controlla la tua casella di posta.","Invalid email":"Email non valida.","Network error":"Errore di rete. Controlla la tua connessione.","Email rate limit exceeded":"Troppi tentativi. Riprova pi\xF9 tardi."}[s]||`Errore: ${s}`}prefillDemoCredentials(){console.log("Modalit\xE0 sviluppo: credenziali demo disponibili")}useDemoCredentials(s){s==="restaurant"?this.loginForm.patchValue({email:"ristorante@demo.com",password:"demodemo"}):this.loginForm.patchValue({email:"cliente@demo.com",password:"demodemo"})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}get isProduction(){return P.production}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=_({type:a,selectors:[["app-login"]],decls:79,vars:21,consts:[[1,"login-page"],["aria-hidden","true",1,"login-bg"],[1,"login-blob","login-blob--1"],[1,"login-blob","login-blob--2"],[1,"login-blob","login-blob--3"],[1,"login-aurora"],[1,"login-grid"],[1,"login-split"],[1,"login-brand","flex","flex-col","justify-between","p-lg"],[1,"flex","flex-col","gap-lg"],[1,"immaginebrand"],["src","logoristoapp.png",1,"logopiccolo"],[1,"flex","flex-col","gap-sm"],[1,"text-xl","gradient-text"],[1,"text-md","gradient-text"],[1,"text-muted",2,"max-width","32ch"],[1,"flex","flex-wrap","gap-sm"],[1,"chip"],[1,"login-form-panel","flex","flex-col","justify-center","p-lg"],[1,"login-card"],[1,"flex","flex-col","items-center","gap-sm","mb-lg"],[1,"login-avatar","bg-gradient"],["name","user",2,"color","#fff",3,"size"],[1,"text-center"],[1,"font-bold",2,"font-size","var(--fs-md)","line-height","1.2"],[1,"text-muted",2,"margin","0"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-group"],[1,"standard-label"],["name","mail",1,"nav-icon",3,"size"],["id","email","formControlName","email","type","email","placeholder","tua.email@esempio.com"],["class","login-field-error",4,"ngIf"],[1,"form-group","mb-lg"],["name","lock",1,"nav-icon",3,"size"],[1,"login-input-wrap"],["id","password","formControlName","password","placeholder","La tua password",3,"type"],["type","button",1,"login-eye-btn",3,"click"],[3,"name","size"],[1,"flex","justify-between","items-center","mb-lg"],[1,"checkbox-label",2,"padding","var(--gap-sm) var(--gap-sm) var(--gap-sm) 0"],["type","checkbox","formControlName","rememberMe"],[1,"checkbox-content"],[2,"font-weight","500","font-size","var(--fs-mini)"],["class","login-message mb-lg",3,"login-message--error","login-message--success",4,"ngIf"],["type","submit",1,"promethea-button","w-100","mb-lg",3,"disabled"],["class","loading-spinner",4,"ngIf"],["name","log-in",3,"size",4,"ngIf"],[1,"login-divider","mb-lg"],[1,"text-muted"],[1,"flex","gap-sm"],["routerLink","/register/restaurant",1,"promethea-button",2,"flex","1","font-size","var(--fs-mini)"],["name","utensils",3,"size"],["routerLink","/register/supplier",1,"promethea-button",2,"flex","1","font-size","var(--fs-mini)"],["name","truck",3,"size"],["routerLink","/register/customer",1,"promethea-button","ghost","w-100",2,"font-size","var(--fs-mini)"],["name","user",3,"size"],[1,"login-field-error"],["name","alert-circle",3,"size"],[4,"ngIf"],[1,"login-message","mb-lg"],[1,"loading-spinner"],["name","log-in",3,"size"]],template:function(e,i){e&1&&(t(0,"div",0)(1,"div",1),m(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),n(),t(7,"div",7)(8,"div",8)(9,"div",9)(10,"div",10),m(11,"img",11),n(),t(12,"div",12)(13,"h2",13),l(14,"Gestisci il tuo"),m(15,"br"),l(16,"ristorante."),n(),t(17,"h3",14),l(18,"makin' life easier"),n(),t(19,"p",15),l(20," Ordini, fornitori, tavoli e clienti \u2014 tutto in un'unica piattaforma. "),n()()(),t(21,"div",16)(22,"span",17),l(23,"Ordini in tempo reale"),n(),t(24,"span",17),l(25,"Gestione fornitori"),n(),t(26,"span",17),l(27,"Sala & prenotazioni"),n()()(),t(28,"div",18)(29,"div",19)(30,"div",20)(31,"div",21),m(32,"lucide-angular",22),n(),t(33,"div",23)(34,"h1",24),l(35,"Bentornato"),n(),t(36,"p",25),l(37,"Accedi al tuo account"),n()()(),t(38,"form",26),x("ngSubmit",function(){return i.onSubmit()}),t(39,"div",27)(40,"label",28),m(41,"lucide-angular",29),l(42," Email "),n(),m(43,"input",30),g(44,B,4,3,"div",31),n(),t(45,"div",32)(46,"label",28),m(47,"lucide-angular",33),l(48," Password "),n(),t(49,"div",34),m(50,"input",35),t(51,"button",36),x("click",function(){return i.togglePasswordVisibility()}),m(52,"lucide-angular",37),n()(),g(53,H,4,3,"div",31),n(),t(54,"div",38)(55,"label",39),m(56,"input",40),t(57,"div",41)(58,"strong",42),l(59,"Ricordami"),n()()()(),g(60,J,3,7,"div",43),t(61,"button",44),g(62,K,1,0,"span",45)(63,Q,1,1,"lucide-angular",46),l(64),n(),t(65,"div",47)(66,"span",48),l(67,"oppure registrati come"),n()(),t(68,"div",12)(69,"div",49)(70,"a",50),m(71,"lucide-angular",51),l(72," Ristorante "),n(),t(73,"a",52),m(74,"lucide-angular",53),l(75," Fornitore "),n()(),t(76,"a",54),m(77,"lucide-angular",55),l(78," Registrati come Cliente "),n()()()()()()()),e&2&&(r(32),o("size",22),r(6),o("formGroup",i.loginForm),r(3),o("size",16),r(2),u("error",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),r(),o("ngIf",(i.email==null?null:i.email.invalid)&&(i.email==null?null:i.email.touched)),r(3),o("size",16),r(3),u("error",(i.password==null?null:i.password.invalid)&&(i.password==null?null:i.password.touched)),o("type",i.showPassword?"text":"password"),r(2),o("name",i.showPassword?"eye-off":"eye")("size",18),r(),o("ngIf",(i.password==null?null:i.password.invalid)&&(i.password==null?null:i.password.touched)),r(7),o("ngIf",i.errorMessage),r(),o("disabled",i.isLoading||i.loginForm.invalid),r(),o("ngIf",i.isLoading),r(),o("ngIf",!i.isLoading),r(),h(" ",i.isLoading?"Accesso in corso...":"Accedi"," "),r(7),o("size",16),r(3),o("size",16),r(3),o("size",16))},dependencies:[y,w,N,F,E,O,z,L,I,T,M,G,A],styles:['.login-page[_ngcontent-%COMP%]{position:relative;min-height:100dvh;overflow:hidden;background:var(--background)}.login-bg[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:0;pointer-events:none}.login-blob[_ngcontent-%COMP%]{position:absolute;border-radius:50%;filter:blur(80px);opacity:.35;animation:_ngcontent-%COMP%_blobFloat 12s ease-in-out infinite alternate}.login-blob--1[_ngcontent-%COMP%]{width:55vw;height:55vw;top:-15%;left:-10%;background:radial-gradient(circle,var(--primary),transparent 70%);animation-duration:14s}.login-blob--2[_ngcontent-%COMP%]{width:45vw;height:45vw;bottom:-15%;right:-5%;background:radial-gradient(circle,var(--secondary),transparent 70%);animation-duration:10s;animation-delay:-4s}.login-blob--3[_ngcontent-%COMP%]{width:30vw;height:30vw;top:40%;left:35%;background:radial-gradient(circle,var(--tertiary),transparent 70%);opacity:.2;animation-duration:16s;animation-delay:-8s}.login-grid[_ngcontent-%COMP%]{position:absolute;inset:0;background-image:linear-gradient(var(--smoke-1) 1px,transparent 1px),linear-gradient(90deg,var(--smoke-1) 1px,transparent 1px);background-size:48px 48px;mask-image:radial-gradient(ellipse 80% 80% at 50% 50%,black 30%,transparent 100%)}@keyframes _ngcontent-%COMP%_blobFloat{0%{transform:translate(0) scale(1) rotate(0)}33%{transform:translate(2%,4%) scale(1.05) rotate(3deg)}66%{transform:translate(-2%,2%) scale(.97) rotate(-2deg)}to{transform:translate(3%,-3%) scale(1.08) rotate(5deg)}}.login-aurora[_ngcontent-%COMP%]{position:absolute;inset:0;background:repeating-linear-gradient(-45deg,transparent 0px,transparent 60px,color-mix(in srgb,var(--primary) 3%,transparent) 60px,color-mix(in srgb,var(--primary) 3%,transparent) 61px);animation:_ngcontent-%COMP%_auroraShift 20s linear infinite;pointer-events:none}@keyframes _ngcontent-%COMP%_auroraShift{0%{background-position:0 0}to{background-position:120px 120px}}.login-split[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:1fr 1fr;min-height:100dvh}.login-brand[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding:clamp(2rem,5vw,4rem)}.login-form-panel[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:clamp(1.5rem,4vw,3rem)}.login-card[_ngcontent-%COMP%]{width:100%;margin:0 var(--gap-lg);border:1px solid var(--smoke-1);border-radius:24px;padding:var(--gap-md);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);box-shadow:0 0 0 1px var(--smoke-1),0 32px 64px -16px color-mix(in srgb,var(--primary) 20%,transparent),0 8px 32px -8px color-mix(in srgb,var(--text-color) 10%,transparent)}.login-avatar[_ngcontent-%COMP%]{width:52px;height:52px;border-radius:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 20px var(--shadow-1)}.login-input-wrap[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.login-input-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:3rem}.login-eye-btn[_ngcontent-%COMP%]{position:absolute;right:var(--gap-sm);background:transparent;border:none;cursor:pointer;color:var(--text-muted);display:flex;align-items:center;padding:0;transition:color .2s}.login-eye-btn[_ngcontent-%COMP%]:hover{color:var(--primary)}.login-field-error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);margin-top:calc(var(--gap-sm) / 2);font-size:var(--fs-mini);color:#ef4444}.login-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);padding:var(--gap-sm);border-radius:12px;font-size:var(--fs-mini);border:1px solid transparent}.login-message--error[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 10%,transparent);border-color:color-mix(in srgb,#ef4444 30%,transparent);color:#ef4444}.login-message--success[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 10%,transparent);border-color:color-mix(in srgb,#10b981 30%,transparent);color:#10b981}.login-divider[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm);text-align:center}.login-divider[_ngcontent-%COMP%]:before, .login-divider[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--smoke-1)}.login-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:var(--fs-mini);white-space:nowrap}@media (max-width: 768px){.login-split[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto 1fr}.login-brand[_ngcontent-%COMP%]{padding:clamp(1.5rem,5vw,2rem);flex-direction:row;align-items:center;justify-content:space-between;gap:var(--gap-md);border-bottom:1px solid var(--smoke-1)}.login-brand[_ngcontent-%COMP%]   .flex.flex-wrap[_ngcontent-%COMP%]{display:none}.login-form-panel[_ngcontent-%COMP%]{align-items:flex-start;padding:var(--gap-lg) var(--gap-md)}.login-card[_ngcontent-%COMP%]{max-width:100%;border-radius:16px}}.login-brand[_ngcontent-%COMP%]   img.logopiccolo[_ngcontent-%COMP%]{height:clamp(64px,15vw,200px);width:fit-content;object-fit:contain;object-position:left center}.immaginebrand[_ngcontent-%COMP%]{justify-content:center;display:flex;width:100%}.register-center[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;justify-content:center;align-items:flex-start;padding:var(--gap-lg) var(--gap-md)}']})};export{R as Login};
