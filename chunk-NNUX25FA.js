import{a as ue}from"./chunk-SQVXJHN3.js";import{a as de}from"./chunk-2TB2D52A.js";import{a as ce}from"./chunk-HDYKKRZ7.js";import{a as le}from"./chunk-3F4CDTNS.js";import"./chunk-GO2X6ET2.js";import"./chunk-3CH6KZ3X.js";import{b as ee,d as te,h as ie,j as ne,q as re,r as ae,s as se,x as oe}from"./chunk-XWCDBJ2K.js";import{b as X}from"./chunk-PMU7JIES.js";import{c as G,d as Q,h as Z,i as K,k as Y,l as H,q as J}from"./chunk-COP7W333.js";import{B as R,Fb as P,Hb as V,Ib as a,Ja as c,Jb as S,Kb as p,Lb as O,Ob as b,Pb as D,Qb as E,Wb as v,Yb as x,Za as q,Zb as z,a as k,b as F,ba as j,cb as h,ga as I,h as g,kb as d,la as f,lb as n,ma as M,mb as r,nb as U,rb as T,sb as B,tb as y,va as L,wb as m,yb as u}from"./chunk-2FS7XGGJ.js";var $=class o extends le{supabase=I(X);getTableName(){return"menu_dishes"}loadData(i){return g(this,null,function*(){try{this.loadingSubject.next(!0),this.errorSubject.next(null);let e=this.supabase.getSupabaseClient().from(this.getTableName()).select("*");i&&Object.keys(i).forEach(l=>{let _=i[l];_!=null&&(e=e.eq(l,_))});let{data:t,error:s}=yield e;if(s)throw s;this.dataSubject.next(t??[])}catch(e){console.error(`Error loading ${this.getTableName()}:`,e),this.errorSubject.next(e.message??"Errore sconosciuto"),this.dataSubject.next([])}finally{this.loadingSubject.next(!1)}})}create(i){return g(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let e=new Date().toISOString(),t=F(k({},i),{created_at:e,updated_at:e});console.log("\u{1F4E4} PAYLOAD PER INSERT menu_dishes:"),console.log("- menu_id:",t.menu_id),console.log("- dish_id:",t.dish_id),console.log("- category_id:",t.category_id),console.log("- display_order:",t.display_order),console.log("- is_active:",t.is_active),console.log("- created_at:",t.created_at),console.log("\u{1F4CB} Payload completo:",JSON.stringify(t,null,2));let{data:s,error:l}=yield this.supabase.getSupabaseClient().from(this.getTableName()).insert(t).select().single();if(l)throw console.error("\u274C ERRORE SUPABASE DETTAGLIATO:",l),console.error("\u274C Codice:",l.code),console.error("\u274C Messaggio:",l.message),console.error("\u274C Dettagli:",l.details),console.error("\u274C Hint:",l.hint),l.code==="23505"?(console.error("\u274C VIOLAZIONE VINCOLO UNIQUE: il piatto \xE8 gi\xE0 in questo menu"),new Error("Il piatto \xE8 gi\xE0 presente in questo menu")):l.code==="23503"?(console.error("\u274C VIOLAZIONE FOREIGN KEY: menu_id o dish_id non esistono"),new Error("Menu o piatto non trovato")):l;return console.log("\u2705 INSERT RIUSCITO:",s),i.menu_id?yield this.loadData({menu_id:i.menu_id}):yield this.loadData(),s}catch(e){return console.error("\u274C ERRORE COMPLETO durante create:",e),this.errorSubject.next(e.message??"Errore creazione"),null}finally{this.loadingSubject.next(!1)}})}update(i,e){return g(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let{error:t}=yield this.supabase.getSupabaseClient().from(this.getTableName()).update(F(k({},e),{updated_at:new Date().toISOString()})).eq("id",i);if(t)throw t;return yield this.loadData(),!0}catch(t){return this.errorSubject.next(t.message??"Errore aggiornamento"),!1}finally{this.loadingSubject.next(!1)}})}delete(i){return g(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let{error:e}=yield this.supabase.getSupabaseClient().from(this.getTableName()).delete().eq("id",i);if(e)throw e;return yield this.loadData(),!0}catch(e){return this.errorSubject.next(e.message??"Errore eliminazione"),!1}finally{this.loadingSubject.next(!1)}})}getDishesByMenu$(i){return this.data$.pipe(R(e=>e.filter(t=>t.menu_id===i)))}addDishToMenu(i,e,t,s=0){return g(this,null,function*(){let l;t==null||t.trim()===""?l=void 0:l=t;let _={menu_id:i,dish_id:e,display_order:s,is_active:!0};return l!==void 0&&(_.category_id=l),console.log("\u2795 Aggiungo piatto al menu:",_),this.create(_)})}removeDishFromMenu(i){return g(this,null,function*(){return this.delete(i)})}updateDishOrder(i,e){return g(this,null,function*(){return this.update(i,{display_order:e})})}loadDishesForMenu(i){return g(this,null,function*(){return this.loadData({menu_id:i})})}getDishesWithDetailsByMenu(i){return g(this,null,function*(){try{let{data:e,error:t}=yield this.supabase.getSupabaseClient().from("menu_dishes").select(`
        *,
        dish:dishes!dish_id (*)
      `).eq("menu_id",i).eq("is_active",!0).order("display_order");if(t)throw t;return(e||[]).filter(s=>s.dish&&!s.dish.deleted_at)}catch(e){return console.error("Error fetching dishes for menu:",e),[]}})}removeAllDishesFromMenu(i){return g(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let{error:e}=yield this.supabase.getSupabaseClient().from(this.getTableName()).delete().eq("menu_id",i);if(e)throw e;return yield this.loadData(),!0}catch(e){return console.error("\u274C Errore eliminazione piatti dal menu:",e),this.errorSubject.next(e.message??"Errore eliminazione piatti dal menu"),!1}finally{this.loadingSubject.next(!1)}})}static \u0275fac=(()=>{let i;return function(t){return(i||(i=L(o)))(t||o)}})();static \u0275prov=j({token:o,factory:o.\u0275fac,providedIn:"root"})};function he(o,i){if(o&1&&(n(0,"option",69),a(1),r()),o&2){let e=i.$implicit;d("value",e.id),c(),O(" ",e.name," ",e.is_default?"(Default)":""," ")}}function ge(o,i){if(o&1){let e=y();n(0,"div",70)(1,"div",12)(2,"input",71),E("ngModelChange",function(s){f(e);let l=u();return D(l.editedMenuName,s)||(l.editedMenuName=s),M(s)}),m("keyup.enter",function(){f(e);let s=u();return M(s.saveMenuName())})("keyup.escape",function(){f(e);let s=u();return M(s.cancelEditMenuName())}),r(),n(3,"div",2)(4,"button",72),m("click",function(){f(e);let s=u();return M(s.saveMenuName())}),n(5,"span",16),a(6,"check"),r()(),n(7,"button",73),m("click",function(){f(e);let s=u();return M(s.cancelEditMenuName())}),n(8,"span",16),a(9,"close"),r()()()(),n(10,"div",74),a(11," Premi Invio per salvare, Esc per annullare "),r()()}if(o&2){let e=u();c(2),b("ngModel",e.editedMenuName)}}function fe(o,i){if(o&1){let e=y();n(0,"div",75)(1,"label",76)(2,"input",77),m("change",function(){f(e);let s=u();return M(s.toggleMenuType())}),r(),n(3,"span",78),a(4,"Menu Specifico (Dedicato)"),r()()()}if(o&2){let e=u();c(2),d("checked",e.currentMenu.type==="dedicated")("disabled",e.currentMenu.is_default)}}function Me(o,i){o&1&&(n(0,"div",79),a(1," Questo menu \xE8 dedicato a una specifica prenotazione o evento. "),r())}function ve(o,i){o&1&&(n(0,"div",80),a(1," Attenzione: Il menu di default non pu\xF2 essere specifico. Seleziona un altro menu come default prima di impostare questo come specifico. "),r())}function xe(o,i){o&1&&(n(0,"span",81)(1,"span",60),a(2,"event"),r(),a(3," Specifico "),r())}function ye(o,i){o&1&&(n(0,"span",82)(1,"span",60),a(2,"public"),r(),a(3," Globale "),r())}function Se(o,i){if(o&1){let e=y();n(0,"div",23)(1,"div",10)(2,"label",76)(3,"input",77),m("change",function(){f(e);let s=u();return M(s.toggleMenuFavorite())}),r(),n(4,"span",78),a(5," Preferito "),n(6,"span",83),a(7,"star"),r()()()(),n(8,"div",10)(9,"label",76)(10,"input",77),m("change",function(){f(e);let s=u();return M(s.toggleMenuActive())}),r(),n(11,"span",78),a(12," Attivo "),n(13,"span",84),a(14,"check_circle"),r()()()()()}if(o&2){let e=u();c(3),d("checked",e.currentMenu.is_favorite)("disabled",e.currentMenu.is_default),c(7),d("checked",e.currentMenu.is_active)("disabled",e.currentMenu.is_default)}}function be(o,i){o&1&&(n(0,"span",82),a(1,"Default"),r())}function De(o,i){o&1&&(n(0,"span",87),a(1,"Non attivo"),r())}function Ee(o,i){if(o&1&&(n(0,"div",28)(1,"span",85),a(2,"info"),r(),n(3,"span",5),a(4),r(),h(5,be,2,0,"span",31)(6,De,2,0,"span",86),r()),o&2){let e=u();c(4),S(e.currentMenu.description||"Nessuna descrizione"),c(),d("ngIf",e.currentMenu.is_default),c(),d("ngIf",!e.currentMenu.is_active)}}function we(o,i){if(o&1&&(n(0,"option",69),a(1),r()),o&2){let e=i.$implicit;d("value",e.id),c(),p(" ",e.name," ")}}function Ce(o,i){if(o&1&&(n(0,"span",16),a(1),r()),o&2){let e=u();c(),p(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function Ie(o,i){if(o&1&&(n(0,"span",16),a(1),r()),o&2){let e=u();c(),p(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function Te(o,i){if(o&1&&(n(0,"span",16),a(1),r()),o&2){let e=u();c(),p(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function Be(o,i){if(o&1&&(n(0,"span",16),a(1),r()),o&2){let e=u();c(),p(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function Pe(o,i){if(o&1&&(n(0,"span",16),a(1),r()),o&2){let e=u();c(),p(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ke(o,i){if(o&1&&(n(0,"div",96)(1,"span",97),a(2,"delete"),r(),n(3,"span",98),a(4),v(5,"date"),r()()),o&2){let e=u().$implicit;c(4),p(" Eliminato il ",x(5,1,e.deleted_at,"dd/MM/yyyy")," ")}}function Fe(o,i){o&1&&(n(0,"div",96)(1,"span",99),a(2,"warning"),r(),n(3,"span",100),a(4," Senza menu "),r()())}function Ne(o,i){if(o&1&&(n(0,"div",101),a(1),v(2,"slice"),r()),o&2){let e=u().$implicit;c(),O(" ",z(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function Oe(o,i){if(o&1&&(n(0,"span",5),a(1),r()),o&2){let e=u().$implicit;c(),p(" ",e.preparation_time," min ")}}function Ve(o,i){o&1&&(n(0,"span",5),a(1,"-"),r())}function Ae(o,i){if(o&1){let e=y();T(0),n(1,"button",102),m("click",function(){f(e);let s=u().$implicit,l=u(2);return M(l.showCopyMenuDialog(s))}),n(2,"span",16),a(3,"content_copy"),r()(),n(4,"button",103),m("click",function(){f(e);let s=u().$implicit,l=u(2);return M(l.showMoveMenuDialog(s))}),n(5,"span",16),a(6,"open_with"),r()(),n(7,"button",104),m("click",function(){f(e);let s=u().$implicit,l=u(2);return M(l.confirmDeleteDish(s))}),n(8,"span",16),a(9,"delete"),r()(),B()}if(o&2){let e=u().$implicit,t=u(2);c(),d("disabled",!e.id||!t.menus||t.menus.length===0),c(3),d("disabled",!e.id||!t.menus||t.menus.length===0||t.menus.length===1)}}function ze(o,i){if(o&1){let e=y();T(0),n(1,"button",105),m("click",function(){f(e);let s=u().$implicit,l=u(2);return M(l.confirmRestoreDish(s))}),n(2,"span",16),a(3,"restore"),r()(),B()}}function $e(o,i){if(o&1){let e=y();n(0,"tr")(1,"td"),h(2,ke,6,4,"div",89)(3,Fe,5,0,"div",89),n(4,"div",28)(5,"div",90)(6,"strong",91),m("click",function(){let s=f(e).$implicit,l=u(2);return M(l.editDish(s.id))}),a(7),r(),h(8,Ne,3,6,"div",92),r()()(),n(9,"td"),a(10),r(),n(11,"td")(12,"strong"),a(13),v(14,"number"),r()(),n(15,"td"),a(16),v(17,"number"),r(),n(18,"td")(19,"span"),a(20),v(21,"number"),r()(),n(22,"td")(23,"select",93),m("ngModelChange",function(s){let l=f(e).$implicit,_=u(2);return M(_.updateDishStatus(l,s))}),n(24,"option",51),a(25,"Disponibile"),r(),n(26,"option",52),a(27,"Non disponibile"),r(),n(28,"option",53),a(29,"Esaurito"),r()()(),n(30,"td"),h(31,Oe,2,1,"span",94)(32,Ve,2,0,"span",94),r(),n(33,"td")(34,"div",95),h(35,Ae,10,2,"ng-container",67)(36,ze,4,0,"ng-container",67),r()()()}if(o&2){let e=i.$implicit,t=u(2);P("opacity-60",e.deleted_at)("bg-gray-50",e.deleted_at),c(2),d("ngIf",e.deleted_at),c(),d("ngIf",!e.deleted_at&&t.isDishWithoutMenu(e.id)),c(4),p(" ",e.name," "),c(),d("ngIf",e.description),c(2),S(t.getCategoryName(e.category_id||"")),c(3),p("\u20AC",x(14,25,e.base_price,"1.2-2")),c(3),p("",x(17,28,t.calculateFoodCostPercentage(e),"1.0-1"),"%"),c(3),V(t.calculateMargin(e)>=0?"text-muted":"error"),c(),p(" \u20AC",x(21,31,t.calculateMargin(e),"1.2-2")," "),c(3),P("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),d("ngModel",e.status),c(8),d("ngIf",e.preparation_time),c(),d("ngIf",!e.preparation_time),c(3),d("ngIf",!e.deleted_at),c(),d("ngIf",e.deleted_at)}}function We(o,i){if(o&1&&(T(0),h(1,$e,37,34,"tr",88),B()),o&2){let e=u();c(),d("ngForOf",e.filteredDishes)}}function Re(o,i){if(o&1&&(n(0,"tr",108)(1,"td",109)(2,"div",110)(3,"span",40),a(4,"folder"),r(),n(5,"div",111),a(6),r(),n(7,"span",112),a(8),r()()()()),o&2){let e=u().$implicit,t=u(2);c(6),S(e.name),c(2),p(" ",t.getDishesByCategory(e.id).length," piatti ")}}function je(o,i){if(o&1&&(n(0,"div",96)(1,"span",97),a(2,"delete"),r(),n(3,"span",98),a(4),v(5,"date"),r()()),o&2){let e=u().$implicit;c(4),p(" Eliminato il ",x(5,1,e.deleted_at,"dd/MM/yyyy")," ")}}function Le(o,i){o&1&&(n(0,"div",96)(1,"span",99),a(2,"warning"),r(),n(3,"span",100),a(4," Senza menu "),r()())}function qe(o,i){if(o&1&&(n(0,"div",101),a(1),v(2,"slice"),r()),o&2){let e=u().$implicit;c(),O(" ",z(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function Ue(o,i){if(o&1&&(n(0,"span",5),a(1),r()),o&2){let e=u().$implicit;c(),p(" ",e.preparation_time," min ")}}function Ge(o,i){o&1&&(n(0,"span",5),a(1,"-"),r())}function Qe(o,i){if(o&1){let e=y();T(0),n(1,"button",102),m("click",function(){f(e);let s=u().$implicit,l=u(3);return M(l.showCopyMenuDialog(s))}),n(2,"span",16),a(3,"content_copy"),r()(),n(4,"button",103),m("click",function(){f(e);let s=u().$implicit,l=u(3);return M(l.showMoveMenuDialog(s))}),n(5,"span",16),a(6,"open_with"),r()(),n(7,"button",104),m("click",function(){f(e);let s=u().$implicit,l=u(3);return M(l.confirmDeleteDish(s))}),n(8,"span",16),a(9,"delete"),r()(),B()}if(o&2){let e=u().$implicit,t=u(3);c(),d("disabled",!e.id||!t.menus||t.menus.length===0),c(3),d("disabled",!e.id||!t.menus||t.menus.length===0||t.menus.length===1)}}function Ze(o,i){if(o&1){let e=y();T(0),n(1,"button",105),m("click",function(){f(e);let s=u().$implicit,l=u(3);return M(l.confirmRestoreDish(s))}),n(2,"span",16),a(3,"restore"),r()(),B()}}function Ke(o,i){if(o&1){let e=y();n(0,"tr")(1,"td"),h(2,je,6,4,"div",89)(3,Le,5,0,"div",89),n(4,"div",28)(5,"div",90)(6,"strong",91),m("click",function(){let s=f(e).$implicit,l=u(3);return M(l.editDish(s.id))}),a(7),r(),h(8,qe,3,6,"div",92),r()()(),n(9,"td"),a(10),r(),n(11,"td")(12,"strong"),a(13),v(14,"number"),r()(),n(15,"td"),a(16),v(17,"number"),r(),n(18,"td")(19,"span"),a(20),v(21,"number"),r()(),n(22,"td")(23,"select",93),m("ngModelChange",function(s){let l=f(e).$implicit,_=u(3);return M(_.updateDishStatus(l,s))}),n(24,"option",51),a(25,"Disponibile"),r(),n(26,"option",52),a(27,"Non disponibile"),r(),n(28,"option",53),a(29,"Esaurito"),r()()(),n(30,"td"),h(31,Ue,2,1,"span",94)(32,Ge,2,0,"span",94),r(),n(33,"td")(34,"div",95),h(35,Qe,10,2,"ng-container",67)(36,Ze,4,0,"ng-container",67),r()()()}if(o&2){let e=i.$implicit,t=u(3);P("opacity-60",e.deleted_at)("bg-gray-50",e.deleted_at),c(2),d("ngIf",e.deleted_at),c(),d("ngIf",!e.deleted_at&&t.isDishWithoutMenu(e.id)),c(4),p(" ",e.name," "),c(),d("ngIf",e.description),c(2),S(t.getCategoryName(e.category_id||"")),c(3),p("\u20AC",x(14,25,e.base_price,"1.2-2")),c(3),p("",x(17,28,t.calculateFoodCostPercentage(e),"1.0-1"),"%"),c(3),V(t.calculateMargin(e)>=0?"text-muted":"error"),c(),p(" \u20AC",x(21,31,t.calculateMargin(e),"1.2-2")," "),c(3),P("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),d("ngModel",e.status),c(8),d("ngIf",e.preparation_time),c(),d("ngIf",!e.preparation_time),c(3),d("ngIf",!e.deleted_at),c(),d("ngIf",e.deleted_at)}}function Ye(o,i){if(o&1&&(T(0),h(1,Re,9,2,"tr",107)(2,Ke,37,34,"tr",88),B()),o&2){let e=i.$implicit,t=u(2);c(),d("ngIf",t.getDishesByCategory(e.id).length>0),c(),d("ngForOf",t.getDishesByCategory(e.id))}}function He(o,i){if(o&1&&(n(0,"tr",108)(1,"td",113)(2,"div",114)(3,"span",16),a(4,"folder_open"),r(),a(5," Senza Categoria "),n(6,"span",115),a(7),r()()()()),o&2){let e=u(2);c(7),p(" ",e.getDishesByCategory("").length," piatti ")}}function Je(o,i){if(o&1&&(n(0,"div",96)(1,"span",97),a(2,"delete"),r(),n(3,"span",98),a(4),v(5,"date"),r()()),o&2){let e=u().$implicit;c(4),p(" Eliminato il ",x(5,1,e.deleted_at,"dd/MM/yyyy")," ")}}function Xe(o,i){o&1&&(n(0,"div",96)(1,"span",99),a(2,"warning"),r(),n(3,"span",100),a(4," Senza menu "),r()())}function et(o,i){if(o&1&&(n(0,"div",101),a(1),v(2,"slice"),r()),o&2){let e=u().$implicit;c(),O(" ",z(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function tt(o,i){if(o&1&&(n(0,"span",5),a(1),r()),o&2){let e=u().$implicit;c(),p(" ",e.preparation_time," min ")}}function it(o,i){o&1&&(n(0,"span",5),a(1,"-"),r())}function nt(o,i){if(o&1){let e=y();n(0,"tr")(1,"td"),h(2,Je,6,4,"div",89)(3,Xe,5,0,"div",89),n(4,"div",28)(5,"div",90)(6,"strong",91),m("click",function(){let s=f(e).$implicit,l=u(2);return M(l.editDish(s.id))}),a(7),r(),h(8,et,3,6,"div",92),r()()(),n(9,"td",5),a(10,"-"),r(),n(11,"td")(12,"strong"),a(13),v(14,"number"),r()(),n(15,"td"),a(16),v(17,"number"),r(),n(18,"td")(19,"span"),a(20),v(21,"number"),r()(),n(22,"td")(23,"span"),a(24),v(25,"number"),r()(),n(26,"td")(27,"span",112),a(28),r()(),n(29,"td"),h(30,tt,2,1,"span",94)(31,it,2,0,"span",94),r()()}if(o&2){let e=i.$implicit,t=u(2);P("opacity-60",e.deleted_at)("bg-gray-50",e.deleted_at),c(2),d("ngIf",e.deleted_at),c(),d("ngIf",!e.deleted_at&&t.isDishWithoutMenu(e.id)),c(4),p(" ",e.name," "),c(),d("ngIf",e.description),c(5),p("\u20AC",x(14,23,e.base_price,"1.2-2")),c(3),p("\u20AC",x(17,26,e.food_cost,"1.2-2")),c(3),V(t.calculateMargin(e)>=0?"text-muted":"error"),c(),p(" \u20AC",x(21,29,t.calculateMargin(e),"1.2-2")," "),c(3),V(t.calculateMarginPercentage(e)>=0?"text-muted":"error"),c(),p(" ",x(25,32,t.calculateMarginPercentage(e),"1.0-0"),"% "),c(3),P("active",e.status==="available")("inactive",e.status!=="available"),c(),p(" ",t.getStatusText(e.status)," "),c(2),d("ngIf",e.preparation_time),c(),d("ngIf",!e.preparation_time)}}function rt(o,i){if(o&1&&(T(0),h(1,Ye,3,2,"ng-container",106)(2,He,8,1,"tr",107)(3,nt,32,35,"tr",88),B()),o&2){let e=u();c(),d("ngForOf",e.categories),c(),d("ngIf",e.getDishesByCategory("").length>0),c(),d("ngForOf",e.getDishesByCategory(""))}}function at(o,i){o&1&&(n(0,"tr")(1,"td",116)(2,"div",117)(3,"span",16),a(4,"search_off"),r(),n(5,"h3"),a(6,"Nessun piatto trovato"),r(),n(7,"p"),a(8,"Prova a modificare i filtri di ricerca o aggiungi un nuovo piatto"),r()()()())}function st(o,i){if(o&1&&(n(0,"option",69),a(1),r()),o&2){let e=i.$implicit;d("value",e.id),c(),O(" ",e.name," ",e.is_default?"(Default)":""," ")}}function ot(o,i){o&1&&(n(0,"span",132),a(1,"refresh"),r())}function lt(o,i){o&1&&(n(0,"span",16),a(1,"check"),r())}function ct(o,i){if(o&1){let e=y();n(0,"div",118)(1,"div",119)(2,"div",120)(3,"div",28)(4,"span",16),a(5),r(),n(6,"h2",8),a(7),r()(),n(8,"button",121),m("click",function(){f(e);let s=u();return M(s.closeMoveDialog())}),n(9,"span",16),a(10,"close"),r()()(),n(11,"div",122)(12,"div",123)(13,"span",16),a(14,"info"),r(),n(15,"div")(16,"strong"),a(17),r(),U(18,"br"),n(19,"span",5),a(20),r()()(),n(21,"div",10)(22,"label",11)(23,"span",16),a(24,"restaurant_menu"),r(),a(25," Menu di destinazione "),r(),n(26,"select",124),E("ngModelChange",function(s){f(e);let l=u();return D(l.selectedTargetMenuId,s)||(l.selectedTargetMenuId=s),M(s)}),n(27,"option",125),a(28,"Seleziona un menu..."),r(),h(29,st,2,3,"option",14),r()(),n(30,"div",126)(31,"div",127)(32,"span",16),a(33,"info"),r(),a(34),r()()(),n(35,"div",128)(36,"button",129),m("click",function(){f(e);let s=u();return M(s.closeMoveDialog())}),a(37," Annulla "),r(),n(38,"button",130),m("click",function(){f(e);let s=u();return M(s.moveDishToMenu())}),h(39,ot,2,0,"span",131)(40,lt,2,0,"span",65),a(41),r()()()()}if(o&2){let e=u();c(5),S(e.isCopyMode?"content_copy":"drive_file_move"),c(2),S(e.isCopyMode?"Copia Piatto":"Sposta Piatto"),c(),d("disabled",e.isMoving),c(9),S(e.dishToMove==null?null:e.dishToMove.name),c(3),p(" ",e.isCopyMode?"Seleziona il menu in cui copiare il piatto":"Seleziona il menu di destinazione"),c(6),b("ngModel",e.selectedTargetMenuId),d("disabled",e.isMoving),c(3),d("ngForOf",e.getAvailableMenusForMove()),c(5),p(" ",e.isCopyMode?"Il piatto verr\xE0 copiato nel menu selezionato.":"Il piatto verr\xE0 spostato nel menu selezionato e rimosso dal menu corrente."," "),c(2),d("disabled",e.isMoving),c(2),d("disabled",!e.selectedTargetMenuId||e.isMoving),c(),d("ngIf",e.isMoving),c(),d("ngIf",!e.isMoving),c(),p(" ",e.isMoving?e.isCopyMode?"Copia...":"Spostamento...":e.isCopyMode?"Copia":"Sposta"," ")}}var me=class o{dishService=I(ce);categoryService=I(de);router=I(J);menuDishService=I($);menuService=I(ue);isEditingMenuName=!1;editedMenuName="";isCopyMode=!1;isSpecificMenu=!1;showDeletedDishes=!1;sortedCategories=[];dishes=[];categories=[];menus=[];selectedMenuId=null;currentMenu=null;filteredDishes=[];menuDishes=[];viewMode="menu-only";showMoveDialog=!1;dishToMove=null;selectedTargetMenuId=null;isMoving=!1;stats={totalDishes:0,totalCategories:0,averagePrice:0,averageFoodCostPercentage:0,averageMarginPercentage:0};searchTerm="";selectedCategory="all";statusFilter="all";priceRange={min:null,max:null};sortField="category";sortDirection="asc";ngOnInit(){this.loadData()}loadData(){return g(this,null,function*(){try{yield Promise.all([this.dishService.loadData(),this.categoryService.loadData(),this.menuService.loadData(),this.menuDishService.loadData()]),this.dishService.data$.subscribe(i=>{this.dishes=i,this.applyFilters(),this.calculateStats()}),this.menuDishService.data$.subscribe(i=>{console.log("\u{1F4E5} menuDishService data$ updated (TUTTI i menuDishes):",i.length),this.menuDishes=i,this.currentMenu&&this.applyFilters()}),this.categoryService.data$.subscribe(i=>{this.categories=i,this.sortedCategories=[...i].sort((e,t)=>e.name.localeCompare(t.name)),this.calculateStats()}),this.menuService.data$.subscribe(i=>{if(this.menus=i.map(e=>F(k({},e),{type:e.type||"global"})),this.menus.length>0){let e=this.menus.find(t=>t.is_default)||this.menus[0];this.selectedMenuId=e.id,this.currentMenu=e,this.syncCheckboxState(),this.applyFilters()}})}catch(i){console.error("Errore nel caricamento dei dati:",i)}})}calculateStats(){let e=this.dishes.filter(C=>!C.deleted_at).length,t=this.categories.length,s=this.dishes.reduce((C,A)=>C+(A.base_price||0),0),l=e>0?s/e:0,_=this.dishes.filter(C=>C.base_price>0),w=_.length,N=0,W=0;w>0&&_.forEach(C=>{let A=C.food_cost/C.base_price*100,pe=100-A;N+=A,W+=pe}),this.stats={totalDishes:e,totalCategories:t,averagePrice:l,averageFoodCostPercentage:w>0?N/w:0,averageMarginPercentage:w>0?W/w:0}}applyFilters(){if(!this.dishes||this.dishes.length===0){this.filteredDishes=[];return}let i=this.dishes.filter(e=>this.showDeletedDishes?!0:!e.deleted_at);if(this.currentMenu&&this.viewMode==="menu-only"){let e=this.menuDishes.filter(t=>t.menu_id===this.currentMenu.id&&t.is_active).map(t=>t.dish_id);i=i.filter(t=>e.includes(t.id))}else if(this.viewMode==="without-menu"){let e=this.menuDishes.filter(s=>s.is_active).map(s=>s.dish_id),t=[...new Set(e)];i=i.filter(s=>!t.includes(s.id))}i=this.applyCommonFilters(i),i=this.sortDishes(i),this.filteredDishes=[...i]}applyCommonFilters(i){let e=[...i];if(this.searchTerm.trim()){let t=this.searchTerm.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(t)||s.description&&s.description.toLowerCase().includes(t))}return this.selectedCategory&&this.selectedCategory!=="all"&&(e=e.filter(t=>t.category_id===this.selectedCategory)),this.statusFilter&&this.statusFilter!=="all"&&(e=e.filter(t=>t.status===this.statusFilter)),this.priceRange.min!==null&&(e=e.filter(t=>t.base_price>=this.priceRange.min)),this.priceRange.max!==null&&(e=e.filter(t=>t.base_price<=this.priceRange.max)),e}sortDishes(i){return i.length?[...i].sort((e,t)=>{let s,l;switch(this.sortField){case"name":s=e.name.toLowerCase(),l=t.name.toLowerCase();break;case"category":s=this.getCategoryName(e.category_id||"").toLowerCase(),l=this.getCategoryName(t.category_id||"").toLowerCase(),s===l&&(s=e.name.toLowerCase(),l=t.name.toLowerCase());break;case"price":s=e.base_price,l=t.base_price;break;case"food_cost_percentage":s=this.calculateFoodCostPercentage(e),l=this.calculateFoodCostPercentage(t);break;case"margin":s=this.calculateMargin(e),l=this.calculateMargin(t);break;default:s=e.name.toLowerCase(),l=t.name.toLowerCase()}return s<l?this.sortDirection==="asc"?-1:1:s>l?this.sortDirection==="asc"?1:-1:0}):i}getViewModeStats(){let i=this.dishes.filter(l=>this.showDeletedDishes?!0:!l.deleted_at),e=new Set(this.menuDishes.filter(l=>l.is_active).map(l=>l.dish_id)),t=0;if(this.currentMenu){let l=new Set(this.menuDishes.filter(_=>_.menu_id===this.currentMenu.id&&_.is_active).map(_=>_.dish_id));t=i.filter(_=>l.has(_.id)).length}let s=i.filter(l=>!e.has(l.id)).length;return{"menu-only":t,"all-dishes":i.length,"without-menu":s}}getDishesWithoutMenu(){let i=this.menuDishes.filter(e=>e.is_active).map(e=>e.dish_id);return this.dishes.filter(e=>!i.includes(e.id)&&(this.showDeletedDishes?!0:!e.deleted_at))}onSort(i){this.sortField===i?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=i,this.sortDirection="asc"),this.applyFilters()}getCategoryName(i){return this.categories.find(t=>t.id===i)?.name||"Senza categoria"}calculateMargin(i){return i.base_price-i.food_cost}calculateMarginPercentage(i){return i.base_price===0?0:(i.base_price-i.food_cost)/i.base_price*100}getDishesByCategory(i){return this.filteredDishes.filter(e=>e.category_id===i)}resetFilters(){this.searchTerm="",this.selectedCategory="all",this.statusFilter="all",this.priceRange={min:null,max:null},this.sortField="category",this.sortDirection="asc",this.applyFilters()}getStatusText(i){return{available:"Disponibile",unavailable:"Non disponibile",out_of_stock:"Esaurito"}[i]||i}editDish(i){this.router.navigate(["/food-cost-calculator",i])}createNewDish(){this.router.navigate(["/food-cost"])}calculateFoodCostPercentage(i){return!i.base_price||i.base_price===0?0:i.food_cost/i.base_price*100}updateDishStatus(i,e){return g(this,null,function*(){try{let t=i.status;e==="available"||e==="unavailable"||e==="out_of_stock"?(i.status=e,(yield this.dishService.updateDish(i.id,{status:e}))?(console.log(`Stato piatto ${i.name} aggiornato a: ${e}`),this.calculateStats()):(i.status=t,console.error("Errore nell'aggiornamento dello stato del piatto"),alert("Errore durante l'aggiornamento dello stato. Riprova."))):(console.error("Stato non valido:",e),alert("Stato non valido selezionato."))}catch(t){console.error("Errore durante l'aggiornamento dello stato:",t),alert("Errore durante l'aggiornamento dello stato.")}})}confirmDeleteDish(i){return g(this,null,function*(){let e=`Sei sicuro di voler eliminare il piatto "${i.name}"?

Questa azione non pu\xF2 essere annullata.`;confirm(e)&&(yield this.deleteDish(i.id))})}deleteDish(i){return g(this,null,function*(){try{(yield this.dishService.deleteDish(i))?console.log("\u2705 Piatto eliminato con successo"):alert("Errore durante l'eliminazione del piatto")}catch(e){console.error("\u274C Errore durante l'eliminazione:",e),alert("Errore durante l'eliminazione del piatto")}})}loadMenuDishes(){return g(this,null,function*(){this.currentMenu&&(this.menuDishes=yield this.menuDishService.getDishesWithDetailsByMenu(this.currentMenu.id))})}changeMenu(i){let e=this.menus.find(t=>t.id===i);e&&!e.is_active&&!e.is_default&&!confirm(`\u26A0\uFE0F Attenzione: il menu "${e.name}" \xE8 disattivato.
Vuoi comunque selezionarlo?`)||(this.selectedMenuId=i,this.currentMenu=e||null,this.currentMenu?(this.syncCheckboxState(),this.applyFilters()):this.isSpecificMenu=!1)}createNewMenu(){return g(this,null,function*(){let i=prompt("Nome del nuovo menu:");if(i){let e=prompt("Descrizione (opzionale):"),t=confirm("Impostare come menu di default?"),s=confirm("\xC8 un menu specifico (dedicato)?"),l=e||void 0,_;s?_=yield this.menuService.createDedicatedMenu(i,l):_=yield this.menuService.createMenu(i,l,t),_&&(this.currentMenu=_,this.syncCheckboxState(),this.selectedMenuId=_.id,this.loadMenuDishes(),yield this.menuService.loadData())}})}toggleDishInMenu(i){return g(this,null,function*(){if(!this.currentMenu)return;let e=this.menuDishes.find(t=>t.menu_id===this.currentMenu.id&&t.dish_id===i.id);if(e)yield this.menuService.removeDishFromMenu(e.id);else{let t=yield this.menuDishService.addDishToMenu(this.currentMenu.id,i.id,i.category_id||"");t&&(this.menuDishes=[...this.menuDishes,t])}this.applyFilters()})}loadAvailableDishes(){return g(this,null,function*(){yield this.dishService.loadData()})}isDishInCurrentMenu(i){return this.currentMenu?this.menuDishes.some(e=>e.menu_id===this.currentMenu.id&&e.dish_id===i&&e.is_active):!1}compareMenus(i,e){return i&&e?i.id===e.id:i===e}closeMoveDialog(){this.showMoveDialog=!1,this.dishToMove=null,this.selectedTargetMenuId=null,this.isMoving=!1}moveDishToMenu(){return g(this,null,function*(){if(console.log("\u{1F680} moveDishToMenu chiamato - isCopyMode:",this.isCopyMode),!this.dishToMove||!this.selectedTargetMenuId){console.error("\u274C Dati mancanti");return}let i=this.menus.find(e=>e.id===this.selectedTargetMenuId);if(!i){alert("Menu di destinazione non trovato!");return}this.isMoving=!0;try{if(this.isCopyMode){console.log("\u{1F4CB} MODALIT\xC0 COPIA: clono il piatto");let e=yield this.dishService.cloneDish(this.dishToMove.id,i.name);if(!e)throw new Error("Errore nella clonazione del piatto");if(console.log("\u2705 Piatto clonato:",e.id,e.name),this.menuDishes.some(l=>l&&l.menu_id===this.selectedTargetMenuId&&l.dish_id===e.id&&l.is_active)){alert(`Il piatto clonato \xE8 gi\xE0 nel menu "${i.name}"`),this.closeMoveDialog();return}let s=yield this.menuService.addDishToMenu(this.selectedTargetMenuId,e.id,e.category_id||"",0);if(s){console.log("\u2705 Piatto clonato aggiunto al menu"),this.menuDishes=[...this.menuDishes,s],yield this.menuService.loadMenuDishes(this.selectedTargetMenuId),yield this.dishService.loadData(),this.applyFilters(),alert(`\u2705 Piatto "${this.dishToMove.name}" COPIATO (come "${e.name}") e aggiunto al menu "${i.name}"`),this.closeMoveDialog();return}else throw new Error("Errore nell'aggiunta del piatto clonato al menu")}else{if(console.log("\u{1F504} MODALIT\xC0 SPOSTA: sposto il piatto esistente"),this.menuDishes.some(s=>s&&s.menu_id===this.selectedTargetMenuId&&s.dish_id===this.dishToMove.id&&s.is_active)){alert(`Il piatto "${this.dishToMove.name}" \xE8 gi\xE0 nel menu "${i.name}"`),this.closeMoveDialog();return}let t=this.menuDishes.find(s=>s&&s.dish_id===this.dishToMove.id&&s.is_active);if(t)if(console.log("\u{1F4CB} Record trovato per lo spostamento:",t.id),yield this.menuService.updateMenuDish(t.id,{menu_id:this.selectedTargetMenuId})){console.log("\u2705 Record aggiornato con nuovo menu_id"),this.menuDishes=this.menuDishes.map(l=>l&&l.id===t.id?F(k({},l),{menu_id:this.selectedTargetMenuId}):l),t.menu_id&&(yield this.menuService.loadMenuDishes(t.menu_id)),yield this.menuService.loadMenuDishes(this.selectedTargetMenuId),this.applyFilters(),alert(`\u2705 Piatto "${this.dishToMove.name}" SPOSTATO al menu "${i.name}"`),this.closeMoveDialog();return}else throw new Error("Errore nell'aggiornamento del record");else{console.log("\u2795 Il piatto non \xE8 in nessun menu, lo aggiungo al menu di destinazione");let s=yield this.menuService.addDishToMenu(this.selectedTargetMenuId,this.dishToMove.id,this.dishToMove.category_id||"",0);if(s){console.log("\u2705 Piatto aggiunto al menu di destinazione"),this.menuDishes=[...this.menuDishes,s],yield this.menuService.loadMenuDishes(this.selectedTargetMenuId),this.applyFilters(),alert(`\u2705 Piatto "${this.dishToMove.name}" AGGIUNTO al menu "${i.name}"`),this.closeMoveDialog();return}else throw new Error("Errore nell'aggiunta del piatto al menu")}}}catch(e){console.error("\u274C Errore:",e);let t=this.isCopyMode?"copia":"spostamento";alert(`\u274C Errore durante la ${t} del piatto: ${e.message||"Errore sconosciuto"}`)}finally{this.isMoving=!1}})}getAvailableMenusForMove(){if(this.dishToMove&&!this.isCopyMode){let i=this.getMenuForDish(this.dishToMove.id);if(i)return this.menus.filter(e=>e.id!==i.id)}return this.menus}showDishesWithoutMenu(){this.setViewMode("without-menu")}setViewMode(i){this.viewMode=i,this.applyFilters(),i==="without-menu"&&setTimeout(()=>{let e=document.querySelector(".piatti-senza-menu");e&&e.scrollIntoView({behavior:"smooth"})},100)}startEditMenuName(){this.currentMenu&&(this.editedMenuName=this.currentMenu.name,this.isEditingMenuName=!0)}saveMenuName(){return g(this,null,function*(){this.currentMenu&&this.editedMenuName.trim()&&((yield this.menuService.updateMenu(this.currentMenu.id,{name:this.editedMenuName}))?(this.isEditingMenuName=!1,yield this.menuService.loadData(),this.changeMenu(this.currentMenu.id)):alert("Errore durante il salvataggio del nome menu."))})}cancelEditMenuName(){this.isEditingMenuName=!1,this.editedMenuName=""}showCopyMenuDialog(i){console.log("\u{1F535} MODAL COPIA attivato per:",i.name),this.dishToMove=i,this.selectedTargetMenuId=null,this.showMoveDialog=!0,this.isCopyMode=!0;let e=this.getMenuForDish(i.id);console.log("\u{1F535} Piatto attualmente in menu:",e?.name||"Nessun menu")}showMoveMenuDialog(i){console.log("\u{1F534} MODAL SPOSTA attivato per:",i.name),this.dishToMove=i,this.selectedTargetMenuId=null,this.showMoveDialog=!0,this.isCopyMode=!1;let e=this.getMenuForDish(i.id);console.log("\u{1F534} DEBUG showMoveMenuDialog:",{dishId:i.id,dishName:i.name,currentMenu:e?.name||"Nessun menu",currentMenuId:e?.id,totalMenus:this.menus.length,menuNames:this.menus.map(s=>s.name)});let t=this.getAvailableMenusForMove();console.log("\u{1F534} Menu disponibili per spostamento:",t.map(s=>s.name)),t.length===0&&(console.warn("\u26A0\uFE0F Nessun menu disponibile per lo spostamento!"),setTimeout(()=>{alert("Non ci sono altri menu disponibili per lo spostamento."),this.closeMoveDialog()},100))}toggleMenuType(){return g(this,null,function*(){if(!this.currentMenu||this.currentMenu.is_default)return;let i=this.currentMenu.type==="global"?"dedicated":"global";try{if(yield this.menuService.updateMenu(this.currentMenu.id,{type:i})){let t=F(k({},this.currentMenu),{type:i});this.currentMenu=t;let s=this.menus.findIndex(l=>l.id===this.currentMenu.id);s!==-1&&(this.menus[s]=t),this.isSpecificMenu=i==="dedicated",yield this.menuService.loadData(),console.log(`\u2705 Menu "${this.currentMenu.name}" impostato come ${i}`)}else alert("Errore durante l'aggiornamento del tipo menu")}catch(e){console.error("Errore nel toggle menu type:",e)}})}syncCheckboxState(){this.currentMenu?this.isSpecificMenu=this.currentMenu.type==="dedicated":this.isSpecificMenu=!1}toggleShowDeletedDishes(){return g(this,null,function*(){if(this.showDeletedDishes=!this.showDeletedDishes,this.showDeletedDishes){let i=yield this.dishService.getAllDishesIncludingDeleted();this.dishes=i}else yield this.dishService.loadData();this.applyFilters(),this.calculateStats()})}isDishWithoutMenu(i){return!i||this.dishes.find(t=>t.id===i)?.deleted_at&&!this.showDeletedDishes?!1:!this.existsDishInAnyMenu(i)}getDeletedDishesCount(){return this.dishes.filter(i=>i.deleted_at).length}getDishesWithoutMenuRespectingDeleted(){let i=this.menuDishes.filter(t=>t.is_active===!0).map(t=>t.dish_id),e=[...new Set(i)];return console.log("\u{1F50D} Piatti con menu:",e.length),console.log("\u{1F50D} Piatti totali:",this.dishes.length),this.dishes.filter(t=>{let s=e.includes(t.id),l=this.showDeletedDishes?!0:!t.deleted_at;return!s&&l})}confirmRestoreDish(i){return g(this,null,function*(){let e=`Sei sicuro di voler ripristinare il piatto "${i.name}"?

Il piatto torner\xE0 disponibile nel sistema.`;confirm(e)&&(yield this.restoreDish(i.id))})}restoreDish(i){return g(this,null,function*(){try{if(yield this.dishService.restoreDish(i)){console.log("\u2705 Piatto ripristinato con successo");let t=this.dishes.findIndex(l=>l.id===i);t!==-1&&(this.dishes[t].deleted_at=null,this.dishes[t].status="available"),!this.dishes.some(l=>l.deleted_at)&&this.showDeletedDishes?(this.showDeletedDishes=!1,yield this.dishService.loadData()):this.applyFilters(),this.calculateStats(),alert("\u2705 Piatto ripristinato con successo!")}else alert("\u274C Errore durante il ripristino del piatto")}catch(e){console.error("\u274C Errore durante il ripristino:",e),alert("Errore durante il ripristino del piatto")}})}hasDeletedDishes(){return this.dishes.some(i=>i.deleted_at)}refreshAllData(){return g(this,null,function*(){try{console.log("\u{1F504} Ricarica completa dei dati..."),yield Promise.all([this.dishService.loadData(),this.categoryService.loadData(),this.menuService.loadData(),this.menuDishService.loadData()]),this.currentMenu&&(yield this.menuDishService.loadDishesForMenu(this.currentMenu.id)),this.applyFilters(),this.calculateStats(),console.log("\u2705 Dati ricaricati con successo")}catch(i){console.error("\u274C Errore durante il refresh dei dati:",i)}})}onDeleteMenu(i){return g(this,null,function*(){if(!i)return;if(i.is_default){alert("\u274C Non puoi eliminare il menu di default. Imposta prima un altro menu come default.");return}let t=confirm(`Sei sicuro di voler eliminare il menu "${i.name}"?

Clicca:
\u2022 "OK" per eliminare anche tutti i piatti del menu
\u2022 "Annulla" per eliminare solo il menu (i piatti rimarranno nel sistema ma senza menu)`);try{if(t){if(!confirm(`ATTENZIONE: Stai per eliminare il menu "${i.name}" e TUTTI i suoi piatti.
Questa azione non pu\xF2 essere annullata.

Sei assolutamente sicuro?`))return;let w=this.menuDishes.filter(N=>N.menu_id===i.id);for(let N of w)yield this.dishService.deleteDish(N.dish_id)}let s=this.menuDishes.filter(_=>_.menu_id===i.id);for(let _ of s)yield this.menuDishService.delete(_.id);if(yield this.menuService.delete(i.id)){if(yield this.loadData(),this.menus.length>0){let _=this.menus.find(w=>w.is_default)||this.menus[0];this.changeMenu(_.id)}else this.currentMenu=null,this.selectedMenuId=null;alert(`\u2705 Menu "${i.name}" eliminato con successo!`)}else alert("\u274C Errore durante l'eliminazione del menu")}catch(s){console.error("\u274C Errore durante l'eliminazione del menu:",s),alert("Errore durante l'eliminazione del menu")}})}getMenuForDish(i){if(!i||!this.menuDishes||!this.menus)return null;let e=this.menuDishes.find(t=>t.dish_id===i&&t.is_active);return e&&this.menus.find(t=>t.id===e.menu_id)||null}existsDishInAnyMenu(i){return!i||!this.menuDishes||this.menuDishes.length===0?!1:this.menuDishes.some(e=>e.dish_id===i&&e.is_active===!0)}isSortingByNonCategoryField(){return["name","price","food_cost_percentage","margin"].includes(this.sortField)}toggleMenuFavorite(){return g(this,null,function*(){if(!(!this.currentMenu||this.currentMenu.is_default))try{let i=!this.currentMenu.is_favorite;if(yield this.menuService.updateMenu(this.currentMenu.id,{is_favorite:i})){this.currentMenu.is_favorite=i;let t=this.menus.findIndex(s=>s.id===this.currentMenu.id);t!==-1&&(this.menus[t].is_favorite=i),console.log(`\u2705 Menu "${this.currentMenu.name}" ${i?"aggiunto ai":"rimosso dai"} preferiti`)}else alert("\u274C Errore durante l'aggiornamento del menu")}catch(i){console.error("\u274C Errore toggleMenuFavorite:",i),alert("Errore durante l'aggiornamento del menu")}})}toggleMenuActive(){return g(this,null,function*(){if(!this.currentMenu||this.currentMenu.is_default){alert("\u26A0\uFE0F Il menu di default non pu\xF2 essere disattivato");return}try{let i=!this.currentMenu.is_active,e=i?`Attivare il menu "${this.currentMenu.name}"?`:`Disattivare il menu "${this.currentMenu.name}"?

I piatti rimarranno nel sistema ma non saranno visibili nei selettori.`;if(!confirm(e))return;let t;if(i||(t=this.menus.find(l=>l.is_active&&l.id!==this.currentMenu.id&&!l.is_default),t||(t=this.menus.find(l=>l.is_default)),!t&&this.menus.length>0&&(t=this.menus[0])),yield this.menuService.updateMenu(this.currentMenu.id,{is_active:i})){this.currentMenu.is_active=i;let l=this.menus.findIndex(_=>_.id===this.currentMenu.id);l!==-1&&(this.menus[l].is_active=i),!i&&t&&(this.selectedMenuId=t.id,this.currentMenu=t,this.syncCheckboxState(),this.applyFilters(),setTimeout(()=>{this.selectedMenuId=t.id},0)),!i&&!t&&(alert("\u26A0\uFE0F Attenzione: questo era l'ultimo menu attivo!"),this.selectedMenuId=null,this.currentMenu=null,this.isSpecificMenu=!1,this.applyFilters()),console.log(`\u2705 Menu "${this.currentMenu?.name}" ${i?"attivato":"disattivato"}`)}else alert("\u274C Errore durante l'aggiornamento del menu")}catch(i){console.error("\u274C Errore toggleMenuActive:",i),alert("Errore durante l'aggiornamento del menu")}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=q({type:o,selectors:[["app-menu-builder"]],decls:205,vars:51,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"form-card","mb-lg"],[1,"flex","flex-col"],[1,"section-title","m-0"],[1,"form-row","mt-lg"],[1,"form-group"],[1,"standard-label"],[1,"flex","gap-sm","items-center"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["title","Modifica nome menu",1,"icon-button",3,"click","disabled"],[1,"material-icons"],["class","mt-sm",4,"ngIf"],[1,"form-group","m-0"],[1,"w-full",3,"ngModelChange","change","ngModel"],["value","menu-only"],["value","all-dishes"],["value","without-menu"],[1,"form-row","mt-sm"],["class","mt-sm flex items-center gap-sm",4,"ngIf"],["class","text-xs text-muted mt-sm ml-6",4,"ngIf"],["class","text-xs text-warning mt-sm ml-6",4,"ngIf"],[1,"flex","flex-wrap","gap-sm","justify-between"],[1,"flex","items-center","gap-sm"],[1,"material-icons","text-muted","text-sm","ml-xs",3,"title"],["class","chip success ml-md",4,"ngIf"],["class","chip ml-md",4,"ngIf"],["class","form-row mt-sm",4,"ngIf"],["class","flex items-center gap-sm",4,"ngIf"],[1,"flex","flex-wrap","gap-sm",2,"justify-content","flex-end"],[1,"promethea-button",3,"click"],["title","Elimina menu",1,"promethea-button","ghost",3,"click","disabled"],[1,"grid-cards","p-sm02"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"text-muted","card-footer"],[1,"text-md","font-bold","text-primary","text-amber-500","justify-center","flex"],[1,"form-card","m-sm02"],[1,"flex","justify-between","items-end","gap-md","flex-wrap"],[1,"form-row"],["type","text","placeholder","Cerca per nome o descrizione...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","available"],["value","unavailable"],["value","out_of_stock"],[2,"display","flex","gap","var(--gap-sm)"],["type","number","placeholder","Min",3,"ngModelChange","input","ngModel"],[2,"align-self","center"],["type","number","placeholder","Max",3,"ngModelChange","input","ngModel"],[1,"modal-footer","p-sm"],[1,"promethea-button","ghost",3,"click"],[1,"material-icons","text-sm"],[1,"table-section"],[1,"bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"crm-table"],[2,"cursor","pointer",3,"click"],["class","material-icons",4,"ngIf"],[2,"width","100px"],[4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"mt-sm"],["type","text","placeholder","Nuovo nome menu","autofocus","",1,"form-input",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],["title","Salva",1,"icon-button","success",3,"click"],["title","Annulla",1,"icon-button",3,"click"],[1,"text-sm","text-muted","mt-sm"],[1,"mt-sm","flex","items-center","gap-sm"],[1,"flex","items-center","gap-sm","cursor-pointer"],["type","checkbox",1,"form-checkbox",3,"change","checked","disabled"],[1,"ml-xs","text-sm"],[1,"text-xs","text-muted","mt-sm","ml-6"],[1,"text-xs","text-warning","mt-sm","ml-6"],[1,"chip","success","ml-md"],[1,"chip","ml-md"],[1,"material-icons","text-yellow-500","text-sm"],[1,"material-icons","text-green-500","text-sm"],[1,"material-icons","text-muted"],["class","chip error ml-md",4,"ngIf"],[1,"chip","error","ml-md"],[3,"opacity-60","bg-gray-50",4,"ngFor","ngForOf"],["class","flex items-center gap-sm mb-1",4,"ngIf"],[1,"nomedescpiatto"],[1,"link",3,"click"],["class","text-muted","style","font-size: 0.8rem;",4,"ngIf"],[1,"status-select",3,"ngModelChange","ngModel"],["class","text-muted",4,"ngIf"],[1,"flex","gap-sm",2,"justify-content","flex-end"],[1,"flex","items-center","gap-sm","mb-1"],[1,"material-icons","text-red-500","text-sm"],[1,"text-xs","text-red-600","font-medium"],[1,"material-icons","text-amber-500","text-sm"],[1,"text-xs","text-amber-600","font-medium"],[1,"text-muted",2,"font-size","0.8rem"],["title","Copia in altro menu",1,"promethea-button","small","copy-button","ghost",3,"click","disabled"],["title","Sposta in altro menu",1,"promethea-button","small","move-button","success",3,"click","disabled"],["title","Elimina piatto",1,"promethea-button","danger","small",3,"click"],["title","Ripristina piatto",1,"promethea-button","success","small",3,"click"],[4,"ngFor","ngForOf"],["class","category-header",4,"ngIf"],[1,"category-header"],["colspan","8",2,"background","var(--smoke-color-2)","font-weight","800"],[1,"text-md","flex","gap-md",2,"margin","0","border","none"],[1,"text-primary"],[1,"chip"],["colspan","8",2,"background","var(--smoke-1)","font-weight","800"],[1,"section-title",2,"margin","0","border","none"],[1,"chip",2,"margin-left","auto"],["colspan","8",1,"empty-state-row"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"icon-button",3,"click","disabled"],[1,"modal-content","p-md"],[1,"info-message","mb-md"],[3,"ngModelChange","ngModel","disabled"],["value","","disabled",""],[1,"flex","gap-sm","mt-sm"],[1,"text-muted","text-mini"],[1,"modal-footer"],[1,"promethea-button","ghost",3,"click","disabled"],[1,"promethea-button",3,"click","disabled"],["class","material-icons animate-spin",4,"ngIf"],[1,"material-icons","animate-spin"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),a(4,"dashboard"),r(),n(5,"h1",4),a(6,"Men\xF9"),r()(),n(7,"p",5),a(8,"Panoramica completa delle attivit\xE0 del tuo ristorante"),r()(),n(9,"div",6)(10,"div",7)(11,"h2",8),a(12,"Gestione Menu"),r(),n(13,"div",9)(14,"div",10)(15,"label",11),a(16,"Menu"),r(),n(17,"div",12)(18,"select",13),E("ngModelChange",function(l){return D(t.selectedMenuId,l)||(t.selectedMenuId=l),l}),m("change",function(){return t.changeMenu(t.selectedMenuId)}),h(19,he,2,3,"option",14),r(),n(20,"div",2)(21,"button",15),m("click",function(){return t.startEditMenuName()}),n(22,"span",16),a(23,"edit"),r()()()(),h(24,ge,12,1,"div",17),r(),n(25,"div",18)(26,"label",11),a(27,"Visualizzazione:"),r(),n(28,"select",19),E("ngModelChange",function(l){return D(t.viewMode,l)||(t.viewMode=l),l}),m("change",function(){return t.setViewMode(t.viewMode)}),n(29,"option",20),a(30,"Solo questo menu"),r(),n(31,"option",21),a(32,"Tutti i piatti"),r(),n(33,"option",22),a(34,"Piatti senza menu"),r()()()()(),n(35,"div",23)(36,"div",10),h(37,fe,5,2,"div",24)(38,Me,2,0,"div",25)(39,ve,2,0,"div",26),r(),n(40,"div",10)(41,"div",27)(42,"div",5),a(43),r(),n(44,"div",28)(45,"span",29),a(46," info "),r(),h(47,xe,4,0,"span",30)(48,ye,4,0,"span",31),r()()()(),h(49,Se,15,4,"div",32),n(50,"div",23)(51,"div",10),h(52,Ee,7,3,"div",33),r()(),n(53,"div",23)(54,"div",10)(55,"div",34)(56,"button",35),m("click",function(){return t.createNewMenu()}),n(57,"span",16),a(58,"add"),r(),a(59," Nuovo Menu "),r(),n(60,"button",36),m("click",function(){return t.onDeleteMenu(t.currentMenu)}),n(61,"span",16),a(62,"delete"),r(),a(63," Elimina "),r()()()()(),n(64,"div",37)(65,"div",38)(66,"div",39)(67,"span",40),a(68,"restaurant"),r(),n(69,"h3",41),a(70,"Totale Piatti"),r()(),n(71,"div",42),a(72),r(),n(73,"span",43),a(74,"Piatti nel men\xF9"),r()(),n(75,"div",38)(76,"div",39)(77,"span",40),a(78,"category"),r(),n(79,"h3",41),a(80,"Categorie"),r()(),n(81,"div",44),a(82),r(),n(83,"span",43),a(84,"Categorie attive"),r()(),n(85,"div",38)(86,"div",39)(87,"span",40),a(88,"euro"),r(),n(89,"h3",41),a(90,"Prezzo Medio"),r()(),n(91,"div",44),a(92),v(93,"number"),r(),n(94,"span",43),a(95,"Prezzo medio piatto"),r()(),n(96,"div",38)(97,"div",39)(98,"span",40),a(99,"trending_up"),r(),n(100,"h3",41),a(101,"Margine Medio"),r()(),n(102,"div",42),a(103),v(104,"number"),r(),n(105,"span",43),a(106,"Margine medio (in %)"),r()(),n(107,"div",38)(108,"div",39)(109,"span",40),a(110,"account_balance"),r(),n(111,"h3",41),a(112,"Food Cost Medio"),r()(),n(113,"div",42),a(114),v(115,"number"),r(),n(116,"span",43),a(117,"Food cost medio (in %)"),r()()(),n(118,"div",45)(119,"div",46)(120,"div",47)(121,"div",10)(122,"label",11)(123,"span",16),a(124,"search"),r(),a(125," Cerca "),r(),n(126,"input",48),E("ngModelChange",function(l){return D(t.searchTerm,l)||(t.searchTerm=l),l}),m("input",function(){return t.applyFilters()}),r()(),n(127,"div",10)(128,"label",11)(129,"span",16),a(130,"category"),r(),a(131," Categoria "),r(),n(132,"select",49),E("ngModelChange",function(l){return D(t.selectedCategory,l)||(t.selectedCategory=l),l}),m("change",function(){return t.applyFilters()}),n(133,"option",50),a(134,"Tutte le categorie"),r(),h(135,we,2,2,"option",14),r()()(),n(136,"div",47)(137,"div",10)(138,"label",11)(139,"span",16),a(140,"visibility"),r(),a(141," Stato "),r(),n(142,"select",49),E("ngModelChange",function(l){return D(t.statusFilter,l)||(t.statusFilter=l),l}),m("change",function(){return t.applyFilters()}),n(143,"option",50),a(144,"Tutti gli stati"),r(),n(145,"option",51),a(146,"Disponibile"),r(),n(147,"option",52),a(148,"Non disponibile"),r(),n(149,"option",53),a(150,"Esaurito"),r()()(),n(151,"div",10)(152,"label",11)(153,"span",16),a(154,"euro"),r(),a(155," Prezzo "),r(),n(156,"div",54)(157,"input",55),E("ngModelChange",function(l){return D(t.priceRange.min,l)||(t.priceRange.min=l),l}),m("input",function(){return t.applyFilters()}),r(),n(158,"span",56),a(159,"-"),r(),n(160,"input",57),E("ngModelChange",function(l){return D(t.priceRange.max,l)||(t.priceRange.max=l),l}),m("input",function(){return t.applyFilters()}),r()()()()()(),n(161,"div",58)(162,"button",35),m("click",function(){return t.createNewDish()}),n(163,"span",16),a(164,"add"),r(),a(165," Nuovo Piatto "),r(),n(166,"button",59),m("click",function(){return t.resetFilters()}),n(167,"span",16),a(168,"refresh"),r(),a(169," Reset Filtri "),r(),n(170,"button",59),m("click",function(){return t.toggleShowDeletedDishes()}),n(171,"span",60),a(172),r(),a(173),r()(),n(174,"div",61)(175,"div",62)(176,"table",63)(177,"thead")(178,"tr")(179,"th",64),m("click",function(){return t.onSort("name")}),a(180," Nome "),h(181,Ce,2,1,"span",65),r(),n(182,"th",64),m("click",function(){return t.onSort("category")}),a(183," Categoria "),h(184,Ie,2,1,"span",65),r(),n(185,"th",64),m("click",function(){return t.onSort("price")}),a(186," Prezzo "),h(187,Te,2,1,"span",65),r(),n(188,"th",64),m("click",function(){return t.onSort("food_cost_percentage")}),a(189," FC % "),h(190,Be,2,1,"span",65),r(),n(191,"th",64),m("click",function(){return t.onSort("margin")}),a(192," Margine (\u20AC) "),h(193,Pe,2,1,"span",65),r(),n(194,"th"),a(195,"Stato"),r(),n(196,"th"),a(197,"Tempo Prep."),r(),n(198,"th",66),a(199,"Azioni"),r()()(),n(200,"tbody"),h(201,We,2,1,"ng-container",67)(202,rt,4,3,"ng-container",67)(203,at,9,0,"tr",67),r()()()(),h(204,ct,42,14,"div",68),r()),e&2&&(c(18),b("ngModel",t.selectedMenuId),d("disabled",t.menus.length===0||t.isEditingMenuName),c(),d("ngForOf",t.menus),c(2),d("disabled",!t.currentMenu||t.isEditingMenuName),c(3),d("ngIf",t.isEditingMenuName&&t.currentMenu),c(4),b("ngModel",t.viewMode),c(9),d("ngIf",t.currentMenu),c(),d("ngIf",(t.currentMenu==null?null:t.currentMenu.type)==="dedicated"),c(),d("ngIf",(t.currentMenu==null?null:t.currentMenu.is_default)&&(t.currentMenu==null?null:t.currentMenu.type)==="dedicated"),c(4),p(" ",t.getViewModeStats()[t.viewMode]," piatto/i "),c(2),d("title",t.currentMenu!=null&&t.currentMenu.is_default?"Il menu di default non pu\xF2 essere specifico":"Menu dedicato a una specifica prenotazione/evento"),c(2),d("ngIf",(t.currentMenu==null?null:t.currentMenu.type)==="dedicated"),c(),d("ngIf",(t.currentMenu==null?null:t.currentMenu.type)==="global"&&!(t.currentMenu!=null&&t.currentMenu.is_default)),c(),d("ngIf",t.currentMenu),c(3),d("ngIf",t.currentMenu),c(8),d("disabled",!t.currentMenu||t.isEditingMenuName),c(12),S(t.stats.totalDishes),c(10),S(t.stats.totalCategories),c(10),p("\u20AC",x(93,42,t.stats.averagePrice,"1.2-2")),c(11),p(" ",x(104,45,t.stats.averageMarginPercentage,"1.0-1"),"% "),c(11),p(" ",x(115,48,t.stats.averageFoodCostPercentage,"1.0-1"),"% "),c(12),b("ngModel",t.searchTerm),c(6),b("ngModel",t.selectedCategory),c(3),d("ngForOf",t.categories),c(7),b("ngModel",t.statusFilter),c(15),b("ngModel",t.priceRange.min),c(3),b("ngModel",t.priceRange.max),c(10),P("bg-red-100",t.showDeletedDishes)("text-red-700",t.showDeletedDishes),c(2),p(" ",t.showDeletedDishes?"visibility_off":"delete"," "),c(),p(" ",t.showDeletedDishes?"Nascondi Eliminati":"Mostra Eliminati"," "),c(8),d("ngIf",t.sortField==="name"),c(3),d("ngIf",t.sortField==="category"),c(3),d("ngIf",t.sortField==="price"),c(3),d("ngIf",t.sortField==="food_cost_percentage"),c(3),d("ngIf",t.sortField==="margin"),c(8),d("ngIf",t.isSortingByNonCategoryField()),c(),d("ngIf",!t.isSortingByNonCategoryField()),c(),d("ngIf",t.filteredDishes.length===0),c(),d("ngIf",t.showMoveDialog))},dependencies:[H,G,Q,oe,ae,se,ee,ne,re,te,ie,Y,K,Z],styles:[".category-header[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.category-header[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gap-md)!important}.crm-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(.category-header):hover{background:var(--smoke-1)}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.nomedescpiatto[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:calc(var(--gap-sm) / 2)}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.crm-table[_ngcontent-%COMP%]{min-width:800px}}.status-select.available[_ngcontent-%COMP%]{border-color:var(--success-color, #28a745)}.status-select.unavailable[_ngcontent-%COMP%]{border-color:var(--warning-color, #ffc107)}.status-select.out_of_stock[_ngcontent-%COMP%]{border-color:var(--danger-color, #dc3545)}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}.chip.active[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.chip.inactive[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}.text-warning[_ngcontent-%COMP%]{color:#f59e0b!important}.pianti-senza-menu-section[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(245,158,11,.1),transparent);border-left:4px solid #f59e0b}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}to{transform:scale(1)}}.move-button[_ngcontent-%COMP%]:hover{animation:_ngcontent-%COMP%_pulse .5s ease-in-out}tr.opacity-60[_ngcontent-%COMP%]{opacity:.8}tr.bg-gray-50[_ngcontent-%COMP%]{background-color:var(--smoke-1);border:1px solid var(--shadow-1)}tr.no-category-divider[_ngcontent-%COMP%]{border-top:1px solid #e5e7eb}tr.no-category-divider[_ngcontent-%COMP%]:first-child{border-top:none}.category-header[_ngcontent-%COMP%]:not(.category-header){display:none}"]})};export{me as MenuBuilder};
