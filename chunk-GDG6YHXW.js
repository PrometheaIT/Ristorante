import{a as ge}from"./chunk-XN57HYMO.js";import"./chunk-D2EHDSLL.js";import"./chunk-Z3UXT6XE.js";import{db as ue,eb as me}from"./chunk-4Q6XQXJD.js";import{a as pe}from"./chunk-AKFCUPBN.js";import{a as J,b as K,d as Y,e as Z,h as ee,i as te,m as ie,n as ne,p as ae,q as re,r as oe,s as se,w as le,x as ce,y as de}from"./chunk-D6L6OQLW.js";import{b as q,d as X}from"./chunk-M5ABBUWH.js";import"./chunk-TSK5DXKO.js";import{j as U,k as H,u as Q}from"./chunk-WSJCHGNS.js";import{Bb as u,D as O,Ea as F,Fb as L,Gb as $,H as T,Ha as l,Hb as G,Kb as C,Lb as B,Mb as W,Nb as s,Ob as y,Pb as b,Qb as z,Tb as k,U as R,Ub as P,Vb as I,Xa as j,Yb as E,ab as _,ca as w,f as M,ia as m,ja as p,nb as d,ob as a,pb as r,qb as f,wb as h,zb as g}from"./chunk-QIXMMTC2.js";import{a as N,b as A,j as v}from"./chunk-4ZZIO3ZI.js";var fe=["fileInput"],he=()=>[1,2,3,4,5,6,7,8],V=()=>({standalone:!0});function ve(o,t){if(o&1&&(a(0,"option",45),s(1),r()),o&2){let e=t.$implicit;d("value",e.value),l(),b(" ",e.label," ")}}function xe(o,t){if(o&1){let e=h();a(0,"label",8)(1,"input",46),g("change",function(i){m(e);let c=u();return p(c.togglePayment(i))}),r(),a(2,"span"),s(3),r()()}if(o&2){let e=t.$implicit,n=u();l(),d("value",e.value)("checked",n.isPaymentSelected(e.value)),l(2),y(e.label)}}function Se(o,t){if(o&1){let e=h();a(0,"label",8)(1,"input",46),g("change",function(i){m(e);let c=u();return p(c.toggleCuisine(i))}),r(),a(2,"span"),s(3),r()()}if(o&2){let e=t.$implicit,n=u();l(),d("value",e.value)("checked",n.isCuisineSelected(e.value)),l(2),y(e.label)}}function be(o,t){if(o&1&&(a(0,"label",8),f(1,"input",48),a(2,"span"),s(3),r()()),o&2){let e=t.$implicit;l(),d("formControlName",e.value),l(2),y(e.label)}}function ye(o,t){if(o&1&&(a(0,"div",47)(1,"label",17),s(2,"Info aggiuntive sul cibo"),r(),a(3,"div",22),_(4,be,4,2,"label",23),r()()),o&2){let e=u();l(4),d("ngForOf",e.foodOptions)}}function we(o,t){if(o&1){let e=h();a(0,"button",63),g("click",function(){m(e);let i=u().index,c=u();return p(c.deleteShift(i))}),f(1,"lucide-angular",64),r()}o&2&&(l(),d("size",20))}function Ee(o,t){if(o&1&&(a(0,"span",54),s(1),r()),o&2){let e=t.$implicit,n=t.index,i=u().$implicit,c=u();C("active",c.isDaySelected(i.days_of_week,n))("warning",!c.isDaySelected(i.days_of_week,n)),l(),b(" ",e," ")}}function Ce(o,t){if(o&1){let e=h();a(0,"div",49)(1,"div",50)(2,"div",51)(3,"h3",52),s(4),r(),a(5,"div",53)(6,"span",54)(7,"span",55),s(8,"access_time"),r(),s(9),r(),a(10,"span",54),s(11),r()()(),a(12,"div",56)(13,"button",57),g("click",function(){let i=m(e).index,c=u();return p(c.toggleShiftActive(i))}),a(14,"span",58),s(15),r()(),a(16,"button",59),g("click",function(){let i=m(e).index,c=u();return p(c.editShift(i))}),a(17,"span",58),s(18,"edit"),r()(),_(19,we,2,1,"button",60),r()(),a(20,"div",61),_(21,Ee,2,5,"span",62),r()()}if(o&2){let e=t.$implicit,n=u();l(4),y(e.name),l(5),z(" ",e.start_time.substring(0,5)," - ",e.end_time.substring(0,5)," "),l(),W(e.is_active?"active":"warning"),l(),b(" ",e.is_active?"Attivo":"Disattivato"," "),l(2),C("text-green-500",!e.is_active)("text-orange-500",e.is_active),d("title",e.is_active?"Disattiva turno":"Attiva turno"),l(2),b(" ",e.is_active?"pause":"play_arrow"," "),l(4),d("ngIf",n.shifts.length>1),l(2),d("ngForOf",n.weekDays)}}function ke(o,t){if(o&1){let e=h();a(0,"button",65),g("click",function(){m(e);let i=u();return p(i.addNewShift())}),f(1,"lucide-angular",66),s(2," Aggiungi Nuovo Turno "),r()}o&2&&(l(),d("size",20))}function Pe(o,t){if(o&1&&(a(0,"option",85),s(1),r()),o&2){let e=t.$implicit,n=u(2).$implicit;d("value",e)("selected",(n==null?null:n.display_order)===e),l(),b(" ",e," ")}}function Ie(o,t){if(o&1){let e=h();a(0,"div",81)(1,"label",82),s(2,"Posizione:"),r(),a(3,"select",83),g("change",function(i){m(e);let c=u().index,x=u(2);return p(x.onPhotoOrderChange(c,i))}),_(4,Pe,2,3,"option",84),r()()}if(o&2){let e=u(3);l(3),d("disabled",e.loadingPhotos),l(),d("ngForOf",E(2,he))}}function Re(o,t){if(o&1){let e=h();a(0,"div",86)(1,"img",87),g("error",function(i){m(e);let c=u().index,x=u(2);return p(x.onImageError(i,c))}),r(),a(2,"div",88)(3,"span",58),s(4,"zoom_in"),r()()()}if(o&2){let e=u().$implicit;l(),d("src",e.url,F)("alt","Foto "+e.display_order)}}function Ve(o,t){if(o&1&&(a(0,"div",89)(1,"span",90),s(2,"add_photo_alternate"),r(),a(3,"p",91),s(4),r()()),o&2){let e=u().index;l(4),b("Slot ",e+1," vuoto")}}function Me(o,t){if(o&1){let e=h();a(0,"button",92),g("click",function(){m(e);let i=u().index,c=u(2);return p(c.deletePhoto(i))}),f(1,"lucide-angular",64),r()}if(o&2){let e=u(3);d("disabled",e.loadingPhotos),l(),d("size",20)}}function Oe(o,t){if(o&1){let e=h();a(0,"div",72)(1,"div",73)(2,"div",54),s(3),r(),_(4,Ie,5,3,"div",74),r(),a(5,"div",75),g("click",function(){let i=m(e),c=i.$implicit,x=i.index,S=u(2);return p(c?S.openPhoto(c,x):null)}),_(6,Re,5,2,"div",76)(7,Ve,5,1,"div",77),r(),a(8,"div",78)(9,"button",79),g("click",function(){let i=m(e).index,c=u(2);return p(c.triggerFileInput(i))}),a(10,"span",58),s(11),r()(),_(12,Me,2,2,"button",80),r()()}if(o&2){let e=t.$implicit,n=t.index,i=u(2);l(3),y(n+1),l(),d("ngIf",e),l(),B(e?"border: 2px solid var(--smoke-2); background: transparent;":"border: 2px dashed var(--smoke-1); background: var(--smoke-1);"),C("has-photo",e),l(),d("ngIf",e),l(),d("ngIf",!e),l(2),d("title",e?"Sostituisci foto":"Aggiungi foto")("disabled",i.loadingPhotos),l(2),y(e?"camera_alt":"add_a_photo"),l(),d("ngIf",e)}}function Te(o,t){o&1&&(a(0,"div",93),f(1,"div",94),a(2,"p",12),s(3,"Caricamento in corso..."),r()())}function Fe(o,t){if(o&1){let e=h();a(0,"div",3)(1,"div",4)(2,"span",5),s(3,"photo_library"),r(),a(4,"h2",6),s(5,"Galleria Foto del Ristorante"),r()(),a(6,"p",67),s(7," Carica fino a 5 foto (max 10MB ciascuna) per mostrare il tuo ristorante ai clienti. Solo immagini sono permesse. "),r(),a(8,"input",68,0),g("change",function(i){m(e);let c=u();return p(c.onPhotoFileSelected(i))}),r(),a(10,"div",69)(11,"div",7),_(12,Oe,13,12,"div",70),r(),_(13,Te,4,0,"div",71),r()()}if(o&2){let e=u();l(8),d("disabled",e.loadingPhotos),l(2),C("loading",e.loadingPhotos),l(2),d("ngForOf",e.photos)("ngForTrackBy",e.trackByIndex),l(),d("ngIf",e.loadingPhotos)}}function ze(o,t){if(o&1){let e=h();a(0,"button",107),g("click",function(i){return m(e),u(2).navigateFullscreenPhoto("prev"),p(i.stopPropagation())}),a(1,"span",58),s(2,"chevron_left"),r()()}}function De(o,t){if(o&1){let e=h();a(0,"button",108),g("click",function(i){return m(e),u(2).navigateFullscreenPhoto("next"),p(i.stopPropagation())}),a(1,"span",58),s(2,"chevron_right"),r()()}}function Ne(o,t){if(o&1&&(a(0,"div",109),s(1),r()),o&2){let e=u(2);l(),z(" ",e.currentPhotoIndex+1," / ",e.photos.length," ")}}function Ae(o,t){if(o&1){let e=h();a(0,"div",95),g("click",function(){m(e);let i=u();return p(i.closeFullscreenPhoto())}),a(1,"div",96),g("click",function(i){return m(e),p(i.stopPropagation())}),a(2,"div",97)(3,"h2",98)(4,"span",58),s(5,"photo"),r(),s(6," Galleria Foto "),r(),a(7,"button",99),g("click",function(){m(e);let i=u();return p(i.closeFullscreenPhoto())}),a(8,"span",58),s(9,"close"),r()()(),a(10,"div",100)(11,"div",101),_(12,ze,3,0,"button",102),a(13,"div",103),f(14,"img",104),r(),_(15,De,3,0,"button",105)(16,Ne,2,2,"div",106),r()()()()}if(o&2){let e=u();l(12),d("ngIf",e.hasMultiplePhotos),l(2),d("src",e.fullscreenPhoto,F)("alt","Foto galleria "+(e.currentPhotoIndex||0)),l(),d("ngIf",e.hasMultiplePhotos),l(),d("ngIf",e.currentPhotoIndex!==null)}}function je(o,t){o&1&&f(0,"lucide-angular",110)}function Le(o,t){o&1&&f(0,"lucide-angular",111)}function $e(o,t){o&1&&(a(0,"span"),s(1,"Salvataggio..."),r())}function Ge(o,t){o&1&&(a(0,"span"),s(1,"Salva Impostazioni"),r())}function Be(o,t){if(o&1&&(a(0,"p",125),s(1),r()),o&2){let e=u(2);l(),y(e.deleteRestaurantError)}}function We(o,t){if(o&1){let e=h();a(0,"div",112)(1,"div",113)(2,"div",97)(3,"div",114),f(4,"lucide-angular",115),a(5,"h3",116),s(6,"Elimina ristorante"),r()(),a(7,"button",117),g("click",function(){m(e);let i=u();return p(i.showDeleteRestaurantConfirm=!1)}),f(8,"lucide-angular",118),r()(),a(9,"div",119)(10,"p",120),s(11,"Sei assolutamente sicuro? Questa azione \xE8 "),a(12,"strong"),s(13,"irreversibile"),r(),s(14,". Tutti i dati del ristorante (menu, ordini, prenotazioni, staff) verranno eliminati definitivamente."),r(),_(15,Be,2,1,"p",121),a(16,"div",122)(17,"button",123),g("click",function(){m(e);let i=u();return p(i.showDeleteRestaurantConfirm=!1)}),s(18,"Annulla"),r(),a(19,"button",124),g("click",function(){m(e);let i=u();return p(i.confirmDeleteRestaurant())}),s(20),r()()()()()}if(o&2){let e=u();l(7),d("disabled",e.deleteRestaurantLoading),l(8),d("ngIf",e.deleteRestaurantError),l(2),d("disabled",e.deleteRestaurantLoading),l(2),d("disabled",e.deleteRestaurantLoading),l(),b(" ",e.deleteRestaurantLoading?"Eliminazione...":"Elimina definitivamente"," ")}}function Ue(o,t){if(o&1){let e=h();a(0,"label",8)(1,"input",133),g("change",function(i){let c=m(e).index,x=u(2);return p(x.toggleCurrentShiftDay(c,i))}),r(),a(2,"div",11)(3,"strong"),s(4),r()()()}if(o&2){let e=t.$implicit,n=t.index,i=u(2);l(),d("checked",i.isDaySelected(i.currentShift.days_of_week,n)),l(3),y(e)}}function He(o,t){if(o&1){let e=h();a(0,"div",95),g("click",function(){m(e);let i=u();return p(i.closeShiftModal())}),a(1,"div",126),g("click",function(i){return m(e),p(i.stopPropagation())}),a(2,"div",97)(3,"h2",116)(4,"span",58),s(5,"schedule"),r(),s(6),r(),a(7,"button",99),g("click",function(){m(e);let i=u();return p(i.closeShiftModal())}),a(8,"span",58),s(9,"close"),r()()(),a(10,"div",127)(11,"div",3)(12,"div",128)(13,"label",17)(14,"span",58),s(15,"badge"),r(),s(16," Nome Turno * "),r(),a(17,"input",129),I("ngModelChange",function(i){m(e);let c=u();return P(c.currentShift.name,i)||(c.currentShift.name=i),p(i)}),r()(),a(18,"div",128)(19,"div",16)(20,"label",17)(21,"span",58),s(22,"schedule"),r(),s(23," Ora Inizio * "),r(),a(24,"input",130),I("ngModelChange",function(i){m(e);let c=u();return P(c.currentShift.start_time,i)||(c.currentShift.start_time=i),p(i)}),r()(),a(25,"div",16)(26,"label",17)(27,"span",58),s(28,"schedule"),r(),s(29," Ora Fine * "),r(),a(30,"input",130),I("ngModelChange",function(i){m(e);let c=u();return P(c.currentShift.end_time,i)||(c.currentShift.end_time=i),p(i)}),r()()(),a(31,"div",128)(32,"label",8)(33,"input",131),I("ngModelChange",function(i){m(e);let c=u();return P(c.currentShift.is_active,i)||(c.currentShift.is_active=i),p(i)}),r(),a(34,"div",11)(35,"strong"),s(36,"Turno attivo"),r(),a(37,"div",12),s(38,"Il turno sar\xE0 disponibile per le prenotazioni"),r()()()(),a(39,"div",51)(40,"label",17)(41,"span",58),s(42,"event"),r(),s(43," Giorni Attivi * "),r(),a(44,"div",7),_(45,Ue,5,2,"label",23),r()()()(),a(46,"div",122)(47,"button",65),g("click",function(){m(e);let i=u();return p(i.closeShiftModal())}),a(48,"span",58),s(49,"close"),r(),s(50," Annulla "),r(),a(51,"button",132),g("click",function(){m(e);let i=u();return p(i.saveShift())}),f(52,"lucide-angular",111),s(53),r()()()()}if(o&2){let e=u();l(6),b(" ",e.editingShift==="new"?"Aggiungi Nuovo Turno":"Modifica Turno"," "),l(11),k("ngModel",e.currentShift.name),d("ngModelOptions",E(12,V)),l(7),k("ngModel",e.currentShift.start_time),d("ngModelOptions",E(13,V)),l(6),k("ngModel",e.currentShift.end_time),d("ngModelOptions",E(14,V)),l(3),k("ngModel",e.currentShift.is_active),d("ngModelOptions",E(15,V)),l(12),d("ngForOf",e.weekDays),l(6),d("disabled",!e.isCurrentShiftValid()),l(2),b(" ",e.editingShift==="new"?"Aggiungi Turno":"Salva Modifiche"," ")}}var _e=class o{settingsForm;loading=!1;loadingPhotos=!1;restaurantId=null;showShiftModal=!1;editingShift=null;currentSlotIndex=null;fullscreenPhoto=null;currentPhotoIndex=null;canManagePhotos=!1;paymentOptions=[{value:"cash",label:"Contanti"},{value:"credit_card",label:"Carta di credito"},{value:"debit_card",label:"Bancomat"},{value:"satispay",label:"Satispay"},{value:"paypal",label:"PayPal"}];foodOptions=[{value:"vegan",label:"Vegan"},{value:"gourmet",label:"Gourmet"},{value:"fish",label:"Pesce"},{value:"meat",label:"Carne"}];parkingOptions=[{value:"free_private",label:"Parcheggio privato gratuito"},{value:"paid_private",label:"Parcheggio privato a pagamento"},{value:"free_public",label:"Parcheggio pubblico gratuito"},{value:"paid_public",label:"Parcheggio pubblico a pagamento"},{value:"none",label:"Nessun parcheggio"}];cuisineOptions=[{value:"italian",label:"Italiana"},{value:"pizza",label:"Pizzeria"},{value:"chinese",label:"Cinese"},{value:"japanese",label:"Giapponese"},{value:"mediterranean",label:"Mediterranea"},{value:"vegan",label:"Vegan"},{value:"vegetarian",label:"Vegetariana"},{value:"gluten_free",label:"Senza glutine"},{value:"fish",label:"Pesce"},{value:"meat",label:"Carne"},{value:"gourmet",label:"Gourmet"}];shifts=[];photos=Array(8).fill(null);weekDays=["Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato","Domenica"];fileInput;fb=w(le);supabaseService=w(q);shiftService=w(ge);authService=w(X);restaurantService=w(pe);destroy$=new M;supabaseClient=this.supabaseService.getSupabaseClient();autoSaveTrigger=new M;currentShift=this.createEmptyShift();showDeleteRestaurantConfirm=!1;deleteRestaurantLoading=!1;deleteRestaurantError="";ngOnInit(){this.initForm(),this.setupSubscriptions(),this.loadInitialData()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initForm(){this.settingsForm=this.fb.group({accepts_delivery:[!1],accepts_takeaway:[!1],allow_table_selection:[!1],is_active:[!0],additional_info:this.fb.group({parking:[""],accepted_payments:[[]],wifi:this.fb.group({ssid:[""],password:[""]}),food_info:this.fb.group({vegan:[!1],gourmet:[!1],fish:[!1],meat:[!1]}),cuisine_types:[[]]})})}setupSubscriptions(){this.shiftService.data$.pipe(R(this.destroy$)).subscribe(t=>{this.shifts=t}),this.settingsForm.valueChanges.pipe(R(this.destroy$),T(1500),O(()=>this.settingsForm.valid&&!!this.restaurantId)).subscribe(()=>this.autoSaveChanges()),this.autoSaveTrigger.pipe(R(this.destroy$),T(1e3),O(()=>!!this.restaurantId)).subscribe(()=>this.autoSaveChanges())}triggerAutoSave(){this.autoSaveTrigger.next()}loadInitialData(){return v(this,null,function*(){this.loading=!0;try{if(this.restaurantId=yield this.restaurantService.getCurrentRestaurantId(),!this.restaurantId)throw new Error("Nessun ristorante associato all'utente");yield this.loadRestaurantData(),yield this.shiftService.loadData(),this.canManagePhotos=this.authService.hasPermission("manage_restaurant_settings"),this.canManagePhotos&&(yield this.loadRestaurantPhotos())}catch(t){console.error("Errore caricamento iniziale:",t),alert("Errore durante il caricamento dei dati: "+t.message)}finally{this.loading=!1}})}loadRestaurantData(){return v(this,null,function*(){let t=yield this.restaurantService.loadCurrentRestaurant();if(!t)throw new Error("Ristorante non trovato");this.settingsForm.patchValue({accepts_delivery:t.accepts_delivery,accepts_takeaway:t.accepts_takeaway,allow_table_selection:t.allow_table_selection,is_active:t.is_active,additional_info:{parking:t.additional_info?.parking||"",accepted_payments:t.additional_info?.accepted_payments||[],wifi:t.additional_info?.wifi||{ssid:"",password:""},food_info:t.additional_info?.food_info||{vegan:!1,gourmet:!1,fish:!1,meat:!1},cuisine_types:t.additional_info?.cuisine_types||[]}})})}loadRestaurantPhotos(){return v(this,null,function*(){if(this.restaurantId){this.loadingPhotos=!0;try{let t=yield this.supabaseService.getRestaurantPhotos(this.restaurantId);this.photos=Array(8).fill(null),t.forEach(e=>{let n=e.display_order-1;if(n>=0&&n<8){if(!e.url&&e.file_path){let{data:{publicUrl:i}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(e.file_path);e.url=i}this.photos[n]=e}})}catch(t){console.error("Errore caricamento foto:",t)}finally{this.loadingPhotos=!1}}})}autoSaveChanges(){return v(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId))try{yield this.saveFormData(),console.log("\u2705 Salvataggio automatico completato")}catch(t){console.error("\u274C Errore salvataggio automatico:",t)}})}onSubmit(){return v(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId)){this.loading=!0;try{yield this.saveFormData(),alert("Impostazioni salvate con successo!")}catch(t){console.error("\u274C Errore salvataggio:",t),alert("Errore durante il salvataggio: "+t.message)}finally{this.loading=!1}}})}saveFormData(){return v(this,null,function*(){let t=this.settingsForm.value;yield this.restaurantService.updateRestaurant(this.restaurantId,{accepts_delivery:t.accepts_delivery,accepts_takeaway:t.accepts_takeaway,allow_table_selection:t.allow_table_selection,is_active:t.is_active,additional_info:t.additional_info})})}createEmptyShift(){return{name:"",start_time:"12:00",end_time:"15:00",days_of_week:[1,2,3,4,5,6,7],is_active:!0}}addNewShift(){this.editingShift="new",this.currentShift=this.createEmptyShift(),this.showShiftModal=!0}editShift(t){this.editingShift=t;let e=this.shifts[t];this.currentShift={name:e.name,start_time:e.start_time,end_time:e.end_time,days_of_week:[...e.days_of_week],is_active:e.is_active},this.showShiftModal=!0}saveShift(){return v(this,null,function*(){if(!(!this.isCurrentShiftValid()||!this.restaurantId)){this.loading=!0;try{if(this.editingShift==="new"){if(!(yield this.shiftService.create(this.currentShift)))throw new Error("Creazione fallita");alert("Turno creato con successo!")}else if(typeof this.editingShift=="number"){let t=this.shifts[this.editingShift].id;if(!(yield this.shiftService.update(t,this.currentShift)))throw new Error("Aggiornamento fallito");alert("Turno aggiornato con successo!")}this.closeShiftModal()}catch(t){alert("Errore salvataggio turno: "+t.message),console.error(t)}finally{this.loading=!1}}})}deleteShift(t){return v(this,null,function*(){if(!confirm("Sei sicuro di voler eliminare questo turno?"))return;let e=this.shifts[t].id;if(e){this.loading=!0;try{if(!(yield this.shiftService.delete(e)))throw new Error("Eliminazione fallita");alert("Turno eliminato con successo!")}catch(n){alert("Errore eliminazione turno: "+n.message),console.error(n)}finally{this.loading=!1}}})}toggleShiftActive(t){return v(this,null,function*(){let e=this.shifts[t],n=!e.is_active;if(confirm(`Sei sicuro di voler ${n?"attivare":"disattivare"} il turno "${e.name}"?`)){this.loading=!0;try{if(!(yield this.shiftService.update(e.id,{is_active:n})))throw new Error("Operazione fallita");alert(`Turno "${e.name}" ${n?"attivato":"disattivato"} con successo!`)}catch(i){alert(`Errore: ${i.message}`),console.error(i)}finally{this.loading=!1}}})}isCurrentShiftValid(){return!!(this.currentShift?.name&&this.currentShift?.start_time&&this.currentShift?.end_time&&this.currentShift?.days_of_week?.length>0)}closeShiftModal(){this.showShiftModal=!1,this.editingShift=null}toggleCurrentShiftDay(t,e){let n=e.target.checked,i=t+1;n?this.currentShift.days_of_week.includes(i)||this.currentShift.days_of_week.push(i):this.currentShift.days_of_week=this.currentShift.days_of_week.filter(c=>c!==i)}isDaySelected(t,e){return t.includes(e+1)}triggerFileInput(t){this.currentSlotIndex=t,this.fileInput.nativeElement.click()}onPhotoFileSelected(t){let e=t.target;if(!e.files?.length||this.currentSlotIndex===null||!this.restaurantId)return;let n=e.files[0],i=this.currentSlotIndex;this.currentSlotIndex=null,e.value="",this.onPhotoFileSelect(n,i)}onPhotoFileSelect(t,e){return v(this,null,function*(){if(this.restaurantId){if(t.size>10*1024*1024){alert("File troppo grande (max 10MB)");return}if(!t.type.startsWith("image/")){alert("Solo file immagine sono permessi");return}this.loadingPhotos=!0;try{let n=e+1,i=yield this.supabaseService.uploadRestaurantPhoto(this.restaurantId,t,n);if(!i)throw new Error("Upload fallito");let c=yield this.supabaseService.saveRestaurantPhotoRecord({restaurant_id:this.restaurantId,file_path:i.filePath,display_order:n});if(!c)throw new Error("Salvataggio record fallito");this.photos[e]=A(N({},c),{url:i.publicUrl}),this.triggerAutoSave(),alert(`Foto ${n} caricata con successo!`)}catch(n){console.error("Errore upload foto:",n),alert("Errore durante l'upload: "+n.message)}finally{this.loadingPhotos=!1}}})}deletePhoto(t){return v(this,null,function*(){if(!this.restaurantId)return;let e=this.photos[t];if(!(!e||!confirm("Sei sicuro di voler eliminare questa foto?"))){this.loadingPhotos=!0;try{yield this.supabaseService.deleteRestaurantPhoto(e.id,e.file_path),this.photos[t]=null,this.triggerAutoSave(),alert("Foto eliminata con successo!")}catch(n){console.error("Errore eliminazione foto:",n),alert("Errore durante l'eliminazione: "+n.message)}finally{this.loadingPhotos=!1}}})}onPhotoOrderChange(t,e){return v(this,null,function*(){let n=e.target,i=Number(n.value);if(i<1||i>8){alert("Ordine non valido. Deve essere tra 1 e 8.");let S=this.photos[t];S&&(n.value=S.display_order.toString());return}let c=this.photos[t];if(!c){alert("Nessuna foto in questo slot");return}if(c.display_order===i)return;let x=c.display_order;try{this.loadingPhotos=!0;let S=this.photos.find(D=>D&&D.display_order===i);S?(yield Promise.all([this.supabaseService.updatePhotoOrder(c.id,i),this.supabaseService.updatePhotoOrder(S.id,x)]),c.display_order=i,S.display_order=x):(yield this.supabaseService.updatePhotoOrder(c.id,i),c.display_order=i),this.reorganizePhotosByOrder(),this.triggerAutoSave(),console.log("\u2705 Ordine aggiornato")}catch(S){console.error("\u274C Errore aggiornamento ordine:",S),alert("Errore durante l'aggiornamento: "+S.message),n.value=x.toString(),c.display_order=x}finally{this.loadingPhotos=!1}})}reorganizePhotosByOrder(){let t=this.photos.filter(n=>n!==null).sort((n,i)=>n.display_order-i.display_order),e=Array(8).fill(null);t.forEach(n=>{let i=n.display_order-1;i>=0&&i<8&&(e[i]=n)}),this.photos=e}openPhoto(t,e){t?.url&&(this.fullscreenPhoto=t.url,this.currentPhotoIndex=e)}closeFullscreenPhoto(){this.fullscreenPhoto=null,this.currentPhotoIndex=null}navigateFullscreenPhoto(t){if(this.currentPhotoIndex===null||!this.photos)return;let e=t==="next"?this.currentPhotoIndex+1:this.currentPhotoIndex-1;e<0&&(e=this.photos.length-1),e>=this.photos.length&&(e=0);let n=!1,i=0;for(;!n&&i<this.photos.length;){let c=this.photos[e];c?.url?(this.fullscreenPhoto=c.url,this.currentPhotoIndex=e,n=!0):(e=t==="next"?e+1:e-1,e<0&&(e=this.photos.length-1),e>=this.photos.length&&(e=0),i++)}}onImageError(t,e){let n=t.target;console.error(`Errore caricamento immagine slot ${e}:`,n.src),n.style.display="none";let i=n.parentElement;if(i){let c=document.createElement("div");c.className="error-placeholder",c.style.cssText="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: var(--danger); font-size: 12px;",c.textContent="Errore caricamento",i.appendChild(c)}}get loadedPhotosCount(){return this.photos.filter(t=>t!==null).length}get hasMultiplePhotos(){return this.loadedPhotosCount>1}trackByIndex(t){return t}toggleRestaurantActive(){return v(this,null,function*(){if(!this.restaurantId)return;let t=this.settingsForm.get("is_active")?.value,e=!t;if(!t&&!confirm(`Sei sicuro di voler disattivare il ristorante?

I clienti non potranno pi\xF9 vederlo n\xE9 effettuare ordini. L'account verr\xE0 eliminato automaticamente dopo 24 mesi di inattivit\xE0.`)){this.settingsForm.patchValue({is_active:e},{emitEvent:!1});return}this.loading=!0;try{yield this.restaurantService.updateRestaurant(this.restaurantId,{is_active:t,deactivated_at:t?null:new Date().toISOString()}),this.triggerAutoSave(),alert(t?"Ristorante riattivato! Ora \xE8 visibile ai clienti.":"Ristorante disattivato correttamente.")}catch(n){alert("Errore: "+n.message),this.settingsForm.patchValue({is_active:e},{emitEvent:!1})}finally{this.loading=!1}})}togglePayment(t){let e=this.settingsForm.get("additional_info.accepted_payments")?.value||[],n=t.target.value;if(t.target.checked)e.includes(n)||e.push(n);else{let i=e.indexOf(n);i>-1&&e.splice(i,1)}this.settingsForm.get("additional_info.accepted_payments")?.setValue(e)}isPaymentSelected(t){let e=this.settingsForm.get("additional_info.accepted_payments")?.value;return e?e.includes(t):!1}toggleCuisine(t){let e=this.settingsForm.get("additional_info.cuisine_types")?.value||[],n=t.target.value;if(t.target.checked)e.includes(n)||e.push(n);else{let i=e.indexOf(n);i>-1&&e.splice(i,1)}this.settingsForm.get("additional_info.cuisine_types")?.setValue(e)}isCuisineSelected(t){let e=this.settingsForm.get("additional_info.cuisine_types")?.value;return e?e.includes(t):!1}confirmDeleteRestaurant(){return v(this,null,function*(){if(this.restaurantId){this.deleteRestaurantLoading=!0,this.deleteRestaurantError="";try{let t=yield this.authService.deleteRestaurant(this.restaurantId);if(!t.success){this.deleteRestaurantError=t.error||"Errore durante l'eliminazione";return}}catch(t){this.deleteRestaurantError=t.message||"Errore sconosciuto"}finally{this.deleteRestaurantLoading=!1,this.showDeleteRestaurantConfirm=!1}}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=j({type:o,selectors:[["app-restaurant-settings"]],viewQuery:function(e,n){if(e&1&&L(fe,5),e&2){let i;$(i=G())&&(n.fileInput=i.first)}},decls:103,vars:16,consts:[["fileInput",""],[1,"page-container"],[1,"flex","flex-col","gap-sm",3,"ngSubmit","formGroup"],[1,"form-card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-md"],[1,"text-md","font-semibold","m-0"],[1,"grid-cards"],[1,"checkbox-label"],[1,"checkbox-grid"],["type","checkbox","formControlName","accepts_delivery"],[1,"checkbox-content"],[1,"text-muted"],["type","checkbox","formControlName","accepts_takeaway"],["type","checkbox","formControlName","allow_table_selection"],["formGroupName","additional_info",1,"form-card"],[1,"form-group"],[1,"standard-label"],["formControlName","parking",1,"form-input"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","mt-lg"],[1,"flex","flex-wrap","gap-lg"],["class","checkbox-label",4,"ngFor","ngForOf"],["formGroupName","wifi",1,"mt-lg"],[1,"form-row"],["type","text","formControlName","ssid","placeholder","Nome rete (SSID)",1,"form-input"],["type","text","formControlName","password","placeholder","Password",1,"form-input"],["formGroupName","food_info","class","mb-md",4,"ngIf"],["type","checkbox","formControlName","is_active",3,"change"],[1,"flex","flex-col","gap-md"],["class","shift-item",4,"ngFor","ngForOf"],["type","button","class","promethea-button ghost",3,"click",4,"ngIf"],["class","form-card",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-footer","p-sm"],["type","submit",1,"promethea-button",3,"disabled"],["name","refresh-cw",4,"ngIf"],["name","save",4,"ngIf"],[4,"ngIf"],[1,"modal-footer","mt-lg","p-sm"],[1,"danger-item"],[1,"promethea-button","outline",3,"click"],["name","trash-2"],["class","modal-overlay",4,"ngIf"],[3,"value"],["type","checkbox",3,"change","value","checked"],["formGroupName","food_info",1,"mb-md"],["type","checkbox",3,"formControlName"],[1,"shift-item"],[1,"flex","justify-between","items-start","mb-sm","p-sm"],[1,"flex","flex-col","gap-sm"],[1,"font-semibold"],[1,"flex","flex-wrap","gap-sm"],[1,"chip"],[1,"material-icons","text-sm"],[1,"flex","gap-sm"],["type","button",1,"icon-button",3,"click","title"],[1,"material-icons"],["type","button","title","Modifica turno",1,"icon-button",3,"click"],["type","button","class","icon-button","title","Elimina turno",3,"click",4,"ngIf"],[1,"flex","flex-wrap","gap-sm","mt-sm","p-sm0"],["class","chip",3,"active","warning",4,"ngFor","ngForOf"],["type","button","title","Elimina turno",1,"icon-button",3,"click"],["name","trash-2",3,"size"],["type","button",1,"promethea-button","ghost",3,"click"],["name","plus",3,"size"],[1,"text-muted","mb-md"],["type","file","accept","image/*",2,"display","none",3,"change","disabled"],[1,"gallery-container"],["class","card",4,"ngFor","ngForOf","ngForTrackBy"],["style","position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center;",4,"ngIf"],[1,"card"],[1,"flex","flex-wrap","justify-between","items-center","mb-sm"],["class","order-selector flex items-center gap-sm",4,"ngIf"],[1,"photo-preview","rounded-lg","border","transition","cursor-pointer","mb-sm",2,"min-height","150px","display","flex","align-items","center","justify-content","center","overflow","hidden","position","relative",3,"click"],["class","w-full h-full",4,"ngIf"],["class","empty-photo-slot flex flex-col items-center justify-center p-md",4,"ngIf"],[1,"card-footer","gap-sm"],["type","button",1,"icon-button","x-small",3,"click","title","disabled"],["type","button","class","icon-button x-small","title","Elimina foto","style","color: var(--primary);",3,"disabled","click",4,"ngIf"],[1,"order-selector","flex","items-center","gap-sm"],[1,"text-mini"],[1,"text-mini",3,"change","disabled"],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],[1,"w-full","h-full"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"error","src","alt"],[1,"photo-hover-overlay"],[1,"empty-photo-slot","flex","flex-col","items-center","justify-center","p-md"],[1,"material-icons","empty-icon",2,"font-size","48px","color","var(--smoke-3)","margin-bottom","8px"],[1,"text-sm","text-muted"],["type","button","title","Elimina foto",1,"icon-button","x-small",2,"color","var(--primary)",3,"click","disabled"],[2,"position","absolute","top","0","left","0","right","0","bottom","0","background","rgba(255,255,255,0.9)","z-index","10","display","flex","flex-direction","column","align-items","center","justify-content","center"],[1,"spinner",2,"width","40px","height","40px","border","3px solid var(--smoke-1)","border-top-color","var(--primary)","border-radius","50%","animation","spin 1s linear infinite","margin-bottom","var(--gap-sm)"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"text-md","font-semibold","m-0","flex","items-center","gap-sm"],[1,"icon-button",3,"click"],[1,"modal-content","p-lg","flex","items-center","justify-center",2,"min-height","60vh"],[2,"position","relative","width","100%","height","100%","display","flex","align-items","center","justify-content","center"],["style","position: absolute; left: 0; z-index: 20; background: var(--smoke-2); margin: 0 var(--gap-sm);","class","icon-button",3,"click",4,"ngIf"],[2,"max-width","64rem","max-height","70vh","display","flex","align-items","center","justify-content","center"],[2,"max-width","100%","max-height","70vh","object-fit","contain","border-radius","12px",3,"src","alt"],["style","position: absolute; right: 0; z-index: 20; background: var(--smoke-2); margin: 0 var(--gap-sm);","class","icon-button",3,"click",4,"ngIf"],["style","position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 0.25rem 1rem; border-radius: 999px; font-size: 0.875rem;",4,"ngIf"],[1,"icon-button",2,"position","absolute","left","0","z-index","20","background","var(--smoke-2)","margin","0 var(--gap-sm)",3,"click"],[1,"icon-button",2,"position","absolute","right","0","z-index","20","background","var(--smoke-2)","margin","0 var(--gap-sm)",3,"click"],[2,"position","absolute","bottom","1rem","left","50%","transform","translateX(-50%)","background","rgba(0,0,0,0.7)","color","white","padding","0.25rem 1rem","border-radius","999px","font-size","0.875rem"],["name","refresh-cw"],["name","save"],[1,"modal-overlay"],[1,"modal-container","modal-md"],[1,"flex","items-center","gap-md"],["name","triangle-alert"],[1,"section-title","m-0"],[1,"icon-button",3,"click","disabled"],["name","x"],[1,"form-card","mt-lg"],[2,"line-height","1.4"],["class","error-msg",4,"ngIf"],[1,"modal-footer"],[1,"promethea-button",3,"click","disabled"],[1,"promethea-button","outline",3,"click","disabled"],[1,"error-msg"],[1,"modal-container",3,"click"],[1,"modal-content"],[1,"form-row","mb-md"],["type","text","placeholder","Es: Pranzo, Cena","autofocus","",3,"ngModelChange","ngModel","ngModelOptions"],["type","time",3,"ngModelChange","ngModel","ngModelOptions"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],["type","button",1,"promethea-button",3,"click","disabled"],["type","checkbox",3,"change","checked"]],template:function(e,n){e&1&&(a(0,"div",1)(1,"form",2),g("ngSubmit",function(){return n.onSubmit()}),a(2,"div",3)(3,"div",4)(4,"span",5),s(5,"room_service"),r(),a(6,"h2",6),s(7,"Servizi Offerti"),r()(),a(8,"div",7)(9,"label",8)(10,"div",9),f(11,"input",10),r(),a(12,"div",11)(13,"strong"),s(14,"Consegna a domicilio"),r(),a(15,"div",12),s(16,"I clienti possono ordinare con consegna"),r()()(),a(17,"label",8)(18,"div",9),f(19,"input",13),r(),a(20,"div",11)(21,"strong"),s(22,"Asporto"),r(),a(23,"div",12),s(24,"I clienti possono ritirare in loco"),r()()(),a(25,"label",8)(26,"div",9),f(27,"input",14),r(),a(28,"div",11)(29,"strong"),s(30,"Prenotazione tavolo"),r(),a(31,"div",12),s(32,"I clienti possono scegliere il tavolo"),r()()()()(),a(33,"div",15)(34,"div",4)(35,"span",5),s(36,"info"),r(),a(37,"h2",6),s(38,"Informazioni Aggiuntive"),r()(),a(39,"div",16)(40,"label",17),s(41,"Parcheggio"),r(),a(42,"select",18)(43,"option",19),s(44,"Seleziona un'opzione"),r(),_(45,ve,2,2,"option",20),r()(),a(46,"div",21)(47,"label",17),s(48,"Pagamenti accettati"),r(),a(49,"div",22),_(50,xe,4,3,"label",23),r()(),a(51,"div",24)(52,"label",17),s(53,"WiFi"),r(),a(54,"div",25)(55,"div",16),f(56,"input",26),r(),a(57,"div",16),f(58,"input",27),r()()(),a(59,"div",21)(60,"label",17),s(61,"Tipi di cucina"),r(),a(62,"div",22),_(63,Se,4,3,"label",23),r()(),_(64,ye,5,1,"div",28),r(),a(65,"div",3)(66,"div",4)(67,"span",5),s(68,"visibility"),r(),a(69,"h2",6),s(70,"Stato Ristorante"),r()(),a(71,"label",8)(72,"div",9)(73,"input",29),g("change",function(){return n.toggleRestaurantActive()}),r()(),a(74,"div",11)(75,"strong"),s(76,"Ristorante attivo"),r(),a(77,"div",12),s(78,"Visibile ai clienti e accettazione ordini"),r()()()(),a(79,"div",3)(80,"div",4)(81,"span",5),s(82,"schedule"),r(),a(83,"h2",6),s(84,"Turni di Lavoro"),r()(),a(85,"div",30),_(86,Ce,22,14,"div",31)(87,ke,3,1,"button",32),r()(),_(88,Fe,14,6,"div",33)(89,Ae,17,5,"div",34),a(90,"div",35)(91,"button",36),_(92,je,1,0,"lucide-angular",37)(93,Le,1,0,"lucide-angular",38)(94,$e,2,0,"span",39)(95,Ge,2,0,"span",39),r()()(),a(96,"div",40)(97,"div",41)(98,"button",42),g("click",function(){return n.showDeleteRestaurantConfirm=!0}),f(99,"lucide-angular",43),s(100," Elimina Account"),r()()(),_(101,We,21,5,"div",44),r(),_(102,He,54,16,"div",34)),e&2&&(l(),d("formGroup",n.settingsForm),l(44),d("ngForOf",n.parkingOptions),l(5),d("ngForOf",n.paymentOptions),l(13),d("ngForOf",n.cuisineOptions),l(),d("ngIf",!1),l(22),d("ngForOf",n.shifts),l(),d("ngIf",n.editingShift===null),l(),d("ngIf",n.canManagePhotos),l(),d("ngIf",n.fullscreenPhoto),l(2),d("disabled",n.loading||n.settingsForm.invalid),l(),d("ngIf",n.loading),l(),d("ngIf",!n.loading),l(),d("ngIf",n.loading),l(),d("ngIf",!n.loading),l(6),d("ngIf",n.showDeleteRestaurantConfirm),l(),d("ngIf",n.showShiftModal))},dependencies:[Q,U,H,de,te,oe,se,K,J,re,Y,Z,ie,ae,ne,ce,ee,me,ue],styles:[".shift-item[_ngcontent-%COMP%]{padding:var(--gap-md);border:1px solid var(--smoke-1);border-radius:12px;transition:all .2s ease}.shift-item[_ngcontent-%COMP%]:hover{border-color:var(--secondary);background:var(--smoke-1)}.shift-form[_ngcontent-%COMP%]{border:2px solid var(--smoke-2)}.text-green-500[_ngcontent-%COMP%]{color:#10b981}.text-orange-500[_ngcontent-%COMP%]{color:#f59e0b}.material-icons[_ngcontent-%COMP%]{transition:all .2s ease}@media (max-width: 768px){.shift-item[_ngcontent-%COMP%]{padding:var(--gap-sm)}.shift-item[_ngcontent-%COMP%]   .flex-wrap[_ngcontent-%COMP%]{justify-content:flex-start}}@media (max-width: 480px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr}.md\\\\[_ngcontent-%COMP%]:col-span-2{grid-column:1}}.gallery-container[_ngcontent-%COMP%]{position:relative;min-height:300px}.photo-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.photo-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;border-radius:8px}.photo-hover-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease;border-radius:8px;pointer-events:none}.photo-preview[_ngcontent-%COMP%]:hover   .photo-hover-overlay[_ngcontent-%COMP%]{opacity:1}.photo-hover-overlay[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#fff;font-size:2rem}.empty-photo-slot[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-muted);padding:var(--gap-lg)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:var(--gap-sm);opacity:.5}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--smoke-1);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:var(--gap-sm)}.nav-button[_ngcontent-%COMP%]{background:var(--smoke-2);margin:0 var(--gap-sm)}.nav-button[_ngcontent-%COMP%]:hover{background:var(--smoke-3)}.photo-counter[_ngcontent-%COMP%]{background:#000000b3;color:#fff;padding:.25rem 1rem;border-radius:999px;font-size:.875rem}@media (max-width: 768px){.grid-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))!important}.photo-preview[_ngcontent-%COMP%]{min-height:120px!important}}"]})};export{_e as RestaurantSettings};
