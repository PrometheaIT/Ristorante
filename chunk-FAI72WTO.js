import{a as le}from"./chunk-22SFZFZY.js";import{a as ce}from"./chunk-DFE35UP3.js";import{a as de}from"./chunk-QU72IQ5W.js";import{a as me,b as P}from"./chunk-XF5Z2PX3.js";import"./chunk-NYWNQENH.js";import"./chunk-QUTFIOET.js";import"./chunk-SVYAZSVR.js";import{qb as re,rb as oe}from"./chunk-7ARAJ5DM.js";import{a as se}from"./chunk-FM7IHZ3K.js";import{A as ne,b as G,d as J,i as K,s as ee,t as te,u as ie,x as ae}from"./chunk-YO2SNT5L.js";import{d as X}from"./chunk-MEEOFM4U.js";import{c as H,e as Y}from"./chunk-RD7WPZ3N.js";import"./chunk-JDHQCX3C.js";import{k as $,l as j,p as B,v as Q}from"./chunk-RJWLMJIA.js";import{Eb as L,Fb as A,Gb as q,Ia as D,Ib as r,Jb as M,Kb as g,La as l,Lb as V,Mb as W,Ob as w,Pb as R,Qb as y,Sb as N,Va as I,Vb as U,Wb as Z,_a as _,a as E,ca as f,gb as d,hb as T,ib as z,jb as O,kb as F,la as u,ma as p,qb as i,rb as a,s as C,sb as x,t as k,vb as h,yb as v,zb as c}from"./chunk-KIAVC6JW.js";import{g as b}from"./chunk-RA2WU32H.js";var pe=["floorPlanCanvas"],ve=()=>[1,2,3,4,5,6,7,8];function _e(s,t){if(s&1){let e=h();i(0,"button",45),v("click",function(){u(e);let n=c(2);return p(n.authService.toggleSidebar())}),x(1,"lucide-icon",46),a()}}function ge(s,t){if(s&1&&x(0,"img",47),s&2){let e=c(2);d("src",e.restaurant.logo_url,D)("alt",e.restaurant.name)}}function be(s,t){s&1&&(i(0,"span",12),r(1,"restaurant"),a())}function fe(s,t){if(s&1&&(i(0,"p",48),r(1),a()),s&2){let e=c(2);l(),g(" ",e.restaurant.additional_info==null||e.restaurant.additional_info.cuisine_types==null?null:e.restaurant.additional_info.cuisine_types.join(", ")," ")}}function he(s,t){if(s&1&&(i(0,"div",37)(1,"div",33),_(2,_e,2,0,"button",38),U(3,"async"),i(4,"div",39),_(5,ge,1,2,"img",40)(6,be,2,0,"span",41),a(),i(7,"div",42)(8,"h1",43),r(9),a(),_(10,fe,2,1,"p",44),a()()()),s&2){let e=c();T("background",e.restaurant.cover_image_url?"url("+e.restaurant.cover_image_url+")":"var(--vetro)"),l(2),d("ngIf",Z(3,7,e.showToggle$)),l(3),d("ngIf",e.restaurant.logo_url),l(),d("ngIf",!e.restaurant.logo_url),l(3),M(e.restaurant.name),l(),d("ngIf",e.restaurant.additional_info==null?null:e.restaurant.additional_info.cuisine_types)}}function xe(s,t){if(s&1&&(i(0,"p",56),r(1),a()),s&2){let e=c(3);l(),g(" ",e.restaurant.description," ")}}function we(s,t){if(s&1&&(i(0,"span",59)(1,"span",32),r(2,"place"),a(),r(3),a()),s&2){let e=c(3);l(3),g(" ",e.restaurant.address," ")}}function Re(s,t){if(s&1&&(i(0,"span",59)(1,"span",32),r(2,"phone"),a(),r(3),a()),s&2){let e=c(3);l(3),g(" ",e.restaurant.phone," ")}}function ye(s,t){if(s&1&&(i(0,"div",56),_(1,xe,2,1,"p",50),i(2,"div",57),_(3,we,4,1,"span",58)(4,Re,4,1,"span",58),a()()),s&2){let e=c(2);l(),d("ngIf",e.restaurant.description),l(2),d("ngIf",e.restaurant.address),l(),d("ngIf",e.restaurant.phone)}}function Me(s,t){if(s&1&&(i(0,"span",63),r(1),a()),s&2){let e=c(3);l(),g(" (",e.tables.length," tavoli) ")}}function Se(s,t){if(s&1&&(i(0,"span",63),r(1),a()),s&2){let e=c().$implicit;l(),g(" (",e.name==="Sala Grande"?"7":e.name==="Sala Piccola"?"5":"6"," tavoli) ")}}function Te(s,t){if(s&1){let e=h();i(0,"div",60),v("click",function(){let n=u(e).$implicit,m=c(2);return p(m.selectFloorPlan(n))}),i(1,"span",12),r(2,"location_on"),a(),i(3,"div",51)(4,"span",61),r(5),a(),_(6,Me,2,1,"span",62)(7,Se,2,1,"span",62),a()()}if(s&2){let e=t.$implicit,o=c(2);z("selected",(o.currentFloorPlan==null?null:o.currentFloorPlan.id)===e.id),l(5),M(e.name),l(),d("ngIf",e.id===(o.currentFloorPlan==null?null:o.currentFloorPlan.id)),l(),d("ngIf",e.id!==(o.currentFloorPlan==null?null:o.currentFloorPlan.id))}}function Ce(s,t){if(s&1&&(i(0,"div",49),_(1,ye,5,3,"div",50),i(2,"div",51)(3,"div",52)(4,"span",7),r(5,"map"),a(),i(6,"h3",53),r(7,"Seleziona Area"),a()(),i(8,"div",54),_(9,Te,8,5,"div",55),a()()()),s&2){let e=c();l(),d("ngIf",e.restaurant),l(8),d("ngForOf",e.floorPlans)}}function Ve(s,t){s&1&&(i(0,"div",69)(1,"span",12),r(2,"event_busy"),a()())}function Pe(s,t){if(s&1){let e=h();i(0,"div",64),v("click",function(){let n=u(e).$implicit,m=c();return p(m.onTableClick(n))}),i(1,"div",65)(2,"div",66),r(3),a(),i(4,"div",67),r(5),a(),_(6,Ve,3,0,"div",68),a()()}if(s&2){let e=t.$implicit,o=c();O(o.getTableStyle(e)),F(o.getTableClass(e)),d("title",o.getTableTooltip(e)),l(3),M(e.table_number),l(2),g("",e.capacity," p"),l(),d("ngIf",o.isTableReserved(e))}}function Ee(s,t){s&1&&(i(0,"div",70)(1,"div",71)(2,"span",12),r(3,"table_restaurant"),a(),i(4,"h4",72),r(5,"Nessun tavolo configurato"),a(),i(6,"p",48),r(7,"Il ristorante non ha ancora configurato i tavoli per questa area"),a()()())}function ke(s,t){s&1&&(i(0,"div",90)(1,"span",12),r(2,"event_busy"),a(),i(3,"div",51)(4,"span",15),r(5,"Tavolo Prenotato"),a(),i(6,"span",34),r(7," Questo tavolo \xE8 gi\xE0 prenotato per l'orario selezionato "),a()()())}function De(s,t){s&1&&(i(0,"div",90)(1,"span",12),r(2,"event_available"),a(),i(3,"div",51)(4,"span",15),r(5,"Disponibile"),a(),i(6,"span",34),r(7," Tavolo disponibile per la prenotazione "),a()()())}function Ie(s,t){s&1&&(i(0,"div",90)(1,"span",12),r(2,"block"),a(),i(3,"div",51)(4,"span",15),r(5,"Non prenotabile online"),a(),i(6,"span",34),r(7," Questo tavolo non \xE8 prenotabile online "),a()()())}function ze(s,t){if(s&1){let e=h();i(0,"div",73),v("click",function(){u(e);let n=c();return p(n.deselectTable())}),i(1,"div",74),v("click",function(n){return u(e),p(n.stopPropagation())}),i(2,"div",75)(3,"div",33)(4,"span",12),r(5,"table_restaurant"),a(),i(6,"h3",76),r(7),a()(),i(8,"button",77),v("click",function(){u(e);let n=c();return p(n.deselectTable())}),i(9,"span",12),r(10,"close"),a()()(),i(11,"div",78)(12,"div",79)(13,"div",80)(14,"label",81),r(15,"Capacit\xE0"),a(),i(16,"div",82)(17,"span",83),r(18),a(),i(19,"span",63),r(20,"persone"),a()()(),i(21,"div",80)(22,"label",81),r(23,"Nome Tavolo"),a(),i(24,"div",84),r(25),a()(),i(26,"div",80)(27,"label",81),r(28,"Forma"),a(),i(29,"div",85),r(30),a()()(),_(31,ke,8,0,"div",86)(32,De,8,0,"div",86)(33,Ie,8,0,"div",86),a(),i(34,"div",87)(35,"button",88),v("click",function(){u(e);let n=c();return p(n.deselectTable())}),i(36,"span",12),r(37,"close"),a(),i(38,"span"),r(39,"Chiudi"),a()(),i(40,"button",89),v("click",function(){u(e);let n=c();return p(n.openReservationModal())}),i(41,"span",12),r(42,"event_available"),a(),i(43,"span"),r(44,"Prenota Questo Tavolo"),a()()()()()}if(s&2){let e=c();l(7),g("Tavolo ",e.selectedTable.table_number,""),l(11),M(e.selectedTable.capacity),l(7),g(" ",e.selectedTable.table_name||"N/D"," "),l(5),g(" ",e.selectedTable.shape," "),l(),d("ngIf",e.isTableReserved(e.selectedTable)),l(),d("ngIf",!e.isTableReserved(e.selectedTable)&&e.selectedTable.is_online_bookable),l(),d("ngIf",!e.selectedTable.is_online_bookable),l(7),d("disabled",e.isTableReserved(e.selectedTable)||!e.selectedTable.is_online_bookable)}}function Oe(s,t){if(s&1&&(i(0,"div",90)(1,"span",12),r(2,"table_restaurant"),a(),i(3,"span"),r(4,"Stai prenotando: "),i(5,"strong"),r(6),a(),r(7),a()()),s&2){let e=c(2);l(6),g("Tavolo ",e.selectedTable.table_number,""),l(),g(" (",e.selectedTable.capacity," persone)")}}function Fe(s,t){if(s&1&&(i(0,"option",107),r(1),a()),s&2){let e=t.$implicit;d("value",e),l(),g(" ",e," ")}}function Le(s,t){if(s&1&&(i(0,"option",108),r(1),a()),s&2){let e=t.$implicit,o=c(2);d("value",e)("disabled",o.selectedTable?e>o.selectedTable.capacity:!1),l(),V(" ",e," ",e===1?"persona":"persone"," ")}}function Ae(s,t){s&1&&(i(0,"div",111)(1,"span",12),r(2,"check_circle"),a(),i(3,"span"),r(4,"Tavolo disponibile per la data e ora selezionate"),a()())}function qe(s,t){s&1&&(i(0,"div",112)(1,"span",12),r(2,"error"),a(),i(3,"span"),r(4,"Tavolo non disponibile per la data e ora selezionate"),a()())}function We(s,t){if(s&1&&(i(0,"div",109),_(1,Ae,5,0,"div",103)(2,qe,5,0,"div",110),a()),s&2){let e=c(2);l(),d("ngIf",e.isTableAvailable),l(),d("ngIf",!e.isTableAvailable)}}function Ne(s,t){if(s&1){let e=h();i(0,"div",113)(1,"h3",114),r(2,"Dati Cliente"),a(),i(3,"div",95)(4,"div",80)(5,"label",81),r(6,"Nome *"),a(),i(7,"input",115),y("ngModelChange",function(n){u(e);let m=c(2);return R(m.restaurantReservationData.customer_name,n)||(m.restaurantReservationData.customer_name=n),p(n)}),a()(),i(8,"div",80)(9,"label",81),r(10,"Telefono *"),a(),i(11,"input",116),y("ngModelChange",function(n){u(e);let m=c(2);return R(m.restaurantReservationData.customer_phone,n)||(m.restaurantReservationData.customer_phone=n),p(n)}),a()()(),i(12,"div",80)(13,"label",81),r(14,"Email (opzionale)"),a(),i(15,"input",117),y("ngModelChange",function(n){u(e);let m=c(2);return R(m.restaurantReservationData.customer_email,n)||(m.restaurantReservationData.customer_email=n),p(n)}),a()()()}if(s&2){let e=c(2);l(7),w("ngModel",e.restaurantReservationData.customer_name),l(4),w("ngModel",e.restaurantReservationData.customer_phone),l(4),w("ngModel",e.restaurantReservationData.customer_email)}}function Ue(s,t){if(s&1&&(i(0,"div",111),x(1,"lucide-angular",118),i(2,"span"),r(3,"Prenotazione a nome di: "),i(4,"strong"),r(5),a()()()),s&2){let e=c(2);l(),d("size",20),l(4),V("",e.currentUser.user_metadata==null?null:e.currentUser.user_metadata.first_name," ",e.currentUser.user_metadata==null?null:e.currentUser.user_metadata.last_name,"")}}function Ze(s,t){s&1&&(i(0,"span",12),r(1,"refresh"),a())}function $e(s,t){if(s&1){let e=h();i(0,"div",91)(1,"div",92)(2,"div",75)(3,"h2",43)(4,"span",12),r(5,"event_available"),a(),r(6," Prenota Tavolo "),a(),i(7,"button",93),v("click",function(){u(e);let n=c();return p(n.closeReservationModal())}),i(8,"span",12),r(9,"close"),a()()(),i(10,"div",94),_(11,Oe,8,2,"div",86),i(12,"div",95)(13,"div",80)(14,"label",81),r(15,"Data *"),a(),i(16,"input",96),y("ngModelChange",function(n){u(e);let m=c();return R(m.customerReservationData.reservation_date,n)||(m.customerReservationData.reservation_date=n),p(n)}),v("change",function(){u(e);let n=c();return n.syncReservationData(),p(n.onDateChange())}),a()(),i(17,"div",80)(18,"label",81),r(19,"Ora *"),a(),i(20,"select",97),y("ngModelChange",function(n){u(e);let m=c();return R(m.customerReservationData.reservation_time,n)||(m.customerReservationData.reservation_time=n),p(n)}),v("change",function(){u(e);let n=c();return n.syncReservationData(),p(n.onTimeChange())}),i(21,"option",98),r(22,"Seleziona orario"),a(),_(23,Fe,2,2,"option",99),a()()(),i(24,"div",95)(25,"div",80)(26,"label",81),r(27,"Numero Persone *"),a(),i(28,"select",97),y("ngModelChange",function(n){u(e);let m=c();return R(m.customerReservationData.party_size,n)||(m.customerReservationData.party_size=n),p(n)}),v("change",function(){u(e);let n=c();return p(n.syncReservationData())}),_(29,Le,2,4,"option",100),a()()(),_(30,We,3,2,"div",101)(31,Ne,16,3,"div",102)(32,Ue,6,3,"div",103),i(33,"div",104)(34,"label",81),r(35,"Richieste Speciali"),a(),i(36,"textarea",105),y("ngModelChange",function(n){u(e);let m=c();return R(m.customerReservationData.special_requests,n)||(m.customerReservationData.special_requests=n),p(n)}),v("input",function(){u(e);let n=c();return p(n.syncReservationData())}),a()()(),i(37,"div",87)(38,"button",88),v("click",function(){u(e);let n=c();return p(n.closeReservationModal())}),r(39," Annulla "),a(),i(40,"button",106),v("click",function(){u(e);let n=c();return p(n.createReservation())}),_(41,Ze,2,0,"span",41),r(42," Conferma Prenotazione "),a()()()()}if(s&2){let e=c();l(11),d("ngIf",e.selectedTable),l(5),w("ngModel",e.customerReservationData.reservation_date),d("min",e.minDate),l(4),w("ngModel",e.customerReservationData.reservation_time),l(3),d("ngForOf",e.availableTimes),l(5),w("ngModel",e.customerReservationData.party_size),l(),d("ngForOf",N(13,ve)),l(),d("ngIf",e.availabilityChecked),l(),d("ngIf",!e.currentUser),l(),d("ngIf",e.currentUser),l(4),w("ngModel",e.customerReservationData.special_requests),l(4),d("disabled",!e.isTableAvailable||e.creatingReservation||!e.customerReservationData.reservation_date||!e.customerReservationData.reservation_time),l(),d("ngIf",e.creatingReservation)}}function je(s,t){if(s&1){let e=h();i(0,"div",73),v("click",function(){u(e);let n=c();return p(n.closeConfirmationModal())}),i(1,"div",74),v("click",function(n){return u(e),p(n.stopPropagation())}),i(2,"div",119)(3,"div",120)(4,"span",121),r(5,"check_circle"),a()(),i(6,"h3",122),r(7,"Prenotazione Confermata!"),a(),i(8,"p",123),r(9),a(),i(10,"div",124)(11,"div",125)(12,"strong"),r(13,"Numero prenotazione:"),a(),r(14),a(),i(15,"div",126)(16,"strong"),r(17,"Stato:"),a(),i(18,"span",127),r(19),a()()()(),i(20,"div",87)(21,"button",128),v("click",function(){u(e);let n=c();return p(n.closeConfirmationModal())}),i(22,"span",12),r(23,"done"),a(),r(24," Ok, Grazie "),a()()()()}if(s&2){let e=c();l(9),W(" La tua prenotazione per il tavolo ",e.lastReservation==null||e.lastReservation.tables==null?null:e.lastReservation.tables.table_number," \xE8 stata confermata per il ",e.formatDate(e.lastReservation==null?null:e.lastReservation.reservation_date)," alle ",e.lastReservation==null?null:e.lastReservation.reservation_time,". "),l(5),g(" ",e.lastReservation==null?null:e.lastReservation.id.slice(-8).toUpperCase()," "),l(5),M(e.lastReservation==null?null:e.lastReservation.status)}}var ue=class s{route=f(H);router=f(Y);floorPlanService=f(le);tableService=f(ce);reservationService=f(de);restaurantPublicService=f(se);authService=f(X);breakpointObserver=f(me);canvasRef;restaurant=null;floorPlans=[];currentFloorPlan=null;tables=[];reservations=[];selectedTable=null;showReservationModal=!1;showConfirmationModal=!1;creatingReservation=!1;customerReservationData={restaurant_id:"",table_id:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};restaurantReservationData={restaurant_id:"",customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:"",table_id:void 0,status:"pending"};zoomLevel=1;minZoom=.5;maxZoom=3;isDragging=!1;dragStart={x:0,y:0};canvasPosition={x:0,y:0};availableTimes=[];isTableAvailable=!1;availabilityChecked=!1;currentUser=null;lastReservation=null;minDate;today;isMobile$=this.breakpointObserver.observe([P.Handset,P.TabletPortrait]).pipe(C(t=>t.matches));showToggle$=k([this.isMobile$,this.authService.sidebarCollapsed$]).pipe(C(([t,e])=>t&&e));subscriptions=new E;restaurantId="";constructor(){let t=new Date;this.minDate=t.toISOString().split("T")[0],this.today=this.minDate,this.customerReservationData.reservation_date=this.minDate,this.restaurantReservationData.reservation_date=this.minDate}ngOnInit(){return b(this,null,function*(){console.log("\u{1F504} RestaurantMapViewer initialized"),this.route.params.subscribe(t=>{this.restaurantId=t.restaurantId,console.log("\u{1F3EA} Restaurant ID from route:",this.restaurantId),this.restaurantId?this.loadRestaurantData():console.error("\u274C No restaurantId found in route params")}),this.subscriptions.add(this.authService.currentUser$.subscribe(t=>{this.currentUser=t,t&&(this.restaurantReservationData.customer_name=`${t.first_name||""} ${t.last_name||""}`.trim(),this.restaurantReservationData.customer_phone=t.phone||"")}))})}ngOnDestroy(){this.subscriptions.unsubscribe()}loadRestaurantData(){return b(this,null,function*(){if(console.log("\u{1F4E5} Loading restaurant data for ID:",this.restaurantId),this.restaurant=yield this.restaurantPublicService.loadRestaurant(this.restaurantId),!this.restaurant){console.error("\u274C Restaurant not found");return}this.customerReservationData.restaurant_id=this.restaurantId,this.restaurantReservationData.restaurant_id=this.restaurantId,yield this.loadFloorPlans(),yield this.loadReservationsForToday()})}loadFloorPlans(){return b(this,null,function*(){try{let{data:t,error:e}=yield this.floorPlanService.supabaseService.getSupabaseClient().from("restaurant_floor_plans").select("*").eq("restaurant_id",this.restaurantId).eq("is_active",!0).order("created_at",{ascending:!0});if(e)throw e;this.floorPlans=t||[],this.floorPlans.length>0&&(this.currentFloorPlan=this.floorPlans[0],yield this.loadTablesForCurrentFloorPlan())}catch(t){console.error("\u274C Error loading floor plans:",t)}})}loadTablesForCurrentFloorPlan(){return b(this,null,function*(){if(this.currentFloorPlan){console.log("\u{1F50D} Loading tables for floor plan:",{floorPlanId:this.currentFloorPlan.id,floorPlanName:this.currentFloorPlan.name});try{let{data:t,error:e}=yield this.tableService.supabaseService.getSupabaseClient().from("tables").select("*").eq("floor_plan_id",this.currentFloorPlan.id).eq("is_active",!0).order("table_number",{ascending:!0});if(e){console.error("\u274C Errore query tavoli:",e),this.tables=[];return}let o=(t||[]).filter(n=>n.parent_table_id===null&&!n.is_merged);console.log("\u{1F4CA} RISULTATI TAVOLI:",{tavoliTotaliNelDB:t?.length||0,tavoliVisibili:o.length,floorPlan:this.currentFloorPlan.name,tavoliVisibiliLista:o.map(n=>({id:n.id,numero:n.table_number,nome:n.table_name,position:`(${n.position_x}, ${n.position_y})`,dimensioni:`${n.width}x${n.height}`,shape:n.shape,is_online_bookable:n.is_online_bookable,capacity:n.capacity}))}),o.length===0&&t&&t.length>0&&console.warn("\u26A0\uFE0F Tavoli esclusi dal rendering:",{motivo:"Sono tavoli figli (parent_table_id != null) o uniti (is_merged = true)",tavoliEsclusi:t.map(n=>({numero:n.table_number,parent_table_id:n.parent_table_id,is_merged:n.is_merged,is_online_bookable:n.is_online_bookable}))}),this.tables=o}catch(t){console.error("\u{1F4A5} Errore nel caricamento tavoli:",t),this.tables=[]}}})}loadReservationsForToday(){return b(this,null,function*(){try{let{data:t,error:e}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").select("*").eq("restaurant_id",this.restaurantId).eq("reservation_date",this.today).in("status",["pending","confirmed"]);if(e)throw e;this.reservations=t||[],console.log("\u{1F4C5} Prenotazioni per oggi:",this.reservations.length)}catch(t){console.error("\u274C Error loading reservations:",t)}})}selectFloorPlan(t){return b(this,null,function*(){console.log("\u{1F4CD} Selezionato floor plan:",t.name),this.currentFloorPlan=t,yield this.loadTablesForCurrentFloorPlan(),this.deselectTable(),this.resetZoom()})}onTableClick(t){if(!t.is_online_bookable){console.log("\u274C Table not available for online booking:",t.table_number),alert("Questo tavolo non \xE8 prenotabile online");return}if(this.isTableReserved(t)){console.log("\u274C Table already reserved:",t.table_number),alert("Questo tavolo \xE8 gi\xE0 prenotato per la data e ora selezionate");return}this.selectedTable=t,this.customerReservationData.table_id=t.id,this.restaurantReservationData.table_id=t.id,this.customerReservationData.party_size=Math.min(2,t.capacity),this.restaurantReservationData.party_size=Math.min(2,t.capacity),this.loadAvailableTimes()}deselectTable(){this.selectedTable=null,this.customerReservationData.table_id="",this.restaurantReservationData.table_id=void 0,this.availabilityChecked=!1,this.isTableAvailable=!1}isTableReserved(t){return!this.customerReservationData.reservation_date||!this.customerReservationData.reservation_time?!1:this.reservations.some(e=>e.table_id===t.id&&e.reservation_date===this.customerReservationData.reservation_date&&e.reservation_time===this.customerReservationData.reservation_time&&["pending","confirmed"].includes(e.status))}getTableClass(t){let e=["table-element",`shape-${t.shape}`];return this.selectedTable?.id===t.id?e.push("selected"):t.is_online_bookable?this.isTableReserved(t)?e.push("reserved"):e.push("available"):e.push("unavailable"),e.join(" ")}getTableStyle(t){let o=Math.max(t.width||60,60),n=Math.max(t.height||60,60),m="8px";return t.shape==="circle"?m="50%":t.shape==="square"&&(m="8px"),{left:t.position_x+"px",top:t.position_y+"px",width:o+"px",height:n+"px","border-radius":m,transform:`rotate(${t.rotation||0}deg)`}}getTableTooltip(t){let e=`Tavolo ${t.table_number} - ${t.capacity} persone`;return t.is_online_bookable?this.isTableReserved(t)?e+=" (Prenotato)":e+=" (Disponibile)":e+=" (Non prenotabile online)",e}openReservationModal(){if(!this.selectedTable||!this.selectedTable.is_online_bookable){console.log("\u274C Cannot open reservation modal - table not available");return}this.showReservationModal=!0,this.loadAvailableTimes()}closeReservationModal(){this.showReservationModal=!1,this.availabilityChecked=!1}onDateChange(){return b(this,null,function*(){this.availabilityChecked=!1,yield this.loadAvailableTimes()})}onTimeChange(){return b(this,null,function*(){this.customerReservationData.reservation_time&&(yield this.checkAvailability())})}loadAvailableTimes(){return b(this,null,function*(){!this.selectedTable||!this.customerReservationData.reservation_date||(this.availableTimes=yield this.reservationService.getAvailableTimes(this.selectedTable.id,this.customerReservationData.reservation_date),this.customerReservationData.reservation_time&&(yield this.checkAvailability()))})}checkAvailability(){return b(this,null,function*(){!this.selectedTable||!this.customerReservationData.reservation_date||!this.customerReservationData.reservation_time||(this.isTableAvailable=yield this.reservationService.checkTableAvailability(this.selectedTable.id,this.customerReservationData.reservation_date,this.customerReservationData.reservation_time),this.availabilityChecked=!0)})}createReservation(){return b(this,null,function*(){if(!(!this.selectedTable||!this.isTableAvailable||this.creatingReservation)){this.creatingReservation=!0;try{let t;if(this.currentUser)this.customerReservationData.table_id=this.selectedTable.id,t=yield this.reservationService.createCustomerReservation(this.customerReservationData);else{if(!this.restaurantReservationData.customer_name||!this.restaurantReservationData.customer_phone){alert("Per favore compila nome e telefono per la prenotazione"),this.creatingReservation=!1;return}this.restaurantReservationData.table_id=this.selectedTable.id,t=yield this.reservationService.createRestaurantReservation(this.restaurantReservationData)}t?(this.lastReservation=t,this.showReservationModal=!1,this.showConfirmationModal=!0,yield this.loadReservationsForToday(),this.deselectTable()):alert("Errore durante la creazione della prenotazione. Riprova.")}catch(t){console.error("\u274C Error creating reservation:",t),alert("Errore durante la creazione della prenotazione.")}finally{this.creatingReservation=!1}}})}closeConfirmationModal(){this.showConfirmationModal=!1,this.resetReservationData()}resetReservationData(){this.customerReservationData={restaurant_id:this.restaurantId,table_id:"",reservation_date:this.minDate,reservation_time:"",party_size:2,special_requests:""},this.restaurantReservationData={restaurant_id:this.restaurantId,customer_name:this.currentUser?.user_metadata?.first_name||"",customer_phone:this.currentUser?.user_metadata?.phone||"",customer_email:"",reservation_date:this.minDate,reservation_time:"",party_size:2,special_requests:"",table_id:void 0,status:"pending"}}formatDate(t){return t?new Date(t).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}goToRestaurantList(){this.router.navigate(["/restaurants"])}syncReservationData(){this.restaurantReservationData.reservation_date=this.customerReservationData.reservation_date,this.restaurantReservationData.reservation_time=this.customerReservationData.reservation_time,this.restaurantReservationData.party_size=this.customerReservationData.party_size,this.restaurantReservationData.special_requests=this.customerReservationData.special_requests}getTablesCountForPlan(t){return this.currentFloorPlan?.id===t?this.tables.length:0}loadTableCountsForAllFloorPlans(){return b(this,null,function*(){try{let{data:t,error:e}=yield this.tableService.supabaseService.getSupabaseClient().from("tables").select("*").eq("restaurant_id",this.restaurantId).eq("is_active",!0);if(e)throw e;let o=new Map;return this.floorPlans.forEach(n=>{o.set(n.id,0)}),t?.forEach(n=>{n.floor_plan_id&&o.has(n.floor_plan_id)&&n.parent_table_id===null&&!n.is_merged&&o.set(n.floor_plan_id,o.get(n.floor_plan_id)+1)}),o}catch(t){return console.error("\u274C Error loading table counts:",t),new Map}})}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.25,this.maxZoom),this.updateCanvasTransform()}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.25,this.minZoom),this.updateCanvasTransform()}resetZoom(){this.zoomLevel=1,this.canvasPosition={x:0,y:0},this.updateCanvasTransform()}getScaledWidth(){return(this.currentFloorPlan?.width||1e3)*this.zoomLevel}getScaledHeight(){return(this.currentFloorPlan?.height||800)*this.zoomLevel}updateCanvasTransform(){if(this.canvasRef&&this.canvasRef.nativeElement){let t=this.canvasRef.nativeElement;t.style.transform=`translate3d(${this.canvasPosition.x}px, ${this.canvasPosition.y}px, 0) scale3d(${this.zoomLevel}, ${this.zoomLevel}, 1)`,t.style.transformOrigin="0 0"}}zoomTo(t){this.zoomLevel=Math.max(this.minZoom,Math.min(this.maxZoom,t)),this.updateCanvasTransform()}zoomToFit(){if(!this.canvasRef||!this.canvasRef.nativeElement||!this.currentFloorPlan)return;let t=this.canvasRef.nativeElement.parentElement;if(!t)return;let e=t.clientWidth-40,o=t.clientHeight-40,n=e/this.currentFloorPlan.width,m=o/this.currentFloorPlan.height;this.zoomLevel=Math.min(n,m,1),this.canvasPosition={x:0,y:0},this.updateCanvasTransform()}onCanvasMouseDown(t){t.preventDefault(),this.isDragging=!0,this.dragStart={x:t.clientX-this.canvasPosition.x,y:t.clientY-this.canvasPosition.y}}onCanvasMouseMove(t){this.isDragging&&(t.preventDefault(),this.canvasPosition.x=t.clientX-this.dragStart.x,this.canvasPosition.y=t.clientY-this.dragStart.y,this.updateCanvasTransform())}onCanvasMouseUp(t){this.isDragging=!1}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=I({type:s,selectors:[["app-restaurant-map-viewer"]],viewQuery:function(e,o){if(e&1&&L(pe,5),e&2){let n;A(n=q())&&(o.canvasRef=n.first)}},decls:61,vars:22,consts:[["floorPlanCanvas",""],["class","section-header",3,"background",4,"ngIf"],[1,"page-container"],["class","map-selector-section mt-lg",4,"ngIf"],[1,"map-section","p-md"],[1,"border","rounded-lg","p-md","flex-wrap"],[1,"flex","gap-sm","mb-md"],[1,"material-icons","text-md"],[1,"text-md","font-bold","m-0"],[1,"flex","flex-wrap","items-center","gap-md"],[1,"flex","items-center","gap-sm","rounded-lg","p-sm"],["title","Zoom Out (Ctrl -)",1,"icon-button",3,"click","disabled"],[1,"material-icons"],[1,"flex","items-center","gap-sm","p-sm","justify-center","bg-body","rounded"],[1,"material-icons","text-sm"],[1,"font-semibold"],["title","Zoom In (Ctrl +)",1,"icon-button",3,"click","disabled"],["title","Reset Zoom (0)",1,"icon-button",3,"click"],["title","Adatta allo schermo",1,"icon-button",3,"click"],[1,"map-legend"],[1,"legend-item"],[1,"legend-color","available"],[1,"text-mini","font-semibold"],[1,"legend-color","reserved"],[1,"legend-color","selected"],[1,"canvas-container"],[1,"floor-plan-canvas",3,"mousedown","mousemove","mouseup","mouseleave"],[1,"grid-overlay"],["class","table-element",3,"class","style","title","click",4,"ngFor","ngForOf"],["class","canvas-instructions",4,"ngIf"],[1,"flex","flex-wrap","items-center","justify-between","gap-sm","mt-sm","p-sm","bg-smoke","rounded"],[1,"text-mini","text-muted","flex","items-center","gap-sm"],[1,"material-icons","text-mini"],[1,"flex","items-center","gap-md"],[1,"text-mini","text-muted"],["class","modal-overlay",3,"click",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"section-header"],["class","icon-button mobile-toggle",3,"click",4,"ngIf"],[1,"header-icon"],["class","logo-image rounded-full",3,"src","alt",4,"ngIf"],["class","material-icons",4,"ngIf"],[1,"section-titles"],[1,"section-title"],["class","text-muted",4,"ngIf"],[1,"icon-button","mobile-toggle",3,"click"],["name","menu"],[1,"logo-image","rounded-full",3,"src","alt"],[1,"text-muted"],[1,"map-selector-section","mt-lg"],["class","p-sm",4,"ngIf"],[1,"flex","flex-col"],[1,"flex","gap-sm","p-sm"],[1,"text-md"],[1,"floor-plan-selector"],["class","floor-plan-option",3,"selected","click",4,"ngFor","ngForOf"],[1,"p-sm"],[1,"flex","flex-wrap","gap-sm"],["class","chip flex items-center gap-sm",4,"ngIf"],[1,"chip","flex","items-center","gap-sm"],[1,"floor-plan-option",3,"click"],[1,"plan-name","font-semibold"],["class","text-mini",4,"ngIf"],[1,"text-mini"],[1,"table-element",3,"click","title"],[1,"table-content"],[1,"table-number"],[1,"table-capacity"],["class","table-status",4,"ngIf"],[1,"table-status"],[1,"canvas-instructions"],[1,"instruction-card"],[1,"font-bold","mb-sm"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-sm",3,"click"],[1,"modal-header"],[1,"section-title","m-0"],["title","Chiudi",1,"icon-button",3,"click"],[1,"p-lg"],[1,"grid-form","mb-lg"],[1,"form-group"],[1,"standard-label"],[1,"flex","items-center","gap-sm"],[1,"chip","active"],[1,"p-sm","bg-smoke","rounded"],[1,"p-sm","bg-smoke","rounded","text-capitalize"],["class","info-message mb-lg",4,"ngIf"],[1,"modal-footer"],[1,"promethea-button","ghost",3,"click"],[1,"promethea-button","primary",3,"click","disabled"],[1,"info-message","mb-lg"],[1,"modal-overlay"],[1,"modal-container","modal-md"],[1,"icon-button",3,"click"],[1,"form-card"],[1,"form-row"],["type","date","required","",1,"p-sm",3,"ngModelChange","change","ngModel","min"],["required","",1,"p-sm",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value","disabled",4,"ngFor","ngForOf"],["class","mb-lg",4,"ngIf"],["class","form-section",4,"ngIf"],["class","info-message",4,"ngIf"],[1,"form-group","m-sm02"],["placeholder","Note o richieste speciali...","rows","3",1,"p-sm",3,"ngModelChange","input","ngModel"],[1,"promethea-button",3,"click","disabled"],[3,"value"],[3,"value","disabled"],[1,"mb-lg"],["class","info-message","style","border-left-color: var(--primary);",4,"ngIf"],[1,"info-message"],[1,"info-message",2,"border-left-color","var(--primary)"],[1,"form-section"],[1,"text-md","mb-md"],["type","text","placeholder","Il tuo nome","required","",1,"p-sm",3,"ngModelChange","ngModel"],["type","tel","placeholder","Il tuo telefono","required","",1,"p-sm",3,"ngModelChange","ngModel"],["type","email","placeholder","La tua email",1,"p-sm",3,"ngModelChange","ngModel"],["name","user",1,"nav-icon",3,"size"],[1,"p-lg","flex-1","overflow-y-auto","text-center"],[1,"confirmation-icon"],[1,"material-icons","success",2,"font-size","48px","color","#10b981"],[1,"confirmation-title",2,"margin-bottom","var(--gap-sm)","color","var(--text-color)"],[1,"confirmation-message",2,"margin-bottom","var(--gap-md)","color","var(--text-color)","opacity","0.8"],[1,"confirmation-details",2,"text-align","left","background","color-mix(in srgb, var(--background) 95%, transparent)","padding","var(--gap-md)","border-radius","12px","margin-bottom","var(--gap-lg)"],[1,"detail-item",2,"margin-bottom","var(--gap-sm)"],[1,"detail-item"],[1,"chip","active",2,"margin-left","var(--gap-sm)"],[1,"promethea-button","primary",3,"click"]],template:function(e,o){if(e&1){let n=h();_(0,he,11,9,"div",1),i(1,"div",2),_(2,Ce,10,2,"div",3),i(3,"div",4)(4,"div",5)(5,"div",6)(6,"span",7),r(7,"table_restaurant"),a(),i(8,"h2",8),r(9,"Seleziona un Tavolo"),a()(),i(10,"div",9)(11,"div",10)(12,"button",11),v("click",function(){return u(n),p(o.zoomOut())}),i(13,"span",12),r(14,"zoom_out"),a()(),i(15,"div",13)(16,"span",14),r(17,"search"),a(),i(18,"span",15),r(19),a()(),i(20,"button",16),v("click",function(){return u(n),p(o.zoomIn())}),i(21,"span",12),r(22,"zoom_in"),a()(),i(23,"button",17),v("click",function(){return u(n),p(o.resetZoom())}),i(24,"span",12),r(25,"refresh"),a()(),i(26,"button",18),v("click",function(){return u(n),p(o.zoomToFit())}),i(27,"span",12),r(28,"fit_screen"),a()()(),i(29,"div",19)(30,"div",20),x(31,"div",21),i(32,"span",22),r(33,"Disponibile"),a()(),i(34,"div",20),x(35,"div",23),i(36,"span",22),r(37,"Prenotato"),a()(),i(38,"div",20),x(39,"div",24),i(40,"span",22),r(41,"Selezionato"),a()()()(),i(42,"div",25)(43,"div",26,0),v("mousedown",function(S){return u(n),p(o.onCanvasMouseDown(S))})("mousemove",function(S){return u(n),p(o.onCanvasMouseMove(S))})("mouseup",function(S){return u(n),p(o.onCanvasMouseUp(S))})("mouseleave",function(){return u(n),p(o.isDragging=!1)}),x(45,"div",27),_(46,Pe,7,8,"div",28)(47,Ee,8,0,"div",29),a()(),i(48,"div",30)(49,"div",31)(50,"span",32),r(51,"touch_app"),a(),r(52," Trascina per muoverti \u2022 Usa i pulsanti per zoommare "),a(),i(53,"div",33)(54,"div",22),r(55),a(),i(56,"div",34),r(57),a()()()()(),_(58,ze,45,8,"div",35)(59,$e,43,14,"div",36)(60,je,25,5,"div",35),a()}e&2&&(d("ngIf",o.restaurant),l(2),d("ngIf",o.floorPlans.length>1),l(10),d("disabled",o.zoomLevel<=o.minZoom),l(7),g("",(o.zoomLevel*100).toFixed(0),"%"),l(),d("disabled",o.zoomLevel>=o.maxZoom),l(23),T("min-width",o.getScaledWidth(),"px")("min-height",o.getScaledHeight(),"px")("cursor",o.isDragging?"grabbing":"grab"),l(2),T("width",(o.currentFloorPlan==null?null:o.currentFloorPlan.width)||1e3,"px")("height",(o.currentFloorPlan==null?null:o.currentFloorPlan.height)||600,"px"),l(),d("ngForOf",o.tables),l(),d("ngIf",o.tables.length===0),l(8),g(" ",o.tables.length," tavoli disponibili "),l(2),g(" ",(o.currentFloorPlan==null?null:o.currentFloorPlan.name)||""," "),l(),d("ngIf",o.selectedTable),l(),d("ngIf",o.showReservationModal),l(),d("ngIf",o.showConfirmationModal))},dependencies:[Q,$,j,B,ne,te,ie,G,ee,J,ae,K,oe,re],styles:[".logo-image[_ngcontent-%COMP%]{max-width:var(--fs-xl);max-height:var(--fs-xl);width:auto;height:auto;object-fit:contain;padding:var(--gap-sm);background:var(--smoke-1)}.restaurant-hero[_ngcontent-%COMP%]{position:relative;border-radius:0 0 24px 24px;overflow:hidden;margin-bottom:var(--gap-lg);background:var(--gradiente)}.restaurant-cover[_ngcontent-%COMP%]{height:300px;overflow:hidden}.restaurant-cover[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;opacity:.9}.restaurant-info[_ngcontent-%COMP%]{padding:var(--gap-lg);background:linear-gradient(to top,var(--background) 20%,transparent);position:relative}.restaurant-logo[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;border:4px solid var(--background);background:var(--background);box-shadow:0 8px 24px var(--shadow-2);overflow:hidden}.restaurant-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;padding:var(--gap-sm);object-fit:cover}.map-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.grid-overlay[_ngcontent-%COMP%]{background-image:none;border:1px solid var(--smoke-2);background:var(--smoke-1)}.table-element[_ngcontent-%COMP%]{position:absolute;border:2px solid;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s cubic-bezier(.2,.9,.2,1);-webkit-user-select:none;user-select:none;z-index:10;box-shadow:0 4px 12px #0000001a}.table-element[_ngcontent-%COMP%]:hover{transform:scale(1.05);z-index:20;box-shadow:0 8px 24px #0003}.table-element.selected[_ngcontent-%COMP%]{z-index:30;border-width:3px;animation:_ngcontent-%COMP%_pulse 2s infinite}.table-element.available[_ngcontent-%COMP%]{border-color:#10b981;background:#10b98126}.table-element.available[_ngcontent-%COMP%]:hover{background:#10b98140}.table-element.reserved[_ngcontent-%COMP%]{border-color:#f59e0b;background:#f59e0b26}.table-element.unavailable[_ngcontent-%COMP%]{border-color:#ef4444;background:#ef44441a;cursor:not-allowed;opacity:.7}.table-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:8px;width:100%}.table-number[_ngcontent-%COMP%]{font-weight:800;font-size:clamp(1rem,1.5vw,1.25rem);color:var(--text-color);text-shadow:0 1px 2px rgba(0,0,0,.1)}.table-capacity[_ngcontent-%COMP%]{font-size:clamp(.75rem,1vw,.9rem);color:var(--text-muted);font-weight:600}.canvas-container[_ngcontent-%COMP%]{margin-top:var(--gap-lg)}.map-legend[_ngcontent-%COMP%]{display:flex;gap:var(--gap-md);align-items:center;flex-wrap:wrap;padding:var(--gap-sm);background:var(--smoke-1);border-radius:12px;margin-left:auto}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gap-sm)}.legend-color[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:4px;border:2px solid}.legend-color.available[_ngcontent-%COMP%]{background:#10b98133;border-color:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:#f59e0b33;border-color:#f59e0b}.legend-color.unavailable[_ngcontent-%COMP%]{background:#ef444433;border-color:#ef4444}.legend-color.selected[_ngcontent-%COMP%]{background:var(--gradiente);border-color:var(--primary)}.floor-plan-selector[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);flex-wrap:wrap}.floor-plan-option[_ngcontent-%COMP%]{display:flex;align-items:center;padding:var(--gap-sm);background:var(--smoke-1);border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all .2s ease}.floor-plan-option[_ngcontent-%COMP%]:hover{background:var(--smoke-2);transform:translateY(-2px)}.floor-plan-option.selected[_ngcontent-%COMP%]{background:var(--gradiente);color:#fff;border-color:var(--primary)}.canvas-instructions[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:5}.instruction-card[_ngcontent-%COMP%]{background:var(--vetro);padding:var(--gap-lg);border-radius:16px;border:1px solid var(--smoke-1);box-shadow:0 8px 32px var(--shadow-2);max-width:400px}.instruction-card[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;color:var(--text-muted);margin-bottom:var(--gap-md)}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:12px;height:12px}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--smoke-1);border-radius:6px}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--gradiente);border-radius:6px;border:3px solid var(--background)}@media (max-width: 768px){.restaurant-logo[_ngcontent-%COMP%]{width:80px;height:80px;top:-40px}.restaurant-cover[_ngcontent-%COMP%]{height:200px}.map-legend[_ngcontent-%COMP%]{margin-left:0;justify-content:center}}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 #e03e3eb3}70%{box-shadow:0 0 0 10px #e03e3e00}to{box-shadow:0 0 #e03e3e00}}"]})};export{ue as RestaurantMapViewer};
