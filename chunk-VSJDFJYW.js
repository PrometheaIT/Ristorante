import{a as L}from"./chunk-VT7RUZBT.js";import{b as M,c as v,d as N,e as T,i as V,m as z,p as G,w as O,y as P}from"./chunk-PZ6IGEMS.js";import"./chunk-F35UPSG6.js";import"./chunk-4GBXVLF4.js";import"./chunk-37GYPR4T.js";import{j as I,k,s as C}from"./chunk-PWZZTUE6.js";import{$a as g,Eb as b,Ga as a,Gb as w,Hb as n,Ib as m,Jb as y,Wa as F,ba as h,ha as d,hb as u,ia as c,ib as i,jb as e,kb as S,qb as E,tb as p,vb as _}from"./chunk-DU5L5MFQ.js";import{j as f}from"./chunk-4ZZIO3ZI.js";function D(s,r){s&1&&(i(0,"tr")(1,"td",22)(2,"div",23)(3,"span",24),n(4,"refresh"),e(),i(5,"span"),n(6,"Caricamento fornitori..."),e()()()())}function j(s,r){if(s&1){let t=E();i(0,"tr",25)(1,"td")(2,"strong"),n(3),e()(),i(4,"td")(5,"span",5),n(6),e()(),i(7,"td")(8,"span",5),n(9),e()(),i(10,"td")(11,"span",5),n(12),e()(),i(13,"td")(14,"span",5),n(15),e()(),i(16,"td")(17,"span",26),n(18),e()(),i(19,"td")(20,"div",2)(21,"button",27),p("click",function(){let l=d(t).$implicit,x=_();return c(x.editSupplier(l))}),i(22,"span",15),n(23,"edit"),e()(),i(24,"button",28),p("click",function(){let l=d(t).$implicit,x=_();return c(x.deleteSupplier(l.id))}),i(25,"span",15),n(26,"delete"),e()()()()()}if(s&2){let t=r.$implicit;a(3),m(t.company_name),a(3),m(t.contact_name||"Nessun contatto"),a(3),m(t.email||"Nessuna email"),a(3),m(t.phone||"Nessun telefono"),a(3),m(t.address||"Nessun indirizzo"),a(2),w(t.is_platform_supplier?"active":"warning"),a(),y(" ",t.is_platform_supplier?"Piattaforma":"Locale"," ")}}function q(s,r){s&1&&(i(0,"tr")(1,"td",29)(2,"div",30)(3,"span",15),n(4,"local_shipping"),e(),i(5,"h3"),n(6,"Nessun fornitore trovato"),e()()()())}function $(s,r){s&1&&(i(0,"div",56),n(1," Il nome dell'azienda \xE8 obbligatorio "),e())}function B(s,r){s&1&&(i(0,"div",56),n(1," Inserisci un indirizzo email valido "),e())}function R(s,r){if(s&1){let t=E();i(0,"div",31),p("click",function(){d(t);let l=_();return c(l.resetForm())}),i(1,"div",32),p("click",function(l){return d(t),c(l.stopPropagation())}),i(2,"div",33)(3,"div",34)(4,"div",35)(5,"span",15),n(6),e()(),i(7,"div")(8,"h1",4),n(9),e()()(),i(10,"button",36),p("click",function(){d(t);let l=_();return c(l.resetForm())}),i(11,"span",15),n(12,"close"),e()()(),i(13,"div",37)(14,"form",38),p("ngSubmit",function(){d(t);let l=_();return c(l.onSubmit())}),i(15,"div",39)(16,"div",40)(17,"label",41)(18,"span",15),n(19,"business"),e(),n(20," Nome Azienda * "),e(),S(21,"input",42),g(22,$,2,0,"div",43),e(),i(23,"div",40)(24,"label",44)(25,"span",15),n(26,"person"),e(),n(27," Nome Contatto "),e(),S(28,"input",45),e()(),i(29,"div",46)(30,"div",40)(31,"label",47)(32,"span",15),n(33,"email"),e(),n(34," Email "),e(),S(35,"input",48),g(36,B,2,0,"div",43),e(),i(37,"div",40)(38,"label",49)(39,"span",15),n(40,"phone"),e(),n(41," Telefono "),e(),S(42,"input",50),e()(),i(43,"div",40)(44,"label",51)(45,"span",15),n(46,"place"),e(),n(47," Indirizzo "),e(),S(48,"textarea",52),e()()(),i(49,"div",53)(50,"button",54),p("click",function(){d(t);let l=_();return c(l.resetForm())}),i(51,"span",15),n(52,"close"),e(),n(53," Annulla "),e(),i(54,"button",55),p("click",function(){d(t);let l=_();return c(l.onSubmit())}),i(55,"span",15),n(56),e(),n(57),e()()()()}if(s&2){let t=_();a(6),m(t.isEditing?"edit":"add_circle"),a(3),m(t.isEditing?"Modifica Fornitore":"Nuovo Fornitore"),a(5),u("formGroup",t.supplierForm),a(7),b("border-red-500",(t.company_name==null?null:t.company_name.invalid)&&(t.company_name==null?null:t.company_name.touched)),a(),u("ngIf",(t.company_name==null?null:t.company_name.invalid)&&(t.company_name==null?null:t.company_name.touched)),a(13),b("border-red-500",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),a(),u("ngIf",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),a(18),u("disabled",t.supplierForm.invalid),a(2),m(t.isEditing?"save":"add"),a(),y(" ",t.isEditing?"Aggiorna":"Crea"," Fornitore ")}}var A=class s{supplierService=h(L);fb=h(O);suppliers=[];showSupplierForm=!1;isEditing=!1;currentSupplierId=null;supplierForm;isLoading=!0;constructor(){this.supplierForm=this.fb.group({company_name:["",[v.required,v.minLength(2)]],contact_name:[""],email:["",[v.email]],phone:[""],address:[""]})}ngOnInit(){return f(this,null,function*(){yield this.loadSuppliers()})}loadSuppliers(){return f(this,null,function*(){this.isLoading=!0;try{yield this.supplierService.loadSuppliers(),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r,this.isLoading=!1})}catch(r){console.error("Error loading suppliers:",r),this.isLoading=!1}})}onSubmit(){return f(this,null,function*(){if(this.supplierForm.invalid){this.markFormGroupTouched();return}try{this.isEditing&&this.currentSupplierId?(yield this.updateSupplier(this.currentSupplierId,this.supplierForm.value))&&(console.log("Fornitore aggiornato con successo"),this.resetForm()):(yield this.supplierService.createSupplier(this.supplierForm.value))&&(console.log("Fornitore creato con successo"),this.resetForm())}catch(r){console.error("Errore durante il salvataggio:",r)}})}updateSupplier(r,t){return f(this,null,function*(){try{let{data:o,error:l}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").update(t).eq("id",r).select().single();if(l)throw l;return yield this.loadSuppliers(),!0}catch(o){return console.error("Error updating supplier:",o),!1}})}deleteSupplier(r){return f(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questo fornitore?"))try{let{error:t}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").delete().eq("id",r);if(t)throw t;yield this.loadSuppliers(),console.log("Fornitore eliminato")}catch(t){console.error("Error deleting supplier:",t)}})}editSupplier(r){this.isEditing=!0,this.currentSupplierId=r.id,this.supplierForm.patchValue({company_name:r.company_name,contact_name:r.contact_name||"",email:r.email||"",phone:r.phone||"",address:r.address||""}),this.showSupplierForm=!0}newSupplier(){this.resetForm(),this.showSupplierForm=!0,this.isEditing=!1}resetForm(){this.supplierForm.reset({company_name:"",contact_name:"",email:"",phone:"",address:""}),this.isEditing=!1,this.currentSupplierId=null,this.showSupplierForm=!1}markFormGroupTouched(){Object.keys(this.supplierForm.controls).forEach(r=>{this.supplierForm.get(r)?.markAsTouched()})}get company_name(){return this.supplierForm.get("company_name")}get email(){return this.supplierForm.get("email")}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=F({type:s,selectors:[["app-supplier-manager"]],decls:49,vars:5,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"text-muted","card-footer"],[1,"p-md0","modal-footer"],[1,"promethea-button",3,"click"],[1,"material-icons"],[1,"mt-lg","bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"overflow-hidden"],[1,"crm-table"],[4,"ngIf"],["class","supplier-row",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"text-center","p-xl"],[1,"flex","flex-col","items-center","justify-center","gap-md"],[1,"material-icons","animate-spin"],[1,"supplier-row"],[1,"chip"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state-row"],[1,"empty-state","p-md0"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"flex"],[1,"header-icon"],[1,"icon-button",3,"click"],[1,"modal-content"],[1,"form-card",3,"ngSubmit","formGroup"],[1,"grid-form","gap-md","mt-lg"],[1,"flex","flex-col","gap-sm"],["for","company_name",1,"standard-label"],["id","company_name","formControlName","company_name","type","text","placeholder","Es: Fornitore Srl"],["class","text-red-500 text-sm",4,"ngIf"],["for","contact_name",1,"standard-label"],["id","contact_name","formControlName","contact_name","type","text","placeholder","Nome del referente"],[1,"grid-form","gap-md"],["for","email",1,"standard-label"],["id","email","formControlName","email","type","email","placeholder","email@fornitore.com"],["for","phone",1,"standard-label"],["id","phone","formControlName","phone","type","tel","placeholder","+39 012 345 6789"],["for","address",1,"standard-label"],["id","address","formControlName","address","rows","2","placeholder","Indirizzo completo del fornitore"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"click","disabled"],[1,"text-red-500","text-sm"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"local_shipping"),e(),i(5,"h1",4),n(6,"Fornitori"),e()(),i(7,"p",5),n(8,"Gestisci i fornitori del tuo ristorante"),e()(),i(9,"div",6)(10,"div",7)(11,"div",8)(12,"span",9),n(13,"business"),e(),i(14,"h3",10),n(15,"Fornitori Totali"),e()(),i(16,"div",11),n(17),e(),i(18,"span",12),n(19,"Fornitori registrati"),e()()(),i(20,"div",13)(21,"button",14),p("click",function(){return o.newSupplier()}),i(22,"span",15),n(23,"add"),e(),n(24," Nuovo Fornitore "),e()(),i(25,"div",16)(26,"div",17)(27,"table",18)(28,"thead")(29,"tr")(30,"th"),n(31,"Nome Azienda"),e(),i(32,"th"),n(33,"Contatto"),e(),i(34,"th"),n(35,"Email"),e(),i(36,"th"),n(37,"Telefono"),e(),i(38,"th"),n(39,"Indirizzo"),e(),i(40,"th"),n(41,"Tipo"),e(),i(42,"th"),n(43,"Azioni"),e()()(),i(44,"tbody"),g(45,D,7,0,"tr",19)(46,j,27,8,"tr",20)(47,q,7,0,"tr",19),e()()()()(),g(48,R,58,12,"div",21)),t&2&&(a(17),m(o.suppliers.length),a(28),u("ngIf",o.isLoading),a(),u("ngForOf",o.suppliers),a(),u("ngIf",!o.isLoading&&o.suppliers.length===0),a(),u("ngIf",o.showSupplierForm))},dependencies:[C,I,k,P,V,M,N,T,z,G],styles:[".supplier-row[_ngcontent-%COMP%]{transition:all .2s ease}.supplier-row[_ngcontent-%COMP%]:hover{background:var(--smoke-1)}"]})};export{A as SupplierManager};
