import{b as d,d as g}from"./chunk-Z644G36S.js";import{Z as c,ca as l,hc as r,pa as o}from"./chunk-DE3VKQQR.js";import{j as s}from"./chunk-4ZZIO3ZI.js";var h=[{id:"welcome",title:"Benvenuto su Promethea!",description:"Sei nel posto giusto per gestire il tuo ristorante in modo semplice e completo. Ti mostriamo in pochi passi tutto quello che puoi fare.",icon:"sparkles"},{id:"dashboard",title:"Dashboard & Report",description:"Tieni tutto sotto controllo: incassi, coperti, prodotti pi\xF9 venduti e statistiche in tempo reale.",icon:"layout-dashboard",route:"/restaurant/dashboard",tooltipTarget:'[data-tutorial="dashboard"]',tooltipPosition:"right"},{id:"inventory",title:"Ingredienti & Inventario",description:"Aggiungi i tuoi ingredienti e tieni il magazzino sempre aggiornato. Ogni ingrediente viene usato automaticamente per calcolare il food cost reale di ogni piatto.",icon:"scroll-text",route:"/restaurant/inventory",tooltipTarget:'[data-tutorial="inventory"]',tooltipPosition:"right",requiredPermission:"manage_inventory"},{id:"menu",title:"Crea il tuo menu digitale",description:"Aggiungi piatti, categorie e varianti. Il menu si aggiorna in tempo reale e calcola il food cost usando il tuo inventario.",icon:"utensils",route:"/restaurant/menu",tooltipTarget:'[data-tutorial="menu"]',tooltipPosition:"right",requiredPermission:"manage_menu"},{id:"recipe",title:"Aggiungi le ricette",description:"Salva le tue ricette dei piatti e aggiungi specifiche tecniche per il team",icon:"scroll-text",route:"/restaurant/recipe",tooltipTarget:'[data-tutorial="recipe"]',tooltipPosition:"right",requiredPermission:"manage_inventory"},{id:"floor-plan",title:"Mappa Ristorante",description:"Crea la mappa del tuo ristorante e decidi che tavoli possono essere prenotabili online e quali vuoi gestire tu in autonomia. Il nome che userai per le mappe sar\xE0 visibile agli utenti dell'app",icon:"table-2",route:"/restaurant/floor-plan",tooltipTarget:'[data-tutorial="floor-plan"]',tooltipPosition:"right",requiredPermission:"view_table_map"},{id:"table-map",title:"Gestisci comande e ordini",description:"Ricevi e gestisci le comande dal tavolo in tempo reale. Ogni ordine viene inviato automaticamente alla cucina.",icon:"utensils-crossed",route:"/restaurant/table-map",tooltipTarget:'[data-tutorial="table-map"]',tooltipPosition:"right",requiredPermission:"manage_reservations"},{id:"order-editor",title:"Prendi un ordine",description:"Da qui puoi inserire le ordinazioni dei clienti, specificando quantit\xE0, note e varianti. L\u2019ordine viene inviato direttamente in cucina.",icon:"shopping-cart",route:"/restaurant/table-map",tooltipTarget:'[data-tutorial="order-editor"]',tooltipPosition:"right",requiredPermission:"manage_reservations"},{id:"staff",title:"Gestisci il personale",description:"Aggiungi il tuo staff, assegna ruoli e permessi personalizzati. Ogni membro accede solo alle sezioni di sua competenza.",icon:"users",route:"/restaurant/staff-management",tooltipTarget:'[data-tutorial="staff"]',tooltipPosition:"right",requiredPermission:"manage_staff"},{id:"restaurant-settings",title:"Configura il tuo ristorante",description:"Inserisci nome, indirizzo, orari e contatti. Questi dati saranno visibili ai clienti e usati da tutti i moduli.",icon:"settings",route:"/restaurant/settings",tooltipTarget:'[data-tutorial="restaurant-settings"]',tooltipPosition:"right",requiredPermission:"manage_restaurant_settings"}],f=[{id:"welcome",title:"Benvenuto su Promethea!",description:"Scopri i migliori ristoranti della tua zona, ordina direttamente dal tavolo o prenota il tuo posto preferito.",icon:"sparkles"},{id:"discover",title:"Scopri i ristoranti vicino a te",description:"Cerca ristoranti per cucina, zona o valutazione. Ogni locale ha il suo menu digitale sempre aggiornato.",icon:"utensils",route:"/customer/restaurant/restaurant-list",tooltipTarget:'[data-tutorial="discover"]',tooltipPosition:"right"},{id:"order",title:"I tuoi ordini",description:"Scansiona il QR code al tavolo per ordinare direttamente, oppure prenota in anticipo con pochi tocchi.",icon:"shopping-bag",route:"/customer/orders",tooltipTarget:'[data-tutorial="order"]',tooltipPosition:"right"},{id:"profile",title:"Il tuo profilo e preferenze",description:"Salva i tuoi ristoranti preferiti, gestisci le allergie alimentari e consulta lo storico dei tuoi ordini.",icon:"user",route:"/customer/profile-user",tooltipTarget:'[data-tutorial="profile"]',tooltipPosition:"right"}],m=class a{authService=l(g);supabaseService=l(d);_isVisible=o(!1);_currentStep=o(0);_phase=o("modal");_type=o("customer");_showSkipConfirm=o(!1);_refreshTrigger=o(0);refreshSignal=this._refreshTrigger.asReadonly();isVisible=this._isVisible.asReadonly();currentStep=this._currentStep.asReadonly();phase=this._phase.asReadonly();type=this._type.asReadonly();showSkipConfirm=this._showSkipConfirm.asReadonly();steps=r(()=>{let e=this._type()==="business"?h:f;return this._getVisibleSteps(e)});refreshTooltip(){this._refreshTrigger.update(e=>e+1)}currentStepData=r(()=>{let e=this.steps(),t=this._currentStep();return e[t]??null});isLastStep=r(()=>this._currentStep()===this.steps().length-1);progress=r(()=>Math.round((this._currentStep()+1)/this.steps().length*100));checkAndStart(){return s(this,null,function*(){if(this._isVisible())return;let e=this.authService.currentUserValue;if(!e)return;let i=this.authService.getCurrentContext()==="staff"?"business":"customer",n=i==="business"?"tutorial_business_completed":"tutorial_customer_completed";try{let{data:p,error:u}=yield this.supabaseService.getSupabaseClient().from("users").select(n).eq("id",e.id).single();if(u)throw u;if(p?.[n]===!0)return}catch{if(console.warn("[Tutorial] Impossibile leggere il flag, uso cache locale"),e[n]===!0)return}this._type.set(i),this._currentStep.set(0),this._phase.set("modal"),this._showSkipConfirm.set(!1),this._isVisible.set(!0)})}nextStep(){this._phase()==="modal"?this.isLastStep()?(this._phase.set("tooltip"),this._currentStep.set(0)):this._currentStep.update(e=>e+1):this._phase()==="tooltip"&&(this.isLastStep()?this.completeTutorial():this._currentStep.update(e=>e+1))}prevStep(){this._currentStep()>0&&this._currentStep.update(e=>e-1)}requestSkip(){this._showSkipConfirm.set(!0)}cancelSkip(){this._showSkipConfirm.set(!1)}confirmSkip(){this._showSkipConfirm.set(!1),this.completeTutorial()}completeTutorial(){return s(this,null,function*(){this._isVisible.set(!1),this._phase.set("done"),yield this.saveCompletionFlag()})}saveCompletionFlag(){return s(this,null,function*(){let e=this.authService.currentUserValue;if(!e)return;let t=this._type()==="business"?"tutorial_business_completed":"tutorial_customer_completed";try{let{error:i}=yield this.supabaseService.getSupabaseClient().from("users").update({[t]:!0}).eq("id",e.id);i?console.error("\u274C Errore salvataggio tutorial flag:",i):e[t]=!0}catch(i){console.error("\u274C Eccezione salvataggio tutorial flag:",i)}})}restartTutorial(e){this._type.set(e),this._currentStep.set(0),this._phase.set("modal"),this._showSkipConfirm.set(!1),this._isVisible.set(!0)}_getVisibleSteps(e){return e.filter(t=>t.requiredPermission?this.authService.hasPermission(t.requiredPermission):!0)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
