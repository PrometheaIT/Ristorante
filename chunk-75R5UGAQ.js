import{a as Y}from"./chunk-OJLXB6K2.js";import{a as X}from"./chunk-WNQ4LQDZ.js";import{a as A,b as U,c as g,d as B,e as z,i as D,j as G,m as $,p as j,q,r as R,s as K,u as H,w as J,y as Q}from"./chunk-B4OL4BIV.js";import{a as W}from"./chunk-5PRXFY4R.js";import"./chunk-4RQOBPFF.js";import"./chunk-TT5HVSFC.js";import"./chunk-OPNETFGM.js";import"./chunk-L3BVOY7C.js";import{c as M,d as P,j as V,m as N,r as L}from"./chunk-JKK4MZBS.js";import{Eb as f,Gb as F,Hb as n,Ib as x,Ja as l,Jb as S,Kb as k,Wb as T,Yb as O,Za as C,a as E,b as w,cb as u,ga as b,h as y,kb as c,la as p,lb as i,ma as _,mb as t,nb as v,sb as I,vb as d,xb as m}from"./chunk-G3XPJWB3.js";function ee(a,r){a&1&&(i(0,"tr")(1,"td",38)(2,"div",39)(3,"span",40),n(4,"refresh"),t(),i(5,"span"),n(6,"Caricamento ingredienti..."),t()()()())}function te(a,r){if(a&1){let e=I();i(0,"tr",41)(1,"td")(2,"strong"),n(3),t()(),i(4,"td")(5,"span",5),n(6),t()(),i(7,"td")(8,"span"),n(9),t()(),i(10,"td")(11,"span",5),n(12),t()(),i(13,"td")(14,"strong"),n(15),T(16,"number"),t()(),i(17,"td")(18,"span",42),n(19),t()(),i(20,"td")(21,"div",2)(22,"button",43),d("click",function(){let s=p(e).$implicit,h=m();return _(h.editIngredient(s))}),i(23,"span",20),n(24,"edit"),t()(),i(25,"button",44),d("click",function(){let s=p(e).$implicit,h=m();return _(h.deleteIngredient(s.id))}),i(26,"span",20),n(27,"delete"),t()()()()()}if(a&2){let e=r.$implicit,o=m();l(3),x(e.name),l(3),x(e.description||"Nessuna descrizione"),l(2),f("text-red-500",e.current_stock<=e.minimum_stock),l(),k(" ",e.current_stock," ",o.getUnitSymbol(e.unit_id)," "),l(3),x(o.getSupplierName(e)),l(3),S("\u20AC",O(16,11,e.cost_per_unit,"1.2-2")),l(3),F(o.getStockStatus(e).class),l(),S(" ",o.getStockStatus(e).text," ")}}function ie(a,r){a&1&&(i(0,"p",48),n(1," Prova a modificare i filtri di ricerca "),t())}function ne(a,r){if(a&1){let e=I();i(0,"tr")(1,"td",45)(2,"div",46)(3,"span",20),n(4,"search_off"),t(),i(5,"h3"),n(6,"Nessun ingrediente trovato"),t(),u(7,ie,2,0,"p",47),i(8,"button",31),d("click",function(){p(e);let s=m();return _(s.newIngredient())}),i(9,"span",20),n(10,"add"),t(),n(11," Aggiungi il primo ingrediente "),t()()()()}if(a&2){let e=m();l(7),c("ngIf",e.searchTerm||e.showLowStockOnly)}}function re(a,r){a&1&&(i(0,"div",90),n(1," Il nome \xE8 obbligatorio e deve essere di almeno 2 caratteri "),t())}function oe(a,r){if(a&1&&(i(0,"option",91),n(1),t()),a&2){let e=r.$implicit;c("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function le(a,r){if(a&1&&(i(0,"option",91),n(1),t()),a&2){let e=r.$implicit;c("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function ae(a,r){if(a&1&&(i(0,"option",91),n(1),t()),a&2){let e=r.$implicit;c("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function se(a,r){a&1&&(i(0,"div",90),n(1," Il costo per unit\xE0 \xE8 obbligatorio "),t())}function ce(a,r){a&1&&(i(0,"div",90),n(1," La scorta attuale \xE8 obbligatoria "),t())}function de(a,r){a&1&&(i(0,"div",90),n(1," La scorta minima \xE8 obbligatoria "),t())}function me(a,r){if(a&1&&(i(0,"option",91),n(1),t()),a&2){let e=r.$implicit;c("value",e.id),l(),S(" ",e.company_name," ")}}function ue(a,r){if(a&1){let e=I();i(0,"div",49),d("click",function(){p(e);let s=m();return _(s.resetForm())}),i(1,"div",50),d("click",function(s){return p(e),_(s.stopPropagation())}),i(2,"div",51)(3,"div",52)(4,"div",53)(5,"span",20),n(6),t()(),i(7,"div")(8,"h1",4),n(9),t()()(),i(10,"button",54),d("click",function(){p(e);let s=m();return _(s.resetForm())}),i(11,"span",20),n(12,"close"),t()()(),i(13,"div",55)(14,"div",56)(15,"form",57),d("ngSubmit",function(){p(e);let s=m();return _(s.onSubmit())}),i(16,"div",58)(17,"label",59)(18,"span",20),n(19,"label"),t(),n(20," Nome Ingrediente * "),t(),v(21,"input",60),u(22,re,2,0,"div",61),t(),i(23,"div",62)(24,"div",63)(25,"label",64)(26,"span",20),n(27,"straighten"),t(),n(28," Unit\xE0 di Misura "),t(),i(29,"select",65)(30,"option",66),n(31,"Seleziona unit\xE0"),t(),i(32,"optgroup",67),u(33,oe,2,3,"option",68),t(),i(34,"optgroup",69),u(35,le,2,3,"option",68),t(),i(36,"optgroup",70),u(37,ae,2,3,"option",68),t()()(),i(38,"div",63)(39,"label",71)(40,"span",20),n(41,"euro"),t(),n(42," Costo per Unit\xE0 * "),t(),v(43,"input",72),u(44,se,2,0,"div",61),t()(),i(45,"div",58)(46,"label",73)(47,"span",20),n(48,"description"),t(),n(49," Descrizione "),t(),v(50,"textarea",74),t(),i(51,"div",62)(52,"div",75)(53,"label",76)(54,"span",20),n(55,"inventory"),t(),n(56," Scorta Attuale * "),t(),v(57,"input",77),u(58,ce,2,0,"div",61),t(),i(59,"div",75)(60,"label",78)(61,"span",20),n(62,"warning"),t(),n(63," Scorta Minima * "),t(),v(64,"input",79),u(65,de,2,0,"div",61),t()(),i(66,"div",62)(67,"div",75)(68,"label",80)(69,"span",20),n(70,"local_shipping"),t(),n(71," Fornitore "),t(),i(72,"div",81)(73,"select",82)(74,"option",66),n(75,"Nessun fornitore"),t(),u(76,me,2,2,"option",68),t(),i(77,"div",2)(78,"button",83),d("click",function(){p(e);let s=m();return _(s.goToSupplierManager())}),i(79,"span",20),n(80,"add"),t()()()()()(),i(81,"div",17)(82,"div",75)(83,"label",84)(84,"span",20),n(85,"event"),t(),n(86," Data di Scadenza "),t(),v(87,"input",85),t(),i(88,"div",75)(89,"label",27),v(90,"input",86),i(91,"div",29)(92,"strong"),n(93,"Attiva avvisi scorta bassa"),t(),i(94,"div",5),n(95,"Ricevi un avviso quando la scorta scende sotto il livello minimo"),t()()()()()()()(),i(96,"div",87)(97,"button",88),d("click",function(){p(e);let s=m();return _(s.resetForm())}),i(98,"span",20),n(99,"close"),t(),n(100," Annulla "),t(),i(101,"button",89),d("click",function(){p(e);let s=m();return _(s.onSubmit())}),i(102,"span",20),n(103),t(),n(104),t()()()()}if(a&2){let e=m();l(6),x(e.isEditing?"edit":"add_circle"),l(3),x(e.isEditing?"Modifica Ingrediente":"Nuovo Ingrediente"),l(6),c("formGroup",e.ingredientForm),l(6),f("border-red-500",(e.name==null?null:e.name.invalid)&&(e.name==null?null:e.name.touched)),l(),c("ngIf",(e.name==null?null:e.name.invalid)&&(e.name==null?null:e.name.touched)),l(11),c("ngForOf",e.getUnitsByType("weight")),l(2),c("ngForOf",e.getUnitsByType("volume")),l(2),c("ngForOf",e.getUnitsByType("piece")),l(6),f("border-red-500",(e.cost_per_unit==null?null:e.cost_per_unit.invalid)&&(e.cost_per_unit==null?null:e.cost_per_unit.touched)),l(),c("ngIf",(e.cost_per_unit==null?null:e.cost_per_unit.invalid)&&(e.cost_per_unit==null?null:e.cost_per_unit.touched)),l(13),f("border-red-500",(e.current_stock==null?null:e.current_stock.invalid)&&(e.current_stock==null?null:e.current_stock.touched)),l(),c("ngIf",(e.current_stock==null?null:e.current_stock.invalid)&&(e.current_stock==null?null:e.current_stock.touched)),l(6),f("border-red-500",(e.minimum_stock==null?null:e.minimum_stock.invalid)&&(e.minimum_stock==null?null:e.minimum_stock.touched)),l(),c("ngIf",(e.minimum_stock==null?null:e.minimum_stock.invalid)&&(e.minimum_stock==null?null:e.minimum_stock.touched)),l(11),c("ngForOf",e.suppliers),l(25),c("disabled",e.ingredientForm.invalid),l(2),x(e.isEditing?"save":"add"),l(),S(" ",e.isEditing?"Aggiorna":"Crea"," Ingrediente ")}}var Z=class a{ingredientService=b(W);unitService=b(X);supplierService=b(Y);fb=b(J);router=b(L);ingredients=[];units=[];suppliers=[];filteredIngredients=[];showIngredientForm=!1;isEditing=!1;currentIngredientId=null;searchTerm="";ingredientForm;isLoading=!0;showLowStockOnly=!1;sortBy="name";get lowStockCount(){return this.ingredientService.getLowStockIngredients().length}constructor(){this.ingredientForm=this.fb.group({name:["",[g.required,g.minLength(2)]],description:[""],unit_id:[""],current_stock:[0,[g.required,g.min(0)]],minimum_stock:[0,[g.required,g.min(0)]],cost_per_unit:[0,[g.required,g.min(0)]],alert_enabled:[!0],expiry_date:[null],supplier_id:[null]})}ngOnInit(){return y(this,null,function*(){this.loadData()})}loadData(){return y(this,null,function*(){this.isLoading=!0,this.unitService.units$.subscribe(r=>{this.units=r}),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r}),this.ingredientService.data$.subscribe(r=>{this.ingredients=r,this.applyFilters(),this.isLoading=!1}),yield this.ingredientService.loadIngredients(),yield this.supplierService.loadSuppliers()})}applyFilters(){let r=this.ingredients;this.searchTerm&&(r=this.ingredientService.searchIngredients(this.searchTerm)),this.showLowStockOnly&&(r=r.filter(e=>e.alert_enabled&&e.current_stock<=e.minimum_stock)),r=[...r].sort((e,o)=>{switch(this.sortBy){case"name":return e.name.localeCompare(o.name);case"stock":return e.current_stock-o.current_stock;case"cost":return e.cost_per_unit-o.cost_per_unit;default:return 0}}),this.filteredIngredients=r}onSearchChange(r){this.searchTerm=r,this.applyFilters()}toggleLowStockFilter(){this.showLowStockOnly=!this.showLowStockOnly,this.applyFilters()}onSortChange(r){this.sortBy=r,this.applyFilters()}onSubmit(){return y(this,null,function*(){if(this.ingredientForm.invalid){this.markFormGroupTouched();return}let r=this.ingredientForm.value,e=w(E({},r),{expiry_date:r.expiry_date===""?null:r.expiry_date,supplier_id:r.supplier_id===""?null:r.supplier_id});try{this.isEditing&&this.currentIngredientId?(yield this.ingredientService.updateIngredient(this.currentIngredientId,e))&&(console.log("Ingrediente aggiornato con successo"),this.resetForm()):(yield this.ingredientService.createIngredient(e))&&(console.log("Ingrediente creato con successo"),this.resetForm())}catch(o){console.error("Errore durante il salvataggio:",o)}})}editIngredient(r){this.isEditing=!0,this.currentIngredientId=r.id,this.ingredientForm.patchValue({name:r.name,description:r.description||"",unit_id:r.unit_id||"",current_stock:r.current_stock,minimum_stock:r.minimum_stock,cost_per_unit:r.cost_per_unit,alert_enabled:r.alert_enabled,expiry_date:r.expiry_date||"",supplier_id:r.supplier_id||null}),this.showIngredientForm=!0}deleteIngredient(r){return y(this,null,function*(){confirm("Sei sicuro di voler eliminare questo ingrediente?")&&(yield this.ingredientService.deleteIngredient(r))&&console.log("Ingrediente eliminato")})}newIngredient(){this.resetForm(),this.showIngredientForm=!0,this.isEditing=!1}resetForm(){this.ingredientForm.reset({name:"",description:"",unit_id:"",current_stock:0,minimum_stock:0,cost_per_unit:0,alert_enabled:!0,expiry_date:"",supplier_id:null}),this.isEditing=!1,this.currentIngredientId=null,this.showIngredientForm=!1}goToSupplierManager(){this.router.navigate(["/restaurant/suppliers"])}getUnitSymbol(r){if(!r)return"";let e=this.units.find(o=>o.id===r);return e?e.symbol:""}shouldAlert(r){return r.alert_enabled&&r.current_stock<=r.minimum_stock}getStockStatus(r){return this.shouldAlert(r)?{class:"inactive",text:"Scorta Bassa"}:r.current_stock<=r.minimum_stock*1.5?{class:"warning",text:"Scorta Media"}:{class:"active",text:"Scorta OK"}}getSupplierName(r){if(!r.supplier_id)return"Nessun fornitore";if(r.suppliers)return r.suppliers.company_name;let e=this.suppliers.find(o=>o.id===r.supplier_id);return e?e.company_name:"Fornitore sconosciuto"}goToFoodCostCalculator(){this.router.navigate(["/food-cost"])}markFormGroupTouched(){Object.keys(this.ingredientForm.controls).forEach(r=>{this.ingredientForm.get(r)?.markAsTouched()})}get name(){return this.ingredientForm.get("name")}get current_stock(){return this.ingredientForm.get("current_stock")}get minimum_stock(){return this.ingredientForm.get("minimum_stock")}get cost_per_unit(){return this.ingredientForm.get("cost_per_unit")}getUnitsByType(r){return this.unitService.getUnitsByType(r)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=C({type:a,selectors:[["app-inventory"]],decls:94,vars:14,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"text-muted","card-footer"],[1,"card-footer"],[1,"promethea-button","ghost","mt-auto",3,"click"],[1,"form-card","mt-lg"],[1,"flex","flex-col","md:flex-row","justify-between","items-start"],[1,"form-row"],[1,"form-group","mb-lg"],[1,"standard-label"],[1,"material-icons"],["type","text","placeholder","Cerca per nome o descrizione...",3,"input","value"],[3,"change","value"],["value","name"],["value","stock"],["value","cost"],[1,"form-group",2,"justify-content","center"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"checkbox-content"],[1,"modal-footer","p-md0"],[1,"promethea-button",3,"click"],[1,"mt-lg","bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"table-section"],[1,"crm-table"],[4,"ngIf"],["class","ingredient-row",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"text-center","p-xl"],[1,"flex","flex-col","items-center","justify-center","gap-md"],[1,"material-icons","animate-spin"],[1,"ingredient-row"],[1,"chip"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state-row"],[1,"empty-state"],["class","text-muted mb-4",4,"ngIf"],[1,"text-muted","mb-4"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"flex"],[1,"header-icon"],[1,"icon-button",3,"click"],[1,"modal-content"],[1,"form-card"],[1,"grid-form","gap-md",3,"ngSubmit","formGroup"],[1,"form-row","mb-md",2,"gap","0"],["for","name",1,"standard-label"],["id","name","formControlName","name","type","text","placeholder","Es: Pomodoro San Marzano"],["class","text-red-500 text-sm",4,"ngIf"],[1,"form-row","mb-md"],[1,"form-group"],["for","unit_id",1,"standard-label"],["id","unit_id","formControlName","unit_id"],["value",""],["label","Peso"],[3,"value",4,"ngFor","ngForOf"],["label","Volume"],["label","Conteggio"],["for","cost_per_unit",1,"standard-label"],["id","cost_per_unit","formControlName","cost_per_unit","type","number","step","0.001","min","0","placeholder","0.000"],["for","description",1,"standard-label"],["id","description","formControlName","description","rows","2","placeholder","Descrizione opzionale dell'ingrediente"],[1,"form-grup"],["for","current_stock",1,"standard-label"],["id","current_stock","formControlName","current_stock","type","number","step","0.001","min","0","placeholder","0"],["for","minimum_stock",1,"standard-label"],["id","minimum_stock","formControlName","minimum_stock","type","number","step","0.001","min","0","placeholder","0"],["for","supplier_id",1,"standard-label"],[1,"flex","gap-sm","items-center"],["id","supplier_id","formControlName","supplier_id",1,"flex-1"],["type","button","title","Gestisci Fornitori",1,"icon-button",3,"click"],["for","expiry_date",1,"standard-label"],["id","expiry_date","formControlName","expiry_date","type","date"],["type","checkbox","formControlName","alert_enabled"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"click","disabled"],[1,"text-red-500","text-sm"],[3,"value"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"inventory_2"),t(),i(5,"h1",4),n(6,"Inventario"),t()(),i(7,"p",5),n(8,"Gestisci gli ingredienti del tuo ristorante"),t()(),i(9,"div",6)(10,"div",7)(11,"div",8)(12,"span",9),n(13,"inventory"),t(),i(14,"h3",10),n(15,"Ingredienti Totali"),t()(),i(16,"div",11),n(17),t(),i(18,"span",12),n(19,"Ingredienti in inventario"),t()(),i(20,"div",7)(21,"div",8)(22,"span",9),n(23,"warning"),t(),i(24,"h3",10),n(25,"Scorte Basse"),t()(),i(26,"div",11),n(27),t(),i(28,"span",12),n(29),t()(),i(30,"div",7)(31,"div",8)(32,"span",9),n(33,"calculate"),t(),i(34,"h3",10),n(35,"Food Cost"),t()(),i(36,"div",13)(37,"button",14),d("click",function(){return o.goToFoodCostCalculator()}),n(38," Calcola Food Cost "),t()()()(),i(39,"div",15)(40,"div",16)(41,"div",17)(42,"div",18)(43,"label",19)(44,"span",20),n(45,"search"),t(),n(46," Cerca Ingredienti "),t(),i(47,"input",21),d("input",function(h){return o.onSearchChange(h.target.value)}),t()(),i(48,"div",18)(49,"label",19)(50,"span",20),n(51,"sort"),t(),n(52," Ordina per "),t(),i(53,"select",22),d("change",function(h){return o.onSortChange(h.target.value)}),i(54,"option",23),n(55,"Nome"),t(),i(56,"option",24),n(57,"Scorta"),t(),i(58,"option",25),n(59,"Costo"),t()()(),i(60,"div",26)(61,"label",27)(62,"input",28),d("change",function(){return o.toggleLowStockFilter()}),t(),i(63,"div",29),n(64,"Mostra solo scorte basse "),t()()()(),i(65,"div",30)(66,"button",31),d("click",function(){return o.newIngredient()}),i(67,"span",20),n(68,"add"),t(),n(69," Nuovo Ingrediente "),t()()()(),i(70,"div",32)(71,"div",33)(72,"table",34)(73,"thead")(74,"tr")(75,"th"),n(76,"Nome"),t(),i(77,"th"),n(78,"Descrizione"),t(),i(79,"th"),n(80,"Scorta Attuale"),t(),i(81,"th"),n(82,"Fornitore"),t(),i(83,"th"),n(84,"Costo/Unit\xE0"),t(),i(85,"th"),n(86,"Stato"),t(),i(87,"th"),n(88,"Azioni"),t()()(),i(89,"tbody"),u(90,ee,7,0,"tr",35)(91,te,28,14,"tr",36)(92,ne,12,1,"tr",35),t()()()()(),u(93,ue,105,22,"div",37)),e&2&&(l(17),x(o.ingredients.length),l(9),f("text-red-500",o.lowStockCount>0),l(),S(" ",o.lowStockCount," "),l(),f("text-red-500",o.lowStockCount>0),l(),S(" ",o.lowStockCount>0?"Attenzione!":"Tutto ok"," "),l(18),c("value",o.searchTerm),l(6),c("value",o.sortBy),l(9),c("checked",o.showLowStockOnly),l(28),c("ngIf",o.isLoading),l(),c("ngForOf",o.filteredIngredients),l(),c("ngIf",!o.isLoading&&o.filteredIngredients.length===0),l(),c("ngIf",o.showIngredientForm))},dependencies:[N,M,P,Q,D,R,K,U,G,A,q,B,z,H,$,j,V],styles:[".modal-lg[_ngcontent-%COMP%]{max-width:800px;max-height:90vh}.modal-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;padding:0 var(--gap-md)}.ingredient-row[_ngcontent-%COMP%]{transition:all .2s ease}.ingredient-row[_ngcontent-%COMP%]:hover{background:var(--smoke-1)}.chip.in-stock[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.low-stock[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.chip.out-of-stock[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 20%,transparent);color:#ef4444}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.modal-lg[_ngcontent-%COMP%]{margin:var(--gap-md);max-width:calc(100vw - 2 * var(--gap-md))}.crm-table[_ngcontent-%COMP%]{font-size:.875rem}.crm-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .crm-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gap-sm)}.modal-footer[_ngcontent-%COMP%]{flex-direction:column-reverse;gap:var(--gap-sm)}.modal-footer[_ngcontent-%COMP%]   .promethea-button[_ngcontent-%COMP%]{width:100%}}@media (max-width: 480px){.grid-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}.crm-table[_ngcontent-%COMP%]{display:block;overflow-x:auto;white-space:nowrap}}.checkbox-label[_ngcontent-%COMP%]{align-items:center;padding:0}"]})};export{Z as Inventory};
