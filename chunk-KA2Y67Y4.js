import{a as C}from"./chunk-WQWNBZMH.js";import{a as L}from"./chunk-3GLMGDYZ.js";import{a as y}from"./chunk-PVAGMHPL.js";import{b as w}from"./chunk-WKNMXFUK.js";import"./chunk-QPUWITB2.js";import{a as O}from"./chunk-VMXTU4N2.js";import"./chunk-XJU7QOT3.js";import{B as N,D as $,d as A,e as j,j as _,l as z}from"./chunk-KBL2L3GY.js";import{H as I,Hb as x,N as D,Na as o,Pb as T,Qb as h,Sb as S,Tb as n,Ub as l,Vb as c,Wb as f,ac as F,ba as R,cb as k,f as d,g as P,ga as p,hb as g,m as M,tb as v,ub as t,vb as i,z as E}from"./chunk-UE7YVF6I.js";var u=class s{supabaseService=p(N);authService=p($);reviewsSubject=new M([]);reviews$=this.reviewsSubject.asObservable();constructor(){this.authService.currentUser$.pipe(I(r=>!!r),D(1)).subscribe(()=>{this.loadReviews()})}getCurrentRestaurantId(){return d(this,null,function*(){let r=this.authService.getCurrentStaffRestaurantId();if(r)return r;let e=this.authService.currentUserValue;if(!e)return null;let{data:a}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",e.id).limit(1).single();return a?.id||null})}loadReviews(){return d(this,null,function*(){try{let r=yield this.getCurrentRestaurantId();if(!r){console.log("No restaurant found");return}let{data:e,error:a}=yield this.supabaseService.getSupabaseClient().from("reviews").select("*").eq("restaurant_id",r).order("created_at",{ascending:!1});if(a){console.error("Error loading reviews:",a);return}console.log("Reviews loaded:",e?.length),this.reviewsSubject.next(e||[])}catch(r){console.error("Error in loadReviews:",r)}})}getAverageRating(){let r=this.reviewsSubject.value;if(r.length===0)return{average:0,count:0};let a=r.reduce((m,b)=>m+b.rating,0)/r.length;return{average:Math.round(a*10)/10,count:r.length}}static \u0275fac=function(e){return new(e||s)};static \u0275prov=R({token:s,factory:s.\u0275fac,providedIn:"root"})};function q(s,r){if(s&1&&(t(0,"div",27)(1,"div",28)(2,"div",29),n(3),i()(),t(4,"div",30),n(5),i()()),s&2){let e=r.$implicit,a=x();o(),T("height",e.amount/a.maxSales*100+"%"),o(2),c("\u20AC",a.formatNumber(e.amount,"1.0-0")),o(2),l(e.day)}}function B(s,r){if(s&1&&(t(0,"div",31)(1,"div",32),n(2),i(),t(3,"div",33)(4,"strong"),n(5),i(),t(6,"span",6),n(7),i()(),t(8,"div",34),n(9),i()()),s&2){let e=r.$implicit,a=r.index,m=x();o(2),l(a+1),o(3),l(e.name),o(2),c("",e.orders," ordini"),o(2),c("\u20AC",m.formatNumber(e.revenue,"1.0-0"))}}function H(s,r){s&1&&(t(0,"div",35)(1,"span",3),n(2,"restaurant_menu"),i(),t(3,"p"),n(4,"Nessun piatto venduto ancora"),i()())}function G(s,r){if(s&1&&(t(0,"div",36)(1,"div",37)(2,"strong"),n(3),i()(),t(4,"div",38)(5,"span"),n(6),i(),t(7,"span",6),n(8),i()(),t(9,"span",39),n(10),i()()),s&2){let e=r.$implicit;o(3),l(e.time),o(3),l(e.customer_name),o(2),f("",e.party_size," persone \u2022 ",e.table),o(),S(e.status),o(),l(e.status)}}function W(s,r){s&1&&(t(0,"div",35)(1,"span",3),n(2,"event_available"),i(),t(3,"p"),n(4,"Nessuna prenotazione in arrivo"),i()())}function J(s,r){if(s&1&&(t(0,"div",40)(1,"div",41)(2,"strong"),n(3),i(),t(4,"span",39),n(5),i()(),t(6,"div",42)(7,"span"),n(8),i(),t(9,"span",6),n(10),i()(),t(11,"div",43),n(12),i()()),s&2){let e=r.$implicit,a=x();o(3),c("#",e.order_number),o(),S(e.status),o(),l(e.status),o(3),c("",e.items," articoli"),o(2),c("\u20AC",a.formatNumber(e.total)),o(2),l(e.time)}}function K(s,r){s&1&&(t(0,"div",35)(1,"span",3),n(2,"check_circle"),i(),t(3,"p"),n(4,"Nessun ordine in corso"),i()())}function Q(s,r){if(s&1&&(t(0,"div",44)(1,"div",45)(2,"span",3),n(3,"warning"),i()(),t(4,"div",46)(5,"strong"),n(6),i(),t(7,"span",6),n(8),i()(),t(9,"div",47),n(10),i()()),s&2){let e=r.$implicit;o(2),h("warning",e.priority==="high")("info",e.priority==="medium"),o(4),l(e.ingredient_name),o(2),f("Scorta: ",e.current_stock," ",e.unit),o(),h("error",e.priority==="high"),o(),f(" ",e.current_stock,"/",e.minimum_stock," ")}}function X(s,r){s&1&&(t(0,"div",35)(1,"span",3),n(2,"inventory_2"),i(),t(3,"p"),n(4,"Nessun alert inventario"),i()())}var U=class s{todayOrders=0;todayRevenue=0;todayReservations=0;upcomingReservations=0;lowStockIngredients=0;averageRating=0;totalReviews=0;salesData=[];topDishes=[];upcomingReservationsList=[];currentOrders=[];inventoryAlerts=[];subscriptions=new P;decimalPipe=p(_);ingredientService=p(y);orderService=p(w);reservationService=p(C);reviewService=p(u);dishService=p(O);loadingService=p(L);ngOnInit(){return d(this,null,function*(){this.loadingService.start();try{yield this.loadAllData(),this.subscriptions.add(E([this.ingredientService.ingredients$,this.orderService.orders$,this.reservationService.reservations$,this.reviewService.reviews$,this.dishService.data$]).subscribe(([r,e,a,m,b])=>{this.updateDashboardData()}))}catch(r){console.error("Error loading dashboard data:",r)}finally{this.loadingService.stop()}})}loadAllData(){return d(this,null,function*(){try{yield Promise.all([this.ingredientService.loadIngredients(),this.orderService.loadOrders(),this.reservationService.loadReservations(),this.reviewService.loadReviews(),this.dishService.loadData()]),yield this.updateDashboardData()}catch(r){throw console.error("Error loading dashboard data:",r),r}})}updateDashboardData(){return d(this,null,function*(){yield this.loadTodayOrders(),yield this.loadTodayReservations(),this.loadLowStockIngredients(),this.loadAverageRating(),yield this.loadSalesData(),yield this.loadTopDishes(),this.loadUpcomingReservations(),yield this.loadCurrentOrders(),this.loadInventoryAlerts()})}loadTodayOrders(){return d(this,null,function*(){let{count:r,revenue:e}=yield this.orderService.getTodayOrders();this.todayOrders=r,this.todayRevenue=e})}loadTodayReservations(){return d(this,null,function*(){let r=this.reservationService.getTodayReservations();this.todayReservations=r.length,this.upcomingReservations=this.reservationService.getUpcomingReservations().length})}loadLowStockIngredients(){this.lowStockIngredients=this.ingredientService.getLowStockIngredients().length}loadAverageRating(){let{average:r,count:e}=this.reviewService.getAverageRating();this.averageRating=r,this.totalReviews=e}loadSalesData(){return d(this,null,function*(){this.salesData=yield this.orderService.getLast7DaysSales()})}loadTopDishes(){return d(this,null,function*(){this.topDishes=yield this.orderService.getTopDishes(5)})}loadUpcomingReservations(){this.upcomingReservationsList=this.reservationService.getUpcomingReservationsForDashboard(4)}loadCurrentOrders(){return d(this,null,function*(){let r=this.orderService.getCurrentOrders(),e=yield Promise.all(r.slice(0,4).map(a=>d(this,null,function*(){let m=yield this.orderService.getOrderItemsCount(a.id);return{order_number:a.order_number,items:m,total:a.total_amount,status:a.status,time:this.formatTimeSince(a.created_at)}})));this.currentOrders=e})}loadInventoryAlerts(){let r=this.ingredientService.getLowStockIngredients();this.inventoryAlerts=r.slice(0,4).map(e=>({ingredient_name:e.name,current_stock:e.current_stock,minimum_stock:e.minimum_stock,unit:e.units?.symbol||"",priority:e.current_stock<=e.minimum_stock*.5?"high":"medium"}))}formatTimeSince(r){let e=new Date,a=new Date(r),m=Math.floor((e.getTime()-a.getTime())/6e4);return m<1?"Ora":m<60?`${m} min`:`${Math.floor(m/60)} h`}get maxSales(){return this.salesData.length===0?1:Math.max(...this.salesData.map(r=>r.amount),1)}formatNumber(r,e="1.2-2"){return this.decimalPipe.transform(r,e)||"0"}ngOnDestroy(){this.subscriptions.unsubscribe(),this.loadingService.stop()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=k({type:s,selectors:[["app-dashboard"]],features:[F([_,y,w,C,u,O])],decls:97,vars:20,consts:[[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"card-subtitle"],[1,"section-card"],[1,"sales-chart"],[1,"chart-bars"],["class","chart-bar-container",4,"ngFor","ngForOf"],[1,"dashboard-grid"],[1,"top-dishes"],["class","dish-item",4,"ngFor","ngForOf"],["class","empty-state-small",4,"ngIf"],[1,"reservations-list"],["class","reservation-item",4,"ngFor","ngForOf"],[1,"orders-list"],["class","order-item",4,"ngFor","ngForOf"],[1,"alerts-list"],["class","alert-item",4,"ngFor","ngForOf"],[1,"chart-bar-container"],[1,"chart-bar"],[1,"bar-amount"],[1,"bar-label"],[1,"dish-item"],[1,"dish-rank"],[1,"dish-info"],[1,"dish-revenue"],[1,"empty-state-small"],[1,"reservation-item"],[1,"reservation-time"],[1,"reservation-details"],[1,"chip"],[1,"order-item"],[1,"order-header"],[1,"order-details"],[1,"order-time"],[1,"alert-item"],[1,"alert-icon"],[1,"alert-content"],[1,"alert-stock"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"dashboard"),i()(),t(5,"div",4)(6,"h1",5),n(7,"Dashboard Ristorante"),i(),t(8,"p",6),n(9,"Panoramica completa delle attivit\xE0 del tuo ristorante"),i()()(),t(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",3),n(14,"receipt"),i(),t(15,"h3",10),n(16,"Ordini Oggi"),i()(),t(17,"div",11),n(18),i(),t(19,"div",12),n(20),i()(),t(21,"div",8)(22,"div",9)(23,"span",3),n(24,"event_available"),i(),t(25,"h3",10),n(26,"Prenotazioni Oggi"),i()(),t(27,"div",11),n(28),i(),t(29,"div",12),n(30),i()(),t(31,"div",8)(32,"div",9)(33,"span",3),n(34,"warning"),i(),t(35,"h3",10),n(36,"Scorte Basse"),i()(),t(37,"div",11),n(38),i(),t(39,"div",12),n(40," Attenzione necessaria "),i()(),t(41,"div",8)(42,"div",9)(43,"span",3),n(44,"star"),i(),t(45,"h3",10),n(46,"Valutazione Media"),i()(),t(47,"div",11),n(48),i(),t(49,"div",12),n(50),i()()(),t(51,"div",13)(52,"div",9)(53,"span",3),n(54,"trending_up"),i(),t(55,"h3",10),n(56,"Andamento Vendite Ultimi 7 Giorni"),i()(),t(57,"div",14)(58,"div",15),g(59,q,6,4,"div",16),i()()(),t(60,"div",17)(61,"div",13)(62,"div",9)(63,"span",3),n(64,"local_fire_department"),i(),t(65,"h3",10),n(66,"Piatti Pi\xF9 Venduti"),i()(),t(67,"div",18),g(68,B,10,4,"div",19)(69,H,5,0,"div",20),i()(),t(70,"div",13)(71,"div",9)(72,"span",3),n(73,"schedule"),i(),t(74,"h3",10),n(75,"Prossime Prenotazioni"),i()(),t(76,"div",21),g(77,G,11,7,"div",22)(78,W,5,0,"div",20),i()(),t(79,"div",13)(80,"div",9)(81,"span",3),n(82,"restaurant"),i(),t(83,"h3",10),n(84,"Ordini in Corso"),i()(),t(85,"div",23),g(86,J,13,7,"div",24)(87,K,5,0,"div",20),i()(),t(88,"div",13)(89,"div",9)(90,"span",3),n(91,"notification_important"),i(),t(92,"h3",10),n(93,"Alert Inventario"),i()(),t(94,"div",25),g(95,Q,11,11,"div",26)(96,X,5,0,"div",20),i()()()()),e&2&&(o(18),l(a.todayOrders),o(2),c("\u20AC",a.formatNumber(a.todayRevenue)),o(8),l(a.todayReservations),o(2),c("",a.upcomingReservations," in arrivo"),o(7),h("error",a.lowStockIngredients>0),o(),c(" ",a.lowStockIngredients," "),o(),h("error",a.lowStockIngredients>0),o(9),c("",a.averageRating,"/5"),o(2),c("",a.totalReviews," recensioni"),o(9),v("ngForOf",a.salesData),o(9),v("ngForOf",a.topDishes),o(),v("ngIf",a.topDishes.length===0),o(8),v("ngForOf",a.upcomingReservationsList),o(),v("ngIf",a.upcomingReservationsList.length===0),o(8),v("ngForOf",a.currentOrders),o(),v("ngIf",a.currentOrders.length===0),o(8),v("ngForOf",a.inventoryAlerts),o(),v("ngIf",a.inventoryAlerts.length===0))},dependencies:[z,A,j],styles:[".dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px}.section-card[_ngcontent-%COMP%]{background:var(--card-bg);border-radius:12px;padding:24px;border:1px solid var(--border-color)}.sales-chart[_ngcontent-%COMP%]{margin-top:16px}.chart-bars[_ngcontent-%COMP%]{display:flex;align-items:end;gap:16px;height:200px;padding:20px 0}.chart-bar-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;height:100%}.chart-bar[_ngcontent-%COMP%]{background:linear-gradient(180deg,var(--primary-color) 0%,var(--primary-dark) 100%);border-radius:8px 8px 0 0;width:40px;min-height:40px;position:relative;transition:all .3s ease}.chart-bar[_ngcontent-%COMP%]:hover{opacity:.8;transform:scale(1.05)}.bar-amount[_ngcontent-%COMP%]{position:absolute;top:-25px;left:50%;transform:translate(-50%);background:var(--text-color);color:var(--bg-color);padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600;white-space:nowrap}.bar-label[_ngcontent-%COMP%]{margin-top:8px;font-weight:600;color:var(--text-muted);font-size:12px}.top-dishes[_ngcontent-%COMP%]{margin-top:16px}.dish-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.dish-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dish-rank[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;margin-right:12px}.dish-info[_ngcontent-%COMP%]{flex:1}.dish-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:2px}.dish-revenue[_ngcontent-%COMP%]{font-weight:600;color:var(--success-color)}.reservations-list[_ngcontent-%COMP%]{margin-top:16px}.reservation-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.reservation-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.reservation-time[_ngcontent-%COMP%]{min-width:60px;margin-right:16px}.reservation-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.orders-list[_ngcontent-%COMP%]{margin-top:16px}.order-item[_ngcontent-%COMP%]{padding:12px 0;border-bottom:1px solid var(--border-light)}.order-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:center;margin-bottom:4px}.order-details[_ngcontent-%COMP%]{display:flex;justify-content:between;margin-bottom:4px}.order-time[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted)}.alerts-list[_ngcontent-%COMP%]{margin-top:16px}.alert-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.alert-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.alert-icon[_ngcontent-%COMP%]{margin-right:12px}.alert-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--warning-color)}.alert-icon[_ngcontent-%COMP%]   .material-icons.warning[_ngcontent-%COMP%]{color:var(--error-color)}.alert-icon[_ngcontent-%COMP%]   .material-icons.info[_ngcontent-%COMP%]{color:var(--info-color)}.alert-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.alert-stock[_ngcontent-%COMP%]{font-weight:600}.alert-stock.error[_ngcontent-%COMP%]{color:var(--error-color)}.chip[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:600;text-transform:capitalize}.chip.confirmed[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success-color)}.chip.pending[_ngcontent-%COMP%]{background:var(--warning-light);color:var(--warning-color)}.chip.preparing[_ngcontent-%COMP%]{background:var(--info-light);color:var(--info-color)}.chip.ready[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success-color)}@media (max-width: 768px){.dashboard-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.chart-bars[_ngcontent-%COMP%]{gap:8px}.chart-bar[_ngcontent-%COMP%]{width:30px}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid var(--border-light);border-top:4px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.empty-state-small[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center;color:var(--text-muted)}.empty-state-small[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px;opacity:.5}.empty-state-small[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}"]})};export{U as Dashboard};
