import{a as Ve}from"./chunk-Y4O4RGFI.js";import{a as ke}from"./chunk-6SRTQ6XE.js";import{b as Oe,c as Ie}from"./chunk-PO6IYSFV.js";import"./chunk-E6M32VL2.js";import{a as Ee}from"./chunk-CBBEHQ7F.js";import{a as Me}from"./chunk-KEWRM4FP.js";import{b as _e,d as ve,e as ge,g as he,h as be,i as xe,q as fe,r as Te,s as Se,v as we,x as ye}from"./chunk-XXXLA76A.js";import{a as Ce}from"./chunk-RRGMY4FC.js";import"./chunk-GS53O7WG.js";import"./chunk-EBEBQMEP.js";import{b as pe,d as ue}from"./chunk-N3KHNVQY.js";import{c as re,d as ae,e as le,f as oe,k as se,l as de,m as ce,n as me}from"./chunk-I5JNAJO4.js";import{Bb as j,Cb as Q,Eb as x,Hb as _,Jb as c,Ka as te,Lb as H,Mb as A,Nb as z,Oa as o,Ob as k,Pb as ne,Qb as V,Sb as Z,Tb as l,Ub as y,Vb as v,Wb as I,Xb as R,Yb as f,Zb as T,_b as S,a as $,b as K,bc as G,cb as ie,g as h,ga as ee,h as J,hb as g,jc as w,la as E,lc as C,mc as D,oc as N,qa as m,ra as p,vb as u,wb as n,xb as a,yb as P}from"./chunk-HCHBVVTJ.js";var L=class s{supabaseService=E(pe);authService=E(ue);calculateTableStatus(t){return h(this,null,function*(){let e=t.filter(r=>!r.is_merged||r.parent_table_id===null),i=new Date().toISOString().split("T")[0];try{let{data:r,error:d}=yield this.supabaseService.getSupabaseClient().from("reservations").select("*").eq("reservation_date",i).in("status",["pending","confirmed"]);if(d)throw d;let b=yield this.getCurrentRestaurantId();if(!b)return console.error("\u274C Nessun restaurantId trovato"),e.map(O=>({table:O,status:"free",tavolataId:null,currentReservation:null,currentOrders:[]}));let{data:M,error:F}=yield this.supabaseService.getSupabaseClient().from("orders").select("*, order_items(*, dishes(name, base_price, category_id))").eq("restaurant_id",b).not("status","in",'("completed", "cancelled")');if(F)throw F;return e.map(O=>{let U=r?.filter(W=>W.table_id===O.id)||[],B=M?.filter(W=>W.table_id===O.id)||[],q="free",Y=null,X=null;return B.length>0?(q="occupied",X=B[0].tavolata_id):U.length>0&&(q="reserved",Y=U[0]),{table:O,status:q,tavolataId:X,currentReservation:Y,currentOrders:B}})}catch(r){return console.error("\u274C Error calculating table status:",r),e.map(d=>({table:d,status:"free",tavolataId:null,currentReservation:null,currentOrders:[]}))}})}getCurrentRestaurantId(){return h(this,null,function*(){try{let t=this.authService.currentUserValue;if(!t)return console.error("Nessun utente autenticato"),null;let e=this.authService.getCurrentStaffRestaurantId();if(e)return e;let{data:i,error:r}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",t.id).limit(1).single();return r?(console.error("Error getting restaurant by owner:",r),null):i?.id||null}catch(t){return console.error("Exception getting restaurant:",t),null}})}areAllItemsServedOrOutOfStock(t){return!t||!t.order_items||t.order_items.length===0?!1:t.order_items.every(e=>e.status==="served"||e.status==="out_of_stock")}isOrderActive(t){return t?!["completed","cancelled"].includes(t.status):!1}isReservationActive(t){if(!t)return!1;try{let e=new Date(`${t.reservation_date}T${t.reservation_time}`),i=new Date,d=(e.getTime()-i.getTime())/(1e3*60*60);return d<=2&&d>=-4}catch{return!1}}getTableOverallStatus(t){return!t||t.length===0?"free":t.every(i=>this.areAllItemsServedOrOutOfStock(i))?"ready_for_bill":"occupied"}getActiveTavolata(t){return h(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return null;let{data:i,error:r}=yield this.supabaseService.getSupabaseClient().from("orders").select("tavolata_id").eq("restaurant_id",e).eq("table_id",t).not("status","in",'("completed", "cancelled")').order("created_at",{ascending:!1}).limit(1).single();if(r&&r.code!=="PGRST116")throw r;return i?.tavolata_id||null}catch(e){return console.error("Error getting active tavolata:",e),null}})}areAllTableItemsServed(t){return!t||t.length===0?!1:t.every(e=>this.areAllItemsServedOrOutOfStock(e))}updateSingleTableStatus(t){return h(this,null,function*(){try{if(!(yield this.getCurrentRestaurantId()))return null;let{data:i}=yield this.supabaseService.getSupabaseClient().from("tables").select("*").eq("id",t).single();return i?(yield this.calculateTableStatus([i]))[0]:null}catch(e){return console.error("Error updating single table status:",e),null}})}refreshOrder(t){return h(this,null,function*(){try{let{data:e,error:i}=yield this.supabaseService.getSupabaseClient().from("orders").select("*, order_items(*, dishes(name, base_price, category_id))").eq("id",t).single();if(i)throw i;return e}catch(e){return console.error("Error refreshing order:",e),null}})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=ee({token:s,factory:s.\u0275fac,providedIn:"root"})};var De=["mapContainer"],He=["mapCard"],Ae=["billPreviewContent"],Fe=()=>[1,2,3,4,5,6,7,8,9,10];function ze(s,t){if(s&1&&(n(0,"option",54),l(1),a()),s&2){let e=t.$implicit;u("ngValue",e),o(),y(e.name)}}function Ne(s,t){if(s&1&&(n(0,"option",54),l(1),a()),s&2){let e=t.$implicit;u("ngValue",e),o(),v(" ",e.name," ")}}function Le(s,t){if(s&1){let e=x();n(0,"div",55)(1,"h2",56),l(2),a(),n(3,"div",57)(4,"button",58),_("click",function(){m(e);let r=c();return p(r.zoomOut())}),n(5,"span",35),l(6,"zoom_out"),a()(),n(7,"div",59)(8,"span",60),l(9,"search"),a(),n(10,"span",39),l(11),a()(),n(12,"button",58),_("click",function(){m(e);let r=c();return p(r.zoomIn())}),n(13,"span",35),l(14,"zoom_in"),a()(),n(15,"select",61),S("ngModelChange",function(r){m(e);let d=c();return T(d.currentFloorPlan,r)||(d.currentFloorPlan=r),p(r)}),_("ngModelChange",function(r){m(e);let d=c();return p(d.onFloorPlanSelect(r))}),g(16,Ne,2,2,"option",26),a(),n(17,"button",46),_("click",function(){m(e);let r=c();return p(r.safeToggleFullscreen())}),n(18,"span",35),l(19,"fullscreen_exit"),a()()()()}if(s&2){let e=c();o(2),y((e.currentFloorPlan==null?null:e.currentFloorPlan.name)||"Mappa"),o(2),u("disabled",e.zoomLevel<=e.minZoom),o(7),v("",(e.zoomLevel*100).toFixed(0),"%"),o(),u("disabled",e.zoomLevel>=e.maxZoom),o(3),f("ngModel",e.currentFloorPlan),o(),u("ngForOf",e.floorPlans)}}function Be(s,t){if(s&1&&(n(0,"div",68)(1,"small"),l(2),a()()),s&2){let e=c().$implicit;o(2),v("Pren: ",e.currentReservation.customer_name)}}function qe(s,t){if(s&1&&(n(0,"div",68)(1,"small"),l(2),a()()),s&2){let e=c().$implicit,i=c();o(2),v("Ord: ",i.getTableOrderItemsCount(e)," piatti")}}function We(s,t){if(s&1){let e=x();n(0,"div",62),_("click",function(){let r=m(e).$implicit,d=c();return p(d.onTableClick(r))}),n(1,"div",63)(2,"div",64),l(3),a(),n(4,"div",65)(5,"div",66),l(6),n(7,"span",35),l(8,"person"),a()()(),g(9,Be,3,1,"div",67)(10,qe,3,1,"div",67),a()()}if(s&2){let e=t.$implicit,i=c();Z(i.getTableClass(e)),u("ngStyle",i.getTableStyle(e.table)),o(),V("text-large",i.isLargeText),o(2),y(e.table.table_number),o(3),y(e.table.capacity),o(3),u("ngIf",e.currentReservation),o(),u("ngIf",e.currentOrders)}}function $e(s,t){s&1&&(n(0,"div",69)(1,"span",35),l(2,"search_off"),a(),n(3,"h3"),l(4,"Nessun tavolo trovato"),a(),n(5,"p",13),l(6,"Modifica i filtri di ricerca"),a()())}function je(s,t){if(s&1){let e=x();n(0,"div",80)(1,"button",81),_("click",function(){m(e);let r=c(2);return p(r.openManualReservationModal())}),n(2,"span",35),l(3,"event"),a(),l(4," Crea Prenotazione "),a(),n(5,"button",34),_("click",function(){m(e);let r=c(2);return p(r.createNewOrderInSameTavolata())}),n(6,"span",35),l(7,"restaurant"),a(),l(8," Crea Ordine (Comanda 1) "),a()()}}function Qe(s,t){if(s&1){let e=x();n(0,"div",80)(1,"button",34),_("click",function(){m(e);let r=c(2);return p(r.openEditReservationModal())}),n(2,"span",35),l(3,"edit"),a(),l(4," Modifica Prenotazione "),a(),n(5,"button",82),_("click",function(){m(e);let r=c(2);return p(r.openCreateOrderModal())}),n(6,"span",35),l(7,"check"),a(),l(8," Conferma Arrivo "),a()()}}function Ze(s,t){if(s&1){let e=x();n(0,"div",80)(1,"button",34),_("click",function(){m(e);let r=c(3);return p(r.openCreateOrderModal())}),n(2,"span",35),l(3,"edit"),a(),l(4," Modifica Ordine "),a(),n(5,"button",85),_("click",function(){m(e);let r=c(3);return p(r.createNewOrderInSameTavolata())}),n(6,"span",35),l(7,"receipt_long"),a(),l(8," Nuovo Ordine "),a()()}if(s&2){let e=c(3);o(5),u("disabled",!e.currentTavolataId)}}function Ge(s,t){if(s&1){let e=x();n(0,"div",80)(1,"button",34),_("click",function(){m(e);let r=c(3);return p(r.createNewOrderInSameTavolata())}),n(2,"span",35),l(3,"restaurant"),a(),l(4," Crea Primo Ordine "),a()()}}function Ue(s,t){if(s&1){let e=x();n(0,"div",80),g(1,Ze,9,1,"div",78),n(2,"button",83),_("click",function(){m(e);let r=c(2);return p(r.viewBillPreview())}),n(3,"span",35),l(4,"visibility"),a(),l(5," Anteprima Conto "),a(),g(6,Ge,5,0,"div",78),n(7,"div",10)(8,"button",84),_("click",function(){m(e);let r=c(2);return p(r.openOrderDetails())}),n(9,"span",35),l(10,"receipt"),a(),l(11," Dettagli Ordine "),a(),n(12,"button",84),_("click",function(){m(e);let r=c(2);return p(r.closeOrderAndCreateBill())}),n(13,"span",35),l(14,"receipt_long"),a(),l(15," Chiudi Conto "),a()()()}if(s&2){let e=c(2);o(),u("ngIf",e.hasOrders()),o(5),u("ngIf",!e.hasOrders())}}function Ye(s,t){if(s&1){let e=x();n(0,"div",86)(1,"button",87),_("click",function(){m(e);let r=c(2);return p(r.freeTableManually())}),n(2,"span",35),l(3,"lock_open"),a(),l(4," Libera Tavolo "),a()()}}function Xe(s,t){if(s&1){let e=x();n(0,"div",70)(1,"div",71)(2,"div",72)(3,"div",40)(4,"div",73)(5,"span",35),l(6,"table_restaurant"),a()(),n(7,"div")(8,"h1",12),l(9),a()()(),n(10,"button",46),_("click",function(){m(e);let r=c();return p(r.deselectTable())}),n(11,"span",35),l(12,"close"),a()()(),n(13,"div",74)(14,"div",75)(15,"div",76)(16,"span",77),l(17),a()(),g(18,je,9,0,"div",78)(19,Qe,9,0,"div",78)(20,Ue,16,2,"div",78)(21,Ye,5,0,"div",79),a()()()()}if(s&2){let e=c();o(9),v("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number),o(7),Z(e.getStatusColorClass((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")),o(),v(" ",e.getStatusText((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")," "),o(),u("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="free"),o(),u("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="reserved"),o(),u("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="occupied"),o(),u("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)!=="free")}}function Ke(s,t){if(s&1&&(n(0,"option",101),l(1),a()),s&2){let e=t.$implicit,i=c(2);u("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),o(),R(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function Je(s,t){if(s&1){let e=x();n(0,"div",70)(1,"div",88)(2,"div",72)(3,"div",40)(4,"div",73)(5,"span",35),l(6,"event"),a()(),n(7,"div")(8,"h2",39),l(9),a()()(),n(10,"button",46),_("click",function(){m(e);let r=c();return p(r.closeManualReservationModal())}),n(11,"span",35),l(12,"close"),a()()(),n(13,"div",74)(14,"form",89,2),_("ngSubmit",function(r){return m(e),c().createManualReservation(),p(r.preventDefault())}),n(16,"div",22)(17,"div",23)(18,"label",24),l(19,"Nome Cliente *"),a(),n(20,"input",90),S("ngModelChange",function(r){m(e);let d=c();return T(d.manualReservationData.customer_name,r)||(d.manualReservationData.customer_name=r),p(r)}),a()(),n(21,"div",23)(22,"label",24),l(23,"Telefono *"),a(),n(24,"input",91),S("ngModelChange",function(r){m(e);let d=c();return T(d.manualReservationData.customer_phone,r)||(d.manualReservationData.customer_phone=r),p(r)}),a()()(),n(25,"div",22)(26,"div",23)(27,"label",24),l(28,"Data *"),a(),n(29,"input",92),S("ngModelChange",function(r){m(e);let d=c();return T(d.manualReservationData.reservation_date,r)||(d.manualReservationData.reservation_date=r),p(r)}),a()(),n(30,"div",23)(31,"label",24),l(32,"Orario *"),a(),n(33,"input",93),S("ngModelChange",function(r){m(e);let d=c();return T(d.manualReservationData.reservation_time,r)||(d.manualReservationData.reservation_time=r),p(r)}),a()()(),n(34,"div",23)(35,"label",24),l(36,"Numero Persone *"),a(),n(37,"select",94),S("ngModelChange",function(r){m(e);let d=c();return T(d.manualReservationData.party_size,r)||(d.manualReservationData.party_size=r),p(r)}),g(38,Ke,2,5,"option",95),a(),n(39,"div",96),l(40),a()(),n(41,"div",23)(42,"label",24),l(43,"Note Speciali"),a(),n(44,"textarea",97),S("ngModelChange",function(r){m(e);let d=c();return T(d.manualReservationData.special_requests,r)||(d.manualReservationData.special_requests=r),p(r)}),a()(),n(45,"div",98)(46,"button",99),_("click",function(){m(e);let r=c();return p(r.closeManualReservationModal())}),l(47," Annulla "),a(),n(48,"button",100)(49,"span",35),l(50,"add"),a(),l(51," Crea Prenotazione "),a()()()()()()}if(s&2){let e=k(15),i=c();o(9),v("Nuova Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number),o(11),f("ngModel",i.manualReservationData.customer_name),o(4),f("ngModel",i.manualReservationData.customer_phone),o(5),f("ngModel",i.manualReservationData.reservation_date),o(4),f("ngModel",i.manualReservationData.reservation_time),o(4),f("ngModel",i.manualReservationData.party_size),o(),u("ngForOf",G(10,Fe)),o(2),v(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),o(4),f("ngModel",i.manualReservationData.special_requests),o(4),u("disabled",!e.valid)}}function et(s,t){if(s&1&&(n(0,"option",101),l(1),a()),s&2){let e=t.$implicit,i=c(2);u("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),o(),R(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function tt(s,t){if(s&1){let e=x();n(0,"button",104),_("click",function(){m(e);let r=c(2);return p(r.deleteReservation())}),n(1,"span",35),l(2,"delete"),a(),l(3," Elimina "),a()}}function it(s,t){if(s&1){let e=x();n(0,"div",70)(1,"div",88)(2,"div",72)(3,"div",40)(4,"div",73)(5,"span",35),l(6,"edit"),a()(),n(7,"div")(8,"h1",12),l(9),a()()(),n(10,"button",46),_("click",function(){m(e);let r=c();return p(r.closeEditReservationModal())}),n(11,"span",35),l(12,"close"),a()()(),n(13,"div",74)(14,"form",89,2),_("ngSubmit",function(r){return m(e),c().updateReservation(),p(r.preventDefault())}),n(16,"div",22)(17,"div",23)(18,"label",24),l(19,"Nome Cliente *"),a(),n(20,"input",90),S("ngModelChange",function(r){m(e);let d=c();return T(d.editingReservation.customer_name,r)||(d.editingReservation.customer_name=r),p(r)}),a()(),n(21,"div",23)(22,"label",24),l(23,"Telefono *"),a(),n(24,"input",91),S("ngModelChange",function(r){m(e);let d=c();return T(d.editingReservation.customer_phone,r)||(d.editingReservation.customer_phone=r),p(r)}),a()()(),n(25,"div",22)(26,"div",23)(27,"label",24),l(28,"Data *"),a(),n(29,"input",92),S("ngModelChange",function(r){m(e);let d=c();return T(d.editingReservation.reservation_date,r)||(d.editingReservation.reservation_date=r),p(r)}),a()(),n(30,"div",23)(31,"label",24),l(32,"Orario *"),a(),n(33,"input",93),S("ngModelChange",function(r){m(e);let d=c();return T(d.editingReservation.reservation_time,r)||(d.editingReservation.reservation_time=r),p(r)}),a()()(),n(34,"div",23)(35,"label",24),l(36,"Numero Persone *"),a(),n(37,"select",94),S("ngModelChange",function(r){m(e);let d=c();return T(d.editingReservation.party_size,r)||(d.editingReservation.party_size=r),p(r)}),g(38,et,2,5,"option",95),a(),n(39,"div",96),l(40),a()(),n(41,"div",23)(42,"label",24),l(43,"Note Speciali"),a(),n(44,"textarea",97),S("ngModelChange",function(r){m(e);let d=c();return T(d.editingReservation.special_requests,r)||(d.editingReservation.special_requests=r),p(r)}),a()(),n(45,"div",98)(46,"div",102),g(47,tt,4,0,"button",103),n(48,"div",10)(49,"button",99),_("click",function(){m(e);let r=c();return p(r.closeEditReservationModal())}),l(50," Annulla "),a(),n(51,"button",100)(52,"span",35),l(53,"save"),a(),l(54," Salva "),a()()()()()()()()}if(s&2){let e=k(15),i=c();o(9),v("Modifica Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number),o(11),f("ngModel",i.editingReservation.customer_name),o(4),f("ngModel",i.editingReservation.customer_phone),o(5),f("ngModel",i.editingReservation.reservation_date),o(4),f("ngModel",i.editingReservation.reservation_time),o(4),f("ngModel",i.editingReservation.party_size),o(),u("ngForOf",G(11,Fe)),o(2),v(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),o(4),f("ngModel",i.editingReservation.special_requests),o(3),u("ngIf",i.isReservationDeletable(i.editingReservation)),o(4),u("disabled",!e.valid)}}function nt(s,t){if(s&1&&(n(0,"span",143),l(1),a()),s&2){let e=c(2);o(),v(" Comanda ",e.currentOrder.comanda_number," ")}}function rt(s,t){if(s&1&&(n(0,"option",54),l(1),w(2,"slice"),a()),s&2){let e=t.$implicit;u("ngValue",e),o(),I(" Ordine ",D(2,3,e.order_number,0,8),"... (",(e.orders==null?null:e.orders.length)||0," comande) ")}}function at(s,t){if(s&1){let e=x();n(0,"select",27),S("ngModelChange",function(r){m(e);let d=c(2);return T(d.currentOrderHeader,r)||(d.currentOrderHeader=r),p(r)}),_("ngModelChange",function(r){m(e);let d=c(2);return p(d.onOrderHeaderChange(r))}),g(1,rt,3,7,"option",26),a()}if(s&2){let e=c(2);f("ngModel",e.currentOrderHeader),o(),u("ngForOf",e.orderHeaders)}}function lt(s,t){if(s&1&&(n(0,"option",54),l(1),a()),s&2){let e=t.$implicit;u("ngValue",e),o(),I(" Comanda ",e.comanda_number," (",(e.order_items==null?null:e.order_items.length)||0," piatti) ")}}function ot(s,t){if(s&1&&(n(0,"option",144),l(1),w(2,"slice"),a()),s&2){let e=t.$implicit;u("value",e.id),o(),I(" ",D(2,3,e.name,0,10),"",e.name.length>10?"...":""," ")}}function st(s,t){if(s&1){let e=x();n(0,"div",126),_("click",function(){let r=m(e).$implicit,d=c(2);return p(d.selectedCategory=r.id)}),n(1,"span",35),l(2,"category"),a(),n(3,"span",127),l(4),w(5,"slice"),a(),n(6,"span",113),l(7),a()()}if(s&2){let e=t.$implicit,i=c(2);V("active",i.selectedCategory===e.id),o(4),I("",D(5,5,e.name,0,8),"",e.name.length>8?"...":""),o(3),y(i.getDishesCountByCategory(e.id))}}function dt(s,t){if(s&1&&(n(0,"small",113),l(1),w(2,"slice"),a()),s&2){let e=c().$implicit;o(),I(" ",D(2,2,e.description,0,40),"",e.description.length>40?"...":""," ")}}function ct(s,t){s&1&&(n(0,"span",35),l(1," add "),a())}function mt(s,t){s&1&&(n(0,"span",160),l(1," hourglass_empty "),a())}function pt(s,t){if(s&1){let e=x();n(0,"div",152)(1,"div",80)(2,"div",153)(3,"strong",154),l(4),a(),n(5,"span",155),l(6),w(7,"number"),a(),g(8,dt,3,6,"small",156),a(),n(9,"div",157)(10,"button",158),_("click",function(r){let d=m(e).$implicit;return c(4).addDishToCurrentOrder(d),p(r.stopPropagation())}),g(11,ct,2,0,"span",142)(12,mt,2,0,"span",159),a()()()()}if(s&2){let e=t.$implicit,i=c(4);o(4),y(e.name),o(2),v("\u20AC",C(7,6,e.base_price,"1.2-2")),o(2),u("ngIf",e.description),o(2),u("disabled",i.loadingItemOperations.has("add-dish-"+e.id+"-"+((i.currentOrder==null?null:i.currentOrder.id)||""))),o(),u("ngIf",!i.loadingItemOperations.has("add-dish-"+e.id+"-"+((i.currentOrder==null?null:i.currentOrder.id)||""))),o(),u("ngIf",i.loadingItemOperations.has("add-dish-"+e.id+"-"+((i.currentOrder==null?null:i.currentOrder.id)||"")))}}function ut(s,t){if(s&1&&(j(0),n(1,"div",146)(2,"div",147)(3,"span",148),l(4,"category"),a(),l(5),a(),n(6,"div",149),l(7),a()(),n(8,"div",150),g(9,pt,13,9,"div",151),a(),Q()),s&2){let e=t.$implicit;o(5),v(" ",e.category.name," "),o(2),y(e.dishes.length),o(2),u("ngForOf",e.dishes)}}function _t(s,t){if(s&1&&(j(0),g(1,ut,10,3,"ng-container",145),Q()),s&2){let e=c(2);o(),u("ngForOf",e.getDishesGroupedByCategory())}}function vt(s,t){if(s&1){let e=x();n(0,"div",69)(1,"span",35),l(2,"search_off"),a(),n(3,"p",13),l(4,"Nessun piatto trovato"),a(),n(5,"button",161),_("click",function(){m(e);let r=c(2);return p(r.resetDishFilters())}),l(6," Reset filtri "),a()()}}function gt(s,t){s&1&&(n(0,"span",35),l(1,"remove"),a())}function ht(s,t){s&1&&(n(0,"span",160),l(1," hourglass_empty "),a())}function bt(s,t){s&1&&(n(0,"span",35),l(1,"add"),a())}function xt(s,t){s&1&&(n(0,"span",160),l(1," hourglass_empty "),a())}function ft(s,t){s&1&&(n(0,"span",35),l(1,"delete"),a())}function Tt(s,t){s&1&&(n(0,"span",160),l(1," hourglass_empty "),a())}function St(s,t){if(s&1&&(n(0,"option",101),l(1),a()),s&2){let e=t.$implicit,i=c(6);u("value",e.id)("disabled",e.id===(i.currentOrder==null?null:i.currentOrder.id)),o(),v(" Comanda ",e.comanda_number," ")}}function wt(s,t){if(s&1){let e=x();n(0,"div",177)(1,"select",178,6),_("change",function(){m(e);let r=k(2),d=c(2).$implicit;return c(3).onComandaChange(d,r.value),p(r.value="")})("click",function(r){return m(e),p(r.stopPropagation())}),n(3,"option",179),l(4,"Sposta 1 piatto in..."),a(),g(5,St,2,3,"option",95),a()()}if(s&2){let e=c(5);o(5),u("ngForOf",e.tableComandas)}}function yt(s,t){if(s&1){let e=x();n(0,"button",180),_("click",function(r){m(e);let d=c(2).$implicit;return c(3).toggleMoveSelect(d.id),p(r.stopPropagation())}),n(1,"span",35),l(2,"swap_horiz"),a()()}}function Ct(s,t){if(s&1&&(n(0,"div",175),g(1,wt,6,1,"div",176)(2,yt,3,0,"ng-template",null,5,N),a()),s&2){let e=k(3),i=c().$implicit,r=c(3);o(),u("ngIf",r.isMoveSelectVisible(i.id))("ngIfElse",e)}}function Mt(s,t){if(s&1){let e=x();n(0,"div",168)(1,"div",169)(2,"div",109)(3,"strong"),l(4),a(),n(5,"div",112)(6,"span",113),l(7),w(8,"number"),a(),n(9,"span",113),l(10,"\u2022"),a(),n(11,"span",113),l(12),w(13,"number"),a()()(),n(14,"div",40)(15,"button",170),_("click",function(r){let d=m(e).$implicit;return c(3).updateComandaItemQuantity(d,-1),p(r.stopPropagation())}),g(16,gt,2,0,"span",142)(17,ht,2,0,"span",159),a(),n(18,"span",171),l(19),a(),n(20,"button",172),_("click",function(r){let d=m(e).$implicit;return c(3).updateComandaItemQuantity(d,1),p(r.stopPropagation())}),g(21,bt,2,0,"span",142)(22,xt,2,0,"span",159),a(),n(23,"button",173),_("click",function(r){let d=m(e).$implicit;return c(3).removeComandaItem(d),p(r.stopPropagation())}),g(24,ft,2,0,"span",142)(25,Tt,2,0,"span",159),a()()(),g(26,Ct,4,2,"div",174),a()}if(s&2){let e=t.$implicit,i=c(3);o(4),y(i.getDishName(e)),o(3),v("\u20AC",C(8,14,e.unit_price,"1.2-2")," cad."),o(5),v("Tot: \u20AC",C(13,17,e.total_price,"1.2-2")),o(3),u("disabled",i.loadingItemOperations.has("update-"+e.id)||i.loadingItemOperations.has("move-"+e.id)),o(),u("ngIf",!i.loadingItemOperations.has("update-"+e.id)),o(),u("ngIf",i.loadingItemOperations.has("update-"+e.id)),o(2),v(" ",e.quantity," "),o(),u("disabled",i.loadingItemOperations.has("update-"+e.id)||i.loadingItemOperations.has("move-"+e.id)),o(),u("ngIf",!i.loadingItemOperations.has("update-"+e.id)),o(),u("ngIf",i.loadingItemOperations.has("update-"+e.id)),o(),u("disabled",i.loadingItemOperations.has("update-"+e.id)||i.loadingItemOperations.has("delete-"+e.id)||i.loadingItemOperations.has("move-"+e.id)),o(),u("ngIf",!i.loadingItemOperations.has("delete-"+e.id)),o(),u("ngIf",i.loadingItemOperations.has("delete-"+e.id)),o(),u("ngIf",i.tableComandas.length>1)}}function Et(s,t){if(s&1&&(n(0,"div",131)(1,"span",113),l(2),a(),n(3,"strong",181),l(4),w(5,"number"),a()()),s&2){let e=c(3);o(2),v(" Totale generale (",e.tableComandas.length," comande): "),o(2),v(" \u20AC",C(5,2,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function Ot(s,t){if(s&1&&(n(0,"div"),g(1,Mt,27,20,"div",162),n(2,"div",163)(3,"div",164)(4,"strong",165),l(5,"Totale Comanda:"),a(),n(6,"strong",166),l(7),w(8,"number"),a()(),g(9,Et,6,5,"div",167),a()()),s&2){let e=c(2);o(),u("ngForOf",e.getOrderItems()),o(6),v(" \u20AC",C(8,3,e.getCurrentOrderTotal(),"1.2-2")," "),o(2),u("ngIf",e.tableComandas.length>1)}}function It(s,t){s&1&&(n(0,"div",182)(1,"span",183),l(2,"restaurant_menu"),a(),n(3,"p",13),l(4,"Nessun piatto in questa comanda"),a(),n(5,"p",184),l(6,"Clicca sui piatti per aggiungerli"),a()())}function kt(s,t){if(s&1){let e=x();n(0,"div",185)(1,"div",186)(2,"span",18),l(3,"check_circle"),a(),n(4,"div",177)(5,"strong",187),l(6,"Ordine salvato con successo!"),a(),n(7,"p",188),l(8,"Cosa vuoi fare ora?"),a()(),n(9,"button",46),_("click",function(){m(e);let r=c(2);return p(r.showOrderActionsAfterSave=!1)}),n(10,"span",35),l(11,"close"),a()()(),n(12,"div",189)(13,"button",81),_("click",function(){m(e);let r=c(2);return p(r.showOrderActionsAfterSave=!1)}),n(14,"span",35),l(15,"edit"),a(),l(16," Modifica Ordine "),a(),n(17,"button",82),_("click",function(){m(e);let r=c(2);return p(r.createNewOrderInSameTavolata())}),n(18,"span",35),l(19,"add"),a(),l(20," Nuovo Ordine "),a()()()}}function Vt(s,t){s&1&&(n(0,"span",35),l(1,"save"),a())}function Pt(s,t){s&1&&(n(0,"span",35),l(1,"block"),a())}function Ft(s,t){if(s&1){let e=x();n(0,"div",105),_("click",function(){m(e);let r=c();return p(r.closeCreateOrderModal())}),n(1,"div",106),_("click",function(r){return m(e),p(r.stopPropagation())}),n(2,"div",107)(3,"div",108)(4,"button",46),_("click",function(){m(e);let r=c();return p(r.closeCreateOrderModal())}),n(5,"span",35),l(6,"arrow_back"),a()(),n(7,"div",109)(8,"h1",110),l(9),g(10,nt,2,1,"span",111),a(),n(11,"div",112)(12,"span",113),l(13),w(14,"number"),a()()()(),n(15,"div",40),g(16,at,2,2,"select",114),n(17,"select",27),S("ngModelChange",function(r){m(e);let d=c();return T(d.currentOrder,r)||(d.currentOrder=r),p(r)}),_("ngModelChange",function(r){m(e);let d=c();return p(d.setCurrentComanda(r))}),g(18,lt,2,3,"option",26),a(),n(19,"button",115),_("click",function(){m(e);let r=c();return p(r.closeCreateOrderModal())}),n(20,"span",35),l(21,"close"),a()()()(),n(22,"div",116)(23,"div",117)(24,"div",22)(25,"div",118)(26,"input",119),S("ngModelChange",function(r){m(e);let d=c();return T(d.dishSearchTerm,r)||(d.dishSearchTerm=r),p(r)}),a()(),n(27,"div",120)(28,"select",121),S("ngModelChange",function(r){m(e);let d=c();return T(d.selectedCategory,r)||(d.selectedCategory=r),p(r)}),n(29,"option",28),l(30,"Tutte"),a(),g(31,ot,3,7,"option",122),a()(),n(32,"div",123)(33,"button",46),_("click",function(){m(e);let r=c();return p(r.resetDishFilters())}),n(34,"span",35),l(35,"refresh"),a()()()()(),n(36,"div",124)(37,"div",16)(38,"div",125)(39,"div",126),_("click",function(){m(e);let r=c();return p(r.selectedCategory="all")}),n(40,"span",35),l(41,"restaurant_menu"),a(),n(42,"span",127),l(43,"Tutti"),a(),n(44,"span",113),l(45),a()(),g(46,st,8,9,"div",128),a(),n(47,"div",80),g(48,_t,2,1,"ng-container",129)(49,vt,7,0,"ng-template",null,3,N),a()(),n(51,"div",16)(52,"div",130)(53,"div",131)(54,"h3",132)(55,"span",18),l(56,"receipt"),a(),l(57),a(),n(58,"span",133),l(59),a()()(),n(60,"div",134),g(61,Ot,10,6,"div",129)(62,It,7,0,"ng-template",null,4,N),a(),n(64,"div",125)(65,"button",126),_("click",function(){m(e);let r=c();return p(r.openOrderDetails())}),n(66,"span",35),l(67,"receipt_long"),a(),n(68,"span",127),l(69,"Dettagli"),a()(),n(70,"button",126),_("click",function(){m(e);let r=c();return p(r.createNewComanda())}),n(71,"span",35),l(72,"add_circle"),a(),n(73,"span",127),l(74,"Nuova Comanda"),a()(),n(75,"button",135),_("click",function(){m(e);let r=c();return p(r.viewBillPreview())}),n(76,"span",35),l(77,"visibility"),a(),n(78,"span",127),l(79,"Anteprima Conto"),a()(),n(80,"button",136),_("click",function(){m(e);let r=c();return p(r.closeOrderAndCreateBill())}),n(81,"span",35),l(82,"receipt"),a(),n(83,"span",127),l(84,"Chiudi Conto"),a()()()()(),g(85,kt,21,0,"div",137),a(),n(86,"div",138)(87,"button",139),_("click",function(){m(e);let r=c();return p(r.closeCreateOrderModal())}),n(88,"span",35),l(89,"close"),a(),l(90," Chiudi "),a(),n(91,"button",140),_("click",function(){m(e);let r=c();return p(r.createNewComanda())}),n(92,"span",35),l(93,"receipt"),a(),l(94," Nuova Comanda "),a(),n(95,"button",141),_("click",function(){m(e);let r=c();return p(r.saveComandaOrder())}),g(96,Vt,2,0,"span",142)(97,Pt,2,0,"span",142),l(98," Salva Ordine "),a()()()()}if(s&2){let e=k(50),i=k(63),r=c();o(),V("fullscreen-mobile",r.isMobile()),o(8),v(" Tavolo ",r.selectedTable==null?null:r.selectedTable.table_number," "),o(),u("ngIf",r.currentOrder),o(3),R(" ",r.getComandeCount()," piatto",r.getComandeCount()!==1?"i":""," \u2022 \u20AC",C(14,33,r.calcolaTotaleTavolata(),"1.2-2")," "),o(3),u("ngIf",r.orderHeaders.length>1),o(),f("ngModel",r.currentOrder),o(),u("ngForOf",r.getComandeInCurrentOrderHeader()),o(8),f("ngModel",r.dishSearchTerm),o(2),f("ngModel",r.selectedCategory),o(3),u("ngForOf",r.categories),o(5),V("mobile-vertical",r.isMobile()),o(3),V("active",r.selectedCategory==="all"),o(6),y(r.getDishesCountByCategory("all")),o(),u("ngForOf",r.categories.slice(0,4)),o(2),u("ngIf",r.getDishesGroupedByCategory().length>0)("ngIfElse",e),o(9),v(" Comanda ",(r.currentOrder==null?null:r.currentOrder.comanda_number)||"1"," "),o(2),I(" ",r.getOrderItems().length," piatto",r.getOrderItems().length!==1?"i":""," "),o(2),u("ngIf",r.getOrderItems().length>0)("ngIfElse",i),o(14),u("disabled",!r.hasOrders()),o(5),u("disabled",!r.getReadyForBillStatus()),o(5),u("ngIf",r.showOrderActionsAfterSave),o(6),u("disabled",!r.selectedTable),o(4),u("disabled",r.getOrderItems().length===0),o(),u("ngIf",r.getOrderItems().length>0),o(),u("ngIf",r.getOrderItems().length===0)}}function Rt(s,t){if(s&1&&(n(0,"div",223)(1,"small",13),l(2),a()()),s&2){let e=c().$implicit;o(2),v("Note: ",e.item_notes)}}function Dt(s,t){if(s&1&&(n(0,"div",218)(1,"div",109)(2,"div",219)(3,"span",220),l(4),a(),n(5,"div")(6,"strong"),l(7),a(),g(8,Rt,3,1,"div",221),a()(),n(9,"div",222)(10,"span"),l(11),w(12,"number"),a(),n(13,"span"),l(14,"\u2022"),a(),n(15,"span"),l(16),a()()(),n(17,"div",202)(18,"span",39),l(19),w(20,"number"),a(),n(21,"small",13),l(22,"Totale"),a()()()),s&2){let e=t.$implicit,i=c(7);o(3),u("ngClass",i.getOrderStatusColor(e.status)),o(),v(" ",i.getOrderStatusText(e.status)," "),o(3),y(i.getDishName(e)),o(),u("ngIf",e.item_notes),o(3),v("\u20AC",C(12,7,e.unit_price,"1.2-2")," cad."),o(5),v("Quantit\xE0: ",e.quantity),o(3),v("\u20AC",C(20,10,e.total_price,"1.2-2"))}}function Ht(s,t){if(s&1&&(n(0,"div",216),g(1,Dt,23,13,"div",217),a()),s&2){let e=c(2).$implicit;o(),u("ngForOf",e.order_items)}}function At(s,t){s&1&&(n(0,"div",224)(1,"span",35),l(2,"restaurant_menu"),a(),n(3,"p",13),l(4,"Nessun piatto in questa comanda"),a()())}function zt(s,t){if(s&1&&(n(0,"div",213),g(1,Ht,2,1,"div",214)(2,At,5,0,"div",215),a()),s&2){let e=c().$implicit;o(),u("ngIf",e.order_items&&e.order_items.length>0),o(),u("ngIf",!e.order_items||e.order_items.length===0)}}function Nt(s,t){if(s&1){let e=x();n(0,"div",207)(1,"div",208),_("click",function(){let r=m(e).$implicit,d=c(4);return p(d.toggleOrderExpansion(r.id))}),n(2,"div",40)(3,"span",209),l(4),a(),n(5,"div",200)(6,"div",40)(7,"h4",39),l(8),a(),n(9,"span",210),l(10),a()(),n(11,"div",188),l(12),a()()(),n(13,"div",57)(14,"span",211),l(15),w(16,"number"),a()()(),g(17,zt,3,2,"div",212),a()}if(s&2){let e=t.$implicit,i=c(4);o(4),v(" ",i.isOrderExpanded(e.id)?"expand_less":"expand_more"," "),o(4),v("Comanda ",e.comanda_number),o(),u("ngClass",i.getOrderStatusColor(i.getOverallOrderStatus(e))),o(),v(" ",i.getOrderStatusText(i.getOverallOrderStatus(e))," "),o(2),I(" ",(e.order_items==null?null:e.order_items.length)||0," piatto",(e.order_items==null?null:e.order_items.length)!==1?"i":""," "),o(3),v(" \u20AC",C(16,8,i.getOrderTotal(e),"1.2-2")," "),o(2),u("ngIf",i.isOrderExpanded(e.id))}}function Lt(s,t){if(s&1&&(n(0,"div",163),g(1,Nt,18,11,"div",204),n(2,"div",205)(3,"div",200)(4,"strong",165),l(5),a(),n(6,"small",13),l(7),a()(),n(8,"strong",206),l(9),w(10,"number"),a()()()),s&2){let e=c().$implicit,i=c(2);o(),u("ngForOf",e.orders),o(4),v("Totale Ordine ",e.order_number),o(2),v("",(e.orders==null?null:e.orders.length)||0," comande"),o(2),v(" \u20AC",C(10,4,i.calcolaTotaleOrderHeader(e),"1.2-2")," ")}}function Bt(s,t){if(s&1){let e=x();n(0,"div",21)(1,"div",198),_("click",function(){let r=m(e).$implicit,d=c(2);return p(d.toggleOrderHeaderExpansion(r.id))}),n(2,"div",199)(3,"span",18),l(4),a(),n(5,"div",200)(6,"div",40)(7,"h3",39),l(8),a(),n(9,"span",201),l(10),a()(),n(11,"div",188),l(12),w(13,"date"),a()()(),n(14,"div",57)(15,"div",202)(16,"span",149),l(17),w(18,"number"),a(),n(19,"span",113),l(20,"Totale ordine"),a()()()(),g(21,Lt,11,7,"div",203),a()}if(s&2){let e=t.$implicit,i=c(2);o(4),v(" ",i.isOrderHeaderExpanded(e.id)?"expand_less":"expand_more"," "),o(4),v("Ordine ",e.order_number),o(2),I(" ",(e.orders==null?null:e.orders.length)||0," comanda",(e.orders==null?null:e.orders.length)!==1?"e":""," "),o(2),v(" ",C(13,7,e.created_at,"dd/MM/yyyy HH:mm")," "),o(5),v(" \u20AC",C(18,10,i.calcolaTotaleOrderHeader(e),"1.2-2")," "),o(4),u("ngIf",i.isOrderHeaderExpanded(e.id))}}function qt(s,t){s&1&&(n(0,"div",69)(1,"span",35),l(2,"receipt"),a(),n(3,"h3"),l(4,"Nessun ordine attivo"),a(),n(5,"p",13),l(6,"Non ci sono ordini per questo tavolo"),a()())}function Wt(s,t){if(s&1&&(n(0,"div",225)(1,"div",131)(2,"div")(3,"strong",226),l(4,"TOTALE TAVOLO"),a(),n(5,"p",227),l(6),a()(),n(7,"strong",228),l(8),w(9,"number"),a()()()),s&2){let e=c(2);o(6),R(" ",e.orderHeaders.length," ordine",e.orderHeaders.length!==1?"i":""," \u2022 ",e.getTotalComandeCount()," comande "),o(2),v(" \u20AC",C(9,4,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function $t(s,t){if(s&1){let e=x();n(0,"div",70)(1,"div",190)(2,"div",72)(3,"div",40)(4,"div",73)(5,"span",35),l(6,"receipt_long"),a()(),n(7,"div")(8,"h1",12),l(9),a(),n(10,"div",191)(11,"span",133),l(12),a(),n(13,"span",77),l(14),w(15,"number"),a()()()(),n(16,"button",46),_("click",function(){m(e);let r=c();return p(r.closeOrderDetailsModal())}),n(17,"span",35),l(18,"close"),a()()(),n(19,"div",74)(20,"div",75),g(21,Bt,22,13,"div",192)(22,qt,7,0,"div",51)(23,Wt,10,7,"div",193),a(),n(24,"div",194)(25,"div",195)(26,"button",196),_("click",function(){m(e);let r=c();return p(r.closeOrderAndCreateBill())}),n(27,"span",35),l(28,"receipt"),a(),l(29),a(),n(30,"button",197),_("click",function(){m(e);let r=c();return p(r.openCreateOrderModal())}),n(31,"span",35),l(32,"add"),a(),l(33," Aggiungi Piatti "),a(),n(34,"button",83),_("click",function(){m(e);let r=c();return p(r.viewBillPreview())}),n(35,"span",35),l(36,"visibility"),a(),l(37," Anteprima Conto "),a(),n(38,"button",83),_("click",function(){m(e);let r=c();return p(r.closeOrderDetailsModal())}),n(39,"span",35),l(40,"close"),a(),l(41," Chiudi "),a()()()()()()}if(s&2){let e=c();o(9),v("Ordini Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number),o(3),I(" ",e.orderHeaders.length," Ordine",e.orderHeaders.length!==1?"i":""," "),o(2),v(" Totale: \u20AC",C(15,9,e.calcolaTotaleTavolata(),"1.2-2")," "),o(7),u("ngForOf",e.orderHeaders),o(),u("ngIf",e.orderHeaders.length===0),o(),u("ngIf",e.orderHeaders.length>0),o(3),u("disabled",e.orderHeaders.length===0),o(3),v(" ",e.isReadyForBill()?"CHIUDI CONTO":"Chiudi Conto"," ")}}function jt(s,t){if(s&1){let e=x();n(0,"div",105),_("click",function(){m(e);let r=c();return p(r.showBillPreviewModal=!1)}),n(1,"div",229),_("click",function(r){return m(e),p(r.stopPropagation())}),n(2,"div",72)(3,"div",40)(4,"div",73)(5,"span",35),l(6,"receipt"),a()(),n(7,"div")(8,"h2",39),l(9,"Anteprima Conto"),a(),n(10,"p",113),l(11),a()()(),n(12,"button",46),_("click",function(){m(e);let r=c();return p(r.showBillPreviewModal=!1)}),n(13,"span",35),l(14,"close"),a()()(),n(15,"div",74),P(16,"div",230,7),n(18,"div",98)(19,"button",231),_("click",function(){m(e);let r=c();return p(r.showBillPreviewModal=!1)}),n(20,"span",35),l(21,"close"),a(),l(22," Chiudi "),a(),n(23,"button",34),_("click",function(){m(e);let r=c();return p(r.closeOrderAndCreateBill())}),n(24,"span",35),l(25,"print"),a(),l(26," Stampa Scontrino "),a()()()()()}if(s&2){let e=c();o(11),I("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number," - ",e.selectedTable==null?null:e.selectedTable.table_name),o(5),u("innerHTML",e.billPreviewHtml,te)}}var Pe=class s{floorPlanService=E(Ve);tableService=E(ke);reservationService=E(Ee);orderService=E(Ie);dishService=E(Ce);tableStatusService=E(L);categoryService=E(Me);tavolataService=E(Oe);mapContainer;mapCard;billPreviewContent;get floorPlans(){return this.floorPlanService.data}get tables(){return this.tableService.data}get dishes(){return this.dishService.data.filter(t=>t.status==="available")}get categories(){return this.categoryService.data}currentFloorPlan=null;tableStatuses=[];selectedTable=null;selectedTableStatus=null;isLargeText=!1;isFullscreen=!1;showOrderActionsAfterSave=!1;orderSaveMode="edit";restaurantNameCache="";restaurantNamePromise=null;restaurantName="";currentRestaurant=null;zoomLevel=1;minZoom=.5;maxZoom=3;showBillPreviewModal=!1;billPreviewHtml="";currentOrder=null;currentTavolataId=null;orderHeaders=[];selectedOrderHeader=null;currentOrderHeader=null;orderHeadersExpanded={};ordersExpanded={};loadingDishes=!1;dishCache={};lastFilterKey="";showQuickActionsModal=!1;showManualReservationModal=!1;showEditReservationModal=!1;showCreateOrderModal=!1;showOrderDetailsModal=!1;shouldAutoPrint=!0;manualReservationData={customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};loadingItemOperations=new Set;mobileView=!1;editingReservation=null;searchTerm="";statusFilter="all";selectedCategory="all";dishSearchTerm="";showMoveSelectForItem=null;subscriptions=new J;get freeTablesCount(){return this.tableStatuses.filter(t=>t.status==="free").length}get reservedTablesCount(){return this.tableStatuses.filter(t=>t.status==="reserved").length}get occupiedTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied").length}get totalTablesCount(){return this.tableStatuses.length}get readyForBillTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied"&&this.tableStatusService.areAllTableItemsServed(t.currentOrders||[])).length}get currentOrders(){return this.selectedTableStatus?.currentOrders||[]}ngOnInit(){this.loadData(),this.loadCurrentRestaurant(),this.setupSubscriptions(),this.setupFullscreenListeners(),this.checkMobileView(),window.addEventListener("resize",()=>this.checkMobileView()),this.setupZoomListeners()}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanupFullscreenListeners(),window.removeEventListener("resize",()=>this.checkMobileView())}setupSubscriptions(){this.subscriptions.add(this.floorPlanService.data$.subscribe(()=>{this.floorPlans.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=this.floorPlans[0],this.loadTablesForFloorPlan())})),this.subscriptions.add(this.tableService.data$.subscribe(()=>{this.currentFloorPlan&&this.loadTablesForFloorPlan()}))}setupFullscreenListeners(){document.addEventListener("fullscreenchange",this.handleFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange)}cleanupFullscreenListeners(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange)}handleFullscreenChange=()=>{let t=this.mapCard?.nativeElement;this.isFullscreen=document.fullscreenElement===t||document.webkitFullscreenElement===t||document.msFullscreenElement===t,this.isFullscreen?this.adjustMapForFullscreen():this.resetMapFromFullscreen()};loadData(){return h(this,null,function*(){try{yield Promise.all([this.floorPlanService.loadFloorPlans(),this.tableService.loadData(),this.dishService.loadDishes(),this.categoryService.loadCategories()]),this.floorPlans.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=this.floorPlans[0],yield this.loadTablesForFloorPlan())}catch(t){console.error("Error loading data:",t)}})}loadTablesForFloorPlan(){return h(this,null,function*(){if(!this.currentFloorPlan){this.tableStatuses=[];return}let t=this.tableService.getTablesByFloorPlan(this.currentFloorPlan.id);yield this.updateTableStatusesSmart(t)})}updateTableStatusesSmart(t){return h(this,null,function*(){if(!t||t.length===0){this.tableStatuses=[];return}try{let e=t.filter(i=>!i.is_merged||i.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(e),this.selectedTable&&(this.selectedTableStatus=this.tableStatuses.find(i=>i.table.id===this.selectedTable?.id)||null)}catch(e){console.error("Error updating table statuses:",e),this.tableStatuses=[]}})}onTableClick(t){return h(this,null,function*(){this.selectedTable=t.table,this.selectedTableStatus=t,this.currentOrder=null,this.currentOrderHeader=null,this.orderHeaders=[],this.currentTavolataId=yield this.tavolataService.getCurrentTavolataId(t.table.id),console.log("DEBUG - Tavolo cliccato:",{tableId:t.table.id,tavolataId:this.currentTavolataId,hasCurrentOrders:t.currentOrders?.length||0}),this.currentTavolataId?yield this.loadOrderHeadersForTavolata(this.currentTavolataId):this.currentTavolataId=null,this.showQuickActionsModal=!0})}deselectTable(){this.selectedTable=null,this.selectedTableStatus=null,this.currentOrder=null,this.currentTavolataId=null,this.orderHeaders=[],this.showQuickActionsModal=!1}loadOrderHeadersForTavolata(t){return h(this,null,function*(){if(!t){this.orderHeaders=[],this.currentOrderHeader=null,this.currentOrder=null;return}try{let{data:e,error:i}=yield this.orderService.supabaseService.getSupabaseClient().from("order_headers").select(`
        *,
        orders (*,
          order_items (*,
            dishes (name, base_price, category_id)
          )
        )
      `).eq("tavolata_id",t).order("created_at",{ascending:!0});if(i)throw i;if(this.orderHeaders=e||[],console.log("DEBUG - Order headers:",{count:this.orderHeaders.length,headers:this.orderHeaders.map(r=>({id:r.id,tavolata_id:r.tavolata_id,orders_count:r.orders?.length||0,orders:r.orders?.map(d=>`Comanda ${d.comanda_number}`)}))}),this.orderHeaders.length===0){yield this.createNewOrderInSameTavolata();return}if(this.currentOrderHeader=this.orderHeaders[0],this.selectedOrderHeader=this.orderHeaders[0],this.currentOrderHeader.orders&&this.currentOrderHeader.orders.length>0){let r=this.currentOrderHeader.orders.sort((d,b)=>(d.comanda_number||0)-(b.comanda_number||0));this.currentOrder=r[0],console.log("DEBUG - Current comanda impostata:",this.currentOrder?.comanda_number)}else yield this.createNewComanda()}catch(e){console.error("Errore caricamento order_headers:",e),this.orderHeaders=[],this.currentOrderHeader=null,this.currentOrder=null}})}createNewOrderInSameTavolata(){return h(this,null,function*(){if(!this.selectedTableStatus?.table){alert("Impossibile creare nuovo ordine: nessun tavolo selezionato");return}try{let t=this.selectedTableStatus.table,e=yield this.getCurrentRestaurantId();if(!e)return;this.currentTavolataId||(this.currentTavolataId=yield this.tavolataService.startNewTavolata(t.id));let{data:i,error:r}=yield this.orderService.supabaseService.getSupabaseClient().from("order_headers").insert({restaurant_id:e,table_id:t.id,tavolata_id:this.currentTavolataId,order_number:`ORD-${Date.now()}-${Math.floor(Math.random()*1e3)}`,status:"active",customer_name:"Cliente",customer_phone:"",total_amount:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(r)throw r;let d=yield this.orderService.createOrderForHeader(t.id,i.id,this.currentTavolataId);if(!d){alert("Errore creazione nuova comanda");return}this.currentOrderHeader=i,this.selectedOrderHeader=i,this.currentOrder=d,this.orderHeaders=[i],i.orders?i.orders=[d]:i.orders=[d],yield this.updateSingleTableStatus(t.id),this.showQuickActionsModal=!1,this.showCreateOrderModal=!0}catch(t){console.error("Errore creazione nuovo ordine:",t),alert("Errore creazione nuovo ordine")}})}createNewComanda(){return h(this,null,function*(){if(!this.selectedTableStatus||!this.selectedOrderHeader){alert("Impossibile creare nuova comanda");return}try{let t=this.selectedTableStatus.table,e=yield this.getCurrentRestaurantId();if(!e)return;let r=(this.selectedOrderHeader.orders||[]).map(O=>O.comanda_number).filter(O=>!isNaN(O)).map(O=>Number(O)),d=r.length>0?Math.max(...r)+1:1,b={restaurant_id:e,table_id:t.id,order_header_id:this.selectedOrderHeader.id,tavolata_id:this.currentTavolataId,comanda_number:d,order_number:`COM-${Date.now()}-${d}`,order_type:"dine_in",status:"received",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,customer_name:"Cliente",customer_phone:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:M,error:F}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").insert(b).select().single();if(F)throw F;this.currentOrder=M,this.selectedOrderHeader.orders||(this.selectedOrderHeader.orders=[]),this.selectedOrderHeader.orders.push(M),this.currentOrderHeader?.id===this.selectedOrderHeader.id&&(this.currentOrderHeader=this.selectedOrderHeader),console.log(`\u2705 Nuova comanda ${d} creata e selezionata automaticamente`)}catch(t){console.error("Errore creazione nuova comanda:",t),alert("Errore creazione nuova comanda")}})}getComandeInCurrentOrderHeader(){let t=this.currentOrderHeader?.orders||[];return console.log("DEBUG - Comande disponibili:",t.map(e=>({id:e.id,comanda:e.comanda_number,items:e.order_items?.length||0}))),!t||t.length===0?[]:[...t].sort((e,i)=>(e.comanda_number||0)-(i.comanda_number||0))}onOrderHeaderChange(t){if(console.log("\u{1F504} Order header cambiato:",t.id),this.selectedOrderHeader=t,t.orders&&t.orders.length>0){let e=t.orders.sort((i,r)=>(i.comanda_number||0)-(r.comanda_number||0));this.currentOrder=e[0],console.log("\u2705 Impostata comanda:",this.currentOrder?.comanda_number)}else this.currentOrder=null}getTableClass(t){let e=["table-element",`shape-${t.table.shape}`];return e.push(t.status),this.selectedTable?.id===t.table.id&&e.push("selected"),e.join(" ")}getTableStyle(t){let e=t.shape==="rectangle"||t.shape==="square"?"0px":"50%";return{left:t.position_x+"px",top:t.position_y+"px",width:t.width+"px",height:t.height+"px","border-radius":e,transform:`rotate(${t.rotation}deg)`}}openCreateOrderModal(){return h(this,null,function*(){this.selectedTableStatus&&(yield Promise.all([this.loadDishesIfNeeded(),this.categoryService.loadCategories()]),this.showQuickActionsModal=!1,this.showCreateOrderModal=!0)})}closeCreateOrderModal(){this.showCreateOrderModal=!1}addDishToCurrentOrder(t){return h(this,null,function*(){if(!this.currentOrder){console.warn("\u26A0\uFE0F Nessun ordine corrente selezionato");return}let e=`add-dish-${t.id}-${this.currentOrder.id}`;if(!this.loadingItemOperations.has(e)){this.loadingItemOperations.add(e);try{let i={id:t.id,base_price:t.base_price,name:t.name};(yield this.orderService.addDishToOrder(this.currentOrder.id,i,1,""))&&(yield this.refreshCurrentOrder(),this.selectedTable?.id&&(yield this.updateSingleTableStatus(this.selectedTable.id)),this.showQuickAddFeedback(t.name))}catch(i){console.error("Error adding dish to order:",i),yield this.refreshCurrentOrder()}finally{setTimeout(()=>{this.loadingItemOperations.delete(e)},300)}}})}updateSingleTableStatus(t){return h(this,null,function*(){let e=this.tables.find(i=>i.id===t);if(e)try{let i=yield this.tableStatusService.calculateTableStatus([e]);if(i.length>0){let r=i[0],d=this.tableStatuses.findIndex(b=>b.table.id===t);d!==-1?this.tableStatuses[d]=r:this.tableStatuses.push(r),this.selectedTable?.id===t&&(this.selectedTableStatus=r)}}catch(i){console.error("Error updating single table status:",i)}})}refreshCurrentOrder(){return h(this,null,function*(){if(this.currentOrder?.id)try{let t=yield this.orderService.refreshOrder(this.currentOrder.id);if(t&&(this.currentOrder=t,this.currentOrderHeader?.orders)){let e=this.currentOrderHeader.orders.findIndex(i=>i.id===t.id);e!==-1&&(this.currentOrderHeader.orders[e]=t)}}catch(t){console.error("Errore in refreshCurrentOrder:",t)}})}getOrderItems(t){return(t||this.currentOrder)?.order_items||[]}getCurrentOrderTotal(){return this.getOrderItems().reduce((t,e)=>t+(e.total_price||0),0)}getOrderTotal(t){return this.orderService.calculateOrderTotal(t)}getDishName(t){return t.dish_name?t.dish_name:t.dishes?.name?t.dishes.name:t.dish?.name?t.dish.name:"Piatto senza nome"}getFilteredTables(){let t=this.tableStatuses;if(this.statusFilter!=="all"&&(t=t.filter(e=>e.status===this.statusFilter)),this.searchTerm){let e=this.searchTerm.toLowerCase();t=t.filter(i=>i.table.table_number.toLowerCase().includes(e)||i.table.table_name.toLowerCase().includes(e))}return t}getFilteredDishes(){let t=this.dishes;if(this.selectedCategory!=="all"&&(t=t.filter(e=>e.category_id===this.selectedCategory)),this.dishSearchTerm){let e=this.dishSearchTerm.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(e)||i.description&&i.description.toLowerCase().includes(e))}return t}get tableComandas(){return this.getComandeInCurrentOrderHeader()}get tableOrders(){return this.selectedTableStatus?.currentOrders||[]}hasOrders(){return(this.selectedTableStatus?.currentOrders?.length||0)>0}getComandeCount(){return this.selectedTableStatus?.currentOrders?.length||0}isReadyForBill(){let t=this.selectedTableStatus?.currentOrders||[];return t.length===0?!1:t.every(e=>this.orderService.areAllItemsServed(e))}getDishesGroupedByCategory(){let t=this.getFilteredDishes();if(t.length===0)return[];if(this.selectedCategory!=="all"){let i=this.categories.find(r=>r.id===this.selectedCategory);return i?[{category:i,dishes:t}]:[]}let e=new Map;return this.categories.forEach(i=>{e.set(i.id,{category:i,dishes:[]})}),e.set("no-category",{category:{id:"no-category",name:"Senza categoria",order_index:999},dishes:[]}),t.forEach(i=>{let r=i.category_id||"no-category";e.has(r)||e.set(r,{category:{id:r,name:"Categoria",order_index:998},dishes:[]}),e.get(r).dishes.push(i)}),Array.from(e.values()).filter(i=>i.dishes.length>0).sort((i,r)=>(i.category.order_index||0)-(r.category.order_index||0))}getDishesCountByCategory(t){return t==="all"?this.dishes.length:this.dishes.filter(e=>e.category_id===t).length}getCategoryName(t){let e=this.categories.find(i=>i.id===t);return e?e.name:"Senza categoria"}resetDishFilters(){this.selectedCategory="all",this.dishSearchTerm=""}get statistics(){return{free:this.freeTablesCount,reserved:this.reservedTablesCount,occupied:this.occupiedTablesCount,total:this.totalTablesCount,readyForBill:this.readyForBillTablesCount}}toggleSize(){this.isLargeText=!this.isLargeText}safeToggleFullscreen(){return h(this,null,function*(){try{this.isFullscreen?yield this.exitFullscreen():yield this.enterFullscreen()}catch(t){console.error("Error toggling fullscreen:",t)}})}enterFullscreen(){return h(this,null,function*(){let t=this.mapCard?.nativeElement;t&&(t.requestFullscreen?yield t.requestFullscreen():t.webkitRequestFullscreen?yield t.webkitRequestFullscreen():t.msRequestFullscreen&&(yield t.msRequestFullscreen()),this.isFullscreen=!0,this.adjustMapForFullscreen())})}exitFullscreen(){return h(this,null,function*(){document.exitFullscreen?yield document.exitFullscreen():document.webkitExitFullscreen?yield document.webkitExitFullscreen():document.msExitFullscreen&&(yield document.msExitFullscreen()),this.isFullscreen=!1,document.body.classList.remove("table-map-fullscreen"),this.resetMapFromFullscreen(),this.resetZoom()})}getCurrentRestaurantId(){return h(this,null,function*(){return yield this.tavolataService.getCurrentRestaurantId()})}checkMobileView(){this.mobileView=window.innerWidth<=768}isMobile(){return this.mobileView}loadDishesIfNeeded(){return h(this,null,function*(){this.dishes.length===0&&!this.loadingDishes&&(this.loadingDishes=!0,yield this.dishService.loadDishes(),this.loadingDishes=!1)})}showQuickAddFeedback(t){if(this.mobileView){let e=document.createElement("div");e.innerHTML=`
        <div style="
          position: fixed;
          bottom: 100px;
          left: 50%;
          transform: translateX(-50%);
          background: var(--primary);
          color: white;
          padding: 12px 24px;
          border-radius: 24px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.2);
          z-index: 9999;
          font-weight: 600;
          display: flex;
          align-items: center;
          gap: 8px;
        ">
          <span class="material-icons">check_circle</span>
          ${t} aggiunto!
        </div>
      `,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&document.body.removeChild(e)},1500)}}getStatusColorClass(t){return`status-${t}`}getStatusText(t){return{free:"Libero",reserved:"Prenotato",occupied:"Occupato"}[t]||t}openManualReservationModal(){if(!this.selectedTable)return;let t=new Date;this.manualReservationData={customer_name:"",customer_phone:"",reservation_date:t.toISOString().split("T")[0],reservation_time:t.toTimeString().split(" ")[0].substring(0,5),party_size:this.selectedTable.capacity||2,special_requests:""},this.showQuickActionsModal=!1,this.showManualReservationModal=!0}closeManualReservationModal(){this.showManualReservationModal=!1}createManualReservation(){return h(this,null,function*(){if(this.selectedTable)try{let t={restaurant_id:this.selectedTable.restaurant_id,table_id:this.selectedTable.id,reservation_date:this.manualReservationData.reservation_date,reservation_time:this.manualReservationData.reservation_time,party_size:this.manualReservationData.party_size,special_requests:this.manualReservationData.special_requests,status:"confirmed",customer_id:null,customer_name:this.manualReservationData.customer_name,customer_phone:this.manualReservationData.customer_phone},{data:e,error:i}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").insert(t).select().single();if(i)throw i;this.closeManualReservationModal(),yield this.loadData(),alert("Prenotazione creata con successo!")}catch(t){console.error("Error creating manual reservation:",t),alert("Errore durante la creazione della prenotazione: "+t.message)}})}openEditReservationModal(){this.selectedTableStatus?.currentReservation&&(this.editingReservation=$({},this.selectedTableStatus.currentReservation),this.showEditReservationModal=!0,this.showQuickActionsModal=!1)}closeEditReservationModal(){this.showEditReservationModal=!1,this.editingReservation=null}updateReservation(){return h(this,null,function*(){if(this.editingReservation)try{let{error:t}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").update(K($({},this.editingReservation),{updated_at:new Date().toISOString()})).eq("id",this.editingReservation.id);if(t)throw t;yield this.loadData(),this.closeEditReservationModal(),this.deselectTable()}catch(t){console.error("Errore nell'aggiornamento della prenotazione:",t),alert("Errore durante l'aggiornamento della prenotazione")}})}deleteReservation(){return h(this,null,function*(){if(this.editingReservation&&this.isReservationDeletable(this.editingReservation))try{let{error:t}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").delete().eq("id",this.editingReservation.id);if(t)throw t;yield this.loadData(),this.closeEditReservationModal(),this.deselectTable()}catch(t){console.error("Errore nell'eliminazione della prenotazione:",t),alert("Errore durante l'eliminazione della prenotazione")}else alert("Impossibile eliminare questa prenotazione")})}isReservationDeletable(t){if(!t?.reservation_date||!t?.reservation_time)return!1;try{return new Date(`${t.reservation_date}T${t.reservation_time}`)>new Date}catch(e){return console.error("Errore nel parsing della data:",e),!1}}closeOrderAndCreateBill(){return h(this,null,function*(){if(!this.selectedTableStatus||!this.currentTavolataId){alert("Nessun ordine attivo per questo tavolo");return}if(confirm(`Sei sicuro di voler chiudere il conto?

Se ci sono ordini aperti, verranno chiusi.`))try{let e=this.calcolaTotaleTavolata();if(!(yield this.orderService.closeTavolata(this.selectedTableStatus.table.id,this.currentTavolataId))){alert("Errore durante la chiusura del conto");return}this.stampaScontrinoFiscale(e),yield this.loadData(),this.deselectTable(),this.showBillPreviewModal=!1}catch(e){console.error("Error closing order:",e),alert("Errore durante la chiusura del conto")}})}viewBillPreview(){return h(this,null,function*(){if(!this.selectedTableStatus||!this.currentTavolataId){alert("Nessun ordine attivo per questo tavolo");return}yield this.loadOrderHeadersForTavolata(this.currentTavolataId),this.billPreviewHtml=this.generateBillPreviewHtml(),this.showBillPreviewModal=!0})}generateBillPreviewHtml(){let t=new Date().toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return`
    <div class="bill-preview">
      <!-- HEADER -->
      <div class="header text-center mb-lg">
        <!-- Usa il metodo helper -->
        <h1 class="text-primary text-lg font-bold">${this.getRestaurantName()}</h1>
        <p class="text-muted mt-sm"><strong>Tavolo:</strong> ${this.selectedTable?.table_number||"N/A"} - ${this.selectedTable?.table_name||""}</p>
        <p class="text-muted">${t}</p>
      </div>

      <!-- CONTENUTO ORDINI -->
      <div class="order-sections">
        ${this.orderHeaders.map((e,i)=>{let r=this.calcolaTotaleOrderHeader(e);return`
            <div class="form-card mb-lg">
              <div class="section-title text-primary font-bold mb-md">ORDINE ${i+1}</div>
              ${e.orders?.map(d=>{let b=this.getOrderTotal(d);return`
                  <div class="comanda mb-md p-md border rounded">
                    <div class="comanda-header font-semibold text-md mb-sm">Comanda ${d.comanda_number||1}</div>
                    <div class="items">
                      ${d.order_items?.length>0?d.order_items.map(M=>`
                          <div class="item flex justify-between mb-xs">
                            <span class="item-name">${M.quantity||1} \xD7 ${M.dishes?.name||"Piatto"}</span>
                            <span class="item-price font-semibold">\u20AC${(M.total_price||0).toFixed(2)}</span>
                          </div>
                        `).join(""):'<em class="text-muted">Nessun piatto</em>'}
                    </div>
                    <div class="comanda-total flex justify-between mt-sm pt-sm border-t">
                      <span class="font-semibold">Totale comanda</span>
                      <span class="font-semibold text-primary">\u20AC${b.toFixed(2)}</span>
                    </div>
                  </div>
                `}).join("")||""}
              <div class="header-total flex justify-between mt-md pt-md border-t text-md">
                <span class="font-bold">Totale Ordine ${i+1}</span>
                <span class="font-bold text-primary">\u20AC${r.toFixed(2)}</span>
              </div>
            </div>
          `}).join("")}
      </div>

      <!-- TOTALE FINALE -->
      <div class="grand-total mt-lg p-lg bg-gradient text-white rounded-lg text-center">
        <div class="text-xl font-bold">TOTALE DA PAGARE</div>
        <div class="text-3xl font-bold mt-sm">\u20AC${this.calcolaTotaleTavolata().toFixed(2)}</div>
      </div>
    </div>
  `}generateReceiptHtml(){let t=new Date().toLocaleString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    /* STILE SCONTRINO FISCALE */
    body { 
      font-family: 'Courier New', 'Consolas', monospace; 
      background: white; 
      color: black; 
      margin: 0; 
      padding: 8px; 
      line-height: 1.2; 
      font-size: 12px;
      width: 80mm;
    }
    .receipt-header { 
      text-align: center; 
      margin-bottom: 10px; 
      padding-bottom: 8px; 
      border-bottom: 1px dashed #000; 
    }
    .receipt-header h1 { 
      font-size: 14px; 
      margin: 0 0 2px 0; 
      font-weight: bold; 
      text-transform: uppercase;
    }
    .restaurant-details {
      font-size: 10px;
      margin: 4px 0;
      line-height: 1.3;
    }
    .restaurant-details div {
      margin: 2px 0;
    }
    .receipt-info { 
      font-size: 11px; 
      margin: 4px 0; 
    }
    .section-title { 
      font-weight: bold; 
      text-align: center; 
      margin: 8px 0; 
      font-size: 11px;
      text-decoration: underline;
    }
    .receipt-item { 
      display: flex; 
      justify-content: space-between; 
      margin: 3px 0;
      font-size: 11px;
    }
    .receipt-total { 
      display: flex; 
      justify-content: space-between; 
      font-weight: bold; 
      margin-top: 6px; 
      padding-top: 6px; 
      border-top: 1px solid #000;
      font-size: 12px;
    }
    .receipt-grand-total { 
      text-align: center; 
      font-size: 14px; 
      font-weight: bold; 
      margin: 10px 0; 
      padding: 8px; 
      border: 2px solid #000;
    }
    .receipt-footer { 
      text-align: center; 
      margin-top: 15px; 
      font-size: 10px; 
      color: #555;
      border-top: 1px dashed #ccc;
      padding-top: 8px;
    }
    .print-only { display: none; }
    
    @media print {
      body { 
        width: 80mm !important;
        padding: 2mm !important;
        font-size: 11px !important;
      }
      .no-print { display: none !important; }
      .print-only { display: block !important; }
    }
  </style>
</head>
<body>
  <div class="receipt-header">
    <!-- NOME RISTORANTE usando il metodo helper -->
    <h1>${this.getRestaurantName()}</h1>
    
    <!-- DETTAGLI RISTORANTE usando i metodi helper -->
    <div class="restaurant-details">
      <!-- Indirizzo tutto sulla stessa riga -->
      ${this.getRestaurantAddress()?`<div>${this.getRestaurantAddress()}</div>`:""}
      
      <!-- Telefono e Email su righe separate -->
      ${this.getRestaurantPhone()?`<div>Tel: ${this.getRestaurantPhone()}</div>`:""}
      ${this.getRestaurantEmail()?`<div>Email: ${this.getRestaurantEmail()}</div>`:""}
    </div>
    
    <!-- INFO TAVOLO E DATA -->
    <div class="receipt-info">
      <strong>Tavolo:</strong> ${this.selectedTable?.table_number||"N/A"}
    </div>
    <div class="receipt-info">${t}</div>
  </div>

  ${this.orderHeaders.map((e,i)=>{let r=this.calcolaTotaleOrderHeader(e);return`
      <div class="receipt-section">
        <div class="section-title">ORDINE ${i+1}</div>
        ${e.orders?.map(d=>{let b=this.getOrderTotal(d);return`
            <div style="margin: 5px 0;">
              <div style="font-weight: bold; margin-bottom: 3px;">Comanda ${d.comanda_number||1}</div>
              ${d.order_items?.length>0?d.order_items.map(M=>`
                  <div class="receipt-item">
                    <span>${M.quantity||1} \xD7 ${M.dishes?.name||"Piatto"}</span>
                    <span>\u20AC${(M.total_price||0).toFixed(2)}</span>
                  </div>
                `).join(""):'<div style="color:#777; font-style: italic;">Nessun piatto</div>'}
              <div class="receipt-total">
                <span>Totale comanda</span>
                <span>\u20AC${b.toFixed(2)}</span>
              </div>
            </div>
          `}).join("")||""}
        <div class="receipt-total" style="font-size: 13px;">
          <span>TOTALE ORDINE ${i+1}</span>
          <span>\u20AC${r.toFixed(2)}</span>
        </div>
      </div>
    `}).join("")}

  <div class="receipt-grand-total">
    TOTALE DA PAGARE<br>
    <span style="font-size: 16px;">\u20AC${this.calcolaTotaleTavolata().toFixed(2)}</span>
  </div>

  <div class="receipt-footer">
    Grazie e arrivederci!<br>
    IVA 10% inclusa<br>
    <span class="print-only">${new Date().toLocaleString("it-IT")}</span>
  </div>
</body>
</html>
  `}stampaScontrinoFiscale(t){let e=this.generateReceiptHtml();this.printReceiptDirectly(e)}printReceiptDirectly(t){let e=window.open("","_blank","width=350,height=600");e?(e.document.title=`Scontrino - ${this.getRestaurantName()} - Tavolo ${this.selectedTable?.table_number||""}`,e.document.write(t),e.document.close(),setTimeout(()=>{e.focus(),e.print(),setTimeout(()=>{e.close()},100)},250)):(alert("Impossibile aprire finestra di stampa. Controlla i pop-up bloccati."),console.warn("Impossibile aprire finestra di stampa. Pop-up bloccato?"))}printBill(){this.showBillPreviewModal=!1;let t=this.generateReceiptHtml();this.printReceiptDirectly(t)}freeTableManually(){return h(this,null,function*(){if(!(!this.selectedTableStatus||!confirm(`Sei sicuro di voler liberare questo tavolo?

Se ci sono ordini aperti, verranno chiusi.`)))try{this.currentTavolataId&&(yield this.orderService.closeTavolata(this.selectedTableStatus.table.id,this.currentTavolataId)),yield this.loadData(),this.deselectTable(),this.showQuickActionsModal=!1}catch(e){console.error("Error freeing table:",e),alert("Errore durante la liberazione del tavolo")}})}calcolaTotaleTavolata(){return this.orderService.calculateTavolataTotal(this.orderHeaders)}calcolaTotaleOrderHeader(t){return this.orderService.calculateOrderHeaderTotal(t)}openOrderDetails(){this.selectedTableStatus&&(this.showOrderDetailsModal=!0,this.showQuickActionsModal=!1)}closeOrderDetailsModal(){this.showOrderDetailsModal=!1}toggleOrderHeaderExpansion(t){this.orderHeadersExpanded[t]=!this.orderHeadersExpanded[t]}toggleOrderExpansion(t){this.ordersExpanded[t]=!this.ordersExpanded[t]}isOrderHeaderExpanded(t){return this.orderHeadersExpanded[t]||!1}isOrderExpanded(t){return this.ordersExpanded[t]||!1}getOverallOrderStatus(t){if(!t.order_items||t.order_items.length===0)return t.status||"received";let e=this.orderService.calculateOverallOrderStatus(t.order_items);return e==="served"&&this.orderService.areAllItemsServed(t)?"ready_for_bill":e}getOrderStatusText(t){return{waiting:"In Attesa",preparing:"In Preparazione",ready:"Pronto",served:"Servito",ready_for_bill:"Pronto per conto",out_of_stock:"Esaurito",received:"Ricevuto"}[t]||t}getOrderStatusColor(t){return{waiting:"warning",preparing:"preparing",ready:"success",served:"secondary",ready_for_bill:"success",out_of_stock:"danger",received:"info"}[t]||"secondary"}onFloorPlanSelect(t){this.currentFloorPlan=t,this.loadTablesForFloorPlan(),this.deselectTable()}getTableOrderItemsCount(t){return this.getTotalOrderItems(t.currentOrders)}getTotalOrderItems(t){return t?t.reduce((e,i)=>e+(i.order_items?.length||0),0):0}getTotalComandeCount(){return this.orderHeaders.reduce((t,e)=>t+(e.orders?.length||0),0)}setCurrentComanda(t){this.currentOrder=t}updateComandaItemQuantity(t,e){return h(this,null,function*(){if(!t.id||t.id.startsWith("temp-"))return;(yield this.orderService.updateOrderItemQuantity(t.id,e))&&(yield this.refreshCurrentOrder())})}removeComandaItem(t){return h(this,null,function*(){!t.id||t.id.startsWith("temp-")||confirm("Rimuovere questo piatto dall'ordine?")&&(yield this.orderService.deleteOrderItem(t.id))&&(yield this.refreshCurrentOrder())})}onComandaChange(t,e){return h(this,null,function*(){if(!t.id||!e||e===this.currentOrder?.id)return;let i=this.dishes.find(r=>r.id===t.dish_id);if(i)try{yield this.orderService.addDishToOrder(e,{id:i.id,base_price:i.base_price,name:i.name},1,t.item_notes||""),t.quantity>1?yield this.orderService.updateOrderItemQuantity(t.id,-1):yield this.orderService.deleteOrderItem(t.id),yield this.refreshCurrentOrder(),this.showMoveSelectForItem=null}catch(r){console.error("Errore spostamento item:",r)}})}toggleMoveSelect(t){this.showMoveSelectForItem=this.showMoveSelectForItem===t?null:t}isMoveSelectVisible(t){return this.showMoveSelectForItem===t}saveComandaOrder(){return h(this,null,function*(){if(this.currentOrder)try{let{error:t}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").update({updated_at:new Date().toISOString()}).eq("id",this.currentOrder.id);if(t)throw t;this.showCreateOrderModal=!1,this.showOrderActionsAfterSave=!0}catch(t){console.error("Errore nel salvataggio ordine:",t),alert("Errore nel salvataggio ordine")}})}getReadyForBillStatus(){return this.isReadyForBill()}setupZoomListeners(){let t=this.mapCard?.nativeElement.querySelector(".floor-plan-canvas");if(!t)return;t.addEventListener("wheel",i=>{if(!this.isFullscreen)return;i.preventDefault();let r=i.deltaY>0?.9:1.1;this.zoomLevel=Math.min(Math.max(this.zoomLevel*r,this.minZoom),this.maxZoom),this.applyZoom()});let e=0;t.addEventListener("touchstart",i=>{i.touches.length===2&&(e=Math.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY))}),t.addEventListener("touchmove",i=>{if(i.touches.length===2&&e>0){i.preventDefault();let r=Math.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY),d=r/e;this.zoomLevel=Math.min(Math.max(this.zoomLevel*d,this.minZoom),this.maxZoom),e=r,this.applyZoom()}})}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.25,this.maxZoom),this.applyZoom()}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.25,this.minZoom),this.applyZoom()}applyZoom(){let t=this.mapCard?.nativeElement.querySelector(".floor-plan-canvas");t&&(t.style.transform=`scale(${this.zoomLevel})`)}resetZoom(){this.zoomLevel=1,this.applyZoom()}adjustMapForFullscreen(){this.applyZoom()}resetMapFromFullscreen(){}loadCurrentRestaurant(){return h(this,null,function*(){try{let t=yield this.getCurrentRestaurantId();if(!t){this.currentRestaurant=null;return}let{data:e,error:i}=yield this.orderService.supabaseService.getSupabaseClient().from("restaurants").select("*").eq("id",t).single();if(i)throw i;e&&(this.currentRestaurant=e)}catch(t){console.error("Error loading restaurant info:",t),this.currentRestaurant=null}})}getRestaurantName(){return this.currentRestaurant?.name||"Ristorante"}getRestaurantAddress(){return this.currentRestaurant?.address||""}getRestaurantPhone(){return this.currentRestaurant?.phone||""}getRestaurantEmail(){return this.currentRestaurant?.email||""}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=ie({type:s,selectors:[["app-table-map"]],viewQuery:function(e,i){if(e&1&&(H(De,5),H(He,5),H(Ae,5)),e&2){let r;A(r=z())&&(i.mapContainer=r.first),A(r=z())&&(i.mapCard=r.first),A(r=z())&&(i.billPreviewContent=r.first)}},decls:125,vars:27,consts:[["mapContainer","","mapCard",""],["floorPlanCanvas",""],["reservationForm","ngForm"],["noDishes",""],["emptyOrder",""],["moveButtonTemplate",""],["selectElem",""],["billPreviewContent",""],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","flex-col","gap-md"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"form-card"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"form-input",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],["value","free"],["value","reserved"],["value","occupied"],["type","text","placeholder","Numero o nome tavolo...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer",2,"margin","0"],[1,"promethea-button","primary",3,"click"],[1,"material-icons"],[1,"form-card","mt-lg"],["class","fullscreen-header",4,"ngIf"],[1,"flex","justify-between","items-center","mb-md","flex-wrap"],[1,"font-semibold"],[1,"flex","items-center","gap-sm"],[1,"flex","gap-sm","mr-md"],[1,"legend-color","free"],[1,"text-sm"],[1,"legend-color","reserved"],[1,"legend-color","occupied"],[1,"icon-button",3,"click"],[1,"canvas-container"],[1,"floor-plan-canvas"],[1,"grid-overlay"],["class","table-element",3,"class","ngStyle","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"ngValue"],[1,"fullscreen-header"],[1,"font-bold","text-lg"],[1,"flex","items-center","gap-md"],[1,"icon-button",3,"click","disabled"],[1,"flex","items-center","gap-sm","bg-smoke","px-md","py-sm","rounded-full","min-w-32","justify-center"],[1,"material-icons","text-sm"],[1,"form-input","text-sm",3,"ngModelChange","ngModel"],[1,"table-element",3,"click","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-details"],[1,"table-capacity"],["class","table-info",4,"ngIf"],[1,"table-info"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"header-icon"],[1,"p-lg"],[1,"flex","flex-col","gap-lg"],[1,"flex","justify-center"],[1,"chip"],["class","flex flex-col gap-sm",4,"ngIf"],["class","border-t border-[var(--smoke-1)] pt-md",4,"ngIf"],[1,"flex","flex-col","gap-sm"],[1,"promethea-button",3,"click"],[1,"promethea-button","success",3,"click"],[1,"promethea-button","ghost","flex-1",3,"click"],[1,"promethea-button","flex-1",3,"click"],[1,"promethea-button","success",3,"click","disabled"],[1,"border-t","border-[var(--smoke-1)]","pt-md"],[1,"promethea-button","ghost","full-width",3,"click"],[1,"modal-container","modal-md"],[1,"generic-form",3,"ngSubmit"],["type","text","name","customer_name","required","","placeholder","Inserisci il nome del cliente",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone","required","","placeholder","Inserisci il telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","date","name","reservation_date","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","time","name","reservation_time","required","",1,"form-input",3,"ngModelChange","ngModel"],["name","party_size","required","",1,"form-input",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"text-muted","mt-sm"],["name","special_requests","rows","3","placeholder","Note o richieste speciali...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[3,"value","disabled"],[1,"flex","justify-between","items-center","w-full"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],["type","button",1,"promethea-button","danger",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg","fullscreen-mobile",3,"click"],[1,"modal-header","compact-header"],[1,"flex","items-center","gap-sm","flex-1"],[1,"flex","flex-col","flex-1"],[1,"section-title","text-md"],["class","chip active ml-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","mt-xs"],[1,"text-muted","text-mini"],["class","form-input",3,"ngModel","ngModelChange",4,"ngIf"],["title","Chiudi",1,"icon-button",3,"click"],[1,"p-lg","mobile-scroll"],[1,"search-bar-mobile","mb-md"],[1,"form-group",2,"flex","3"],["type","text","placeholder","Cerca piatto...","autofocus","",1,"form-input","touch-target",3,"ngModelChange","ngModel"],[1,"form-group",2,"flex","1"],[1,"form-input","touch-target",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex",2,"margin-bottom","var(--gap-sm)"],[1,"grid-form"],[1,"quick-actions-mobile"],[1,"quick-action-button",3,"click"],[1,"text-mini"],["class","quick-action-button",3,"active","click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[1,"form-card",2,"margin","0","padding","var(--gap-sm)"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","gap-sm","font-semibold"],[1,"chip","active"],[1,"form-card",2,"margin","0","max-height","50vh","overflow-y","auto"],["title","Anteprima conto",1,"quick-action-button",3,"click","disabled"],[1,"quick-action-button",3,"click","disabled"],["class","form-card bg-primary-light border-primary border-l-4 mb-md",4,"ngIf"],[1,"modal-footer","mobile-footer"],[1,"promethea-button","ghost","flex-1","mobile-button",3,"click"],[1,"promethea-button","flex-1",3,"click","disabled"],[1,"promethea-button","primary","flex-1",3,"click","disabled"],["class","material-icons",4,"ngIf"],[1,"chip","active","ml-sm"],[3,"value"],[4,"ngFor","ngForOf"],[1,"flex","gap-sm","items-center"],[1,"font-bold","text-md"],[1,"material-icons","text-md"],[1,"font-bold","text-primary","text-md"],[1,"dishes-grid"],["class","card dish-card mobile-card",4,"ngFor","ngForOf"],[1,"card","dish-card","mobile-card"],[1,"flex","gap-sm","flex-col","flex-1"],[1,"dish-name"],[1,"dish-price","text-primary"],["class","text-muted text-mini",4,"ngIf"],[1,"flex","gap-sm","justify-end"],["title","Aggiungi 1",1,"icon-button","x-small",3,"click","disabled"],["class","material-icons animate-spin text-mini",4,"ngIf"],[1,"material-icons","animate-spin","text-mini"],[1,"promethea-button","ghost","mt-sm",3,"click"],["class","mb-sm pb-sm border-b border-[var(--smoke-1)] last:border-0",4,"ngFor","ngForOf"],[1,"mt-md","pt-md","border-t","border-[var(--smoke-1)]"],[1,"flex","justify-between","items-center","mb-sm"],[1,"text-md"],[1,"text-primary","text-md"],["class","flex justify-between items-center",4,"ngIf"],[1,"mb-sm","pb-sm","border-b","border-[var(--smoke-1)]","last:border-0"],[1,"flex","justify-between","items-start","gap-sm"],["title","Riduci quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],[1,"font-bold","px-2","min-w-[36px]","text-center","text-sm"],["title","Aumenta quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],["title","Elimina piatto",1,"icon-button","x-small","ml-1","text-danger",3,"click","disabled"],["class","flex items-center justify-between mt-sm",4,"ngIf"],[1,"flex","items-center","justify-between","mt-sm"],["class","flex-1",4,"ngIf","ngIfElse"],[1,"flex-1"],[1,"form-input","text-mini",2,"padding","6px 8px","width","100%","padding-right","35px",3,"change","click"],["value",""],["title","Sposta piatto in altra comanda",1,"icon-button","x-small","text-secondary",3,"click"],[1,"text-secondary"],[1,"empty-state","py-lg"],[1,"material-icons","text-lg"],[1,"text-muted","text-mini","mt-xs"],[1,"form-card","bg-primary-light","border-primary","border-l-4","mb-md"],[1,"flex","items-center","gap-sm","mb-sm"],[1,"text-primary"],[1,"text-muted","text-sm"],[1,"grid","grid-cols-2","gap-sm"],[1,"modal-container","modal-lg"],[1,"flex","items-center","gap-sm","mt-sm"],["class","form-card",4,"ngFor","ngForOf"],["class","form-card mt-md bg-gradient text-white",4,"ngIf"],[1,"modal-footer","mt-lg"],[1,"flex","flex-wrap","gap-sm","w-full"],[1,"promethea-button","success","flex-1",3,"click","disabled"],[1,"promethea-button","primary","flex-1",3,"click"],[1,"flex","justify-between","items-center","cursor-pointer",3,"click"],[1,"flex","items-center","gap-md","flex-1"],[1,"flex","flex-col"],[1,"chip","small"],[1,"flex","flex-col","items-end"],["class","mt-md pt-md border-t border-[var(--smoke-1)]",4,"ngIf"],["class","mb-lg",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","mt-lg","pt-lg","border-t"],[1,"text-primary","text-lg"],[1,"mb-lg"],[1,"flex","justify-between","items-center","cursor-pointer","mb-sm","p-sm","rounded","bg-smoke",3,"click"],[1,"material-icons","text-secondary"],[1,"chip","small",3,"ngClass"],[1,"font-bold"],["class","mt-sm p-sm",4,"ngIf"],[1,"mt-sm","p-sm"],["class","space-y-sm",4,"ngIf"],["class","empty-state py-md",4,"ngIf"],[1,"space-y-sm"],["class","flex justify-between items-start p-sm border-b last:border-0",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","p-sm","border-b","last:border-0"],[1,"flex","items-start","gap-sm"],[1,"chip","x-small","mt-1",3,"ngClass"],["class","mt-xs",4,"ngIf"],[1,"flex","items-center","gap-sm","mt-xs","text-sm","text-muted"],[1,"mt-xs"],[1,"empty-state","py-md"],[1,"form-card","mt-md","bg-gradient","text-white"],[1,"text-white"],[1,"text-white","text-sm","opacity-80"],[1,"text-white","text-xl"],[1,"modal-container","modal-lg",3,"click"],[3,"innerHTML"],[1,"promethea-button","ghost",3,"click"]],template:function(e,i){if(e&1){let r=x();n(0,"div",8)(1,"div",9)(2,"div",10)(3,"span",11),l(4,"brunch_dining"),a(),n(5,"h1",12),l(6,"Prenotazioni Tavoli"),a()(),n(7,"p",13),l(8,"Gestisci prenotazioni e ordini in tempo reale"),a()(),n(9,"div",14)(10,"div",15)(11,"div",16)(12,"div",17)(13,"span",18),l(14,"event_available"),a(),n(15,"div",19),l(16,"Tavoli Liberi"),a()(),n(17,"div",20),l(18),a()()(),n(19,"div",15)(20,"div",16)(21,"div",17)(22,"span",18),l(23,"event"),a(),n(24,"div",19),l(25,"Prenotati"),a()(),n(26,"div",20),l(27),a()()(),n(28,"div",15)(29,"div",16)(30,"div",17)(31,"span",18),l(32,"restaurant"),a(),n(33,"div",19),l(34,"Occupati"),a()(),n(35,"div",20),l(36),a()()(),n(37,"div",15)(38,"div",16)(39,"div",17)(40,"span",18),l(41,"table_restaurant"),a(),n(42,"div",19),l(43,"Tavoli Totali"),a()(),n(44,"div",20),l(45),a()()(),n(46,"div",15)(47,"div",16)(48,"div",17)(49,"span",18),l(50,"receipt"),a(),n(51,"div",19),l(52,"Pronti per conto"),a()(),n(53,"div",20),l(54),a()()()(),n(55,"div",21)(56,"div",22)(57,"div",23)(58,"label",24),l(59,"Mappa"),a(),n(60,"select",25),S("ngModelChange",function(b){return m(r),T(i.currentFloorPlan,b)||(i.currentFloorPlan=b),p(b)}),_("change",function(){return m(r),p(i.onFloorPlanSelect(i.currentFloorPlan))}),g(61,ze,2,2,"option",26),a()(),n(62,"div",23)(63,"label",24),l(64,"Stato"),a(),n(65,"select",27),S("ngModelChange",function(b){return m(r),T(i.statusFilter,b)||(i.statusFilter=b),p(b)}),n(66,"option",28),l(67,"Tutti gli stati"),a(),n(68,"option",29),l(69,"Libero"),a(),n(70,"option",30),l(71,"Prenotato"),a(),n(72,"option",31),l(73,"Occupato"),a()()(),n(74,"div",23)(75,"label",24),l(76,"Cerca"),a(),n(77,"input",32),S("ngModelChange",function(b){return m(r),T(i.searchTerm,b)||(i.searchTerm=b),p(b)}),a()(),n(78,"div",23)(79,"label",24),l(80,"Azioni"),a(),n(81,"div",33)(82,"button",34),_("click",function(){return m(r),p(i.loadData())}),n(83,"span",35),l(84,"refresh"),a(),l(85," Aggiorna "),a()()()()(),n(86,"div",36,0),g(89,Le,20,6,"div",37),n(90,"div",38)(91,"h2",39),l(92),a(),n(93,"div",40)(94,"div",41)(95,"div",40),P(96,"div",42),n(97,"span",43),l(98,"Libero"),a()(),n(99,"div",40),P(100,"div",44),n(101,"span",43),l(102,"Prenotato"),a()(),n(103,"div",40),P(104,"div",45),n(105,"span",43),l(106,"Occupato"),a()()(),n(107,"button",46),_("click",function(){return m(r),p(i.safeToggleFullscreen())}),n(108,"span",35),l(109),a()(),n(110,"button",46),_("click",function(){return m(r),p(i.toggleSize())}),n(111,"span",35),l(112),a()()()(),n(113,"div",47)(114,"div",48,1),P(116,"div",49),g(117,We,11,9,"div",50)(118,$e,7,0,"div",51),a()(),g(119,Xe,22,8,"div",52)(120,Je,52,11,"div",52)(121,it,55,12,"div",52)(122,Ft,99,36,"div",53)(123,$t,42,12,"div",52)(124,jt,27,3,"div",53),a()()}e&2&&(o(18),y(i.freeTablesCount),o(9),y(i.reservedTablesCount),o(9),y(i.occupiedTablesCount),o(9),y(i.totalTablesCount),o(9),y(i.readyForBillTablesCount),o(6),f("ngModel",i.currentFloorPlan),o(),u("ngForOf",i.floorPlans),o(4),f("ngModel",i.statusFilter),o(12),f("ngModel",i.searchTerm),o(12),u("ngIf",i.isFullscreen),o(3),y(i.currentFloorPlan?i.currentFloorPlan.name:"Mappa"),o(15),V("active",i.isFullscreen),o(2),v(" ",i.isFullscreen?"fullscreen_exit":"fullscreen"," "),o(3),v(" ",i.isLargeText?"text_decrease":"text_increase"," "),o(2),ne("width",i.currentFloorPlan?i.currentFloorPlan.width:1e3,"px")("height",i.currentFloorPlan?i.currentFloorPlan.height:800,"px"),o(3),u("ngForOf",i.getFilteredTables()),o(),u("ngIf",i.getFilteredTables().length===0),o(),u("ngIf",i.showQuickActionsModal),o(),u("ngIf",i.showManualReservationModal),o(),u("ngIf",i.showEditReservationModal),o(),u("ngIf",i.showCreateOrderModal),o(),u("ngIf",i.showOrderDetailsModal),o(),u("ngIf",i.showBillPreviewModal))},dependencies:[me,re,ae,le,oe,ye,xe,Te,Se,_e,fe,ve,ge,we,be,he,ce,de,se],styles:[".table-map-fullscreen[_ngcontent-%COMP%]{position:fixed!important;inset:0!important;margin:0!important;padding:0!important;border-radius:0!important;z-index:9999!important;background:var(--background)!important;overflow:hidden!important}.fullscreen-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--background);padding:var(--gap-md);display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--smoke-1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{position:absolute!important;inset:90px 0 0;overflow:auto!important;-webkit-overflow-scrolling:touch;background:var(--background);padding:0!important}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{display:block!important;width:max-content!important;height:max-content!important;min-width:100%!important;min-height:100%!important;margin:auto!important;transform-origin:center center;transition:transform .2s ease-out;background:var(--background)}@media (max-width: 768px){.fullscreen-header[_ngcontent-%COMP%]{padding:var(--gap-sm)}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{top:80px}}.icon-button[disabled][_ngcontent-%COMP%]{opacity:.4;cursor:not-allowed}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex!important;gap:var(--gap-sm)!important;overflow-x:auto!important;padding-bottom:var(--gap-sm)!important;-webkit-overflow-scrolling:touch!important;scrollbar-width:none!important}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none!important}.quick-action-button[_ngcontent-%COMP%]{display:flex!important;flex-direction:column!important;align-items:center!important;justify-content:center!important;padding:var(--gap-sm)!important;min-width:80px!important;border:1px solid var(--smoke-1)!important;border-radius:12px!important;background:var(--background)!important;transition:all .2s ease!important;cursor:pointer!important;flex-shrink:0!important}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button[_ngcontent-%COMP%]:active{background:var(--smoke-1)!important;border-color:var(--primary)!important}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin-bottom:4px!important}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1)!important;border-radius:12px!important;padding:var(--gap-sm);background:var(--background);transition:none;cursor:pointer!important}.dish-card[_ngcontent-%COMP%]:hover, .dish-card[_ngcontent-%COMP%]:active{transform:translateY(-2px)!important;border-color:var(--primary)!important;box-shadow:0 4px 12px var(--smoke-2)!important}.dish-card.mobile-card[_ngcontent-%COMP%]{margin-bottom:var(--gap-sm)!important}.dish-name[_ngcontent-%COMP%]{font-weight:600!important;font-size:var(--fs-sm)!important;line-height:1.3!important;color:var(--text-color)!important}.dish-price[_ngcontent-%COMP%]{font-weight:700!important;font-size:var(--fs-sm)!important;color:var(--primary)!important}.bill-preview[_ngcontent-%COMP%]{background:var(--background);color:var(--text-color);max-height:70vh;overflow-y:auto;padding:var(--gap-lg)}.bill-preview[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:var(--gap-lg);padding-bottom:var(--gap-md);border-bottom:2px solid var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;margin-bottom:var(--gap-md);transition:all .3s ease}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]:hover{border-color:var(--secondary);box-shadow:0 4px 12px var(--smoke-2)}.bill-preview[_ngcontent-%COMP%]   .comanda-header[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;border-bottom:1px solid var(--smoke-1);padding-bottom:var(--gap-sm);margin-bottom:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:calc(var(--gap-sm) / 2) 0;border-bottom:1px dashed var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:last-child{border-bottom:none}.bill-preview[_ngcontent-%COMP%]   .comanda-total[_ngcontent-%COMP%]{color:var(--primary);font-weight:600;margin-top:var(--gap-sm);padding-top:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .header-total[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 10%,transparent);padding:var(--gap-sm);border-radius:8px;margin-top:var(--gap-md)}.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:var(--gradiente);color:#fff;padding:var(--gap-lg);border-radius:16px;margin-top:var(--gap-lg);box-shadow:0 8px 24px var(--shadow-2)}@media print{.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.modal-footer[_ngcontent-%COMP%]{display:none!important}}.canvas-wrapper[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.legend-color[_ngcontent-%COMP%]{width:var(--fs-md);height:var(--fs-sm);display:flex;border-radius:var(--gap-sm)}.legend-color.free[_ngcontent-%COMP%]{background:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.occupied[_ngcontent-%COMP%]{background:#ef4444}.legend-color.merged[_ngcontent-%COMP%]{background:#ff6b35}"]})};export{Pe as TableMap};
