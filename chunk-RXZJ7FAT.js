import{a as X}from"./chunk-WYQ5VOMP.js";import{a as W}from"./chunk-THIV3BQJ.js";import{a as Q}from"./chunk-7QR2BAVO.js";import{a as z,b as A,c as v,d as U,e as B,i as D,j as G,l as $,o as q,p as Y,q as j,r as R,t as K,v as H,x as J}from"./chunk-77SKEQNN.js";import"./chunk-KNL3CWA3.js";import{d as P,e as T,i as N,k as V,t as L}from"./chunk-DCWKKS33.js";import{$b as O,Db as d,Eb as p,La as l,Nb as x,Pb as F,Qb as n,Rb as h,Sb as S,Tb as k,a as E,ab as w,b as C,bc as M,ea as y,f as b,fb as m,ja as u,ka as _,qb as s,rb as i,sb as t,tb as g,zb as I}from"./chunk-K5RDB55Y.js";function ee(a,r){a&1&&(i(0,"tr")(1,"td",32),g(2,"div",33),i(3,"span"),n(4,"Caricamento ingredienti..."),t()()())}function te(a,r){if(a&1){let e=I();i(0,"tr",34)(1,"td")(2,"strong"),n(3),t()(),i(4,"td")(5,"span",6),n(6),t()(),i(7,"td")(8,"span"),n(9),t()(),i(10,"td")(11,"span",6),n(12),t()(),i(13,"td")(14,"strong"),n(15),O(16,"number"),t()(),i(17,"td")(18,"span",35),n(19),t()(),i(20,"td")(21,"div",36)(22,"button",37),d("click",function(){let c=u(e).$implicit,f=p();return _(f.editIngredient(c))}),i(23,"span",3),n(24,"edit"),t()(),i(25,"button",38),d("click",function(){let c=u(e).$implicit,f=p();return _(f.deleteIngredient(c.id))}),i(26,"span",3),n(27,"delete"),t()()()()()}if(a&2){let e=r.$implicit,o=p();l(3),h(e.name),l(3),h(e.description||"Nessuna descrizione"),l(2),x("low-stock",e.current_stock<=e.minimum_stock),l(),k(" ",e.current_stock," ",o.getUnitSymbol(e.unit_id)," "),l(3),h(o.getSupplierName(e)),l(3),S("\u20AC",M(16,11,e.cost_per_unit,"1.2-2")),l(3),F(o.getStockStatus(e).class),l(),S(" ",o.getStockStatus(e).text," ")}}function ie(a,r){a&1&&(i(0,"p"),n(1," Prova a modificare i filtri di ricerca "),t())}function ne(a,r){if(a&1){let e=I();i(0,"tr")(1,"td",39)(2,"span",3),n(3,"search_off"),t(),i(4,"h3"),n(5,"Nessun ingrediente trovato"),t(),m(6,ie,2,0,"p",29),i(7,"button",25),d("click",function(){u(e);let c=p();return _(c.newIngredient())}),i(8,"span",3),n(9,"add"),t(),n(10," Aggiungi il primo ingrediente "),t()()()}if(a&2){let e=p();l(6),s("ngIf",e.searchTerm||e.showLowStockOnly)}}function re(a,r){a&1&&(i(0,"div",75)(1,"span"),n(2,"Il nome \xE8 obbligatorio e deve essere di almeno 2 caratteri"),t()())}function oe(a,r){if(a&1&&(i(0,"option",76),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function le(a,r){if(a&1&&(i(0,"option",76),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function ae(a,r){if(a&1&&(i(0,"option",76),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function se(a,r){a&1&&(i(0,"div",75)(1,"span"),n(2,"Il costo per unit\xE0 \xE8 obbligatorio"),t()())}function ce(a,r){a&1&&(i(0,"div",75)(1,"span"),n(2,"La scorta attuale \xE8 obbligatoria"),t()())}function de(a,r){a&1&&(i(0,"div",75)(1,"span"),n(2,"La scorta minima \xE8 obbligatoria"),t()())}function me(a,r){if(a&1&&(i(0,"option",76),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),S(" ",e.company_name," ")}}function pe(a,r){if(a&1){let e=I();i(0,"div",40),d("click",function(){u(e);let c=p();return _(c.resetForm())}),i(1,"div",41),d("click",function(c){return u(e),_(c.stopPropagation())}),i(2,"div",9)(3,"span",3),n(4),t(),i(5,"h2",10),n(6),t(),i(7,"button",42),d("click",function(){u(e);let c=p();return _(c.resetForm())}),i(8,"span",3),n(9,"close"),t()()(),i(10,"form",43),d("ngSubmit",function(){u(e);let c=p();return _(c.onSubmit())}),i(11,"div",44)(12,"div",45)(13,"label",46)(14,"span",3),n(15,"label"),t(),n(16," Nome Ingrediente * "),t(),g(17,"input",47),m(18,re,3,0,"div",48),t(),i(19,"div",45)(20,"label",49)(21,"span",3),n(22,"description"),t(),n(23," Descrizione "),t(),g(24,"textarea",50),t()(),i(25,"div",44)(26,"div",45)(27,"label",51)(28,"span",3),n(29,"straighten"),t(),n(30," Unit\xE0 di Misura "),t(),i(31,"select",52)(32,"option",53),n(33,"Seleziona unit\xE0"),t(),i(34,"optgroup",54),m(35,oe,2,3,"option",55),t(),i(36,"optgroup",56),m(37,le,2,3,"option",55),t(),i(38,"optgroup",57),m(39,ae,2,3,"option",55),t()()(),i(40,"div",45)(41,"label",58)(42,"span",3),n(43,"euro"),t(),n(44," Costo per Unit\xE0 * "),t(),g(45,"input",59),m(46,se,3,0,"div",48),t()(),i(47,"div",44)(48,"div",45)(49,"label",60)(50,"span",3),n(51,"inventory"),t(),n(52," Scorta Attuale * "),t(),g(53,"input",61),m(54,ce,3,0,"div",48),t(),i(55,"div",45)(56,"label",62)(57,"span",3),n(58,"warning"),t(),n(59," Scorta Minima * "),t(),g(60,"input",63),m(61,de,3,0,"div",48),t()(),i(62,"div",44)(63,"div",45)(64,"label",64)(65,"span",3),n(66,"local_shipping"),t(),n(67," Fornitore "),t(),i(68,"div",65)(69,"select",66)(70,"option",53),n(71,"Nessun fornitore"),t(),m(72,me,2,2,"option",55),t(),i(73,"button",67),d("click",function(){u(e);let c=p();return _(c.goToSupplierManager())}),i(74,"span",3),n(75,"add"),t(),n(76," Gestisci Fornitori "),t()()()(),i(77,"div",44)(78,"div",45)(79,"label",68)(80,"span",3),n(81,"event"),t(),n(82," Data di Scadenza "),t(),g(83,"input",69),t(),i(84,"div",45)(85,"label",70),g(86,"input",71),i(87,"div")(88,"strong"),n(89,"Attiva avvisi scorta bassa"),t(),i(90,"div",6),n(91,"Ricevi un avviso quando la scorta scende sotto il livello minimo"),t()()()()(),i(92,"div",72)(93,"button",73),d("click",function(){u(e);let c=p();return _(c.resetForm())}),n(94," Annulla "),t(),i(95,"button",74)(96,"span",3),n(97),t(),n(98),t()()()()()}if(a&2){let e=p();l(4),h(e.isEditing?"edit":"add_circle"),l(2),S(" ",e.isEditing?"Modifica Ingrediente":"Nuovo Ingrediente"," "),l(4),s("formGroup",e.ingredientForm),l(7),x("error",(e.name==null?null:e.name.invalid)&&(e.name==null?null:e.name.touched)),l(),s("ngIf",(e.name==null?null:e.name.invalid)&&(e.name==null?null:e.name.touched)),l(17),s("ngForOf",e.getUnitsByType("weight")),l(2),s("ngForOf",e.getUnitsByType("volume")),l(2),s("ngForOf",e.getUnitsByType("piece")),l(6),x("error",(e.cost_per_unit==null?null:e.cost_per_unit.invalid)&&(e.cost_per_unit==null?null:e.cost_per_unit.touched)),l(),s("ngIf",(e.cost_per_unit==null?null:e.cost_per_unit.invalid)&&(e.cost_per_unit==null?null:e.cost_per_unit.touched)),l(7),x("error",(e.current_stock==null?null:e.current_stock.invalid)&&(e.current_stock==null?null:e.current_stock.touched)),l(),s("ngIf",(e.current_stock==null?null:e.current_stock.invalid)&&(e.current_stock==null?null:e.current_stock.touched)),l(6),x("error",(e.minimum_stock==null?null:e.minimum_stock.invalid)&&(e.minimum_stock==null?null:e.minimum_stock.touched)),l(),s("ngIf",(e.minimum_stock==null?null:e.minimum_stock.invalid)&&(e.minimum_stock==null?null:e.minimum_stock.touched)),l(11),s("ngForOf",e.suppliers),l(23),s("disabled",e.ingredientForm.invalid),l(2),h(e.isEditing?"save":"add"),l(),S(" ",e.isEditing?"Aggiorna":"Crea"," Ingrediente ")}}var Z=class a{ingredientService=y(Q);unitService=y(W);supplierService=y(X);fb=y(H);router=y(L);ingredients=[];units=[];suppliers=[];filteredIngredients=[];showIngredientForm=!1;isEditing=!1;currentIngredientId=null;searchTerm="";ingredientForm;isLoading=!0;showLowStockOnly=!1;sortBy="name";get lowStockCount(){return this.ingredientService.getLowStockIngredients().length}constructor(){this.ingredientForm=this.fb.group({name:["",[v.required,v.minLength(2)]],description:[""],unit_id:[""],current_stock:[0,[v.required,v.min(0)]],minimum_stock:[0,[v.required,v.min(0)]],cost_per_unit:[0,[v.required,v.min(0)]],alert_enabled:[!0],expiry_date:[null],supplier_id:[null]})}ngOnInit(){return b(this,null,function*(){this.loadData()})}loadData(){return b(this,null,function*(){this.isLoading=!0,this.unitService.units$.subscribe(r=>{this.units=r}),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r}),this.ingredientService.ingredients$.subscribe(r=>{this.ingredients=r,this.applyFilters(),this.isLoading=!1}),yield this.ingredientService.loadIngredients(),yield this.supplierService.loadSuppliers()})}applyFilters(){let r=this.ingredients;this.searchTerm&&(r=this.ingredientService.searchIngredients(this.searchTerm)),this.showLowStockOnly&&(r=r.filter(e=>e.alert_enabled&&e.current_stock<=e.minimum_stock)),r=[...r].sort((e,o)=>{switch(this.sortBy){case"name":return e.name.localeCompare(o.name);case"stock":return e.current_stock-o.current_stock;case"cost":return e.cost_per_unit-o.cost_per_unit;default:return 0}}),this.filteredIngredients=r}onSearchChange(r){this.searchTerm=r,this.applyFilters()}toggleLowStockFilter(){this.showLowStockOnly=!this.showLowStockOnly,this.applyFilters()}onSortChange(r){this.sortBy=r,this.applyFilters()}onSubmit(){return b(this,null,function*(){if(this.ingredientForm.invalid){this.markFormGroupTouched();return}let r=this.ingredientForm.value,e=C(E({},r),{expiry_date:r.expiry_date===""?null:r.expiry_date,supplier_id:r.supplier_id===""?null:r.supplier_id});try{this.isEditing&&this.currentIngredientId?(yield this.ingredientService.updateIngredient(this.currentIngredientId,e))&&(console.log("Ingrediente aggiornato con successo"),this.resetForm()):(yield this.ingredientService.createIngredient(e))&&(console.log("Ingrediente creato con successo"),this.resetForm())}catch(o){console.error("Errore durante il salvataggio:",o)}})}editIngredient(r){this.isEditing=!0,this.currentIngredientId=r.id,this.ingredientForm.patchValue({name:r.name,description:r.description||"",unit_id:r.unit_id||"",current_stock:r.current_stock,minimum_stock:r.minimum_stock,cost_per_unit:r.cost_per_unit,alert_enabled:r.alert_enabled,expiry_date:r.expiry_date||"",supplier_id:r.supplier_id||null}),this.showIngredientForm=!0}deleteIngredient(r){return b(this,null,function*(){confirm("Sei sicuro di voler eliminare questo ingrediente?")&&(yield this.ingredientService.deleteIngredient(r))&&console.log("Ingrediente eliminato")})}newIngredient(){this.resetForm(),this.showIngredientForm=!0,this.isEditing=!1}resetForm(){this.ingredientForm.reset({name:"",description:"",unit_id:"",current_stock:0,minimum_stock:0,cost_per_unit:0,alert_enabled:!0,expiry_date:"",supplier_id:null}),this.isEditing=!1,this.currentIngredientId=null,this.showIngredientForm=!1}goToSupplierManager(){this.router.navigate(["/restaurant/suppliers"])}getUnitSymbol(r){if(!r)return"";let e=this.units.find(o=>o.id===r);return e?e.symbol:""}shouldAlert(r){return r.alert_enabled&&r.current_stock<=r.minimum_stock}getStockStatus(r){return this.shouldAlert(r)?{class:"inactive",text:"Scorta Bassa"}:r.current_stock<=r.minimum_stock*1.5?{class:"warning",text:"Scorta Media"}:{class:"active",text:"Scorta OK"}}getSupplierName(r){if(!r.supplier_id)return"Nessun fornitore";if(r.suppliers)return r.suppliers.company_name;let e=this.suppliers.find(o=>o.id===r.supplier_id);return e?e.company_name:"Fornitore sconosciuto"}goToFoodCostCalculator(){this.router.navigate(["/food-cost"])}markFormGroupTouched(){Object.keys(this.ingredientForm.controls).forEach(r=>{this.ingredientForm.get(r)?.markAsTouched()})}get name(){return this.ingredientForm.get("name")}get current_stock(){return this.ingredientForm.get("current_stock")}get minimum_stock(){return this.ingredientForm.get("minimum_stock")}get cost_per_unit(){return this.ingredientForm.get("cost_per_unit")}getUnitsByType(r){return this.unitService.getUnitsByType(r)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-inventory"]],decls:84,vars:11,consts:[[1,"page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"promethea-button","ghost",3,"click"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Cerca per nome o descrizione...",1,"search-input",3,"input","value"],[1,"filter-select",3,"change","value"],["value","name"],["value","stock"],["value","cost"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"actions-container"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngIf"],["class","ingredient-row",4,"ngFor","ngForOf"],["class","ingredient-modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"loading-container"],[1,"loading-spinner"],[1,"ingredient-row"],[1,"chip"],[1,"action-buttons"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state"],[1,"ingredient-modal-overlay",3,"click"],[1,"form-card","ingredient-modal",3,"click"],[1,"icon-button",3,"click"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],["for","name",1,"form-label"],["id","name","formControlName","name","type","text","placeholder","Es: Pomodoro San Marzano"],["class","status-message error",4,"ngIf"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","2","placeholder","Descrizione opzionale dell'ingrediente"],["for","unit_id",1,"form-label"],["id","unit_id","formControlName","unit_id"],["value",""],["label","Peso"],[3,"value",4,"ngFor","ngForOf"],["label","Volume"],["label","Conteggio"],["for","cost_per_unit",1,"form-label"],["id","cost_per_unit","formControlName","cost_per_unit","type","number","step","0.001","min","0","placeholder","0.000"],["for","current_stock",1,"form-label"],["id","current_stock","formControlName","current_stock","type","number","step","0.001","min","0","placeholder","0"],["for","minimum_stock",1,"form-label"],["id","minimum_stock","formControlName","minimum_stock","type","number","step","0.001","min","0","placeholder","0"],["for","supplier_id",1,"form-label"],[1,"supplier-select-container"],["id","supplier_id","formControlName","supplier_id"],["type","button",1,"promethea-button","ghost","small",3,"click"],["for","expiry_date",1,"form-label"],["id","expiry_date","formControlName","expiry_date","type","date"],[1,"checkbox-label","large"],["type","checkbox","formControlName","alert_enabled"],[1,"form-actions"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"status-message","error"],[3,"value"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"inventory_2"),t()(),i(5,"div",4)(6,"h1",5),n(7,"Gestione Inventario"),t(),i(8,"p",6),n(9,"Gestisci gli ingredienti del tuo ristorante"),t()()(),i(10,"div",7)(11,"div",8)(12,"div",9)(13,"span",3),n(14,"inventory"),t(),i(15,"h3",10),n(16,"Ingredienti Totali"),t()(),i(17,"div",11),n(18),t()(),i(19,"div",8)(20,"div",9)(21,"span",3),n(22,"warning"),t(),i(23,"h3",10),n(24,"Scorte Basse"),t()(),i(25,"div",11),n(26),t()(),i(27,"div",8)(28,"div",9)(29,"span",3),n(30,"calculate"),t(),i(31,"h3",10),n(32,"Food Cost"),t()(),i(33,"button",12),d("click",function(){return o.goToFoodCostCalculator()}),n(34," Calcola Food Cost "),t()()(),i(35,"div",13)(36,"div",14)(37,"div",15)(38,"label",16),n(39,"Cerca Ingredienti"),t(),i(40,"input",17),d("input",function(f){return o.onSearchChange(f.target.value)}),t()(),i(41,"div",15)(42,"label",16),n(43,"Ordina per"),t(),i(44,"select",18),d("change",function(f){return o.onSortChange(f.target.value)}),i(45,"option",19),n(46,"Nome"),t(),i(47,"option",20),n(48,"Scorta"),t(),i(49,"option",21),n(50,"Costo"),t()()(),i(51,"div",15)(52,"label",22)(53,"input",23),d("change",function(){return o.toggleLowStockFilter()}),t(),n(54," Mostra solo scorte basse "),t()()(),i(55,"div",24)(56,"button",25),d("click",function(){return o.newIngredient()}),i(57,"span",3),n(58,"add"),t(),n(59," Nuovo Ingrediente "),t()()(),i(60,"div",26)(61,"div",27)(62,"table",28)(63,"thead")(64,"tr")(65,"th"),n(66,"Nome"),t(),i(67,"th"),n(68,"Descrizione"),t(),i(69,"th"),n(70,"Scorta Attuale"),t(),i(71,"th"),n(72,"Fornitore"),t(),i(73,"th"),n(74,"Costo/Unit\xE0"),t(),i(75,"th"),n(76,"Stato"),t(),i(77,"th"),n(78,"Azioni"),t()()(),i(79,"tbody"),m(80,ee,5,0,"tr",29)(81,te,28,14,"tr",30)(82,ne,11,1,"tr",29),t()()()(),m(83,pe,99,22,"div",31),t()),e&2&&(l(18),h(o.ingredients.length),l(7),x("error",o.lowStockCount>0),l(),S(" ",o.lowStockCount," "),l(14),s("value",o.searchTerm),l(4),s("value",o.sortBy),l(9),s("checked",o.showLowStockOnly),l(27),s("ngIf",o.isLoading),l(),s("ngForOf",o.filteredIngredients),l(),s("ngIf",!o.isLoading&&o.filteredIngredients.length===0),l(),s("ngIf",o.showIngredientForm))},dependencies:[V,P,T,J,D,j,R,A,G,z,Y,U,B,K,$,q,N],styles:["[_nghost-%COMP%]{display:block;width:100%}.search-input[_ngcontent-%COMP%]{min-width:250px}.filter-select[_ngcontent-%COMP%]{min-width:150px}.ingredient-row[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 5%,transparent)}.low-stock[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}.chip.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.card-number.error[_ngcontent-%COMP%]{color:#ef4444}.form-card[_ngcontent-%COMP%]{margin-top:var(--gutter-lg);animation:_ngcontent-%COMP%_slideIn .3s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:var(--gutter-xl)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--gutter-xl);color:var(--text-muted)}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:var(--gutter-md);opacity:.5}@media (max-width: 768px){.filters-section[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-md)}.filters-container[_ngcontent-%COMP%]{flex-direction:column;width:100%}.filter-group[_ngcontent-%COMP%]{width:100%}.search-input[_ngcontent-%COMP%]{min-width:100%}.action-buttons[_ngcontent-%COMP%]{flex-direction:column}.table-container[_ngcontent-%COMP%]{overflow-x:auto}}.ingredient-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0a0a0a73;-webkit-backdrop-filter:blur(4px) saturate(120%);backdrop-filter:blur(4px) saturate(120%);z-index:1200;padding:1.5rem}.ingredient-modal[_ngcontent-%COMP%]{width:100%;max-width:820px;margin:0 auto;border-radius:16px;box-shadow:0 24px 60px #00000059;transform:translateY(0);animation:_ngcontent-%COMP%_modalPop .22s cubic-bezier(.2,.9,.28,1);position:relative;padding:var(--gutter-md);background:var(--background)}.ingredient-modal[_ngcontent-%COMP%]   .generic-form[_ngcontent-%COMP%]{max-height:calc(100vh - 160px);overflow:auto;padding-right:8px}.ingredient-modal[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;z-index:2}@keyframes _ngcontent-%COMP%_modalPop{0%{opacity:0;transform:translateY(-10px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}@media (max-width: 520px){.ingredient-modal[_ngcontent-%COMP%]{max-width:100%;border-radius:12px;padding:.5rem}.ingredient-modal[_ngcontent-%COMP%]   .form-card[_ngcontent-%COMP%]{border-radius:12px}}.supplier-select-container[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.supplier-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1}.promethea-button.ghost.small[_ngcontent-%COMP%]{padding:8px 12px;font-size:.875rem;white-space:nowrap}"]})};export{Z as Inventory};
