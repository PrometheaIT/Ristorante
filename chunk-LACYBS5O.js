import{a as K}from"./chunk-7XSM3PO3.js";import{a as J}from"./chunk-YBKV2SZW.js";import{a as H}from"./chunk-THIV3BQJ.js";import{a as N,b as z,c as h,d as q,e as A,i as U,j as D,k as L,n as B,o as G,p as $,q as j,s as Y,u as Q,w as R}from"./chunk-Y4TUQNZC.js";import"./chunk-KNL3CWA3.js";import{d as O,e as F,i as M,k as T,t as V}from"./chunk-DCWKKS33.js";import{$b as C,Db as s,Eb as p,La as o,Nb as P,Pb as I,Qb as n,Rb as _,Sb as b,Tb as E,ab as w,bc as k,ea as x,f as S,fb as u,ja as m,ka as g,qb as d,rb as i,sb as t,tb as f,zb as y}from"./chunk-K5RDB55Y.js";function X(l,r){l&1&&(i(0,"tr")(1,"td",28),f(2,"div",29),i(3,"span"),n(4,"Caricamento prodotti..."),t()()())}function Z(l,r){if(l&1){let e=y();i(0,"tr",30)(1,"td")(2,"strong"),n(3),t()(),i(4,"td")(5,"span",4),n(6),t()(),i(7,"td")(8,"strong"),n(9),C(10,"number"),t()(),i(11,"td")(12,"span"),n(13),t()(),i(14,"td")(15,"span",4),n(16),t()(),i(17,"td")(18,"span",31),n(19),t()(),i(20,"td")(21,"div",32)(22,"button",33),s("click",function(){let c=m(e).$implicit,v=p();return g(v.editProduct(c))}),i(23,"span",2),n(24,"edit"),t()(),i(25,"button",34),s("click",function(){let c=m(e).$implicit,v=p();return g(v.deleteProduct(c.id))}),i(26,"span",2),n(27,"delete"),t()()()()()}if(l&2){let e=r.$implicit,a=p();o(3),_(e.product_name),o(3),_(e.description||"Nessuna descrizione"),o(3),b("\u20AC",k(10,8,e.unit_price,"1.2-2")),o(4),_(e.package_quantity),o(3),_(a.getUnitSymbol(e.unit_id)),o(2),I(a.getProductStatus(e).class),o(),b(" ",a.getProductStatus(e).text," ")}}function ee(l,r){l&1&&(i(0,"p"),n(1," Prova a modificare i filtri di ricerca "),t())}function te(l,r){if(l&1){let e=y();i(0,"tr")(1,"td",35)(2,"span",2),n(3,"storefront"),t(),i(4,"h3"),n(5,"Nessun prodotto trovato"),t(),u(6,ee,2,0,"p",25),i(7,"button",21),s("click",function(){m(e);let c=p();return g(c.newProduct())}),i(8,"span",2),n(9,"add"),t(),n(10," Aggiungi il primo prodotto "),t()()()}if(l&2){let e=p();o(6),d("ngIf",e.searchTerm||e.showAvailableOnly)}}function ie(l,r){l&1&&(i(0,"div",66)(1,"span"),n(2,"Il nome del prodotto \xE8 obbligatorio e deve essere di almeno 2 caratteri"),t()())}function ne(l,r){l&1&&(i(0,"div",66)(1,"span"),n(2,"Il prezzo unitario \xE8 obbligatorio"),t()())}function re(l,r){l&1&&(i(0,"div",66)(1,"span"),n(2,"La quantit\xE0 per confezione \xE8 obbligatoria"),t()())}function oe(l,r){if(l&1&&(i(0,"option",67),n(1),t()),l&2){let e=r.$implicit;d("value",e.id),o(),E(" ",e.name," (",e.symbol,") ")}}function ae(l,r){if(l&1&&(i(0,"option",67),n(1),t()),l&2){let e=r.$implicit;d("value",e.id),o(),E(" ",e.name," (",e.symbol,") ")}}function le(l,r){if(l&1&&(i(0,"option",67),n(1),t()),l&2){let e=r.$implicit;d("value",e.id),o(),E(" ",e.name," (",e.symbol,") ")}}function de(l,r){if(l&1){let e=y();i(0,"div",36),s("click",function(){m(e);let c=p();return g(c.resetForm())}),i(1,"div",37),s("click",function(c){return m(e),g(c.stopPropagation())}),i(2,"div",38)(3,"h2",39)(4,"span",2),n(5),t(),n(6),t(),i(7,"button",40),s("click",function(){m(e);let c=p();return g(c.resetForm())}),i(8,"span",2),n(9,"close"),t()()(),i(10,"div",41)(11,"form",42),s("ngSubmit",function(){m(e);let c=p();return g(c.onSubmit())}),i(12,"div",43)(13,"div",44)(14,"label",45)(15,"span",2),n(16,"label"),t(),n(17," Nome Prodotto * "),t(),f(18,"input",46),u(19,ie,3,0,"div",47),t(),i(20,"div",44)(21,"label",48)(22,"span",2),n(23,"description"),t(),n(24," Descrizione "),t(),f(25,"textarea",49),t()(),i(26,"div",43)(27,"div",44)(28,"label",50)(29,"span",2),n(30,"euro"),t(),n(31," Prezzo Unitario * "),t(),f(32,"input",51),u(33,ne,3,0,"div",47),t(),i(34,"div",44)(35,"label",52)(36,"span",2),n(37,"format_list_numbered"),t(),n(38," Quantit\xE0 per Confezione * "),t(),f(39,"input",53),u(40,re,3,0,"div",47),t()(),i(41,"div",43)(42,"div",44)(43,"label",54)(44,"span",2),n(45,"straighten"),t(),n(46," Unit\xE0 di Misura "),t(),i(47,"select",55)(48,"option",56),n(49,"Seleziona unit\xE0"),t(),i(50,"optgroup",57),u(51,oe,2,3,"option",58),t(),i(52,"optgroup",59),u(53,ae,2,3,"option",58),t(),i(54,"optgroup",60),u(55,le,2,3,"option",58),t()()(),i(56,"div",44)(57,"label",61),f(58,"input",62),i(59,"div")(60,"strong"),n(61,"Prodotto disponibile"),t(),i(62,"div",4),n(63,"Il prodotto \xE8 attualmente disponibile per la vendita"),t()()()()(),i(64,"div",63)(65,"button",64),s("click",function(){m(e);let c=p();return g(c.resetForm())}),n(66," Annulla "),t(),i(67,"button",65)(68,"span",2),n(69),t(),n(70),t()()()()()()}if(l&2){let e=p();o(5),_(e.isEditing?"edit":"add_circle"),o(),b(" ",e.isEditing?"Modifica Prodotto":"Nuovo Prodotto"," "),o(5),d("formGroup",e.productForm),o(7),P("error",(e.product_name==null?null:e.product_name.invalid)&&(e.product_name==null?null:e.product_name.touched)),o(),d("ngIf",(e.product_name==null?null:e.product_name.invalid)&&(e.product_name==null?null:e.product_name.touched)),o(13),P("error",(e.unit_price==null?null:e.unit_price.invalid)&&(e.unit_price==null?null:e.unit_price.touched)),o(),d("ngIf",(e.unit_price==null?null:e.unit_price.invalid)&&(e.unit_price==null?null:e.unit_price.touched)),o(6),P("error",(e.package_quantity==null?null:e.package_quantity.invalid)&&(e.package_quantity==null?null:e.package_quantity.touched)),o(),d("ngIf",(e.package_quantity==null?null:e.package_quantity.invalid)&&(e.package_quantity==null?null:e.package_quantity.touched)),o(11),d("ngForOf",e.getUnitsByType("weight")),o(2),d("ngForOf",e.getUnitsByType("volume")),o(2),d("ngForOf",e.getUnitsByType("piece")),o(12),d("disabled",e.productForm.invalid),o(2),_(e.isEditing?"save":"add"),o(),b(" ",e.isEditing?"Aggiorna":"Crea"," Prodotto ")}}var W=class l{supplierAuthService=x(J);supplierProductsService=x(K);unitService=x(H);fb=x(Q);router=x(V);products=[];units=[];filteredProducts=[];showProductForm=!1;isEditing=!1;currentProductId=null;searchTerm="";isLoading=!0;showAvailableOnly=!1;sortBy="name";productForm;get availableProductsCount(){return this.products.filter(r=>r.is_available).length}get totalProductsValue(){return this.products.reduce((r,e)=>r+e.unit_price,0)}constructor(){this.productForm=this.fb.group({product_name:["",[h.required,h.minLength(2)]],description:[""],unit_price:[0,[h.required,h.min(0)]],package_quantity:[1,[h.required,h.min(.001)]],unit_id:[""],is_available:[!0]})}ngOnInit(){return S(this,null,function*(){yield this.loadData()})}loadData(){return S(this,null,function*(){this.isLoading=!0;try{this.unitService.units$.subscribe(r=>{this.units=r}),yield this.supplierProductsService.loadSupplierProducts(),this.supplierProductsService.products$.subscribe(r=>{this.products=r,this.applyFilters(),this.isLoading=!1})}catch(r){console.error("Error loading data:",r),this.isLoading=!1}})}applyFilters(){let r=this.products;this.searchTerm&&(r=r.filter(e=>e.product_name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description?.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.showAvailableOnly&&(r=r.filter(e=>e.is_available)),r=[...r].sort((e,a)=>{switch(this.sortBy){case"name":return e.product_name.localeCompare(a.product_name);case"price":return e.unit_price-a.unit_price;default:return 0}}),this.filteredProducts=r}onSearchChange(r){this.searchTerm=r,this.applyFilters()}toggleAvailableFilter(){this.showAvailableOnly=!this.showAvailableOnly,this.applyFilters()}onSortChange(r){this.sortBy=r,this.applyFilters()}onSubmit(){return S(this,null,function*(){if(this.productForm.invalid){this.markFormGroupTouched();return}try{this.isEditing&&this.currentProductId?(yield this.supplierProductsService.updateProduct(this.currentProductId,this.productForm.value))&&(console.log("Prodotto aggiornato con successo"),this.resetForm()):(yield this.supplierProductsService.createProduct(this.productForm.value))&&(console.log("Prodotto creato con successo"),this.resetForm())}catch(r){console.error("Errore durante il salvataggio:",r)}})}editProduct(r){this.isEditing=!0,this.currentProductId=r.id,this.productForm.patchValue({product_name:r.product_name,description:r.description||"",unit_price:r.unit_price,package_quantity:r.package_quantity,unit_id:r.unit_id||"",is_available:r.is_available}),this.showProductForm=!0}deleteProduct(r){return S(this,null,function*(){confirm("Sei sicuro di voler eliminare questo prodotto?")&&(yield this.supplierProductsService.deleteProduct(r))&&console.log("Prodotto eliminato")})}newProduct(){this.resetForm(),this.showProductForm=!0,this.isEditing=!1}resetForm(){this.productForm.reset({product_name:"",description:"",unit_price:0,package_quantity:1,unit_id:"",is_available:!0}),this.isEditing=!1,this.currentProductId=null,this.showProductForm=!1}getUnitSymbol(r){if(!r)return"";let e=this.units.find(a=>a.id===r);return e?e.symbol:""}getProductStatus(r){return r.is_available?{class:"active",text:"Disponibile"}:{class:"inactive",text:"Non disponibile"}}getUnitsByType(r){return this.units.filter(e=>e.type===r)}markFormGroupTouched(){Object.keys(this.productForm.controls).forEach(r=>{this.productForm.get(r)?.markAsTouched()})}get product_name(){return this.productForm.get("product_name")}get unit_price(){return this.productForm.get("unit_price")}get package_quantity(){return this.productForm.get("package_quantity")}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=w({type:l,selectors:[["app-supplier-ingredients"]],decls:82,vars:13,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Cerca per nome o descrizione...",1,"search-input",3,"input","value"],[1,"filter-select",3,"change","value"],["value","name"],["value","price"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"actions-container"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngIf"],["class","product-row",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"loading-container"],[1,"loading-spinner"],[1,"product-row"],[1,"chip"],[1,"action-buttons"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"modal-close",3,"click"],[1,"modal-body"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],["for","product_name",1,"form-label"],["id","product_name","formControlName","product_name","type","text","placeholder","Es: Pomodoro San Marzano DOP"],["class","status-message error",4,"ngIf"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","3","placeholder","Descrizione opzionale del prodotto"],["for","unit_price",1,"form-label"],["id","unit_price","formControlName","unit_price","type","number","step","0.001","min","0","placeholder","0.000"],["for","package_quantity",1,"form-label"],["id","package_quantity","formControlName","package_quantity","type","number","step","0.001","min","0.001","placeholder","1"],["for","unit_id",1,"form-label"],["id","unit_id","formControlName","unit_id"],["value",""],["label","Peso"],[3,"value",4,"ngFor","ngForOf"],["label","Volume"],["label","Conteggio"],[1,"checkbox-label","large"],["type","checkbox","formControlName","is_available"],[1,"form-actions"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"status-message","error"],[3,"value"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"span",2),n(3,"storefront"),t(),i(4,"div",3)(5,"h1"),n(6,"Catalogo Prodotti"),t(),i(7,"p",4),n(8,"Gestisci i prodotti del tuo catalogo fornitore"),t()()(),i(9,"div",5)(10,"div",6)(11,"div",7)(12,"span",2),n(13,"inventory"),t(),i(14,"h3",8),n(15,"Prodotti Totali"),t()(),i(16,"div",9),n(17),t()(),i(18,"div",6)(19,"div",7)(20,"span",2),n(21,"check_circle"),t(),i(22,"h3",8),n(23,"Prodotti Disponibili"),t()(),i(24,"div",9),n(25),t()(),i(26,"div",6)(27,"div",7)(28,"span",2),n(29,"euro"),t(),i(30,"h3",8),n(31,"Valore Catalogo"),t()(),i(32,"div",9),n(33),C(34,"number"),t()()(),i(35,"div",10)(36,"div",11)(37,"div",12)(38,"label",13),n(39,"Cerca Prodotti"),t(),i(40,"input",14),s("input",function(v){return a.onSearchChange(v.target.value)}),t()(),i(41,"div",12)(42,"label",13),n(43,"Ordina per"),t(),i(44,"select",15),s("change",function(v){return a.onSortChange(v.target.value)}),i(45,"option",16),n(46,"Nome"),t(),i(47,"option",17),n(48,"Prezzo"),t()()(),i(49,"div",12)(50,"label",18)(51,"input",19),s("change",function(){return a.toggleAvailableFilter()}),t(),n(52," Mostra solo prodotti disponibili "),t()()(),i(53,"div",20)(54,"button",21),s("click",function(){return a.newProduct()}),i(55,"span",2),n(56,"add"),t(),n(57," Nuovo Prodotto "),t()()(),i(58,"div",22)(59,"div",23)(60,"table",24)(61,"thead")(62,"tr")(63,"th"),n(64,"Nome Prodotto"),t(),i(65,"th"),n(66,"Descrizione"),t(),i(67,"th"),n(68,"Prezzo Unitario"),t(),i(69,"th"),n(70,"Quantit\xE0 Confezione"),t(),i(71,"th"),n(72,"Unit\xE0"),t(),i(73,"th"),n(74,"Stato"),t(),i(75,"th"),n(76,"Azioni"),t()()(),i(77,"tbody"),u(78,X,5,0,"tr",25)(79,Z,28,11,"tr",26)(80,te,11,1,"tr",25),t()()()(),u(81,de,71,18,"div",27),t()),e&2&&(o(17),_(a.products.length),o(8),_(a.availableProductsCount),o(8),b("\u20AC",k(34,10,a.totalProductsValue,"1.2-2")),o(7),d("value",a.searchTerm),o(4),d("value",a.sortBy),o(7),d("checked",a.showAvailableOnly),o(27),d("ngIf",a.isLoading),o(),d("ngForOf",a.filteredProducts),o(),d("ngIf",!a.isLoading&&a.filteredProducts.length===0),o(),d("ngIf",a.showProductForm))},dependencies:[T,O,F,R,U,$,j,z,D,N,G,q,A,Y,L,B,M],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:1000;padding:var(--gutter-sm);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.modal-content[_ngcontent-%COMP%]{background:var(--background);border-radius:24px;padding:var(--gutter-lg);max-width:800px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 40px #0000004d,0 0 0 1px var(--smoke-color-1);animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.2,.9,.2,1);position:relative}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:between;margin-bottom:var(--gutter-lg);padding-bottom:var(--gutter-md);border-bottom:2px solid var(--smoke-color-1)}.modal-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--gutter-sm);margin:0;font-size:var(--fs-md);color:var(--text-color);flex:1}.modal-close[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.modal-close[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1);color:var(--text-color)}.modal-body[_ngcontent-%COMP%]{padding:var(--gutter-md) 0}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.ingredient-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:700px}.product-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:600px}.supplier-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:500px}.confirmation-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:400px;text-align:center}.confirmation-modal[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-sm);justify-content:center;margin-top:var(--gutter-lg)}.full-modal[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{max-width:95vw;max-height:95vh}@media (max-width: 768px){.modal-overlay[_ngcontent-%COMP%]{padding:var(--gutter-sm);align-items:flex-end}.modal-content[_ngcontent-%COMP%]{border-radius:24px 24px 0 0;max-height:85vh;animation:slideUpMobile .3s cubic-bezier(.2,.9,.2,1)}@keyframes slideUpMobile{0%{opacity:0;transform:translateY(100%)}to{opacity:1;transform:translateY(0)}}.modal-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:var(--gutter-sm)}.modal-close[_ngcontent-%COMP%]{position:absolute;top:var(--gutter-md);right:var(--gutter-md)}}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--smoke-color-1);border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary);border-radius:4px}.modal-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:color-mix(in srgb,var(--primary) 80%,black)}"]})};export{W as SupplierIngredients};
