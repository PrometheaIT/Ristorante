import{a as d}from"./chunk-XJU7QOT3.js";import{N as u,a as o,b as l,ba as c,f as r,y as n}from"./chunk-UE7YVF6I.js";var g=class a extends d{getTableName(){return"dishes"}constructor(){super(),this.authService.currentUser$.pipe(u(1)).subscribe(e=>{e&&this.loadData()})}getAvailableDishes(){return this.data$.pipe(n(e=>e.filter(t=>t.status==="available")))}getDishesByCategory(e){return this.data$.pipe(n(t=>t.filter(i=>i.category_id===e)))}getDishById$(e){return this.getById(e)}createDish(e){return r(this,null,function*(){if(console.log("\u{1F4DD} Creating dish:",e),!e.name||e.name.trim()==="")return this.errorSubject.next("Il nome del piatto \xE8 obbligatorio"),null;if(e.base_price<=0)return this.errorSubject.next("Il prezzo base deve essere maggiore di 0"),null;let t=l(o({},e),{status:e.status||"available",category_id:e.category_id||null});return this.create(t)})}updateDish(e,t){return r(this,null,function*(){return console.log("\u{1F504} Updating dish:",e,t),t.name!==void 0&&t.name.trim()===""?(this.errorSubject.next("Il nome del piatto non pu\xF2 essere vuoto"),!1):t.base_price!==void 0&&t.base_price<=0?(this.errorSubject.next("Il prezzo base deve essere maggiore di 0"),!1):this.update(e,t)})}deleteDish(e){return r(this,null,function*(){return console.log("\u{1F5D1}\uFE0F Deleting dish:",e),this.delete(e)})}changeDishStatus(e,t){return r(this,null,function*(){return this.update(e,{status:t})})}updateFoodCost(e,t){return r(this,null,function*(){return t<0?(this.errorSubject.next("Il food cost non pu\xF2 essere negativo"),!1):this.update(e,{food_cost:t})})}searchDishes(e){return this.data$.pipe(n(t=>{if(!e.trim())return t;let i=e.toLowerCase();return t.filter(s=>s.name.toLowerCase().includes(i)||s.description?.toLowerCase().includes(i))}))}getDefaultCategoryId(){return r(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return null;let{data:t,error:i}=yield this.supabaseService.getSupabaseClient().from("categories").select("id").eq("restaurant_id",e).eq("is_default",!0).limit(1).single();if(i||!t){console.warn("No default category found, using first category");let{data:s}=yield this.supabaseService.getSupabaseClient().from("categories").select("id").eq("restaurant_id",e).limit(1).single();return s?.id||null}return t.id}catch(e){return console.error("Error getting default category:",e),null}})}loadDishes(){return r(this,null,function*(){return this.loadData()})}reloadDishes(){return r(this,null,function*(){return this.loadData()})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{g as a};
