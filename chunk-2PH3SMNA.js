import{a as g}from"./chunk-VUEJXLA3.js";import{a as M}from"./chunk-AMYEPXIV.js";import{Y as l,ca as d,na as v,s as u}from"./chunk-5BU4UD4M.js";import{a as h,b as m,g as r}from"./chunk-RA2WU32H.js";var c=class n extends M{getTableName(){return"menus"}getDefaultActiveMenu$(){return this.data$.pipe(u(e=>e.find(i=>i.is_default&&i.is_active)??null))}getActiveMenus$(){return this.data$.pipe(u(e=>e.filter(i=>i.is_active)))}getGlobalMenus$(){return this.data$.pipe(u(e=>e.filter(i=>i.is_active&&i.type==="global")))}getDedicatedMenus$(){return this.data$.pipe(u(e=>e.filter(i=>i.is_active&&i.type==="dedicated")))}patchMenu(e,i){return r(this,null,function*(){let{error:t}=yield this.getSupabaseClientPublic().from("menus").update(m(h({},i),{updated_at:new Date().toISOString()})).eq("id",e);return!t})}static \u0275fac=(()=>{let e;return function(t){return(e||(e=v(n)))(t||n)}})();static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};var D=class n{menuService=d(c);menuDishService=d(g);get menus$(){return this.menuService.data$}get menusLoading$(){return this.menuService.loading$}get menusError$(){return this.menuService.error$}loadMenus(){return r(this,null,function*(){return this.menuService.loadData()})}createMenu(e,i,t=!1,a="global"){return r(this,null,function*(){let o={name:e,description:i,is_default:t,is_active:!0,display_order:0,type:a,is_favorite:!1},s=yield this.menuService.create(o);return s&&t&&(yield this.setAsDefault(s.id)),s})}createDedicatedMenu(e,i){return r(this,null,function*(){return this.createMenu(e,i,!1,"dedicated")})}setAsDefault(e){return r(this,null,function*(){let a=this.menuService.data.filter(s=>s.is_default).filter(s=>s.id!==e).map(s=>this.menuService.update(s.id,{is_default:!1}));yield Promise.all(a);let o=yield this.menuService.update(e,{is_default:!0,is_active:!0,type:"global"});return o&&(yield this.loadMenus()),o})}toggleMenuActive(e){return r(this,null,function*(){let i=this.menuService.data.find(a=>a.id===e);if(!i||i.is_default)return!1;let t=yield this.menuService.update(e,{is_active:!i.is_active});return t&&(yield this.loadMenus()),t})}updateMenu(e,i){return r(this,null,function*(){let t=yield this.menuService.update(e,i);return t&&(yield this.loadMenus()),t})}deleteMenu(e){return r(this,null,function*(){return this.menuService.data.find(t=>t.id===e)?.is_default?!1:this.menuService.delete(e)})}getDefaultActiveMenu$(){return this.menuService.getDefaultActiveMenu$()}getActiveMenus$(){return this.menuService.getActiveMenus$()}getGlobalMenus$(){return this.menuService.getGlobalMenus$()}getDedicatedMenus$(){return this.menuService.getDedicatedMenus$()}get menuDishes$(){return this.menuDishService.data$}get menuDishesLoading$(){return this.menuDishService.loading$}get menuDishesError$(){return this.menuDishService.error$}loadMenuDishes(e){return r(this,null,function*(){return e?this.menuDishService.loadData({menu_id:e}):this.menuDishService.loadData()})}getDishesByMenu$(e){return this.menuDishService.getDishesByMenu$(e)}getDishesByMenuOrdered$(e){return this.menuDishService.getDishesByMenuOrdered$(e)}addDishToMenu(e,i,t,a=0){return r(this,null,function*(){return this.menuDishService.addDishToMenu(e,i,t,a)})}removeDishFromMenu(e){return r(this,null,function*(){return this.menuDishService.removeDishFromMenu(e)})}updateDishOrder(e,i){return r(this,null,function*(){return this.menuDishService.updateDishOrder(e,i)})}getDishesWithDetailsByMenu(e){return r(this,null,function*(){return this.menuDishService.getDishesWithDetailsByMenu(e)})}removeAllDishesFromMenu(e){return r(this,null,function*(){return this.menuDishService.removeAllDishesFromMenu(e)})}moveDishInMenu(e,i,t){return r(this,null,function*(){return this.menuDishService.moveDishInMenu(e,i,t)})}reorderDishes(e,i){return r(this,null,function*(){return this.menuDishService.reorderDishes(e,i)})}initializeOrderIndexes(e){return r(this,null,function*(){return this.menuDishService.initializeOrderIndexes(e)})}getCurrentMenus(){return this.menuService.data}getCurrentMenuDishes(){return this.menuDishService.data}isDishInMenu(e,i){return this.menuDishService.data.some(t=>t.menu_id===e&&t.dish_id===i&&t.is_active)}getNextDisplayOrder(e){let i=this.menuDishService.data.filter(t=>t.menu_id===e);return i.length?Math.max(...i.map(t=>t.display_order))+1:0}refreshAll(){return r(this,null,function*(){yield Promise.all([this.loadMenus(),this.loadMenuDishes()])})}loadData(){return r(this,null,function*(){return this.loadMenus()})}get data$(){return this.menus$}delete(e){return r(this,null,function*(){return this.deleteMenu(e)})}updateMenuDish(e,i){return r(this,null,function*(){return this.menuDishService.update(e,i)})}static \u0275fac=function(i){return new(i||n)};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};export{D as a};
