import{a as Z}from"./chunk-4WAPVM25.js";import{b as Q,d as q,h as G,j as H,q as J,r as K,s as U,x as X}from"./chunk-7VSFVQGQ.js";import{a as Y}from"./chunk-QPLQGKZF.js";import"./chunk-VOCUDH6H.js";import"./chunk-QMR2VPJU.js";import"./chunk-TAPIY3IR.js";import"./chunk-HZAFCD3S.js";import{c as V,d as W,j as L,l as A,m as $,r as j}from"./chunk-VYE6ILYG.js";import{$a as _,Bb as T,Db as D,Eb as n,Fb as E,Ga as o,Gb as d,Hb as F,Jb as v,Kb as S,Lb as b,Qb as g,Sb as f,Tb as I,Wa as z,da as B,g as y,hb as p,ia as M,ib as i,ja as C,jb as t,nb as N,ob as R,pb as P,sb as u,ub as m}from"./chunk-3SWAHN2Y.js";function ie(l,a){if(l&1&&(i(0,"option",44),n(1),t()),l&2){let e=a.$implicit;p("value",e.id),o(),d(" ",e.name," ")}}function ne(l,a){if(l&1&&(i(0,"span",19),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ae(l,a){if(l&1&&(i(0,"span",19),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function re(l,a){if(l&1&&(i(0,"span",19),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function oe(l,a){if(l&1&&(i(0,"span",19),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function le(l,a){if(l&1&&(i(0,"tr",45)(1,"td",46)(2,"div",47)(3,"span",9),n(4,"folder"),t(),i(5,"div",48),n(6),t(),i(7,"span",49),n(8),t()()()()),l&2){let e=m().$implicit,r=m();o(6),E(e.name),o(2),d(" ",r.getDishesByCategory(e.id).length," piatti ")}}function se(l,a){if(l&1&&(i(0,"div",57),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),F(" ",I(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function ce(l,a){if(l&1&&(i(0,"span",5),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function de(l,a){l&1&&(i(0,"span",5),n(1,"-"),t())}function pe(l,a){if(l&1){let e=P();i(0,"tr")(1,"td")(2,"div",50)(3,"div",51)(4,"strong",52),u("click",function(){let c=M(e).$implicit,s=m(2);return C(s.editDish(c.id))}),n(5),t(),_(6,se,3,6,"div",53),t()()(),i(7,"td"),n(8),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"select",54),u("ngModelChange",function(c){let s=M(e).$implicit,h=m(2);return C(h.updateDishStatus(s,c))}),i(22,"option",24),n(23,"Disponibile"),t(),i(24,"option",25),n(25,"Non disponibile"),t(),i(26,"option",26),n(27,"Esaurito"),t()()(),i(28,"td"),_(29,ce,2,1,"span",55)(30,de,2,0,"span",55),t(),i(31,"td")(32,"button",56),u("click",function(){let c=M(e).$implicit,s=m(2);return C(s.confirmDeleteDish(c))}),i(33,"span",19),n(34,"delete"),t(),n(35," Elimina "),t()()()}if(l&2){let e=a.$implicit,r=m(2);o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(2),E(r.getCategoryName(e.category_id||"")),o(3),d("\u20AC",f(12,17,e.base_price,"1.2-2")),o(3),d("",f(15,20,r.calculateFoodCostPercentage(e),"1.0-1"),"%"),o(3),D(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",f(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),T("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),p("ngModel",e.status),o(8),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function me(l,a){if(l&1&&(N(0),_(1,le,9,2,"tr",42)(2,pe,36,26,"tr",41),R()),l&2){let e=a.$implicit,r=m();o(),p("ngIf",r.getDishesByCategory(e.id).length>0),o(),p("ngForOf",r.getDishesByCategory(e.id))}}function ue(l,a){if(l&1&&(i(0,"tr",45)(1,"td",58)(2,"div",59)(3,"span",19),n(4,"folder_open"),t(),n(5," Senza Categoria "),i(6,"span",60),n(7),t()()()()),l&2){let e=m();o(7),d(" ",e.getDishesByCategory("").length," piatti ")}}function ge(l,a){if(l&1&&(i(0,"div",57),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),F(" ",I(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function _e(l,a){if(l&1&&(i(0,"span",5),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function fe(l,a){l&1&&(i(0,"span",5),n(1,"-"),t())}function he(l,a){if(l&1){let e=P();i(0,"tr")(1,"td")(2,"div",50)(3,"div",51)(4,"strong",52),u("click",function(){let c=M(e).$implicit,s=m();return C(s.editDish(c.id))}),n(5),t(),_(6,ge,3,6,"div",53),t()()(),i(7,"td",5),n(8,"-"),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"span"),n(22),g(23,"number"),t()(),i(24,"td")(25,"span",49),n(26),t()(),i(27,"td"),_(28,_e,2,1,"span",55)(29,fe,2,0,"span",55),t()()}if(l&2){let e=a.$implicit,r=m();o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(5),d("\u20AC",f(12,17,e.base_price,"1.2-2")),o(3),d("\u20AC",f(15,20,e.food_cost,"1.2-2")),o(3),D(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",f(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),D(r.calculateMarginPercentage(e)>=0?"text-muted":"error"),o(),d(" ",f(23,26,r.calculateMarginPercentage(e),"1.0-0"),"% "),o(3),T("active",e.status==="available")("inactive",e.status!=="available"),o(),d(" ",r.getStatusText(e.status)," "),o(2),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function xe(l,a){l&1&&(i(0,"tr")(1,"td",61)(2,"div",62)(3,"span",19),n(4,"search_off"),t(),i(5,"h3"),n(6,"Nessun piatto trovato"),t(),i(7,"p"),n(8,"Prova a modificare i filtri di ricerca o aggiungi un nuovo piatto"),t()()()())}var ee=class l{dishService=B(Y);categoryService=B(Z);router=B(j);dishes=[];categories=[];filteredDishes=[];stats={totalDishes:0,totalCategories:0,averagePrice:0,averageFoodCostPercentage:0,averageMarginPercentage:0};searchTerm="";selectedCategory="all";statusFilter="all";priceRange={min:null,max:null};sortField="name";sortDirection="asc";ngOnInit(){this.loadData()}loadData(){return y(this,null,function*(){yield this.dishService.loadData(),yield this.categoryService.loadData(),this.dishService.data$.subscribe(a=>{this.dishes=a,this.applyFilters(),this.calculateStats()}),this.categoryService.data$.subscribe(a=>{this.categories=a,this.calculateStats()})})}calculateStats(){let a=this.dishes.length,e=this.categories.length,r=this.dishes.reduce((x,w)=>x+(w.base_price||0),0),c=a>0?r/a:0,s=this.dishes.filter(x=>x.base_price>0),h=s.length,k=0,O=0;h>0&&s.forEach(x=>{let w=x.food_cost/x.base_price*100,te=100-w;k+=w,O+=te}),this.stats={totalDishes:a,totalCategories:e,averagePrice:c,averageFoodCostPercentage:h>0?k/h:0,averageMarginPercentage:h>0?O/h:0}}applyFilters(){let a=[...this.dishes];this.searchTerm&&(a=a.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description?.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.selectedCategory!=="all"&&(a=a.filter(e=>e.category_id===this.selectedCategory)),this.statusFilter!=="all"&&(a=a.filter(e=>e.status===this.statusFilter)),this.priceRange.min!==null&&(a=a.filter(e=>e.base_price>=this.priceRange.min)),this.priceRange.max!==null&&(a=a.filter(e=>e.base_price<=this.priceRange.max)),a.sort((e,r)=>{let c,s;switch(this.sortField){case"name":c=e.name.toLowerCase(),s=r.name.toLowerCase();break;case"price":c=e.base_price,s=r.base_price;break;case"food_cost":c=e.food_cost,s=r.food_cost;break;case"margin":c=e.base_price-e.food_cost,s=r.base_price-r.food_cost;break;default:c=e.name.toLowerCase(),s=r.name.toLowerCase()}return c<s?this.sortDirection==="asc"?-1:1:c>s?this.sortDirection==="asc"?1:-1:0}),this.filteredDishes=a}onSort(a){this.sortField===a?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=a,this.sortDirection="asc"),a==="food_cost_percentage"&&(this.sortField="food_cost"),this.applyFilters()}getCategoryName(a){return this.categories.find(r=>r.id===a)?.name||"Senza categoria"}calculateMargin(a){return a.base_price-a.food_cost}calculateMarginPercentage(a){return a.base_price===0?0:(a.base_price-a.food_cost)/a.base_price*100}getDishesByCategory(a){return this.filteredDishes.filter(e=>e.category_id===a)}resetFilters(){this.searchTerm="",this.selectedCategory="all",this.statusFilter="all",this.priceRange={min:null,max:null},this.applyFilters()}getStatusText(a){return{available:"Disponibile",unavailable:"Non disponibile",out_of_stock:"Esaurito"}[a]||a}editDish(a){this.router.navigate(["/food-cost-calculator",a])}createNewDish(){this.router.navigate(["/food-cost-calculator"])}calculateFoodCostPercentage(a){return!a.base_price||a.base_price===0?0:a.food_cost/a.base_price*100}updateDishStatus(a,e){return y(this,null,function*(){try{let r=a.status;e==="available"||e==="unavailable"||e==="out_of_stock"?(a.status=e,(yield this.dishService.updateDish(a.id,{status:e}))?(console.log(`Stato piatto ${a.name} aggiornato a: ${e}`),this.calculateStats()):(a.status=r,console.error("Errore nell'aggiornamento dello stato del piatto"),alert("Errore durante l'aggiornamento dello stato. Riprova."))):(console.error("Stato non valido:",e),alert("Stato non valido selezionato."))}catch(r){console.error("Errore durante l'aggiornamento dello stato:",r),alert("Errore durante l'aggiornamento dello stato.")}})}confirmDeleteDish(a){return y(this,null,function*(){let e=`Sei sicuro di voler eliminare il piatto "${a.name}"?

Questa azione non pu\xF2 essere annullata.`;confirm(e)&&(yield this.deleteDish(a.id))})}deleteDish(a){return y(this,null,function*(){try{(yield this.dishService.deleteDish(a))?console.log("\u2705 Piatto eliminato con successo"):alert("Errore durante l'eliminazione del piatto")}catch(e){console.error("\u274C Errore durante l'eliminazione:",e),alert("Errore durante l'eliminazione del piatto")}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=z({type:l,selectors:[["app-menu-builder"]],decls:150,vars:28,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards","p-sm02"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","text-amber-500","justify-center","flex"],[1,"text-muted","card-footer"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"form-card","m-sm02"],[1,"flex","justify-between","items-end","gap-md","flex-wrap"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"material-icons"],["type","text","placeholder","Cerca per nome o descrizione...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["value","available"],["value","unavailable"],["value","out_of_stock"],[2,"display","flex","gap","var(--gap-sm)"],["type","number","placeholder","Min",3,"ngModelChange","input","ngModel"],[2,"align-self","center"],["type","number","placeholder","Max",3,"ngModelChange","input","ngModel"],[1,"modal-footer",2,"margin","0"],[1,"promethea-button","ghost",3,"click"],[1,"modal-footer","p-sm"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"crm-table"],[2,"cursor","pointer",3,"click"],["class","material-icons",4,"ngIf"],[2,"width","100px"],[4,"ngFor","ngForOf"],["class","category-header",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"category-header"],["colspan","8",2,"background","var(--smoke-color-2)","font-weight","800"],[1,"text-md","flex","gap-md",2,"margin","0","border","none"],[1,"text-primary"],[1,"chip"],[1,"flex","items-center","gap-sm"],[1,"nomedescpiatto"],[1,"link",3,"click"],["class","text-muted","style","font-size: 0.8rem;",4,"ngIf"],[1,"status-select",3,"ngModelChange","ngModel"],["class","text-muted",4,"ngIf"],["title","Elimina piatto",1,"promethea-button","danger","small",3,"click"],[1,"text-muted",2,"font-size","0.8rem"],["colspan","8",2,"background","var(--smoke-1)","font-weight","800"],[1,"section-title",2,"margin","0","border","none"],[1,"chip",2,"margin-left","auto"],["colspan","8",1,"empty-state-row"],[1,"empty-state"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"dashboard"),t(),i(5,"h1",4),n(6,"Men\xF9"),t()(),i(7,"p",5),n(8,"Panoramica completa delle attivit\xE0 del tuo ristorante"),t()(),i(9,"div",6)(10,"div",7)(11,"div",8)(12,"span",9),n(13,"restaurant"),t(),i(14,"h3",10),n(15,"Totale Piatti"),t()(),i(16,"div",11),n(17),t(),i(18,"span",12),n(19,"Piatti nel men\xF9"),t()(),i(20,"div",7)(21,"div",8)(22,"span",9),n(23,"category"),t(),i(24,"h3",10),n(25,"Categorie"),t()(),i(26,"div",11),n(27),t(),i(28,"span",12),n(29,"Categorie attive"),t()(),i(30,"div",7)(31,"div",8)(32,"span",9),n(33,"euro"),t(),i(34,"h3",10),n(35,"Prezzo Medio"),t()(),i(36,"div",11),n(37),g(38,"number"),t(),i(39,"span",12),n(40,"Prezzo medio piatto"),t()(),i(41,"div",7)(42,"div",8)(43,"span",9),n(44,"trending_up"),t(),i(45,"h3",10),n(46,"Margine Medio"),t()(),i(47,"div",13),n(48),g(49,"number"),t(),i(50,"span",12),n(51,"Margine medio (in %)"),t()(),i(52,"div",7)(53,"div",8)(54,"span",9),n(55,"account_balance"),t(),i(56,"h3",10),n(57,"Food Cost Medio"),t()(),i(58,"div",13),n(59),g(60,"number"),t(),i(61,"span",12),n(62,"Food cost medio (in %)"),t()()(),i(63,"div",14)(64,"div",15)(65,"div",16)(66,"div",17)(67,"label",18)(68,"span",19),n(69,"search"),t(),n(70," Cerca "),t(),i(71,"input",20),b("ngModelChange",function(s){return S(r.searchTerm,s)||(r.searchTerm=s),s}),u("input",function(){return r.applyFilters()}),t()(),i(72,"div",17)(73,"label",18)(74,"span",19),n(75,"category"),t(),n(76," Categoria "),t(),i(77,"select",21),b("ngModelChange",function(s){return S(r.selectedCategory,s)||(r.selectedCategory=s),s}),u("change",function(){return r.applyFilters()}),i(78,"option",22),n(79,"Tutte le categorie"),t(),_(80,ie,2,2,"option",23),t()()(),i(81,"div",16)(82,"div",17)(83,"label",18)(84,"span",19),n(85,"visibility"),t(),n(86," Stato "),t(),i(87,"select",21),b("ngModelChange",function(s){return S(r.statusFilter,s)||(r.statusFilter=s),s}),u("change",function(){return r.applyFilters()}),i(88,"option",22),n(89,"Tutti gli stati"),t(),i(90,"option",24),n(91,"Disponibile"),t(),i(92,"option",25),n(93,"Non disponibile"),t(),i(94,"option",26),n(95,"Esaurito"),t()()(),i(96,"div",17)(97,"label",18)(98,"span",19),n(99,"euro"),t(),n(100," Prezzo "),t(),i(101,"div",27)(102,"input",28),b("ngModelChange",function(s){return S(r.priceRange.min,s)||(r.priceRange.min=s),s}),u("input",function(){return r.applyFilters()}),t(),i(103,"span",29),n(104,"-"),t(),i(105,"input",30),b("ngModelChange",function(s){return S(r.priceRange.max,s)||(r.priceRange.max=s),s}),u("input",function(){return r.applyFilters()}),t()()()(),i(106,"div",31)(107,"button",32),u("click",function(){return r.resetFilters()}),i(108,"span",19),n(109,"refresh"),t(),n(110," Reset "),t()()()(),i(111,"div",33)(112,"button",34),u("click",function(){return r.createNewDish()}),i(113,"span",19),n(114,"add"),t(),n(115," Nuovo Piatto "),t(),i(116,"button",32),u("click",function(){return r.resetFilters()}),i(117,"span",19),n(118,"refresh"),t(),n(119," Reset Filtri "),t()(),i(120,"div",35)(121,"div",36)(122,"table",37)(123,"thead")(124,"tr")(125,"th",38),u("click",function(){return r.onSort("name")}),n(126," Nome "),_(127,ne,2,1,"span",39),t(),i(128,"th"),n(129,"Categoria"),t(),i(130,"th",38),u("click",function(){return r.onSort("price")}),n(131," Prezzo "),_(132,ae,2,1,"span",39),t(),i(133,"th",38),u("click",function(){return r.onSort("food_cost_percentage")}),n(134," Food Cost % "),_(135,re,2,1,"span",39),t(),i(136,"th",38),u("click",function(){return r.onSort("margin")}),n(137," Margine (\u20AC) "),_(138,oe,2,1,"span",39),t(),i(139,"th"),n(140,"Stato"),t(),i(141,"th"),n(142,"Tempo Prep."),t(),i(143,"th",40),n(144,"Azioni"),t()()(),i(145,"tbody"),_(146,me,3,2,"ng-container",41)(147,ue,8,1,"tr",42)(148,he,30,29,"tr",41)(149,xe,9,0,"tr",43),t()()()()()),e&2&&(o(17),E(r.stats.totalDishes),o(10),E(r.stats.totalCategories),o(10),d("\u20AC",f(38,19,r.stats.averagePrice,"1.2-2")),o(11),d(" ",f(49,22,r.stats.averageMarginPercentage,"1.0-1"),"% "),o(11),d(" ",f(60,25,r.stats.averageFoodCostPercentage,"1.0-1"),"% "),o(12),v("ngModel",r.searchTerm),o(6),v("ngModel",r.selectedCategory),o(3),p("ngForOf",r.categories),o(7),v("ngModel",r.statusFilter),o(15),v("ngModel",r.priceRange.min),o(3),v("ngModel",r.priceRange.max),o(22),p("ngIf",r.sortField==="name"),o(5),p("ngIf",r.sortField==="price"),o(3),p("ngIf",r.sortField==="food_cost_percentage"),o(3),p("ngIf",r.sortField==="margin"),o(8),p("ngForOf",r.categories),o(),p("ngIf",r.getDishesByCategory("").length>0),o(),p("ngForOf",r.getDishesByCategory("")),o(),p("ngIf",r.filteredDishes.length===0))},dependencies:[$,V,W,X,K,U,Q,H,J,q,G,A,L],styles:[".category-header[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.category-header[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gap-md)!important}.crm-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(.category-header):hover{background:var(--smoke-1)}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.nomedescpiatto[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:calc(var(--gap-sm) / 2)}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.crm-table[_ngcontent-%COMP%]{min-width:800px}}.status-select.available[_ngcontent-%COMP%]{border-color:var(--success-color, #28a745)}.status-select.unavailable[_ngcontent-%COMP%]{border-color:var(--warning-color, #ffc107)}.status-select.out_of_stock[_ngcontent-%COMP%]{border-color:var(--danger-color, #dc3545)}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}.chip.active[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.chip.inactive[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}"]})};export{ee as MenuBuilder};
