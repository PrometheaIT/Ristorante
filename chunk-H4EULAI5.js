import{a as f}from"./chunk-5BFIQ7BP.js";import{$ as l,a as c,b as u,f as s,m as g,xa as d}from"./chunk-K5RDB55Y.js";var m=class i extends f{getTableName(){return"expenses"}categoriesSubject=new g([]);categories$=this.categoriesSubject.asObservable();getDefaultCategories(){return["Affitto","Bollette (Luce/Gas/Acqua)","Telefono/Internet","Personale","Forniture","Manutenzione","Marketing","Assicurazione","Tasse","Mutuo","Utensili e Attrezzature","Pulizia e Igiene","Spese Bancarie","Software e Tecnologia","Trasporti e Consegne","Formazione","Altro"]}loadCategories(){return s(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let{data:t,error:r}=yield this.supabaseService.getSupabaseClient().from("expense_categories").select("*").eq("restaurant_id",e).eq("is_active",!0).order("name");if(r)throw r;this.categoriesSubject.next(t||[])}catch(e){console.error("Error loading expense categories:",e)}})}createCategory(e){return s(this,null,function*(){try{let t=yield this.getCurrentRestaurantId();if(!t)return null;let r=u(c({},e),{is_active:e.is_active??!0,restaurant_id:t,created_at:new Date().toISOString()}),{data:a,error:n}=yield this.supabaseService.getSupabaseClient().from("expense_categories").insert(r).select().single();if(n)throw n;return yield this.loadCategories(),a}catch(t){return console.error("Error creating expense category:",t),null}})}loadExpensesForMonth(e){return s(this,null,function*(){try{let t=yield this.getCurrentRestaurantId();if(!t)return;let r=this.formatMonthForDatabase(e),{data:a,error:n}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",t).eq("month",r).order("type").order("category");if(n)throw n;this.dataSubject.next(a||[])}catch(t){console.error("Error loading expenses for month:",t)}})}formatMonthForDatabase(e){return e.match(/^\d{4}-\d{2}-\d{2}$/)?e:e.match(/^\d{4}-\d{2}$/)?`${e}-01`:new Date(e).toISOString().split("T")[0]}calculateMonthlyTotal(e){let t=e.filter(a=>a.type==="fissa").reduce((a,n)=>a+n.amount,0),r=e.filter(a=>a.type==="variabile").reduce((a,n)=>a+n.amount,0);return{fisse:t,variabili:r,totale:t+r}}getAvailableMonths(){return s(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return[];let{data:t,error:r}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("month").eq("restaurant_id",e).order("month",{ascending:!1});if(r)throw r;return[...new Set(t?.map(n=>n.month)||[])]}catch(e){return console.error("Error getting available months:",e),[]}})}loadExpensesForDateRange(e,t){return s(this,null,function*(){try{let r=yield this.getCurrentRestaurantId();if(!r)return[];let a=this.formatMonthForDatabase(e),n=this.formatMonthForDatabase(t),{data:p,error:o}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",r).gte("month",a).lte("month",n).order("month",{ascending:!1}).order("type").order("category");if(o)throw o;return p||[]}catch(r){return console.error("Error loading expenses for date range:",r),[]}})}static \u0275fac=(()=>{let e;return function(r){return(e||(e=d(i)))(r||i)}})();static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
