import{a as N,b as T,c,d as z,e as P,i as k,k as V,n as D,o as M,p as O,q as G,u as A,w as $}from"./chunk-CV27PIWO.js";import{a as R}from"./chunk-CXV4BLDF.js";import{d as w,e as I,k as C,w as F}from"./chunk-L5SOXNIK.js";import{$a as E,Cb as _,Db as S,Ha as h,Ka as l,Pb as n,Qb as x,Va as f,eb as v,f as g,pb as s,qb as t,rb as e,sb as m}from"./chunk-KZSY5CHT.js";function U(o,i){if(o&1&&(t(0,"option",34),n(1),e()),o&2){let a=i.$implicit;s("value",a),l(),x(a)}}function j(o,i){if(o&1&&(t(0,"div",35),m(1,"img",36),e()),o&2){let a=S();l(),s("src",a.logoPreview,h)}}function B(o,i){if(o&1&&(t(0,"div",35),m(1,"img",37),e()),o&2){let a=S();l(),s("src",a.coverPreview,h)}}function L(o,i){o&1&&(t(0,"span",2),n(1,"sync"),e())}function H(o,i){o&1&&(t(0,"span",2),n(1,"save"),e())}function J(o,i){o&1&&(t(0,"span"),n(1,"Salvataggio..."),e())}function K(o,i){o&1&&(t(0,"span"),n(1,"Salva Impostazioni"),e())}var q=class o{constructor(i,a,r){this.fb=i;this.supabaseService=a;this.auth=r;this.supabaseClient=this.supabaseService.getSupabaseClient()}settingsForm;loading=!1;restaurantId;logoPreview;coverPreview;cuisineTypes=["Italiana","Giapponese","Cinese","Indiana","Messicana","Francese","Spagnola","Thailandese","Greca","Americana","Vegetariana","Vegana"];supabaseClient;ngOnInit(){return g(this,null,function*(){this.initForm(),yield this.loadRestaurantData()})}initForm(){this.settingsForm=this.fb.group({name:["",[c.required,c.minLength(2)]],description:[""],address:["",c.required],phone:["",[c.required,c.pattern(/^\+?\d{8,15}$/)]],email:["",[c.required,c.email]],cuisine_type:[""],accepts_delivery:[!1],accepts_takeaway:[!1],allow_table_selection:[!1],is_active:[!0]})}loadRestaurantData(){return g(this,null,function*(){this.loading=!0;try{let i=this.auth.currentUserValue;if(!i)throw new Error("Utente non loggato");let{data:a,error:r}=yield this.supabaseClient.from("restaurants").select("*").eq("owner_id",i.id).single();if(r)throw r;if(!a)throw new Error("Ristorante non trovato");this.restaurantId=a.id,this.patchForm(a),this.logoPreview=a.logo_url||void 0,this.coverPreview=a.cover_image_url||void 0}catch(i){alert("Errore caricamento: "+(i.message||"Impossibile caricare i dati")),console.error(i)}finally{this.loading=!1}})}patchForm(i){this.settingsForm.patchValue({name:i.name,description:i.description||"",address:i.address,phone:i.phone,email:i.email,cuisine_type:i.cuisine_type||"",accepts_delivery:i.accepts_delivery,accepts_takeaway:i.accepts_takeaway,allow_table_selection:i.allow_table_selection,is_active:i.is_active})}onFileSelect(i,a){return g(this,null,function*(){let r=i.target;if(!r.files?.length||!this.restaurantId)return;let p=r.files[0],d=5*1024*1024;if(p.size>d){alert("Immagine troppo grande (max 5MB)");return}let b=`restaurants/${this.restaurantId}/${a}s/${Date.now()}_${p.name}`;this.loading=!0;try{let{error:u}=yield this.supabaseClient.storage.from("restaurant-images").upload(b,p,{upsert:!0});if(u)throw u;let{data:{publicUrl:y}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(b);a==="logo"?this.logoPreview=y:this.coverPreview=y,alert(`${a==="logo"?"Logo":"Copertina"} caricata!`)}catch(u){alert("Errore upload: "+u.message),console.error(u)}finally{this.loading=!1}})}onSubmit(){return g(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId)){this.loading=!0;try{let i=this.settingsForm.value,a={name:i.name,description:i.description||null,address:i.address,phone:i.phone,email:i.email,cuisine_type:i.cuisine_type||null,accepts_delivery:i.accepts_delivery,accepts_takeaway:i.accepts_takeaway,allow_table_selection:i.allow_table_selection,is_active:i.is_active,updated_at:new Date().toISOString()};this.logoPreview&&(a.logo_url=this.logoPreview),this.coverPreview&&(a.cover_image_url=this.coverPreview);let{error:r}=yield this.supabaseClient.from("restaurants").update(a).eq("id",this.restaurantId);if(r)throw r;alert("Impostazioni salvate con successo!")}catch(i){alert("Errore salvataggio: "+i.message),console.error(i)}finally{this.loading=!1}}})}static \u0275fac=function(a){return new(a||o)(f(A),f(F),f(R))};static \u0275cmp=E({type:o,selectors:[["app-restaurant-settings"]],decls:126,vars:9,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"grid-form"],[1,"form-group"],[1,"form-label"],["type","text","formControlName","name","placeholder","Es: Trattoria da Mario"],["type","email","formControlName","email","placeholder","info@ristorante.it"],["type","tel","formControlName","phone","placeholder","+39 123 456 7890"],["formControlName","cuisine_type"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","md:col-span-2"],["type","text","formControlName","address","placeholder","Via Roma 123, Milano"],["formControlName","description","rows","3","placeholder","Racconta la storia del tuo ristorante..."],[1,"mt-2"],["type","file","accept","image/*",1,"w-full",3,"change"],["class","mt-3",4,"ngIf"],[1,"space-y-4"],[1,"checkbox-label","large"],["type","checkbox","formControlName","accepts_delivery"],["type","checkbox","formControlName","accepts_takeaway"],["type","checkbox","formControlName","allow_table_selection"],["type","checkbox","formControlName","is_active"],[1,"form-actions"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"mt-3"],[1,"w-32","h-32","object-cover","rounded-lg","shadow",3,"src"],[1,"w-full","h-48","object-cover","rounded-lg","shadow",3,"src"]],template:function(a,r){a&1&&(t(0,"div",0)(1,"div",1)(2,"span",2),n(3,"settings"),e(),t(4,"div",3)(5,"h1"),n(6,"Impostazioni Ristorante"),e(),t(7,"p",4),n(8,"Gestisci le informazioni e i servizi del tuo ristorante"),e()()(),t(9,"form",5),_("ngSubmit",function(){return r.onSubmit()}),t(10,"div",6)(11,"div",7)(12,"span",2),n(13,"info"),e(),t(14,"h2",8),n(15,"Informazioni Base"),e()(),t(16,"div",9)(17,"div",10)(18,"label",11)(19,"span",2),n(20,"restaurant"),e(),n(21," Nome Ristorante * "),e(),m(22,"input",12),e(),t(23,"div",10)(24,"label",11)(25,"span",2),n(26,"email"),e(),n(27," Email * "),e(),m(28,"input",13),e(),t(29,"div",10)(30,"label",11)(31,"span",2),n(32,"phone"),e(),n(33," Telefono * "),e(),m(34,"input",14),e(),t(35,"div",10)(36,"label",11)(37,"span",2),n(38,"local_dining"),e(),n(39," Tipo di Cucina "),e(),t(40,"select",15)(41,"option",16),n(42,"Seleziona..."),e(),v(43,U,2,2,"option",17),e()(),t(44,"div",18)(45,"label",11)(46,"span",2),n(47,"location_on"),e(),n(48," Indirizzo * "),e(),m(49,"input",19),e(),t(50,"div",18)(51,"label",11)(52,"span",2),n(53,"description"),e(),n(54," Descrizione "),e(),m(55,"textarea",20),e()()(),t(56,"div",6)(57,"div",7)(58,"span",2),n(59,"image"),e(),t(60,"h2",8),n(61,"Immagini"),e()(),t(62,"div",9)(63,"div",10)(64,"label",11)(65,"span",2),n(66,"photo_camera"),e(),n(67," Logo "),e(),t(68,"div",21)(69,"input",22),_("change",function(d){return r.onFileSelect(d,"logo")}),e(),v(70,j,2,1,"div",23),e()(),t(71,"div",10)(72,"label",11)(73,"span",2),n(74,"panorama"),e(),n(75," Copertina "),e(),t(76,"div",21)(77,"input",22),_("change",function(d){return r.onFileSelect(d,"cover")}),e(),v(78,B,2,1,"div",23),e()()()(),t(79,"div",6)(80,"div",7)(81,"span",2),n(82,"room_service"),e(),t(83,"h2",8),n(84,"Servizi Offerti"),e()(),t(85,"div",24)(86,"label",25),m(87,"input",26),t(88,"div")(89,"strong"),n(90,"Consegna a domicilio"),e(),t(91,"div",4),n(92,"I clienti possono ordinare con consegna"),e()()(),t(93,"label",25),m(94,"input",27),t(95,"div")(96,"strong"),n(97,"Asporto"),e(),t(98,"div",4),n(99,"I clienti possono ritirare in loco"),e()()(),t(100,"label",25),m(101,"input",28),t(102,"div")(103,"strong"),n(104,"Prenotazione tavolo"),e(),t(105,"div",4),n(106,"I clienti possono scegliere il tavolo"),e()()()()(),t(107,"div",6)(108,"div",7)(109,"span",2),n(110,"visibility"),e(),t(111,"h2",8),n(112,"Stato Ristorante"),e()(),t(113,"label",25),m(114,"input",29),t(115,"div")(116,"strong"),n(117,"Ristorante attivo"),e(),t(118,"div",4),n(119,"Visibile ai clienti e accettazione ordini"),e()()()(),t(120,"div",30)(121,"button",31),v(122,L,2,0,"span",32)(123,H,2,0,"span",32)(124,J,2,0,"span",33)(125,K,2,0,"span",33),e()()()()),a&2&&(l(9),s("formGroup",r.settingsForm),l(34),s("ngForOf",r.cuisineTypes),l(27),s("ngIf",r.logoPreview),l(8),s("ngIf",r.coverPreview),l(43),s("disabled",r.loading||r.settingsForm.invalid),l(),s("ngIf",r.loading),l(),s("ngIf",!r.loading),l(),s("ngIf",r.loading),l(),s("ngIf",!r.loading))},dependencies:[C,w,I,$,k,O,G,T,N,M,z,P,V,D],encapsulation:2})};export{q as RestaurantSettings};
