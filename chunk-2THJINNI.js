import{a as K}from"./chunk-2S5KLAST.js";import{Ab as J,R as H,Sa as X,U as N,xb as Y,zb as Z}from"./chunk-N3VPFYDE.js";import{B as U,b as L,d as G,h as q,n as B}from"./chunk-45CSFDAZ.js";import{a as j}from"./chunk-RC3HHTXM.js";import{v as W}from"./chunk-MPTEMNWF.js";import{E as h,G as E,Ha as D,Ia as y,Ib as l,J as z,Jb as I,Kb as V,La as r,S,Va as A,Y as F,_a as v,ca as P,gb as m,la as k,m as C,ma as w,mb as d,ob as $,pb as R,qa as T,qb as o,rb as c,s as x,sb as f,vb as O,yb as b,zb as g}from"./chunk-5BU4UD4M.js";import"./chunk-RA2WU32H.js";var M=class i{http=P(j);actionApi="https://it.wikipedia.org/w/api.php";search(t){if(!t.trim())return C([]);let e={action:"query",list:"search",srsearch:t,format:"json",origin:"*",srlimit:10};return this.http.get(this.actionApi,{params:e}).pipe(x(a=>a.query?.search||[]),h(this.handleError("search",[])))}getPageData(t,e=!1){let a={action:"query",titles:t,prop:"extracts|pageimages|info",explaintext:!1,piprop:"thumbnail",pithumbsize:300,inprop:"url",format:"json",origin:"*"};return e?a.exchars=5e3:a.exintro=!0,this.http.get(this.actionApi,{params:a}).pipe(x(n=>{let s=n.query?.pages,_=Object.keys(s)[0],p=s[_];if(!p)return null;let u=p.extract||"";return(u.includes("==")||u.includes("'''"))&&(u=this.wikitextToHtml(u)),{title:p.title,extract:u,thumbnail:p.thumbnail,content_urls:{desktop:{page:p.fullurl}}}}),h(this.handleError("getPageData",null)))}handleError(t,e){return a=>(console.error(`WikipediaService.${t} error:`,a),C(e))}wikitextToHtml(t){if(!t)return"";let e=t.replace(/^==\s*(.+?)\s*==$/gm,"<h2>$1</h2>").replace(/^===\s*(.+?)\s*===$/gm,"<h3>$1</h3>").replace(/^====\s*(.+?)\s*====$/gm,"<h4>$1</h4>").replace(/^\*\s+(.+)$/gm,"<li>$1</li>").replace(/^#\s+(.+)$/gm,'<li style="list-style-type: decimal;">$1</li>').replace(/'''(.*?)'''/g,"<strong>$1</strong>").replace(/''(.*?)''/g,"<em>$1</em>").replace(/\[\[(?:[^|\]]*\|)?([^\]]+)\]\]/g,'<a href="#">$1</a>').replace(/\[(https?:\/\/[^\s]+)\s+([^\]]+)\]/g,'<a href="$1" target="_blank" rel="noopener">$2</a>');return e=e.split(/\n\s*\n/).map(n=>(n=n.trim(),n.startsWith("<h")||n.startsWith("<li")?n:`<p>${n.replace(/\n/g,"<br>")}</p>`)).join(`
`),e}getCategoriesForPages(t){if(t.length===0)return C(new Map);let e={action:"query",pageids:t.join("|"),prop:"categories",cllimit:"max",format:"json",origin:"*"};return this.http.get(this.actionApi,{params:e}).pipe(x(a=>{let n=new Map,s=a.query?.pages;return s&&Object.values(s).forEach(_=>{let p=_.categories?.map(u=>u.title)||[];n.set(_.pageid,p)}),n}),h(this.handleError("getCategoriesForPages",new Map)))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var te=(i,t)=>t.pageid;function ie(i,t){if(i&1){let e=O();o(0,"button",15),b("click",function(){k(e);let n=g();return w(n.clearSearch())}),f(1,"lucide-angular",5),c()}if(i&2){let e=g();r(),m("img",e.XIcon)}}function ae(i,t){i&1&&(o(0,"div",6)(1,"span",16),l(2,"Caricamento..."),c()())}function ne(i,t){if(i&1&&(o(0,"div",7)(1,"span",17),l(2,"error"),c(),o(3,"span"),l(4),c()()),i&2){let e=g();r(4),I(e.error)}}function re(i,t){if(i&1){let e=O();o(0,"button",20),b("click",function(){let n=k(e).$implicit,s=g(2);return w(s.selectResult(n))}),l(1),c()}if(i&2){let e=t.$implicit;r(),V(" ",e.title," ")}}function oe(i,t){if(i&1&&(o(0,"div",8)(1,"h3",18),l(2,"Risultati"),c(),o(3,"div",19),$(4,re,2,1,"button",16,te),c()()),i&2){let e=g();r(4),R(e.results)}}function ce(i,t){if(i&1){let e=O();o(0,"button",30),b("click",function(){k(e);let n=g(2);return w(n.loadFullContent())}),f(1,"lucide-angular",5),c()}if(i&2){let e=g(2);r(),m("img",e.FileTextIcon)}}function le(i,t){if(i&1&&(o(0,"a",26),f(1,"lucide-angular",5),c()),i&2){let e=g(2);m("href",e.selectedPage.content_urls.desktop.page,y),r(),m("img",e.ExternalLinkIcon)}}function ge(i,t){if(i&1&&f(0,"img",28),i&2){let e=g(2);m("src",e.selectedPage.thumbnail.source,y)("alt",e.selectedPage.title)}}function se(i,t){if(i&1&&(o(0,"div",9)(1,"div",21)(2,"div",22)(3,"h2",23),l(4),c(),o(5,"div",24),v(6,ce,2,1,"button",25)(7,le,2,2,"a",26),c()(),o(8,"div",27),v(9,ge,1,2,"img",28),f(10,"div",29),c()()()),i&2){let e=g();r(4),I(e.selectedPage.title),r(2),d(e.isFullContent?-1:6),r(),d(!(e.selectedPage.content_urls==null||e.selectedPage.content_urls.desktop==null)&&e.selectedPage.content_urls.desktop.page?7:-1),r(2),d(e.selectedPage.thumbnail!=null&&e.selectedPage.thumbnail.source?9:-1),r(),m("innerHTML",e.selectedPage.extract,D)}}var Q=class i{wikiService=P(M);destroyRef=P(T);CULINARY_CATEGORIES=["Categoria:Cucina","Categoria:Gastronomia","Categoria:Alimenti","Categoria:Ingredienti alimentari","Categoria:Prodotti alimentari","Categoria:Antipasti","Categoria:Primi piatti","Categoria:Secondi piatti","Categoria:Contorni","Categoria:Dolci","Categoria:Piatti unici","Categoria:Piatti tipici","Categoria:Zuppe e minestre","Categoria:Insalate","Categoria:Salse e sughi","Categoria:Stuzzicheria","Categoria:Frutta","Categoria:Verdura","Categoria:Legumi","Categoria:Cereali","Categoria:Carne","Categoria:Pesce","Categoria:Prodotti ittici","Categoria:Formaggi","Categoria:Salumi","Categoria:Uova","Categoria:Funghi","Categoria:Tuberi","Categoria:Oli e grassi alimentari","Categoria:Zuccheri e dolcificanti","Categoria:Farine","Categoria:Spezie","Categoria:Erbe aromatiche","Categoria:Frutta secca","Categoria:Prodotti da forno","Categoria:Bevande","Categoria:Vini","Categoria:Birra","Categoria:Distillati","Categoria:Liquori","Categoria:Cocktail","Categoria:Bevande analcoliche","Categoria:Caff\xE8","Categoria:T\xE8","Categoria:Acque minerali","Categoria:Vini DOC","Categoria:Vini DOCG","Categoria:Vini IGT","Categoria:Enologia","Categoria:Tecniche culinarie","Categoria:Cottura","Categoria:Conservazione degli alimenti","Categoria:Trasformazione alimentare","Categoria:Panificazione","Categoria:Pasticceria","Categoria:Gelateria","Categoria:Caseificazione","Categoria:Macellazione","Categoria:Affumicatura","Categoria:Marinatura","Categoria:Frittura","Categoria:Arrosto","Categoria:Bollitura","Categoria:Sottaceto","Categoria:Sottolio","Categoria:Attrezzature da cucina","Categoria:Elettrodomestici da cucina","Categoria:Utensili da cucina","Categoria:Stoviglie","Categoria:Pentole e tegami","Categoria:Coltelli","Categoria:Macchine da caff\xE8","Categoria:Forni","Categoria:Frullatori e mixer","Categoria:Bilance","Categoria:Cucina regionale italiana","Categoria:Cucina abruzzese","Categoria:Cucina calabrese","Categoria:Cucina campana","Categoria:Cucina emiliana","Categoria:Cucina friulana","Categoria:Cucina laziale","Categoria:Cucina ligure","Categoria:Cucina lombarda","Categoria:Cucina marchigiana","Categoria:Cucina molisana","Categoria:Cucina piemontese","Categoria:Cucina pugliese","Categoria:Cucina romagnola","Categoria:Cucina sarda","Categoria:Cucina siciliana","Categoria:Cucina toscana","Categoria:Cucina trentina","Categoria:Cucina umbra","Categoria:Cucina valdostana","Categoria:Cucina veneta","Categoria:Cucine nazionali","Categoria:Cucina francese","Categoria:Cucina spagnola","Categoria:Cucina greca","Categoria:Cucina tedesca","Categoria:Cucina austriaca","Categoria:Cucina britannica","Categoria:Cucina irlandese","Categoria:Cucina scandinava","Categoria:Cucina russa","Categoria:Cucina polacca","Categoria:Cucina balcanica","Categoria:Cucina turca","Categoria:Cucina mediorientale","Categoria:Cucina araba","Categoria:Cucina israeliana","Categoria:Cucina nordafricana","Categoria:Cucina etiope","Categoria:Cucina indiana","Categoria:Cucina pakistana","Categoria:Cucina cinese","Categoria:Cucina giapponese","Categoria:Cucina coreana","Categoria:Cucina thailandese","Categoria:Cucina vietnamita","Categoria:Cucina filippina","Categoria:Cucina indonesiana","Categoria:Cucina malese","Categoria:Cucina messicana","Categoria:Cucina peruviana","Categoria:Cucina brasiliana","Categoria:Cucina argentina","Categoria:Cucina caraibica","Categoria:Nutrizione","Categoria:Diete","Categoria:Alimentazione vegetariana","Categoria:Veganismo","Categoria:Cucina senza glutine","Categoria:Cucina senza lattosio","Categoria:Allergie alimentari","Categoria:Intolleranze alimentari","Categoria:Prodotti DOP","Categoria:Prodotti IGP","Categoria:Prodotti STG","Categoria:Prodotti agroalimentari tradizionali italiani","Categoria:Formaggi DOP","Categoria:Salumi DOP","Categoria:Oli DOP","Categoria:Storia dell'alimentazione","Categoria:Gastronomia storica","Categoria:Cucina medievale","Categoria:Cucina rinascimentale","Categoria:Cucina barocca","Categoria:Tradizioni culinarie","Categoria:Folclore alimentare","Categoria:Cuochi","Categoria:Pasticceri","Categoria:Panettieri","Categoria:Macellai","Categoria:Formaggeri","Categoria:Enologi","Categoria:Sommelier","Categoria:Ma\xEEtre","Categoria:Chef","Categoria:Gastronomi","Categoria:Critici gastronomici","Categoria:Ristoranti","Categoria:Tipi di ristoranti","Categoria:Ristoranti stellati","Categoria:Catering","Categoria:Banqueting","Categoria:Mense","Categoria:Fast food","Categoria:Street food","Categoria:Enoteche","Categoria:Bar","Categoria:Pasticcerie","Categoria:Gelaterie","Categoria:Panetterie","Categoria:Macellerie","Categoria:Pescherie","Categoria:Ortofrutta","Categoria:Supermercati alimentari","Categoria:Sagre","Categoria:Festival gastronomici","Categoria:Fiere dell'alimentazione","Categoria:Concorsi enogastronomici","Categoria:Terminologia culinaria","Categoria:Portate","Categoria:Men\xF9","Categoria:Ricette","Categoria:Libri di cucina","Categoria:Programmi televisivi di cucina"];SearchIcon=X;ExternalLinkIcon=H;XIcon=Y;FileTextIcon=N;searchControl=new q("");results=[];selectedPage=null;loading=!1;error=null;isFullContent=!1;ngOnInit(){this.searchControl.valueChanges.pipe(E(500),z(),S(t=>this.performSearch(t)),K(this.destroyRef)).subscribe(t=>{this.results=t,this.loading=!1})}performSearch(t){return t?(this.loading=!0,this.error=null,this.wikiService.search(t).pipe(S(e=>{if(e.length===0)return C([]);let a=e.map(n=>n.pageid);return this.wikiService.getCategoriesForPages(a).pipe(x(n=>{let s=e.filter(_=>(n.get(_.pageid)||[]).some(u=>this.isCulinaryCategory(u)));return s.length>0?s:e}))}),h(e=>(this.error="Errore durante la ricerca",C([]))))):(this.results=[],C([]))}isCulinaryCategory(t){return this.CULINARY_CATEGORIES.some(e=>t.startsWith(e))}selectResult(t){this.loading=!0,this.error=null,this.isFullContent=!1,this.wikiService.getPageData(t.title,!1).pipe(h(e=>(this.error="Impossibile caricare la pagina",C(null)))).subscribe(e=>{this.selectedPage=e,this.loading=!1})}loadFullContent(){this.selectedPage&&(this.loading=!0,this.error=null,this.wikiService.getPageData(this.selectedPage.title,!0).pipe(h(t=>(this.error="Impossibile caricare il contenuto esteso",C(null)))).subscribe(t=>{this.selectedPage=t,console.log("Estratto ricevuto:",t?.extract),this.isFullContent=!0,this.loading=!1}))}clearSearch(){this.searchControl.setValue(""),this.results=[],this.selectedPage=null,this.isFullContent=!1}forceSearch(){this.performSearch(this.searchControl.value).subscribe(t=>{this.results=t})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["app-ingredient-search"]],decls:22,vars:7,consts:[[1,"page-container"],[1,"flex","items-center","gap-sm","p-sm",2,"position","relative"],["type","text","placeholder","Cerca un ingrediente...",1,"w-100",3,"keyup.enter","formControl"],[1,"icon-button"],["type","button",1,"icon-button",3,"click"],[3,"img"],[1,"flex","justify-center","p-sm"],[1,"info-message"],[1,"flex","flex-col","gap-sm","p-sm"],[1,"p-sm"],[1,"flex-col","flex","justify-center","items-center"],[1,"flex","justify-center","p-sm","text-mini","text-muted"],["href","https://creativecommons.org/licenses/by-sa/3.0/","target","_blank","rel","noopener",1,"link"],["href","https://it.wikipedia.org/","target","_blank","rel","noopener",1,"link"],["target","_blank","rel","noopener","href","https://donate.wikimedia.org/w/index.php?title=Special:LandingPage&country=IT&uselang=it&wmf_medium=sidebar&wmf_source=donate&wmf_campaign=it.wikipedia.org",1,"link","text-mini"],[1,"icon-button",3,"click"],[1,"chip"],[1,"material-icons"],[1,"text-md","font-semibold"],[1,"flex","flex-wrap","gap-sm"],[1,"chip",3,"click"],[1,"card","mt-lg"],[1,"flex","justify-between","items-center"],[1,"card-title"],[1,"flex","gap-sm"],["title","Carica pi\xF9 contenuto",1,"icon-button"],["target","_blank","rel","noopener","title","Apri su Wikipedia",1,"icon-button",3,"href"],[1,"card-body",2,"display","flex","gap","var(--gap-sm)","align-items","flex-start"],[1,"rounded",2,"width","150px","height","auto","flex-shrink","0",3,"src","alt"],[1,"wiki-content",2,"flex","1","min-width","0",3,"innerHTML"],["title","Carica pi\xF9 contenuto",1,"icon-button",3,"click"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"input",2),b("keyup.enter",function(){return a.forceSearch()}),c(),v(3,ie,2,1,"button",3),o(4,"button",4),b("click",function(){return a.forceSearch()}),f(5,"lucide-angular",5),c()(),v(6,ae,3,0,"div",6)(7,ne,5,1,"div",7)(8,oe,6,0,"div",8)(9,se,11,5,"div",9),o(10,"div",10)(11,"div",11)(12,"span"),l(13," Contenuto disponibile sotto licenza "),o(14,"a",12),l(15," CC BY-SA 3.0 "),c(),l(16," tramite "),o(17,"a",13),l(18,"Wikipedia"),c(),l(19,". "),c()(),o(20,"a",14),l(21," Fai una donazione a Wikipedia "),c()()()),e&2&&(r(2),m("formControl",a.searchControl),r(),d(a.searchControl.value?3:-1),r(2),m("img",a.SearchIcon),r(),d(a.loading?6:-1),r(),d(a.error?7:-1),r(),d(a.results.length?8:-1),r(),d(a.selectedPage?9:-1))},dependencies:[W,U,L,G,B,J,Z],styles:[".wiki-content[_ngcontent-%COMP%]{font-family:Inter,sans-serif;line-height:1.6;color:var(--text-color);max-width:100%;overflow-wrap:break-word}.wiki-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1em}.wiki-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:700;margin-top:1.5em;margin-bottom:.5em;border-bottom:1px solid var(--smoke-1);padding-bottom:.3em;color:var(--text-color)}.wiki-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:calc(var(--fs-md) * .9);font-weight:600;margin-top:1.2em;margin-bottom:.3em;color:var(--text-color)}.wiki-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:calc(var(--fs-md) * .8);font-weight:600;margin-top:1em;margin-bottom:.2em;color:var(--text-color)}.wiki-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .wiki-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin-left:1.5em;margin-bottom:1em;padding-left:0}.wiki-content[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.3em}.wiki-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary);text-decoration:none;transition:color .2s ease}.wiki-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--primary-hover);text-decoration:underline}.wiki-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%;margin:1em 0;font-size:.95em}.wiki-content[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .wiki-content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid var(--smoke-1);padding:.5em;text-align:left;vertical-align:top}.wiki-content[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:var(--smoke-2);font-weight:700}.wiki-content[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:color-mix(in srgb,var(--background) 95%,var(--text-color))}.wiki-content[_ngcontent-%COMP%]   .infobox[_ngcontent-%COMP%]{float:right;margin-left:1.5em;margin-bottom:1.5em;background:var(--smoke-1);border:1px solid var(--border-color, var(--smoke-2));border-radius:8px;padding:1em;font-size:.9em;max-width:300px;clear:right;box-shadow:0 2px 8px var(--shadow-1)}.wiki-content[_ngcontent-%COMP%]   .infobox[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .wiki-content[_ngcontent-%COMP%]   .infobox[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none;background:transparent;padding:.3em .5em}.wiki-content[_ngcontent-%COMP%]   .infobox[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:700;text-align:right;width:40%}.wiki-content[_ngcontent-%COMP%]   .infobox[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:left}.wiki-content[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%], .wiki-content[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]{margin:1em auto;text-align:center}.wiki-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px var(--shadow-1)}.wiki-content[_ngcontent-%COMP%]   figcaption[_ngcontent-%COMP%], .wiki-content[_ngcontent-%COMP%]   .thumbcaption[_ngcontent-%COMP%]{font-size:.85em;color:var(--text-muted);margin-top:.3em}.wiki-content[_ngcontent-%COMP%]   .citation[_ngcontent-%COMP%]{font-size:.9em;color:var(--text-muted)}.wiki-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%], .wiki-content[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:var(--smoke-1);border-radius:4px;padding:.2em .4em;font-family:monospace;font-size:.9em}.wiki-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{padding:1em;overflow-x:auto}@media (max-width: 768px){.wiki-content[_ngcontent-%COMP%]   .infobox[_ngcontent-%COMP%]{float:none;margin:1em auto;width:100%;max-width:100%}}"]})};export{Q as IngredientSearch};
