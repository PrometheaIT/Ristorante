import{a as He}from"./chunk-UUJ46T7A.js";import"./chunk-HVLDBW5V.js";import{a as qe}from"./chunk-54VP4YDX.js";import{a as We}from"./chunk-GIHPR4RM.js";import{a as ze}from"./chunk-SQVXJHN3.js";import{a as Ve}from"./chunk-2TB2D52A.js";import{a as Ie}from"./chunk-HDYKKRZ7.js";import{a as Fe}from"./chunk-77PT7NEX.js";import{a as Re}from"./chunk-SOEQLVAL.js";import{a as De}from"./chunk-55C4QXNB.js";import{a as ke}from"./chunk-3F4CDTNS.js";import{a as B}from"./chunk-GO2X6ET2.js";import{b as K}from"./chunk-3CH6KZ3X.js";import{b as X,d as ee,e as Ee,g as Me,h as te,i as Oe,q as ie,r as ne,s as re,v as Pe,x as ae}from"./chunk-XWCDBJ2K.js";import{b as Te}from"./chunk-PMU7JIES.js";import{c as Y,d as U,e as we,h as Ce,i as Se,k as ye,l as J}from"./chunk-COP7W333.js";import{Db as z,Eb as q,Fa as be,Fb as F,Hb as Z,I as fe,Ib as o,Ja as s,Jb as T,Kb as v,Lb as V,Mb as L,Oa as me,Ob as b,Pb as w,Qb as C,Tb as W,Wb as E,Yb as O,Za as Q,Zb as G,_b as ue,a as H,b as j,ba as $,cb as h,ga as y,h as g,i as he,kb as m,la as u,lb as n,ma as p,mb as r,nb as D,rb as N,sb as A,tb as x,va as xe,wb as _,yb as c}from"./chunk-2FS7XGGJ.js";var oe=class l extends ke{getTableName(){return"tables"}calculateTableStatus(t){return g(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return[];let i=t.map(k=>k.id),a=new Date().toISOString().split("T")[0],{data:d,error:f}=yield this.supabaseService.getSupabaseClient().from("order_headers").select(`
          *,
          comande (*)
        `).eq("restaurant_id",e).eq("status","active").in("table_id",i);f&&console.error("Errore order headers:",f);let{data:S,error:P}=yield this.supabaseService.getSupabaseClient().from("reservations").select("*").eq("restaurant_id",e).eq("reservation_date",a).in("status",["confirmed","pending"]).in("table_id",i);return P&&console.error("Errore prenotazioni:",P),t.map(k=>{let I=(d||[]).filter(R=>R.table_id===k.id),_e=(S||[]).filter(R=>R.table_id===k.id),de="free",ve=null,ce=[],ge=null;return I.length>0?(de="occupied",ge=I[0].id,I.forEach(R=>{if(R.comande&&R.comande.length>0){let Ae=R.comande.map(M=>j(H({},M),{restaurant_id:M.restaurant_id||e,order_header_id:M.order_header_id||R.id,table_id:M.table_id||k.id,subtotal:M.subtotal||0,tax_amount:M.tax_amount||0,discount_amount:M.discount_amount||0,total_amount:M.total_amount||0,created_at:M.created_at,updated_at:M.updated_at,customer_name:M.customer_name||null,customer_phone:M.customer_phone||null,customer_notes:M.customer_notes||null,order_type:M.order_type||"dine_in",status:M.status||"ordered"}));ce=ce.concat(Ae)}})):_e.length>0&&(de="reserved",ve=_e[0]),{table:k,status:de,currentReservation:ve,currentOrders:ce,tavolataId:ge}})}catch(e){return console.error("\u274C Errore calcolo stato tavoli:",e),[]}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=xe(l)))(i||l)}})();static \u0275prov=$({token:l,factory:l.\u0275fac,providedIn:"root"})};var le=class l{supabase=y(Te).getSupabaseClient();authService=y(K);loadingService=y(B);occupyTable(t,e){return g(this,null,function*(){try{this.loadingService.start();let i=yield this.authService.getCurrentRestaurantId();if(!i)return null;let a=yield this.generateOrderNumber(i),{data:d,error:f}=yield this.supabase.from("order_headers").insert({restaurant_id:i,table_id:t,order_number:a,status:"active",customer_name:e||"Cliente",total_amount:0}).select().single();if(f)throw f;let S=yield this.createComanda(d.id);return yield this.loadTavolata(d.id)}catch(i){return console.error("\u274C Errore occupazione tavolo:",i),null}finally{this.loadingService.stop()}})}createComanda(t){return g(this,null,function*(){try{this.loadingService.start();let e=yield this.authService.getCurrentRestaurantId();if(!e)return null;let{data:i,error:a}=yield this.supabase.from("order_headers").select("table_id, order_number, customer_name, status").eq("id",t).single();if(a)throw a;let d=yield this.getNextComandaNumber(t),f=`${i.order_number}-${d}`,{data:S,error:P}=yield this.supabase.from("comande").insert({restaurant_id:e,order_header_id:t,comanda_number:d,order_number:f,status:"ordered",table_id:i.table_id,order_type:"dine_in",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,customer_name:i.customer_name||"Cliente"}).select().single();if(P)throw P;return S}catch(e){return console.error("\u274C Errore creazione comanda:",e),null}finally{this.loadingService.stop()}})}addItemToComanda(t,e,i=1,a=""){return g(this,null,function*(){try{this.loadingService.start();let d=yield this.authService.getCurrentRestaurantId();if(!d)return null;let{data:f,error:S}=yield this.supabase.from("dishes").select("base_price, name").eq("id",e).single();if(S)throw S;let P=f.base_price*i,{data:k,error:I}=yield this.supabase.from("order_items").insert({order_id:t,dish_id:e,quantity:i,unit_price:f.base_price,total_price:P,item_notes:a,status:"ordered",restaurant_id:d}).select().single();if(I)throw I;return yield this.updateComandaTotal(t),j(H({},k),{dish_name:f.name})}catch(d){return console.error("\u274C Errore aggiunta piatto:",d),null}finally{this.loadingService.stop()}})}loadTavolata(t){return g(this,null,function*(){try{this.loadingService.start();let{data:e,error:i}=yield this.supabase.from("order_headers").select(`
          *,
          comande (
            *,
            order_items (
              *,
              dish:dish_id (
                id,
                name,
                base_price,
                category_id
              )
            )
          )
        `).eq("id",t).single();if(i)throw i;return e}catch(e){return console.error("\u274C Errore caricamento tavolata:",e),null}finally{this.loadingService.stop()}})}getActiveTavolataByTable(t){return g(this,null,function*(){try{let e=yield this.authService.getCurrentRestaurantId();if(!e)return null;let{data:i,error:a}=yield this.supabase.from("order_headers").select(`
          *,
          comande (
            *,
            order_items (
              *,
              dish:dish_id (
                id,
                name,
                base_price
              )
            )
          )
        `).eq("restaurant_id",e).eq("table_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(1).single();if(a){if(a.code==="PGRST116")return null;throw a}return i}catch(e){return console.error("\u274C Errore caricamento tavolata attiva:",e),null}})}updateComandaStatus(t,e){return g(this,null,function*(){try{let{error:i}=yield this.supabase.from("comande").update({status:e,updated_at:new Date().toISOString()}).eq("id",t);return!i}catch(i){return console.error("\u274C Errore aggiornamento stato comanda:",i),!1}})}updateItemQuantity(t,e){return g(this,null,function*(){try{let{data:i,error:a}=yield this.supabase.from("order_items").select("unit_price, order_id").eq("id",t).single();if(a)throw a;let d=i.unit_price*e,{error:f}=yield this.supabase.from("order_items").update({quantity:e,total_price:d,updated_at:new Date().toISOString()}).eq("id",t);if(f)throw f;return i.order_id&&(yield this.updateComandaTotal(i.order_id)),!0}catch(i){return console.error("\u274C Errore aggiornamento quantit\xE0:",i),!1}})}removeItem(t){return g(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.from("order_items").select("order_id").eq("id",t).single();if(i)throw i;let{error:a}=yield this.supabase.from("order_items").delete().eq("id",t);if(a)throw a;return e.order_id&&(yield this.updateComandaTotal(e.order_id)),!0}catch(e){return console.error("\u274C Errore rimozione piatto:",e),!1}})}closeTavolata(t){return g(this,null,function*(){try{let{error:e}=yield this.supabase.from("order_headers").update({status:"completed",updated_at:new Date().toISOString()}).eq("id",t);return!e}catch(e){return console.error("\u274C Errore chiusura tavolata:",e),!1}})}generateOrderNumber(t){return g(this,null,function*(){let e=new Date,i=e.getFullYear().toString().slice(-2),a=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0"),{count:f}=yield this.supabase.from("order_headers").select("*",{count:"exact",head:!0}).eq("restaurant_id",t).gte("created_at",`${e.getFullYear()}-${a}-${d}T00:00:00`).lte("created_at",`${e.getFullYear()}-${a}-${d}T23:59:59`),S=(f||0)+1;return`TAV-${i}${a}${d}-${S.toString().padStart(3,"0")}`})}getNextComandaNumber(t){return g(this,null,function*(){let{data:e,error:i}=yield this.supabase.from("comande").select("comanda_number").eq("order_header_id",t).order("comanda_number",{ascending:!1}).limit(1);return i?(console.error("Errore calcolo prossima comanda:",i),1):e&&e.length>0?e[0].comanda_number+1:1})}updateComandaTotal(t){return g(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.from("order_items").select("total_price").eq("order_id",t);if(i)throw i;let a=(e||[]).reduce((d,f)=>d+(f.total_price||0),0);yield this.supabase.from("comande").update({total_amount:a,subtotal:a,updated_at:new Date().toISOString()}).eq("id",t)}catch(e){console.error("Errore aggiornamento totale comanda:",e)}})}static \u0275fac=function(e){return new(e||l)};static \u0275prov=$({token:l,factory:l.\u0275fac,providedIn:"root"})};var Qe=()=>({id:"all",name:"\u{1F37D}\uFE0F Tutti i piatti"}),Ze=()=>[];function Ge(l,t){if(l&1&&(n(0,"span",47),o(1),r()),l&2){let e=c(2);s(),v(" Comanda ",e.currentComanda.comanda_number," ")}}function Ye(l,t){if(l&1&&(n(0,"option",50),o(1),r()),l&2){let e=t.$implicit;m("ngValue",e),s(),V(" Comanda ",e.comanda_number," (",(e.order_items==null?null:e.order_items.length)||0," piatti) ")}}function Ue(l,t){if(l&1){let e=x();n(0,"div")(1,"select",48),C("ngModelChange",function(a){u(e);let d=c(2);return w(d.currentComanda,a)||(d.currentComanda=a),p(a)}),_("ngModelChange",function(){u(e);let a=c(2);return p(a.switchComanda((a.currentComanda==null?null:a.currentComanda.id)||""))}),h(2,Ye,2,3,"option",49),r()()}if(l&2){let e=c(2);s(),b("ngModel",e.currentComanda),s(),m("ngForOf",e.getComandeForDropdown())}}function Je(l,t){l&1&&(n(0,"span",58),o(1," Menu Dedicato "),r())}function Ke(l,t){l&1&&(n(0,"span"),o(1," Seleziona Menu "),r())}function Xe(l,t){if(l&1&&(n(0,"div",59)(1,"div",14)(2,"span",60),o(3,"event_available"),r(),n(4,"span",61),o(5),r(),n(6,"span",62),o(7,"Dedicato"),r()()()),l&2){let e=c(3);s(5),T(e.dedicatedMenu.name)}}function et(l,t){l&1&&(n(0,"span",67)(1,"span",68),o(2,"star"),r(),o(3," Default "),r())}function tt(l,t){if(l&1&&(n(0,"div",64)(1,"div",65)(2,"div",14)(3,"span",8),o(4,"restaurant_menu"),r(),n(5,"span",61),o(6),r()(),h(7,et,4,0,"span",66),r()()),l&2){let e=c(4);s(6),T(e.globalMenus[0].name),s(),m("ngIf",e.globalMenus[0].is_default)}}function it(l,t){if(l&1&&(n(0,"option",50),o(1),r()),l&2){let e=t.$implicit;m("ngValue",e),s(),V(" ",e.is_default?"\u2B50 ":"","",e.name," ")}}function nt(l,t){if(l&1){let e=x();n(0,"div")(1,"select",48),C("ngModelChange",function(a){u(e);let d=c(4);return w(d.selectedMenu,a)||(d.selectedMenu=a),p(a)}),_("ngModelChange",function(a){u(e);let d=c(4);return p(d.onMenuSelectChange(a))}),n(2,"option",50),o(3," \u{1F37D}\uFE0F Tutti i piatti "),r(),h(4,it,2,3,"option",49),r()()}if(l&2){let e=c(4);s(),b("ngModel",e.selectedMenu),s(),m("ngValue",W(3,Qe)),s(2),m("ngForOf",e.globalMenus)}}function rt(l,t){if(l&1&&(n(0,"div"),h(1,tt,8,2,"div",63)(2,nt,5,4,"div",15),r()),l&2){let e=c(3);s(),m("ngIf",e.globalMenus.length===1),s(),m("ngIf",e.globalMenus.length>1)}}function at(l,t){l&1&&(n(0,"div",69)(1,"span",70),o(2,"restaurant_menu"),r(),n(3,"p",71),o(4,"Nessun menu disponibile"),r()())}function ot(l,t){l&1&&(n(0,"span",67)(1,"span",68),o(2,"star"),r(),o(3," Predefinito "),r())}function lt(l,t){l&1&&(n(0,"span",75)(1,"span",68),o(2,"event_available"),r(),o(3," Dedicato "),r())}function st(l,t){if(l&1&&(n(0,"div",72)(1,"span",73),o(2),r(),h(3,ot,4,0,"span",66)(4,lt,4,0,"span",74),r()),l&2){let e=c(3);s(2),v("",e.dishes.length," piatti disponibili"),s(),m("ngIf",e.selectedMenu.is_default),s(),m("ngIf",e.selectedMenu.type==="dedicated")}}function dt(l,t){if(l&1&&(n(0,"div",51)(1,"div",52)(2,"label",53)(3,"span",8),o(4,"restaurant_menu"),r(),h(5,Je,2,0,"span",54)(6,Ke,2,0,"span",15),r(),h(7,Xe,8,1,"div",55)(8,rt,3,2,"div",15)(9,at,5,0,"div",56)(10,st,5,3,"div",57),r()()),l&2){let e=c(2);s(5),m("ngIf",e.dedicatedMenu),s(),m("ngIf",!e.dedicatedMenu),s(),m("ngIf",e.dedicatedMenu),s(),m("ngIf",!e.dedicatedMenu&&e.globalMenus.length>0),s(),m("ngIf",!e.hasMenusToShow()),s(),m("ngIf",e.selectedMenu)}}function ct(l,t){if(l&1&&(n(0,"option",76),o(1),E(2,"slice"),r()),l&2){let e=t.$implicit;m("value",e.id),s(),V(" ",G(2,3,e.name,0,10),"",e.name.length>10?"...":""," ")}}function mt(l,t){if(l&1&&(n(0,"option",50),o(1),r()),l&2){let e=t.$implicit;m("ngValue",e),s(),V(" Comanda ",e.comanda_number," (",(e.order_items==null?null:e.order_items.length)||0," piatti) ")}}function ut(l,t){if(l&1){let e=x();n(0,"div",77)(1,"select",24),C("ngModelChange",function(a){u(e);let d=c(2);return w(d.currentComanda,a)||(d.currentComanda=a),p(a)}),_("ngModelChange",function(){u(e);let a=c(2);return p(a.switchComanda((a.currentComanda==null?null:a.currentComanda.id)||""))}),h(2,mt,2,3,"option",49),r()()}if(l&2){let e=c(2);s(),b("ngModel",e.currentComanda),s(),m("ngForOf",e.getComandeForDropdown())}}function pt(l,t){if(l&1){let e=x();n(0,"div",83)(1,"div",84)(2,"div",9)(3,"strong"),o(4),r(),n(5,"div",12)(6,"span",13),o(7),E(8,"number"),r(),n(9,"span",13),o(10,"\u2022"),r(),n(11,"span",13),o(12),E(13,"number"),r()()(),n(14,"div",14)(15,"button",85),_("click",function(a){let d=u(e).$implicit;return c(4).updateQuantity(d,-1),p(a.stopPropagation())}),n(16,"span",8),o(17,"remove"),r()(),n(18,"span",86),o(19),r(),n(20,"button",87),_("click",function(a){let d=u(e).$implicit;return c(4).updateQuantity(d,1),p(a.stopPropagation())}),n(21,"span",8),o(22,"add"),r()(),n(23,"button",88),_("click",function(a){let d=u(e).$implicit;return c(4).removeItem(d),p(a.stopPropagation())}),n(24,"span",8),o(25,"delete"),r()()()()()}if(l&2){let e=t.$implicit,i=c(4);s(4),T(e.dish_name||"Piatto"),s(3),v("\u20AC",O(8,5,e.unit_price,"1.2-2")," cad."),s(5),v("Tot: \u20AC",O(13,8,e.unit_price*e.quantity,"1.2-2")),s(7),T(e.quantity),s(),m("disabled",!i.orderingStatus.allowed)}}function _t(l,t){if(l&1&&(n(0,"div",31)(1,"span",13),o(2),r(),n(3,"strong",90),o(4),E(5,"number"),r()()),l&2){let e=c(5);s(2),v(" Totale generale (",e.orderHeader.comande.length," comande): "),s(2),v(" \u20AC",O(5,2,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function vt(l,t){if(l&1&&(N(0),h(1,_t,6,5,"div",89),A()),l&2){let e=c(4);s(),m("ngIf",e.orderHeader.comande.length>1)}}function gt(l,t){if(l&1&&(n(0,"div"),h(1,pt,26,11,"div",78),n(2,"div",79)(3,"div",80)(4,"strong",81),o(5,"Totale Comanda:"),r(),n(6,"strong",82),o(7),E(8,"number"),r()(),h(9,vt,2,1,"ng-container",15),r()()),l&2){let e=c(3);s(),m("ngForOf",e.currentComanda.order_items||W(6,Ze)),s(6),v(" \u20AC",O(8,3,e.currentComanda.total_amount,"1.2-2")," "),s(2),m("ngIf",e.orderHeader&&e.orderHeader.comande)}}function ht(l,t){if(l&1&&(N(0),h(1,gt,10,7,"div",42),A()),l&2){c();let e=z(49),i=c();s(),m("ngIf",i.currentComanda.order_items&&i.currentComanda.order_items.length>0)("ngIfElse",e)}}function ft(l,t){l&1&&(n(0,"div",91)(1,"span",92),o(2,"restaurant_menu"),r(),n(3,"p",93),o(4,"Nessun piatto in questa comanda"),r(),n(5,"p",71),o(6,"Clicca sui piatti per aggiungerli"),r()())}function xt(l,t){if(l&1){let e=x();n(0,"div",38),_("click",function(){let a=u(e).$implicit,d=c(2);return p(d.selectedCategory=a.id)}),n(1,"span",8),o(2,"category"),r(),n(3,"span",39),o(4),E(5,"slice"),r(),n(6,"span",13),o(7),r()()}if(l&2){let e=t.$implicit,i=c(2);F("active",i.selectedCategory===e.id),s(4),V("",G(5,5,e.name,0,8),"",e.name.length>8?"...":""),s(3),T(i.getDishesCountByCategory(e.id))}}function bt(l,t){if(l&1&&(n(0,"small",13),o(1),E(2,"slice"),r()),l&2){let e=c().$implicit;s(),V(" ",G(2,2,e.description,0,40),"",e.description.length>40?"...":""," ")}}function wt(l,t){if(l&1){let e=x();n(0,"div",101)(1,"div",41)(2,"div",102)(3,"strong",103),o(4),r(),n(5,"span",104),o(6),E(7,"number"),r(),h(8,bt,3,6,"small",105),r(),n(9,"div",106)(10,"button",107),_("click",function(){let a=u(e).$implicit,d=c(4);return p(d.addDishToOrder(a))}),n(11,"span",8),o(12,"add"),r()()()()()}if(l&2){let e=t.$implicit,i=c(4);s(4),T(e.name),s(2),v("\u20AC",O(7,4,e.base_price,"1.2-2")),s(2),m("ngIf",e.description),s(2),m("disabled",!i.orderingStatus.allowed)}}function Ct(l,t){if(l&1&&(N(0),n(1,"div",95)(2,"div",96)(3,"span",97),o(4,"category"),r(),o(5),r(),n(6,"div",98),o(7),r()(),n(8,"div",99),h(9,wt,13,7,"div",100),r(),A()),l&2){let e=t.$implicit,i=c(3);s(5),v(" ",e.category.name," "),s(2),T(e.dishes.length),s(2),m("ngForOf",e.dishes)("ngForTrackBy",i.trackByDishId)}}function St(l,t){if(l&1&&(N(0),h(1,Ct,10,4,"ng-container",94),A()),l&2){let e=c(2);s(),m("ngForOf",e.getDishesGroupedByCategory())}}function yt(l,t){if(l&1){let e=x();n(0,"div",108)(1,"span",8),o(2,"search_off"),r(),n(3,"p",93),o(4,"Nessun piatto trovato"),r(),n(5,"button",109),_("click",function(){u(e);let a=c(2);return p(a.resetDishFilters())}),o(6," Reset filtri "),r()()}}function Tt(l,t){if(l&1){let e=x();n(0,"div",3),_("click",function(){u(e);let a=c();return p(a.close())}),n(1,"div",4),_("click",function(a){return u(e),p(a.stopPropagation())}),n(2,"div",5)(3,"div",6)(4,"button",7),_("click",function(){u(e);let a=c();return p(a.close())}),n(5,"span",8),o(6,"arrow_back"),r()(),n(7,"div",9)(8,"h1",10),o(9),h(10,Ge,2,1,"span",11),r(),n(11,"div",12)(12,"span",13),o(13),E(14,"number"),r()()()(),n(15,"div",14),h(16,Ue,3,2,"div",15),n(17,"button",16),_("click",function(){u(e);let a=c();return p(a.close())}),n(18,"span",8),o(19,"close"),r()()()(),n(20,"div",17),h(21,dt,11,6,"div",18),n(22,"div",19)(23,"div",20)(24,"div",21)(25,"input",22),C("ngModelChange",function(a){u(e);let d=c();return w(d.dishSearchTerm,a)||(d.dishSearchTerm=a),p(a)}),r()(),n(26,"div",23)(27,"select",24),C("ngModelChange",function(a){u(e);let d=c();return w(d.selectedCategory,a)||(d.selectedCategory=a),p(a)}),n(28,"option",25),o(29,"Tutte"),r(),h(30,ct,3,7,"option",26),r()(),n(31,"div",27)(32,"button",7),_("click",function(){u(e);let a=c();return p(a.resetDishFilters())}),n(33,"span",8),o(34,"refresh"),r()()()()(),n(35,"div",28)(36,"div",29)(37,"div",30)(38,"div",31)(39,"h3",32)(40,"span",33),o(41,"receipt"),r(),o(42),r(),n(43,"span",34),o(44),r()(),h(45,ut,3,2,"div",35),r(),n(46,"div",36),h(47,ht,2,2,"ng-container",15)(48,ft,7,0,"ng-template",null,0,ue),r()(),n(50,"div",29)(51,"div",37)(52,"div",38),_("click",function(){u(e);let a=c();return p(a.selectedCategory="all")}),n(53,"span",8),o(54,"restaurant_menu"),r(),n(55,"span",39),o(56,"Tutti"),r(),n(57,"span",13),o(58),r()(),h(59,xt,8,9,"div",40),r(),n(60,"div",41),h(61,St,2,1,"ng-container",42)(62,yt,7,0,"ng-template",null,1,ue),r()()()(),n(64,"div",43)(65,"button",44),_("click",function(){u(e);let a=c();return p(a.close())}),n(66,"span",8),o(67,"close"),r(),o(68," Chiudi "),r(),n(69,"button",45),_("click",function(){u(e);let a=c();return p(a.createNewComanda())}),n(70,"span",8),o(71,"receipt"),r(),o(72," Nuova Comanda "),r(),n(73,"button",46),_("click",function(){u(e);let a=c();return p(a.saveOrder())}),n(74,"span",8),o(75,"save"),r(),o(76," Salva "),r()()()()}if(l&2){let e=z(63),i=c();s(),F("fullscreen-mobile",i.isMobile),s(8),v(" Tavolo ",i.table.table_number," "),s(),m("ngIf",i.currentComanda),s(3),L(" ",i.getComandaItems().length," piatto",i.getComandaItems().length!==1?"i":""," \u2022 \u20AC",O(14,28,i.calcolaTotaleTavolata(),"1.2-2")," "),s(3),m("ngIf",i.shouldShowComandaDropdown()),s(5),m("ngIf",i.hasMenusToShow()),s(4),b("ngModel",i.dishSearchTerm),s(2),b("ngModel",i.selectedCategory),s(3),m("ngForOf",i.getCategories()),s(5),F("mobile-vertical",i.isMobile),s(7),v(" Comanda ",(i.currentComanda==null?null:i.currentComanda.comanda_number)||"1"," "),s(2),V(" ",i.getComandaItems().length," piatto",i.getComandaItems().length!==1?"i":""," "),s(),m("ngIf",i.shouldShowComandaDropdown()),s(2),m("ngIf",i.currentComanda),s(5),F("active",i.selectedCategory==="all"),s(6),T(i.getDishesCountByCategory("all")),s(),m("ngForOf",i.categoryService.data.slice(0,4)),s(2),m("ngIf",i.getDishesGroupedByCategory().length>0)("ngIfElse",e),s(8),m("disabled",!i.orderHeader),s(4),m("disabled",!i.orderingStatus.allowed)("title",i.orderingStatus.allowed?"Salva ordine":i.orderingStatus.reason)}}function Et(l,t){if(l&1){let e=x();n(0,"div",108)(1,"span",8),o(2,"receipt"),r(),n(3,"h3"),o(4,"Nessun ordine attivo"),r(),n(5,"p",93),o(6,"Non ci sono ordini per questo tavolo"),r(),n(7,"button",121),_("click",function(){u(e);let a=c(2);return p(a.switchToEditMode())}),n(8,"span",8),o(9,"add"),r(),o(10," Crea Primo Ordine "),r()()}}function Mt(l,t){if(l&1&&(n(0,"div",77)(1,"small",93),o(2),r()()),l&2){let e=c().$implicit;s(2),v("Note: ",e.item_notes)}}function Ot(l,t){if(l&1&&(n(0,"div",143)(1,"div",9)(2,"div",144)(3,"strong"),o(4),r(),h(5,Mt,3,1,"div",35),r(),n(6,"div",145)(7,"span"),o(8),E(9,"number"),r(),n(10,"span"),o(11,"\u2022"),r(),n(12,"span"),o(13),r()(),n(14,"span",146),o(15),r()(),n(16,"div",136)(17,"span",61),o(18),E(19,"number"),r(),n(20,"small",134),o(21,"Totale"),r()()()),l&2){let e=t.$implicit,i=c(6);s(4),T(i.getDishName(e)),s(),m("ngIf",e.item_notes),s(3),v("\u20AC",O(9,8,e.unit_price,"1.2-2")," cad."),s(5),v("Quantit\xE0: ",e.quantity),s(),q("background-color",i.getOrderStatusColor(e.status)),s(),v(" ",i.getOrderStatusText(e.status)," "),s(3),v("\u20AC",O(19,11,e.total_price,"1.2-2"))}}function Pt(l,t){if(l&1&&(n(0,"div",141),h(1,Ot,22,14,"div",142),r()),l&2){let e=c(2).$implicit;s(),m("ngForOf",e.order_items)}}function kt(l,t){l&1&&(n(0,"div",147)(1,"span",8),o(2,"restaurant_menu"),r(),n(3,"p",93),o(4,"Nessun piatto in questa comanda"),r()())}function It(l,t){if(l&1&&(n(0,"div",79),h(1,Pt,2,1,"div",138)(2,kt,5,0,"div",139),n(3,"div",140)(4,"strong",81),o(5),r(),n(6,"strong",82),o(7),E(8,"number"),r()()()),l&2){let e=c().$implicit,i=c(3);s(),m("ngIf",e.order_items&&e.order_items.length>0),s(),m("ngIf",!e.order_items||e.order_items.length===0),s(3),v("Totale Comanda ",e.comanda_number),s(2),v(" \u20AC",O(8,4,i.getComandaTotal(e),"1.2-2")," ")}}function Vt(l,t){if(l&1){let e=x();n(0,"div",128)(1,"div",129),_("click",function(){let a=u(e).$implicit,d=c(3);return p(d.toggleComandaExpansion(a.id))}),n(2,"div",130)(3,"div",131)(4,"div",132)(5,"h3",61),o(6),r(),n(7,"span",133),o(8),r()(),n(9,"div",134),o(10),E(11,"date"),r()()(),n(12,"div",135)(13,"div",136)(14,"span",98),o(15),E(16,"number"),r(),n(17,"span",13),o(18),r()()()(),h(19,It,9,7,"div",137),r()}if(l&2){let e=t.$implicit,i=c(3);s(6),v("Comanda ",e.comanda_number),s(),q("background-color",i.getOrderStatusColor(e.status)),s(),v(" ",i.getOrderStatusText(e.status)," "),s(2),v(" ",O(11,9,e.created_at,"dd/MM/yyyy HH:mm")," "),s(5),v(" \u20AC",O(16,12,i.getComandaTotal(e),"1.2-2")," "),s(3),V(" ",(e.order_items==null?null:e.order_items.length)||0," piatto",(e.order_items==null?null:e.order_items.length)!==1?"i":""," "),s(),m("ngIf",i.isComandaExpanded(e.id))}}function Ft(l,t){if(l&1&&(n(0,"div",122),h(1,Vt,20,15,"div",123),n(2,"div",124)(3,"div",31)(4,"div")(5,"strong",125),o(6,"TOTALE TAVOLO"),r(),n(7,"p",126),o(8),r()(),n(9,"strong",127),o(10),E(11,"number"),r()()()()),l&2){let e=c(2);s(),m("ngForOf",e.orderHeader.comande),s(7),v(" ",e.getTotalComandeCount()," comande "),s(2),v(" \u20AC",O(11,3,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function Rt(l,t){if(l&1){let e=x();n(0,"div",3),_("click",function(){u(e);let a=c();return p(a.close())}),n(1,"div",110),_("click",function(a){return u(e),p(a.stopPropagation())}),n(2,"div",111)(3,"div",14)(4,"div",112)(5,"span",8),o(6,"receipt_long"),r()(),n(7,"div")(8,"h1",113),o(9),r(),n(10,"div",12)(11,"span",34),o(12),r(),n(13,"span",73),o(14),E(15,"number"),r()()()(),n(16,"button",7),_("click",function(){u(e);let a=c();return p(a.close())}),n(17,"span",8),o(18,"close"),r()()(),n(19,"div",114),h(20,Et,11,0,"div",115)(21,Ft,12,6,"div",116),n(22,"div",117)(23,"button",118),_("click",function(){u(e);let a=c();return p(a.generateBill())}),n(24,"span",8),o(25,"receipt"),r(),o(26),r(),n(27,"button",119),_("click",function(){u(e);let a=c();return p(a.switchToEditMode())}),n(28,"span",8),o(29,"add"),r(),o(30," Aggiungi Piatti "),r(),n(31,"button",120),_("click",function(){u(e);let a=c();return p(a.close())}),n(32,"span",8),o(33,"close"),r(),o(34," Chiudi "),r()()()()()}if(l&2){let e=c();s(),F("fullscreen-mobile",e.isMobile),s(8),v("Ordini Tavolo ",e.table.table_number||"N/A"),s(3),V(" ",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)||0," Ordine",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)!==1?"i":""," "),s(2),v(" Totale: \u20AC",O(15,10,e.calcolaTotaleTavolata(),"1.2-2")," "),s(6),m("ngIf",!e.orderHeader||!e.orderHeader.comande||e.orderHeader.comande.length===0),s(),m("ngIf",e.orderHeader&&e.orderHeader.comande&&e.orderHeader.comande.length>0),s(2),m("disabled",!e.isReadyForBill()),s(3),v(" ",e.isReadyForBill()?"STAMPA SCONTRINO":"Non pronto per conto"," ")}}function Dt(l,t){if(l&1){let e=x();n(0,"div",3),_("click",function(){u(e);let a=c();return p(a.showBillPreviewModal=!1)}),n(1,"div",110),_("click",function(a){return u(e),p(a.stopPropagation())}),n(2,"div",111)(3,"h1",113),o(4,"Anteprima Scontrino"),r(),n(5,"button",7),_("click",function(){u(e);let a=c();return p(a.showBillPreviewModal=!1)}),n(6,"span",8),o(7,"close"),r()()(),D(8,"div",148),n(9,"div",149)(10,"button",120),_("click",function(){u(e);let a=c();return p(a.showBillPreviewModal=!1)}),o(11," Chiudi "),r(),n(12,"button",119),_("click",function(){u(e);let a=c();return p(a.printBill())}),n(13,"span",8),o(14,"print"),r(),o(15," Stampa "),r()()()()}if(l&2){let e=c();s(8),m("innerHTML",e.billPreviewHtml,be)}}var se=class l{orderManager=y(le);dishService=y(Ie);loadingService=y(B);categoryService=y(Ve);menuService=y(ze);table;mode="edit";existingOrderHeader;orderingStatus={allowed:!0,reason:""};saved=new me;closeRequested=new me;orderHeader=null;currentComanda=null;dishes=[];searchTerm="";selectedCategory="all";dishSearchTerm="";isMobile=!1;isNewOrder=!1;activeMenus=[];selectedMenu={id:"all",name:"Tutti i piatti"};menuDishes=[];comandeExpanded={};showBillPreviewModal=!1;billPreviewHtml="";ngOnInit(){return g(this,null,function*(){console.log("\u{1F504} OrderEditor init - mode:",this.mode),this.dishes=this.dishService.getActiveDishes(),yield this.categoryService.loadData(),yield this.loadActiveMenus(),this.mode==="view"&&this.existingOrderHeader?yield this.loadOrderForView():this.mode==="edit"&&(yield this.setupForEdit())})}loadActiveMenus(){return g(this,null,function*(){try{if(yield this.menuService.loadMenus(),this.activeMenus=this.menuService.getCurrentMenus().filter(t=>t.is_active),this.activeMenus.length>0){let t=this.activeMenus.find(e=>e.is_default);this.selectedMenu=t||this.activeMenus[0],yield this.loadDishesForSelectedMenu()}}catch(t){console.error("\u274C Errore caricamento menu:",t)}})}loadDishesForSelectedMenu(){return g(this,null,function*(){if(this.selectedMenu.id==="all")this.dishes=this.dishService.getActiveDishes(),this.menuDishes=[];else try{this.menuDishes=yield this.menuService.getDishesWithDetailsByMenu(this.selectedMenu.id),this.dishes=this.menuDishes.filter(t=>t.dish&&!t.dish.deleted_at).map(t=>t.dish)}catch(t){console.error("\u274C Errore caricamento piatti menu:",t),this.dishes=this.dishService.getActiveDishes()}})}loadOrderForView(){return g(this,null,function*(){if(this.existingOrderHeader)try{this.loadingService.start();let t=yield this.orderManager.loadTavolata(this.existingOrderHeader.id);if(t&&(this.orderHeader=t,t.comande&&t.comande.length>0)){let e=t.comande.find(i=>i.status!=="cancelled");this.currentComanda=e||t.comande[0]}}catch(t){console.error("\u274C Errore caricamento ordine:",t)}finally{this.loadingService.stop()}})}setupForEdit(){return g(this,null,function*(){try{if(this.loadingService.start(),this.existingOrderHeader)yield this.loadOrderForEdit(this.existingOrderHeader.id),this.isNewOrder=!1;else{let t=yield this.orderManager.getActiveTavolataByTable(this.table.id);if(t){if(this.orderHeader=t,this.isNewOrder=!1,t.comande&&t.comande.length>0){let e=t.comande.slice().reverse().find(i=>i.status!=="cancelled");this.currentComanda=e||t.comande[0]}}else this.orderHeader=null,this.currentComanda=null,this.isNewOrder=!0}this.dishes=this.dishService.getActiveDishes(),yield this.loadActiveMenus()}catch(t){console.error("\u274C Errore setup edit:",t)}finally{this.loadingService.stop()}})}loadOrderForEdit(t){return g(this,null,function*(){let e=yield this.orderManager.loadTavolata(t);if(e&&(this.orderHeader=e,e.comande&&e.comande.length>0)){let i=e.comande.slice().reverse().find(a=>a.status!=="cancelled");this.currentComanda=i||e.comande[0]}})}createNewOrder(){return g(this,null,function*(){console.log("\u{1F195} Creazione tavolata per tavolo:",this.table.table_number);try{let t=yield this.orderManager.occupyTable(this.table.id,"Cliente");return t?(this.orderHeader=t,t.comande&&t.comande.length>0&&(this.currentComanda=t.comande[0]),console.log("\u2705 Tavolata creata:",t.id),!0):(console.error("\u274C Impossibile creare tavolata"),!1)}catch(t){return console.error("\u274C Errore creazione tavolata:",t),!1}})}createNewComanda(){return g(this,null,function*(){if(!this.orderHeader&&!(yield this.createNewOrder()))return;let t=yield this.orderManager.createComanda(this.orderHeader.id);t&&(this.currentComanda=t,this.orderHeader.comande||(this.orderHeader.comande=[]),this.orderHeader.comande.push(t))})}addDish(t){return g(this,null,function*(){try{if(console.log("\u2795 Aggiungi piatto:",t.name),!this.orderHeader&&(console.log("\u{1F195} Creo nuova tavolata..."),yield this.createNewOrder(),!this.orderHeader)){console.error("\u274C Impossibile creare tavolata");return}if(!this.currentComanda&&(console.log("\u{1F195} Creo nuova comanda..."),yield this.createNewComanda(),!this.currentComanda)){console.error("\u274C Impossibile creare comanda");return}this.currentComanda.order_items||(this.currentComanda.order_items=[]);let e=this.currentComanda.order_items.find(i=>i.dish_id===t.id);if(e)console.log("\u{1F4C8} Incrementa quantit\xE0 per piatto esistente"),yield this.updateQuantity(e,1);else{console.log("\u{1F195} Aggiungi nuovo piatto");let i=yield this.orderManager.addItemToComanda(this.currentComanda.id,t.id,1,"");i&&(i.dish_name=t.name,this.currentComanda.order_items.push(i),this.updateTotals(),console.log("\u2705 Piatto aggiunto con successo"))}}catch(e){console.error("\u{1F4A5} Errore in addDish:",e)}})}addDishToOrder(t){this.addDish(t)}updateQuantity(t,e){return g(this,null,function*(){if(!this.currentComanda?.order_items)return;let i=t.quantity+e;if(i<1){yield this.removeItem(t);return}try{(yield this.orderManager.updateItemQuantity(t.id,i))&&(t.quantity=i,t.total_price=t.unit_price*i,this.updateTotals(),console.log("\u2705 Quantit\xE0 aggiornata:",t.quantity))}catch(a){console.error("\u274C Errore aggiornamento quantit\xE0:",a)}})}removeItem(t){return g(this,null,function*(){if(this.currentComanda?.order_items)try{(yield this.orderManager.removeItem(t.id))&&(this.currentComanda.order_items=this.currentComanda.order_items.filter(i=>i.id!==t.id),this.updateTotals())}catch(e){console.error("\u274C Errore rimozione piatto:",e)}})}updateTotals(){!this.currentComanda||!this.currentComanda.order_items||(this.currentComanda.total_amount=this.currentComanda.order_items.reduce((t,e)=>t+(e.total_price||0),0),this.orderHeader&&this.orderHeader.comande&&(this.orderHeader.total_amount=this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)))}getFilteredDishes(){let t=this.dishes;if(this.selectedCategory!=="all"&&(t=t.filter(e=>e.category_id===this.selectedCategory)),this.dishSearchTerm){let e=this.dishSearchTerm.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(e)||i.description?.toLowerCase().includes(e))}return t}getComandaItems(){return this.currentComanda?.order_items||[]}getComandaTotal(t){let e=t||this.currentComanda;return!e||!e.order_items?0:e.order_items.reduce((i,a)=>i+(a.total_price||0),0)}getDishesCountByCategory(t){let e=this.getFilteredDishes();return t==="all"?e.length:e.filter(i=>i.category_id===t).length}getDishesGroupedByCategory(){let t=this.getFilteredDishes(),e=this.categoryService.data,i=[];return e.forEach(a=>{let d=t.filter(f=>f.category_id===a.id);d.length>0&&i.push({category:a,dishes:d})}),i}getCategories(){return this.categoryService.data}shouldShowComandaDropdown(){return(this.orderHeader?.comande?.length||0)>1}getComandeForDropdown(){return this.orderHeader?.comande||[]}getCurrentComande(){return this.orderHeader?.comande||[]}switchComanda(t){if(!t||!this.orderHeader?.comande)return;let e=this.orderHeader.comande.find(i=>i.id===t);e&&(this.currentComanda=e)}toggleComandaExpansion(t){this.comandeExpanded[t]=!this.comandeExpanded[t]}isComandaExpanded(t){return this.comandeExpanded[t]||!1}saveOrder(){return g(this,null,function*(){if(this.orderHeader)try{this.loadingService.start(),this.saved.emit(this.orderHeader),console.log("\u2705 Ordine salvato")}catch(t){console.error("\u274C Errore salvataggio ordine:",t)}finally{this.loadingService.stop()}})}close(){this.closeRequested.emit()}calcolaTotaleTavolata(){return!this.orderHeader||!this.orderHeader.comande?0:this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)}calcolaTotaleOrderHeader(t){return t.total_amount||0}getTotalComandeCount(){return this.orderHeader?.comande?.length||0}getOrderStatusColor(t){return{ordered:"#f39c12",waiting:"#3498db",preparing:"#9b59b6",ready:"#2ecc71",served:"#27ae60",cancelled:"#e74c3c"}[t]||"#95a5a6"}getOrderStatusText(t){return{ordered:"Ordinato",waiting:"In attesa",preparing:"In preparazione",ready:"Pronto",served:"Servito",cancelled:"Cancellato"}[t]||t}getDishName(t){return t.dish_name||t.dish?.name||"Piatto"}resetDishFilters(){this.dishSearchTerm="",this.selectedCategory="all"}trackByDishId(t,e){return e.id}onMenuSelectChange(t){this.selectedMenu=t,this.loadDishesForSelectedMenu()}generateBill(){this.showBillPreviewModal=!0,this.billPreviewHtml=this.generateBillHtml()}printBill(){let t=window.open("","_blank");t&&(t.document.write(this.billPreviewHtml),t.document.close(),t.print())}isReadyForBill(){return!!(this.orderHeader&&this.orderHeader.comande&&this.orderHeader.comande.length>0)}generateBillHtml(){if(!this.orderHeader)return"";let t=`
      <html>
        <head>
          <title>Scontrino Tavolo ${this.table.table_number}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; }
            .item { margin-bottom: 10px; }
            .total { font-weight: bold; margin-top: 20px; }
          </style>
        </head>
        <body>
          <h1>Ristorante</h1>
          <p>Tavolo: ${this.table.table_number}</p>
          <p>Data: ${new Date().toLocaleDateString()}</p>
          <hr>
    `;return this.orderHeader.comande&&this.orderHeader.comande.forEach(e=>{t+=`<h3>Comanda ${e.comanda_number}</h3>`,e.order_items&&e.order_items.forEach(i=>{t+=`
              <div class="item">
                ${i.quantity} x ${i.dish_name||"Piatto"} - \u20AC${(i.unit_price*i.quantity).toFixed(2)}
              </div>
            `})}),t+=`
          <hr>
          <div class="total">Totale: \u20AC${this.calcolaTotaleTavolata().toFixed(2)}</div>
        </body>
      </html>
    `,t}get dedicatedMenu(){return this.activeMenus.find(t=>t.type==="dedicated")||null}get globalMenus(){return this.activeMenus.filter(t=>t.type==="global")}hasMenusToShow(){return this.activeMenus.length>0}hasDedicatedMenu(){return this.activeMenus.some(t=>t.type==="dedicated")}hasGlobalMenus(){return this.activeMenus.some(t=>t.type==="global")}switchToEditMode(){this.closeRequested.emit()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=Q({type:l,selectors:[["app-order-editor"]],inputs:{table:"table",mode:"mode",existingOrderHeader:"existingOrderHeader",orderingStatus:"orderingStatus"},outputs:{saved:"saved",closeRequested:"closeRequested"},decls:3,vars:3,consts:[["emptyOrder",""],["noDishes",""],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg","fullscreen-mobile",3,"click"],[1,"modal-header","compact-header"],[1,"flex","items-center","gap-sm","flex-1"],[1,"icon-button",3,"click"],[1,"material-icons"],[1,"flex","flex-col","flex-1"],[1,"section-title","text-md"],["class","chip active ml-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","mt-sm"],[1,"text-muted","text-mini"],[1,"flex","items-center","gap-sm"],[4,"ngIf"],["title","Chiudi",1,"icon-button",3,"click"],[1,"p-lg","mobile-scroll"],["class","menu-selector mb-lg",4,"ngIf"],[1,"search-bar-mobile","mb-md"],[1,"form-row"],[1,"form-group",2,"flex","3"],["type","text","placeholder","Cerca piatto...","autofocus","",1,"form-input","touch-target",3,"ngModelChange","ngModel"],[1,"form-group",2,"flex","1"],[1,"form-input","touch-target",3,"ngModelChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"flex",2,"margin-bottom","var(--gap-sm)"],[1,"grid-form"],[1,"flex","flex-col","gap-md"],[1,"form-card",2,"margin","0","padding","var(--gap-sm)"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","gap-sm","font-semibold"],[1,"material-icons","text-primary","text-md"],[1,"chip","active"],["class","mt-sm",4,"ngIf"],[1,"form-card",2,"margin","0","max-height","50vh","overflow-y","auto"],[1,"quick-actions-mobile"],[1,"quick-action-button",3,"click"],[1,"text-mini"],["class","quick-action-button",3,"active","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","gap-sm"],[4,"ngIf","ngIfElse"],[1,"modal-footer","mobile-footer"],[1,"promethea-button","ghost","flex-1","mobile-button",3,"click"],["title","Crea una nuova comanda nella tavolata corrente",1,"promethea-button","flex-1",3,"click","disabled"],[1,"promethea-button","primary","flex-1",3,"click","disabled","title"],[1,"chip","active","ml-sm"],[1,"form-input",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"menu-selector","mb-lg"],[1,"form-group"],[1,"standard-label"],["class","text-primary font-semibold",4,"ngIf"],["class","p-sm bg-primary-light rounded mb-md",4,"ngIf"],["class","p-sm bg-smoke rounded text-center",4,"ngIf"],["class","mt-sm flex items-center gap-sm",4,"ngIf"],[1,"text-primary","font-semibold"],[1,"p-sm","bg-primary-light","rounded","mb-md"],[1,"material-icons","text-primary"],[1,"font-semibold"],[1,"chip","bg-primary","ml-sm","text-white"],["class","p-sm bg-glass rounded border",4,"ngIf"],[1,"p-sm","bg-glass","rounded","border"],[1,"flex","items-center","justify-between"],["class","chip bg-glass",4,"ngIf"],[1,"chip","bg-glass"],[1,"material-icons","text-mini"],[1,"p-sm","bg-smoke","rounded","text-center"],[1,"material-icons","text-muted"],[1,"text-muted","text-mini","mt-sm"],[1,"mt-sm","flex","items-center","gap-sm"],[1,"chip"],["class","chip bg-primary text-white",4,"ngIf"],[1,"chip","bg-primary","text-white"],[3,"value"],[1,"mt-sm"],["class","mb-sm pb-sm border-b border-[var(--smoke-1)] last:border-0",4,"ngFor","ngForOf"],[1,"mt-md","pt-md","border-t","border-[var(--smoke-1)]"],[1,"flex","justify-between","items-center","mb-sm"],[1,"text-md"],[1,"text-primary","text-md"],[1,"mb-sm","pb-sm","border-b","border-[var(--smoke-1)]","last:border-0"],[1,"flex","justify-between","items-start","gap-sm"],["title","Riduci quantit\xE0",1,"icon-button","x-small",3,"click"],[1,"font-bold","px-2","text-center","text-sm","min-w-[20px]"],["title","Aumenta quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],["title","Elimina piatto",1,"icon-button","x-small","ml-1","text-danger",3,"click"],["class","flex justify-between items-center",4,"ngIf"],[1,"text-secondary"],[1,"empty-state","py-lg"],[1,"material-icons","text-lg"],[1,"text-muted"],[4,"ngFor","ngForOf"],[1,"flex","gap-sm","items-center"],[1,"font-bold","text-md"],[1,"material-icons","text-md"],[1,"font-bold","text-primary","text-md"],[1,"dishes-grid"],["class","card dish-card mobile-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","dish-card","mobile-card"],[1,"flex","gap-sm","flex-col","flex-1"],[1,"dish-name"],[1,"dish-price","text-primary"],["class","text-muted text-mini",4,"ngIf"],[1,"flex","gap-sm","justify-end"],["title","Aggiungi 1",1,"icon-button","x-small",3,"click","disabled"],[1,"empty-state"],[1,"promethea-button","ghost","mt-sm",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"header-icon"],[1,"section-title"],[1,"p-lg"],["class","empty-state",4,"ngIf"],["class","flex flex-col gap-lg",4,"ngIf"],[1,"modal-footer","mt-lg"],[1,"promethea-button","success","flex-1",3,"click","disabled"],[1,"promethea-button","primary","flex-1",3,"click"],[1,"promethea-button","ghost","flex-1",3,"click"],[1,"promethea-button","primary","mt-sm",3,"click"],[1,"flex","flex-col","gap-lg"],["class","form-card",4,"ngFor","ngForOf"],[1,"form-card","mt-md","bg-gradient","text-white"],[1,"text-white"],[1,"text-white","text-sm","opacity-80"],[1,"text-white","text-xl"],[1,"form-card"],[1,"flex","justify-between","items-center","cursor-pointer",3,"click"],[1,"flex","items-center","gap-md","flex-1"],[1,"flex","flex-col"],[1,"flex","items-center","gap-sm","flex-wrap"],[1,"chip","small"],[1,"text-muted","mt-sm"],[1,"flex","items-center","gap-md"],[1,"flex","flex-col","items-end"],["class","mt-md pt-md border-t border-[var(--smoke-1)]",4,"ngIf"],["class","space-y-sm",4,"ngIf"],["class","empty-state py-md",4,"ngIf"],[1,"flex","justify-between","items-center","mt-md","pt-md","border-t"],[1,"space-y-sm"],["class","flex justify-between items-start p-sm flex-wrap",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","p-sm","flex-wrap"],[1,"flex","items-start","gap-sm"],[1,"flex","items-center","gap-sm","mt-sm","text-muted"],[1,"chip","x-small","mt-sm",2,"max-width","fit-content"],[1,"empty-state","py-md"],[1,"p-lg",3,"innerHTML"],[1,"modal-footer"]],template:function(e,i){e&1&&h(0,Tt,77,31,"div",2)(1,Rt,35,13,"div",2)(2,Dt,16,1,"div",2),e&2&&(m("ngIf",i.mode==="edit"),s(),m("ngIf",i.mode==="view"),s(),m("ngIf",i.showBillPreviewModal))},dependencies:[J,Y,U,ae,ne,re,X,ie,ee,te,ye,Se,Ce],styles:[".mobile-scroll[_ngcontent-%COMP%]{overflow-y:auto;max-height:60vh;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.mobile-scroll[_ngcontent-%COMP%]{max-height:70vh;padding:var(--gap-sm)}.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%;width:100%;border-radius:0}.mobile-footer[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gap-sm)}.mobile-button[_ngcontent-%COMP%]{width:100%}}.dishes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.dishes-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.grid-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1);border-radius:12px;padding:var(--gap-sm);background:var(--background);transition:all .2s ease;cursor:pointer}.dish-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:var(--primary);box-shadow:0 4px 12px var(--smoke-2)}.dish-name[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm);line-height:1.3;color:var(--text-color);margin-bottom:4px}.dish-price[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-sm);color:var(--primary)}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);overflow-x:auto;padding-bottom:var(--gap-sm);margin-bottom:var(--gap-md);-webkit-overflow-scrolling:touch;scrollbar-width:none}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.quick-action-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-sm);min-width:80px;border:1px solid var(--smoke-1);border-radius:12px;background:var(--background);transition:all .2s ease;cursor:pointer;flex-shrink:0}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button.active[_ngcontent-%COMP%]{background:var(--smoke-1);border-color:var(--primary)}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md);margin-bottom:4px}.grid-form[_ngcontent-%COMP%]{display:flex}@media (max-width: 768px){.grid-form.mobile-vertical[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gap-md)}}.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column}}.menu-selector[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;padding:var(--gap-md);margin-bottom:var(--gap-lg)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-lg);color:var(--text-muted);text-align:center}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-lg);margin-bottom:var(--gap-sm);opacity:.5}.bill-preview[_ngcontent-%COMP%]{font-family:Courier New,monospace;background:#fff;color:#000;padding:var(--gap-lg);max-height:60vh;overflow-y:auto}@media print{.bill-preview[_ngcontent-%COMP%]{max-height:none;overflow:visible}}.icon-button[disabled][_ngcontent-%COMP%], .promethea-button[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;pointer-events:none}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-overlay[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.compact-header[_ngcontent-%COMP%]{padding:var(--gap-sm) var(--gap-md)}.compact-header[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:var(--fs-md)}"]})};var Ne=()=>[1,2,3,4,5,6,7,8,9,10];function Ht(l,t){if(l&1&&(n(0,"option",61),o(1),r()),l&2){let e=t.$implicit;m("ngValue",e),s(),T(e.name)}}function zt(l,t){if(l&1&&(n(0,"option",61),o(1),r()),l&2){let e=t.$implicit;m("ngValue",e),s(),v(" ",e.name," ")}}function qt(l,t){if(l&1){let e=x();n(0,"div",62)(1,"h2",63),o(2),r(),n(3,"div",18)(4,"button",36),_("click",function(){u(e);let a=c();return p(a.zoomOut())}),n(5,"span",37),o(6,"zoom_out"),r()(),n(7,"div",64)(8,"span",39),o(9,"search"),r(),n(10,"span",40),o(11),r()(),n(12,"button",36),_("click",function(){u(e);let a=c();return p(a.zoomIn())}),n(13,"span",37),o(14,"zoom_in"),r()(),n(15,"button",41),_("click",function(){u(e);let a=c();return p(a.resetZoom())}),n(16,"span",37),o(17,"history"),r()(),n(18,"select",65),C("ngModelChange",function(a){u(e);let d=c();return w(d.currentFloorPlan,a)||(d.currentFloorPlan=a),p(a)}),_("ngModelChange",function(a){u(e);let d=c();return p(d.onFloorPlanSelect(a))}),h(19,zt,2,2,"option",27),r(),n(20,"button",41),_("click",function(){u(e);let a=c();return p(a.safeToggleFullscreen())}),n(21,"span",37),o(22,"fullscreen_exit"),r()()()()}if(l&2){let e=c();s(2),T((e.currentFloorPlan==null?null:e.currentFloorPlan.name)||"Mappa"),s(2),m("disabled",e.zoomLevel<=e.minZoom),s(7),v("",(e.zoomLevel*100).toFixed(0),"%"),s(),m("disabled",e.zoomLevel>=e.maxZoom),s(6),b("ngModel",e.currentFloorPlan),s(),m("ngForOf",e.floorPlans)}}function Wt(l,t){if(l&1&&(n(0,"div",72)(1,"small"),o(2),r()()),l&2){let e=c().$implicit;s(2),v("Pren: ",e.currentReservation.customer_name)}}function Bt(l,t){if(l&1&&(n(0,"div",72)(1,"small"),o(2),r()()),l&2){let e=c().$implicit,i=c();s(2),v("Ord: ",i.getTableOrderCount(e.table.id)," piatti")}}function Nt(l,t){if(l&1){let e=x();n(0,"div",66),_("click",function(){let a=u(e).$implicit,d=c();return p(d.onTableClick(a))}),n(1,"div",67)(2,"div",68),o(3),r(),n(4,"div",69)(5,"div",70),o(6),n(7,"span",37),o(8,"person"),r()()(),h(9,Wt,3,1,"div",71)(10,Bt,3,1,"div",71),r()()}if(l&2){let e=t.$implicit,i=c();Z(i.getTableClass(e)),m("ngStyle",i.getTableStyle(e.table)),s(),F("text-large",i.isLargeText),s(2),T(e.table.table_number),s(3),T(e.table.capacity),s(3),m("ngIf",e.currentReservation),s(),m("ngIf",e.currentOrders)}}function At(l,t){l&1&&(n(0,"div",73)(1,"span",37),o(2,"search_off"),r(),n(3,"h3"),o(4,"Nessun tavolo trovato"),r(),n(5,"p",8),o(6,"Modifica i filtri di ricerca"),r()())}function Lt(l,t){if(l&1){let e=x();n(0,"div",83)(1,"button",84),_("click",function(){u(e);let a=c(2);return a.openManualReservationModal(),p(a.showQuickActionsModal=!1)}),n(2,"span",37),o(3,"event"),r(),o(4," Crea Prenotazione "),r(),n(5,"button",85),_("click",function(){u(e);let a=c(2);return p(a.openOrderEditor())}),n(6,"span",37),o(7),r(),o(8),r()()}if(l&2){let e=c(2);s(5),m("disabled",!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?"Crea nuovo ordine":"Disabilitato: fuori orario dei turni"),s(2),T(e.orderingStatus.allowed?"restaurant":"schedule"),s(),v(" ",e.orderingStatus.allowed?"Crea Ordine":"Fuori Turno"," ")}}function jt(l,t){if(l&1){let e=x();n(0,"div",83)(1,"button",42),_("click",function(){u(e);let a=c(2);return a.openEditReservationModal(),p(a.showQuickActionsModal=!1)}),n(2,"span",37),o(3,"edit"),r(),o(4," Modifica Prenotazione "),r(),n(5,"button",86),_("click",function(){u(e);let a=c(2);return p(a.openOrderEditor())}),n(6,"span",37),o(7,"check"),r(),o(8," Conferma Arrivo (Crea Ordine) "),r()()}if(l&2){let e=c(2);s(5),m("disabled",!e.orderingStatus.allowed)}}function $t(l,t){if(l&1){let e=x();n(0,"div",83)(1,"button",84),_("click",function(){u(e);let a=c(2);return p(a.openOrderEditor())}),n(2,"span",37),o(3,"receipt"),r(),o(4," Visualizza Ordini "),r(),n(5,"button",87),_("click",function(){u(e);let a=c(2);return p(a.freeTable())}),n(6,"span",37),o(7,"check_circle"),r(),o(8," Libera Tavolo "),r()()}}function Qt(l,t){if(l&1){let e=x();n(0,"div",74)(1,"div",75)(2,"div",76)(3,"div",46)(4,"div",77)(5,"span",37),o(6,"table_restaurant"),r()(),n(7,"div")(8,"h1",7),o(9),r()()(),n(10,"button",41),_("click",function(){u(e);let a=c();return p(a.deselectTable())}),n(11,"span",37),o(12,"close"),r()()(),n(13,"div",78)(14,"div",79)(15,"div",80)(16,"span",81),o(17),r()(),h(18,Lt,9,4,"div",82)(19,jt,9,1,"div",82)(20,$t,9,0,"div",82),r()()()()}if(l&2){let e=c();s(9),v("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number),s(7),Z(e.getStatusColorClass((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")),s(),v(" ",e.getStatusText((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")," "),s(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="free"),s(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="reserved"),s(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="occupied")}}function Zt(l,t){if(l&1&&(n(0,"option",101),o(1),r()),l&2){let e=t.$implicit,i=c(2);m("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),s(),L(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function Gt(l,t){if(l&1){let e=x();n(0,"div",74)(1,"div",88)(2,"div",76)(3,"div",46)(4,"div",77)(5,"span",37),o(6,"event"),r()(),n(7,"div")(8,"h2",40),o(9),r()()(),n(10,"button",41),_("click",function(){u(e);let a=c();return p(a.closeManualReservationModal())}),n(11,"span",37),o(12,"close"),r()()(),n(13,"div",78)(14,"form",89,2),_("ngSubmit",function(a){return u(e),c().createManualReservation(),p(a.preventDefault())}),n(16,"div",23)(17,"div",24)(18,"label",25),o(19,"Nome Cliente *"),r(),n(20,"input",90),C("ngModelChange",function(a){u(e);let d=c();return w(d.manualReservationData.customer_name,a)||(d.manualReservationData.customer_name=a),p(a)}),r()(),n(21,"div",24)(22,"label",25),o(23,"Telefono *"),r(),n(24,"input",91),C("ngModelChange",function(a){u(e);let d=c();return w(d.manualReservationData.customer_phone,a)||(d.manualReservationData.customer_phone=a),p(a)}),r()()(),n(25,"div",23)(26,"div",24)(27,"label",25),o(28,"Data *"),r(),n(29,"input",92),C("ngModelChange",function(a){u(e);let d=c();return w(d.manualReservationData.reservation_date,a)||(d.manualReservationData.reservation_date=a),p(a)}),r()(),n(30,"div",24)(31,"label",25),o(32,"Orario *"),r(),n(33,"input",93),C("ngModelChange",function(a){u(e);let d=c();return w(d.manualReservationData.reservation_time,a)||(d.manualReservationData.reservation_time=a),p(a)}),r()()(),n(34,"div",24)(35,"label",25),o(36,"Numero Persone *"),r(),n(37,"select",94),C("ngModelChange",function(a){u(e);let d=c();return w(d.manualReservationData.party_size,a)||(d.manualReservationData.party_size=a),p(a)}),h(38,Zt,2,5,"option",95),r(),n(39,"div",96),o(40),r()(),n(41,"div",24)(42,"label",25),o(43,"Note Speciali"),r(),n(44,"textarea",97),C("ngModelChange",function(a){u(e);let d=c();return w(d.manualReservationData.special_requests,a)||(d.manualReservationData.special_requests=a),p(a)}),r()(),n(45,"div",98)(46,"button",99),_("click",function(){u(e);let a=c();return p(a.closeManualReservationModal())}),o(47," Annulla "),r(),n(48,"button",100)(49,"span",37),o(50,"add"),r(),o(51," Crea Prenotazione "),r()()()()()()}if(l&2){let e=z(15),i=c();s(9),v("Nuova Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number),s(11),b("ngModel",i.manualReservationData.customer_name),s(4),b("ngModel",i.manualReservationData.customer_phone),s(5),b("ngModel",i.manualReservationData.reservation_date),s(4),b("ngModel",i.manualReservationData.reservation_time),s(4),b("ngModel",i.manualReservationData.party_size),s(),m("ngForOf",W(10,Ne)),s(2),v(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),s(4),b("ngModel",i.manualReservationData.special_requests),s(4),m("disabled",!e.valid)}}function Yt(l,t){if(l&1&&(n(0,"option",101),o(1),r()),l&2){let e=t.$implicit,i=c(2);m("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),s(),L(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function Ut(l,t){if(l&1){let e=x();n(0,"button",104),_("click",function(){u(e);let a=c(2);return p(a.deleteReservation())}),n(1,"span",37),o(2,"delete"),r(),o(3," Elimina "),r()}}function Jt(l,t){if(l&1){let e=x();n(0,"div",74)(1,"div",88)(2,"div",76)(3,"div",46)(4,"div",77)(5,"span",37),o(6,"edit"),r()(),n(7,"div")(8,"h1",7),o(9),r()()(),n(10,"button",41),_("click",function(){u(e);let a=c();return p(a.closeEditReservationModal())}),n(11,"span",37),o(12,"close"),r()()(),n(13,"div",78)(14,"form",89,2),_("ngSubmit",function(a){return u(e),c().updateReservation(),p(a.preventDefault())}),n(16,"div",23)(17,"div",24)(18,"label",25),o(19,"Nome Cliente *"),r(),n(20,"input",90),C("ngModelChange",function(a){u(e);let d=c();return w(d.editingReservation.customer_name,a)||(d.editingReservation.customer_name=a),p(a)}),r()(),n(21,"div",24)(22,"label",25),o(23,"Telefono *"),r(),n(24,"input",91),C("ngModelChange",function(a){u(e);let d=c();return w(d.editingReservation.customer_phone,a)||(d.editingReservation.customer_phone=a),p(a)}),r()()(),n(25,"div",23)(26,"div",24)(27,"label",25),o(28,"Data *"),r(),n(29,"input",92),C("ngModelChange",function(a){u(e);let d=c();return w(d.editingReservation.reservation_date,a)||(d.editingReservation.reservation_date=a),p(a)}),r()(),n(30,"div",24)(31,"label",25),o(32,"Orario *"),r(),n(33,"input",93),C("ngModelChange",function(a){u(e);let d=c();return w(d.editingReservation.reservation_time,a)||(d.editingReservation.reservation_time=a),p(a)}),r()()(),n(34,"div",24)(35,"label",25),o(36,"Numero Persone *"),r(),n(37,"select",94),C("ngModelChange",function(a){u(e);let d=c();return w(d.editingReservation.party_size,a)||(d.editingReservation.party_size=a),p(a)}),h(38,Yt,2,5,"option",95),r(),n(39,"div",96),o(40),r()(),n(41,"div",24)(42,"label",25),o(43,"Note Speciali"),r(),n(44,"textarea",97),C("ngModelChange",function(a){u(e);let d=c();return w(d.editingReservation.special_requests,a)||(d.editingReservation.special_requests=a),p(a)}),r()(),n(45,"div",98)(46,"div",102),h(47,Ut,4,0,"button",103),n(48,"div",5)(49,"button",99),_("click",function(){u(e);let a=c();return p(a.closeEditReservationModal())}),o(50," Annulla "),r(),n(51,"button",100)(52,"span",37),o(53,"save"),r(),o(54," Salva "),r()()()()()()()()}if(l&2){let e=z(15),i=c();s(9),v("Modifica Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number),s(11),b("ngModel",i.editingReservation.customer_name),s(4),b("ngModel",i.editingReservation.customer_phone),s(5),b("ngModel",i.editingReservation.reservation_date),s(4),b("ngModel",i.editingReservation.reservation_time),s(4),b("ngModel",i.editingReservation.party_size),s(),m("ngForOf",W(11,Ne)),s(2),v(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),s(4),b("ngModel",i.editingReservation.special_requests),s(3),m("ngIf",i.isReservationDeletable(i.editingReservation)),s(4),m("disabled",!e.valid)}}function Kt(l,t){if(l&1){let e=x();n(0,"app-order-editor",105),_("saved",function(){u(e);let a=c();return p(a.closeOrderEditorModal())})("closeRequested",function(){u(e);let a=c();return p(a.closeOrderEditorModal())}),r()}if(l&2){let e=c();m("table",e.orderEditorData.table)("mode","edit")("existingOrderHeader",e.orderEditorData.existingOrderHeader)}}function Xt(l,t){if(l&1){let e=x();n(0,"app-order-editor",106),_("closeRequested",function(){u(e);let a=c();return p(a.closeOrderEditorViewModal())}),r()}if(l&2){let e=c();m("table",e.selectedTable)("mode","view")("existingOrderHeader",e.orderEditorData.existingOrderHeader||null)}}var Be=class l{tableStatusService=y(oe);floorManagementService=y(qe);loadingService=y(B);tableService=y(Re);floorPlanService=y(Fe);reservationService=y(De);authService=y(K);orderHeaderService=y(He);shiftService=y(We);zoomLevel=1;minZoom=.5;maxZoom=3;mobileView=!1;isFullscreen=!1;isLargeText=!1;searchTerm="";statusFilter="all";showQuickActionsModal=!1;showManualReservationModal=!1;showEditReservationModal=!1;showAssignReservationModal=!1;showTableReservationsModal=!1;showTableAssignmentModal=!1;showOrderEditorModal=!1;showOrderEditorViewModal=!1;orderEditorData={table:null,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null};currentFloorPlan=null;tableStatuses=[];selectedTable=null;selectedTableStatus=null;currentRestaurant=null;tableOrderCounts=new Map;manualReservationData={customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};editingReservation=null;orderingStatus={allowed:!1,reason:"Caricamento...",currentShift:null};availableReservationsWithoutTable=[];selectedReservationForAssignment=null;assignmentReservation=null;suggestedTablesByFloorPlan={};selectedFloorPlanForAssignment=null;selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}};subscriptions=new he;get floorPlans(){return this.floorPlanService.data}get dishes(){return[]}ngOnInit(){return g(this,null,function*(){yield this.loadInitialData(),this.checkMobileView(),window.addEventListener("resize",()=>this.checkMobileView()),this.startShiftChecking()})}ngOnDestroy(){this.subscriptions.unsubscribe(),window.removeEventListener("resize",()=>this.checkMobileView())}loadInitialData(){return g(this,null,function*(){this.loadingService.start();try{yield Promise.all([this.floorPlanService.loadFloorPlans(),this.tableService.loadData(),this.floorManagementService.loadTodaysReservations()]);let t=this.tableService.data.filter(e=>!e.is_merged||e.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(t),this.floorPlans.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=this.floorPlans[0],yield this.loadTablesForFloorPlan())}finally{this.loadingService.stop()}})}onTableClick(t){return g(this,null,function*(){this.selectedTable=t.table,this.selectedTableStatus=t,yield this.loadTableReservations(t.table.id),this.showQuickActionsModal=!0})}deselectTable(){this.selectedTable=null,this.selectedTableStatus=null,this.showQuickActionsModal=!1,this.showManualReservationModal=!1,this.showEditReservationModal=!1}openManualReservationModal(){return g(this,null,function*(){if(!this.selectedTable)return;let t=new Date;this.manualReservationData={customer_name:"",customer_phone:"",reservation_date:t.toISOString().split("T")[0],reservation_time:t.toTimeString().split(" ")[0].substring(0,5),party_size:this.selectedTable.capacity||2,special_requests:""},this.showQuickActionsModal=!1,this.showManualReservationModal=!0})}closeManualReservationModal(){this.showManualReservationModal=!1}createManualReservation(){return g(this,null,function*(){if(this.selectedTable)try{let t=yield this.getCurrentRestaurantId();if(!t)return;let e={restaurant_id:t,table_id:this.selectedTable.id,reservation_date:this.manualReservationData.reservation_date,reservation_time:this.manualReservationData.reservation_time,party_size:this.manualReservationData.party_size,special_requests:this.manualReservationData.special_requests,status:"confirmed",customer_name:this.manualReservationData.customer_name,customer_phone:this.manualReservationData.customer_phone};(yield this.reservationService.createRestaurantReservation(e))?(this.closeManualReservationModal(),yield this.loadInitialData(),alert("Prenotazione creata con successo!")):alert("Errore nella creazione della prenotazione")}catch(t){console.error("Error creating manual reservation:",t),alert("Errore durante la creazione della prenotazione: "+t.message)}})}openOrderEditor(){return g(this,null,function*(){if(!this.selectedTable)return;let t=yield this.orderHeaderService.getActiveOrderHeaderByTable(this.selectedTable.id);t?(this.orderEditorData={table:this.selectedTable,mode:"view",existingOrderHeader:t,orderHeaders:[t],currentTavolataId:t.id},this.showOrderEditorViewModal=!0):(this.orderEditorData={table:this.selectedTable,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null},this.showOrderEditorModal=!0),this.showQuickActionsModal=!1})}closeOrderEditorModal(){this.showOrderEditorModal=!1,this.loadTablesForFloorPlan()}closeOrderEditorViewModal(){this.showOrderEditorViewModal=!1}loadTableReservations(t){return g(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let i=new Date().toISOString().split("T")[0],a=this.reservationService.data.filter(S=>S.restaurant_id===e&&S.table_id===t&&S.reservation_date===i&&["confirmed","pending"].includes(S.status)).sort((S,P)=>S.reservation_time.localeCompare(P.reservation_time)),d=null,f=[];for(let S of a){let P=new Date(`${S.reservation_date}T${S.reservation_time}`),k=new Date,I=(P.getTime()-k.getTime())/(1e3*60*60);I>=0&&I<=1.5?d=S:I>1.5&&f.push(S)}this.selectedTableReservations={active:d,futureReservations:f,shiftInfo:{current:null,next:null}}}catch(e){console.error("Errore caricamento prenotazioni tavolo:",e),this.selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}}}})}checkMobileView(){this.mobileView=window.innerWidth<=768}getFilteredTables(){let t=this.tableStatuses;if(this.statusFilter!=="all"&&(t=t.filter(e=>e.status===this.statusFilter)),this.searchTerm){let e=this.searchTerm.toLowerCase();t=t.filter(i=>i.table.table_number.toLowerCase().includes(e)||i.table.table_name.toLowerCase().includes(e))}return t}getTableClass(t){let e=this.selectedTable?.id===t.table.id;return`table-element shape-${t.table.shape} ${t.status} ${e?"selected":""}`}getTableStyle(t){return{left:t.position_x+"px",top:t.position_y+"px",width:t.width+"px",height:t.height+"px","border-radius":t.shape==="circle"?"50%":"0px",transform:`rotate(${t.rotation}deg)`}}startShiftChecking(){this.checkCurrentShift(),this.subscriptions.add(fe(6e4).subscribe(()=>this.checkCurrentShift()))}checkCurrentShift(){return g(this,null,function*(){let t=yield this.shiftService.getOrderingStatus();this.orderingStatus=t})}getShiftStatusClass(){return this.orderingStatus.allowed?"shift-active":"shift-inactive"}getShiftStatusText(){return this.orderingStatus.allowed?"\u{1F4CB} Orario di turno":"\u23F0 "+this.orderingStatus.reason}getCurrentRestaurantId(){return g(this,null,function*(){try{let t=this.authService.getCurrentStaffRestaurantId();return t||(this.authService.currentUserValue?(yield this.reservationService.loadData(),this.reservationService.data.length>0&&this.reservationService.data[0]?.restaurant_id||null):null)}catch(t){return console.error("Errore in getCurrentRestaurantId:",t),null}})}getStatusColorClass(t=""){return`status-${t}`}getStatusText(t=""){return{free:"Libero",reserved:"Prenotato",occupied:"Occupato"}[t]||t}getTableOrderItemsCount(t){return g(this,null,function*(){try{let e=yield this.orderHeaderService.getActiveOrderHeaderByTable(t);if(!e)return 0;let i=yield this.orderHeaderService.loadWithDetails(e.id);if(!i||!i.comande)return 0;let a=0;for(let d of i.comande)d.order_items&&(a+=d.order_items.length);return a}catch(e){return console.error("Errore conteggio piatti:",e),0}})}onFloorPlanSelect(t){this.currentFloorPlan=t,this.loadTablesForFloorPlan(),this.deselectTable()}safeToggleFullscreen(){return g(this,null,function*(){this.isFullscreen=!this.isFullscreen})}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.25,this.maxZoom)}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.25,this.minZoom)}resetZoom(){this.zoomLevel=1}getScaledWidth(){return(this.currentFloorPlan?.width||1e3)*this.zoomLevel}getScaledHeight(){return(this.currentFloorPlan?.height||800)*this.zoomLevel}updateReservation(){return g(this,null,function*(){if(this.editingReservation)try{(yield this.reservationService.updateReservation(this.editingReservation.id,this.editingReservation))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'aggiornamento della prenotazione")}catch(t){console.error("Errore nell'aggiornamento della prenotazione:",t),alert("Errore durante l'aggiornamento della prenotazione")}})}deleteReservation(){return g(this,null,function*(){if(this.editingReservation&&this.isReservationDeletable(this.editingReservation))try{(yield this.reservationService.deleteReservation(this.editingReservation.id))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'eliminazione della prenotazione")}catch(t){console.error("Errore nell'eliminazione della prenotazione:",t),alert("Errore durante l'eliminazione della prenotazione")}else alert("Impossibile eliminare questa prenotazione")})}isReservationDeletable(t){return!t?.reservation_date||!t?.reservation_time?!1:new Date(`${t.reservation_date}T${t.reservation_time}`)>new Date}openEditReservationModal(){this.selectedTableStatus?.currentReservation&&(this.editingReservation=H({},this.selectedTableStatus.currentReservation),this.showEditReservationModal=!0,this.showQuickActionsModal=!1)}closeEditReservationModal(){this.showEditReservationModal=!1,this.editingReservation=null}getFreeTablesCount(){return this.tableStatuses.filter(t=>t.status==="free").length}getReservedTablesCount(){return this.tableStatuses.filter(t=>t.status==="reserved").length}getOccupiedTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied").length}getTotalTablesCount(){return this.tableStatuses.length}toggleSize(){this.isLargeText=!this.isLargeText}getTableOrderItemsCountSync(t){return 0}loadAllTableOrderCounts(){return g(this,null,function*(){this.tableOrderCounts.clear();let t=this.tableStatuses.map(e=>g(this,null,function*(){try{let i=yield this.orderHeaderService.getTableOrderItemsCount(e.table.id);this.tableOrderCounts.set(e.table.id,i)}catch(i){console.error(`Errore caricamento ordini per tavolo ${e.table.id}:`,i),this.tableOrderCounts.set(e.table.id,0)}}));yield Promise.all(t)})}getTableOrderCount(t){return this.tableOrderCounts.get(t)||0}loadTablesForFloorPlan(){return g(this,null,function*(){if(!this.currentFloorPlan)return;let e=this.tableService.getTablesByFloorPlan(this.currentFloorPlan.id).filter(i=>!i.is_merged||i.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(e),yield this.loadAllTableOrderCounts()})}getTablesWithOrdersCount(){return Array.from(this.tableOrderCounts.values()).filter(t=>t>0).length}freeTable(){return g(this,null,function*(){if(!this.selectedTable)return;let t=this.selectedTable,e=t.table_number;try{let i=yield this.getTableOrderItemsCount(t.id);if(i>0){if(!confirm(`\u26A0\uFE0F ATTENZIONE!

Il tavolo ${e} ha ${i} piatti ordinati.

Sei sicuro di voler liberare il tavolo?
Questa azione chiuder\xE0 tutti gli ordini attivi.`))return}else if(!confirm(`Vuoi liberare il tavolo ${e}?`))return;this.loadingService.start(),(yield this.orderHeaderService.closeAllActiveHeadersForTable(t.id))?(console.log(`\u2705 Tavolo ${e} liberato`),yield this.loadTablesForFloorPlan(),this.deselectTable(),alert(`\u2705 Tavolo ${e} liberato con successo!`)):alert("\u274C Errore durante la liberazione del tavolo. Riprova.")}catch(i){console.error("\u274C Errore liberazione tavolo:",i),alert("\u274C Errore durante la liberazione del tavolo.")}finally{this.loadingService.stop()}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=Q({type:l,selectors:[["app-table-map"]],decls:140,vars:40,consts:[["mapContainer","","mapCard",""],["floorPlanCanvas",""],["reservationForm","ngForm"],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","flex-col","gap-md"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"form-card","flex-col","flex","gap-md"],[1,"flex","justify-between","items-center","m-sm02"],[1,"flex","items-center","gap-md"],[1,"flex"],[1,"text-muted","text-sm"],[1,"text-sm","text-muted"],[1,"form-card"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"form-input",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],["value","free"],["value","reserved"],["value","occupied"],["type","text","placeholder","Numero o nome tavolo...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer",2,"margin","0","justify-content","space-between"],[1,"flex","gap-md"],[1,"icon-button",3,"click","disabled"],[1,"material-icons"],[1,"flex","items-center","gap-sm","px-md","py-sm","justify-center"],[1,"material-icons","text-sm"],[1,"font-semibold"],[1,"icon-button",3,"click"],[1,"promethea-button","primary",3,"click"],[1,"form-card","mt-lg",2,"overflow","auto"],["class","fullscreen-header",4,"ngIf"],[1,"flex","justify-between","items-center","mb-md","flex-wrap"],[1,"flex","items-center","gap-sm"],[1,"flex","gap-sm","mr-md"],[1,"legend-color","free"],[1,"text-sm"],[1,"legend-color","reserved"],[1,"legend-color","occupied"],[1,"canvas-container"],[1,"canvas-wrapper"],[1,"floor-plan-canvas"],[1,"grid-overlay"],["class","table-element",3,"class","ngStyle","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"table","mode","existingOrderHeader","saved","closeRequested",4,"ngIf"],[3,"table","mode","existingOrderHeader","closeRequested",4,"ngIf"],[3,"ngValue"],[1,"fullscreen-header"],[1,"font-bold","text-lg"],[1,"flex","items-center","gap-sm","bg-smoke","px-md","py-sm","rounded-full","min-w-32","justify-center"],[1,"form-input","text-sm",3,"ngModelChange","ngModel"],[1,"table-element",3,"click","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-details"],[1,"table-capacity"],["class","table-info",4,"ngIf"],[1,"table-info"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"header-icon"],[1,"p-lg"],[1,"flex","flex-col","gap-lg"],[1,"flex","justify-center"],[1,"chip"],["class","flex flex-col gap-sm",4,"ngIf"],[1,"flex","flex-col","gap-sm"],[1,"promethea-button",3,"click"],[1,"promethea-button","primary",3,"click","disabled","title"],[1,"promethea-button","success",3,"click","disabled"],[1,"promethea-button","ghost",3,"click"],[1,"modal-container","modal-md"],[1,"generic-form",3,"ngSubmit"],["type","text","name","customer_name","required","","placeholder","Inserisci il nome del cliente",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone","required","","placeholder","Inserisci il telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","date","name","reservation_date","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","time","name","reservation_time","required","",1,"form-input",3,"ngModelChange","ngModel"],["name","party_size","required","",1,"form-input",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"text-muted","mt-sm"],["name","special_requests","rows","3","placeholder","Note o richieste speciali...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[3,"value","disabled"],[1,"flex","justify-between","items-center","w-full"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],["type","button",1,"promethea-button","danger",3,"click"],[3,"saved","closeRequested","table","mode","existingOrderHeader"],[3,"closeRequested","table","mode","existingOrderHeader"]],template:function(e,i){if(e&1){let a=x();n(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),o(4,"brunch_dining"),r(),n(5,"h1",7),o(6,"Prenotazioni Tavoli"),r()(),n(7,"p",8),o(8,"Gestisci prenotazioni e ordini in tempo reale"),r()(),n(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"span",13),o(14,"event_available"),r(),n(15,"div",14),o(16,"Tavoli Liberi"),r()(),n(17,"div",15),o(18),r()()(),n(19,"div",10)(20,"div",11)(21,"div",12)(22,"span",13),o(23,"event"),r(),n(24,"div",14),o(25,"Prenotati"),r()(),n(26,"div",15),o(27),r()()(),n(28,"div",10)(29,"div",11)(30,"div",12)(31,"span",13),o(32,"restaurant"),r(),n(33,"div",14),o(34,"Occupati"),r()(),n(35,"div",15),o(36),r()()(),n(37,"div",10)(38,"div",11)(39,"div",12)(40,"span",13),o(41,"table_restaurant"),r(),n(42,"div",14),o(43,"Tavoli Totali"),r()(),n(44,"div",15),o(45),r()()()(),n(46,"div",16)(47,"div",17)(48,"div",18)(49,"div",19),o(50),r(),n(51,"div",20),o(52),r()(),n(53,"div",21),o(54," \u23F0 Si pu\xF2 ordinare 1h prima/dopo il turno "),r()()(),n(55,"div",22)(56,"div",23)(57,"div",24)(58,"label",25),o(59,"Mappa"),r(),n(60,"select",26),C("ngModelChange",function(f){return u(a),w(i.currentFloorPlan,f)||(i.currentFloorPlan=f),p(f)}),_("change",function(){return u(a),p(i.onFloorPlanSelect(i.currentFloorPlan))}),h(61,Ht,2,2,"option",27),r()(),n(62,"div",24)(63,"label",25),o(64,"Stato"),r(),n(65,"select",28),C("ngModelChange",function(f){return u(a),w(i.statusFilter,f)||(i.statusFilter=f),p(f)}),n(66,"option",29),o(67,"Tutti gli stati"),r(),n(68,"option",30),o(69,"Libero"),r(),n(70,"option",31),o(71,"Prenotato"),r(),n(72,"option",32),o(73,"Occupato"),r()()(),n(74,"div",24)(75,"label",25),o(76,"Cerca"),r(),n(77,"input",33),C("ngModelChange",function(f){return u(a),w(i.searchTerm,f)||(i.searchTerm=f),p(f)}),r()(),n(78,"div",24)(79,"label",25),o(80,"Azioni"),r(),n(81,"div",34)(82,"div",35)(83,"button",36),_("click",function(){return u(a),p(i.zoomOut())}),n(84,"span",37),o(85,"zoom_out"),r()(),n(86,"div",38)(87,"span",39),o(88,"search"),r(),n(89,"span",40),o(90),r()(),n(91,"button",36),_("click",function(){return u(a),p(i.zoomIn())}),n(92,"span",37),o(93,"zoom_in"),r()(),n(94,"button",41),_("click",function(){return u(a),p(i.resetZoom())}),n(95,"span",37),o(96,"history"),r()()(),n(97,"button",42),_("click",function(){return u(a),p(i.loadInitialData())}),n(98,"span",37),o(99,"refresh"),r(),o(100," Aggiorna "),r()()()()(),n(101,"div",43,0),h(104,qt,23,6,"div",44),n(105,"div",45)(106,"h2",40),o(107),r(),n(108,"div",46)(109,"div",47)(110,"div",46),D(111,"div",48),n(112,"span",49),o(113,"Libero"),r()(),n(114,"div",46),D(115,"div",50),n(116,"span",49),o(117,"Prenotato"),r()(),n(118,"div",46),D(119,"div",51),n(120,"span",49),o(121,"Occupato"),r()()(),n(122,"button",41),_("click",function(){return u(a),p(i.safeToggleFullscreen())}),n(123,"span",37),o(124),r()(),n(125,"button",41),_("click",function(){return u(a),p(i.toggleSize())}),n(126,"span",37),o(127),r()()()(),n(128,"div",52)(129,"div",53)(130,"div",54,1),D(132,"div",55),h(133,Nt,11,9,"div",56)(134,At,7,0,"div",57),r()()()(),h(135,Qt,21,7,"div",58)(136,Gt,52,11,"div",58)(137,Jt,55,12,"div",58)(138,Kt,1,3,"app-order-editor",59)(139,Xt,1,3,"app-order-editor",60),r()}e&2&&(s(18),v(" ",i.getFreeTablesCount()," "),s(9),v(" ",i.getReservedTablesCount()," "),s(9),v(" ",i.getOccupiedTablesCount()," "),s(9),v(" ",i.getTotalTablesCount()," "),s(4),Z(i.getShiftStatusClass()),s(),v(" ",i.getShiftStatusText()," "),s(2),v(" ",i.orderingStatus.reason," "),s(8),b("ngModel",i.currentFloorPlan),s(),m("ngForOf",i.floorPlans),s(4),b("ngModel",i.statusFilter),s(12),b("ngModel",i.searchTerm),s(6),m("disabled",i.zoomLevel<=i.minZoom),s(7),v("",(i.zoomLevel*100).toFixed(0),"%"),s(),m("disabled",i.zoomLevel>=i.maxZoom),s(13),m("ngIf",i.isFullscreen),s(3),T(i.currentFloorPlan?i.currentFloorPlan.name:"Mappa"),s(15),F("active",i.isFullscreen),s(2),v(" ",i.isFullscreen?"fullscreen_exit":"fullscreen"," "),s(3),v(" ",i.isLargeText?"text_decrease":"text_increase"," "),s(2),q("width",i.getScaledWidth(),"px")("height",i.getScaledHeight(),"px"),s(),q("width",i.currentFloorPlan?i.currentFloorPlan.width:1e3,"px")("height",i.currentFloorPlan?i.currentFloorPlan.height:800,"px")("transform","scale("+i.zoomLevel+")")("transform-origin","0 0"),s(3),m("ngForOf",i.getFilteredTables()),s(),m("ngIf",i.getFilteredTables().length===0),s(),m("ngIf",i.showQuickActionsModal),s(),m("ngIf",i.showManualReservationModal),s(),m("ngIf",i.showEditReservationModal),s(),m("ngIf",i.showOrderEditorModal),s(),m("ngIf",i.showOrderEditorViewModal))},dependencies:[J,Y,U,we,ae,Oe,ne,re,X,ie,ee,Ee,Pe,te,Me,se],styles:[".fullscreen-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--background);padding:var(--gap-sm);display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;border-bottom:1px solid var(--smoke-1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);gap:var(--gap-sm)}.fullscreen-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin:0;flex:1;min-width:120px}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{position:absolute!important;inset:70px 0 0!important;height:auto!important;max-height:none!important;min-height:auto!important;border:none!important;margin-top:0!important;border-radius:0!important;padding:var(--gap-md)!important;overflow:auto!important;-webkit-overflow-scrolling:touch!important}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-wrapper[_ngcontent-%COMP%]{width:auto!important;height:auto!important}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{transform-origin:0 0!important}.canvas-container[_ngcontent-%COMP%]{position:relative;width:100%;min-height:400px;border:2px solid var(--smoke-1);border-radius:12px;background-color:var(--background);overflow:auto!important;-webkit-overflow-scrolling:touch!important;padding:var(--gap-sm);box-sizing:border-box}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;min-width:100%;min-height:100%}.floor-plan-canvas[_ngcontent-%COMP%]{position:relative;background-color:var(--background);box-shadow:0 4px 12px var(--smoke-1);border-radius:8px;transform-origin:0 0;transition:transform .2s ease-out}@media (max-width: 768px){.chip.active.ml-sm[_ngcontent-%COMP%]{display:none}.canvas-container[_ngcontent-%COMP%]{min-height:400px;max-height:80vh;overflow:auto!important;-webkit-overflow-scrolling:touch!important;touch-action:pan-x pan-y!important;display:block}}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{display:block!important;width:max-content!important;height:max-content!important;min-width:100%!important;min-height:100%!important;margin:auto!important;transform-origin:center center;transition:transform .2s ease-out;background:var(--background)}@media (max-width: 768px){.fullscreen-header[_ngcontent-%COMP%]{padding:var(--gap-sm)}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{top:80px}}.icon-button[disabled][_ngcontent-%COMP%]{opacity:.4;cursor:not-allowed}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex!important;gap:var(--gap-sm)!important;overflow-x:auto!important;padding-bottom:var(--gap-sm)!important;-webkit-overflow-scrolling:touch!important;scrollbar-width:none!important;flex-wrap:wrap}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none!important}.quick-action-button[_ngcontent-%COMP%]{display:flex!important;flex-direction:column!important;align-items:center!important;justify-content:center!important;padding:var(--gap-sm)!important;min-width:80px!important;border:1px solid var(--smoke-1)!important;border-radius:12px!important;background:var(--background)!important;transition:all .2s ease!important;cursor:pointer!important;flex-shrink:0!important}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button[_ngcontent-%COMP%]:active{background:var(--smoke-1)!important;border-color:var(--primary)!important}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin-bottom:4px!important}.mobile-scroll[_ngcontent-%COMP%]{overflow-y:auto;height:calc(100vh - 200px);max-height:500px;scroll-behavior:auto!important}.dish-card[_ngcontent-%COMP%]{min-height:120px;transition:none!important}.modal-container.modal-lg[_ngcontent-%COMP%]{max-height:90vh;display:flex;flex-direction:column}.modal-container.modal-lg[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{flex:1;overflow:hidden}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1)!important;border-radius:12px!important;padding:var(--gap-sm);background:var(--background);transition:none;cursor:pointer!important}.dish-card[_ngcontent-%COMP%]:hover, .dish-card[_ngcontent-%COMP%]:active{transform:translateY(-2px)!important;border-color:var(--primary)!important;box-shadow:0 4px 12px var(--smoke-2)!important}.dish-card.mobile-card[_ngcontent-%COMP%]{margin-bottom:var(--gap-sm)!important}.dish-name[_ngcontent-%COMP%]{font-weight:600!important;font-size:var(--fs-sm)!important;line-height:1.3!important;color:var(--text-color)!important}.dish-price[_ngcontent-%COMP%]{font-weight:700!important;font-size:var(--fs-sm)!important;color:var(--primary)!important}.bill-preview[_ngcontent-%COMP%]{background:var(--background);color:var(--text-color);max-height:70vh;overflow-y:auto;padding:var(--gap-lg)}.bill-preview[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:var(--gap-lg);padding-bottom:var(--gap-md);border-bottom:2px solid var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;margin-bottom:var(--gap-md);transition:all .3s ease}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]:hover{border-color:var(--secondary);box-shadow:0 4px 12px var(--smoke-2)}.bill-preview[_ngcontent-%COMP%]   .comanda-header[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;border-bottom:1px solid var(--smoke-1);padding-bottom:var(--gap-sm);margin-bottom:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:calc(var(--gap-sm) / 2) 0;border-bottom:1px dashed var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:last-child{border-bottom:none}.bill-preview[_ngcontent-%COMP%]   .comanda-total[_ngcontent-%COMP%]{color:var(--primary);font-weight:600;margin-top:var(--gap-sm);padding-top:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .header-total[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 10%,transparent);padding:var(--gap-sm);border-radius:8px;margin-top:var(--gap-md)}.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:var(--gradiente);color:#fff;padding:var(--gap-lg);border-radius:16px;margin-top:var(--gap-lg);box-shadow:0 8px 24px var(--shadow-2)}@media print{.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.modal-footer[_ngcontent-%COMP%]{display:none!important}}.canvas-wrapper[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.legend-color[_ngcontent-%COMP%]{width:var(--fs-md);height:var(--fs-sm);display:flex;border-radius:var(--gap-sm)}.legend-color.free[_ngcontent-%COMP%]{background:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.occupied[_ngcontent-%COMP%]{background:#ef4444}.legend-color.merged[_ngcontent-%COMP%]{background:#ff6b35}.detail[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm)}.table-suggestion-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm);padding:var(--gap-sm)}.table-suggestion-icon[_ngcontent-%COMP%]{font-size:var(--fs-md)}.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%}.table-card.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.overlay-disabled[_ngcontent-%COMP%]{position:absolute;inset:0;background:var(--background);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}"]})};export{Be as TableMap};
