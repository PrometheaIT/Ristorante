import{p as c,w as l}from"./chunk-L5SOXNIK.js";import{_ as n,da as u,f as r,m as o}from"./chunk-KZSY5CHT.js";var h=class i{supabaseService=u(l);router=u(c);currentUserSubject=new o(null);currentUser$=this.currentUserSubject.asObservable();authInitialized=!1;constructor(){this.initializeAuth()}initializeAuth(){return r(this,null,function*(){try{console.log("\u{1F504} Initializing auth...");let{data:{session:e}}=yield this.supabaseService.getSession();e?.user?(console.log("\u2705 Restored user from session:",e.user.id),this.currentUserSubject.next(e.user)):(console.log("\u274C No session found"),this.currentUserSubject.next(null))}catch(e){console.error("\u274C Error initializing auth:",e),this.currentUserSubject.next(null)}finally{this.authInitialized=!0,console.log("\u2705 Auth initialization complete")}})}register(e){return r(this,null,function*(){let t=yield this.supabaseService.signUp(e);return t.user&&!t.error&&(this.currentUserSubject.next(t.user),setTimeout(()=>{e.user_data.role==="restaurant_owner"?this.router.navigate(["/restaurant/dashboard"]):e.user_data.role==="supplier"?this.router.navigate(["/supplier/dashboard"]):this.router.navigate(["/customer"])},1e3)),t})}login(e,t,b=!1){return r(this,null,function*(){let{data:s,error:p}=yield this.supabaseService.signIn(e,t);return s.user&&(this.currentUserSubject.next(s.user),b&&localStorage.setItem("rememberMe","true"),setTimeout(()=>{let a=s.user.user_metadata?.role;["restaurant_owner","restaurant_manager","chef","waiter"].includes(a)?this.router.navigate(["/restaurant/dashboard"]):a==="supplier"?this.router.navigate(["/supplier/dashboard"]):this.router.navigate(["/customer"])},500)),{data:s,error:p}})}isRestaurantUser(){let e=this.currentUserSubject.getValue(),t=e?.user_metadata?.role??e?.role;return!!t&&["restaurant_owner","restaurant_manager","chef","waiter"].includes(t)}isCustomerUser(){let e=this.currentUserSubject.getValue();return(e?.user_metadata?.role??e?.role)==="customer"}logout(){return r(this,null,function*(){try{yield this.supabaseService.signOut()}catch(e){console.warn("Logout error",e)}this.currentUserSubject.next(null),this.router.navigate(["/login"])})}get currentUserValue(){return this.currentUserSubject.getValue()}isAuthenticated(){if(!this.authInitialized)return console.log("\u26A0\uFE0F Auth not yet initialized"),!1;let e=!!this.currentUserSubject.getValue();return console.log("\u{1F510} Authentication status:",e),e}waitForAuthInit(){return r(this,null,function*(){return this.authInitialized?!0:new Promise(e=>{let t=this.currentUser$.subscribe(()=>{t.unsubscribe(),e(!0)});setTimeout(()=>{t.unsubscribe(),e(!0)},2e3)})})}isSupplierUser(){let e=this.currentUserSubject.getValue();return(e?.user_metadata?.role??e?.role)==="supplier"}static \u0275fac=function(t){return new(t||i)};static \u0275prov=n({token:i,factory:i.\u0275fac,providedIn:"root"})};export{h as a};
