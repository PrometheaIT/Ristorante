import{b as c,d as f}from"./chunk-TB7INTC7.js";import{Y as u,ca as n}from"./chunk-5BU4UD4M.js";import{g as s}from"./chunk-RA2WU32H.js";var d=class i{supabaseService=n(c);authService=n(f);get client(){return this.supabaseService.getSupabaseClient()}isFollowing(r){return s(this,null,function*(){let e=this.authService.currentUserValue?.id;if(!e)return!1;let{data:t,error:o}=yield this.client.from("restaurant_followers").select("id").eq("user_id",e).eq("restaurant_id",r).maybeSingle();return!o&&!!t})}follow(r){return s(this,null,function*(){let e=this.authService.currentUserValue?.id;if(!e)return!1;let{error:t}=yield this.client.from("restaurant_followers").insert({user_id:e,restaurant_id:r});return!t})}unfollow(r){return s(this,null,function*(){let e=this.authService.currentUserValue?.id;if(!e)return!1;let{error:t}=yield this.client.from("restaurant_followers").delete().eq("user_id",e).eq("restaurant_id",r);return!t})}toggleFollow(r){return s(this,null,function*(){return(yield this.isFollowing(r))?(yield this.unfollow(r),!1):(yield this.follow(r),!0)})}getFollowedRestaurants(){return s(this,null,function*(){let r=this.authService.currentUserValue?.id;if(!r)return[];let{data:e,error:t}=yield this.client.from("restaurant_followers").select("restaurant_id").eq("user_id",r);return t?[]:(e||[]).map(o=>o.restaurant_id)})}getFollowerCount(r){return s(this,null,function*(){let{count:e,error:t}=yield this.client.from("restaurant_followers").select("id",{count:"exact",head:!0}).eq("restaurant_id",r);return t?0:e??0})}getFollowersForRestaurant(r){return s(this,null,function*(){let{data:e,error:t}=yield this.client.from("restaurant_followers").select("user_id, followed_at").eq("restaurant_id",r).order("followed_at",{ascending:!1});if(t)return console.error("\u274C getFollowersForRestaurant error:",t),[];if(!e?.length)return[];let o=e.map(a=>a.user_id),{data:w,error:l}=yield this.client.from("users").select("id, first_name, last_name, email").in("id",o);return l&&console.error("\u274C users fetch error:",l),e.map(a=>({user_id:a.user_id,followed_at:a.followed_at,users:w?.find(m=>m.id===a.user_id)||null}))})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"})};export{d as a};
