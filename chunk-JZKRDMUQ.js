import{a as ce}from"./chunk-KZCVCIMB.js";import{b as te,d as ie,h as ne,r as re,s as ae,x as se}from"./chunk-7VSFVQGQ.js";import{a as le,c as de}from"./chunk-UHPDC42X.js";import{a as oe}from"./chunk-4J5ZEMM4.js";import"./chunk-VQ7WJPK7.js";import"./chunk-QMR2VPJU.js";import"./chunk-IHSWM4ZR.js";import"./chunk-FBJM6ARG.js";import{c as J,d as Q,f as X,j as Z,m as ee}from"./chunk-VYE6ILYG.js";import{$a as h,A as $,Ab as q,B as V,Db as T,Eb as a,Fb as S,Ga as l,Gb as g,Hb as R,Jb as B,Kb as H,Lb as W,Qb as O,Rb as E,Sb as Y,Ub as A,Wa as N,_ as K,a as w,b as C,da as y,g as f,h as U,hb as u,ia as x,ib as r,ja as b,jb as n,kb as L,n as P,pb as k,sb as v,ub as p,zb as F}from"./chunk-3SWAHN2Y.js";var D=class s{statusConfig={waiting:{label:"In Attesa",color:"warning",icon:"schedule"},preparing:{label:"In Preparazione",color:"primary",icon:"kitchen"},ready:{label:"Pronto",color:"success",icon:"done"},served:{label:"Servito",color:"secondary",icon:"local_shipping"},out_of_stock:{label:"Esaurito",color:"danger",icon:"block"}};getStatusConfig(t){return this.statusConfig[t]||this.statusConfig.waiting}calculateElapsedTime(t){let e=new Date(t).getTime(),i=new Date().getTime();return Math.floor((i-e)/(1e3*60))}getPreparationTimeColor(t,e){let i=t/e*100;return i<50?"success":i<75?"warning":"danger"}formatTime(t){return new Date(t).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=K({token:s,factory:s.\u0275fac,providedIn:"root"})};var M=class s{validTransitions={waiting:["preparing","out_of_stock"],preparing:["ready","out_of_stock"],ready:["served"],served:[],out_of_stock:[]};canTransition(t,e){let i=this.validTransitions[t];return i?i.includes(e):!1}getNextValidStatuses(t){return this.validTransitions[t]||[]}static \u0275fac=function(e){return new(e||s)};static \u0275prov=K({token:s,factory:s.\u0275fac,providedIn:"root"})};var j=class s{orderService=y(de);dishService=y(oe);tableService=y(ce);kitchenUtils=y(D);orderStatusService=y(M);notificationService=y(le);kitchenOrderGroupsSubject=new P([]);kitchenOrderGroups$=this.kitchenOrderGroupsSubject.asObservable();kitchenOrdersSubject=new P([]);kitchenOrders$=this.kitchenOrdersSubject.asObservable();statusFilterSubject=new P("all");searchTermSubject=new P("");filteredOrders$;filteredGroups$;stats$;constructor(){this.filteredOrders$=V([this.kitchenOrders$,this.statusFilterSubject,this.searchTermSubject]).pipe($(([t,e,i])=>this.applyFilters(t,e,i))),this.filteredGroups$=V([this.kitchenOrderGroups$,this.statusFilterSubject,this.searchTermSubject]).pipe($(([t,e,i])=>this.applyGroupFilters(t,e,i))),this.stats$=this.kitchenOrderGroups$.pipe($(t=>this.calculateStats(t))),this.loadKitchenData()}loadKitchenData(){return f(this,null,function*(){try{console.log("\u{1F504} Loading kitchen data..."),yield Promise.all([this.loadActiveKitchenOrderGroups(),this.dishService.loadData(),this.tableService.loadData()]),console.log("\u2705 Kitchen data loaded successfully")}catch(t){console.error("\u{1F4A5} Error loading kitchen data:",t)}})}loadActiveKitchenOrderGroups(){return f(this,null,function*(){try{let t=yield this.orderService.getActiveOrderHeadersForKitchen();if(!t||t.length===0){this.kitchenOrderGroupsSubject.next([]),this.kitchenOrdersSubject.next([]);return}let e=[],i=[];for(let o of t){let c=yield this.getTableById(o.table_id),d=[];if(o.orders&&o.orders.length>0)for(let I of o.orders){let G=yield this.transformOrderForKitchen(I,o,c);d.push(G),i.push(G)}let _=this.calculateGroupStatusSummary(d),m={order_header_id:o.id,order_header_number:o.order_number,table_id:o.table_id,table_number:c?.table_number||"N/A",created_at:o.created_at,comande:d.sort((I,G)=>(I.comanda_number||0)-(G.comanda_number||0)),status_summary:_};e.push(m)}e.sort((o,c)=>new Date(o.created_at).getTime()-new Date(c.created_at).getTime()),this.kitchenOrderGroupsSubject.next(e),this.kitchenOrdersSubject.next(i)}catch(t){console.error("\u274C Error loading kitchen order groups:",t),this.kitchenOrderGroupsSubject.next([]),this.kitchenOrdersSubject.next([])}})}updateItemStatus(t,e){return f(this,null,function*(){try{return this.orderStatusService.canTransition(t.status,e)?(yield this.orderService.updateOrderItemStatus(t.id,e))?(this.updateLocalItemStatus(t.id,e),e==="out_of_stock"&&(yield this.markDishAsOutOfStock(t.dish_id)),this.notificationService.notifyOrderUpdate(t.order_id),yield this.loadActiveKitchenOrderGroups(),!0):!1:(console.warn(`\u274C Transizione non valida da ${t.status} a ${e}`),!1)}catch(i){return console.error("\u274C Error updating item status:",i),!1}})}setStatusFilter(t){this.statusFilterSubject.next(t)}setSearchTerm(t){this.searchTermSubject.next(t)}transformOrderForKitchen(t,e,i){return f(this,null,function*(){let o=t.order_items||[],c=o.map(m=>{let I=this.getDishById(m.dish_id)||m.dishes;return{id:m.id,dish_id:m.dish_id,dish_name:m.dish_name||I?.name||"Piatto sconosciuto",quantity:m.quantity,status:m.status||"waiting",order_id:t.id,order_header_id:e.id,table_number:i?.table_number||"N/A",table_id:t.table_id,comanda_number:t.comanda_number||1,preparation_time:I?.preparation_time||15,elapsed_time:this.kitchenUtils.calculateElapsedTime(m.created_at||t.created_at),notes:m.item_notes,created_at:m.created_at||t.created_at}}),d=this.calculateOrderProgress(o),_=this.orderService.calculateOverallOrderStatus(o);return{id:t.id,order_header_id:e.id,order_number:e.order_number,comanda_number:t.comanda_number||1,table_id:t.table_id,table_number:i?.table_number||"N/A",status:_,items:c,created_at:t.created_at,total_items:d.total,completed_items:d.completed,progress_percentage:d.percentage}})}calculateGroupStatusSummary(t){let e={waiting:0,preparing:0,ready:0,served:0,out_of_stock:0};return t.forEach(i=>{i.items.forEach(o=>{e.hasOwnProperty(o.status)&&(e[o.status]+=o.quantity)})}),e}applyFilters(t,e,i){let o=t;if(e!=="all"&&(o=o.filter(c=>c.status===e)),i){let c=i.toLowerCase();o=o.filter(d=>d.order_number.toLowerCase().includes(c)||d.table_number.toLowerCase().includes(c)||`comanda ${d.comanda_number}`.includes(c)||d.items.some(_=>_.dish_name.toLowerCase().includes(c)))}return o.filter(c=>c.items.some(d=>d.status!=="served"&&d.status!=="out_of_stock"))}applyGroupFilters(t,e,i){let o=t;if(e!=="all"&&(o=o.filter(c=>c.comande.some(d=>d.status===e))),i){let c=i.toLowerCase();o=o.filter(d=>d.order_header_number.toLowerCase().includes(c)||d.table_number.toLowerCase().includes(c)||d.comande.some(_=>`comanda ${_.comanda_number}`.includes(c)||_.items.some(m=>m.dish_name.toLowerCase().includes(c))))}return o.filter(c=>c.comande.some(d=>d.items.some(_=>_.status!=="served"&&_.status!=="out_of_stock")))}calculateStats(t){let e=0,i=0,o=0;t.forEach(d=>{d.comande.forEach(_=>{_.items.forEach(m=>{m.status==="waiting"?e+=m.quantity:m.status==="preparing"?i+=m.quantity:m.status==="ready"&&(o+=m.quantity)})})});let c=t.filter(d=>d.comande.some(_=>_.items.some(m=>m.status!=="served"&&m.status!=="out_of_stock"))).length;return{waiting:e,preparing:i,ready:o,totalActive:c,totalGroups:t.length}}updateLocalItemStatus(t,e){let o=this.kitchenOrdersSubject.value.map(_=>C(w({},_),{items:_.items.map(m=>m.id===t?C(w({},m),{status:e}):m)}));this.kitchenOrdersSubject.next(o);let d=this.kitchenOrderGroupsSubject.value.map(_=>C(w({},_),{comande:_.comande.map(m=>C(w({},m),{items:m.items.map(I=>I.id===t?C(w({},I),{status:e}):I)}))}));this.kitchenOrderGroupsSubject.next(d)}markDishAsOutOfStock(t){return f(this,null,function*(){try{yield this.dishService.updateDish(t,{status:"out_of_stock"})}catch(e){console.error("\u274C Error marking dish as out of stock:",e)}})}calculateOrderProgress(t){let e=t.filter(d=>!["out_of_stock","cancelled"].includes(d.status)),i=e.filter(d=>["ready","served"].includes(d.status)).length,o=e.length,c=o>0?Math.round(i/o*100):0;return{completed:i,total:o,percentage:c}}getTableById(t){return f(this,null,function*(){try{return this.tableService.data.find(i=>i.id===t)}catch(e){return console.error("\u274C Error getting table:",e),null}})}getDishById(t){return this.dishService.data.find(i=>i.id===t)}getRecipeDetails(t){let e=this.getDishById(t);return{ingredients:e?.ingredients_composition||[],instructions:e?.recipe_instructions||""}}static \u0275fac=function(e){return new(e||s)};static \u0275prov=K({token:s,factory:s.\u0275fac,providedIn:"root"})};function me(s,t){s&1&&(r(0,"div",33)(1,"span",20),a(2,"restaurant_menu"),n(),r(3,"h3"),a(4,"Nessun ordine attivo"),n(),r(5,"p",7),a(6,"Tutti gli ordini sono stati completati"),n()())}function ue(s,t){if(s&1&&(r(0,"span",49),a(1),n()),s&2){let e=p().$implicit;l(),g(" \u23F3 ",e.status_summary.waiting," in attesa ")}}function _e(s,t){if(s&1&&(r(0,"span",50),a(1),n()),s&2){let e=p().$implicit;l(),g(" \u{1F468}\u200D\u{1F373} ",e.status_summary.preparing," in preparazione ")}}function ge(s,t){if(s&1&&(r(0,"span",51),a(1),n()),s&2){let e=p().$implicit;l(),g(" \u2705 ",e.status_summary.ready," pronto ")}}function he(s,t){if(s&1&&(r(0,"span",83),a(1),n()),s&2){let e=p().$implicit,i=p(5);l(),g(" (",e.preparation_time-i.getElapsedTime(e)," min rim.) ")}}function ve(s,t){if(s&1&&(r(0,"div",84)(1,"p",85),a(2),n()()),s&2){let e=p().$implicit;l(2),S(e.notes)}}function fe(s,t){if(s&1){let e=k();r(0,"button",28),v("click",function(){x(e);let o=p().$implicit,c=p(5);return b(c.quickUpdateItemStatus(o,"preparing"))}),r(1,"span",20),a(2,"play_arrow"),n(),a(3," Inizia "),n()}}function xe(s,t){if(s&1){let e=k();r(0,"button",28),v("click",function(){x(e);let o=p().$implicit,c=p(5);return b(c.quickUpdateItemStatus(o,"ready"))}),r(1,"span",20),a(2,"check"),n(),a(3," Pronto "),n()}}function be(s,t){if(s&1){let e=k();r(0,"button",28),v("click",function(){x(e);let o=p().$implicit,c=p(5);return b(c.quickUpdateItemStatus(o,"served"))}),r(1,"span",20),a(2,"local_shipping"),n(),a(3," Servito "),n()}}function ye(s,t){if(s&1){let e=k();r(0,"div",9)(1,"div",64)(2,"div",65)(3,"div",66)(4,"div",67)(5,"span",68),a(6),n(),r(7,"span",57),a(8),n(),r(9,"span",69),a(10),n(),r(11,"span",70),a(12),n()(),r(13,"div",71)(14,"span")(15,"span",20),a(16,"schedule"),n(),a(17),n(),h(18,he,2,1,"span",72),n()()(),h(19,ve,3,1,"div",73),r(20,"div",74)(21,"div",75),h(22,fe,4,0,"button",76)(23,xe,4,0,"button",76)(24,be,4,0,"button",76),r(25,"button",77),v("click",function(){let o=x(e).$implicit,c=p(5);return b(c.openRecipeModal(o))}),r(26,"span",20),a(27,"menu_book"),n()(),r(28,"button",78),v("click",function(){let o=x(e).$implicit,c=p(5);return b(c.markItemAsOutOfStock(o))}),r(29,"span",20),a(30,"block"),n()()(),r(31,"div",79)(32,"select",80),v("change",function(o){let c=x(e).$implicit,d=p(5);return b(d.updateItemStatus(c,o))}),r(33,"option",23),a(34,"Attesa"),n(),r(35,"option",24),a(36,"Preparazione"),n(),r(37,"option",25),a(38,"Pronto"),n(),r(39,"option",81),a(40,"Servito"),n(),r(41,"option",82),a(42,"Esaurito"),n()()()()()()}if(s&2){let e=t.$implicit,i=p(5);T("status-"+e.status),l(6),g("",e.quantity,"\xD7"),l(2),S(e.dish_name),l(2),g("Tav.",e.table_number),l(),T(i.getStatusColor(e.status)),l(),g(" ",i.getStatusShortText(e.status)," "),l(5),R(" ",i.getElapsedTimeCached(e),"/",e.preparation_time,"min "),l(),u("ngIf",e.status==="preparing"),l(),u("ngIf",e.notes),l(3),u("ngIf",e.status==="waiting"),l(),u("ngIf",e.status==="preparing"),l(),u("ngIf",e.status==="ready"),l(8),u("value",e.status)}}function Se(s,t){if(s&1&&(r(0,"div",62)(1,"div",8),h(2,ye,43,16,"div",63),n()()),s&2){let e=p().$implicit;l(2),u("ngForOf",e.items)}}function Ie(s,t){if(s&1){let e=k();r(0,"div",55)(1,"div",56),v("click",function(){let o=x(e).index,c=p(2).$implicit,d=p();return b(d.toggleComandaExpansion(c.order_header_id,o))}),r(2,"div",40)(3,"span",20),a(4),n(),r(5,"span",57),a(6),n(),r(7,"span",41),a(8),n()(),r(9,"div",40)(10,"span",58),a(11),n(),r(12,"div",59),L(13,"div",60),n()()(),h(14,Se,3,1,"div",61),n()}if(s&2){let e=t.$implicit,i=t.index,o=p(2).$implicit,c=p();l(4),g(" ",c.isComandaExpanded(o.order_header_id,i)?"expand_less":"expand_more"," "),l(2),g("Comanda ",i+1),l(),T(c.getStatusColor(e.status)),l(),g(" ",c.getStatusText(e.status)," "),l(3),R("",e.completed_items,"/",e.total_items),l(2),T(c.getStatusColor(e.status)+"-bg"),q("width",e.progress_percentage,"%"),l(),u("ngIf",c.isComandaExpanded(o.order_header_id,i))}}function ke(s,t){if(s&1){let e=k();r(0,"div",86)(1,"button",87),v("click",function(){x(e);let o=p(2).$implicit,c=p();return b(c.markAllComandeAsReady(o))}),r(2,"span",20),a(3,"done_all"),n(),a(4," Segna tutto l'ordine come pronto "),n()()}if(s&2){let e=p(2).$implicit,i=p();l(),u("disabled",i.isGroupAllReady(e))}}function Oe(s,t){if(s&1&&(r(0,"div",52),h(1,Ie,15,12,"div",53)(2,ke,5,1,"div",54),n()),s&2){let e=p().$implicit,i=p();l(),u("ngForOf",e.comande),l(),u("ngIf",i.hasItemsInGroup(e))}}function Ee(s,t){if(s&1){let e=k();r(0,"div",15)(1,"div",34),v("click",function(){let o=x(e).$implicit,c=p();return b(c.toggleGroupExpansion(o.order_header_id))}),r(2,"div",35)(3,"div",36)(4,"span",37),a(5,"table_restaurant"),n(),r(6,"h2",38),a(7),r(8,"span",39),a(9),n()()(),r(10,"div",40)(11,"span",41),a(12),n(),r(13,"span",42),a(14),n()()(),r(15,"div",43)(16,"span",44)(17,"span",20),a(18,"schedule"),n(),a(19),n(),r(20,"span",44)(21,"span",20),a(22,"list_alt"),n(),a(23),n(),h(24,ue,2,1,"span",45)(25,_e,2,1,"span",46)(26,ge,2,1,"span",47),n()(),h(27,Oe,3,2,"div",48),n()}if(s&2){let e=t.$implicit,i=p();l(7),g(" Tavolo ",e.table_number," "),l(2),g(" Ordine: ",e.order_header_number),l(2),T(i.getGroupStatusColor(e)),l(),g(" ",i.getGroupStatusText(e)," "),l(2),g(" ",i.isGroupExpanded(e.order_header_id)?"expand_less":"expand_more"," "),l(5),g(" ",i.formatTime(e.created_at)," "),l(4),g(" ",e.comande.length," comanda(e) "),l(),u("ngIf",e.status_summary.waiting>0),l(),u("ngIf",e.status_summary.preparing>0),l(),u("ngIf",e.status_summary.ready>0),l(),u("ngIf",i.isGroupExpanded(e.order_header_id))}}function we(s,t){if(s&1&&(r(0,"span",97),a(1),n()),s&2){let e=p(2);l(),g(" ",e.selectedRecipeItem.preparation_time," min ")}}function Ce(s,t){if(s&1&&(r(0,"div",109),a(1),O(2,"number"),n()),s&2){let e=p().$implicit;l(),g(" \u20AC",Y(2,1,e.cost,"1.2-2")," ")}}function Ke(s,t){if(s&1&&(r(0,"div",29)(1,"label",19)(2,"span",20),a(3,"notes"),n(),a(4," Note di preparazione: "),n(),r(5,"p",106),a(6),n()()),s&2){let e=p().$implicit;l(6),S(e.notes)}}function Te(s,t){if(s&1&&(r(0,"div",9)(1,"div",104)(2,"div")(3,"strong",105),a(4),n(),r(5,"div",106),a(6),n()(),h(7,Ce,3,4,"div",107),n(),h(8,Ke,7,1,"div",108),n()),s&2){let e=t.$implicit;l(4),S(e.name||"Ingrediente"),l(2),R(" ",e.quantity||0," ",e.unit||""," "),l(),u("ngIf",e.cost>0),l(),u("ngIf",e.notes)}}function De(s,t){if(s&1&&(r(0,"div",8),h(1,Te,9,5,"div",103),n()),s&2){let e=p(3);l(),u("ngForOf",e.getRecipeDetails().ingredients)}}function Me(s,t){s&1&&(r(0,"div",110)(1,"span",111),a(2,"info"),n(),r(3,"p",7),a(4,"Nessun ingrediente definito per questo piatto"),n()())}function Pe(s,t){if(s&1&&(r(0,"div",9)(1,"div",10)(2,"span",20),a(3,"menu_book"),n(),r(4,"h3",12),a(5,"Istruzioni di Preparazione"),n()(),r(6,"p",7),a(7),n()()),s&2){let e=p(3);l(7),S(e.getRecipeDetails().instructions)}}function Ge(s,t){s&1&&(r(0,"div",112)(1,"span",111),a(2,"info"),n(),r(3,"p",7),a(4,"Nessuna istruzione di preparazione disponibile"),n()())}function $e(s,t){if(s&1&&(r(0,"div")(1,"div",98)(2,"div",10)(3,"span",20),a(4,"list_alt"),n(),r(5,"h3",12),a(6,"Ingredienti"),n(),r(7,"span",99),a(8),n()(),h(9,De,2,1,"div",100)(10,Me,5,0,"ng-template",null,1,A),n(),h(12,Pe,8,1,"div",101)(13,Ge,5,0,"div",102),n()),s&2){let e=F(11),i=p(2);l(8),S(i.getRecipeDetails().ingredients.length||0),l(),u("ngIf",i.getRecipeDetails().ingredients&&i.getRecipeDetails().ingredients.length>0)("ngIfElse",e),l(3),u("ngIf",i.getRecipeDetails().instructions),l(),u("ngIf",!i.getRecipeDetails().instructions)}}function Re(s,t){s&1&&(r(0,"div",113)(1,"span",111),a(2,"info"),n(),r(3,"p",7),a(4,"Nessuna ricetta disponibile per questo piatto"),n()())}function je(s,t){if(s&1){let e=k();r(0,"div",88),v("click",function(){x(e);let o=p();return b(o.closeRecipeModal())}),r(1,"div",89),v("click",function(o){return x(e),b(o.stopPropagation())}),r(2,"div",90)(3,"h2",91)(4,"span",20),a(5,"menu_book"),n(),a(6),h(7,we,2,1,"span",92),n(),r(8,"button",93),v("click",function(){x(e);let o=p();return b(o.closeRecipeModal())}),r(9,"span",20),a(10,"close"),n()()(),r(11,"div",94),h(12,$e,14,5,"div",95)(13,Re,5,0,"ng-template",null,0,A),n(),r(15,"div",96)(16,"button",28),v("click",function(){x(e);let o=p();return b(o.closeRecipeModal())}),r(17,"span",20),a(18,"close"),n(),a(19," Chiudi "),n()()()()}if(s&2){let e=F(14),i=p();l(6),g(" Ricetta - ",i.selectedRecipeItem==null?null:i.selectedRecipeItem.dish_name," "),l(),u("ngIf",i.selectedRecipeItem),l(5),u("ngIf",i.selectedRecipeItem)("ngIfElse",e)}}var pe=class s{kitchenService=y(j);kitchenUtils=y(D);orderStatusService=y(M);statusFilter="all";elapsedTimeMap=new Map;elapsedTimeUpdates=new Map;filteredGroups$=this.kitchenService.filteredGroups$;stats$=this.kitchenService.stats$;searchTerm="";showRecipeModal=!1;selectedRecipeItem=null;expandedGroups={};expandedComande={};subscriptions=new U;ngOnInit(){console.log("\u{1F3C1} KitchenDisplay initialized"),this.subscriptions.add(this.kitchenService.kitchenOrderGroups$.subscribe(t=>{console.log("\u{1F4E6} Kitchen order groups updated:",t.length),t.forEach(e=>{e.order_header_id in this.expandedGroups||(this.expandedGroups[e.order_header_id]=!0),e.comande.forEach(i=>{let o=`${e.order_header_id}-${i.comanda_number}`;o in this.expandedComande||(this.expandedComande[o]=!0)})})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}updateItemStatus(t,e){return f(this,null,function*(){let i;if(typeof e=="string"?i=e:i=e.target.value,!["waiting","preparing","ready","served","out_of_stock"].includes(i)){console.error("\u274C Stato non valido:",i);return}console.log(`\u{1F504} Aggiornamento stato: ${t.dish_name} da ${t.status} a ${i}`);try{yield this.kitchenService.updateItemStatus(t,i)}catch(c){console.error("\u274C Errore nell'aggiornamento dello stato:",c),alert("Errore durante l'aggiornamento dello stato")}})}quickUpdateItemStatus(t,e){return f(this,null,function*(){console.log(`\u26A1 Aggiornamento rapido: ${t.dish_name} a ${e}`);try{yield this.kitchenService.updateItemStatus(t,e)}catch(i){console.error("\u274C Errore nell'aggiornamento rapido:",i),alert("Errore durante l'aggiornamento dello stato")}})}markComandaAsReady(t){return f(this,null,function*(){for(let e of t.items)e.status!=="served"&&e.status!=="out_of_stock"&&(yield this.kitchenService.updateItemStatus(e,"ready"))})}markItemAsOutOfStock(t){return f(this,null,function*(){yield this.kitchenService.updateItemStatus(t,"out_of_stock")})}onStatusFilterChange(t){this.kitchenService.setStatusFilter(t)}onSearchChange(){this.kitchenService.setSearchTerm(this.searchTerm)}toggleGroupExpansion(t){this.expandedGroups[t]=!this.expandedGroups[t]}toggleComandaExpansion(t,e){let i=`${t}-${e}`;this.expandedComande[i]=!this.expandedComande[i]}isGroupExpanded(t){return this.expandedGroups[t]!==!1}isComandaExpanded(t,e){let i=`${t}-${e}`;return this.expandedComande[i]!==!1}openRecipeModal(t){this.selectedRecipeItem=t,this.showRecipeModal=!0}closeRecipeModal(){this.selectedRecipeItem=null,this.showRecipeModal=!1}getRecipeDetails(){return this.selectedRecipeItem?this.kitchenService.getRecipeDetails(this.selectedRecipeItem.dish_id):{ingredients:[],instructions:""}}getStatusText(t){return this.kitchenUtils.getStatusConfig(t).label}getStatusShortText(t){return{waiting:"Attesa",preparing:"Prep.",ready:"Pronto",served:"Servito",out_of_stock:"Esaurito"}[t]||t}getStatusColor(t){return this.kitchenUtils.getStatusConfig(t).color}getPreparationTimeColor(t,e){return this.kitchenUtils.getPreparationTimeColor(t,e)}formatTime(t){return this.kitchenUtils.formatTime(t)}getNextValidStatuses(t){return this.orderStatusService.getNextValidStatuses(t)}getElapsedTime(t){return this.kitchenUtils.calculateElapsedTime(t.created_at)}forceRefresh(){return f(this,null,function*(){yield this.kitchenService.loadKitchenData()})}getTotalItemsInGroup(t){return t.comande.reduce((e,i)=>e+i.items.length,0)}getGroupStatusColor(t){return t.status_summary.waiting>0?"warning":t.status_summary.preparing>0?"primary":t.status_summary.ready>0?"success":"secondary"}getGroupStatusText(t){return t.status_summary.waiting>0?"In Attesa":t.status_summary.preparing>0?"In Preparazione":t.status_summary.ready>0?"Pronto":"Servito"}markAllComandeAsReady(t){return f(this,null,function*(){try{console.log(`\u{1F504} Segnando tutto l'ordine ${t.order_header_number} come pronto...`);for(let e of t.comande)for(let i of e.items)i.status==="served"||i.status==="out_of_stock"||(i.status==="waiting"&&(yield this.kitchenService.updateItemStatus(i,"preparing")),yield this.kitchenService.updateItemStatus(i,"ready"),yield new Promise(o=>setTimeout(o,50)));console.log(`\u2705 Ordine ${t.order_header_number} segnato come pronto`)}catch(e){console.error("\u274C Errore durante la marcatura dell'ordine come pronto:",e),alert("Si \xE8 verificato un errore durante l'operazione")}})}hasItemsInGroup(t){return t.comande.some(e=>e.items&&e.items.length>0)}isGroupAllReady(t){return t.comande.every(e=>e.status==="ready"||e.status==="served")}getElapsedTimeCached(t){let e=t.id;if(!this.elapsedTimeMap.has(e)){let c=this.kitchenUtils.calculateElapsedTime(t.created_at);return this.elapsedTimeMap.set(e,c),c}let i=Date.now(),o=this.elapsedTimeUpdates.get(e)||0;if(i-o>6e4){let c=this.kitchenUtils.calculateElapsedTime(t.created_at);this.elapsedTimeMap.set(e,c),this.elapsedTimeUpdates.set(e,i)}return this.elapsedTimeMap.get(e)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=N({type:s,selectors:[["app-kitchen-display"]],decls:88,vars:21,consts:[["noRecipe",""],["noIngredients",""],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"text-muted","card-footer"],[1,"form-card","mt-lg"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-end","gap-sm"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"material-icons"],[3,"change","value"],["value","all"],["value","waiting"],["value","preparing"],["value","ready"],["type","text","placeholder","Ordine, tavolo, piatto...",3,"ngModelChange","ngModel"],[1,"modal-footer","p-md0"],[1,"promethea-button",3,"click"],[1,"mt-lg"],["class","empty-state",4,"ngIf"],["class","form-card mt-lg",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"empty-state"],[1,"flex","flex-col","gap-sm",2,"cursor","pointer",3,"click"],[1,"flex","justify-between","items-center"],[1,"flex","gap-sm","items-center"],[1,"material-icons","text-lg"],[1,"section-title","m-0","flex","items-center","gap-sm"],[1,"chip","ml-md","text-mini",2,"display","none"],[1,"flex","items-center","gap-sm"],[1,"chip"],[1,"material-icons","text-md"],[1,"flex","flex-wrap","gap-sm","mt-sm"],[1,"chip","bg-smoke"],["class","chip warning",4,"ngIf"],["class","chip primary",4,"ngIf"],["class","chip success",4,"ngIf"],["class","mt-md",4,"ngIf"],[1,"chip","warning"],[1,"chip","primary"],[1,"chip","success"],[1,"mt-md"],["class","mb-lg",4,"ngFor","ngForOf"],["class","modal-footer p-md0 mt-lg",4,"ngIf"],[1,"mb-lg"],[1,"flex","justify-between","items-center","m-sm02","p-sm","rounded","bg-smoke","cursor-pointer",3,"click"],[1,"font-semibold"],[1,"text-sm","font-semibold"],[1,"progress-bar",2,"width","100px"],[1,"progress-fill"],["class","mt-sm",4,"ngIf"],[1,"mt-sm"],["class","card",3,"class",4,"ngFor","ngForOf"],[1,"card-body"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"flex","items-center","gap-sm","mb-sm","text-md"],[1,"font-bold","text-primary"],[1,"chip","text-mini","bg-smoke"],[1,"chip","text-mini"],[1,"flex","items-center","gap-sm","flex-wrap"],["class","text-mini text-primary",4,"ngIf"],["class","item-notes mt-xs p-xs rounded bg-smoke",4,"ngIf"],[1,"flex","flex-wrap","justify-between","flex-col"],[1,"flex","gap-sm","p-sm"],["class","promethea-button",3,"click",4,"ngIf"],["title","Ricetta",1,"promethea-button","ghost",3,"click"],["title","Esaurito",1,"promethea-button","ghost",3,"click"],[1,"flex","flex-wrap","gap-xs"],[1,"status-select","text-mini",2,"min-width","120px","padding","4px 8px",3,"change","value"],["value","served"],["value","out_of_stock"],[1,"text-mini","text-primary"],[1,"item-notes","mt-xs","p-xs","rounded","bg-smoke"],[1,"text-muted","text-mini"],[1,"modal-footer","p-md0","mt-lg"],[1,"promethea-button",3,"click","disabled"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"section-title","m-0"],["class","chip active ml-md",4,"ngIf"],["type","button",1,"icon-button",3,"click"],[1,"modal-content"],[4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"chip","active","ml-md"],[1,"card","mb-lg"],[1,"chip","active"],["class","grid-cards",4,"ngIf","ngIfElse"],["class","card",4,"ngIf"],["class","card text-center p-md",4,"ngIf"],["class","card",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","mb-sm"],[1,"text-md"],[1,"text-muted","text-sm","mt-1"],["class","text-primary font-semibold",4,"ngIf"],["class","mt-lg",4,"ngIf"],[1,"text-primary","font-semibold"],[1,"text-center","p-md"],[1,"material-icons","text-muted"],[1,"card","text-center","p-md"],[1,"card","text-center","p-xl"]],template:function(e,i){if(e&1&&(r(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),a(4,"restaurant"),n(),r(5,"h1",6),a(6,"Display Cucina"),n()(),r(7,"p",7),a(8,"Gestisci gli ordini raggruppati per comanda"),n()(),r(9,"div",8)(10,"div",9)(11,"div",10)(12,"span",11),a(13,"schedule"),n(),r(14,"h3",12),a(15,"In Attesa"),n()(),r(16,"div",13),a(17),O(18,"async"),n(),r(19,"span",14),a(20,"Piatti in attesa"),n()(),r(21,"div",9)(22,"div",10)(23,"span",11),a(24,"kitchen"),n(),r(25,"h3",12),a(26,"In Preparazione"),n()(),r(27,"div",13),a(28),O(29,"async"),n(),r(30,"span",14),a(31,"Piatti in preparazione"),n()(),r(32,"div",9)(33,"div",10)(34,"span",11),a(35,"done"),n(),r(36,"h3",12),a(37,"Pronti"),n()(),r(38,"div",13),a(39),O(40,"async"),n(),r(41,"span",14),a(42,"Piatti pronti"),n()(),r(43,"div",9)(44,"div",10)(45,"span",11),a(46,"list_alt"),n(),r(47,"h3",12),a(48,"Ordini Attivi"),n()(),r(49,"div",13),a(50),O(51,"async"),n(),r(52,"span",14),a(53,"Gruppi attivi"),n()()(),r(54,"div",15)(55,"div",16)(56,"div",17)(57,"div",18)(58,"label",19)(59,"span",20),a(60,"filter_list"),n(),a(61," Stato: "),n(),r(62,"select",21),v("change",function(c){return i.onStatusFilterChange(c.target.value)}),r(63,"option",22),a(64,"Tutti gli ordini"),n(),r(65,"option",23),a(66,"In Attesa"),n(),r(67,"option",24),a(68,"In Preparazione"),n(),r(69,"option",25),a(70,"Pronti"),n()()(),r(71,"div",18)(72,"label",19)(73,"span",20),a(74,"search"),n(),a(75," Cerca: "),n(),r(76,"input",26),W("ngModelChange",function(c){return H(i.searchTerm,c)||(i.searchTerm=c),c}),v("ngModelChange",function(){return i.onSearchChange()}),n()()(),r(77,"div",27)(78,"button",28),v("click",function(){return i.forceRefresh()}),r(79,"span",20),a(80,"refresh"),n(),a(81," Aggiorna "),n()()()(),r(82,"div",29),h(83,me,7,0,"div",30),O(84,"async"),h(85,Ee,28,12,"div",31),O(86,"async"),n()(),h(87,je,20,4,"div",32)),e&2){let o,c,d,_,m;l(17),S(((o=E(18,9,i.stats$))==null?null:o.waiting)||0),l(11),S(((c=E(29,11,i.stats$))==null?null:c.preparing)||0),l(11),S(((d=E(40,13,i.stats$))==null?null:d.ready)||0),l(11),S(((_=E(51,15,i.stats$))==null?null:_.totalGroups)||0),l(12),u("value",i.statusFilter),l(14),B("ngModel",i.searchTerm),l(7),u("ngIf",((m=E(84,17,i.filteredGroups$))==null?null:m.length)===0),l(2),u("ngForOf",E(86,19,i.filteredGroups$)),l(2),u("ngIf",i.showRecipeModal)}},dependencies:[ee,J,Q,se,re,ae,te,ie,ne,X,Z],styles:[".order-card[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.2,.9,.2,1)}.order-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px var(--shadow-2)}.order-progress[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:var(--gap-sm)}.progress-fill[_ngcontent-%COMP%]{height:100%;border-radius:4px;transition:width .3s ease}.progress-fill.waiting-bg[_ngcontent-%COMP%]{background:var(--secondary)}.progress-fill.preparing-bg[_ngcontent-%COMP%]{background:var(--primary)}.progress-fill.ready-bg[_ngcontent-%COMP%]{background:#10b981}.item-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:var(--gap-sm)}.item-name[_ngcontent-%COMP%]{font-size:var(--fs-md);line-height:1.2;font-weight:700}.item-header[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;gap:var(--gap-sm);justify-content:space-between}.item-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm);padding:var(--gap-sm);min-width:200px}.chip.waiting[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--secondary) 20%,transparent);color:var(--secondary)}.chip.preparing[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 20%,transparent);color:var(--primary)}.chip.ready[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.served[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.chip.time-normal[_ngcontent-%COMP%]{background:var(--smoke-1)}.chip.time-warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.chip.time-critical[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 20%,transparent);color:#ef4444}.promethea-button.small[_ngcontent-%COMP%]{padding:var(--gap-sm) var(--gap-md);font-size:.875rem;min-height:36px}.modal-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto}.modal-lg[_ngcontent-%COMP%]{max-width:800px}@media (max-width: 768px){.item-actions[_ngcontent-%COMP%]{align-items:stretch;min-width:auto}.item-actions[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{justify-content:space-between}.order-progress[_ngcontent-%COMP%]{min-width:auto}.modal-lg[_ngcontent-%COMP%]{margin:var(--gap-md);max-width:calc(100vw - 2 * var(--gap-md))}}@media (max-width: 480px){.promethea-button.small[_ngcontent-%COMP%]{padding:8px 12px;font-size:.8rem}.promethea-button.small[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px}.grid-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}}.rotate-90[_ngcontent-%COMP%]{transform:rotate(90deg);transition:transform .3s ease}.order-progress[_ngcontent-%COMP%]{min-width:200px}.progress-bar[_ngcontent-%COMP%]{width:100%;height:8px;background:var(--smoke-1);border-radius:4px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s ease}.warning-bg[_ngcontent-%COMP%]{background:#ff9800}.primary-bg[_ngcontent-%COMP%]{background:#2196f3}.success-bg[_ngcontent-%COMP%]{background:#4caf50}.secondary-bg[_ngcontent-%COMP%]{background:#9c27b0}.card-body[_ngcontent-%COMP%]{justify-content:space-between;flex-wrap:wrap}.card[_ngcontent-%COMP%]{overflow:hidden}"]})};export{pe as KitchenDisplay};
