import{a as A}from"./chunk-6SRTQ6XE.js";import{a as q}from"./chunk-CBBEHQ7F.js";import{b as W,d as D,h as F,q as O,r as P,s as N,v as B,x as L}from"./chunk-XXXLA76A.js";import"./chunk-GS53O7WG.js";import"./chunk-EBEBQMEP.js";import"./chunk-N3KHNVQY.js";import{d as V,e as k,n as z}from"./chunk-I5JNAJO4.js";import{Eb as h,Hb as v,Jb as d,Oa as s,Ob as T,Qb as R,Tb as n,Ub as S,Vb as w,Wb as y,Yb as g,Zb as f,_b as x,bc as I,cb as E,g as b,h as M,hb as p,la as C,qa as m,ra as u,vb as _,wb as t,xb as i}from"./chunk-HCHBVVTJ.js";var H=()=>[1,2,3,4,5,6,7,8,9,10];function J(l,a){if(l&1){let e=h();t(0,"div",28)(1,"span",5),n(2,"error"),i(),n(3),t(4,"button",29),v("click",function(){m(e);let r=d();return u(r.error=null)}),t(5,"span",5),n(6,"close"),i()()()}if(l&2){let e=d();s(3),w(" ",e.error," ")}}function K(l,a){l&1&&(t(0,"div",30)(1,"span",6),n(2,"Caricamento prenotazioni..."),i()())}function Q(l,a){if(l&1&&(t(0,"div",44),n(1),i()),l&2){let e=d().$implicit;s(),w(" ",e.customer_email," ")}}function U(l,a){if(l&1&&(t(0,"option",50),n(1),i()),l&2){let e=a.$implicit,o=d(3).$implicit;_("value",e.id)("disabled",e.capacity<o.party_size),s(),y(" ",e.table_name," (",e.capacity," posti) ")}}function X(l,a){if(l&1){let e=h();t(0,"select",47,0),v("change",function(){m(e);let r=T(1),c=d(2).$implicit,G=d(3);return u(G.assignTable(c.id,r.value))}),t(2,"option",48),n(3,"Assegna tavolo..."),i(),p(4,U,2,4,"option",49),i()}if(l&2){let e=d(5);s(4),_("ngForOf",e.tables)}}function Y(l,a){if(l&1){let e=h();t(0,"button",51),v("click",function(){m(e);let r=d(2).$implicit,c=d(3);return u(c.unassignTable(r.id))}),t(1,"span",5),n(2,"close"),i()()}}function Z(l,a){if(l&1&&(t(0,"div",21),p(1,X,5,1,"select",45)(2,Y,3,0,"button",46),i()),l&2){let e=d().$implicit;s(),_("ngIf",!e.table_id),s(),_("ngIf",e.table_id)}}function $(l,a){if(l&1){let e=h();t(0,"button",52),v("click",function(){m(e);let r=d().$implicit,c=d(3);return u(c.updateStatus(r.id,"confirmed"))}),t(1,"span",5),n(2,"check"),i()()}}function ee(l,a){if(l&1){let e=h();t(0,"button",53),v("click",function(){m(e);let r=d().$implicit,c=d(3);return u(c.updateStatus(r.id,"cancelled"))}),t(1,"span",5),n(2,"cancel"),i()()}}function te(l,a){if(l&1){let e=h();t(0,"button",54),v("click",function(){m(e);let r=d().$implicit,c=d(3);return u(c.updateStatus(r.id,"pending"))}),t(1,"span",5),n(2,"schedule"),i()()}}function ie(l,a){if(l&1){let e=h();t(0,"tr")(1,"td"),n(2),i(),t(3,"td"),n(4),i(),t(5,"td")(6,"div")(7,"strong"),n(8),i(),p(9,Q,2,1,"div",36),i()(),t(10,"td"),n(11),i(),t(12,"td"),n(13),i(),t(14,"td")(15,"div",37)(16,"span"),n(17),i(),p(18,Z,3,2,"div",38),i()(),t(19,"td")(20,"span",39),n(21),i()(),t(22,"td")(23,"span",39),n(24),i()(),t(25,"td")(26,"div",21),p(27,$,3,0,"button",40)(28,ee,3,0,"button",41)(29,te,3,0,"button",42),t(30,"button",43),v("click",function(){let r=m(e).$implicit,c=d(3);return u(c.deleteReservation(r.id))}),t(31,"span",5),n(32,"delete"),i()()()()()}if(l&2){let e=a.$implicit,o=d(3);s(2),S(e.reservation_date),s(2),S(o.formatTime(e.reservation_time)),s(4),S(o.getCustomerName(e)),s(),_("ngIf",e.customer_email),s(2),S(o.getCustomerContact(e)),s(2),S(e.party_size),s(4),S(o.getTableName(e)),s(),_("ngIf",o.tables.length>0),s(2),R("active",o.getStatusColor(e.status)),s(),w(" ",o.getStatusText(e.status)," "),s(2),R("active",e.customer_id),s(),w(" ",e.customer_id?"Cliente Registrato":"Nuovo Cliente"," "),s(3),_("ngIf",e.status!=="confirmed"),s(),_("ngIf",e.status!=="cancelled"),s(),_("ngIf",e.status!=="pending")}}function ne(l,a){if(l&1&&(t(0,"table",34)(1,"thead")(2,"tr")(3,"th"),n(4,"Data"),i(),t(5,"th"),n(6,"Ora"),i(),t(7,"th"),n(8,"Cliente"),i(),t(9,"th"),n(10,"Contatto"),i(),t(11,"th"),n(12,"Persone"),i(),t(13,"th"),n(14,"Tavolo"),i(),t(15,"th"),n(16,"Stato"),i(),t(17,"th"),n(18,"Tipo"),i(),t(19,"th"),n(20,"Azioni"),i()()(),t(21,"tbody"),p(22,ie,33,17,"tr",35),i()()),l&2){let e=d(2);s(22),_("ngForOf",e.filteredReservations)}}function ae(l,a){if(l&1){let e=h();t(0,"div",55)(1,"span",5),n(2,"event_busy"),i(),t(3,"p",6),n(4,"Nessuna prenotazione trovata con i filtri selezionati"),i(),t(5,"button",56),v("click",function(){m(e);let r=d(2);return u(r.openCreateModal())}),n(6," Crea la prima prenotazione "),i()()}}function re(l,a){if(l&1&&(t(0,"div",31),p(1,ne,23,1,"table",32)(2,ae,7,0,"div",33),i()),l&2){let e=d();s(),_("ngIf",e.filteredReservations.length>0),s(),_("ngIf",e.filteredReservations.length===0)}}function oe(l,a){if(l&1&&(t(0,"option",70),n(1),i()),l&2){let e=a.$implicit;_("value",e),s(),w(" ",e," ")}}function le(l,a){if(l&1&&(t(0,"option",70),n(1),i()),l&2){let e=a.$implicit;_("value",e),s(),y(" ",e," ",e===1?"persona":"persone"," ")}}function se(l,a){if(l&1&&(t(0,"option",50),n(1),i()),l&2){let e=a.$implicit,o=d(2);_("value",e.id)("disabled",e.capacity<o.newReservation.party_size),s(),y(" ",e.table_name," (",e.capacity," posti) ")}}function ce(l,a){if(l&1&&(t(0,"small",6),n(1),i()),l&2){let e=d(2);s(),w(" Capacit\xE0 tavolo: ",e.getSelectedTableCapacity()," posti ")}}function de(l,a){l&1&&(t(0,"span",5),n(1,"refresh"),i())}function _e(l,a){if(l&1){let e=h();t(0,"div",57)(1,"div",58)(2,"div",59)(3,"h2",3)(4,"span",5),n(5,"add_circle"),i(),n(6," Nuova Prenotazione Ristorante "),i(),t(7,"button",60),v("click",function(){m(e);let r=d();return u(r.closeCreateModal())}),t(8,"span",5),n(9,"close"),i()()(),t(10,"div",61)(11,"div",28)(12,"span",5),n(13,"info"),i(),t(14,"span"),n(15,"Stai creando una prenotazione per un cliente (registrato o nuovo)"),i()(),t(16,"div",62)(17,"div",9)(18,"label",10),n(19,"Nome Cliente *"),i(),t(20,"input",63),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.customer_name,r)||(c.newReservation.customer_name=r),u(r)}),i()(),t(21,"div",9)(22,"label",10),n(23,"Telefono *"),i(),t(24,"input",64),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.customer_phone,r)||(c.newReservation.customer_phone=r),u(r)}),i()()(),t(25,"div",62)(26,"div",9)(27,"label",10),n(28,"Email (opzionale)"),i(),t(29,"input",65),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.customer_email,r)||(c.newReservation.customer_email=r),u(r)}),i()(),t(30,"div",9)(31,"label",10),n(32,"Data *"),i(),t(33,"input",66),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.reservation_date,r)||(c.newReservation.reservation_date=r),u(r)}),i()()(),t(34,"div",62)(35,"div",9)(36,"label",10),n(37,"Ora *"),i(),t(38,"select",67),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.reservation_time,r)||(c.newReservation.reservation_time=r),u(r)}),p(39,oe,2,2,"option",68),i()(),t(40,"div",9)(41,"label",10),n(42,"Numero Persone *"),i(),t(43,"select",67),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.party_size,r)||(c.newReservation.party_size=r),u(r)}),p(44,le,2,3,"option",68),i()(),t(45,"div",9)(46,"label",10),n(47,"Stato"),i(),t(48,"select",69),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.status,r)||(c.newReservation.status=r),u(r)}),t(49,"option",17),n(50,"Confermata"),i(),t(51,"option",18),n(52,"In attesa"),i()()()(),t(53,"div",62)(54,"div",9)(55,"label",10),n(56,"Tavolo (opzionale)"),i(),t(57,"select",69),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.table_id,r)||(c.newReservation.table_id=r),u(r)}),t(58,"option",70),n(59,"Nessun tavolo assegnato"),i(),p(60,se,2,4,"option",49),i(),p(61,ce,2,1,"small",71),i()(),t(62,"div",8)(63,"div",9)(64,"label",10),n(65,"Richieste Speciali"),i(),t(66,"textarea",72),x("ngModelChange",function(r){m(e);let c=d();return f(c.newReservation.special_requests,r)||(c.newReservation.special_requests=r),u(r)}),i()()()(),t(67,"div",73)(68,"button",56),v("click",function(){m(e);let r=d();return u(r.closeCreateModal())}),n(69," Annulla "),i(),t(70,"button",74),v("click",function(){m(e);let r=d();return u(r.createReservation())}),p(71,de,2,0,"span",75),n(72," Crea Prenotazione "),i()()()()}if(l&2){let e=d();s(20),g("ngModel",e.newReservation.customer_name),s(4),g("ngModel",e.newReservation.customer_phone),s(5),g("ngModel",e.newReservation.customer_email),s(4),g("ngModel",e.newReservation.reservation_date),s(5),g("ngModel",e.newReservation.reservation_time),s(),_("ngForOf",e.getAvailableTimes()),s(4),g("ngModel",e.newReservation.party_size),s(),_("ngForOf",I(16,H)),s(4),g("ngModel",e.newReservation.status),s(9),g("ngModel",e.newReservation.table_id),s(),_("value",void 0),s(2),_("ngForOf",e.tables),s(),_("ngIf",e.newReservation.table_id),s(5),g("ngModel",e.newReservation.special_requests),s(4),_("disabled",!e.isFormValid()||e.loading),s(),_("ngIf",e.loading)}}var j=class l{reservationService=C(q);tableService=C(A);subscriptions=new M;allRestaurantReservations=[];filteredReservations=[];tables=[];loading=!1;error=null;showCreateModal=!1;newReservation={restaurant_id:"",customer_name:"",customer_phone:"",customer_email:"",reservation_date:"",reservation_time:"19:00",party_size:2,special_requests:"",table_id:void 0,status:"confirmed"};selectedDate=new Date().toISOString().split("T")[0];statusFilter="all";viewMode="future";ngOnInit(){this.loadData(),this.subscriptions.add(this.reservationService.restaurantReservations$.subscribe(a=>{this.allRestaurantReservations=a,this.filterReservations()})),this.subscriptions.add(this.tableService.data$.subscribe(a=>{this.tables=a}))}ngOnDestroy(){this.subscriptions.unsubscribe()}loadData(){return b(this,null,function*(){this.loading=!0;try{yield this.reservationService.loadRestaurantReservations(),yield this.tableService.loadData()}catch(a){console.error("Error loading data:",a),this.error="Errore nel caricamento dei dati"}finally{this.loading=!1}})}filterReservations(){let a=this.allRestaurantReservations,e=new Date().toISOString().split("T")[0];switch(this.viewMode){case"today":a=this.reservationService.getActiveReservations(a);break;case"future":a=this.reservationService.getFutureReservations(a);break;case"all":break}this.selectedDate&&(a=a.filter(o=>o.reservation_date===this.selectedDate)),this.statusFilter!=="all"&&(a=a.filter(o=>o.status===this.statusFilter)),this.filteredReservations=a}openCreateModal(){this.newReservation={restaurant_id:"",customer_name:"",customer_phone:"",customer_email:"",reservation_date:this.selectedDate||new Date().toISOString().split("T")[0],reservation_time:"19:00",party_size:2,special_requests:"",table_id:void 0,status:"confirmed"},this.showCreateModal=!0}closeCreateModal(){this.showCreateModal=!1}createReservation(){return b(this,null,function*(){if(this.isFormValid()){this.loading=!0;try{(yield this.reservationService.createRestaurantReservation(this.newReservation))?(this.closeCreateModal(),this.error=null):this.error="Errore nella creazione della prenotazione"}catch(a){console.error("Error creating reservation:",a),this.error=a.message||"Errore nella creazione della prenotazione"}finally{this.loading=!1}}})}isFormValid(){return!!(this.newReservation.customer_name&&this.newReservation.customer_phone&&this.newReservation.reservation_date&&this.newReservation.reservation_time&&this.newReservation.party_size)}assignTable(a,e){return b(this,null,function*(){if(e){this.loading=!0;try{(yield this.reservationService.assignTableToReservation(a,e))||(this.error="Errore nell'assegnazione del tavolo")}catch(o){console.error("Error assigning table:",o),this.error="Errore nell'assegnazione del tavolo"}finally{this.loading=!1}}})}unassignTable(a){return b(this,null,function*(){this.loading=!0;try{(yield this.reservationService.removeTableFromReservation(a))||(this.error="Errore nella rimozione del tavolo")}catch(e){console.error("Error unassigning table:",e),this.error="Errore nella rimozione del tavolo"}finally{this.loading=!1}})}updateStatus(a,e){return b(this,null,function*(){this.loading=!0;try{(yield this.reservationService.updateReservationStatus(a,e))||(this.error="Errore nell'aggiornamento dello stato")}catch(o){console.error("Error updating status:",o),this.error="Errore nell'aggiornamento dello stato"}finally{this.loading=!1}})}deleteReservation(a){return b(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questa prenotazione?")){this.loading=!0;try{(yield this.reservationService.deleteReservation(a))||(this.error="Errore nell'eliminazione della prenotazione")}catch(e){console.error("Error deleting reservation:",e),this.error="Errore nell'eliminazione della prenotazione"}finally{this.loading=!1}}})}getSelectedTableCapacity(){if(!this.newReservation.table_id)return 0;let a=this.tables.find(e=>e.id===this.newReservation.table_id);return a?a.capacity:0}formatTime(a){return a.substring(0,5)}getCustomerName(a){return this.reservationService.getCustomerName(a)}getCustomerContact(a){return this.reservationService.getCustomerContact(a)}getTableName(a){return this.reservationService.getTableInfo(a)}getStatusColor(a){switch(a){case"confirmed":return"active";case"pending":return"";case"cancelled":return"";default:return""}}getStatusText(a){switch(a){case"confirmed":return"Confermata";case"pending":return"In attesa";case"cancelled":return"Cancellata";default:return a}}getAvailableTimes(){return["12:00","12:30","13:00","13:30","14:00","19:00","19:30","20:00","20:30","21:00","21:30"]}onDateChange(){this.filterReservations()}onStatusFilterChange(){this.filterReservations()}onViewModeChange(){this.filterReservations()}refreshData(){this.loadData()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=E({type:l,selectors:[["app-reservation-manager"]],decls:52,vars:7,consts:[["tableSelect",""],[1,"page-container"],[1,"section-header"],[1,"section-title"],[1,"header-icon"],[1,"material-icons"],[1,"text-muted"],[1,"form-card","mb-lg"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"p-sm",3,"ngModelChange","change","ngModel"],["value","today"],["value","future"],["value","all"],["type","date",1,"p-sm",3,"ngModelChange","change","ngModel"],[1,"form-group","mt-sm"],["value","confirmed"],["value","pending"],["value","cancelled"],[1,"modal-footer","p-md0"],[1,"flex","gap-sm"],["title","Aggiorna",1,"icon-button",3,"click"],[1,"promethea-button",3,"click"],["class","info-message mb-lg",4,"ngIf"],["class","flex items-center justify-center p-lg",4,"ngIf"],["class","table-section",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"info-message","mb-lg"],[1,"icon-button","x-small",3,"click"],[1,"flex","items-center","justify-center","p-lg"],[1,"table-section"],["class","crm-table",4,"ngIf"],["class","empty-state p-lg",4,"ngIf"],[1,"crm-table"],[4,"ngFor","ngForOf"],["class","text-mini text-muted",4,"ngIf"],[1,"flex","items-center","gap-sm"],["class","flex gap-sm",4,"ngIf"],[1,"chip"],["class","icon-button x-small","title","Conferma",3,"click",4,"ngIf"],["class","icon-button x-small","title","Cancella",3,"click",4,"ngIf"],["class","icon-button x-small","title","Metti in attesa",3,"click",4,"ngIf"],["title","Elimina",1,"icon-button","x-small",3,"click"],[1,"text-mini","text-muted"],["class","text-mini x-small",3,"change",4,"ngIf"],["class","icon-button x-small","title","Rimuovi tavolo",3,"click",4,"ngIf"],[1,"text-mini","x-small",3,"change"],["value",""],[3,"value","disabled",4,"ngFor","ngForOf"],[3,"value","disabled"],["title","Rimuovi tavolo",1,"icon-button","x-small",3,"click"],["title","Conferma",1,"icon-button","x-small",3,"click"],["title","Cancella",1,"icon-button","x-small",3,"click"],["title","Metti in attesa",1,"icon-button","x-small",3,"click"],[1,"empty-state","p-lg"],[1,"promethea-button","ghost",3,"click"],[1,"modal-overlay"],[1,"modal-container","modal-lg"],[1,"modal-header"],[1,"icon-button",3,"click"],[1,"form-card"],[1,"form-row","mb-md"],["type","text","placeholder","Inserisci nome cliente","required","",1,"p-sm",3,"ngModelChange","ngModel"],["type","tel","placeholder","Inserisci telefono","required","",1,"p-sm",3,"ngModelChange","ngModel"],["type","email","placeholder","Inserisci email",1,"p-sm",3,"ngModelChange","ngModel"],["type","date","required","",1,"p-sm",3,"ngModelChange","ngModel"],["required","",1,"p-sm",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"p-sm",3,"ngModelChange","ngModel"],[3,"value"],["class","text-muted",4,"ngIf"],["placeholder","Note o richieste speciali del cliente...","rows","3",1,"p-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"]],template:function(e,o){e&1&&(t(0,"div",1)(1,"div",2)(2,"h1",3)(3,"span",4)(4,"span",5),n(5,"event_available"),i()(),n(6," Gestione Prenotazioni "),i(),t(7,"p",6),n(8,"Gestisci le prenotazioni del ristorante - Clienti registrati e nuovi clienti"),i()(),t(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),n(13,"Visualizza"),i(),t(14,"select",11),x("ngModelChange",function(c){return f(o.viewMode,c)||(o.viewMode=c),c}),v("change",function(){return o.onViewModeChange()}),t(15,"option",12),n(16,"Oggi"),i(),t(17,"option",13),n(18,"Prenotazioni Future"),i(),t(19,"option",14),n(20,"Tutte le Prenotazioni"),i()()(),t(21,"div",9)(22,"label",10),n(23,"Data Specifica"),i(),t(24,"input",15),x("ngModelChange",function(c){return f(o.selectedDate,c)||(o.selectedDate=c),c}),v("change",function(){return o.onDateChange()}),i()()(),t(25,"div",16)(26,"label",10),n(27,"Stato"),i(),t(28,"select",11),x("ngModelChange",function(c){return f(o.statusFilter,c)||(o.statusFilter=c),c}),v("change",function(){return o.onStatusFilterChange()}),t(29,"option",14),n(30,"Tutti"),i(),t(31,"option",17),n(32,"Confermate"),i(),t(33,"option",18),n(34,"In attesa"),i(),t(35,"option",19),n(36,"Cancellate"),i()()(),t(37,"div",20)(38,"label",10),n(39,"\xA0"),i(),t(40,"div",21)(41,"button",22),v("click",function(){return o.refreshData()}),t(42,"span",5),n(43,"refresh"),i()(),t(44,"button",23),v("click",function(){return o.openCreateModal()}),t(45,"span",5),n(46,"add"),i(),n(47," Nuova Prenotazione "),i()()()(),p(48,J,7,1,"div",24)(49,K,3,0,"div",25)(50,re,3,2,"div",26)(51,_e,73,17,"div",27),i()),e&2&&(s(14),g("ngModel",o.viewMode),s(10),g("ngModel",o.selectedDate),s(4),g("ngModel",o.statusFilter),s(20),_("ngIf",o.error),s(),_("ngIf",o.loading),s(),_("ngIf",!o.loading),s(),_("ngIf",o.showCreateModal))},dependencies:[z,V,k,L,P,N,W,O,D,B,F],encapsulation:2})};export{j as ReservationManager};
