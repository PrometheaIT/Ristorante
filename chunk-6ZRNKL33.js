import{a as X}from"./chunk-RUFMNYKY.js";import{a as W}from"./chunk-WZY7UQ2E.js";import{a as Q}from"./chunk-4E4RPIRA.js";import{a as z,b as A,c as v,d as U,e as B,i as D,j as G,k as $,n as q,o as Y,p as j,q as R,s as K,u as H,w as J}from"./chunk-CV27PIWO.js";import"./chunk-CXV4BLDF.js";import{d as P,e as T,i as N,k as V,p as L}from"./chunk-L5SOXNIK.js";import{$a as w,Cb as d,Db as p,Ka as l,Mb as x,Ob as F,Pb as n,Qb as h,Rb as S,Sb as k,_b as O,a as E,ac as M,b as C,da as y,eb as m,f as b,ia as u,ja as _,pb as s,qb as i,rb as t,sb as g,yb as I}from"./chunk-KZSY5CHT.js";function ee(a,r){a&1&&(i(0,"tr")(1,"td",30),g(2,"div",31),i(3,"span"),n(4,"Caricamento ingredienti..."),t()()())}function te(a,r){if(a&1){let e=I();i(0,"tr",32)(1,"td")(2,"strong"),n(3),t()(),i(4,"td")(5,"span",4),n(6),t()(),i(7,"td")(8,"span"),n(9),t()(),i(10,"td")(11,"span",4),n(12),t()(),i(13,"td")(14,"strong"),n(15),O(16,"number"),t()(),i(17,"td")(18,"span",33),n(19),t()(),i(20,"td")(21,"div",34)(22,"button",35),d("click",function(){let c=u(e).$implicit,f=p();return _(f.editIngredient(c))}),i(23,"span",2),n(24,"edit"),t()(),i(25,"button",36),d("click",function(){let c=u(e).$implicit,f=p();return _(f.deleteIngredient(c.id))}),i(26,"span",2),n(27,"delete"),t()()()()()}if(a&2){let e=r.$implicit,o=p();l(3),h(e.name),l(3),h(e.description||"Nessuna descrizione"),l(2),x("low-stock",e.current_stock<=e.minimum_stock),l(),k(" ",e.current_stock," ",o.getUnitSymbol(e.unit_id)," "),l(3),h(o.getSupplierName(e)),l(3),S("\u20AC",M(16,11,e.cost_per_unit,"1.2-2")),l(3),F(o.getStockStatus(e).class),l(),S(" ",o.getStockStatus(e).text," ")}}function ie(a,r){a&1&&(i(0,"p"),n(1," Prova a modificare i filtri di ricerca "),t())}function ne(a,r){if(a&1){let e=I();i(0,"tr")(1,"td",37)(2,"span",2),n(3,"search_off"),t(),i(4,"h3"),n(5,"Nessun ingrediente trovato"),t(),m(6,ie,2,0,"p",27),i(7,"button",23),d("click",function(){u(e);let c=p();return _(c.newIngredient())}),i(8,"span",2),n(9,"add"),t(),n(10," Aggiungi il primo ingrediente "),t()()()}if(a&2){let e=p();l(6),s("ngIf",e.searchTerm||e.showLowStockOnly)}}function re(a,r){a&1&&(i(0,"div",73)(1,"span"),n(2,"Il nome \xE8 obbligatorio e deve essere di almeno 2 caratteri"),t()())}function oe(a,r){if(a&1&&(i(0,"option",74),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function le(a,r){if(a&1&&(i(0,"option",74),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function ae(a,r){if(a&1&&(i(0,"option",74),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),k(" ",e.name," (",e.symbol,") ")}}function se(a,r){a&1&&(i(0,"div",73)(1,"span"),n(2,"Il costo per unit\xE0 \xE8 obbligatorio"),t()())}function ce(a,r){a&1&&(i(0,"div",73)(1,"span"),n(2,"La scorta attuale \xE8 obbligatoria"),t()())}function de(a,r){a&1&&(i(0,"div",73)(1,"span"),n(2,"La scorta minima \xE8 obbligatoria"),t()())}function me(a,r){if(a&1&&(i(0,"option",74),n(1),t()),a&2){let e=r.$implicit;s("value",e.id),l(),S(" ",e.company_name," ")}}function pe(a,r){if(a&1){let e=I();i(0,"div",38),d("click",function(){u(e);let c=p();return _(c.resetForm())}),i(1,"div",39),d("click",function(c){return u(e),_(c.stopPropagation())}),i(2,"div",7)(3,"span",2),n(4),t(),i(5,"h2",8),n(6),t(),i(7,"button",40),d("click",function(){u(e);let c=p();return _(c.resetForm())}),i(8,"span",2),n(9,"close"),t()()(),i(10,"form",41),d("ngSubmit",function(){u(e);let c=p();return _(c.onSubmit())}),i(11,"div",42)(12,"div",43)(13,"label",44)(14,"span",2),n(15,"label"),t(),n(16," Nome Ingrediente * "),t(),g(17,"input",45),m(18,re,3,0,"div",46),t(),i(19,"div",43)(20,"label",47)(21,"span",2),n(22,"description"),t(),n(23," Descrizione "),t(),g(24,"textarea",48),t()(),i(25,"div",42)(26,"div",43)(27,"label",49)(28,"span",2),n(29,"straighten"),t(),n(30," Unit\xE0 di Misura "),t(),i(31,"select",50)(32,"option",51),n(33,"Seleziona unit\xE0"),t(),i(34,"optgroup",52),m(35,oe,2,3,"option",53),t(),i(36,"optgroup",54),m(37,le,2,3,"option",53),t(),i(38,"optgroup",55),m(39,ae,2,3,"option",53),t()()(),i(40,"div",43)(41,"label",56)(42,"span",2),n(43,"euro"),t(),n(44," Costo per Unit\xE0 * "),t(),g(45,"input",57),m(46,se,3,0,"div",46),t()(),i(47,"div",42)(48,"div",43)(49,"label",58)(50,"span",2),n(51,"inventory"),t(),n(52," Scorta Attuale * "),t(),g(53,"input",59),m(54,ce,3,0,"div",46),t(),i(55,"div",43)(56,"label",60)(57,"span",2),n(58,"warning"),t(),n(59," Scorta Minima * "),t(),g(60,"input",61),m(61,de,3,0,"div",46),t()(),i(62,"div",42)(63,"div",43)(64,"label",62)(65,"span",2),n(66,"local_shipping"),t(),n(67," Fornitore "),t(),i(68,"div",63)(69,"select",64)(70,"option",51),n(71,"Nessun fornitore"),t(),m(72,me,2,2,"option",53),t(),i(73,"button",65),d("click",function(){u(e);let c=p();return _(c.goToSupplierManager())}),i(74,"span",2),n(75,"add"),t(),n(76," Gestisci Fornitori "),t()()()(),i(77,"div",42)(78,"div",43)(79,"label",66)(80,"span",2),n(81,"event"),t(),n(82," Data di Scadenza "),t(),g(83,"input",67),t(),i(84,"div",43)(85,"label",68),g(86,"input",69),i(87,"div")(88,"strong"),n(89,"Attiva avvisi scorta bassa"),t(),i(90,"div",4),n(91,"Ricevi un avviso quando la scorta scende sotto il livello minimo"),t()()()()(),i(92,"div",70)(93,"button",71),d("click",function(){u(e);let c=p();return _(c.resetForm())}),n(94," Annulla "),t(),i(95,"button",72)(96,"span",2),n(97),t(),n(98),t()()()()()}if(a&2){let e=p();l(4),h(e.isEditing?"edit":"add_circle"),l(2),S(" ",e.isEditing?"Modifica Ingrediente":"Nuovo Ingrediente"," "),l(4),s("formGroup",e.ingredientForm),l(7),x("error",(e.name==null?null:e.name.invalid)&&(e.name==null?null:e.name.touched)),l(),s("ngIf",(e.name==null?null:e.name.invalid)&&(e.name==null?null:e.name.touched)),l(17),s("ngForOf",e.getUnitsByType("weight")),l(2),s("ngForOf",e.getUnitsByType("volume")),l(2),s("ngForOf",e.getUnitsByType("piece")),l(6),x("error",(e.cost_per_unit==null?null:e.cost_per_unit.invalid)&&(e.cost_per_unit==null?null:e.cost_per_unit.touched)),l(),s("ngIf",(e.cost_per_unit==null?null:e.cost_per_unit.invalid)&&(e.cost_per_unit==null?null:e.cost_per_unit.touched)),l(7),x("error",(e.current_stock==null?null:e.current_stock.invalid)&&(e.current_stock==null?null:e.current_stock.touched)),l(),s("ngIf",(e.current_stock==null?null:e.current_stock.invalid)&&(e.current_stock==null?null:e.current_stock.touched)),l(6),x("error",(e.minimum_stock==null?null:e.minimum_stock.invalid)&&(e.minimum_stock==null?null:e.minimum_stock.touched)),l(),s("ngIf",(e.minimum_stock==null?null:e.minimum_stock.invalid)&&(e.minimum_stock==null?null:e.minimum_stock.touched)),l(11),s("ngForOf",e.suppliers),l(23),s("disabled",e.ingredientForm.invalid),l(2),h(e.isEditing?"save":"add"),l(),S(" ",e.isEditing?"Aggiorna":"Crea"," Ingrediente ")}}var Z=class a{ingredientService=y(Q);unitService=y(W);supplierService=y(X);fb=y(H);router=y(L);ingredients=[];units=[];suppliers=[];filteredIngredients=[];showIngredientForm=!1;isEditing=!1;currentIngredientId=null;searchTerm="";ingredientForm;isLoading=!0;showLowStockOnly=!1;sortBy="name";get lowStockCount(){return this.ingredientService.getLowStockIngredients().length}constructor(){this.ingredientForm=this.fb.group({name:["",[v.required,v.minLength(2)]],description:[""],unit_id:[""],current_stock:[0,[v.required,v.min(0)]],minimum_stock:[0,[v.required,v.min(0)]],cost_per_unit:[0,[v.required,v.min(0)]],alert_enabled:[!0],expiry_date:[null],supplier_id:[null]})}ngOnInit(){return b(this,null,function*(){this.loadData()})}loadData(){return b(this,null,function*(){this.isLoading=!0,this.unitService.units$.subscribe(r=>{this.units=r}),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r}),this.ingredientService.ingredients$.subscribe(r=>{this.ingredients=r,this.applyFilters(),this.isLoading=!1}),yield this.ingredientService.loadIngredients(),yield this.supplierService.loadSuppliers()})}applyFilters(){let r=this.ingredients;this.searchTerm&&(r=this.ingredientService.searchIngredients(this.searchTerm)),this.showLowStockOnly&&(r=r.filter(e=>e.alert_enabled&&e.current_stock<=e.minimum_stock)),r=[...r].sort((e,o)=>{switch(this.sortBy){case"name":return e.name.localeCompare(o.name);case"stock":return e.current_stock-o.current_stock;case"cost":return e.cost_per_unit-o.cost_per_unit;default:return 0}}),this.filteredIngredients=r}onSearchChange(r){this.searchTerm=r,this.applyFilters()}toggleLowStockFilter(){this.showLowStockOnly=!this.showLowStockOnly,this.applyFilters()}onSortChange(r){this.sortBy=r,this.applyFilters()}onSubmit(){return b(this,null,function*(){if(this.ingredientForm.invalid){this.markFormGroupTouched();return}let r=this.ingredientForm.value,e=C(E({},r),{expiry_date:r.expiry_date===""?null:r.expiry_date,supplier_id:r.supplier_id===""?null:r.supplier_id});try{this.isEditing&&this.currentIngredientId?(yield this.ingredientService.updateIngredient(this.currentIngredientId,e))&&(console.log("Ingrediente aggiornato con successo"),this.resetForm()):(yield this.ingredientService.createIngredient(e))&&(console.log("Ingrediente creato con successo"),this.resetForm())}catch(o){console.error("Errore durante il salvataggio:",o)}})}editIngredient(r){this.isEditing=!0,this.currentIngredientId=r.id,this.ingredientForm.patchValue({name:r.name,description:r.description||"",unit_id:r.unit_id||"",current_stock:r.current_stock,minimum_stock:r.minimum_stock,cost_per_unit:r.cost_per_unit,alert_enabled:r.alert_enabled,expiry_date:r.expiry_date||"",supplier_id:r.supplier_id||null}),this.showIngredientForm=!0}deleteIngredient(r){return b(this,null,function*(){confirm("Sei sicuro di voler eliminare questo ingrediente?")&&(yield this.ingredientService.deleteIngredient(r))&&console.log("Ingrediente eliminato")})}newIngredient(){this.resetForm(),this.showIngredientForm=!0,this.isEditing=!1}resetForm(){this.ingredientForm.reset({name:"",description:"",unit_id:"",current_stock:0,minimum_stock:0,cost_per_unit:0,alert_enabled:!0,expiry_date:"",supplier_id:null}),this.isEditing=!1,this.currentIngredientId=null,this.showIngredientForm=!1}goToSupplierManager(){this.router.navigate(["/restaurant/suppliers"])}getUnitSymbol(r){if(!r)return"";let e=this.units.find(o=>o.id===r);return e?e.symbol:""}shouldAlert(r){return r.alert_enabled&&r.current_stock<=r.minimum_stock}getStockStatus(r){return this.shouldAlert(r)?{class:"inactive",text:"Scorta Bassa"}:r.current_stock<=r.minimum_stock*1.5?{class:"warning",text:"Scorta Media"}:{class:"active",text:"Scorta OK"}}getSupplierName(r){if(!r.supplier_id)return"Nessun fornitore";if(r.suppliers)return r.suppliers.company_name;let e=this.suppliers.find(o=>o.id===r.supplier_id);return e?e.company_name:"Fornitore sconosciuto"}goToFoodCostCalculator(){this.router.navigate(["/food-cost"])}markFormGroupTouched(){Object.keys(this.ingredientForm.controls).forEach(r=>{this.ingredientForm.get(r)?.markAsTouched()})}get name(){return this.ingredientForm.get("name")}get current_stock(){return this.ingredientForm.get("current_stock")}get minimum_stock(){return this.ingredientForm.get("minimum_stock")}get cost_per_unit(){return this.ingredientForm.get("cost_per_unit")}getUnitsByType(r){return this.unitService.getUnitsByType(r)}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-inventory"]],decls:83,vars:11,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"promethea-button","ghost",3,"click"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Cerca per nome o descrizione...",1,"search-input",3,"input","value"],[1,"filter-select",3,"change","value"],["value","name"],["value","stock"],["value","cost"],[1,"checkbox-label"],["type","checkbox",3,"change","checked"],[1,"actions-container"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngIf"],["class","ingredient-row",4,"ngFor","ngForOf"],["class","ingredient-modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"loading-container"],[1,"loading-spinner"],[1,"ingredient-row"],[1,"chip"],[1,"action-buttons"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state"],[1,"ingredient-modal-overlay",3,"click"],[1,"form-card","ingredient-modal",3,"click"],[1,"icon-button",3,"click"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],["for","name",1,"form-label"],["id","name","formControlName","name","type","text","placeholder","Es: Pomodoro San Marzano"],["class","status-message error",4,"ngIf"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","2","placeholder","Descrizione opzionale dell'ingrediente"],["for","unit_id",1,"form-label"],["id","unit_id","formControlName","unit_id"],["value",""],["label","Peso"],[3,"value",4,"ngFor","ngForOf"],["label","Volume"],["label","Conteggio"],["for","cost_per_unit",1,"form-label"],["id","cost_per_unit","formControlName","cost_per_unit","type","number","step","0.001","min","0","placeholder","0.000"],["for","current_stock",1,"form-label"],["id","current_stock","formControlName","current_stock","type","number","step","0.001","min","0","placeholder","0"],["for","minimum_stock",1,"form-label"],["id","minimum_stock","formControlName","minimum_stock","type","number","step","0.001","min","0","placeholder","0"],["for","supplier_id",1,"form-label"],[1,"supplier-select-container"],["id","supplier_id","formControlName","supplier_id"],["type","button",1,"promethea-button","ghost","small",3,"click"],["for","expiry_date",1,"form-label"],["id","expiry_date","formControlName","expiry_date","type","date"],[1,"checkbox-label","large"],["type","checkbox","formControlName","alert_enabled"],[1,"form-actions"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"status-message","error"],[3,"value"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"span",2),n(3,"inventory_2"),t(),i(4,"div",3)(5,"h1"),n(6,"Gestione Inventario"),t(),i(7,"p",4),n(8,"Gestisci gli ingredienti del tuo ristorante"),t()()(),i(9,"div",5)(10,"div",6)(11,"div",7)(12,"span",2),n(13,"inventory"),t(),i(14,"h3",8),n(15,"Ingredienti Totali"),t()(),i(16,"div",9),n(17),t()(),i(18,"div",6)(19,"div",7)(20,"span",2),n(21,"warning"),t(),i(22,"h3",8),n(23,"Scorte Basse"),t()(),i(24,"div",9),n(25),t()(),i(26,"div",6)(27,"div",7)(28,"span",2),n(29,"calculate"),t(),i(30,"h3",8),n(31,"Food Cost"),t()(),i(32,"button",10),d("click",function(){return o.goToFoodCostCalculator()}),n(33," Calcola Food Cost "),t()()(),i(34,"div",11)(35,"div",12)(36,"div",13)(37,"label",14),n(38,"Cerca Ingredienti"),t(),i(39,"input",15),d("input",function(f){return o.onSearchChange(f.target.value)}),t()(),i(40,"div",13)(41,"label",14),n(42,"Ordina per"),t(),i(43,"select",16),d("change",function(f){return o.onSortChange(f.target.value)}),i(44,"option",17),n(45,"Nome"),t(),i(46,"option",18),n(47,"Scorta"),t(),i(48,"option",19),n(49,"Costo"),t()()(),i(50,"div",13)(51,"label",20)(52,"input",21),d("change",function(){return o.toggleLowStockFilter()}),t(),n(53," Mostra solo scorte basse "),t()()(),i(54,"div",22)(55,"button",23),d("click",function(){return o.newIngredient()}),i(56,"span",2),n(57,"add"),t(),n(58," Nuovo Ingrediente "),t()()(),i(59,"div",24)(60,"div",25)(61,"table",26)(62,"thead")(63,"tr")(64,"th"),n(65,"Nome"),t(),i(66,"th"),n(67,"Descrizione"),t(),i(68,"th"),n(69,"Scorta Attuale"),t(),i(70,"th"),n(71,"Fornitore"),t(),i(72,"th"),n(73,"Costo/Unit\xE0"),t(),i(74,"th"),n(75,"Stato"),t(),i(76,"th"),n(77,"Azioni"),t()()(),i(78,"tbody"),m(79,ee,5,0,"tr",27)(80,te,28,14,"tr",28)(81,ne,11,1,"tr",27),t()()()(),m(82,pe,99,22,"div",29),t()),e&2&&(l(17),h(o.ingredients.length),l(7),x("error",o.lowStockCount>0),l(),S(" ",o.lowStockCount," "),l(14),s("value",o.searchTerm),l(4),s("value",o.sortBy),l(9),s("checked",o.showLowStockOnly),l(27),s("ngIf",o.isLoading),l(),s("ngForOf",o.filteredIngredients),l(),s("ngIf",!o.isLoading&&o.filteredIngredients.length===0),l(),s("ngIf",o.showIngredientForm))},dependencies:[V,P,T,J,D,j,R,A,G,z,Y,U,B,K,$,q,N],styles:["[_nghost-%COMP%]{display:block;width:100%}.search-input[_ngcontent-%COMP%]{min-width:250px}.filter-select[_ngcontent-%COMP%]{min-width:150px}.ingredient-row[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 5%,transparent)}.low-stock[_ngcontent-%COMP%]{color:#ef4444;font-weight:600}.chip.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.card-number.error[_ngcontent-%COMP%]{color:#ef4444}.form-card[_ngcontent-%COMP%]{margin-top:var(--gutter-lg);animation:_ngcontent-%COMP%_slideIn .3s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:var(--gutter-xl)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--gutter-xl);color:var(--text-muted)}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:var(--gutter-md);opacity:.5}@media (max-width: 768px){.filters-section[_ngcontent-%COMP%]{flex-direction:column;gap:var(--gutter-md)}.filters-container[_ngcontent-%COMP%]{flex-direction:column;width:100%}.filter-group[_ngcontent-%COMP%]{width:100%}.search-input[_ngcontent-%COMP%]{min-width:100%}.action-buttons[_ngcontent-%COMP%]{flex-direction:column}.table-container[_ngcontent-%COMP%]{overflow-x:auto}}.ingredient-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0a0a0a73;-webkit-backdrop-filter:blur(4px) saturate(120%);backdrop-filter:blur(4px) saturate(120%);z-index:1200;padding:1.5rem}.ingredient-modal[_ngcontent-%COMP%]{width:100%;max-width:820px;margin:0 auto;border-radius:16px;box-shadow:0 24px 60px #00000059;transform:translateY(0);animation:_ngcontent-%COMP%_modalPop .22s cubic-bezier(.2,.9,.28,1);position:relative;padding:var(--gutter-md);background:var(--background)}.ingredient-modal[_ngcontent-%COMP%]   .generic-form[_ngcontent-%COMP%]{max-height:calc(100vh - 160px);overflow:auto;padding-right:8px}.ingredient-modal[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;z-index:2}@keyframes _ngcontent-%COMP%_modalPop{0%{opacity:0;transform:translateY(-10px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}@media (max-width: 520px){.ingredient-modal[_ngcontent-%COMP%]{max-width:100%;border-radius:12px;padding:.5rem}.ingredient-modal[_ngcontent-%COMP%]   .form-card[_ngcontent-%COMP%]{border-radius:12px}}.supplier-select-container[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-end}.supplier-select-container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1}.promethea-button.ghost.small[_ngcontent-%COMP%]{padding:8px 12px;font-size:.875rem;white-space:nowrap}"]})};export{Z as Inventory};
