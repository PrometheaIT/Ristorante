import{a as L}from"./chunk-RUFMNYKY.js";import{a as M,b as N,c as x,d as V,e as T,i as z,k as P,n as G,u as O,w as A}from"./chunk-CV27PIWO.js";import"./chunk-CXV4BLDF.js";import{d as k,e as C,k as I}from"./chunk-L5SOXNIK.js";import{$a as F,Cb as p,Db as u,Ka as a,Mb as y,Ob as w,Pb as n,Qb as _,Rb as h,da as b,eb as S,f as g,ia as m,ja as c,pb as d,qb as i,rb as e,sb as f,yb as v}from"./chunk-KZSY5CHT.js";function q(s,r){s&1&&(i(0,"tr")(1,"td",19),f(2,"div",20),i(3,"span"),n(4,"Caricamento fornitori..."),e()()())}function $(s,r){if(s&1){let t=v();i(0,"tr",21)(1,"td")(2,"strong"),n(3),e()(),i(4,"td")(5,"span",4),n(6),e()(),i(7,"td")(8,"span",4),n(9),e()(),i(10,"td")(11,"span",4),n(12),e()(),i(13,"td")(14,"span",4),n(15),e()(),i(16,"td")(17,"span",22),n(18),e()(),i(19,"td")(20,"div",23)(21,"button",24),p("click",function(){let l=m(t).$implicit,E=u();return c(E.editSupplier(l))}),i(22,"span",2),n(23,"edit"),e()(),i(24,"button",25),p("click",function(){let l=m(t).$implicit,E=u();return c(E.deleteSupplier(l.id))}),i(25,"span",2),n(26,"delete"),e()()()()()}if(s&2){let t=r.$implicit;a(3),_(t.company_name),a(3),_(t.contact_name||"Nessun contatto"),a(3),_(t.email||"Nessuna email"),a(3),_(t.phone||"Nessun telefono"),a(3),_(t.address||"Nessun indirizzo"),a(2),w(t.is_platform_supplier?"active":"warning"),a(),h(" ",t.is_platform_supplier?"Piattaforma":"Locale"," ")}}function j(s,r){if(s&1){let t=v();i(0,"tr")(1,"td",26)(2,"span",2),n(3,"local_shipping"),e(),i(4,"h3"),n(5,"Nessun fornitore trovato"),e(),i(6,"button",12),p("click",function(){m(t);let l=u();return c(l.newSupplier())}),i(7,"span",2),n(8,"add"),e(),n(9," Aggiungi il primo fornitore "),e()()()}}function B(s,r){s&1&&(i(0,"div",49)(1,"span"),n(2,"Il nome dell'azienda \xE8 obbligatorio"),e()())}function R(s,r){s&1&&(i(0,"div",49)(1,"span"),n(2,"Inserisci un indirizzo email valido"),e()())}function H(s,r){if(s&1){let t=v();i(0,"div",27),p("click",function(){m(t);let l=u();return c(l.resetForm())}),i(1,"div",28),p("click",function(l){return m(t),c(l.stopPropagation())}),i(2,"div",7)(3,"span",2),n(4),e(),i(5,"h2",8),n(6),e(),i(7,"button",29),p("click",function(){m(t);let l=u();return c(l.resetForm())}),i(8,"span",2),n(9,"close"),e()()(),i(10,"form",30),p("ngSubmit",function(){m(t);let l=u();return c(l.onSubmit())}),i(11,"div",31)(12,"div",32)(13,"label",33)(14,"span",2),n(15,"business"),e(),n(16," Nome Azienda * "),e(),f(17,"input",34),S(18,B,3,0,"div",35),e(),i(19,"div",32)(20,"label",36)(21,"span",2),n(22,"person"),e(),n(23," Nome Contatto "),e(),f(24,"input",37),e()(),i(25,"div",31)(26,"div",32)(27,"label",38)(28,"span",2),n(29,"email"),e(),n(30," Email "),e(),f(31,"input",39),S(32,R,3,0,"div",35),e(),i(33,"div",32)(34,"label",40)(35,"span",2),n(36,"phone"),e(),n(37," Telefono "),e(),f(38,"input",41),e()(),i(39,"div",32)(40,"label",42)(41,"span",2),n(42,"place"),e(),n(43," Indirizzo "),e(),f(44,"textarea",43),e(),i(45,"div",32)(46,"label",44),f(47,"input",45),i(48,"div")(49,"strong"),n(50,"Fornitore della piattaforma"),e(),i(51,"div",4),n(52,"Seleziona se \xE8 un fornitore della piattaforma Promethea"),e()()()(),i(53,"div",46)(54,"button",47),p("click",function(){m(t);let l=u();return c(l.resetForm())}),n(55," Annulla "),e(),i(56,"button",48)(57,"span",2),n(58),e(),n(59),e()()()()()}if(s&2){let t=u();a(4),_(t.isEditing?"edit":"add_circle"),a(2),h(" ",t.isEditing?"Modifica Fornitore":"Nuovo Fornitore"," "),a(4),d("formGroup",t.supplierForm),a(7),y("error",(t.company_name==null?null:t.company_name.invalid)&&(t.company_name==null?null:t.company_name.touched)),a(),d("ngIf",(t.company_name==null?null:t.company_name.invalid)&&(t.company_name==null?null:t.company_name.touched)),a(13),y("error",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),a(),d("ngIf",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),a(24),d("disabled",t.supplierForm.invalid),a(2),_(t.isEditing?"save":"add"),a(),h(" ",t.isEditing?"Aggiorna":"Crea"," Fornitore ")}}var D=class s{supplierService=b(L);fb=b(O);suppliers=[];showSupplierForm=!1;isEditing=!1;currentSupplierId=null;supplierForm;isLoading=!0;constructor(){this.supplierForm=this.fb.group({company_name:["",[x.required,x.minLength(2)]],contact_name:[""],email:["",[x.email]],phone:[""],address:[""],is_platform_supplier:[!1]})}ngOnInit(){return g(this,null,function*(){yield this.loadSuppliers()})}loadSuppliers(){return g(this,null,function*(){this.isLoading=!0;try{yield this.supplierService.loadSuppliers(),this.supplierService.suppliers$.subscribe(r=>{this.suppliers=r,this.isLoading=!1})}catch(r){console.error("Error loading suppliers:",r),this.isLoading=!1}})}onSubmit(){return g(this,null,function*(){if(this.supplierForm.invalid){this.markFormGroupTouched();return}try{this.isEditing&&this.currentSupplierId?(yield this.updateSupplier(this.currentSupplierId,this.supplierForm.value))&&(console.log("Fornitore aggiornato con successo"),this.resetForm()):(yield this.supplierService.createSupplier(this.supplierForm.value))&&(console.log("Fornitore creato con successo"),this.resetForm())}catch(r){console.error("Errore durante il salvataggio:",r)}})}updateSupplier(r,t){return g(this,null,function*(){try{let{data:o,error:l}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").update(t).eq("id",r).select().single();if(l)throw l;return yield this.loadSuppliers(),!0}catch(o){return console.error("Error updating supplier:",o),!1}})}deleteSupplier(r){return g(this,null,function*(){if(confirm("Sei sicuro di voler eliminare questo fornitore?"))try{let{error:t}=yield this.supplierService.supabaseService.getSupabaseClient().from("suppliers").delete().eq("id",r);if(t)throw t;yield this.loadSuppliers(),console.log("Fornitore eliminato")}catch(t){console.error("Error deleting supplier:",t)}})}editSupplier(r){this.isEditing=!0,this.currentSupplierId=r.id,this.supplierForm.patchValue({company_name:r.company_name,contact_name:r.contact_name||"",email:r.email||"",phone:r.phone||"",address:r.address||"",is_platform_supplier:r.is_platform_supplier}),this.showSupplierForm=!0}newSupplier(){this.resetForm(),this.showSupplierForm=!0,this.isEditing=!1}resetForm(){this.supplierForm.reset({company_name:"",contact_name:"",email:"",phone:"",address:"",is_platform_supplier:!1}),this.isEditing=!1,this.currentSupplierId=null,this.showSupplierForm=!1}markFormGroupTouched(){Object.keys(this.supplierForm.controls).forEach(r=>{this.supplierForm.get(r)?.markAsTouched()})}get company_name(){return this.supplierForm.get("company_name")}get email(){return this.supplierForm.get("email")}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=F({type:s,selectors:[["app-supplier-manager"]],decls:48,vars:5,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"filters-section",2,"margin-top","var(--gutter-md)"],[1,"actions-container"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[4,"ngIf"],["class","supplier-row",4,"ngFor","ngForOf"],["class","supplier-modal-overlay",3,"click",4,"ngIf"],["colspan","7",1,"loading-container"],[1,"loading-spinner"],[1,"supplier-row"],[1,"chip"],[1,"action-buttons"],["title","Modifica",1,"icon-button",3,"click"],["title","Elimina",1,"icon-button",3,"click"],["colspan","7",1,"empty-state"],[1,"supplier-modal-overlay",3,"click"],[1,"form-card","supplier-modal",3,"click"],[1,"icon-button",3,"click"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"grid-form"],[1,"form-group"],["for","company_name",1,"form-label"],["id","company_name","formControlName","company_name","type","text","placeholder","Es: Fornitore Srl"],["class","status-message error",4,"ngIf"],["for","contact_name",1,"form-label"],["id","contact_name","formControlName","contact_name","type","text","placeholder","Nome del referente"],["for","email",1,"form-label"],["id","email","formControlName","email","type","email","placeholder","email@fornitore.com"],["for","phone",1,"form-label"],["id","phone","formControlName","phone","type","tel","placeholder","+39 012 345 6789"],["for","address",1,"form-label"],["id","address","formControlName","address","rows","2","placeholder","Indirizzo completo del fornitore"],[1,"checkbox-label","large"],["type","checkbox","formControlName","is_platform_supplier"],[1,"form-actions"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[1,"status-message","error"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"span",2),n(3,"local_shipping"),e(),i(4,"div",3)(5,"h1"),n(6,"Gestione Fornitori"),e(),i(7,"p",4),n(8,"Gestisci i fornitori del tuo ristorante"),e()()(),i(9,"div",5)(10,"div",6)(11,"div",7)(12,"span",2),n(13,"business"),e(),i(14,"h3",8),n(15,"Fornitori Totali"),e()(),i(16,"div",9),n(17),e()()(),i(18,"div",10)(19,"div",11)(20,"button",12),p("click",function(){return o.newSupplier()}),i(21,"span",2),n(22,"add"),e(),n(23," Nuovo Fornitore "),e()()(),i(24,"div",13)(25,"div",14)(26,"table",15)(27,"thead")(28,"tr")(29,"th"),n(30,"Nome Azienda"),e(),i(31,"th"),n(32,"Contatto"),e(),i(33,"th"),n(34,"Email"),e(),i(35,"th"),n(36,"Telefono"),e(),i(37,"th"),n(38,"Indirizzo"),e(),i(39,"th"),n(40,"Tipo"),e(),i(41,"th"),n(42,"Azioni"),e()()(),i(43,"tbody"),S(44,q,5,0,"tr",16)(45,$,27,8,"tr",17)(46,j,10,0,"tr",16),e()()()(),S(47,H,60,12,"div",18),e()),t&2&&(a(17),_(o.suppliers.length),a(27),d("ngIf",o.isLoading),a(),d("ngForOf",o.suppliers),a(),d("ngIf",!o.isLoading&&o.suppliers.length===0),a(),d("ngIf",o.showSupplierForm))},dependencies:[I,k,C,A,z,N,M,V,T,P,G],styles:[".supplier-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.supplier-modal[_ngcontent-%COMP%]{width:90%;max-height:90vh;overflow-y:auto;padding:var(--gutter-md);background:var(--background)}.supplier-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}"]})};export{D as SupplierManager};
