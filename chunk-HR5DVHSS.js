import{Za as A,_a as D}from"./chunk-4YFJNMVW.js";import{a as E,b as L,c as g,d as O,e as z,i as F,m as I,p as T,w as N,y as R}from"./chunk-QAJQXQTD.js";import{a as k,b as P,d as S}from"./chunk-Z644G36S.js";import{f as w,g as M}from"./chunk-XYJRESY4.js";import{k as y,u as C}from"./chunk-6ELNIGGB.js";import{Ab as u,Ha as r,Jb as f,Mb as m,Ob as x,Xa as _,ab as c,ca as p,mb as a,nb as n,ob as l,pb as s,yb as h}from"./chunk-DE3VKQQR.js";import{j as b}from"./chunk-4ZZIO3ZI.js";function j(i,o){i&1&&(n(0,"span"),m(1,"L'email \xE8 obbligatoria"),l())}function q(i,o){i&1&&(n(0,"span"),m(1,"Inserisci un'email valida"),l())}function B(i,o){if(i&1&&(n(0,"div",44),s(1,"lucide-angular",45),c(2,j,2,0,"span",46)(3,q,2,0,"span",46),l()),i&2){let e=u();r(),a("size",20),r(),a("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),r(),a("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function Y(i,o){i&1&&(n(0,"span"),m(1,"La password \xE8 obbligatoria"),l())}function U(i,o){i&1&&(n(0,"span"),m(1,"Minimo 6 caratteri"),l())}function $(i,o){if(i&1&&(n(0,"div",47),s(1,"lucide-angular",45),c(2,Y,2,0,"span",46)(3,U,2,0,"span",46),l()),i&2){let e=u();r(),a("size",20),r(),a("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.required),r(),a("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.minlength)}}function H(i,o){if(i&1&&(n(0,"div",48),s(1,"lucide-angular",49),m(2),l()),i&2){let e=u();f("text-red-500",!e.errorMessage.includes("effettuato"))("text-green-500",e.errorMessage.includes("effettuato")),r(),a("name",e.errorMessage.includes("effettuato")?"check-circle":"alert-triangle")("size",20),r(),x(" ",e.errorMessage," ")}}function J(i,o){i&1&&s(0,"span",50)}function K(i,o){i&1&&s(0,"lucide-angular",51),i&2&&a("size",20)}var G=class i{fb=p(N);authService=p(S);router=p(w);supabaseService=p(P);loginForm;isLoading=!1;errorMessage="";showPassword=!1;constructor(){this.loginForm=this.fb.group({email:["",[g.required,g.email]],password:["",[g.required,g.minLength(6)]],rememberMe:[!1]}),this.isProduction||this.prefillDemoCredentials()}onSubmit(){return b(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="";let{email:o,password:e,rememberMe:t}=this.loginForm.value;try{let d=yield this.authService.login(o,e,t);if(d.error){let v=d.error instanceof Error?d.error.message:String(d.error);this.errorMessage=this.getErrorMessage(v)}else if(d.data?.user){console.log("\u2705 Login effettuato con successo");let v=this.authService.getCurrentContext(),V={staff:"Dipendente",supplier:"Fornitore",customer:"Cliente"};this.errorMessage=`Accesso effettuato come ${V[v]}! Reindirizzamento...`,setTimeout(()=>{this.navigateBasedOnContext()},1e3)}}catch(d){console.error("Login error:",d),this.errorMessage="Errore durante il login. Riprova pi\xF9 tardi."}finally{this.isLoading=!1}})}checkStaffMembership(o){return b(this,null,function*(){try{let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from("restaurant_staff").select("*").eq("email",o.toLowerCase()).in("invitation_status",["accepted","pending"]);e&&e.length>0?console.log("\u{1F3AF} Utente trovato come staff member:",e):console.log("\u2139\uFE0F Utente non \xE8 staff member")}catch(e){console.log("\u2139\uFE0F Errore nel controllo staff membership:",e)}})}navigateBasedOnContext(){switch(this.authService.getCurrentContext()){case"staff":this.router.navigate(["/restaurant/dashboard"]);break;case"supplier":this.router.navigate(["/supplier/dashboard"]);break;case"customer":default:this.router.navigate(["/customer"]);break}}togglePasswordVisibility(){this.showPassword=!this.showPassword}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(o=>{this.loginForm.get(o)?.markAsTouched()})}getErrorMessage(o){return{"Invalid login credentials":"Email o password non validi.","Email not confirmed":"Email non confermata. Controlla la tua casella di posta.","Invalid email":"Email non valida.","Network error":"Errore di rete. Controlla la tua connessione.","Email rate limit exceeded":"Troppi tentativi. Riprova pi\xF9 tardi."}[o]||`Errore: ${o}`}prefillDemoCredentials(){console.log("Modalit\xE0 sviluppo: credenziali demo disponibili")}useDemoCredentials(o){o==="restaurant"?this.loginForm.patchValue({email:"ristorante@demo.com",password:"demodemo"}):this.loginForm.patchValue({email:"cliente@demo.com",password:"demodemo"})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}get isProduction(){return k.production}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-login"]],decls:61,vars:20,consts:[[1,"gradient-container"],[1,"sparkle"],[1,"floating-blob"],[1,"form-card","modal-md","mt-lg","mb-lg"],[1,"headerlogin","pb-lg","text-center"],[1,"flex","flex-col","items-center","gap-md"],["src","logoristoapp.png",1,"logopiccolo"],[1,"flex","flex-col","items-center"],[1,"text-md","font-bold"],[1,"text-muted","m-0"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-group","mb-lg"],[1,"standard-label"],["name","mail",1,"nav-icon",3,"size"],["id","email","formControlName","email","type","email","placeholder","tua.email@esempio.com"],["class","text-muted",4,"ngIf"],["name","lock",1,"nav-icon",3,"size"],[1,"flex","gap-sm","items-center"],["id","password","formControlName","password","placeholder","La tua password",1,"pr-[50px]",3,"type"],[1,"flex","gap-sm"],["type","button",1,"icon-button","absolute","right-sm","top-1/2","-translate-y-1/2","bg-transparent","border-none","text-[var(--text-muted)]","hover:text-[var(--primary)]",3,"click"],[1,"nav-icon",3,"name","size"],["class","p-sm my-sm rounded flex items-center gap-sm bg-[color-mix(in srgb,#ef444410%,transparent)] text-red-500 border border-[color-mix(in srgb,#ef444430%,transparent)]",4,"ngIf"],[1,"flex","justify-between","items-center","my-md"],[1,"checkbox-label","hover:bg-[var(--smoke-1)]"],["type","checkbox","formControlName","rememberMe"],[1,"checkbox-content"],["class","text-muted text-md mb-lg",3,"text-red-500","text-green-500",4,"ngIf"],[1,"flex","items-center","flex-col"],["type","submit",1,"promethea-button","w-full","hover-lift",3,"disabled"],["class","loading-spinner",4,"ngIf"],["name","log-in","class","nav-icon",3,"size",4,"ngIf"],[1,"my-xl","relative","text-center","p-md","mb-lg",2,"border-bottom","1px solid var(--smoke-1)"],[1,"absolute","inset-x-0","top-1/2","h-px","bg-[var(--smoke-1)]"],[1,"text-muted","mb-md","flex","flex-col","items-center"],[1,"text-center"],[1,"flex","gap-md","justify-center","flex-wrap"],["routerLink","/register/restaurant",1,"promethea-button","flex-1"],["name","utensils",3,"size"],["routerLink","/register/supplier",1,"promethea-button","flex-1"],["name","truck",1,"nav-icon",3,"size"],[1,"mt-lg","flex","flex-col","items-center"],["routerLink","/register/customer",1,"promethea-button","w-full"],["name","user",1,"nav-icon",3,"size"],[1,"text-muted"],["name","alert-circle",1,"nav-icon",3,"size"],[4,"ngIf"],[1,"p-sm","my-sm","rounded","flex","items-center","gap-sm","bg-[color-mix(in","srgb,#ef444410%,transparent)]","text-red-500","border","border-[color-mix(in","srgb,#ef444430%,transparent)]"],[1,"text-muted","text-md","mb-lg"],[1,"text-md",3,"name","size"],[1,"loading-spinner"],["name","log-in",1,"nav-icon",3,"size"]],template:function(e,t){e&1&&(n(0,"div",0),s(1,"div",1)(2,"div",1)(3,"div",1)(4,"div",2),n(5,"div",3)(6,"div",4)(7,"div",5),s(8,"img",6),n(9,"div",7)(10,"h1",8),m(11,"Bentornato"),l(),n(12,"p",9),m(13,"Accedi al tuo account"),l()()()(),n(14,"form",10),h("ngSubmit",function(){return t.onSubmit()}),n(15,"div",11)(16,"label",12),s(17,"lucide-angular",13),m(18," Email * "),l(),s(19,"input",14),c(20,B,4,3,"div",15),l(),n(21,"div",11)(22,"label",12),s(23,"lucide-angular",16),m(24," Password * "),l(),n(25,"div",17),s(26,"input",18),n(27,"div",19)(28,"button",20),h("click",function(){return t.togglePasswordVisibility()}),s(29,"lucide-angular",21),l()()(),c(30,$,4,3,"div",22),l(),n(31,"div",23)(32,"label",24),s(33,"input",25),n(34,"div",26)(35,"strong"),m(36,"Ricordami"),l()()()(),c(37,H,3,7,"div",27),n(38,"div",28)(39,"button",29),c(40,J,1,0,"span",30)(41,K,1,1,"lucide-angular",31),m(42),l()(),n(43,"div",32),s(44,"div",33),n(45,"span",34),m(46,"oppure"),l()(),n(47,"div",35)(48,"p",34),m(49,"Non hai un account?"),l(),n(50,"div",36)(51,"a",37),s(52,"lucide-angular",38),m(53," Registra Ristorante "),l(),n(54,"a",39),s(55,"lucide-angular",40),m(56," Registrati come Fornitore "),l()(),n(57,"div",41)(58,"a",42),s(59,"lucide-angular",43),m(60," Registrati come Cliente "),l()()()()()()),e&2&&(r(14),a("formGroup",t.loginForm),r(3),a("size",20),r(2),f("error",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),r(),a("ngIf",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),r(3),a("size",20),r(3),f("error",(t.password==null?null:t.password.invalid)&&(t.password==null?null:t.password.touched)),a("type",t.showPassword?"text":"password"),r(3),a("name",t.showPassword?"eye-off":"eye")("size",20),r(),a("ngIf",(t.password==null?null:t.password.invalid)&&(t.password==null?null:t.password.touched)),r(7),a("ngIf",t.errorMessage),r(2),a("disabled",t.isLoading||t.loginForm.invalid),r(),a("ngIf",t.isLoading),r(),a("ngIf",!t.isLoading),r(),x(" ",t.isLoading?"Accesso in corso...":"Accedi"," "),r(10),a("size",24),r(3),a("size",20),r(4),a("size",20))},dependencies:[C,y,R,F,L,E,O,z,I,T,M,D,A],styles:['[_nghost-%COMP%]{display:block;width:100%}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 3px color-mix(in srgb,#ef4444 20%,transparent)}.password-toggle[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:var(--gap-sm);border-radius:8px;transition:all .2s ease;position:absolute;right:var(--gap-sm);top:50%;transform:translateY(-50%)}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary);background:var(--smoke-1)}@media (max-width: 480px){.form-card[_ngcontent-%COMP%]{margin:var(--gap-md) auto;border-radius:16px}.section-header[_ngcontent-%COMP%]{padding:var(--gap-md)}}.gradient-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--background);padding:var(--gutter-sm);position:relative;overflow:hidden}.gradient-container[_ngcontent-%COMP%]:before, .gradient-container[_ngcontent-%COMP%]:after, .gradient-container[_ngcontent-%COMP%]   .floating-blob[_ngcontent-%COMP%]{content:"";position:absolute;border-radius:50%;filter:blur(90px);opacity:.22;pointer-events:none;animation:vapor 28s ease-in-out infinite}.gradient-container[_ngcontent-%COMP%]:before{width:700px;height:700px;background:radial-gradient(circle at 30%,var(--primary) 0%,transparent 65%);top:-20%;left:-15%;animation-delay:0s}.gradient-container[_ngcontent-%COMP%]:after{width:600px;height:600px;background:radial-gradient(circle at 40%,var(--secondary) 0%,transparent 70%);bottom:-10%;right:-10%;animation-delay:-9s}.gradient-container[_ngcontent-%COMP%]   .floating-blob[_ngcontent-%COMP%]{width:700px;height:700px;background:radial-gradient(circle at 30% 40%,var(--tertiary) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-14s;opacity:.15;filter:blur(100px)}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0) translate(0) rotate(0)}33%{transform:translateY(-40px) translate(30px) rotate(120deg)}66%{transform:translateY(30px) translate(-40px) rotate(240deg)}}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]{position:absolute;width:4px;height:4px;background:var(--secondary);border-radius:50%;opacity:0;animation:_ngcontent-%COMP%_sparkle 8s linear infinite}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(1){top:20%;left:15%;animation-delay:1s}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(2){top:70%;right:20%;animation-delay:3s}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(3){bottom:30%;left:30%;animation-delay:5s}@keyframes _ngcontent-%COMP%_sparkle{0%,to{opacity:0;transform:scale(0)}50%{opacity:.8;transform:scale(1)}}.gradient-container[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{border-radius:var(--fs-md)}.headerlogin[_ngcontent-%COMP%]{padding:var(--gap-md);border:2px solid var(--primary);border-radius:var(--gap-md);margin:var(--gap-lg);background:var(--background)}']})};export{G as Login};
