import{a as y}from"./chunk-KNL3CWA3.js";import{A as C}from"./chunk-DCWKKS33.js";import{$ as S,G as b,M as p,a as d,b as g,ea as f,f as n,m as h}from"./chunk-K5RDB55Y.js";var m=class u{supabaseService=f(C);authService=f(y);categoriesSubject=new h([]);categories$=this.categoriesSubject.asObservable();constructor(){this.authService.currentUser$.pipe(b(r=>!!r),p(1)).subscribe(()=>{this.loadCategories()})}loadCategories(){return n(this,null,function*(){try{let r=this.authService.currentUserValue;if(!r){console.log("No user found");return}let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",r.id).limit(1);if(t||!e||e.length===0){console.error("\u274C No restaurant found for user:",r.id);return}let s=e[0].id,{data:a,error:o}=yield this.supabaseService.getSupabaseClient().from("categories").select("*").eq("restaurant_id",s).order("order_index");if(o){console.error("Error loading categories:",o);return}console.log("Categories loaded:",a?.length),this.categoriesSubject.next(a||[])}catch(r){console.error("Error in loadCategories:",r)}})}getCategories(){return this.categoriesSubject.value}getDefaultCategory(){return this.categoriesSubject.value.find(r=>r.is_default)}createCategory(r){return n(this,null,function*(){try{let e=this.authService.currentUserValue;if(!e)return console.error("No user authenticated"),null;let{data:t,error:s}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",e.id).limit(1);if(s||!t||t.length===0)return console.error("\u274C No restaurant found for user:",e.id),null;let a=t[0].id,o=g(d({},r),{restaurant_id:a,created_at:new Date().toISOString()});console.log("\u{1F4DD} Creating category:",o);let{data:c,error:i}=yield this.supabaseService.getSupabaseClient().from("categories").insert(o).select().single();if(i)throw console.error("\u274C Error creating category:",i),i;return console.log("\u2705 Category created successfully"),yield this.loadCategories(),c}catch(e){return console.error("\u{1F4A5} Error in createCategory:",e),null}})}createCategoryForCurrentUser(r){return n(this,null,function*(){try{let e=this.authService.currentUserValue;if(!e)return console.error("No user authenticated"),null;let{data:t,error:s}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",e.id).limit(1);if(s||!t||t.length===0)return console.error("\u274C No restaurant found for user:",e.id),null;let a=t[0].id,o=yield this.getNextOrderIndex(a),c=g(d({},r),{restaurant_id:a,order_index:o,created_at:new Date().toISOString()});console.log("\u{1F4DD} Creating category:",c);let{data:i,error:l}=yield this.supabaseService.getSupabaseClient().from("categories").insert(c).select().single();if(l)throw console.error("\u274C Error creating category:",l),l;return console.log("\u2705 Category created successfully"),yield this.loadCategories(),i}catch(e){return console.error("\u{1F4A5} Error in createCategoryForCurrentUser:",e),null}})}getNextOrderIndex(r){return n(this,null,function*(){let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from("categories").select("order_index").eq("restaurant_id",r).order("order_index",{ascending:!1}).limit(1);return t||!e||e.length===0?0:e[0].order_index+1})}static \u0275fac=function(e){return new(e||u)};static \u0275prov=S({token:u,factory:u.\u0275fac,providedIn:"root"})};export{m as a};
