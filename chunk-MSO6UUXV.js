import{a as C}from"./chunk-ZTGLLAOR.js";import{a as y}from"./chunk-4E4RPIRA.js";import{a as w}from"./chunk-PNWRTRB7.js";import{a as O}from"./chunk-CBPMQ6KM.js";import{a as U}from"./chunk-CXV4BLDF.js";import{d as N,e as j,i as S,k as z,w as $}from"./chunk-L5SOXNIK.js";import{$a as T,Db as h,F as D,Ka as a,L as R,Lb as A,Mb as x,Ob as b,Pb as n,Qb as m,Rb as p,Sb as _,Yb as L,_ as k,da as v,eb as g,f as c,g as M,m as E,pb as d,qb as t,rb as i,sb as F,y as I}from"./chunk-KZSY5CHT.js";var f=class o{supabaseService=v($);authService=v(U);reviewsSubject=new E([]);reviews$=this.reviewsSubject.asObservable();constructor(){this.authService.currentUser$.pipe(D(r=>!!r),R(1)).subscribe(()=>{this.loadReviews()})}loadReviews(){return c(this,null,function*(){try{let r=this.authService.currentUserValue;if(!r){console.log("No user found");return}let{data:e,error:s}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",r.id).limit(1);if(s||!e||e.length===0){console.error("\u274C No restaurant found for user:",r.id);return}let l=e[0].id,{data:u,error:P}=yield this.supabaseService.getSupabaseClient().from("reviews").select("*").eq("restaurant_id",l).order("created_at",{ascending:!1});if(P){console.error("Error loading reviews:",P);return}console.log("Reviews loaded:",u?.length),this.reviewsSubject.next(u||[])}catch(r){console.error("Error in loadReviews:",r)}})}getAverageRating(){let r=this.reviewsSubject.value;if(r.length===0)return{average:0,count:0};let s=r.reduce((l,u)=>l+u.rating,0)/r.length;return{average:Math.round(s*10)/10,count:r.length}}static \u0275fac=function(e){return new(e||o)};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})};function B(o,r){o&1&&(t(0,"div",9),F(1,"div",10),t(2,"span"),n(3,"Caricamento dati dashboard..."),i()())}function H(o,r){if(o&1&&(t(0,"div",11)(1,"div",12)(2,"div",13)(3,"span",2),n(4,"receipt"),i(),t(5,"h3",14),n(6,"Ordini Oggi"),i()(),t(7,"div",15),n(8),i(),t(9,"div",16),n(10),i()(),t(11,"div",12)(12,"div",13)(13,"span",2),n(14,"event_available"),i(),t(15,"h3",14),n(16,"Prenotazioni Oggi"),i()(),t(17,"div",15),n(18),i(),t(19,"div",16),n(20),i()(),t(21,"div",12)(22,"div",13)(23,"span",2),n(24,"warning"),i(),t(25,"h3",14),n(26,"Scorte Basse"),i()(),t(27,"div",15),n(28),i(),t(29,"div",16),n(30," Attenzione necessaria "),i()(),t(31,"div",12)(32,"div",13)(33,"span",2),n(34,"star"),i(),t(35,"h3",14),n(36,"Valutazione Media"),i()(),t(37,"div",15),n(38),i(),t(39,"div",16),n(40),i()()()),o&2){let e=h();a(8),m(e.todayOrders),a(2),p("\u20AC",e.formatNumber(e.todayRevenue)),a(8),m(e.todayReservations),a(2),p("",e.upcomingReservations," in arrivo"),a(7),x("error",e.lowStockIngredients>0),a(),p(" ",e.lowStockIngredients," "),a(),x("error",e.lowStockIngredients>0),a(9),p("",e.averageRating,"/5"),a(2),p("",e.totalReviews," recensioni")}}function G(o,r){if(o&1&&(t(0,"div",21)(1,"div",22)(2,"div",23),n(3),i()(),t(4,"div",24),n(5),i()()),o&2){let e=r.$implicit,s=h(2);a(),A("height",e.amount/s.maxSales*100+"%"),a(2),p("\u20AC",s.formatNumber(e.amount,"1.0-0")),a(2),m(e.day)}}function W(o,r){if(o&1&&(t(0,"div",17)(1,"div",13)(2,"span",2),n(3,"trending_up"),i(),t(4,"h3",14),n(5,"Andamento Vendite Ultimi 7 Giorni"),i()(),t(6,"div",18)(7,"div",19),g(8,G,6,4,"div",20),i()()()),o&2){let e=h();a(8),d("ngForOf",e.salesData)}}function J(o,r){if(o&1&&(t(0,"div",35)(1,"div",36),n(2),i(),t(3,"div",37)(4,"strong"),n(5),i(),t(6,"span",4),n(7),i()(),t(8,"div",38),n(9),i()()),o&2){let e=r.$implicit,s=r.index,l=h(2);a(2),m(s+1),a(3),m(e.name),a(2),p("",e.orders," ordini"),a(2),p("\u20AC",l.formatNumber(e.revenue,"1.0-0"))}}function K(o,r){o&1&&(t(0,"div",39)(1,"span",2),n(2,"restaurant_menu"),i(),t(3,"p"),n(4,"Nessun piatto venduto ancora"),i()())}function Q(o,r){if(o&1&&(t(0,"div",40)(1,"div",41)(2,"strong"),n(3),i()(),t(4,"div",42)(5,"span"),n(6),i(),t(7,"span",4),n(8),i()(),t(9,"span",43),n(10),i()()),o&2){let e=r.$implicit;a(3),m(e.time),a(3),m(e.customer_name),a(2),_("",e.party_size," persone \u2022 ",e.table),a(),b(e.status),a(),m(e.status)}}function X(o,r){o&1&&(t(0,"div",39)(1,"span",2),n(2,"event_available"),i(),t(3,"p"),n(4,"Nessuna prenotazione in arrivo"),i()())}function Y(o,r){if(o&1&&(t(0,"div",44)(1,"div",45)(2,"strong"),n(3),i(),t(4,"span",43),n(5),i()(),t(6,"div",46)(7,"span"),n(8),i(),t(9,"span",4),n(10),i()(),t(11,"div",47),n(12),i()()),o&2){let e=r.$implicit,s=h(2);a(3),p("#",e.order_number),a(),b(e.status),a(),m(e.status),a(3),p("",e.items," articoli"),a(2),p("\u20AC",s.formatNumber(e.total)),a(2),m(e.time)}}function Z(o,r){o&1&&(t(0,"div",39)(1,"span",2),n(2,"check_circle"),i(),t(3,"p"),n(4,"Nessun ordine in corso"),i()())}function ee(o,r){if(o&1&&(t(0,"div",48)(1,"div",49)(2,"span",2),n(3,"warning"),i()(),t(4,"div",50)(5,"strong"),n(6),i(),t(7,"span",4),n(8),i()(),t(9,"div",51),n(10),i()()),o&2){let e=r.$implicit;a(2),x("warning",e.priority==="high")("info",e.priority==="medium"),a(4),m(e.ingredient_name),a(2),_("Scorta: ",e.current_stock," ",e.unit),a(),x("error",e.priority==="high"),a(),_(" ",e.current_stock,"/",e.minimum_stock," ")}}function te(o,r){o&1&&(t(0,"div",39)(1,"span",2),n(2,"inventory_2"),i(),t(3,"p"),n(4,"Nessun alert inventario"),i()())}function ie(o,r){if(o&1&&(t(0,"div",25)(1,"div",17)(2,"div",13)(3,"span",2),n(4,"local_fire_department"),i(),t(5,"h3",14),n(6,"Piatti Pi\xF9 Venduti"),i()(),t(7,"div",26),g(8,J,10,4,"div",27)(9,K,5,0,"div",28),i()(),t(10,"div",17)(11,"div",13)(12,"span",2),n(13,"schedule"),i(),t(14,"h3",14),n(15,"Prossime Prenotazioni"),i()(),t(16,"div",29),g(17,Q,11,7,"div",30)(18,X,5,0,"div",28),i()(),t(19,"div",17)(20,"div",13)(21,"span",2),n(22,"restaurant"),i(),t(23,"h3",14),n(24,"Ordini in Corso"),i()(),t(25,"div",31),g(26,Y,13,7,"div",32)(27,Z,5,0,"div",28),i()(),t(28,"div",17)(29,"div",13)(30,"span",2),n(31,"notification_important"),i(),t(32,"h3",14),n(33,"Alert Inventario"),i()(),t(34,"div",33),g(35,ee,11,11,"div",34)(36,te,5,0,"div",28),i()()()),o&2){let e=h();a(8),d("ngForOf",e.topDishes),a(),d("ngIf",e.topDishes.length===0),a(8),d("ngForOf",e.upcomingReservationsList),a(),d("ngIf",e.upcomingReservationsList.length===0),a(8),d("ngForOf",e.currentOrders),a(),d("ngIf",e.currentOrders.length===0),a(8),d("ngForOf",e.inventoryAlerts),a(),d("ngIf",e.inventoryAlerts.length===0)}}var V=class o{todayOrders=0;todayRevenue=0;todayReservations=0;upcomingReservations=0;lowStockIngredients=0;averageRating=0;totalReviews=0;salesData=[];topDishes=[];upcomingReservationsList=[];currentOrders=[];inventoryAlerts=[];isLoading=!0;subscriptions=new M;decimalPipe=v(S);ingredientService=v(y);orderService=v(C);reservationService=v(w);reviewService=v(f);dishService=v(O);ngOnInit(){return c(this,null,function*(){yield this.loadAllData(),this.subscriptions.add(I([this.ingredientService.ingredients$,this.orderService.orders$,this.reservationService.reservations$,this.reviewService.reviews$,this.dishService.dishes$]).subscribe(([r,e,s,l,u])=>{this.updateDashboardData()}))})}loadAllData(){return c(this,null,function*(){this.isLoading=!0;try{yield Promise.all([this.ingredientService.loadIngredients(),this.orderService.loadOrders(),this.reservationService.loadReservations(),this.reviewService.loadReviews(),this.dishService.loadDishes()]),yield this.updateDashboardData()}catch(r){console.error("Error loading dashboard data:",r)}finally{this.isLoading=!1}})}updateDashboardData(){return c(this,null,function*(){yield this.loadTodayOrders(),yield this.loadTodayReservations(),this.loadLowStockIngredients(),this.loadAverageRating(),yield this.loadSalesData(),yield this.loadTopDishes(),this.loadUpcomingReservations(),yield this.loadCurrentOrders(),this.loadInventoryAlerts()})}loadTodayOrders(){return c(this,null,function*(){let{count:r,revenue:e}=yield this.orderService.getTodayOrders();this.todayOrders=r,this.todayRevenue=e})}loadTodayReservations(){return c(this,null,function*(){let r=this.reservationService.getTodayReservations();this.todayReservations=r.length,this.upcomingReservations=this.reservationService.getUpcomingReservations().length})}loadLowStockIngredients(){this.lowStockIngredients=this.ingredientService.getLowStockIngredients().length}loadAverageRating(){let{average:r,count:e}=this.reviewService.getAverageRating();this.averageRating=r,this.totalReviews=e}loadSalesData(){return c(this,null,function*(){this.salesData=yield this.orderService.getLast7DaysSales()})}loadTopDishes(){return c(this,null,function*(){this.topDishes=yield this.orderService.getTopDishes(5)})}loadUpcomingReservations(){this.upcomingReservationsList=this.reservationService.getUpcomingReservationsForDashboard(4)}loadCurrentOrders(){return c(this,null,function*(){let r=this.orderService.getCurrentOrders(),e=yield Promise.all(r.slice(0,4).map(s=>c(this,null,function*(){let l=yield this.orderService.getOrderItemsCount(s.id);return{order_number:s.order_number,items:l,total:s.total_amount,status:s.status,time:this.formatTimeSince(s.created_at)}})));this.currentOrders=e})}loadInventoryAlerts(){let r=this.ingredientService.getLowStockIngredients();this.inventoryAlerts=r.slice(0,4).map(e=>({ingredient_name:e.name,current_stock:e.current_stock,minimum_stock:e.minimum_stock,unit:e.units?.symbol||"",priority:e.current_stock<=e.minimum_stock*.5?"high":"medium"}))}formatTimeSince(r){let e=new Date,s=new Date(r),l=Math.floor((e.getTime()-s.getTime())/6e4);return l<1?"Ora":l<60?`${l} min`:`${Math.floor(l/60)} h`}get maxSales(){return this.salesData.length===0?1:Math.max(...this.salesData.map(r=>r.amount),1)}formatNumber(r,e="1.2-2"){return this.decimalPipe.transform(r,e)||"0"}ngOnDestroy(){this.subscriptions.unsubscribe()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-dashboard"]],features:[L([S,y,C,w,f,O])],decls:13,vars:4,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],["class","loading-container",4,"ngIf"],["class","grid-cards",4,"ngIf"],["class","section-card",4,"ngIf"],["class","dashboard-grid",4,"ngIf"],[1,"loading-container"],[1,"loading-spinner"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"card-subtitle"],[1,"section-card"],[1,"sales-chart"],[1,"chart-bars"],["class","chart-bar-container",4,"ngFor","ngForOf"],[1,"chart-bar-container"],[1,"chart-bar"],[1,"bar-amount"],[1,"bar-label"],[1,"dashboard-grid"],[1,"top-dishes"],["class","dish-item",4,"ngFor","ngForOf"],["class","empty-state-small",4,"ngIf"],[1,"reservations-list"],["class","reservation-item",4,"ngFor","ngForOf"],[1,"orders-list"],["class","order-item",4,"ngFor","ngForOf"],[1,"alerts-list"],["class","alert-item",4,"ngFor","ngForOf"],[1,"dish-item"],[1,"dish-rank"],[1,"dish-info"],[1,"dish-revenue"],[1,"empty-state-small"],[1,"reservation-item"],[1,"reservation-time"],[1,"reservation-details"],[1,"chip"],[1,"order-item"],[1,"order-header"],[1,"order-details"],[1,"order-time"],[1,"alert-item"],[1,"alert-icon"],[1,"alert-content"],[1,"alert-stock"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"div",1)(2,"span",2),n(3,"dashboard"),i(),t(4,"div",3)(5,"h1"),n(6,"Dashboard Ristorante"),i(),t(7,"p",4),n(8,"Panoramica completa delle attivit\xE0 del tuo ristorante"),i()()(),g(9,B,4,0,"div",5)(10,H,41,11,"div",6)(11,W,9,1,"div",7)(12,ie,37,8,"div",8),i()),e&2&&(a(9),d("ngIf",s.isLoading),a(),d("ngIf",!s.isLoading),a(),d("ngIf",!s.isLoading),a(),d("ngIf",!s.isLoading))},dependencies:[z,N,j],styles:[".dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px}.section-card[_ngcontent-%COMP%]{background:var(--card-bg);border-radius:12px;padding:24px;border:1px solid var(--border-color)}.sales-chart[_ngcontent-%COMP%]{margin-top:16px}.chart-bars[_ngcontent-%COMP%]{display:flex;align-items:end;gap:16px;height:200px;padding:20px 0}.chart-bar-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;height:100%}.chart-bar[_ngcontent-%COMP%]{background:linear-gradient(180deg,var(--primary-color) 0%,var(--primary-dark) 100%);border-radius:8px 8px 0 0;width:40px;min-height:40px;position:relative;transition:all .3s ease}.chart-bar[_ngcontent-%COMP%]:hover{opacity:.8;transform:scale(1.05)}.bar-amount[_ngcontent-%COMP%]{position:absolute;top:-25px;left:50%;transform:translate(-50%);background:var(--text-color);color:var(--bg-color);padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600;white-space:nowrap}.bar-label[_ngcontent-%COMP%]{margin-top:8px;font-weight:600;color:var(--text-muted);font-size:12px}.top-dishes[_ngcontent-%COMP%]{margin-top:16px}.dish-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.dish-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dish-rank[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;margin-right:12px}.dish-info[_ngcontent-%COMP%]{flex:1}.dish-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:2px}.dish-revenue[_ngcontent-%COMP%]{font-weight:600;color:var(--success-color)}.reservations-list[_ngcontent-%COMP%]{margin-top:16px}.reservation-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.reservation-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.reservation-time[_ngcontent-%COMP%]{min-width:60px;margin-right:16px}.reservation-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.orders-list[_ngcontent-%COMP%]{margin-top:16px}.order-item[_ngcontent-%COMP%]{padding:12px 0;border-bottom:1px solid var(--border-light)}.order-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:center;margin-bottom:4px}.order-details[_ngcontent-%COMP%]{display:flex;justify-content:between;margin-bottom:4px}.order-time[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted)}.alerts-list[_ngcontent-%COMP%]{margin-top:16px}.alert-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.alert-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.alert-icon[_ngcontent-%COMP%]{margin-right:12px}.alert-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--warning-color)}.alert-icon[_ngcontent-%COMP%]   .material-icons.warning[_ngcontent-%COMP%]{color:var(--error-color)}.alert-icon[_ngcontent-%COMP%]   .material-icons.info[_ngcontent-%COMP%]{color:var(--info-color)}.alert-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.alert-stock[_ngcontent-%COMP%]{font-weight:600}.alert-stock.error[_ngcontent-%COMP%]{color:var(--error-color)}.chip[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:600;text-transform:capitalize}.chip.confirmed[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success-color)}.chip.pending[_ngcontent-%COMP%]{background:var(--warning-light);color:var(--warning-color)}.chip.preparing[_ngcontent-%COMP%]{background:var(--info-light);color:var(--info-color)}.chip.ready[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success-color)}@media (max-width: 768px){.dashboard-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.chart-bars[_ngcontent-%COMP%]{gap:8px}.chart-bar[_ngcontent-%COMP%]{width:30px}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid var(--border-light);border-top:4px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.empty-state-small[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center;color:var(--text-muted)}.empty-state-small[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px;opacity:.5}.empty-state-small[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}"]})};export{V as Dashboard};
