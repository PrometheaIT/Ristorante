import{a as U}from"./chunk-WUX2K4S7.js";import{b as $,d as j,h as Y,j as q,p as G,q as H,r as J,w as K}from"./chunk-77SKEQNN.js";import{a as Q}from"./chunk-7V5YPNIB.js";import"./chunk-KNL3CWA3.js";import{d as z,e as R,i as W,j as L,k as V,t as A}from"./chunk-DCWKKS33.js";import{$b as g,Db as u,Eb as m,La as o,Nb as P,Pb as E,Qb as n,Rb as B,Sb as d,Tb as T,Vb as x,Wb as b,Xb as M,ab as F,bc as f,cc as k,ea as C,f as w,fb as _,ja as S,ka as y,qb as p,rb as i,sb as t,xb as O,yb as N,zb as D}from"./chunk-K5RDB55Y.js";function Z(l,a){if(l&1&&(i(0,"option",37),n(1),t()),l&2){let e=a.$implicit;p("value",e.id),o(),d(" ",e.name," ")}}function ee(l,a){if(l&1&&(i(0,"span",38),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function te(l,a){if(l&1&&(i(0,"span",38),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ie(l,a){if(l&1&&(i(0,"span",38),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ne(l,a){if(l&1&&(i(0,"span",38),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ae(l,a){if(l&1&&(i(0,"tr",39)(1,"td",40)(2,"div",41)(3,"span",4),n(4,"folder"),t(),n(5),i(6,"span",42),n(7),t()()()()),l&2){let e=m().$implicit,r=m();o(5),d(" ",e.name," "),o(2),d(" ",r.getDishesByCategory(e.id).length," piatti ")}}function re(l,a){if(l&1&&(i(0,"div",49),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),T(" ",k(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function oe(l,a){if(l&1&&(i(0,"span",8),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function le(l,a){l&1&&(i(0,"span",8),n(1,"-"),t())}function se(l,a){if(l&1){let e=D();i(0,"tr")(1,"td")(2,"div",43)(3,"div",44)(4,"strong",45),u("click",function(){let c=S(e).$implicit,s=m(2);return y(s.editDish(c.id))}),n(5),t(),_(6,re,3,6,"div",46),t()()(),i(7,"td"),n(8),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"select",47),u("ngModelChange",function(c){let s=S(e).$implicit,h=m(2);return y(h.updateDishStatus(s,c))}),i(22,"option",18),n(23,"Disponibile"),t(),i(24,"option",19),n(25,"Non disponibile"),t(),i(26,"option",20),n(27,"Esaurito"),t()()(),i(28,"td"),_(29,oe,2,1,"span",48)(30,le,2,0,"span",48),t()()}if(l&2){let e=a.$implicit,r=m(2);o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(2),B(r.getCategoryName(e.category_id||"")),o(3),d("\u20AC",f(12,17,e.base_price,"1.2-2")),o(3),d("",f(15,20,r.calculateFoodCostPercentage(e),"1.0-1"),"%"),o(3),E(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",f(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),P("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),p("ngModel",e.status),o(8),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function ce(l,a){if(l&1&&(O(0),_(1,ae,8,2,"tr",33)(2,se,31,26,"tr",32),N()),l&2){let e=a.$implicit,r=m();o(),p("ngIf",r.getDishesByCategory(e.id).length>0),o(),p("ngForOf",r.getDishesByCategory(e.id))}}function de(l,a){if(l&1&&(i(0,"tr",39)(1,"td",50)(2,"div",41)(3,"span",4),n(4,"folder_open"),t(),n(5," Senza Categoria "),i(6,"span",42),n(7),t()()()()),l&2){let e=m();o(7),d(" ",e.getDishesByCategory("").length," piatti ")}}function pe(l,a){if(l&1&&(i(0,"div",49),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),T(" ",k(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function me(l,a){if(l&1&&(i(0,"span",8),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function ue(l,a){l&1&&(i(0,"span",8),n(1,"-"),t())}function ge(l,a){if(l&1){let e=D();i(0,"tr")(1,"td")(2,"div",43)(3,"div",44)(4,"strong",45),u("click",function(){let c=S(e).$implicit,s=m();return y(s.editDish(c.id))}),n(5),t(),_(6,pe,3,6,"div",46),t()()(),i(7,"td",8),n(8,"-"),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"span"),n(22),g(23,"number"),t()(),i(24,"td")(25,"span",51),n(26),t()(),i(27,"td"),_(28,me,2,1,"span",48)(29,ue,2,0,"span",48),t()()}if(l&2){let e=a.$implicit,r=m();o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(5),d("\u20AC",f(12,17,e.base_price,"1.2-2")),o(3),d("\u20AC",f(15,20,e.food_cost,"1.2-2")),o(3),E(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",f(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),E(r.calculateMarginPercentage(e)>=0?"text-muted":"error"),o(),d(" ",f(23,26,r.calculateMarginPercentage(e),"1.0-0"),"% "),o(3),P("active",e.status==="available")("inactive",e.status!=="available"),o(),d(" ",r.getStatusText(e.status)," "),o(2),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function _e(l,a){l&1&&(i(0,"tr")(1,"td",52)(2,"span",53),n(3,"search_off"),t(),i(4,"h3"),n(5,"Nessun piatto trovato"),t(),i(6,"p"),n(7,"Prova a modificare i filtri di ricerca"),t()()())}var X=class l{dishService=C(Q);categoryService=C(U);router=C(A);dishes=[];categories=[];filteredDishes=[];stats={totalDishes:0,totalCategories:0,averageFoodCost:0,averageMargin:0,averagePrice:0};searchTerm="";selectedCategory="all";statusFilter="all";priceRange={min:null,max:null};sortField="name";sortDirection="asc";ngOnInit(){this.loadData()}loadData(){return w(this,null,function*(){yield this.dishService.loadDishes(),yield this.categoryService.loadCategories(),this.dishService.dishes$.subscribe(a=>{this.dishes=a,this.applyFilters(),this.calculateStats()}),this.categoryService.categories$.subscribe(a=>{this.categories=a,this.calculateStats()})})}calculateStats(){let a=this.dishes.length,e=this.categories.length,r=this.dishes.reduce((h,v)=>h+(v.food_cost||0),0),c=this.dishes.reduce((h,v)=>h+(v.base_price||0),0),s=this.dishes.reduce((h,v)=>{let I=(v.base_price||0)-(v.food_cost||0);return h+(I>0?I:0)},0);this.stats={totalDishes:a,totalCategories:e,averageFoodCost:a>0?r/a:0,averageMargin:a>0?s/a:0,averagePrice:a>0?c/a:0}}applyFilters(){let a=[...this.dishes];this.searchTerm&&(a=a.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description?.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.selectedCategory!=="all"&&(a=a.filter(e=>e.category_id===this.selectedCategory)),this.statusFilter!=="all"&&(a=a.filter(e=>e.status===this.statusFilter)),this.priceRange.min!==null&&(a=a.filter(e=>e.base_price>=this.priceRange.min)),this.priceRange.max!==null&&(a=a.filter(e=>e.base_price<=this.priceRange.max)),a.sort((e,r)=>{let c,s;switch(this.sortField){case"name":c=e.name.toLowerCase(),s=r.name.toLowerCase();break;case"price":c=e.base_price,s=r.base_price;break;case"food_cost":c=e.food_cost,s=r.food_cost;break;case"margin":c=e.base_price-e.food_cost,s=r.base_price-r.food_cost;break;default:c=e.name.toLowerCase(),s=r.name.toLowerCase()}return c<s?this.sortDirection==="asc"?-1:1:c>s?this.sortDirection==="asc"?1:-1:0}),this.filteredDishes=a}onSort(a){this.sortField===a?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=a,this.sortDirection="asc"),a==="food_cost_percentage"&&(this.sortField="food_cost"),this.applyFilters()}getCategoryName(a){return this.categories.find(r=>r.id===a)?.name||"Senza categoria"}calculateMargin(a){return a.base_price-a.food_cost}calculateMarginPercentage(a){return a.base_price===0?0:(a.base_price-a.food_cost)/a.base_price*100}getDishesByCategory(a){return this.filteredDishes.filter(e=>e.category_id===a)}resetFilters(){this.searchTerm="",this.selectedCategory="all",this.statusFilter="all",this.priceRange={min:null,max:null},this.applyFilters()}getStatusText(a){return{available:"Disponibile",unavailable:"Non disponibile",out_of_stock:"Esaurito"}[a]||a}editDish(a){this.router.navigate(["/food-cost-calculator",a])}createNewDish(){this.router.navigate(["/food-cost-calculator"])}calculateFoodCostPercentage(a){return!a.base_price||a.base_price===0?0:a.food_cost/a.base_price*100}updateDishStatus(a,e){return w(this,null,function*(){try{let r=a.status;e==="available"||e==="unavailable"||e==="out_of_stock"?(a.status=e,(yield this.dishService.updateDish(a.id,{status:e}))?(console.log(`Stato piatto ${a.name} aggiornato a: ${e}`),this.calculateStats()):(a.status=r,console.error("Errore nell'aggiornamento dello stato del piatto"),alert("Errore durante l'aggiornamento dello stato. Riprova."))):(console.error("Stato non valido:",e),alert("Stato non valido selezionato."))}catch(r){console.error("Errore durante l'aggiornamento dello stato:",r),alert("Errore durante l'aggiornamento dello stato.")}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=F({type:l,selectors:[["app-menu-builder"]],decls:146,vars:28,consts:[[1,"page-container"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"material-icons"],[1,"card-title"],[1,"card-content"],[1,"card-number"],[1,"text-muted"],[1,"form-card",2,"margin-top","var(--gutter-lg)"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],["type","text","placeholder","Cerca per nome o descrizione...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["value","available"],["value","unavailable"],["value","out_of_stock"],[2,"display","flex","gap","var(--gutter-sm)"],["type","number","placeholder","Min",2,"width","80px",3,"ngModelChange","input","ngModel"],[2,"align-self","center"],["type","number","placeholder","Max",2,"width","80px",3,"ngModelChange","input","ngModel"],[1,"actions-container"],[1,"promethea-button","ghost",3,"click"],[1,"table-section"],[1,"table-container"],[1,"crm-table"],[2,"cursor","pointer",3,"click"],["class","material-icons","style","font-size: 14px;",4,"ngIf"],[4,"ngFor","ngForOf"],["class","category-header",4,"ngIf"],[4,"ngIf"],[1,"actions-container",2,"margin-top","var(--gutter-lg)"],[1,"promethea-button",3,"click"],[3,"value"],[1,"material-icons",2,"font-size","14px"],[1,"category-header"],["colspan","8",2,"background","var(--smoke-color-2)","font-weight","800"],[1,"section-title",2,"margin","0","border","none"],[1,"chip",2,"margin-left","auto"],[1,"user-info-compact"],[1,"nomedescpiatto"],[1,"clickable-dish-name",3,"click"],["class","text-muted","style","font-size: 0.8rem;",4,"ngIf"],[1,"status-select",3,"ngModelChange","ngModel"],["class","text-muted",4,"ngIf"],[1,"text-muted",2,"font-size","0.8rem"],["colspan","8",2,"background","var(--smoke-color-1)","font-weight","800"],[1,"chip"],["colspan","8",1,"empty-state"],[1,"material-icons",2,"font-size","48px","opacity","0.5"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"h1"),n(2,"Menu Builder"),t(),i(3,"div",1)(4,"div",2)(5,"div",3)(6,"span",4),n(7,"restaurant"),t(),i(8,"h3",5),n(9,"Totale Piatti"),t()(),i(10,"div",6)(11,"div",7),n(12),t(),i(13,"span",8),n(14,"Piatti nel men\xF9"),t()()(),i(15,"div",2)(16,"div",3)(17,"span",4),n(18,"category"),t(),i(19,"h3",5),n(20,"Categorie"),t()(),i(21,"div",6)(22,"div",7),n(23),t(),i(24,"span",8),n(25,"Categorie attive"),t()()(),i(26,"div",2)(27,"div",3)(28,"span",4),n(29,"euro"),t(),i(30,"h3",5),n(31,"Prezzo Medio"),t()(),i(32,"div",6)(33,"div",7),n(34),g(35,"number"),t(),i(36,"span",8),n(37,"Prezzo medio piatto"),t()()(),i(38,"div",2)(39,"div",3)(40,"span",4),n(41,"trending_up"),t(),i(42,"h3",5),n(43,"Margine Medio"),t()(),i(44,"div",6)(45,"div",7),n(46),g(47,"number"),t(),i(48,"span",8),n(49,"Margine medio piatto"),t()()(),i(50,"div",2)(51,"div",3)(52,"span",4),n(53,"account_balance"),t(),i(54,"h3",5),n(55,"Food Cost Medio"),t()(),i(56,"div",6)(57,"div",7),n(58),g(59,"number"),t(),i(60,"span",8),n(61,"Costo medio piatto"),t()()()(),i(62,"div",9)(63,"div",10)(64,"div",11)(65,"div",12)(66,"label",13)(67,"span",4),n(68,"search"),t(),n(69," Cerca "),t(),i(70,"input",14),M("ngModelChange",function(s){return b(r.searchTerm,s)||(r.searchTerm=s),s}),u("input",function(){return r.applyFilters()}),t()(),i(71,"div",12)(72,"label",13)(73,"span",4),n(74,"category"),t(),n(75," Categoria "),t(),i(76,"select",15),M("ngModelChange",function(s){return b(r.selectedCategory,s)||(r.selectedCategory=s),s}),u("change",function(){return r.applyFilters()}),i(77,"option",16),n(78,"Tutte le categorie"),t(),_(79,Z,2,2,"option",17),t()(),i(80,"div",12)(81,"label",13)(82,"span",4),n(83,"visibility"),t(),n(84," Stato "),t(),i(85,"select",15),M("ngModelChange",function(s){return b(r.statusFilter,s)||(r.statusFilter=s),s}),u("change",function(){return r.applyFilters()}),i(86,"option",16),n(87,"Tutti gli stati"),t(),i(88,"option",18),n(89,"Disponibile"),t(),i(90,"option",19),n(91,"Non disponibile"),t(),i(92,"option",20),n(93,"Esaurito"),t()()(),i(94,"div",12)(95,"label",13)(96,"span",4),n(97,"euro"),t(),n(98," Prezzo "),t(),i(99,"div",21)(100,"input",22),M("ngModelChange",function(s){return b(r.priceRange.min,s)||(r.priceRange.min=s),s}),u("input",function(){return r.applyFilters()}),t(),i(101,"span",23),n(102,"-"),t(),i(103,"input",24),M("ngModelChange",function(s){return b(r.priceRange.max,s)||(r.priceRange.max=s),s}),u("input",function(){return r.applyFilters()}),t()()()(),i(104,"div",25)(105,"button",26),u("click",function(){return r.resetFilters()}),i(106,"span",4),n(107,"refresh"),t(),n(108," Reset "),t()()()(),i(109,"div",27)(110,"div",28)(111,"table",29)(112,"thead")(113,"tr")(114,"th",30),u("click",function(){return r.onSort("name")}),n(115," Nome "),_(116,ee,2,1,"span",31),t(),i(117,"th"),n(118,"Categoria"),t(),i(119,"th",30),u("click",function(){return r.onSort("price")}),n(120," Prezzo "),_(121,te,2,1,"span",31),t(),i(122,"th",30),u("click",function(){return r.onSort("food_cost_percentage")}),n(123," Food Cost % "),_(124,ie,2,1,"span",31),t(),i(125,"th",30),u("click",function(){return r.onSort("margin")}),n(126," Margine (\u20AC) "),_(127,ne,2,1,"span",31),t(),i(128,"th"),n(129,"Stato"),t(),i(130,"th"),n(131,"Tempo Prep."),t()()(),i(132,"tbody"),_(133,ce,3,2,"ng-container",32)(134,de,8,1,"tr",33)(135,ge,30,29,"tr",32)(136,_e,8,0,"tr",34),t()()()(),i(137,"div",35)(138,"button",36),u("click",function(){return r.createNewDish()}),i(139,"span",4),n(140,"add"),t(),n(141," Nuovo Piatto "),t(),i(142,"button",26),u("click",function(){return r.resetFilters()}),i(143,"span",4),n(144,"refresh"),t(),n(145," Reset Filtri "),t()()()),e&2&&(o(12),B(r.stats.totalDishes),o(11),B(r.stats.totalCategories),o(11),d("\u20AC",f(35,19,r.stats.averagePrice,"1.2-2")),o(12),d("\u20AC",f(47,22,r.stats.averageMargin,"1.2-2")),o(12),d("\u20AC",f(59,25,r.stats.averageFoodCost,"1.2-2")),o(12),x("ngModel",r.searchTerm),o(6),x("ngModel",r.selectedCategory),o(3),p("ngForOf",r.categories),o(6),x("ngModel",r.statusFilter),o(15),x("ngModel",r.priceRange.min),o(3),x("ngModel",r.priceRange.max),o(13),p("ngIf",r.sortField==="name"),o(5),p("ngIf",r.sortField==="price"),o(3),p("ngIf",r.sortField==="food_cost_percentage"),o(3),p("ngIf",r.sortField==="margin"),o(6),p("ngForOf",r.categories),o(),p("ngIf",r.getDishesByCategory("").length>0),o(),p("ngForOf",r.getDishesByCategory("")),o(),p("ngIf",r.filteredDishes.length===0))},dependencies:[V,z,R,K,H,J,$,q,G,j,Y,L,W],styles:[".category-header[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.category-header[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gutter-md)!important}.crm-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(.category-header):hover{background:var(--smoke-color-1)}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.nomedescpiatto[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:calc(var(--gutter-sm) / 2)}.clickable-dish-name[_ngcontent-%COMP%]{cursor:pointer;color:var(--primary);transition:color .2s ease;text-decoration:none;border-bottom:1px solid transparent}.clickable-dish-name[_ngcontent-%COMP%]:hover{color:var(--tertiary);border-bottom:1px solid var(--tertiary)}.clickable-dish-name[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.crm-table[_ngcontent-%COMP%]{min-width:800px}}.status-select[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;border:1px solid #ddd;font-size:.875rem;cursor:pointer;transition:all .2s ease;background:#fff}.status-select.available[_ngcontent-%COMP%]{border-color:var(--success-color, #28a745);background-color:#28a7451a}.status-select.unavailable[_ngcontent-%COMP%]{border-color:var(--warning-color, #ffc107);background-color:#ffc1071a}.status-select.out_of_stock[_ngcontent-%COMP%]{border-color:var(--danger-color, #dc3545);background-color:#dc35451a}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}.chip.active[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.chip.inactive[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}"]})};export{X as MenuBuilder};
