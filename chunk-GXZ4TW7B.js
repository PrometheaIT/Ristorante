import{a as mt}from"./chunk-KPJC6OK7.js";import"./chunk-5IWPPMA3.js";import"./chunk-MEGBB4Y7.js";import{Ta as ct,Ua as dt}from"./chunk-PTJ2A6G7.js";import{a as ut}from"./chunk-XFSCUQW4.js";import{a as J,b as K,d as Y,e as Z,h as tt,i as et,m as it,p as nt,r as rt,s as ot,w as at,x as st,y as lt}from"./chunk-22BNR7AL.js";import{b as Q,d as X}from"./chunk-UOPXUV3F.js";import"./chunk-6GCWWUP3.js";import{j as U,k as q,s as H}from"./chunk-N5RTTLWI.js";import{Ab as $,Bb as B,Cb as L,D as O,Ea as T,Fb as E,Gb as W,H as F,Ha as c,Hb as G,Ib as a,Jb as C,Kb as y,Lb as z,Ob as k,Pb as P,Qb as I,Tb as w,U as M,Xa as j,ab as g,ca as b,f as V,ia as m,ib as d,ja as p,jb as r,kb as o,lb as S,rb as f,ub as h,wb as u}from"./chunk-R56C6QW6.js";import{a as A,b as N,j as _}from"./chunk-4ZZIO3ZI.js";var ht=["fileInput"],gt=()=>[1,2,3,4,5,6,7,8],R=()=>({standalone:!0});function _t(s,i){if(s&1){let t=f();r(0,"button",42),h("click",function(){m(t);let e=u().index,l=u();return p(l.deleteShift(e))}),S(1,"lucide-angular",43),o()}s&2&&(c(),d("size",20))}function ft(s,i){if(s&1&&(r(0,"span",33),a(1),o()),s&2){let t=i.$implicit,n=i.index,e=u().$implicit,l=u();E("active",l.isDaySelected(e.days_of_week,n))("warning",!l.isDaySelected(e.days_of_week,n)),c(),y(" ",t," ")}}function vt(s,i){if(s&1){let t=f();r(0,"div",28)(1,"div",29)(2,"div",30)(3,"h3",31),a(4),o(),r(5,"div",32)(6,"span",33)(7,"span",34),a(8,"access_time"),o(),a(9),o(),r(10,"span",33),a(11),o()()(),r(12,"div",35)(13,"button",36),h("click",function(){let e=m(t).index,l=u();return p(l.toggleShiftActive(e))}),r(14,"span",37),a(15),o()(),r(16,"button",38),h("click",function(){let e=m(t).index,l=u();return p(l.editShift(e))}),r(17,"span",37),a(18,"edit"),o()(),g(19,_t,2,1,"button",39),o()(),r(20,"div",40),g(21,ft,2,5,"span",41),o()()}if(s&2){let t=i.$implicit,n=u();c(4),C(t.name),c(5),z(" ",t.start_time.substring(0,5)," - ",t.end_time.substring(0,5)," "),c(),G(t.is_active?"active":"warning"),c(),y(" ",t.is_active?"Attivo":"Disattivato"," "),c(2),E("text-green-500",!t.is_active)("text-orange-500",t.is_active),d("title",t.is_active?"Disattiva turno":"Attiva turno"),c(2),y(" ",t.is_active?"pause":"play_arrow"," "),c(4),d("ngIf",n.shifts.length>1),c(2),d("ngForOf",n.weekDays)}}function xt(s,i){if(s&1){let t=f();r(0,"button",44),h("click",function(){m(t);let e=u();return p(e.addNewShift())}),S(1,"lucide-angular",45),a(2," Aggiungi Nuovo Turno "),o()}s&2&&(c(),d("size",20))}function St(s,i){if(s&1&&(r(0,"option",64),a(1),o()),s&2){let t=i.$implicit,n=u(2).$implicit;d("value",t)("selected",(n==null?null:n.display_order)===t),c(),y(" ",t," ")}}function yt(s,i){if(s&1){let t=f();r(0,"div",60)(1,"label",61),a(2,"Posizione:"),o(),r(3,"select",62),h("change",function(e){m(t);let l=u().index,v=u(2);return p(v.onPhotoOrderChange(l,e))}),g(4,St,2,3,"option",63),o()()}if(s&2){let t=u(3);c(3),d("disabled",t.loadingPhotos),c(),d("ngForOf",w(2,gt))}}function bt(s,i){if(s&1){let t=f();r(0,"div",65)(1,"img",66),h("error",function(e){m(t);let l=u().index,v=u(2);return p(v.onImageError(e,l))}),o(),r(2,"div",67)(3,"span",37),a(4,"zoom_in"),o()()()}if(s&2){let t=u().$implicit;c(),d("src",t.url,T)("alt","Foto "+t.display_order)}}function wt(s,i){if(s&1&&(r(0,"div",68)(1,"span",69),a(2,"add_photo_alternate"),o(),r(3,"p",70),a(4),o()()),s&2){let t=u().index;c(4),y("Slot ",t+1," vuoto")}}function Et(s,i){if(s&1){let t=f();r(0,"button",71),h("click",function(){m(t);let e=u().index,l=u(2);return p(l.deletePhoto(e))}),S(1,"lucide-angular",43),o()}if(s&2){let t=u(3);d("disabled",t.loadingPhotos),c(),d("size",20)}}function Ct(s,i){if(s&1){let t=f();r(0,"div",51)(1,"div",52)(2,"div",33),a(3),o(),g(4,yt,5,3,"div",53),o(),r(5,"div",54),h("click",function(){let e=m(t),l=e.$implicit,v=e.index,x=u(2);return p(l?x.openPhoto(l,v):null)}),g(6,bt,5,2,"div",55)(7,wt,5,1,"div",56),o(),r(8,"div",57)(9,"button",58),h("click",function(){let e=m(t).index,l=u(2);return p(l.triggerFileInput(e))}),r(10,"span",37),a(11),o()(),g(12,Et,2,2,"button",59),o()()}if(s&2){let t=i.$implicit,n=i.index,e=u(2);c(3),C(n+1),c(),d("ngIf",t),c(),W(t?"border: 2px solid var(--smoke-2); background: transparent;":"border: 2px dashed var(--smoke-1); background: var(--smoke-1);"),E("has-photo",t),c(),d("ngIf",t),c(),d("ngIf",!t),c(2),d("title",t?"Sostituisci foto":"Aggiungi foto")("disabled",e.loadingPhotos),c(2),C(t?"camera_alt":"add_a_photo"),c(),d("ngIf",t)}}function kt(s,i){s&1&&(r(0,"div",72),S(1,"div",73),r(2,"p",12),a(3,"Caricamento in corso..."),o()())}function Pt(s,i){if(s&1){let t=f();r(0,"div",3)(1,"div",4)(2,"span",5),a(3,"photo_library"),o(),r(4,"h2",6),a(5,"Galleria Foto del Ristorante"),o()(),r(6,"p",46),a(7," Carica fino a 5 foto (max 10MB ciascuna) per mostrare il tuo ristorante ai clienti. Solo immagini sono permesse. "),o(),r(8,"input",47,0),h("change",function(e){m(t);let l=u();return p(l.onPhotoFileSelected(e))}),o(),r(10,"div",48)(11,"div",7),g(12,Ct,13,12,"div",49),o(),g(13,kt,4,0,"div",50),o()()}if(s&2){let t=u();c(8),d("disabled",t.loadingPhotos),c(2),E("loading",t.loadingPhotos),c(2),d("ngForOf",t.photos)("ngForTrackBy",t.trackByIndex),c(),d("ngIf",t.loadingPhotos)}}function It(s,i){if(s&1){let t=f();r(0,"button",86),h("click",function(e){return m(t),u(2).navigateFullscreenPhoto("prev"),p(e.stopPropagation())}),r(1,"span",37),a(2,"chevron_left"),o()()}}function Mt(s,i){if(s&1){let t=f();r(0,"button",87),h("click",function(e){return m(t),u(2).navigateFullscreenPhoto("next"),p(e.stopPropagation())}),r(1,"span",37),a(2,"chevron_right"),o()()}}function Rt(s,i){if(s&1&&(r(0,"div",88),a(1),o()),s&2){let t=u(2);c(),z(" ",t.currentPhotoIndex+1," / ",t.photos.length," ")}}function Vt(s,i){if(s&1){let t=f();r(0,"div",74),h("click",function(){m(t);let e=u();return p(e.closeFullscreenPhoto())}),r(1,"div",75),h("click",function(e){return m(t),p(e.stopPropagation())}),r(2,"div",76)(3,"h2",77)(4,"span",37),a(5,"photo"),o(),a(6," Galleria Foto "),o(),r(7,"button",78),h("click",function(){m(t);let e=u();return p(e.closeFullscreenPhoto())}),r(8,"span",37),a(9,"close"),o()()(),r(10,"div",79)(11,"div",80),g(12,It,3,0,"button",81),r(13,"div",82),S(14,"img",83),o(),g(15,Mt,3,0,"button",84)(16,Rt,2,2,"div",85),o()()()()}if(s&2){let t=u();c(12),d("ngIf",t.hasMultiplePhotos),c(2),d("src",t.fullscreenPhoto,T)("alt","Foto galleria "+(t.currentPhotoIndex||0)),c(),d("ngIf",t.hasMultiplePhotos),c(),d("ngIf",t.currentPhotoIndex!==null)}}function Ot(s,i){s&1&&(r(0,"span",37),a(1,"sync"),o())}function Ft(s,i){s&1&&(r(0,"span",37),a(1,"save"),o())}function Tt(s,i){s&1&&(r(0,"span"),a(1,"Salvataggio..."),o())}function zt(s,i){s&1&&(r(0,"span"),a(1,"Salva Impostazioni"),o())}function Dt(s,i){if(s&1){let t=f();r(0,"label",8)(1,"input",100),h("change",function(e){let l=m(t).index,v=u(2);return p(v.toggleCurrentShiftDay(l,e))}),o(),r(2,"div",11)(3,"strong"),a(4),o()()()}if(s&2){let t=i.$implicit,n=i.index,e=u(2);c(),d("checked",e.isDaySelected(e.currentShift.days_of_week,n)),c(3),C(t)}}function At(s,i){if(s&1){let t=f();r(0,"div",74),h("click",function(){m(t);let e=u();return p(e.closeShiftModal())}),r(1,"div",89),h("click",function(e){return m(t),p(e.stopPropagation())}),r(2,"div",76)(3,"h2",90)(4,"span",37),a(5,"schedule"),o(),a(6),o(),r(7,"button",78),h("click",function(){m(t);let e=u();return p(e.closeShiftModal())}),r(8,"span",37),a(9,"close"),o()()(),r(10,"div",91)(11,"div",3)(12,"div",92)(13,"label",93)(14,"span",37),a(15,"badge"),o(),a(16," Nome Turno * "),o(),r(17,"input",94),I("ngModelChange",function(e){m(t);let l=u();return P(l.currentShift.name,e)||(l.currentShift.name=e),p(e)}),o()(),r(18,"div",92)(19,"div",95)(20,"label",93)(21,"span",37),a(22,"schedule"),o(),a(23," Ora Inizio * "),o(),r(24,"input",96),I("ngModelChange",function(e){m(t);let l=u();return P(l.currentShift.start_time,e)||(l.currentShift.start_time=e),p(e)}),o()(),r(25,"div",95)(26,"label",93)(27,"span",37),a(28,"schedule"),o(),a(29," Ora Fine * "),o(),r(30,"input",96),I("ngModelChange",function(e){m(t);let l=u();return P(l.currentShift.end_time,e)||(l.currentShift.end_time=e),p(e)}),o()()(),r(31,"div",92)(32,"label",8)(33,"input",97),I("ngModelChange",function(e){m(t);let l=u();return P(l.currentShift.is_active,e)||(l.currentShift.is_active=e),p(e)}),o(),r(34,"div",11)(35,"strong"),a(36,"Turno attivo"),o(),r(37,"div",12),a(38,"Il turno sar\xE0 disponibile per le prenotazioni"),o()()()(),r(39,"div",30)(40,"label",93)(41,"span",37),a(42,"event"),o(),a(43," Giorni Attivi * "),o(),r(44,"div",7),g(45,Dt,5,2,"label",98),o()()()(),r(46,"div",21)(47,"button",44),h("click",function(){m(t);let e=u();return p(e.closeShiftModal())}),r(48,"span",37),a(49,"close"),o(),a(50," Annulla "),o(),r(51,"button",99),h("click",function(){m(t);let e=u();return p(e.saveShift())}),r(52,"span",37),a(53,"save"),o(),a(54),o()()()()}if(s&2){let t=u();c(6),y(" ",t.editingShift==="new"?"Aggiungi Nuovo Turno":"Modifica Turno"," "),c(11),k("ngModel",t.currentShift.name),d("ngModelOptions",w(12,R)),c(7),k("ngModel",t.currentShift.start_time),d("ngModelOptions",w(13,R)),c(6),k("ngModel",t.currentShift.end_time),d("ngModelOptions",w(14,R)),c(3),k("ngModel",t.currentShift.is_active),d("ngModelOptions",w(15,R)),c(12),d("ngForOf",t.weekDays),c(6),d("disabled",!t.isCurrentShiftValid()),c(3),y(" ",t.editingShift==="new"?"Aggiungi Turno":"Salva Modifiche"," ")}}var pt=class s{settingsForm;loading=!1;loadingPhotos=!1;restaurantId=null;showShiftModal=!1;editingShift=null;currentSlotIndex=null;fullscreenPhoto=null;currentPhotoIndex=null;canManagePhotos=!1;shifts=[];photos=Array(8).fill(null);weekDays=["Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato","Domenica"];fileInput;fb=b(at);supabaseService=b(Q);shiftService=b(mt);auth=b(X);restaurantService=b(ut);destroy$=new V;supabaseClient=this.supabaseService.getSupabaseClient();autoSaveTrigger=new V;currentShift=this.createEmptyShift();ngOnInit(){this.initForm(),this.setupSubscriptions(),this.loadInitialData()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initForm(){this.settingsForm=this.fb.group({accepts_delivery:[!1],accepts_takeaway:[!1],allow_table_selection:[!1],is_active:[!0]})}setupSubscriptions(){this.shiftService.data$.pipe(M(this.destroy$)).subscribe(i=>{this.shifts=i}),this.settingsForm.valueChanges.pipe(M(this.destroy$),F(1500),O(()=>this.settingsForm.valid&&!!this.restaurantId)).subscribe(()=>this.autoSaveChanges()),this.autoSaveTrigger.pipe(M(this.destroy$),F(1e3),O(()=>!!this.restaurantId)).subscribe(()=>this.autoSaveChanges())}triggerAutoSave(){this.autoSaveTrigger.next()}loadInitialData(){return _(this,null,function*(){this.loading=!0;try{if(this.restaurantId=yield this.restaurantService.getCurrentRestaurantId(),!this.restaurantId)throw new Error("Nessun ristorante associato all'utente");yield this.loadRestaurantData(),yield this.shiftService.loadData(),this.canManagePhotos=this.auth.hasPermission("manage_restaurant_settings"),this.canManagePhotos&&(yield this.loadRestaurantPhotos())}catch(i){console.error("Errore caricamento iniziale:",i),alert("Errore durante il caricamento dei dati: "+i.message)}finally{this.loading=!1}})}loadRestaurantData(){return _(this,null,function*(){let i=yield this.restaurantService.loadCurrentRestaurant();if(!i)throw new Error("Ristorante non trovato");this.settingsForm.patchValue({accepts_delivery:i.accepts_delivery,accepts_takeaway:i.accepts_takeaway,allow_table_selection:i.allow_table_selection,is_active:i.is_active})})}loadRestaurantPhotos(){return _(this,null,function*(){if(this.restaurantId){this.loadingPhotos=!0;try{let i=yield this.supabaseService.getRestaurantPhotos(this.restaurantId);this.photos=Array(8).fill(null),i.forEach(t=>{let n=t.display_order-1;if(n>=0&&n<8){if(!t.url&&t.file_path){let{data:{publicUrl:e}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(t.file_path);t.url=e}this.photos[n]=t}})}catch(i){console.error("Errore caricamento foto:",i)}finally{this.loadingPhotos=!1}}})}autoSaveChanges(){return _(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId))try{yield this.saveFormData(),console.log("\u2705 Salvataggio automatico completato")}catch(i){console.error("\u274C Errore salvataggio automatico:",i)}})}onSubmit(){return _(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId)){this.loading=!0;try{yield this.saveFormData(),alert("Impostazioni salvate con successo!")}catch(i){console.error("\u274C Errore salvataggio:",i),alert("Errore durante il salvataggio: "+i.message)}finally{this.loading=!1}}})}saveFormData(){return _(this,null,function*(){let i=this.settingsForm.value;yield this.restaurantService.updateRestaurant(this.restaurantId,{accepts_delivery:i.accepts_delivery,accepts_takeaway:i.accepts_takeaway,allow_table_selection:i.allow_table_selection,is_active:i.is_active})})}createEmptyShift(){return{name:"",start_time:"12:00",end_time:"15:00",days_of_week:[1,2,3,4,5,6,7],is_active:!0}}addNewShift(){this.editingShift="new",this.currentShift=this.createEmptyShift(),this.showShiftModal=!0}editShift(i){this.editingShift=i;let t=this.shifts[i];this.currentShift={name:t.name,start_time:t.start_time,end_time:t.end_time,days_of_week:[...t.days_of_week],is_active:t.is_active},this.showShiftModal=!0}saveShift(){return _(this,null,function*(){if(!(!this.isCurrentShiftValid()||!this.restaurantId)){this.loading=!0;try{if(this.editingShift==="new"){if(!(yield this.shiftService.create(this.currentShift)))throw new Error("Creazione fallita");alert("Turno creato con successo!")}else if(typeof this.editingShift=="number"){let i=this.shifts[this.editingShift].id;if(!(yield this.shiftService.update(i,this.currentShift)))throw new Error("Aggiornamento fallito");alert("Turno aggiornato con successo!")}this.closeShiftModal()}catch(i){alert("Errore salvataggio turno: "+i.message),console.error(i)}finally{this.loading=!1}}})}deleteShift(i){return _(this,null,function*(){if(!confirm("Sei sicuro di voler eliminare questo turno?"))return;let t=this.shifts[i].id;if(t){this.loading=!0;try{if(!(yield this.shiftService.delete(t)))throw new Error("Eliminazione fallita");alert("Turno eliminato con successo!")}catch(n){alert("Errore eliminazione turno: "+n.message),console.error(n)}finally{this.loading=!1}}})}toggleShiftActive(i){return _(this,null,function*(){let t=this.shifts[i],n=!t.is_active;if(confirm(`Sei sicuro di voler ${n?"attivare":"disattivare"} il turno "${t.name}"?`)){this.loading=!0;try{if(!(yield this.shiftService.update(t.id,{is_active:n})))throw new Error("Operazione fallita");alert(`Turno "${t.name}" ${n?"attivato":"disattivato"} con successo!`)}catch(e){alert(`Errore: ${e.message}`),console.error(e)}finally{this.loading=!1}}})}isCurrentShiftValid(){return!!(this.currentShift?.name&&this.currentShift?.start_time&&this.currentShift?.end_time&&this.currentShift?.days_of_week?.length>0)}closeShiftModal(){this.showShiftModal=!1,this.editingShift=null}toggleCurrentShiftDay(i,t){let n=t.target.checked,e=i+1;n?this.currentShift.days_of_week.includes(e)||this.currentShift.days_of_week.push(e):this.currentShift.days_of_week=this.currentShift.days_of_week.filter(l=>l!==e)}isDaySelected(i,t){return i.includes(t+1)}triggerFileInput(i){this.currentSlotIndex=i,this.fileInput.nativeElement.click()}onPhotoFileSelected(i){let t=i.target;if(!t.files?.length||this.currentSlotIndex===null||!this.restaurantId)return;let n=t.files[0],e=this.currentSlotIndex;this.currentSlotIndex=null,t.value="",this.onPhotoFileSelect(n,e)}onPhotoFileSelect(i,t){return _(this,null,function*(){if(this.restaurantId){if(i.size>10*1024*1024){alert("File troppo grande (max 10MB)");return}if(!i.type.startsWith("image/")){alert("Solo file immagine sono permessi");return}this.loadingPhotos=!0;try{let n=t+1,e=yield this.supabaseService.uploadRestaurantPhoto(this.restaurantId,i,n);if(!e)throw new Error("Upload fallito");let l=yield this.supabaseService.saveRestaurantPhotoRecord({restaurant_id:this.restaurantId,file_path:e.filePath,display_order:n});if(!l)throw new Error("Salvataggio record fallito");this.photos[t]=N(A({},l),{url:e.publicUrl}),this.triggerAutoSave(),alert(`Foto ${n} caricata con successo!`)}catch(n){console.error("Errore upload foto:",n),alert("Errore durante l'upload: "+n.message)}finally{this.loadingPhotos=!1}}})}deletePhoto(i){return _(this,null,function*(){if(!this.restaurantId)return;let t=this.photos[i];if(!(!t||!confirm("Sei sicuro di voler eliminare questa foto?"))){this.loadingPhotos=!0;try{yield this.supabaseService.deleteRestaurantPhoto(t.id,t.file_path),this.photos[i]=null,this.triggerAutoSave(),alert("Foto eliminata con successo!")}catch(n){console.error("Errore eliminazione foto:",n),alert("Errore durante l'eliminazione: "+n.message)}finally{this.loadingPhotos=!1}}})}onPhotoOrderChange(i,t){return _(this,null,function*(){let n=t.target,e=Number(n.value);if(e<1||e>8){alert("Ordine non valido. Deve essere tra 1 e 8.");let x=this.photos[i];x&&(n.value=x.display_order.toString());return}let l=this.photos[i];if(!l){alert("Nessuna foto in questo slot");return}if(l.display_order===e)return;let v=l.display_order;try{this.loadingPhotos=!0;let x=this.photos.find(D=>D&&D.display_order===e);x?(yield Promise.all([this.supabaseService.updatePhotoOrder(l.id,e),this.supabaseService.updatePhotoOrder(x.id,v)]),l.display_order=e,x.display_order=v):(yield this.supabaseService.updatePhotoOrder(l.id,e),l.display_order=e),this.reorganizePhotosByOrder(),this.triggerAutoSave(),console.log("\u2705 Ordine aggiornato")}catch(x){console.error("\u274C Errore aggiornamento ordine:",x),alert("Errore durante l'aggiornamento: "+x.message),n.value=v.toString(),l.display_order=v}finally{this.loadingPhotos=!1}})}reorganizePhotosByOrder(){let i=this.photos.filter(n=>n!==null).sort((n,e)=>n.display_order-e.display_order),t=Array(8).fill(null);i.forEach(n=>{let e=n.display_order-1;e>=0&&e<8&&(t[e]=n)}),this.photos=t}openPhoto(i,t){i?.url&&(this.fullscreenPhoto=i.url,this.currentPhotoIndex=t)}closeFullscreenPhoto(){this.fullscreenPhoto=null,this.currentPhotoIndex=null}navigateFullscreenPhoto(i){if(this.currentPhotoIndex===null||!this.photos)return;let t=i==="next"?this.currentPhotoIndex+1:this.currentPhotoIndex-1;t<0&&(t=this.photos.length-1),t>=this.photos.length&&(t=0);let n=!1,e=0;for(;!n&&e<this.photos.length;){let l=this.photos[t];l?.url?(this.fullscreenPhoto=l.url,this.currentPhotoIndex=t,n=!0):(t=i==="next"?t+1:t-1,t<0&&(t=this.photos.length-1),t>=this.photos.length&&(t=0),e++)}}onImageError(i,t){let n=i.target;console.error(`Errore caricamento immagine slot ${t}:`,n.src),n.style.display="none";let e=n.parentElement;if(e){let l=document.createElement("div");l.className="error-placeholder",l.style.cssText="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: var(--danger); font-size: 12px;",l.textContent="Errore caricamento",e.appendChild(l)}}get loadedPhotosCount(){return this.photos.filter(i=>i!==null).length}get hasMultiplePhotos(){return this.loadedPhotosCount>1}trackByIndex(i){return i}toggleRestaurantActive(){return _(this,null,function*(){if(!this.restaurantId)return;let i=this.settingsForm.get("is_active")?.value,t=!i;if(!i&&!confirm(`Sei sicuro di voler disattivare il ristorante?

I clienti non potranno pi\xF9 vederlo n\xE9 effettuare ordini fino a quando non lo riattiverai.`)){this.settingsForm.patchValue({is_active:t},{emitEvent:!1});return}this.loading=!0;try{yield this.restaurantService.updateRestaurant(this.restaurantId,{is_active:i}),this.triggerAutoSave(),alert(i?"Ristorante riattivato! Ora \xE8 visibile ai clienti.":"Ristorante disattivato correttamente.")}catch(n){alert("Errore: "+n.message),this.settingsForm.patchValue({is_active:t},{emitEvent:!1})}finally{this.loading=!1}})}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=j({type:s,selectors:[["app-restaurant-settings"]],viewQuery:function(t,n){if(t&1&&$(ht,5),t&2){let e;B(e=L())&&(n.fileInput=e.first)}},decls:70,vars:11,consts:[["fileInput",""],[1,"page-container"],[1,"flex","flex-col","gap-sm",3,"ngSubmit","formGroup"],[1,"form-card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-md"],[1,"text-md","font-semibold","m-0"],[1,"grid-cards"],[1,"checkbox-label"],[1,"checkbox-grid"],["type","checkbox","formControlName","accepts_delivery"],[1,"checkbox-content"],[1,"text-muted"],["type","checkbox","formControlName","accepts_takeaway"],["type","checkbox","formControlName","allow_table_selection"],["type","checkbox","formControlName","is_active",3,"change"],[1,"flex","flex-col","gap-md"],["class","shift-item",4,"ngFor","ngForOf"],["type","button","class","promethea-button ghost",3,"click",4,"ngIf"],["class","form-card",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-footer"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],[4,"ngIf"],[1,"footer"],["href","https://www.prometheasrl.it/","target","_blank",1,"footer-link"],["src","logo.png",1,"logopromethea"],[1,"shift-item"],[1,"flex","justify-between","items-start","mb-sm","p-sm"],[1,"flex","flex-col","gap-sm"],[1,"font-semibold"],[1,"flex","flex-wrap","gap-sm"],[1,"chip"],[1,"material-icons","text-sm"],[1,"flex","gap-sm"],["type","button",1,"icon-button",3,"click","title"],[1,"material-icons"],["type","button","title","Modifica turno",1,"icon-button",3,"click"],["type","button","class","icon-button","title","Elimina turno",3,"click",4,"ngIf"],[1,"flex","flex-wrap","gap-sm","mt-sm","p-sm0"],["class","chip",3,"active","warning",4,"ngFor","ngForOf"],["type","button","title","Elimina turno",1,"icon-button",3,"click"],["name","trash-2",3,"size"],["type","button",1,"promethea-button","ghost",3,"click"],["name","plus",3,"size"],[1,"text-muted","mb-md"],["type","file","accept","image/*",2,"display","none",3,"change","disabled"],[1,"gallery-container"],["class","card",4,"ngFor","ngForOf","ngForTrackBy"],["style","position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center;",4,"ngIf"],[1,"card"],[1,"flex","flex-wrap","justify-between","items-center","mb-sm"],["class","order-selector flex items-center gap-sm",4,"ngIf"],[1,"photo-preview","rounded-lg","border","transition","cursor-pointer","mb-sm",2,"min-height","150px","display","flex","align-items","center","justify-content","center","overflow","hidden","position","relative",3,"click"],["class","w-full h-full",4,"ngIf"],["class","empty-photo-slot flex flex-col items-center justify-center p-md",4,"ngIf"],[1,"card-footer","gap-sm"],["type","button",1,"icon-button","x-small",3,"click","title","disabled"],["type","button","class","icon-button x-small","title","Elimina foto","style","color: var(--primary);",3,"disabled","click",4,"ngIf"],[1,"order-selector","flex","items-center","gap-sm"],[1,"text-mini"],[1,"text-mini",3,"change","disabled"],[3,"value","selected",4,"ngFor","ngForOf"],[3,"value","selected"],[1,"w-full","h-full"],[2,"width","100%","height","100%","object-fit","cover","border-radius","8px",3,"error","src","alt"],[1,"photo-hover-overlay"],[1,"empty-photo-slot","flex","flex-col","items-center","justify-center","p-md"],[1,"material-icons","empty-icon",2,"font-size","48px","color","var(--smoke-3)","margin-bottom","8px"],[1,"text-sm","text-muted"],["type","button","title","Elimina foto",1,"icon-button","x-small",2,"color","var(--primary)",3,"click","disabled"],[2,"position","absolute","top","0","left","0","right","0","bottom","0","background","rgba(255,255,255,0.9)","z-index","10","display","flex","flex-direction","column","align-items","center","justify-content","center"],[1,"spinner",2,"width","40px","height","40px","border","3px solid var(--smoke-1)","border-top-color","var(--primary)","border-radius","50%","animation","spin 1s linear infinite","margin-bottom","var(--gap-sm)"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"text-md","font-semibold","m-0","flex","items-center","gap-sm"],[1,"icon-button",3,"click"],[1,"modal-content","p-lg","flex","items-center","justify-center",2,"min-height","60vh"],[2,"position","relative","width","100%","height","100%","display","flex","align-items","center","justify-content","center"],["style","position: absolute; left: 0; z-index: 20; background: var(--smoke-2); margin: 0 var(--gap-sm);","class","icon-button",3,"click",4,"ngIf"],[2,"max-width","64rem","max-height","70vh","display","flex","align-items","center","justify-content","center"],[2,"max-width","100%","max-height","70vh","object-fit","contain","border-radius","12px",3,"src","alt"],["style","position: absolute; right: 0; z-index: 20; background: var(--smoke-2); margin: 0 var(--gap-sm);","class","icon-button",3,"click",4,"ngIf"],["style","position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 0.25rem 1rem; border-radius: 999px; font-size: 0.875rem;",4,"ngIf"],[1,"icon-button",2,"position","absolute","left","0","z-index","20","background","var(--smoke-2)","margin","0 var(--gap-sm)",3,"click"],[1,"icon-button",2,"position","absolute","right","0","z-index","20","background","var(--smoke-2)","margin","0 var(--gap-sm)",3,"click"],[2,"position","absolute","bottom","1rem","left","50%","transform","translateX(-50%)","background","rgba(0,0,0,0.7)","color","white","padding","0.25rem 1rem","border-radius","999px","font-size","0.875rem"],[1,"modal-container",3,"click"],[1,"section-title","m-0"],[1,"modal-content"],[1,"form-row","mb-md"],[1,"standard-label"],["type","text","placeholder","Es: Pranzo, Cena","autofocus","",3,"ngModelChange","ngModel","ngModelOptions"],[1,"form-group"],["type","time",3,"ngModelChange","ngModel","ngModelOptions"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],["class","checkbox-label",4,"ngFor","ngForOf"],["type","button",1,"promethea-button",3,"click","disabled"],["type","checkbox",3,"change","checked"]],template:function(t,n){t&1&&(r(0,"div",1)(1,"form",2),h("ngSubmit",function(){return n.onSubmit()}),r(2,"div",3)(3,"div",4)(4,"span",5),a(5,"room_service"),o(),r(6,"h2",6),a(7,"Servizi Offerti"),o()(),r(8,"div",7)(9,"label",8)(10,"div",9),S(11,"input",10),o(),r(12,"div",11)(13,"strong"),a(14,"Consegna a domicilio"),o(),r(15,"div",12),a(16,"I clienti possono ordinare con consegna"),o()()(),r(17,"label",8)(18,"div",9),S(19,"input",13),o(),r(20,"div",11)(21,"strong"),a(22,"Asporto"),o(),r(23,"div",12),a(24,"I clienti possono ritirare in loco"),o()()(),r(25,"label",8)(26,"div",9),S(27,"input",14),o(),r(28,"div",11)(29,"strong"),a(30,"Prenotazione tavolo"),o(),r(31,"div",12),a(32,"I clienti possono scegliere il tavolo"),o()()()()(),r(33,"div",3)(34,"div",4)(35,"span",5),a(36,"visibility"),o(),r(37,"h2",6),a(38,"Stato Ristorante"),o()(),r(39,"label",8)(40,"div",9)(41,"input",15),h("change",function(){return n.toggleRestaurantActive()}),o()(),r(42,"div",11)(43,"strong"),a(44,"Ristorante attivo"),o(),r(45,"div",12),a(46,"Visibile ai clienti e accettazione ordini"),o()()()(),r(47,"div",3)(48,"div",4)(49,"span",5),a(50,"schedule"),o(),r(51,"h2",6),a(52,"Turni di Lavoro"),o()(),r(53,"div",16),g(54,vt,22,14,"div",17)(55,xt,3,1,"button",18),o()(),g(56,Pt,14,6,"div",19)(57,Vt,17,5,"div",20),r(58,"div",21)(59,"button",22),g(60,Ot,2,0,"span",23)(61,Ft,2,0,"span",23)(62,Tt,2,0,"span",24)(63,zt,2,0,"span",24),o()()(),r(64,"div",25)(65,"a",26)(66,"div"),a(67,"Powered by"),o(),S(68,"img",27),o()()(),g(69,At,55,16,"div",20)),t&2&&(c(),d("formGroup",n.settingsForm),c(53),d("ngForOf",n.shifts),c(),d("ngIf",n.editingShift===null),c(),d("ngIf",n.canManagePhotos),c(),d("ngIf",n.fullscreenPhoto),c(2),d("disabled",n.loading||n.settingsForm.invalid),c(),d("ngIf",n.loading),c(),d("ngIf",!n.loading),c(),d("ngIf",n.loading),c(),d("ngIf",!n.loading),c(6),d("ngIf",n.showShiftModal))},dependencies:[H,U,q,lt,et,rt,ot,K,J,Y,Z,it,nt,st,tt,dt,ct],styles:[".shift-item[_ngcontent-%COMP%]{padding:var(--gap-md);border:1px solid var(--smoke-1);border-radius:12px;transition:all .2s ease}.shift-item[_ngcontent-%COMP%]:hover{border-color:var(--secondary);background:var(--smoke-1)}.shift-form[_ngcontent-%COMP%]{border:2px solid var(--smoke-2)}.text-green-500[_ngcontent-%COMP%]{color:#10b981}.text-orange-500[_ngcontent-%COMP%]{color:#f59e0b}.material-icons[_ngcontent-%COMP%]{transition:all .2s ease}@media (max-width: 768px){.shift-item[_ngcontent-%COMP%]{padding:var(--gap-sm)}.shift-item[_ngcontent-%COMP%]   .flex-wrap[_ngcontent-%COMP%]{justify-content:flex-start}}@media (max-width: 480px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr}.md\\\\[_ngcontent-%COMP%]:col-span-2{grid-column:1}}.gallery-container[_ngcontent-%COMP%]{position:relative;min-height:300px}.photo-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.photo-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block;border-radius:8px}.photo-hover-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease;border-radius:8px;pointer-events:none}.photo-preview[_ngcontent-%COMP%]:hover   .photo-hover-overlay[_ngcontent-%COMP%]{opacity:1}.photo-hover-overlay[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:#fff;font-size:2rem}.empty-photo-slot[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-muted);padding:var(--gap-lg)}.empty-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:var(--gap-sm);opacity:.5}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--smoke-1);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:var(--gap-sm)}.nav-button[_ngcontent-%COMP%]{background:var(--smoke-2);margin:0 var(--gap-sm)}.nav-button[_ngcontent-%COMP%]:hover{background:var(--smoke-3)}.photo-counter[_ngcontent-%COMP%]{background:#000000b3;color:#fff;padding:.25rem 1rem;border-radius:999px;font-size:.875rem}@media (max-width: 768px){.grid-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))!important}.photo-preview[_ngcontent-%COMP%]{min-height:120px!important}}.logopromethea[_ngcontent-%COMP%]{height:var(--fs-lg);width:auto}.footer[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:center;padding-top:var(--gap-lg);margin-top:var(--fs-lg)}.footer-link[_ngcontent-%COMP%]{text-decoration:none;font-weight:800;display:flex;gap:var(--gap-sm);align-items:center}"]})};export{pt as RestaurantSettings};
