import{a as g}from"./chunk-VQ7WJPK7.js";import{I as d,M as u,_ as l,a as o,b as c,g as n}from"./chunk-3SWAHN2Y.js";var p=class i extends g{constructor(){super(),this.authService.currentUser$.pipe(d(t=>!!t),u(1)).subscribe(()=>{this.loadData()})}getTableName(){return"ingredients"}loadData(t){return n(this,null,function*(){try{this.loadingSubject.next(!0);let e=yield this.getCurrentRestaurantId();if(!e){this.dataSubject.next([]),this.loadingSubject.next(!1);return}let{data:a,error:r}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select(`
          *,
          units (*),
          suppliers (company_name, contact_name)
        `).eq("restaurant_id",e).eq("is_active",!0).order("name");if(r)throw r;console.log("Ingredients loaded with units and suppliers:",a?.length),this.dataSubject.next(a||[])}catch(e){console.error("Error loading ingredients:",e),this.handleError("loadData",e)}finally{this.loadingSubject.next(!1)}})}loadIngredients(){return n(this,null,function*(){return this.loadData()})}createIngredient(t){return n(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return console.error("No restaurant found"),null;console.log("\u{1F3EA} Using restaurant:",e);let a=c(o({},t),{expiry_date:t.expiry_date===""?null:t.expiry_date,restaurant_id:e});console.log("\u{1F4DD} Creating ingredient:",a);let{data:r,error:s}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).insert(a).select().single();if(s)throw console.error("\u274C Error creating ingredient:",s),s;return console.log("\u2705 Ingredient created successfully"),yield this.loadData(),r}catch(e){return console.error("\u{1F4A5} Error in createIngredient:",e),null}})}updateIngredient(t,e){return n(this,null,function*(){try{let a=c(o({},e),{expiry_date:e.expiry_date===""?null:e.expiry_date}),{error:r}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).update(a).eq("id",t);if(r)throw r;return yield this.loadData(),!0}catch(a){return console.error("Error updating ingredient:",a),!1}})}deleteIngredient(t){return n(this,null,function*(){try{let{error:e}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).update({is_active:!1}).eq("id",t);if(e)throw e;return yield this.loadData(),!0}catch(e){return console.error("Error deleting ingredient:",e),!1}})}getIngredients(){return this.dataSubject.value}getIngredientById(t){return this.dataSubject.value.find(e=>e.id===t)}getLowStockIngredients(){return this.dataSubject.value.filter(t=>t.alert_enabled&&t.current_stock<=t.minimum_stock)}searchIngredients(t){return t?this.dataSubject.value.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.description?.toLowerCase().includes(t.toLowerCase())):this.dataSubject.value}calculateIngredientCost(t,e){if(!t.unit_id||!t.units)return t.cost_per_unit*e;let a=t.units,r=e;switch(a.symbol){case"kg":r=e/1e3;break;case"L":r=e/1e3;break;case"g":case"mL":case"pz":r=e;break;default:r=e}return t.cost_per_unit*r}static \u0275fac=function(e){return new(e||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{p as a};
