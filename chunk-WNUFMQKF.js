import{a as Qe}from"./chunk-Q2GPV6RR.js";import{a as Ge}from"./chunk-HPQQTYJI.js";import{a as $e}from"./chunk-FZRVSYI6.js";import{a as je}from"./chunk-B2ZSPVEF.js";import{a as le,b as se,c as Be,d as de}from"./chunk-ETLR4YQ2.js";import{a as Ue}from"./chunk-UCUEQKYC.js";import{a as Le}from"./chunk-GHCKB2IP.js";import{a as ze}from"./chunk-MUH5FSAN.js";import{a as qe}from"./chunk-5VACEKXL.js";import{a as Ne}from"./chunk-QXAIP3GL.js";import{a as We}from"./chunk-KHHIQTAU.js";import{a as He}from"./chunk-3SRQJDPW.js";import{a as W}from"./chunk-6N7TSVOQ.js";import{b as N}from"./chunk-ISGJYCJJ.js";import{a as Ae}from"./chunk-JDMWGXAZ.js";import{b as ee,d as te,e as Fe,g as Ve,h as ie,i as De,q as re,r as ae,s as ne,v as Re,x as oe}from"./chunk-LDJ3K2AA.js";import{b as ke}from"./chunk-NPOGW2A3.js";import{c as J,d as K,e as Oe,h as Me,i as Ie,k as Pe,l as X}from"./chunk-SSGQXIGB.js";import{A as Te,Aa as l,Ab as O,Bb as h,Cb as F,Db as j,Fa as ge,Fb as w,Gb as y,Hb as S,Kb as q,Nb as M,Pb as k,Qa as G,Qb as Z,Rb as xe,V as Q,Va as f,Zb as Y,_ as b,a as Se,bb as m,cb as r,da as u,db as n,ea as p,eb as H,ib as B,jb as $,kb as C,na as Ee,nb as _,pb as c,rb as ve,sb as he,tb as fe,ub as L,vb as A,wb as R,yb as U,zb as o}from"./chunk-UNLQURJ5.js";import{a as V,b as z,j as v}from"./chunk-4ZZIO3ZI.js";var ce=class s extends He{getTableName(){return"tables"}calculateTableStatus(t){return v(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return[];let i=t.map(E=>E.id),a=new Date().toISOString().split("T")[0],{data:d,error:g}=yield this.supabaseService.getSupabaseClient().from("order_headers").select(`
          *,
          comande (*)
        `).eq("restaurant_id",e).eq("status","active").in("table_id",i);g&&console.error("Errore order headers:",g);let{data:x,error:T}=yield this.supabaseService.getSupabaseClient().from("reservations").select("*").eq("restaurant_id",e).eq("reservation_date",a).in("status",["confirmed","pending"]).in("table_id",i);return T&&console.error("Errore prenotazioni:",T),t.map(E=>{let P=(d||[]).filter(D=>D.table_id===E.id),Ce=(x||[]).filter(D=>D.table_id===E.id),pe="free",we=null,_e=[],ye=null;return P.length>0?(pe="occupied",ye=P[0].id,P.forEach(D=>{if(D.comande&&D.comande.length>0){let Je=D.comande.map(I=>z(V({},I),{restaurant_id:I.restaurant_id||e,order_header_id:I.order_header_id||D.id,table_id:I.table_id||E.id,subtotal:I.subtotal||0,tax_amount:I.tax_amount||0,discount_amount:I.discount_amount||0,total_amount:I.total_amount||0,created_at:I.created_at,updated_at:I.updated_at,customer_name:I.customer_name||null,customer_phone:I.customer_phone||null,customer_notes:I.customer_notes||null,order_type:I.order_type||"dine_in",status:I.status||"ordered"}));_e=_e.concat(Je)}})):Ce.length>0&&(pe="reserved",we=Ce[0]),{table:E,status:pe,currentReservation:we,currentOrders:_e,tavolataId:ye}})}catch(e){return console.error("\u274C Errore calcolo stato tavoli:",e),[]}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=Ee(s)))(i||s)}})();static \u0275prov=Q({token:s,factory:s.\u0275fac,providedIn:"root"})};var tt=()=>({id:"all",name:"\u{1F37D}\uFE0F Tutti i piatti"}),it=()=>[];function rt(s,t){s&1&&(r(0,"div",4),H(1,"app-loader",5),n()),s&2&&(l(),m("isLoading",!0))}function at(s,t){if(s&1&&(r(0,"span",36),o(1),n()),s&2){let e=c(2);l(),h(" Comanda ",e.currentComanda.comanda_number," ")}}function nt(s,t){if(s&1&&(r(0,"option",38),o(1),n()),s&2){let e=t.$implicit,i=c(3);m("value",e.id),l(),F(" Comanda ",e.comanda_number," (",i.getComandaTotalQuantity(e)," piatti) ")}}function ot(s,t){if(s&1){let e=C();r(0,"div")(1,"select",37),S("ngModelChange",function(a){u(e);let d=c(2);return y(d.currentComandaId,a)||(d.currentComandaId=a),p(a)}),_("ngModelChange",function(a){u(e);let d=c(2);return p(d.switchComanda(a))}),f(2,nt,2,3,"option",29),n()()}if(s&2){let e=c(2);l(),w("ngModel",e.currentComandaId),l(),m("ngForOf",e.getComandeForDropdown())}}function lt(s,t){s&1&&(r(0,"span",46),o(1," Menu Dedicato "),n())}function st(s,t){s&1&&(r(0,"span"),o(1," Seleziona Menu "),n())}function dt(s,t){if(s&1&&(r(0,"div",47)(1,"div",17)(2,"span",48),o(3,"event_available"),n(),r(4,"span",49),o(5),n(),r(6,"span",50),o(7,"Dedicato"),n()()()),s&2){let e=c(3);l(5),O(e.dedicatedMenu.name)}}function ct(s,t){s&1&&(r(0,"span",55)(1,"span",56),o(2,"star"),n(),o(3," Default "),n())}function mt(s,t){if(s&1&&(r(0,"div",52)(1,"div",53)(2,"div",17)(3,"span",11),o(4,"restaurant_menu"),n(),r(5,"span",49),o(6),n()(),f(7,ct,4,0,"span",54),n()()),s&2){let e=c(4);l(6),O(e.globalMenus[0].name),l(),m("ngIf",e.globalMenus[0].is_default)}}function ut(s,t){if(s&1&&(r(0,"option",57),o(1),n()),s&2){let e=t.$implicit;m("ngValue",e),l(),F(" ",e.is_default?"\u2B50 ":"","",e.name," ")}}function pt(s,t){if(s&1){let e=C();r(0,"div")(1,"select",37),S("ngModelChange",function(a){u(e);let d=c(4);return y(d.selectedMenu,a)||(d.selectedMenu=a),p(a)}),_("ngModelChange",function(a){u(e);let d=c(4);return p(d.onMenuSelectChange(a))}),r(2,"option",57),o(3," \u{1F37D}\uFE0F Tutti i piatti "),n(),f(4,ut,2,3,"option",58),n()()}if(s&2){let e=c(4);l(),w("ngModel",e.selectedMenu),l(),m("ngValue",q(3,tt)),l(2),m("ngForOf",e.globalMenus)}}function _t(s,t){if(s&1&&(r(0,"div"),f(1,mt,8,2,"div",51)(2,pt,5,4,"div",18),n()),s&2){let e=c(3);l(),m("ngIf",e.globalMenus.length===1),l(),m("ngIf",e.globalMenus.length>1)}}function gt(s,t){s&1&&(r(0,"div",59)(1,"span",60),o(2,"restaurant_menu"),n(),r(3,"p",61),o(4,"Nessun menu disponibile"),n()())}function vt(s,t){s&1&&(r(0,"span",55)(1,"span",56),o(2,"star"),n(),o(3," Predefinito "),n())}function ht(s,t){s&1&&(r(0,"span",65)(1,"span",56),o(2,"event_available"),n(),o(3," Dedicato "),n())}function ft(s,t){if(s&1&&(r(0,"div",62)(1,"span",63),o(2),n(),f(3,vt,4,0,"span",54)(4,ht,4,0,"span",64),n()),s&2){let e=c(3);l(2),h("",e.dishes.length," piatti disponibili"),l(),m("ngIf",e.selectedMenu.is_default),l(),m("ngIf",e.selectedMenu.type==="dedicated")}}function xt(s,t){if(s&1&&(r(0,"div",39)(1,"div",40)(2,"label",41)(3,"span",11),o(4,"restaurant_menu"),n(),f(5,lt,2,0,"span",42)(6,st,2,0,"span",18),n(),f(7,dt,8,1,"div",43)(8,_t,3,2,"div",18)(9,gt,5,0,"div",44)(10,ft,5,3,"div",45),n()()),s&2){let e=c(2);l(5),m("ngIf",e.dedicatedMenu),l(),m("ngIf",!e.dedicatedMenu),l(),m("ngIf",e.dedicatedMenu),l(),m("ngIf",!e.dedicatedMenu&&e.globalMenus.length>0),l(),m("ngIf",!e.hasMenusToShow()),l(),m("ngIf",e.selectedMenu)}}function bt(s,t){if(s&1&&(r(0,"option",38),o(1),M(2,"slice"),n()),s&2){let e=t.$implicit;m("value",e.id),l(),F(" ",Z(2,3,e.name,0,10),"",e.name.length>10?"...":""," ")}}function Ct(s,t){if(s&1){let e=C();r(0,"div",67),_("click",function(){let a=u(e).$implicit,d=c(3);return p(d.selectedCategory=a.id)}),r(1,"span",11),o(2,"category"),n(),r(3,"span",68),o(4),M(5,"slice"),n(),r(6,"span",16),o(7),n()()}if(s&2){let e=t.$implicit,i=c(3);R("active",i.selectedCategory===e.id),l(4),F("",Z(5,5,e.name,0,8),"",e.name.length>8?"...":""),l(3),O(i.getDishesCountByCategory(e.id))}}function wt(s,t){if(s&1&&(r(0,"small",16),o(1),M(2,"slice"),n()),s&2){let e=c().$implicit;l(),F(" ",Z(2,2,e.description,0,40),"",e.description.length>40?"...":""," ")}}function yt(s,t){if(s&1){let e=C();r(0,"div",79)(1,"div",70)(2,"div",80)(3,"div",81)(4,"strong",82),o(5),n(),r(6,"div")(7,"button",83),_("click",function(){let a=u(e).$implicit,d=c(5);return p(d.addDishToOrder(a))}),r(8,"span",11),o(9,"add"),n()()()(),r(10,"span",84),o(11),M(12,"number"),n(),f(13,wt,3,6,"small",85),n()()()}if(s&2){let e=t.$implicit,i=c(5);l(5),O(e.name),l(2),m("disabled",!i.orderingStatus.allowed||!i.canAddItemsToCurrentComanda())("title",i.canAddItemsToCurrentComanda()?i.orderingStatus.allowed?"Aggiungi 1":i.orderingStatus.reason:"Comanda in stato avanzato, non modificabile"),l(4),h("\u20AC",k(12,5,e.base_price,"1.2-2")),l(2),m("ngIf",e.description)}}function St(s,t){if(s&1&&(B(0),r(1,"div",73)(2,"div",74)(3,"span",75),o(4,"category"),n(),o(5),n(),r(6,"div",76),o(7),n()(),r(8,"div",77),f(9,yt,14,8,"div",78),n(),$()),s&2){let e=t.$implicit,i=c(4);l(5),h(" ",e.category.name," "),l(2),O(e.dishes.length),l(2),m("ngForOf",e.dishes)("ngForTrackBy",i.trackByDishId)}}function Tt(s,t){if(s&1&&(B(0),f(1,St,10,4,"ng-container",72),$()),s&2){let e=c(3);l(),m("ngForOf",e.getDishesGroupedByCategory())("ngForTrackBy",e.trackByCategoryId)}}function Et(s,t){if(s&1){let e=C();r(0,"div",86)(1,"span",11),o(2,"search_off"),n(),r(3,"p",87),o(4,"Nessun piatto trovato"),n(),r(5,"button",88),_("click",function(){u(e);let a=c(3);return p(a.resetDishFilters())}),o(6," Reset filtri "),n()()}}function Ot(s,t){if(s&1){let e=C();r(0,"div",31)(1,"div",66)(2,"div",67),_("click",function(){u(e);let a=c(2);return p(a.selectedCategory="all")}),r(3,"span",11),o(4,"restaurant_menu"),n(),r(5,"span",68),o(6,"Tutti"),n(),r(7,"span",16),o(8),n()(),f(9,Ct,8,9,"div",69),n(),r(10,"div",70),f(11,Tt,2,2,"ng-container",71)(12,Et,7,0,"ng-template",null,0,xe),n()()}if(s&2){let e=L(13),i=c(2);l(2),R("active",i.selectedCategory==="all"),l(6),O(i.getDishesCountByCategory("all")),l(),m("ngForOf",i.categoryService.data.slice(0,4)),l(2),m("ngIf",i.getDishesGroupedByCategory().length>0)("ngIfElse",e)}}function Mt(s,t){if(s&1&&(r(0,"option",57),o(1),n()),s&2){let e=t.$implicit;m("ngValue",e),l(),F(" Comanda ",e.comanda_number," (",(e.order_items==null?null:e.order_items.length)||0," piatti) ")}}function It(s,t){if(s&1){let e=C();r(0,"div",96)(1,"select",27),S("ngModelChange",function(a){u(e);let d=c(3);return y(d.currentComanda,a)||(d.currentComanda=a),p(a)}),_("ngModelChange",function(){u(e);let a=c(3);return p(a.switchComanda((a.currentComanda==null?null:a.currentComanda.id)||""))}),f(2,Mt,2,3,"option",58),n()()}if(s&2){let e=c(3);l(),w("ngModel",e.currentComanda),l(),m("ngForOf",e.getComandeForDropdown())}}function Pt(s,t){if(s&1){let e=C();r(0,"div",102)(1,"div",103)(2,"div",12)(3,"strong"),o(4),n(),r(5,"div",15)(6,"span",16),o(7),M(8,"number"),n(),r(9,"span",16),o(10,"\u2022"),n(),r(11,"span",16),o(12),M(13,"number"),n()()(),r(14,"div",17)(15,"button",104),_("click",function(a){let d=u(e).$implicit;return c(5).updateQuantity(d,-1),p(a.stopPropagation())}),r(16,"span",11),o(17,"remove"),n()(),r(18,"span",105),o(19),n(),r(20,"button",106),_("click",function(a){let d=u(e).$implicit;return c(5).updateQuantity(d,1),p(a.stopPropagation())}),r(21,"span",11),o(22,"add"),n()(),r(23,"button",107),_("click",function(a){let d=u(e).$implicit;return c(5).removeItemLocal(d),p(a.stopPropagation())}),r(24,"span",11),o(25,"delete"),n()()()()()}if(s&2){let e=t.$implicit,i=c(5);l(4),O(e.dish_name||"Piatto"),l(3),h("\u20AC",k(8,7,e.unit_price,"1.2-2")," cad."),l(5),h("Tot: \u20AC",k(13,10,e.unit_price*e.quantity,"1.2-2")),l(3),m("disabled",!i.isItemEditable(e)),l(4),O(e.quantity),l(),m("disabled",!i.isItemEditable(e)||!i.orderingStatus.allowed),l(3),m("disabled",!i.isItemEditable(e))}}function kt(s,t){if(s&1&&(r(0,"div",90)(1,"span",16),o(2),n(),r(3,"strong",109),o(4),M(5,"number"),n()()),s&2){let e=c(6);l(2),h(" Totale generale (",e.orderHeader.comande.length," comande): "),l(2),h(" \u20AC",k(5,2,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function Ft(s,t){if(s&1&&(B(0),f(1,kt,6,5,"div",108),$()),s&2){let e=c(5);l(),m("ngIf",e.orderHeader.comande.length>1)}}function Vt(s,t){if(s&1&&(r(0,"div"),f(1,Pt,26,13,"div",97),r(2,"div",98)(3,"div",99)(4,"strong",100),o(5,"Totale Comanda:"),n(),r(6,"strong",101),o(7),M(8,"number"),n()(),f(9,Ft,2,1,"ng-container",18),n()()),s&2){let e=c(4);l(),m("ngForOf",e.currentComanda.order_items||q(6,it)),l(6),h(" \u20AC",k(8,3,e.getComandaTotal(e.currentComanda),"1.2-2")," "),l(2),m("ngIf",e.orderHeader&&e.orderHeader.comande)}}function Dt(s,t){if(s&1&&(B(0),f(1,Vt,10,7,"div",71),$()),s&2){c();let e=L(13),i=c(2);l(),m("ngIf",i.currentComanda.order_items&&i.currentComanda.order_items.length>0)("ngIfElse",e)}}function Rt(s,t){s&1&&(r(0,"div",110)(1,"span",111),o(2,"restaurant_menu"),n(),r(3,"p",87),o(4,"Nessun piatto in questa comanda"),n(),r(5,"p",61),o(6,"Clicca sui piatti per aggiungerli"),n()())}function Ht(s,t){if(s&1&&(r(0,"div",31)(1,"div",89)(2,"div",90)(3,"h3",91)(4,"span",92),o(5,"receipt"),n(),o(6),n(),r(7,"span",93),o(8),n()(),f(9,It,3,2,"div",94),n(),r(10,"div",95),f(11,Dt,2,2,"ng-container",18)(12,Rt,7,0,"ng-template",null,1,xe),n()()),s&2){let e=c(2);l(6),h(" Comanda ",(e.currentComanda==null?null:e.currentComanda.comanda_number)||"1"," "),l(2),F(" ",e.getComandaItems().length," piatt",e.getComandaItems().length!==1?"i":"o"," "),l(),m("ngIf",e.shouldShowComandaDropdown()),l(2),m("ngIf",e.currentComanda)}}function zt(s,t){if(s&1){let e=C();r(0,"div",6),_("click",function(){u(e);let a=c();return p(a.close())}),r(1,"div",7),_("click",function(a){return u(e),p(a.stopPropagation())}),r(2,"div",8)(3,"div",9)(4,"button",10),_("click",function(){u(e);let a=c();return p(a.close())}),r(5,"span",11),o(6,"arrow_back"),n()(),r(7,"div",12)(8,"h1",13),o(9),f(10,at,2,1,"span",14),n(),r(11,"div",15)(12,"span",16),o(13),M(14,"number"),n()()()(),r(15,"div",17),f(16,ot,3,2,"div",18),r(17,"button",10),_("click",function(){u(e);let a=c();return p(a.showComandaPage=!a.showComandaPage)}),r(18,"span",11),o(19),n()(),r(20,"button",19),_("click",function(){u(e);let a=c();return p(a.close())}),r(21,"span",11),o(22,"close"),n()()()(),r(23,"div",20),f(24,xt,11,6,"div",21),r(25,"div",22)(26,"div",23)(27,"div",24)(28,"input",25),S("ngModelChange",function(a){u(e);let d=c();return y(d.dishSearchTerm,a)||(d.dishSearchTerm=a),p(a)}),n()(),r(29,"div",26)(30,"select",27),S("ngModelChange",function(a){u(e);let d=c();return y(d.selectedCategory,a)||(d.selectedCategory=a),p(a)}),r(31,"option",28),o(32,"Tutte"),n(),f(33,bt,3,7,"option",29),n()(),r(34,"div",30)(35,"button",10),_("click",function(){u(e);let a=c();return p(a.resetDishFilters())}),r(36,"span",11),o(37,"refresh"),n()()()()(),r(38,"div",31),f(39,Ot,14,6,"div",32)(40,Ht,14,5,"div",32),n()(),r(41,"div",33)(42,"button",34),_("click",function(){u(e);let a=c();return p(a.createNewComanda())}),r(43,"span",11),o(44,"receipt"),n(),o(45," Nuova Comanda "),n(),r(46,"button",35),_("click",function(){u(e);let a=c();return p(a.saveOrder())}),r(47,"span",11),o(48),n(),o(49),n()()()()}if(s&2){let e=c();l(),R("fullscreen-mobile",e.isMobile),l(8),h(" Tavolo ",e.table.table_number," "),l(),m("ngIf",e.currentComanda),l(3),j(" ",e.comandaItemsCount," piatt",e.comandaItemsCount!==1?"i":"o"," \u2022 \u20AC",k(14,21,e.totaleTavolata,"1.2-2")," "),l(3),m("ngIf",e.shouldShowComandaDropdown()),l(3),O(e.showComandaPage?"restaurant":"receipt_long"),l(5),m("ngIf",e.hasMenusToShow()),l(4),w("ngModel",e.dishSearchTerm),l(2),w("ngModel",e.selectedCategory),l(3),m("ngForOf",e.getCategories()),l(6),m("ngIf",!e.showComandaPage),l(),m("ngIf",e.showComandaPage),l(2),m("disabled",!e.orderHeader||!e.isComandaEditable())("title",e.isComandaEditable()?"Crea una nuova comanda nella tavolata corrente":"La comanda corrente \xE8 in stato avanzato, completa prima di crearne una nuova"),l(4),m("disabled",!e.hasUnsavedChanges&&!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?e.hasUnsavedChanges?"Salva modifiche":"Nessuna modifica da salvare":e.orderingStatus.reason),l(2),O(e.hasUnsavedChanges?"save":"check_circle"),l(),h(" ",e.hasUnsavedChanges?"Salva Modifiche":"Gi\xE0 salvato",`
`)}}function Lt(s,t){if(s&1){let e=C();r(0,"div",86)(1,"span",11),o(2,"receipt"),n(),r(3,"h3"),o(4,"Nessun ordine attivo"),n(),r(5,"p",87),o(6,"Non ci sono ordini per questo tavolo"),n(),r(7,"button",122),_("click",function(){u(e);let a=c(2);return p(a.switchToEditMode())}),r(8,"span",11),o(9,"add"),n(),o(10," Crea Primo Ordine "),n()()}}function At(s,t){if(s&1&&(r(0,"div",96)(1,"small",87),o(2),n()()),s&2){let e=c().$implicit;l(2),h("Note: ",e.item_notes)}}function qt(s,t){if(s&1&&(r(0,"div",143)(1,"div",12)(2,"div",144)(3,"strong"),o(4),n(),f(5,At,3,1,"div",94),n(),r(6,"div",145)(7,"span"),o(8),M(9,"number"),n(),r(10,"span"),o(11,"\u2022"),n(),r(12,"span"),o(13),n()(),r(14,"span",146),o(15),n()(),r(16,"div",136)(17,"span",49),o(18),M(19,"number"),n(),r(20,"small",134),o(21,"Totale"),n()()()),s&2){let e=t.$implicit,i=c(6);l(4),O(i.getDishName(e)),l(),m("ngIf",e.item_notes),l(3),h("\u20AC",k(9,8,e.unit_price,"1.2-2")," cad."),l(5),h("Quantit\xE0: ",e.quantity),l(),A("background-color",i.getOrderStatusColor(e.status)),l(),h(" ",i.getOrderStatusText(e.status)," "),l(3),h("\u20AC",k(19,11,e.total_price,"1.2-2"))}}function Nt(s,t){if(s&1&&(r(0,"div",141),f(1,qt,22,14,"div",142),n()),s&2){let e=c(2).$implicit;l(),m("ngForOf",e.order_items)}}function Wt(s,t){s&1&&(r(0,"div",147)(1,"span",11),o(2,"restaurant_menu"),n(),r(3,"p",87),o(4,"Nessun piatto in questa comanda"),n()())}function Bt(s,t){if(s&1&&(r(0,"div",98),f(1,Nt,2,1,"div",138)(2,Wt,5,0,"div",139),r(3,"div",140)(4,"strong",100),o(5),n(),r(6,"strong",101),o(7),M(8,"number"),n()()()),s&2){let e=c().$implicit,i=c(3);l(),m("ngIf",e.order_items&&e.order_items.length>0),l(),m("ngIf",!e.order_items||e.order_items.length===0),l(3),h("Totale Comanda ",e.comanda_number),l(2),h(" \u20AC",k(8,4,i.getComandaTotal(e),"1.2-2")," ")}}function $t(s,t){if(s&1){let e=C();r(0,"div",128)(1,"div",129),_("click",function(){let a=u(e).$implicit,d=c(3);return p(d.toggleComandaExpansion(a.id))}),r(2,"div",130)(3,"div",131)(4,"div",132)(5,"h3",49),o(6),n(),r(7,"span",133),o(8),n()(),r(9,"div",134),o(10),M(11,"date"),n()()(),r(12,"div",135)(13,"div",136)(14,"span",76),o(15),M(16,"number"),n(),r(17,"span",16),o(18),n()()()(),f(19,Bt,9,7,"div",137),n()}if(s&2){let e=t.$implicit,i=c(3);l(6),h("Comanda ",e.comanda_number),l(),A("background-color",i.getOrderStatusColor(e.status)),l(),h(" ",i.getOrderStatusText(e.status)," "),l(2),h(" ",k(11,9,e.created_at,"dd/MM/yyyy HH:mm")," "),l(5),h(" \u20AC",k(16,12,i.getComandaTotal(e),"1.2-2")," "),l(3),F(" ",(e.order_items==null?null:e.order_items.length)||0," piatto",(e.order_items==null?null:e.order_items.length)!==1?"i":""," "),l(),m("ngIf",i.isComandaExpanded(e.id))}}function jt(s,t){if(s&1&&(r(0,"div",70),f(1,$t,20,15,"div",123),r(2,"div",124)(3,"div",90)(4,"div")(5,"strong",125),o(6,"TOTALE TAVOLO"),n(),r(7,"p",126),o(8),n()(),r(9,"strong",127),o(10),M(11,"number"),n()()()()),s&2){let e=c(2);l(),m("ngForOf",e.orderHeader.comande),l(7),h(" ",e.getTotalComandeCount()," comande "),l(2),h(" \u20AC",k(11,3,e.calcolaTotaleTavolata(),"1.2-2")," ")}}function Qt(s,t){if(s&1){let e=C();r(0,"div",6),_("click",function(){u(e);let a=c();return p(a.close())}),r(1,"div",112),_("click",function(a){return u(e),p(a.stopPropagation())}),r(2,"div",113)(3,"div",17)(4,"div",114)(5,"span",11),o(6,"receipt_long"),n()(),r(7,"div")(8,"h1",115),o(9),n(),r(10,"div",15)(11,"span",93),o(12),n(),r(13,"span",63),o(14),M(15,"number"),n()()()(),r(16,"button",10),_("click",function(){u(e);let a=c();return p(a.close())}),r(17,"span",11),o(18,"close"),n()()(),r(19,"div",116),f(20,Lt,11,0,"div",117)(21,jt,12,6,"div",118),r(22,"div",119)(23,"button",120),_("click",function(){u(e);let a=c();return p(a.printBillAndFreeTable())}),r(24,"span",11),o(25,"receipt"),n(),o(26," STAMPA SCONTRINO "),n(),r(27,"button",121),_("click",function(){u(e);let a=c();return p(a.close())}),r(28,"span",11),o(29,"close"),n(),o(30," Chiudi "),n()()()()()}if(s&2){let e=c();l(),R("fullscreen-mobile",e.isMobile),l(8),h("Ordini Tavolo ",e.table.table_number||"N/A"),l(3),F(" ",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)||0," Ordine",(e.orderHeader==null||e.orderHeader.comande==null?null:e.orderHeader.comande.length)!==1?"i":""," "),l(2),h(" Totale: \u20AC",k(15,9,e.calcolaTotaleTavolata(),"1.2-2")," "),l(6),m("ngIf",!e.orderHeader||!e.orderHeader.comande||e.orderHeader.comande.length===0),l(),m("ngIf",e.orderHeader&&e.orderHeader.comande&&e.orderHeader.comande.length>0),l(2),m("disabled",!e.orderHeader||!e.orderHeader.comande||e.orderHeader.comande.length===0)}}var me=class s{orderHelper=b(Be);orderHeaderService=b(de);comandaService=b(le);orderItemService=b(se);dishService=b(ze);loadingService=b(W);categoryService=b(Le);menuService=b($e);cdr=b(Y);restaurantPublicService=b(Ae);authService=b(N);orderStateService=b(je);cachedDishGroups=[];lastDishesLength=0;lastCategoryId="";lastSearchTerm="";table;mode="edit";existingOrderHeader;orderingStatus={allowed:!0,reason:""};selectedComandaId;saved=new ge;closeRequested=new ge;orderHeader=null;currentComanda=null;dishes=[];currentComandaId="";isLoading=!1;restaurantData=null;searchTerm="";selectedCategory="all";dishSearchTerm="";isMobile=!1;isNewOrder=!1;activeMenus=[];selectedMenu={id:"all",name:"Tutti i piatti"};menuDishes=[];comandeExpanded={};showComandaPage=!1;draftOrder=null;localChanges=[];hasUnsavedChanges=!1;constructor(){}ngOnInit(){return v(this,null,function*(){console.log("\u{1F504} OrderEditor init - mode:",this.mode),this.loadingService.start(),this.isLoading=!0;try{console.log("\u{1F4CA} Tavolo:",this.table?.table_number),console.log("\u{1F4E6} Existing Order Header:",this.existingOrderHeader?.id),yield this.dishService.loadData(),this.dishes=this.dishService.getActiveDishes(),console.log("\u{1F37D}\uFE0F Piatti caricati:",this.dishes.length),yield this.categoryService.loadData(),yield this.loadActiveMenus(),this.mode==="view"&&this.existingOrderHeader?yield this.loadOrderForView():this.mode==="edit"&&(yield this.setupForEdit());let t=yield this.authService.getCurrentRestaurantId();t&&(this.restaurantData=yield this.restaurantPublicService.loadRestaurantById(t),console.log("\u{1F3E2} Dati ristorante caricati:",this.restaurantData))}catch(t){console.error("\u274C Errore inizializzazione order-editor:",t)}finally{this.loadingService.stop(),this.isLoading=!1,this.cdr.markForCheck()}})}loadActiveMenus(){return v(this,null,function*(){try{if(yield this.menuService.loadMenus(),this.activeMenus=this.menuService.getCurrentMenus().filter(t=>t.is_active),console.log("\u{1F4CB} Menu attivi:",this.activeMenus.length),this.activeMenus.length>0){let t=this.activeMenus.find(e=>e.is_default);this.selectedMenu=t||this.activeMenus[0],yield this.loadDishesForSelectedMenu()}}catch(t){console.error("\u274C Errore caricamento menu:",t)}})}loadDishesForSelectedMenu(){return v(this,null,function*(){if(this.selectedMenu.id==="all")this.dishes=this.dishService.getActiveDishes(),this.menuDishes=[];else try{this.menuDishes=yield this.menuService.getDishesWithDetailsByMenu(this.selectedMenu.id),this.dishes=this.menuDishes.filter(t=>t.dish&&!t.dish.deleted_at).map(t=>t.dish)}catch(t){console.error("\u274C Errore caricamento piatti menu:",t),this.dishes=this.dishService.getActiveDishes()}})}loadOrderForView(){return v(this,null,function*(){if(this.existingOrderHeader)try{this.loadingService.start(),this.isLoading=!0,console.log("\u{1F441}\uFE0F Caricamento ordine per visualizzazione:",this.existingOrderHeader.id);let t=yield this.orderHelper.loadFullOrder(this.existingOrderHeader.id);if(t){if(this.orderHeader=t,console.log("\u2705 Ordine caricato con",t.comande?.length,"comande"),t.comande&&t.comande.forEach((e,i)=>{console.log(`\u{1F4CA} Comanda ${i+1}:`,{comanda_number:e.comanda_number,total_amount:e.total_amount,items_count:e.order_items?.length,items_total:e.order_items?.reduce((a,d)=>a+(d.total_price||0),0)})}),t.comande&&t.comande.length>0){let e=t.comande.find(i=>i.status!=="cancelled");this.currentComanda=e||t.comande[0],console.log("\u{1F4CB} Comanda corrente:",this.currentComanda?.comanda_number)}}else console.error("\u274C Ordine non trovato")}catch(t){console.error("\u274C Errore caricamento ordine:",t)}finally{this.loadingService.stop(),this.isLoading=!1}})}setupForEdit(){return v(this,null,function*(){try{if(console.log("\u270F\uFE0F Setup modalit\xE0 edit in DRAFT per tavolo:",this.table.table_number),this.existingOrderHeader)console.log("\u{1F4E6} Carico ordine esistente in draft:",this.existingOrderHeader.id),this.draftOrder=yield this.orderHelper.loadFullOrder(this.existingOrderHeader.id),this.updateOrderHeader(),this.isNewOrder=!1;else{let t=yield this.orderHeaderService.getActiveByTable(this.table.id);t?(console.log("\u2705 Tavolata esistente trovata, carico in draft"),this.draftOrder=yield this.orderHelper.loadFullOrder(t.id),this.updateOrderHeader(),this.isNewOrder=!1):(console.log("\u{1F195} Creo nuova struttura vuota in draft"),this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader(),this.isNewOrder=!0)}if(this.draftOrder?.comande&&this.draftOrder.comande.length>0){if(this.selectedComandaId){let t=this.draftOrder.comande.find(e=>e.id===this.selectedComandaId);this.currentComanda=t||this.draftOrder.comande[0],console.log("\u{1F3AF} Comanda selezionata tramite ID:",this.selectedComandaId)}else{let t=this.draftOrder.comande.slice().reverse().find(e=>e.status!=="cancelled");this.currentComanda=t||this.draftOrder.comande[0]}this.currentComanda&&(this.currentComandaId=this.currentComanda.id)}this.dishes=this.dishService.getActiveDishes(),yield this.loadActiveMenus()}catch(t){console.error("\u274C Errore setup edit:",t)}})}createEmptyOrderHeader(){return{id:"draft-"+Date.now(),restaurant_id:"",table_id:this.table.id,order_number:"DRAFT-"+this.table.table_number+"-"+Date.now(),status:"draft",customer_name:"Cliente",total_amount:0,comande:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}loadOrderForEdit(t){return v(this,null,function*(){console.log("\u{1F504} Caricamento ordine per edit:",t);let e=yield this.orderHelper.loadFullOrder(t);if(!e){console.error("\u274C Ordine non trovato per edit");return}if(this.orderHeader=e,e.comande&&e.comande.length>0){let i=e.comande.slice().reverse().find(a=>a.status!=="cancelled");this.currentComanda=i||e.comande[0],console.log("\u{1F4CB} Comanda attiva per edit:",this.currentComanda?.comanda_number)}})}createNewOrder(){return v(this,null,function*(){console.log("\u{1F195} Creazione tavolata per tavolo:",this.table.table_number);try{let t=yield this.orderHelper.occupyTable(this.table.id,"Cliente");return!t.orderHeader||!t.comanda?(console.error("\u274C Impossibile creare tavolata"),!1):(this.orderHeader=yield this.orderHelper.loadFullOrder(t.orderHeader.id),this.orderHeader?.comande&&this.orderHeader.comande.length>0&&(this.currentComanda=this.orderHeader.comande[0]),console.log("\u2705 Tavolata creata:",t.orderHeader.id),!0)}catch(t){return console.error("\u274C Errore creazione tavolata:",t),!1}})}createNewComanda(){return v(this,null,function*(){try{console.log("\u{1F195} Creazione nuova comanda in modalit\xE0 DRAFT"),this.draftOrder||(console.log("\u{1F4DD} Creo prima una struttura draft"),this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader()),yield this.createNewComandaLocal(),console.log("\u2705 Nuova comanda creata in draft")}catch(t){console.error("\u274C Errore creazione nuova comanda:",t)}})}addDish(t){return v(this,null,function*(){try{if(console.log("\u2795 Aggiungi piatto in DRAFT:",t.name),this.draftOrder||(this.draftOrder=this.createEmptyOrderHeader(),this.orderHeader=V({},this.draftOrder),this.orderHeader.comande&&(this.orderHeader.comande=[...this.orderHeader.comande])),this.currentComanda||(yield this.createNewComandaLocal()),this.currentComanda&&this.currentComanda.order_items){let a=this.currentComanda.order_items.find(d=>d.dish_id===t.id);if(a){console.log("\u{1F4C8} Piatto gi\xE0 presente, incremento quantit\xE0"),this.cdr.markForCheck(),yield this.updateQuantity(a,1);return}}if(!this.currentComanda){console.error("\u274C currentComanda \xE8 ancora null"),this.cdr.markForCheck();return}let e={id:"draft-item-"+Date.now(),order_id:this.currentComanda.id,dish_id:t.id,dish_name:t.name,quantity:1,unit_price:t.base_price,total_price:t.base_price,status:"ordered",item_notes:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};this.currentComanda.order_items||(this.currentComanda.order_items=[]),this.currentComanda.order_items.push(e),this.draftOrder.comande||(this.draftOrder.comande=[]);let i=this.draftOrder.comande.findIndex(a=>a.id===this.currentComanda.id);i>=0?this.draftOrder.comande[i]=this.currentComanda:this.draftOrder.comande.push(this.currentComanda),this.localChanges.push({type:"add",data:e,timestamp:new Date}),this.hasUnsavedChanges=!0,this.updateLocalTotals(),console.log("\u2705 Piatto aggiunto in draft. Modifiche in sospeso:",this.localChanges.length)}catch(e){console.error("\u{1F4A5} Errore in addDish (draft):",e)}finally{this.cdr.markForCheck()}})}createNewComandaLocal(){return v(this,null,function*(){this.draftOrder||(this.draftOrder=this.createEmptyOrderHeader(),this.updateOrderHeader()),console.log("\u{1F195} Creo nuova comanda in DRAFT per tavolata:",this.draftOrder.id);let t=(this.draftOrder.comande?.length||0)+1,e={id:"draft-comanda-"+Date.now(),order_number:`${this.draftOrder.order_number}-${t}`,restaurant_id:"",order_header_id:this.draftOrder.id,tavolata_id:this.draftOrder.id,comanda_number:t,table_id:this.table.id,customer_name:this.draftOrder.customer_name,status:"ordered",order_type:"dine_in",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,order_items:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};this.draftOrder.comande||(this.draftOrder.comande=[]),this.draftOrder.comande.push(e),this.currentComanda=e,this.currentComandaId=e.id,this.updateOrderHeader(),this.localChanges.push({type:"new_comanda",data:e,timestamp:new Date}),this.hasUnsavedChanges=!0,console.log("\u2705 Nuova comanda creata in draft:",t)})}addDishToOrder(t){this.addDish(t)}updateQuantity(t,e){return v(this,null,function*(){if(this.currentComanda?.order_items)try{let i=t.quantity+e;if(i<1){this.cdr.markForCheck(),yield this.removeItemLocal(t);return}let a=this.currentComanda.order_items.findIndex(g=>g.id===t.id);if(a===-1)return;let d=this.currentComanda.order_items[a];d.quantity=i,d.total_price=d.unit_price*i,this.updateLocalTotals(),this.localChanges.push({type:"update",data:{itemId:t.id,quantity:i},timestamp:new Date}),this.hasUnsavedChanges=!0,console.log("\u{1F4C8} Quantit\xE0 aggiornata in draft:",i)}catch(i){console.error("\u274C Errore in updateQuantity:",i)}finally{this.cdr.markForCheck()}})}removeItemLocal(t){return v(this,null,function*(){if(this.currentComanda?.order_items)try{let e=this.currentComanda.order_items.findIndex(i=>i.id===t.id);if(e===-1)return;this.currentComanda.order_items.splice(e,1),this.localChanges.push({type:"delete",data:t,timestamp:new Date}),this.hasUnsavedChanges=!0,this.updateLocalTotals(),console.log("\u{1F5D1}\uFE0F Piatto rimosso in draft:",t.id)}catch(e){console.error("\u274C Errore in removeItemLocal:",e)}finally{this.cdr.markForCheck()}})}updateLocalTotals(){if(!(!this.currentComanda||!this.currentComanda.order_items)&&(this.recalculateComandaTotal(this.currentComanda),this.draftOrder&&this.draftOrder.comande&&(this.draftOrder.comande.forEach(t=>{this.recalculateComandaTotal(t)}),this.draftOrder.total_amount=this.draftOrder.comande.reduce((t,e)=>t+(e.total_amount||0),0),this.orderHeader))){this.orderHeader.total_amount=this.draftOrder.total_amount;let t=this.orderHeader.comande?.findIndex(e=>e.id===this.currentComanda?.id);t!==void 0&&t>=0&&this.orderHeader.comande&&(this.orderHeader.comande[t].total_amount=this.currentComanda.total_amount,this.orderHeader.comande[t].order_items=this.currentComanda.order_items)}}saveAllToDatabase(){return v(this,null,function*(){try{if(console.log("\u{1F4BE} Salvando tutte le modifiche in database...",this.localChanges.length,"modifiche"),!this.draftOrder)return console.error("\u274C Nessun draft da salvare"),!1;let t=!0,e=this.draftOrder.id;if(this.isNewOrder&&this.draftOrder.id.startsWith("draft-")){console.log("\u{1F195} Creazione nuova tavolata nel database...");let a=yield this.orderHeaderService.createForTable(this.table.id,this.draftOrder.customer_name||"Cliente");if(!a)return console.error("\u274C Impossibile creare order header"),!1;e=a.id,console.log("\u2705 Order header creato:",e)}let i=new Map;for(let a of this.localChanges.filter(d=>d.type==="new_comanda")){let d=a.data;console.log("\u{1F4E6} Creazione comanda nel database...");let g=yield this.comandaService.createForOrderHeader(e,d.comanda_number);g?(i.set(d.id,g.id),console.log(`\u2705 Comanda creata: draft ${d.id} -> real ${g.id}`)):(console.error("\u274C Errore creazione comanda per:",d.id),t=!1)}for(let a of this.localChanges)switch(a.type){case"add":let d=a.data,g=d.order_id;i.has(d.order_id)&&(g=i.get(d.order_id)),console.log("\u2795 Aggiungo piatto al database..."),(yield this.orderItemService.addItemToComanda(g,d.dish_id,d.quantity,d.unit_price,d.item_notes||""))||(console.error("\u274C Errore aggiunta piatto:",d),t=!1);break;case"update":let T=a.data;T.itemId.startsWith("draft-")||(console.log("\u{1F4C8} Aggiorno quantit\xE0 nel database..."),(yield this.orderHelper.updateItemQuantity(T.itemId,T.quantity))||(console.error("\u274C Errore aggiornamento quantit\xE0:",T),t=!1));break;case"delete":let E=a.data;E.id.startsWith("draft-")||(console.log("\u{1F5D1}\uFE0F Rimuovo piatto dal database..."),(yield this.orderHelper.removeItem(E.id))||(console.error("\u274C Errore rimozione piatto:",E),t=!1));break}return t}catch(t){return console.error("\u{1F4A5} Errore durante il salvataggio:",t),!1}})}confirmRemoveItem(t){window.confirm(`Vuoi eliminare "${t.dish_name}" dalla comanda?`)&&this.removeItemLocal(t)}updateTotals(){!this.currentComanda||!this.currentComanda.order_items||(this.currentComanda.total_amount=this.currentComanda.order_items.reduce((t,e)=>t+(e.total_price||0),0),this.orderHeader&&this.orderHeader.comande&&(this.orderHeader.total_amount=this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)),console.log("\u{1F4B0} Totale aggiornato:",this.currentComanda.total_amount))}getFilteredDishes(){let t=this.dishes;if(this.selectedCategory!=="all"&&(t=t.filter(e=>e.category_id===this.selectedCategory)),this.dishSearchTerm){let e=this.dishSearchTerm.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(e)||i.description?.toLowerCase().includes(e))}return t}getComandaItems(){return this.currentComanda?.order_items||[]}getComandaTotal(t){let e=t||this.currentComanda;if(!e||!e.order_items)return 0;if(e.total_amount===0&&e.order_items.length>0){let i=e.order_items.reduce((a,d)=>{let g=d.total_price||d.unit_price*d.quantity;return a+g},0);return e.total_amount=i,i}return e.total_amount||0}getDishesCountByCategory(t){let e=this.getFilteredDishes();return t==="all"?e.length:e.filter(i=>i.category_id===t).length}getDishesGroupedByCategory(){let t=this.dishes.length;if(!(this.lastCategoryId!==this.selectedCategory||this.lastSearchTerm!==this.dishSearchTerm||this.lastDishesLength!==t)&&this.cachedDishGroups.length>0)return this.cachedDishGroups;let i=this.getFilteredDishes(),a=this.categoryService.data,d=[];return a.forEach(g=>{let x=i.filter(T=>T.category_id===g.id);x.length>0&&d.push({category:g,dishes:x})}),this.cachedDishGroups=d,this.lastCategoryId=this.selectedCategory,this.lastSearchTerm=this.dishSearchTerm,this.lastDishesLength=t,d}getCategories(){return this.categoryService.data}shouldShowComandaDropdown(){return(this.orderHeader?.comande?.length||0)>1}getComandeForDropdown(){return this.orderHeader?.comande||[]}getCurrentComande(){return this.orderHeader?.comande||[]}switchComanda(t){if(!t||!this.orderHeader?.comande)return;let e=this.orderHeader.comande.find(i=>i.id===t);e&&(this.currentComanda=e,this.currentComandaId=t,this.recalculateComandaTotal(this.currentComanda),console.log("\u{1F504} Comanda cambiata:",e.comanda_number,"Totale:",this.currentComanda.total_amount))}recalculateComandaTotal(t){if(!t.order_items||t.order_items.length===0){t.total_amount=0;return}let e=t.order_items.reduce((i,a)=>{let d=a.total_price||a.unit_price*a.quantity;return i+d},0);t.total_amount=e,console.log(`\u{1F4B0} Comanda ${t.comanda_number} totale ricalcolato:`,e)}getComandaTotalQuantity(t){let e=t||this.currentComanda;return!e||!e.order_items?0:e.order_items.reduce((i,a)=>i+(a.quantity||1),0)}toggleComandaExpansion(t){this.comandeExpanded[t]=!this.comandeExpanded[t]}isComandaExpanded(t){return this.comandeExpanded[t]||!1}saveOrder(){return v(this,null,function*(){try{if(this.loadingService.start(),this.isLoading=!0,console.log("\u{1F4BE} Salvando ordine..."),yield this.saveAllToDatabase()){if(console.log("\u2705 Ordine salvato nel database"),this.draftOrder&&!this.draftOrder.id.startsWith("draft-")){let e=yield this.orderHelper.loadFullOrder(this.draftOrder.id);if(e&&(this.draftOrder=e,this.orderHeader=JSON.parse(JSON.stringify(e)),e.comande&&e.comande.length>0)){let i=e.comande.slice().reverse().find(a=>a.status!=="cancelled");this.currentComanda=i||e.comande[0]}}this.saved.emit(this.orderHeader),this.localChanges=[],this.hasUnsavedChanges=!1,console.log("\u{1F389} Ordine salvato con successo")}else console.error("\u274C Errore durante il salvataggio"),alert("Errore durante il salvataggio dell'ordine")}catch(t){console.error("\u274C Errore salvataggio ordine:",t),alert("Errore durante il salvataggio: "+t.message)}finally{this.loadingService.stop(),this.isLoading=!1}})}close(){this.hasUnsavedChanges&&!window.confirm("Hai modifiche non salvate. Vuoi davvero chiudere senza salvare?")||(console.log("\u{1F6AA} Chiusura order editor"),this.closeRequested.emit())}calcolaTotaleTavolata(){return!this.orderHeader||!this.orderHeader.comande?0:this.orderHeader.comande.reduce((t,e)=>t+this.getComandaTotal(e),0)}calcolaTotaleOrderHeader(t){return t.total_amount||0}getTotalComandeCount(){return this.orderHeader?.comande?.length||0}getOrderStatusColor(t){return{ordered:"#f39c12",waiting:"#3498db",preparing:"#9b59b6",ready:"#2ecc71",served:"#27ae60",cancelled:"#e74c3c",error:"#e74c3c"}[t]||"#95a5a6"}getOrderStatusText(t){return{ordered:"Ordinato",waiting:"In attesa",preparing:"In preparazione",ready:"Pronto",served:"Servito",cancelled:"Cancellato"}[t]||t}getDishName(t){return t.dish_name||"Piatto"}resetDishFilters(){this.dishSearchTerm="",this.selectedCategory="all",this.cachedDishGroups=[]}trackByDishId(t,e){return e.id}trackByCategoryId(t,e){return e.category.id}onMenuSelectChange(t){this.selectedMenu=t,this.cachedDishGroups=[],this.loadDishesForSelectedMenu()}printBillAndFreeTable(){return v(this,null,function*(){if(window.confirm(`Vuoi stampare lo scontrino e liberare il tavolo ${this.table.table_number}?`))try{this.loadingService.start();let e=this.generateProfessionalBill(),i=window.open("","_blank","width=800,height=600");if(!i){alert("Impossibile aprire la finestra di stampa. Controlla il blocco popup.");return}i.document.write(e),i.document.close(),i.onload=()=>{i.print(),i.onafterprint=()=>v(this,null,function*(){i.close(),yield this.freeTableAfterBill()})}}catch(e){console.error("\u274C Errore stampa scontrino:",e),alert("Errore durante la stampa dello scontrino")}finally{this.loadingService.stop()}})}freeTableAfterBill(){return v(this,null,function*(){try{if(console.log("\u{1F193} Liberazione tavolo dopo scontrino per tavolo:",this.table.table_number),!this.orderHeader){console.error("\u274C Nessun order header da chiudere");return}if(yield this.orderHelper.closeTavolata(this.orderHeader.id)){if(console.log("\u2705 Tavolata chiusa con successo"),this.orderHeader.comande)for(let e of this.orderHeader.comande)e.status!=="cancelled"&&e.status!=="served"&&(yield this.orderHelper.updateComandaStatus(e.id,"served"),console.log(`\u2705 Comanda ${e.comanda_number} aggiornata a 'served'`));this.saved.emit(this.orderHeader),this.closeRequested.emit(),console.log("\u2705 Tavolo liberato con successo")}else console.error("\u274C Errore nella chiusura della tavolata"),alert("Errore nella chiusura del tavolo")}catch(t){console.error("\u{1F4A5} Errore in freeTableAfterBill:",t),alert("Errore nella chiusura del tavolo: "+t.message)}})}generateProfessionalBill(){let t=new Date,e=t.toLocaleDateString("it-IT"),i=t.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),a=this.restaurantData?.logo_url?`<img src="${this.restaurantData.logo_url}" alt="Logo" style="max-width: 150px; margin: 0 auto 20px;">`:"",d=`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>Scontrino - Tavolo ${this.table.table_number}</title>
      <style>
        @media print {
          @page { margin: 0; size: 80mm auto; }
          body { margin: 0; padding: 10mm; }
        }
        
        body {
          font-family: 'Courier New', monospace;
          font-size: 12px;
          line-height: 1.4;
          max-width: 80mm;
          margin: 0 auto;
          padding: 10px;
        }
        
        .header {
          text-align: center;
          border-bottom: 2px dashed #000;
          padding-bottom: 10px;
          margin-bottom: 15px;
        }
        
        .restaurant-name {
          font-size: 18px;
          font-weight: bold;
          margin: 10px 0;
        }
        
        .restaurant-info {
          font-size: 10px;
          margin: 3px 0;
        }
        
        .receipt-info {
          margin: 15px 0;
          font-size: 11px;
        }
        
        .comanda-section {
          margin: 15px 0;
          border-top: 1px solid #000;
          padding-top: 10px;
        }
        
        .comanda-title {
          font-weight: bold;
          margin-bottom: 8px;
        }
        
        .item-row {
          display: flex;
          justify-content: space-between;
          margin: 5px 0;
        }
        
        .item-name {
          flex: 1;
        }
        
        .item-price {
          text-align: right;
          min-width: 60px;
        }
        
        .totals {
          border-top: 2px solid #000;
          margin-top: 15px;
          padding-top: 10px;
        }
        
        .total-row {
          display: flex;
          justify-content: space-between;
          margin: 5px 0;
          font-size: 14px;
        }
        
        .grand-total {
          font-weight: bold;
          font-size: 16px;
          border-top: 2px dashed #000;
          margin-top: 10px;
          padding-top: 10px;
        }
        
        .footer {
          text-align: center;
          margin-top: 20px;
          padding-top: 15px;
          border-top: 2px dashed #000;
          font-size: 10px;
        }
      </style>
    </head>
    <body>
      <div class="header">
        ${a}
        <div class="restaurant-name">${this.restaurantData?.name||"RISTORANTE"}</div>
        ${this.restaurantData?.address?`<div class="restaurant-info">${this.restaurantData.address}</div>`:""}
        ${this.restaurantData?.phone?`<div class="restaurant-info">Tel: ${this.restaurantData.phone}</div>`:""}
        ${this.restaurantData?.email?`<div class="restaurant-info">${this.restaurantData.email}</div>`:""}
      </div>
      
      <div class="receipt-info">
        <div><strong>Tavolo:</strong> ${this.table.table_number}</div>
        <div><strong>Data:</strong> ${e}</div>
        <div><strong>Ora:</strong> ${i}</div>
        <div><strong>Scontrino:</strong> #${this.orderHeader?.order_number||"N/A"}</div>
      </div>
  `;this.orderHeader?.comande&&this.orderHeader.comande.forEach((x,T)=>{d+=`
        <div class="comanda-section">
          <div class="comanda-title">COMANDA ${x.comanda_number}</div>
      `,x.order_items&&x.order_items.forEach(E=>{let P=E.unit_price*E.quantity;d+=`
            <div class="item-row">
              <span class="item-name">${E.quantity}x ${E.dish_name}</span>
              <span class="item-price">\u20AC ${P.toFixed(2)}</span>
            </div>
          `}),d+=`
          <div class="item-row" style="margin-top: 8px; font-weight: bold;">
            <span>Subtotale Comanda ${x.comanda_number}:</span>
            <span class="item-price">\u20AC ${(x.total_amount||0).toFixed(2)}</span>
          </div>
        </div>
      `});let g=this.calcolaTotaleTavolata();return d+=`
      <div class="totals">
        <div class="total-row grand-total">
          <span>TOTALE DA PAGARE</span>
          <span>\u20AC ${g.toFixed(2)}</span>
        </div>
      </div>
      
      <div class="footer">
        <div>Grazie per la visita!</div>
        <div style="margin-top: 5px;">Arrivederci</div>
      </div>
    </body>
    </html>
  `,d}get dedicatedMenu(){return this.activeMenus.find(t=>t.type==="dedicated")||null}get globalMenus(){return this.activeMenus.filter(t=>t.type==="global")}hasMenusToShow(){return this.activeMenus.length>0}hasDedicatedMenu(){return this.activeMenus.some(t=>t.type==="dedicated")}hasGlobalMenus(){return this.activeMenus.some(t=>t.type==="global")}switchToEditMode(){this.closeRequested.emit()}updateOrderHeader(){this.draftOrder&&(this.orderHeader=z(V({},this.draftOrder),{comande:this.draftOrder.comande}))}trackByOrderItemId(t,e){return e.id}get comandaItemsCount(){return this.currentComanda?.order_items?.length||0}get totaleTavolata(){return!this.orderHeader||!this.orderHeader.comande?0:this.orderHeader.comande.reduce((t,e)=>t+(e.total_amount||0),0)}isComandaEditable(t){let e=t||this.currentComanda;return e?["ordered","waiting","draft"].includes(e.status):!0}isItemEditable(t){return["ordered","waiting","draft"].includes(t.status)}canAddItemsToCurrentComanda(){return this.currentComanda?this.isComandaEditable(this.currentComanda):!0}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=G({type:s,selectors:[["app-order-editor"]],inputs:{table:"table",mode:"mode",existingOrderHeader:"existingOrderHeader",orderingStatus:"orderingStatus",selectedComandaId:"selectedComandaId"},outputs:{saved:"saved",closeRequested:"closeRequested"},decls:3,vars:3,consts:[["noDishes",""],["emptyOrder",""],["class","order-editor-loader",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"order-editor-loader"],[3,"isLoading"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-lg","fullscreen-mobile",3,"click"],[1,"modal-header","compact-header"],[1,"flex","items-center","gap-sm","flex-1"],[1,"icon-button",3,"click"],[1,"material-icons"],[1,"flex","flex-col","flex-1"],[1,"section-title","text-md"],["class","chip active ml-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","mt-sm"],[1,"text-muted","text-mini"],[1,"flex","items-center","gap-sm"],[4,"ngIf"],["title","Chiudi",1,"icon-button",3,"click"],[1,"p-lg","modal-content-scroll"],["class","menu-selector mb-lg",4,"ngIf"],[1,"search-bar-mobile","mb-md"],[1,"form-row"],[1,"form-group",2,"flex","3"],["type","text","placeholder","Cerca piatto...","autofocus","",1,"form-input","touch-target",3,"ngModelChange","ngModel"],[1,"form-group",2,"flex","1"],[1,"form-input","touch-target",3,"ngModelChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[1,"flex",2,"margin-bottom","var(--gap-sm)"],[1,"flex","flex-col","gap-md"],["class","flex flex-col gap-md",4,"ngIf"],[1,"modal-footer","p-sm"],[1,"promethea-button","flex-1",3,"click","disabled","title"],[1,"promethea-button","primary","flex-1",3,"click","disabled","title"],[1,"chip","active","ml-sm"],[1,"form-input",3,"ngModelChange","ngModel"],[3,"value"],[1,"menu-selector","mb-lg"],[1,"form-group"],[1,"standard-label"],["class","text-primary font-semibold",4,"ngIf"],["class","p-sm bg-primary-light rounded mb-md",4,"ngIf"],["class","p-sm bg-smoke rounded text-center",4,"ngIf"],["class","mt-sm flex items-center gap-sm",4,"ngIf"],[1,"text-primary","font-semibold"],[1,"p-sm","bg-primary-light","rounded","mb-md"],[1,"material-icons","text-primary"],[1,"font-semibold"],[1,"chip","bg-primary","ml-sm","text-white"],["class","p-sm bg-glass rounded border",4,"ngIf"],[1,"p-sm","bg-glass","rounded","border"],[1,"flex","items-center","justify-between"],["class","chip bg-glass",4,"ngIf"],[1,"chip","bg-glass"],[1,"material-icons","text-mini"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"p-sm","bg-smoke","rounded","text-center"],[1,"material-icons","text-muted"],[1,"text-muted","text-mini","mt-sm"],[1,"mt-sm","flex","items-center","gap-sm"],[1,"chip"],["class","chip bg-primary text-white",4,"ngIf"],[1,"chip","bg-primary","text-white"],[1,"quick-actions-mobile"],[1,"quick-action-button",3,"click"],[1,"text-mini"],["class","quick-action-button",3,"active","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","gap-sm"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","gap-sm","items-center"],[1,"font-bold","text-md"],[1,"material-icons","text-md"],[1,"font-bold","text-primary","text-md"],[1,"dishes-grid"],["class","card dish-card",4,"ngFor","ngForOf","ngForTrackBy"],[1,"card","dish-card"],[1,"flex","gap-sm","flex-col","flex-1"],[1,"flex","gap-sm","justify-between"],[1,"dish-name"],[1,"icon-button","x-small",3,"click","disabled","title"],[1,"dish-price","text-primary"],["class","text-muted text-mini",4,"ngIf"],[1,"empty-state"],[1,"text-muted"],[1,"promethea-button","ghost","mt-sm",3,"click"],[1,"form-card",2,"margin","0","padding","var(--gap-sm)"],[1,"flex","justify-between","items-center"],[1,"flex","items-center","gap-sm","font-semibold"],[1,"material-icons","text-primary","text-md"],[1,"chip","active"],["class","mt-sm",4,"ngIf"],[1,"form-card","listacomanda",2,"margin","0","overflow-y","auto"],[1,"mt-sm"],["class","mb-sm pb-sm border-b border-[var(--smoke-1)] last:border-0",4,"ngFor","ngForOf"],[1,"mt-md","pt-md","border-t","border-[var(--smoke-1)]"],[1,"flex","justify-between","items-center","mb-sm"],[1,"text-md"],[1,"text-primary","text-md"],[1,"mb-sm","pb-sm","border-b","border-[var(--smoke-1)]","last:border-0"],[1,"flex","justify-between","items-start","gap-sm"],["title","Riduci quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],[1,"font-bold","px-2","text-center","text-sm","min-w-[20px]"],["title","Aumenta quantit\xE0",1,"icon-button","x-small",3,"click","disabled"],["title","Elimina piatto",1,"icon-button","x-small","ml-1","text-danger",3,"click","disabled"],["class","flex justify-between items-center",4,"ngIf"],[1,"text-secondary"],[1,"empty-state","py-lg"],[1,"material-icons","text-lg"],[1,"modal-container","modal-lg",3,"click"],[1,"modal-header"],[1,"header-icon"],[1,"section-title"],[1,"p-lg"],["class","empty-state",4,"ngIf"],["class","flex flex-col gap-sm",4,"ngIf"],[1,"modal-footer","mt-lg"],[1,"promethea-button","success","flex-1",3,"click","disabled"],[1,"promethea-button","ghost","flex-1",3,"click"],[1,"promethea-button","primary","mt-sm",3,"click"],["class","form-card",4,"ngFor","ngForOf"],[1,"form-card","mt-md","bg-gradient","text-white"],[1,"text-white"],[1,"text-white","text-sm","opacity-80"],[1,"text-white","text-xl"],[1,"form-card"],[1,"flex","justify-between","items-center","cursor-pointer",3,"click"],[1,"flex","items-center","gap-md","flex-1"],[1,"flex","flex-col"],[1,"flex","items-center","gap-sm","flex-wrap"],[1,"chip","small"],[1,"text-muted","mt-sm"],[1,"flex","items-center","gap-md"],[1,"flex","flex-col","items-end"],["class","mt-md pt-md border-t border-[var(--smoke-1)]",4,"ngIf"],["class","space-y-sm",4,"ngIf"],["class","empty-state py-md",4,"ngIf"],[1,"flex","justify-between","items-center","mt-md","pt-md","border-t"],[1,"space-y-sm"],["class","flex justify-between items-start p-sm flex-wrap",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-start","p-sm","flex-wrap"],[1,"flex","items-start","gap-sm"],[1,"flex","items-center","gap-sm","mt-sm","text-muted"],[1,"chip","x-small","mt-sm",2,"max-width","fit-content"],[1,"empty-state","py-md"]],template:function(e,i){e&1&&f(0,rt,2,1,"div",2)(1,zt,50,24,"div",3)(2,Qt,31,12,"div",3),e&2&&(m("ngIf",i.isLoading),l(),m("ngIf",i.mode==="edit"),l(),m("ngIf",i.mode==="view"))},dependencies:[X,J,K,oe,ae,ne,ee,re,te,ie,Ue,Pe,Ie,Me],styles:["@media (max-width: 768px){.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%;width:100%;border-radius:0}}.dishes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(20vw,1fr));gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.dishes-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(40vw,1fr))}.grid-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1);background:var(--background);transition:all .2s ease;min-height:5rem}.dish-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:var(--primary);box-shadow:0 4px 12px var(--smoke-2)}.dish-name[_ngcontent-%COMP%]{font-weight:600;font-size:var(--fs-sm);line-height:1.3;color:var(--text-color);margin-bottom:4px}.dish-price[_ngcontent-%COMP%]{font-weight:700;font-size:var(--fs-sm);color:var(--primary)}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);overflow-x:auto;padding-bottom:var(--gap-sm);margin-bottom:var(--gap-md);-webkit-overflow-scrolling:touch;scrollbar-width:none}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.quick-action-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-sm);min-width:80px;border:1px solid var(--smoke-1);border-radius:12px;background:var(--background);transition:all .2s ease;cursor:pointer;flex-shrink:0}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button.active[_ngcontent-%COMP%]{background:var(--smoke-1);border-color:var(--primary)}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md);margin-bottom:4px}.grid-form[_ngcontent-%COMP%]{display:flex}@media (max-width: 768px){.grid-form.mobile-vertical[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gap-md)}}.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm);margin-bottom:var(--gap-md)}@media (max-width: 768px){.search-bar-mobile[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column}}.menu-selector[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;padding:var(--gap-md);margin-bottom:var(--gap-lg)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--gap-lg);color:var(--text-muted);text-align:center}.empty-state[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-lg);margin-bottom:var(--gap-sm);opacity:.5}.bill-preview[_ngcontent-%COMP%]{font-family:Courier New,monospace;background:#fff;color:#000;padding:var(--gap-lg);max-height:60vh;overflow-y:auto}@media print{.bill-preview[_ngcontent-%COMP%]{max-height:none;overflow:visible}}.icon-button[disabled][_ngcontent-%COMP%], .promethea-button[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;pointer-events:none}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-overlay[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.compact-header[_ngcontent-%COMP%]{padding:var(--gap-sm) var(--gap-md)}.compact-header[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:var(--fs-md)}"],changeDetection:0})};var ue=class s{supabase=b(ke).getSupabaseClient();authService=b(N);loadingService=b(W);occupyTable(t,e){return v(this,null,function*(){try{this.loadingService.start();let i=yield this.authService.getCurrentRestaurantId();if(!i)return null;let a=yield this.generateOrderNumber(i),{data:d,error:g}=yield this.supabase.from("order_headers").insert({restaurant_id:i,table_id:t,order_number:a,status:"active",customer_name:e||"Cliente",total_amount:0}).select().single();if(g)throw g;let x=yield this.createComanda(d.id);return yield this.loadTavolata(d.id)}catch(i){return console.error("\u274C Errore occupazione tavolo:",i),null}finally{this.loadingService.stop()}})}createComanda(t){return v(this,null,function*(){try{this.loadingService.start();let e=yield this.authService.getCurrentRestaurantId();if(!e)return null;let{data:i,error:a}=yield this.supabase.from("order_headers").select("table_id, order_number, customer_name, status").eq("id",t).single();if(a)throw a;let d=yield this.getNextComandaNumber(t),g=`${i.order_number}-${d}`,{data:x,error:T}=yield this.supabase.from("comande").insert({restaurant_id:e,order_header_id:t,comanda_number:d,order_number:g,status:"ordered",table_id:i.table_id,order_type:"dine_in",subtotal:0,tax_amount:0,discount_amount:0,total_amount:0,customer_name:i.customer_name||"Cliente"}).select().single();if(T)throw T;return x}catch(e){return console.error("\u274C Errore creazione comanda:",e),null}finally{this.loadingService.stop()}})}addItemToComanda(t,e,i=1,a=""){return v(this,null,function*(){try{this.loadingService.start();let d=yield this.authService.getCurrentRestaurantId();if(!d)return null;let{data:g,error:x}=yield this.supabase.from("dishes").select("base_price, name").eq("id",e).single();if(x)throw x;let T=g.base_price*i,{data:E,error:P}=yield this.supabase.from("order_items").insert({order_id:t,dish_id:e,quantity:i,unit_price:g.base_price,total_price:T,item_notes:a,status:"ordered",restaurant_id:d}).select().single();if(P)throw P;return yield this.updateComandaTotal(t),z(V({},E),{dish_name:g.name})}catch(d){return console.error("\u274C Errore aggiunta piatto:",d),null}finally{this.loadingService.stop()}})}loadTavolata(t){return v(this,null,function*(){try{this.loadingService.start();let{data:e,error:i}=yield this.supabase.from("order_headers").select(`
          *,
          comande (
            *,
            order_items (
              *,
              dish:dish_id (
                id,
                name,
                base_price,
                category_id
              )
            )
          )
        `).eq("id",t).single();if(i)throw i;return e}catch(e){return console.error("\u274C Errore caricamento tavolata:",e),null}finally{this.loadingService.stop()}})}getActiveTavolataByTable(t){return v(this,null,function*(){try{let e=yield this.authService.getCurrentRestaurantId();if(!e)return null;let{data:i,error:a}=yield this.supabase.from("order_headers").select(`
          *,
          comande (
            *,
            order_items (
              *,
              dish:dish_id (
                id,
                name,
                base_price
              )
            )
          )
        `).eq("restaurant_id",e).eq("table_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(1).single();if(a){if(a.code==="PGRST116")return null;throw a}return i}catch(e){return console.error("\u274C Errore caricamento tavolata attiva:",e),null}})}updateComandaStatus(t,e){return v(this,null,function*(){try{let{error:i}=yield this.supabase.from("comande").update({status:e,updated_at:new Date().toISOString()}).eq("id",t);return!i}catch(i){return console.error("\u274C Errore aggiornamento stato comanda:",i),!1}})}updateItemQuantity(t,e){return v(this,null,function*(){try{let{data:i,error:a}=yield this.supabase.from("order_items").select("unit_price, order_id").eq("id",t).single();if(a)throw a;let d=i.unit_price*e,{error:g}=yield this.supabase.from("order_items").update({quantity:e,total_price:d,updated_at:new Date().toISOString()}).eq("id",t);if(g)throw g;return i.order_id&&(yield this.updateComandaTotal(i.order_id)),!0}catch(i){return console.error("\u274C Errore aggiornamento quantit\xE0:",i),!1}})}removeItem(t){return v(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.from("order_items").select("order_id").eq("id",t).single();if(i)throw i;let{error:a}=yield this.supabase.from("order_items").delete().eq("id",t);if(a)throw a;return e.order_id&&(yield this.updateComandaTotal(e.order_id)),!0}catch(e){return console.error("\u274C Errore rimozione piatto:",e),!1}})}closeTavolata(t){return v(this,null,function*(){try{let{error:e}=yield this.supabase.from("order_headers").update({status:"completed",updated_at:new Date().toISOString()}).eq("id",t);return!e}catch(e){return console.error("\u274C Errore chiusura tavolata:",e),!1}})}generateOrderNumber(t){return v(this,null,function*(){let e=new Date,i=e.getFullYear().toString().slice(-2),a=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0"),{count:g}=yield this.supabase.from("order_headers").select("*",{count:"exact",head:!0}).eq("restaurant_id",t).gte("created_at",`${e.getFullYear()}-${a}-${d}T00:00:00`).lte("created_at",`${e.getFullYear()}-${a}-${d}T23:59:59`),x=(g||0)+1;return`TAV-${i}${a}${d}-${x.toString().padStart(3,"0")}`})}getNextComandaNumber(t){return v(this,null,function*(){let{data:e,error:i}=yield this.supabase.from("comande").select("comanda_number").eq("order_header_id",t).order("comanda_number",{ascending:!1}).limit(1);return i?(console.error("Errore calcolo prossima comanda:",i),1):e&&e.length>0?e[0].comanda_number+1:1})}updateComandaTotal(t){return v(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.from("order_items").select("total_price").eq("order_id",t);if(i)throw i;let a=(e||[]).reduce((d,g)=>d+(g.total_price||0),0);yield this.supabase.from("comande").update({total_amount:a,subtotal:a,updated_at:new Date().toISOString()}).eq("id",t)}catch(e){console.error("Errore aggiornamento totale comanda:",e)}})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=Q({token:s,factory:s.\u0275fac,providedIn:"root"})};var Gt=["mapCard"],Ut=["tableMapContainer"],Ye=()=>[1,2,3,4,5,6,7,8,9,10];function Zt(s,t){if(s&1&&(r(0,"option",59),o(1),n()),s&2){let e=t.$implicit;m("ngValue",e),l(),O(e.name)}}function Yt(s,t){if(s&1&&(r(0,"option",59),o(1),n()),s&2){let e=t.$implicit;m("ngValue",e),l(),h(" ",e.name," ")}}function Jt(s,t){if(s&1){let e=C();r(0,"div",60)(1,"h2",61),o(2),n(),r(3,"div",18)(4,"button",36),_("click",function(){u(e);let a=c();return p(a.zoomOut())}),r(5,"span",37),o(6,"zoom_out"),n()(),r(7,"div",62)(8,"span",39),o(9,"search"),n(),r(10,"span",40),o(11),n()(),r(12,"button",36),_("click",function(){u(e);let a=c();return p(a.zoomIn())}),r(13,"span",37),o(14,"zoom_in"),n()(),r(15,"button",41),_("click",function(){u(e);let a=c();return p(a.resetZoom())}),r(16,"span",37),o(17,"history"),n()(),r(18,"select",63),S("ngModelChange",function(a){u(e);let d=c();return y(d.currentFloorPlan,a)||(d.currentFloorPlan=a),p(a)}),_("ngModelChange",function(a){u(e);let d=c();return p(d.onFloorPlanSelect(a))}),f(19,Yt,2,2,"option",27),n(),r(20,"button",41),_("click",function(){u(e);let a=c();return p(a.safeToggleFullscreen())}),r(21,"span",37),o(22,"fullscreen_exit"),n()()()()}if(s&2){let e=c();l(2),O((e.currentFloorPlan==null?null:e.currentFloorPlan.name)||"Mappa"),l(2),m("disabled",e.zoomLevel<=e.minZoom),l(7),h("",(e.zoomLevel*100).toFixed(0),"%"),l(),m("disabled",e.zoomLevel>=e.maxZoom),l(6),w("ngModel",e.currentFloorPlan),l(),m("ngForOf",e.floorPlans)}}function Kt(s,t){if(s&1&&(r(0,"div",70)(1,"small"),o(2),n()()),s&2){let e=c().$implicit;l(2),h("Pren: ",e.currentReservation.customer_name)}}function Xt(s,t){if(s&1&&(r(0,"div",70)(1,"small"),o(2),n()()),s&2){let e=c().$implicit,i=c();l(2),h("Ord: ",i.getTableOrderCount(e.table.id)," piatti")}}function ei(s,t){if(s&1){let e=C();r(0,"div",64),_("click",function(){let a=u(e).$implicit,d=c();return p(d.onTableClick(a))}),r(1,"div",65)(2,"div",66),o(3),n(),r(4,"div",67)(5,"div",68),o(6),r(7,"span",37),o(8,"person"),n()()(),f(9,Kt,3,1,"div",69)(10,Xt,3,1,"div",69),n()()}if(s&2){let e=t.$implicit,i=c();U(i.getTableClass(e)),m("ngStyle",i.getTableStyle(e.table)),l(),R("text-large",i.isLargeText),l(2),O(e.table.table_number),l(3),O(e.table.capacity),l(3),m("ngIf",e.currentReservation),l(),m("ngIf",e.currentOrders)}}function ti(s,t){s&1&&(r(0,"div",71)(1,"span",37),o(2,"search_off"),n(),r(3,"h3"),o(4,"Nessun tavolo trovato"),n(),r(5,"p",8),o(6,"Modifica i filtri di ricerca"),n()())}function ii(s,t){if(s&1){let e=C();r(0,"div",81)(1,"button",82),_("click",function(){u(e);let a=c(2);return a.openManualReservationModal(),p(a.showQuickActionsModal=!1)}),r(2,"span",37),o(3,"event"),n(),o(4," Crea Prenotazione "),n(),r(5,"button",83),_("click",function(){u(e);let a=c(2);return p(a.openOrderEditor())}),r(6,"span",37),o(7),n(),o(8),n()()}if(s&2){let e=c(2);l(5),m("disabled",!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?"Crea nuovo ordine":"Disabilitato: fuori orario dei turni"),l(2),O(e.orderingStatus.allowed?"restaurant":"schedule"),l(),h(" ",e.orderingStatus.allowed?"Crea Ordine":"Fuori Turno"," ")}}function ri(s,t){if(s&1){let e=C();r(0,"div",81)(1,"button",42),_("click",function(){u(e);let a=c(2);return a.openEditReservationModal(),p(a.showQuickActionsModal=!1)}),r(2,"span",37),o(3,"edit"),n(),o(4," Modifica Prenotazione "),n(),r(5,"button",84),_("click",function(){u(e);let a=c(2);return p(a.openOrderEditor())}),r(6,"span",37),o(7,"check"),n(),o(8," Conferma Arrivo (Crea Ordine) "),n()()}if(s&2){let e=c(2);l(5),m("disabled",!e.orderingStatus.allowed)}}function ai(s,t){if(s&1){let e=C();r(0,"div",81)(1,"button",82),_("click",function(){u(e);let a=c(2);return p(a.openOrderEditor())}),r(2,"span",37),o(3,"receipt"),n(),o(4," Visualizza Ordini "),n(),r(5,"button",83),_("click",function(){u(e);let a=c(2);return p(a.addNewComandaToTable())}),r(6,"span",37),o(7,"add"),n(),o(8," Nuova Comanda "),n(),r(9,"button",85),_("click",function(){u(e);let a=c(2);return p(a.freeTable())}),r(10,"span",37),o(11,"check_circle"),n(),o(12," Libera Tavolo "),n()()}if(s&2){let e=c(2);l(5),m("disabled",!e.orderingStatus.allowed)("title",e.orderingStatus.allowed?"Aggiungi una nuova comanda alla tavolata corrente":e.orderingStatus.reason)}}function ni(s,t){if(s&1){let e=C();r(0,"div",72)(1,"div",73)(2,"div",74)(3,"div",46)(4,"div",75)(5,"span",37),o(6,"table_restaurant"),n()(),r(7,"div")(8,"h1",7),o(9),n()()(),r(10,"button",41),_("click",function(){u(e);let a=c();return p(a.deselectTable())}),r(11,"span",37),o(12,"close"),n()()(),r(13,"div",76)(14,"div",77)(15,"div",78)(16,"span",79),o(17),n()(),f(18,ii,9,4,"div",80)(19,ri,9,1,"div",80)(20,ai,13,2,"div",80),n()()()()}if(s&2){let e=c();l(9),h("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number),l(7),U(e.getStatusColorClass((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")),l(),h(" ",e.getStatusText((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")," "),l(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="free"),l(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="reserved"),l(),m("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="occupied")}}function oi(s,t){if(s&1&&(r(0,"option",99),o(1),n()),s&2){let e=t.$implicit,i=c(2);m("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),l(),j(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function li(s,t){if(s&1){let e=C();r(0,"div",72)(1,"div",86)(2,"div",74)(3,"div",46)(4,"div",75)(5,"span",37),o(6,"event"),n()(),r(7,"div")(8,"h2",40),o(9),n()()(),r(10,"button",41),_("click",function(){u(e);let a=c();return p(a.closeManualReservationModal())}),r(11,"span",37),o(12,"close"),n()()(),r(13,"div",76)(14,"form",87,2),_("ngSubmit",function(a){return u(e),c().createManualReservation(),p(a.preventDefault())}),r(16,"div",23)(17,"div",24)(18,"label",25),o(19,"Nome Cliente *"),n(),r(20,"input",88),S("ngModelChange",function(a){u(e);let d=c();return y(d.manualReservationData.customer_name,a)||(d.manualReservationData.customer_name=a),p(a)}),n()(),r(21,"div",24)(22,"label",25),o(23,"Telefono *"),n(),r(24,"input",89),S("ngModelChange",function(a){u(e);let d=c();return y(d.manualReservationData.customer_phone,a)||(d.manualReservationData.customer_phone=a),p(a)}),n()()(),r(25,"div",23)(26,"div",24)(27,"label",25),o(28,"Data *"),n(),r(29,"input",90),S("ngModelChange",function(a){u(e);let d=c();return y(d.manualReservationData.reservation_date,a)||(d.manualReservationData.reservation_date=a),p(a)}),n()(),r(30,"div",24)(31,"label",25),o(32,"Orario *"),n(),r(33,"input",91),S("ngModelChange",function(a){u(e);let d=c();return y(d.manualReservationData.reservation_time,a)||(d.manualReservationData.reservation_time=a),p(a)}),n()()(),r(34,"div",24)(35,"label",25),o(36,"Numero Persone *"),n(),r(37,"select",92),S("ngModelChange",function(a){u(e);let d=c();return y(d.manualReservationData.party_size,a)||(d.manualReservationData.party_size=a),p(a)}),f(38,oi,2,5,"option",93),n(),r(39,"div",94),o(40),n()(),r(41,"div",24)(42,"label",25),o(43,"Note Speciali"),n(),r(44,"textarea",95),S("ngModelChange",function(a){u(e);let d=c();return y(d.manualReservationData.special_requests,a)||(d.manualReservationData.special_requests=a),p(a)}),n()(),r(45,"div",96)(46,"button",97),_("click",function(){u(e);let a=c();return p(a.closeManualReservationModal())}),o(47," Annulla "),n(),r(48,"button",98)(49,"span",37),o(50,"add"),n(),o(51," Crea Prenotazione "),n()()()()()()}if(s&2){let e=L(15),i=c();l(9),h("Nuova Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number),l(11),w("ngModel",i.manualReservationData.customer_name),l(4),w("ngModel",i.manualReservationData.customer_phone),l(5),w("ngModel",i.manualReservationData.reservation_date),l(4),w("ngModel",i.manualReservationData.reservation_time),l(4),w("ngModel",i.manualReservationData.party_size),l(),m("ngForOf",q(10,Ye)),l(2),h(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),l(4),w("ngModel",i.manualReservationData.special_requests),l(4),m("disabled",!e.valid)}}function si(s,t){if(s&1&&(r(0,"option",99),o(1),n()),s&2){let e=t.$implicit,i=c(2);m("value",e)("disabled",i.selectedTable&&e>i.selectedTable.capacity),l(),j(" ",e," ",e===1?"persona":"persone"," ",i.selectedTable&&e>i.selectedTable.capacity?" (Troppe persone)":""," ")}}function di(s,t){if(s&1){let e=C();r(0,"button",102),_("click",function(){u(e);let a=c(2);return p(a.deleteReservation())}),r(1,"span",37),o(2,"delete"),n(),o(3," Elimina "),n()}}function ci(s,t){if(s&1){let e=C();r(0,"div",72)(1,"div",86)(2,"div",74)(3,"div",46)(4,"div",75)(5,"span",37),o(6,"edit"),n()(),r(7,"div")(8,"h1",7),o(9),n()()(),r(10,"button",41),_("click",function(){u(e);let a=c();return p(a.closeEditReservationModal())}),r(11,"span",37),o(12,"close"),n()()(),r(13,"div",76)(14,"form",87,2),_("ngSubmit",function(a){return u(e),c().updateReservation(),p(a.preventDefault())}),r(16,"div",23)(17,"div",24)(18,"label",25),o(19,"Nome Cliente *"),n(),r(20,"input",88),S("ngModelChange",function(a){u(e);let d=c();return y(d.editingReservation.customer_name,a)||(d.editingReservation.customer_name=a),p(a)}),n()(),r(21,"div",24)(22,"label",25),o(23,"Telefono *"),n(),r(24,"input",89),S("ngModelChange",function(a){u(e);let d=c();return y(d.editingReservation.customer_phone,a)||(d.editingReservation.customer_phone=a),p(a)}),n()()(),r(25,"div",23)(26,"div",24)(27,"label",25),o(28,"Data *"),n(),r(29,"input",90),S("ngModelChange",function(a){u(e);let d=c();return y(d.editingReservation.reservation_date,a)||(d.editingReservation.reservation_date=a),p(a)}),n()(),r(30,"div",24)(31,"label",25),o(32,"Orario *"),n(),r(33,"input",91),S("ngModelChange",function(a){u(e);let d=c();return y(d.editingReservation.reservation_time,a)||(d.editingReservation.reservation_time=a),p(a)}),n()()(),r(34,"div",24)(35,"label",25),o(36,"Numero Persone *"),n(),r(37,"select",92),S("ngModelChange",function(a){u(e);let d=c();return y(d.editingReservation.party_size,a)||(d.editingReservation.party_size=a),p(a)}),f(38,si,2,5,"option",93),n(),r(39,"div",94),o(40),n()(),r(41,"div",24)(42,"label",25),o(43,"Note Speciali"),n(),r(44,"textarea",95),S("ngModelChange",function(a){u(e);let d=c();return y(d.editingReservation.special_requests,a)||(d.editingReservation.special_requests=a),p(a)}),n()(),r(45,"div",96)(46,"div",100),f(47,di,4,0,"button",101),r(48,"div",5)(49,"button",97),_("click",function(){u(e);let a=c();return p(a.closeEditReservationModal())}),o(50," Annulla "),n(),r(51,"button",98)(52,"span",37),o(53,"save"),n(),o(54," Salva "),n()()()()()()()()}if(s&2){let e=L(15),i=c();l(9),h("Modifica Prenotazione - Tavolo ",i.selectedTable==null?null:i.selectedTable.table_number),l(11),w("ngModel",i.editingReservation.customer_name),l(4),w("ngModel",i.editingReservation.customer_phone),l(5),w("ngModel",i.editingReservation.reservation_date),l(4),w("ngModel",i.editingReservation.reservation_time),l(4),w("ngModel",i.editingReservation.party_size),l(),m("ngForOf",q(11,Ye)),l(2),h(" Capacit\xE0 massima tavolo: ",(i.selectedTable==null?null:i.selectedTable.capacity)||0," persone "),l(4),w("ngModel",i.editingReservation.special_requests),l(3),m("ngIf",i.isReservationDeletable(i.editingReservation)),l(4),m("disabled",!e.valid)}}function mi(s,t){if(s&1){let e=C();r(0,"div",72)(1,"app-order-editor",103),_("saved",function(a){u(e);let d=c();return p(d.onOrderSaved(a))})("closeRequested",function(){u(e);let a=c();return p(a.closeOrderEditorModal())}),n()()}if(s&2){let e=c();l(),m("table",e.orderEditorData.table)("mode",e.orderEditorData.mode)("existingOrderHeader",e.orderEditorData.existingOrderHeader)("selectedComandaId",e.orderEditorData.selectedComandaId)("orderingStatus",e.orderingStatus)}}function ui(s,t){if(s&1){let e=C();r(0,"div",72)(1,"app-order-editor",103),_("saved",function(a){u(e);let d=c();return p(d.onOrderSaved(a))})("closeRequested",function(){u(e);let a=c();return p(a.closeOrderEditorViewModal())}),n()()}if(s&2){let e=c();l(),m("table",e.orderEditorData.table)("mode",e.orderEditorData.mode)("existingOrderHeader",e.orderEditorData.existingOrderHeader)("selectedComandaId",e.orderEditorData.selectedComandaId)("orderingStatus",e.orderingStatus)}}var Ze=class s{tableStatusService=b(ce);floorManagementService=b(Qe);loadingService=b(W);tableService=b(Ne);floorPlanService=b(qe);reservationService=b(We);authService=b(N);orderHeaderService=b(de);shiftService=b(Ge);comandaService=b(le);orderItemService=b(se);orderManagerService=b(ue);cdr=b(Y);mapCardElement;tableMapContainer;zoomLevel=1;minZoom=.5;maxZoom=3;mobileView=!1;isFullscreen=!1;isLargeText=!1;searchTerm="";statusFilter="all";showQuickActionsModal=!1;showManualReservationModal=!1;showEditReservationModal=!1;showAssignReservationModal=!1;showTableReservationsModal=!1;showTableAssignmentModal=!1;showOrderEditorModal=!1;showOrderEditorViewModal=!1;orderEditorData={table:null,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null,selectedComandaId:void 0};currentFloorPlan=null;tableStatuses=[];selectedTable=null;selectedTableStatus=null;currentRestaurant=null;tableOrderCounts=new Map;manualReservationData={customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};editingReservation=null;orderingStatus={allowed:!1,reason:"Caricamento...",currentShift:null};availableReservationsWithoutTable=[];selectedReservationForAssignment=null;assignmentReservation=null;suggestedTablesByFloorPlan={};selectedFloorPlanForAssignment=null;selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}};subscriptions=new Se;get floorPlans(){return this.floorPlanService.data}get dishes(){return[]}ngOnInit(){return v(this,null,function*(){yield this.loadInitialData(),this.checkMobileView(),window.addEventListener("resize",()=>this.checkMobileView()),this.startShiftChecking(),this.setupFullscreenListeners()})}ngOnDestroy(){this.subscriptions.unsubscribe(),window.removeEventListener("resize",()=>this.checkMobileView()),document.removeEventListener("fullscreenchange",this.handleFullscreenChange.bind(this)),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange.bind(this)),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange.bind(this))}loadInitialData(){return v(this,null,function*(){this.loadingService.start();try{yield Promise.all([this.floorPlanService.loadFloorPlans(),this.tableService.loadData(),this.floorManagementService.loadTodaysReservations()]);let t=this.tableService.data.filter(e=>!e.is_merged||e.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(t),this.floorPlans.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=this.floorPlans[0],yield this.loadTablesForFloorPlan())}finally{this.loadingService.stop()}})}onTableClick(t){return v(this,null,function*(){this.selectedTable=t.table,this.selectedTableStatus=t,yield this.loadTableReservations(t.table.id),this.showQuickActionsModal=!0})}deselectTable(){this.selectedTable=null,this.selectedTableStatus=null,this.showQuickActionsModal=!1,this.showManualReservationModal=!1,this.showEditReservationModal=!1}openManualReservationModal(){return v(this,null,function*(){if(!this.selectedTable)return;let t=new Date;this.manualReservationData={customer_name:"",customer_phone:"",reservation_date:t.toISOString().split("T")[0],reservation_time:t.toTimeString().split(" ")[0].substring(0,5),party_size:this.selectedTable.capacity||2,special_requests:""},this.showQuickActionsModal=!1,this.showManualReservationModal=!0})}closeManualReservationModal(){this.showManualReservationModal=!1}createManualReservation(){return v(this,null,function*(){if(this.selectedTable)try{let t=yield this.getCurrentRestaurantId();if(!t)return;let e={restaurant_id:t,table_id:this.selectedTable.id,reservation_date:this.manualReservationData.reservation_date,reservation_time:this.manualReservationData.reservation_time,party_size:this.manualReservationData.party_size,special_requests:this.manualReservationData.special_requests,status:"confirmed",customer_name:this.manualReservationData.customer_name,customer_phone:this.manualReservationData.customer_phone};(yield this.reservationService.createRestaurantReservation(e))?(this.closeManualReservationModal(),yield this.loadInitialData(),alert("Prenotazione creata con successo!")):alert("Errore nella creazione della prenotazione")}catch(t){console.error("Error creating manual reservation:",t),alert("Errore durante la creazione della prenotazione: "+t.message)}})}openOrderEditor(){return v(this,null,function*(){if(this.selectedTable)try{this.loadingService.start();let t=yield this.orderHeaderService.getActiveByTable(this.selectedTable.id);t?(this.orderEditorData={table:this.selectedTable,mode:"view",existingOrderHeader:t,orderHeaders:[t],currentTavolataId:t.id,selectedComandaId:void 0},this.showOrderEditorViewModal=!0,console.log("\u{1F441}\uFE0F Apro order editor in modalit\xE0 VIEW")):(this.orderEditorData={table:this.selectedTable,mode:"edit",existingOrderHeader:null,orderHeaders:[],currentTavolataId:null,selectedComandaId:void 0},this.showOrderEditorModal=!0,console.log("\u270F\uFE0F Apro order editor in modalit\xE0 EDIT (nuovo)")),this.showQuickActionsModal=!1}catch(t){console.error("\u274C Errore apertura order editor:",t)}finally{this.loadingService.stop()}})}closeOrderEditorModal(){this.showOrderEditorModal=!1,this.loadTablesForFloorPlan()}closeOrderEditorViewModal(){this.showOrderEditorViewModal=!1}loadTableReservations(t){return v(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let i=new Date().toISOString().split("T")[0],a=this.reservationService.data.filter(x=>x.restaurant_id===e&&x.table_id===t&&x.reservation_date===i&&["confirmed","pending"].includes(x.status)).sort((x,T)=>x.reservation_time.localeCompare(T.reservation_time)),d=null,g=[];for(let x of a){let T=new Date(`${x.reservation_date}T${x.reservation_time}`),E=new Date,P=(T.getTime()-E.getTime())/(1e3*60*60);P>=0&&P<=1.5?d=x:P>1.5&&g.push(x)}this.selectedTableReservations={active:d,futureReservations:g,shiftInfo:{current:null,next:null}}}catch(e){console.error("Errore caricamento prenotazioni tavolo:",e),this.selectedTableReservations={active:null,futureReservations:[],shiftInfo:{current:null,next:null}}}})}checkMobileView(){this.mobileView=window.innerWidth<=768}getFilteredTables(){let t=this.tableStatuses;if(this.statusFilter!=="all"&&(t=t.filter(e=>e.status===this.statusFilter)),this.searchTerm){let e=this.searchTerm.toLowerCase();t=t.filter(i=>i.table.table_number.toLowerCase().includes(e)||i.table.table_name.toLowerCase().includes(e))}return t}getTableClass(t){let e=this.selectedTable?.id===t.table.id;return`table-element shape-${t.table.shape} ${t.status} ${e?"selected":""}`}getTableStyle(t){return{left:t.position_x+"px",top:t.position_y+"px",width:t.width+"px",height:t.height+"px","border-radius":t.shape==="circle"?"50%":"0px",transform:`rotate(${t.rotation}deg)`}}startShiftChecking(){this.checkCurrentShift(),this.subscriptions.add(Te(6e4).subscribe(()=>this.checkCurrentShift()))}checkCurrentShift(){return v(this,null,function*(){let t=yield this.shiftService.getOrderingStatus();this.orderingStatus=t})}getShiftStatusClass(){return this.orderingStatus.allowed?"shift-active":"shift-inactive"}getShiftStatusText(){return this.orderingStatus.allowed?"\u{1F4CB} Orario di turno":"\u23F0 "+this.orderingStatus.reason}getCurrentRestaurantId(){return v(this,null,function*(){try{let t=this.authService.getCurrentStaffRestaurantId();return t||(this.authService.currentUserValue?(yield this.reservationService.loadData(),this.reservationService.data.length>0&&this.reservationService.data[0]?.restaurant_id||null):null)}catch(t){return console.error("Errore in getCurrentRestaurantId:",t),null}})}getStatusColorClass(t=""){return`status-${t}`}getStatusText(t=""){return{free:"Libero",reserved:"Prenotato",occupied:"Occupato"}[t]||t}getTableOrderItemsCount(t){return v(this,null,function*(){try{let e=yield this.orderHeaderService.getActiveByTable(t);if(!e)return 0;let i=yield this.comandaService.loadByOrderHeaderId(e.id),a=0;for(let d of i){let g=yield this.orderItemService.loadByComandaId(d.id);a+=g.length}return a}catch(e){return console.error("Errore conteggio piatti:",e),0}})}onFloorPlanSelect(t){this.currentFloorPlan=t,this.loadTablesForFloorPlan(),this.deselectTable()}safeToggleFullscreen(){return v(this,null,function*(){try{if(document.fullscreenElement)document.exitFullscreen?yield document.exitFullscreen():document.webkitExitFullscreen?yield document.webkitExitFullscreen():document.msExitFullscreen&&(yield document.msExitFullscreen()),this.isFullscreen=!1;else{let t=this.tableMapContainer?.nativeElement||document.documentElement;this.cdr.detectChanges(),t.requestFullscreen?yield t.requestFullscreen():t.webkitRequestFullscreen?yield t.webkitRequestFullscreen():t.msRequestFullscreen&&(yield t.msRequestFullscreen()),this.isFullscreen=!0}this.cdr.detectChanges()}catch(t){console.error("Errore fullscreen:",t),this.isFullscreen=!this.isFullscreen,this.cdr.detectChanges()}})}setupFullscreenListeners(){document.addEventListener("fullscreenchange",this.handleFullscreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.handleFullscreenChange.bind(this))}handleFullscreenChange(){let t=this.isFullscreen;this.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement),setTimeout(()=>{this.cdr.detectChanges()},0)}zoomIn(){this.zoomLevel=Math.min(this.zoomLevel*1.25,this.maxZoom)}zoomOut(){this.zoomLevel=Math.max(this.zoomLevel/1.25,this.minZoom)}resetZoom(){this.zoomLevel=1}getScaledWidth(){return(this.currentFloorPlan?.width||1e3)*this.zoomLevel}getScaledHeight(){return(this.currentFloorPlan?.height||800)*this.zoomLevel}updateReservation(){return v(this,null,function*(){if(this.editingReservation)try{(yield this.reservationService.updateReservation(this.editingReservation.id,this.editingReservation))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'aggiornamento della prenotazione")}catch(t){console.error("Errore nell'aggiornamento della prenotazione:",t),alert("Errore durante l'aggiornamento della prenotazione")}})}deleteReservation(){return v(this,null,function*(){if(this.editingReservation&&this.isReservationDeletable(this.editingReservation))try{(yield this.reservationService.deleteReservation(this.editingReservation.id))?(yield this.loadInitialData(),this.closeEditReservationModal(),this.deselectTable()):alert("Errore durante l'eliminazione della prenotazione")}catch(t){console.error("Errore nell'eliminazione della prenotazione:",t),alert("Errore durante l'eliminazione della prenotazione")}else alert("Impossibile eliminare questa prenotazione")})}isReservationDeletable(t){return!t?.reservation_date||!t?.reservation_time?!1:new Date(`${t.reservation_date}T${t.reservation_time}`)>new Date}openEditReservationModal(){this.selectedTableStatus?.currentReservation&&(this.editingReservation=V({},this.selectedTableStatus.currentReservation),this.showEditReservationModal=!0,this.showQuickActionsModal=!1)}closeEditReservationModal(){this.showEditReservationModal=!1,this.editingReservation=null}getFreeTablesCount(){return this.tableStatuses.filter(t=>t.status==="free").length}getReservedTablesCount(){return this.tableStatuses.filter(t=>t.status==="reserved").length}getOccupiedTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied").length}getTotalTablesCount(){return this.tableStatuses.length}toggleSize(){this.isLargeText=!this.isLargeText}getTableOrderItemsCountSync(t){return 0}loadAllTableOrderCounts(){return v(this,null,function*(){this.tableOrderCounts.clear();let t=this.tableStatuses.map(e=>v(this,null,function*(){try{let i=yield this.getTableOrderItemsCount(e.table.id);this.tableOrderCounts.set(e.table.id,i)}catch(i){console.error(`Errore caricamento ordini per tavolo ${e.table.id}:`,i),this.tableOrderCounts.set(e.table.id,0)}}));yield Promise.all(t)})}getTableOrderCount(t){return this.tableOrderCounts.get(t)||0}loadTablesForFloorPlan(){return v(this,null,function*(){if(!this.currentFloorPlan)return;let e=this.tableService.getTablesByFloorPlan(this.currentFloorPlan.id).filter(i=>!i.is_merged||i.parent_table_id===null);this.tableStatuses=yield this.tableStatusService.calculateTableStatus(e),yield this.loadAllTableOrderCounts()})}getTablesWithOrdersCount(){return Array.from(this.tableOrderCounts.values()).filter(t=>t>0).length}freeTable(){return v(this,null,function*(){if(!this.selectedTable)return;let t=this.selectedTable,e=t.table_number;try{let i=yield this.getTableOrderItemsCount(t.id);if(i>0){if(!confirm(`\u26A0\uFE0F ATTENZIONE!

Il tavolo ${e} ha ${i} piatti ordinati.

Sei sicuro di voler liberare il tavolo?
Questa azione chiuder\xE0 tutti gli ordini attivi.`))return}else if(!confirm(`Vuoi liberare il tavolo ${e}?`))return;this.loadingService.start(),(yield this.orderHeaderService.closeAllActiveHeadersForTable(t.id))?(console.log(`\u2705 Tavolo ${e} liberato`),yield this.loadTablesForFloorPlan(),this.deselectTable(),alert(`\u2705 Tavolo ${e} liberato con successo!`)):alert("\u274C Errore durante la liberazione del tavolo. Riprova.")}catch(i){console.error("\u274C Errore liberazione tavolo:",i),alert("\u274C Errore durante la liberazione del tavolo.")}finally{this.loadingService.stop()}})}addNewComandaToTable(){return v(this,null,function*(){if(this.selectedTable)try{this.loadingService.start(),console.log("\u{1F195} Aggiunta nuova comanda al tavolo:",this.selectedTable.table_number);let t=yield this.orderHeaderService.getActiveByTable(this.selectedTable.id);if(!t){console.error("\u274C Nessuna tavolata attiva trovata per questo tavolo"),alert("Prima crea una tavolata per questo tavolo");return}console.log("\u2705 Tavolata trovata:",t.order_number);let e=yield this.orderManagerService.createComanda(t.id);if(!e){console.error("\u274C Errore nella creazione della nuova comanda"),alert("Errore nella creazione della nuova comanda");return}console.log("\u2705 Nuova comanda creata:",e.comanda_number);let i=yield this.orderManagerService.loadTavolata(t.id);if(!i){console.error("\u274C Impossibile caricare l'ordine completo"),alert("Errore nel caricamento dell'ordine");return}this.orderEditorData={table:this.selectedTable,mode:"edit",existingOrderHeader:i,orderHeaders:[i],currentTavolataId:i.id,selectedComandaId:e.id},this.showOrderEditorModal=!0,this.showQuickActionsModal=!1,console.log("\u{1F4CB} Aperto order editor con nuova comanda:",e.comanda_number)}catch(t){console.error("\u{1F4A5} Errore in addNewComandaToTable:",t),alert("Errore: "+t.message)}finally{this.loadingService.stop()}})}onOrderSaved(t){console.log("\u2705 Ordine salvato, aggiorno la mappa"),this.loadTablesForFloorPlan(),this.closeOrderEditorModal(),this.closeOrderEditorViewModal()}get isLoading(){return this.loadingService.isLoadingSync()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=G({type:s,selectors:[["app-table-map"]],viewQuery:function(e,i){if(e&1&&(ve(Gt,5),ve(Ut,5)),e&2){let a;he(a=fe())&&(i.mapCardElement=a.first),he(a=fe())&&(i.tableMapContainer=a.first)}},decls:140,vars:40,consts:[["tableMapContainer",""],["floorPlanCanvas",""],["reservationForm","ngForm"],[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"flex","flex-col","gap-md"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"form-card","flex-col","flex","gap-md"],[1,"flex","justify-between","items-center","m-sm02"],[1,"flex","items-center","gap-md"],[1,"flex"],[1,"text-muted","text-sm"],[1,"text-sm","text-muted"],[1,"form-card"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"form-input",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],["value","free"],["value","reserved"],["value","occupied"],["type","text","placeholder","Numero o nome tavolo...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer",2,"margin","0","justify-content","space-between"],[1,"flex","gap-md"],[1,"icon-button",3,"click","disabled"],[1,"material-icons"],[1,"flex","items-center","gap-sm","px-md","py-sm","justify-center"],[1,"material-icons","text-sm"],[1,"font-semibold"],[1,"icon-button",3,"click"],[1,"promethea-button","primary",3,"click"],[1,"form-card","mt-lg",2,"overflow","auto","position","relative"],["class","fullscreen-header",4,"ngIf"],[1,"flex","justify-between","items-center","mb-md","flex-wrap"],[1,"flex","items-center","gap-sm"],[1,"flex","gap-sm","mr-md"],[1,"legend-color","free"],[1,"text-sm"],[1,"legend-color","reserved"],[1,"legend-color","occupied"],[1,"canvas-container"],[1,"canvas-wrapper"],[1,"floor-plan-canvas"],[1,"grid-overlay"],["class","table-element",3,"class","ngStyle","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"ngValue"],[1,"fullscreen-header"],[1,"font-bold","text-lg"],[1,"flex","items-center","gap-sm","bg-smoke","px-md","py-sm","rounded-full","min-w-32","justify-center"],[1,"form-input","text-sm",3,"ngModelChange","ngModel"],[1,"table-element",3,"click","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-details"],[1,"table-capacity"],["class","table-info",4,"ngIf"],[1,"table-info"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"header-icon"],[1,"p-lg"],[1,"flex","flex-col","gap-lg"],[1,"flex","justify-center"],[1,"chip"],["class","flex flex-col gap-sm",4,"ngIf"],[1,"flex","flex-col","gap-sm"],[1,"promethea-button",3,"click"],[1,"promethea-button","primary",3,"click","disabled","title"],[1,"promethea-button","success",3,"click","disabled"],[1,"promethea-button","ghost",3,"click"],[1,"modal-container","modal-md"],[1,"generic-form",3,"ngSubmit"],["type","text","name","customer_name","required","","placeholder","Inserisci il nome del cliente",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone","required","","placeholder","Inserisci il telefono",1,"form-input",3,"ngModelChange","ngModel"],["type","date","name","reservation_date","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","time","name","reservation_time","required","",1,"form-input",3,"ngModelChange","ngModel"],["name","party_size","required","",1,"form-input",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"text-muted","mt-sm"],["name","special_requests","rows","3","placeholder","Note o richieste speciali...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click"],["type","submit",1,"promethea-button",3,"disabled"],[3,"value","disabled"],[1,"flex","justify-between","items-center","w-full"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],["type","button",1,"promethea-button","danger",3,"click"],[3,"saved","closeRequested","table","mode","existingOrderHeader","selectedComandaId","orderingStatus"]],template:function(e,i){if(e&1){let a=C();r(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),o(4,"brunch_dining"),n(),r(5,"h1",7),o(6,"Prenotazioni Tavoli"),n()(),r(7,"p",8),o(8,"Gestisci prenotazioni e ordini in tempo reale"),n()(),r(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"span",13),o(14,"event_available"),n(),r(15,"div",14),o(16,"Tavoli Liberi"),n()(),r(17,"div",15),o(18),n()()(),r(19,"div",10)(20,"div",11)(21,"div",12)(22,"span",13),o(23,"event"),n(),r(24,"div",14),o(25,"Prenotati"),n()(),r(26,"div",15),o(27),n()()(),r(28,"div",10)(29,"div",11)(30,"div",12)(31,"span",13),o(32,"restaurant"),n(),r(33,"div",14),o(34,"Occupati"),n()(),r(35,"div",15),o(36),n()()(),r(37,"div",10)(38,"div",11)(39,"div",12)(40,"span",13),o(41,"table_restaurant"),n(),r(42,"div",14),o(43,"Tavoli Totali"),n()(),r(44,"div",15),o(45),n()()()(),r(46,"div",16)(47,"div",17)(48,"div",18)(49,"div",19),o(50),n(),r(51,"div",20),o(52),n()(),r(53,"div",21),o(54," \u23F0 Si pu\xF2 ordinare 1h prima/dopo il turno "),n()()(),r(55,"div",22)(56,"div",23)(57,"div",24)(58,"label",25),o(59,"Mappa"),n(),r(60,"select",26),S("ngModelChange",function(g){return u(a),y(i.currentFloorPlan,g)||(i.currentFloorPlan=g),p(g)}),_("change",function(){return u(a),p(i.onFloorPlanSelect(i.currentFloorPlan))}),f(61,Zt,2,2,"option",27),n()(),r(62,"div",24)(63,"label",25),o(64,"Stato"),n(),r(65,"select",28),S("ngModelChange",function(g){return u(a),y(i.statusFilter,g)||(i.statusFilter=g),p(g)}),r(66,"option",29),o(67,"Tutti gli stati"),n(),r(68,"option",30),o(69,"Libero"),n(),r(70,"option",31),o(71,"Prenotato"),n(),r(72,"option",32),o(73,"Occupato"),n()()()(),r(74,"div",23)(75,"div",24)(76,"label",25),o(77,"Cerca"),n(),r(78,"input",33),S("ngModelChange",function(g){return u(a),y(i.searchTerm,g)||(i.searchTerm=g),p(g)}),n()(),r(79,"div",24)(80,"label",25),o(81,"Azioni"),n(),r(82,"div",34)(83,"div",35)(84,"button",36),_("click",function(){return u(a),p(i.zoomOut())}),r(85,"span",37),o(86,"zoom_out"),n()(),r(87,"div",38)(88,"span",39),o(89,"search"),n(),r(90,"span",40),o(91),n()(),r(92,"button",36),_("click",function(){return u(a),p(i.zoomIn())}),r(93,"span",37),o(94,"zoom_in"),n()(),r(95,"button",41),_("click",function(){return u(a),p(i.resetZoom())}),r(96,"span",37),o(97,"history"),n()()(),r(98,"button",42),_("click",function(){return u(a),p(i.loadInitialData())}),r(99,"span",37),o(100,"refresh"),n(),o(101," Aggiorna "),n()()()()(),r(102,"div",43,0),f(104,Jt,23,6,"div",44),r(105,"div",45)(106,"h2",40),o(107),n(),r(108,"div",46)(109,"div",47)(110,"div",46),H(111,"div",48),r(112,"span",49),o(113,"Libero"),n()(),r(114,"div",46),H(115,"div",50),r(116,"span",49),o(117,"Prenotato"),n()(),r(118,"div",46),H(119,"div",51),r(120,"span",49),o(121,"Occupato"),n()()(),r(122,"button",41),_("click",function(){return u(a),p(i.safeToggleFullscreen())}),r(123,"span",37),o(124),n()(),r(125,"button",41),_("click",function(){return u(a),p(i.toggleSize())}),r(126,"span",37),o(127),n()()()(),r(128,"div",52)(129,"div",53)(130,"div",54,1),H(132,"div",55),f(133,ei,11,9,"div",56)(134,ti,7,0,"div",57),n()()(),f(135,ni,21,7,"div",58)(136,li,52,11,"div",58)(137,ci,55,12,"div",58)(138,mi,2,5,"div",58)(139,ui,2,5,"div",58),n()()}e&2&&(l(18),h(" ",i.getFreeTablesCount()," "),l(9),h(" ",i.getReservedTablesCount()," "),l(9),h(" ",i.getOccupiedTablesCount()," "),l(9),h(" ",i.getTotalTablesCount()," "),l(4),U(i.getShiftStatusClass()),l(),h(" ",i.getShiftStatusText()," "),l(2),h(" ",i.orderingStatus.reason," "),l(8),w("ngModel",i.currentFloorPlan),l(),m("ngForOf",i.floorPlans),l(4),w("ngModel",i.statusFilter),l(13),w("ngModel",i.searchTerm),l(6),m("disabled",i.zoomLevel<=i.minZoom),l(7),h("",(i.zoomLevel*100).toFixed(0),"%"),l(),m("disabled",i.zoomLevel>=i.maxZoom),l(12),m("ngIf",i.isFullscreen),l(3),O(i.currentFloorPlan?i.currentFloorPlan.name:"Mappa"),l(15),R("active",i.isFullscreen),l(2),h(" ",i.isFullscreen?"fullscreen_exit":"fullscreen"," "),l(3),h(" ",i.isLargeText?"text_decrease":"text_increase"," "),l(2),A("width",i.getScaledWidth(),"px")("height",i.getScaledHeight(),"px"),l(),A("width",i.currentFloorPlan?i.currentFloorPlan.width:1e3,"px")("height",i.currentFloorPlan?i.currentFloorPlan.height:800,"px")("transform","scale("+i.zoomLevel+")")("transform-origin","0 0"),l(3),m("ngForOf",i.getFilteredTables()),l(),m("ngIf",i.getFilteredTables().length===0),l(),m("ngIf",i.showQuickActionsModal),l(),m("ngIf",i.showManualReservationModal),l(),m("ngIf",i.showEditReservationModal),l(),m("ngIf",i.showOrderEditorModal),l(),m("ngIf",i.showOrderEditorViewModal))},dependencies:[X,J,K,Oe,oe,De,ae,ne,ee,re,te,Fe,Re,ie,Ve,me],styles:[".fullscreen-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--background);padding:var(--gap-sm);display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;border-bottom:1px solid var(--smoke-1);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);gap:var(--gap-sm)}.fullscreen-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin:0;flex:1;min-width:120px}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{position:absolute!important;inset:70px 0 0!important;height:auto!important;max-height:none!important;min-height:auto!important;border:none!important;margin-top:0!important;border-radius:0!important;padding:var(--gap-md)!important;overflow:auto!important;-webkit-overflow-scrolling:touch!important}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-wrapper[_ngcontent-%COMP%]{width:auto!important;height:auto!important}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{transform-origin:0 0!important}.canvas-container[_ngcontent-%COMP%]{position:relative;width:100%;min-height:400px;border:2px solid var(--smoke-1);border-radius:12px;background-color:var(--background);overflow:auto!important;-webkit-overflow-scrolling:touch!important;padding:var(--gap-sm);box-sizing:border-box}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;min-width:100%;min-height:100%}.floor-plan-canvas[_ngcontent-%COMP%]{position:relative;background-color:var(--background);box-shadow:0 4px 12px var(--smoke-1);border-radius:8px;transform-origin:0 0;transition:transform .2s ease-out}@media (max-width: 768px){.chip.active.ml-sm[_ngcontent-%COMP%]{display:none}.canvas-container[_ngcontent-%COMP%]{min-height:400px;max-height:80vh;overflow:auto!important;-webkit-overflow-scrolling:touch!important;touch-action:pan-x pan-y!important;display:block}}.table-map-fullscreen[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{display:block!important;width:max-content!important;height:max-content!important;min-width:100%!important;min-height:100%!important;margin:auto!important;transform-origin:center center;transition:transform .2s ease-out;background:var(--background)}@media (max-width: 768px){.fullscreen-header[_ngcontent-%COMP%]{padding:var(--gap-sm)}.table-map-fullscreen[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{top:80px}}.icon-button[disabled][_ngcontent-%COMP%]{opacity:.4;cursor:not-allowed}.quick-actions-mobile[_ngcontent-%COMP%]{display:flex!important;gap:var(--gap-sm)!important;overflow-x:auto!important;padding-bottom:var(--gap-sm)!important;-webkit-overflow-scrolling:touch!important;scrollbar-width:none!important;flex-wrap:wrap}.quick-actions-mobile[_ngcontent-%COMP%]::-webkit-scrollbar{display:none!important}.quick-action-button[_ngcontent-%COMP%]{display:flex!important;flex-direction:column!important;align-items:center!important;justify-content:center!important;padding:var(--gap-sm)!important;min-width:80px!important;border:1px solid var(--smoke-1)!important;border-radius:12px!important;background:var(--background)!important;transition:all .2s ease!important;cursor:pointer!important;flex-shrink:0!important}.quick-action-button[_ngcontent-%COMP%]:hover, .quick-action-button[_ngcontent-%COMP%]:active{background:var(--smoke-1)!important;border-color:var(--primary)!important}.quick-action-button[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)!important;margin-bottom:4px!important}.mobile-scroll[_ngcontent-%COMP%]{overflow-y:auto;height:calc(100vh - 200px);max-height:500px;scroll-behavior:auto!important}.dish-card[_ngcontent-%COMP%]{min-height:120px;transition:none!important}.modal-container.modal-lg[_ngcontent-%COMP%]{max-height:90vh;display:flex;flex-direction:column}.modal-container.modal-lg[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{flex:1;overflow:hidden}.dish-card[_ngcontent-%COMP%]{border:1px solid var(--smoke-1)!important;border-radius:12px!important;padding:var(--gap-sm);background:var(--background);transition:none;cursor:pointer!important}.dish-card[_ngcontent-%COMP%]:hover, .dish-card[_ngcontent-%COMP%]:active{transform:translateY(-2px)!important;border-color:var(--primary)!important;box-shadow:0 4px 12px var(--smoke-2)!important}.dish-card.mobile-card[_ngcontent-%COMP%]{margin-bottom:var(--gap-sm)!important}.dish-name[_ngcontent-%COMP%]{font-weight:600!important;font-size:var(--fs-sm)!important;line-height:1.3!important;color:var(--text-color)!important}.dish-price[_ngcontent-%COMP%]{font-weight:700!important;font-size:var(--fs-sm)!important;color:var(--primary)!important}.bill-preview[_ngcontent-%COMP%]{background:var(--background);color:var(--text-color);max-height:70vh;overflow-y:auto;padding:var(--gap-lg)}.bill-preview[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{margin-bottom:var(--gap-lg);padding-bottom:var(--gap-md);border-bottom:2px solid var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]{background:var(--vetro);border:1px solid var(--smoke-1);border-radius:12px;margin-bottom:var(--gap-md);transition:all .3s ease}.bill-preview[_ngcontent-%COMP%]   .comanda[_ngcontent-%COMP%]:hover{border-color:var(--secondary);box-shadow:0 4px 12px var(--smoke-2)}.bill-preview[_ngcontent-%COMP%]   .comanda-header[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600;border-bottom:1px solid var(--smoke-1);padding-bottom:var(--gap-sm);margin-bottom:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:calc(var(--gap-sm) / 2) 0;border-bottom:1px dashed var(--smoke-1)}.bill-preview[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:last-child{border-bottom:none}.bill-preview[_ngcontent-%COMP%]   .comanda-total[_ngcontent-%COMP%]{color:var(--primary);font-weight:600;margin-top:var(--gap-sm);padding-top:var(--gap-sm)}.bill-preview[_ngcontent-%COMP%]   .header-total[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--primary) 10%,transparent);padding:var(--gap-sm);border-radius:8px;margin-top:var(--gap-md)}.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:var(--gradiente);color:#fff;padding:var(--gap-lg);border-radius:16px;margin-top:var(--gap-lg);box-shadow:0 8px 24px var(--shadow-2)}@media print{.bill-preview[_ngcontent-%COMP%]   .grand-total[_ngcontent-%COMP%]{background:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.modal-footer[_ngcontent-%COMP%]{display:none!important}}.canvas-wrapper[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.legend-color[_ngcontent-%COMP%]{width:var(--fs-md);height:var(--fs-sm);display:flex;border-radius:var(--gap-sm)}.legend-color.free[_ngcontent-%COMP%]{background:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.occupied[_ngcontent-%COMP%]{background:#ef4444}.legend-color.merged[_ngcontent-%COMP%]{background:#ff6b35}.detail[_ngcontent-%COMP%]{display:flex;gap:var(--gap-sm)}.table-suggestion-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm);padding:var(--gap-sm)}.table-suggestion-icon[_ngcontent-%COMP%]{font-size:var(--fs-md)}.fullscreen-mobile[_ngcontent-%COMP%]{max-height:100dvh;height:100%}.table-card.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.overlay-disabled[_ngcontent-%COMP%]{position:absolute;inset:0;background:var(--background);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10}"]})};export{Ze as TableMap};
