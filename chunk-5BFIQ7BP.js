import{a as m}from"./chunk-KNL3CWA3.js";import{A as h}from"./chunk-DCWKKS33.js";import{$ as b,a as n,b as c,ea as u,f as a,m as d}from"./chunk-K5RDB55Y.js";var p=class s{supabaseService=u(h);authService=u(m);dataSubject=new d([]);data$=this.dataSubject.asObservable();loadData(t){return a(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let r=this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",e);t&&Object.keys(t).forEach(l=>{r=r.eq(l,t[l])});let{data:o,error:i}=yield r;if(i)throw i;this.dataSubject.next(o||[])}catch(e){console.error(`Error loading ${this.getTableName()}:`,e)}})}getCurrentRestaurantId(){return a(this,null,function*(){let t=this.authService.currentUserValue;if(!t)return null;let{data:e}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",t.id).limit(1).single();return e?.id||null})}create(t){return a(this,null,function*(){let e=yield this.getCurrentRestaurantId();if(!e)return null;let r=c(n({},t),{restaurant_id:e,created_at:new Date().toISOString()}),{data:o,error:i}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).insert(r).select().single();return i?(console.error(`Error creating ${this.getTableName()}:`,i),null):(yield this.loadData(),o)})}update(t,e){return a(this,null,function*(){try{let{error:r}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).update(c(n({},e),{updated_at:new Date().toISOString()})).eq("id",t);if(r)throw r;return yield this.loadData(),!0}catch(r){return console.error(`Error updating ${this.getTableName()}:`,r),!1}})}delete(t){return a(this,null,function*(){try{let{error:e}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).delete().eq("id",t);if(e)throw e;return yield this.loadData(),!0}catch(e){return console.error(`Error deleting ${this.getTableName()}:`,e),!1}})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=b({token:s,factory:s.\u0275fac,providedIn:"root"})};export{p as a};
