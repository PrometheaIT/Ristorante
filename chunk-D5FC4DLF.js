import{a as Pe}from"./chunk-LV23W6TA.js";import{a as A}from"./chunk-WQWNBZMH.js";import{a as Oe}from"./chunk-HLPUWHUI.js";import{a as Te,b as z}from"./chunk-WKNMXFUK.js";import{a as ye}from"./chunk-QPUWITB2.js";import{b as pe,d as ge,e as _e,g as ve,h as be,i as he,p as fe,q as xe,r as Se,u as Ce,w as we}from"./chunk-HTWH3NPU.js";import{a as Me}from"./chunk-VMXTU4N2.js";import"./chunk-XJU7QOT3.js";import{B as ue,D as me,d as ie,e as re,f as ae,i as oe,j as le,k as se,l as ce,u as de}from"./chunk-KBL2L3GY.js";import{Cb as w,Gb as p,Hb as d,Lb as X,Mb as Z,Na as l,Nb as ee,Ob as L,Pb as te,Qb as N,Sb as k,Tb as o,Ub as M,Vb as b,Wb as V,Xb as B,Yb as f,Zb as x,_b as S,a as D,b as G,ba as J,bc as $,cb as K,cc as O,ec as E,f as _,fc as ne,g as Y,ga as C,hb as h,la as u,ma as m,tb as g,ub as i,vb as r,wb as R}from"./chunk-UE7YVF6I.js";var q=class s{supabaseService=C(ue);orderService=C(z);reservationService=C(A);calculateTableStatus(t){return _(this,null,function*(){let e=t.filter(c=>!c.is_merged||c.parent_table_id===null),n=new Date().toISOString().split("T")[0],a=new Date;try{let{data:c,error:v}=yield this.supabaseService.getSupabaseClient().from("reservations").select("*").eq("reservation_date",n).in("status",["pending","confirmed"]);if(v)throw v;let{data:y,error:P}=yield this.supabaseService.getSupabaseClient().from("orders").select(`
          *,
          order_items (*)
        `).not("status","in",'("completed", "cancelled")');if(P)throw P;return e.map(T=>{let j=(c||[]).filter(I=>I.table_id===T.id),Q=(y||[]).filter(I=>I.table_id===T.id),W="free",U=null,F=null;return Q.length>0?(W="occupied",F=Q[0],F.order_items&&F.order_items.length>0&&F.order_items.every(H=>H.status==="served"||H.status==="out_of_stock")&&console.log(`\u{1F4CB} Tavolo ${T.table_number}: tutti i piatti serviti, pronto per il conto`)):j.length>0&&(W="reserved",U=j[0]),{table:T,status:W,currentReservation:U,currentOrder:F}})}catch(c){return console.error("\u274C Error calculating table status:",c),e.map(v=>({table:v,status:"free",currentReservation:null,currentOrder:null}))}})}isOrderActive(t){return t?!["completed","cancelled"].includes(t.status):!1}isReservationActive(t){if(!t)return!1;try{let e=new Date(`${t.reservation_date}T${t.reservation_time}`),n=new Date,c=(e.getTime()-n.getTime())/(1e3*60*60);return c<=2&&c>=-4}catch{return!1}}static \u0275fac=function(e){return new(e||s)};static \u0275prov=J({token:s,factory:s.\u0275fac,providedIn:"root"})};var Re=["mapContainer"],ke=()=>[1,2,3,4,5,6,7,8,9,10];function Ve(s,t){if(s&1&&(i(0,"option",44),o(1),r()),s&2){let e=t.$implicit;g("ngValue",e),l(),M(e.name)}}function Ie(s,t){if(s&1&&(i(0,"div",52)(1,"small"),o(2),r()()),s&2){let e=d().$implicit;l(2),b("Pren: ",e.currentReservation.customer_name)}}function De(s,t){if(s&1&&(i(0,"div",52)(1,"small"),o(2),r()()),s&2){let e=d().$implicit;l(2),b("Ord: ",e.currentOrder.order_items==null?null:e.currentOrder.order_items.length," piatti")}}function ze(s,t){if(s&1){let e=w();i(0,"div",45),p("click",function(){let a=u(e).$implicit,c=d();return m(c.onTableClick(a))}),i(1,"div",46)(2,"div",47),o(3),r(),i(4,"div",48)(5,"div",49),o(6),r(),i(7,"div",50),o(8),r()(),h(9,Ie,3,1,"div",51)(10,De,3,1,"div",51),r()()}if(s&2){let e=t.$implicit,n=d();k(n.getTableClass(e)),g("ngStyle",n.getTableStyle(e.table)),l(3),M(e.table.table_number),l(3),b("",e.table.capacity," p"),l(),k(n.getStatusColorClass(e.status)),l(),b(" ",n.getStatusText(e.status)," "),l(),g("ngIf",e.currentReservation),l(),g("ngIf",e.currentOrder)}}function Ae(s,t){s&1&&(i(0,"div",53)(1,"span",5),o(2,"search_off"),r(),i(3,"h3"),o(4,"Nessun tavolo trovato"),r(),i(5,"p",8),o(6,"Modifica i filtri di ricerca"),r()())}function qe(s,t){if(s&1){let e=w();i(0,"div",66)(1,"button",28),p("click",function(){u(e);let a=d(2);return m(a.openManualReservationModal())}),i(2,"span",5),o(3,"event"),r(),o(4," Crea Prenotazione "),r(),i(5,"button",67),p("click",function(){u(e);let a=d(2);return m(a.openCreateOrderModal())}),i(6,"span",5),o(7,"restaurant"),r(),o(8," Crea Ordine "),r()()}}function We(s,t){if(s&1){let e=w();i(0,"div",66)(1,"button",28),p("click",function(){u(e);let a=d(2);return m(a.openEditReservationModal())}),i(2,"span",5),o(3,"edit"),r(),o(4," Modifica Prenotazione "),r(),i(5,"button",67),p("click",function(){u(e);let a=d(2);return m(a.openCreateOrderModal())}),i(6,"span",5),o(7,"check"),r(),o(8," Conferma Arrivo "),r()()}}function Le(s,t){if(s&1){let e=w();i(0,"div",66)(1,"button",28),p("click",function(){u(e);let a=d(2);return m(a.openCreateOrderModal())}),i(2,"span",5),o(3,"add"),r(),o(4," Aggiungi Piatti "),r(),i(5,"button",68),p("click",function(){u(e);let a=d(2);return m(a.openOrderDetails())}),i(6,"span",5),o(7,"receipt"),r(),o(8," Dettagli Ordine "),r(),i(9,"button",69),p("click",function(){u(e);let a=d(2);return m(a.closeOrderAndCreateBill())}),i(10,"span",5),o(11,"receipt_long"),r(),o(12," Chiudi Conto "),r()()}}function Ne(s,t){if(s&1){let e=w();i(0,"div",70)(1,"button",71),p("click",function(){u(e);let a=d(2);return m(a.freeTableManually())}),i(2,"span",5),o(3,"lock_open"),r(),o(4," Libera Tavolo "),r()()}}function Be(s,t){if(s&1){let e=w();i(0,"div",54),p("click",function(){u(e);let a=d();return m(a.deselectTable())}),i(1,"div",55),p("click",function(a){return u(e),m(a.stopPropagation())}),i(2,"div",56)(3,"h2",57),o(4),r(),i(5,"button",58),p("click",function(){u(e);let a=d();return m(a.deselectTable())}),i(6,"span",5),o(7,"close"),r()()(),i(8,"div",59)(9,"div",60)(10,"div",61)(11,"span",62),o(12),r()(),i(13,"div",63),h(14,qe,9,0,"div",64)(15,We,9,0,"div",64)(16,Le,13,0,"div",64)(17,Ne,5,0,"div",65),r()()()()()}if(s&2){let e=d();l(4),b("Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number),l(7),k(e.getStatusColorClass((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")),l(),b(" ",e.getStatusText((e.selectedTableStatus==null?null:e.selectedTableStatus.status)||"free")," "),l(2),g("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="free"),l(),g("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="reserved"),l(),g("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)==="occupied"),l(),g("ngIf",(e.selectedTableStatus==null?null:e.selectedTableStatus.status)!=="free")}}function $e(s,t){if(s&1&&(i(0,"option",89),o(1),r()),s&2){let e=t.$implicit,n=d(2);g("value",e)("disabled",n.selectedTable&&e>n.selectedTable.capacity),l(),B(" ",e," ",e===1?"persona":"persone"," ",n.selectedTable&&e>n.selectedTable.capacity?" (Troppe persone)":""," ")}}function je(s,t){if(s&1){let e=w();i(0,"div",72),p("click",function(){u(e);let a=d();return m(a.closeManualReservationModal())}),i(1,"div",73),p("click",function(a){return u(e),m(a.stopPropagation())}),i(2,"div",56)(3,"h2",57)(4,"span",5),o(5,"event"),r(),o(6),r(),i(7,"button",58),p("click",function(){u(e);let a=d();return m(a.closeManualReservationModal())}),i(8,"span",5),o(9,"close"),r()()(),i(10,"div",59)(11,"form",74,1),p("ngSubmit",function(){u(e);let a=d();return m(a.createManualReservation())}),i(13,"div",75)(14,"label",18),o(15,"Nome Cliente *"),r(),i(16,"input",76),S("ngModelChange",function(a){u(e);let c=d();return x(c.manualReservationData.customer_name,a)||(c.manualReservationData.customer_name=a),m(a)}),r()(),i(17,"div",75)(18,"label",18),o(19,"Telefono *"),r(),i(20,"input",77),S("ngModelChange",function(a){u(e);let c=d();return x(c.manualReservationData.customer_phone,a)||(c.manualReservationData.customer_phone=a),m(a)}),r()(),i(21,"div",78)(22,"div",75)(23,"label",18),o(24,"Data *"),r(),i(25,"input",79),S("ngModelChange",function(a){u(e);let c=d();return x(c.manualReservationData.reservation_date,a)||(c.manualReservationData.reservation_date=a),m(a)}),r()(),i(26,"div",75)(27,"label",18),o(28,"Orario *"),r(),i(29,"input",80),S("ngModelChange",function(a){u(e);let c=d();return x(c.manualReservationData.reservation_time,a)||(c.manualReservationData.reservation_time=a),m(a)}),r()()(),i(30,"div",75)(31,"label",18),o(32,"Numero Persone *"),r(),i(33,"select",81),S("ngModelChange",function(a){u(e);let c=d();return x(c.manualReservationData.party_size,a)||(c.manualReservationData.party_size=a),m(a)}),h(34,$e,2,5,"option",82),r(),i(35,"div",83),o(36),r()(),i(37,"div",75)(38,"label",18),o(39,"Note Speciali"),r(),i(40,"textarea",84),S("ngModelChange",function(a){u(e);let c=d();return x(c.manualReservationData.special_requests,a)||(c.manualReservationData.special_requests=a),m(a)}),r()()()(),i(41,"div",85)(42,"div",27)(43,"div",86)(44,"button",87),p("click",function(){u(e);let a=d();return m(a.closeManualReservationModal())}),o(45," Annulla "),r(),i(46,"button",88),p("click",function(){u(e);let a=d();return m(a.createManualReservation())}),i(47,"span",5),o(48,"add"),r(),o(49," Crea Prenotazione "),r()()()()()()}if(s&2){let e=L(12),n=d();l(6),b(" Nuova Prenotazione - Tavolo ",n.selectedTable==null?null:n.selectedTable.table_number," "),l(10),f("ngModel",n.manualReservationData.customer_name),l(4),f("ngModel",n.manualReservationData.customer_phone),l(5),f("ngModel",n.manualReservationData.reservation_date),l(4),f("ngModel",n.manualReservationData.reservation_time),l(4),f("ngModel",n.manualReservationData.party_size),l(),g("ngForOf",$(10,ke)),l(2),b(" Capacit\xE0 massima tavolo: ",(n.selectedTable==null?null:n.selectedTable.capacity)||0," persone "),l(4),f("ngModel",n.manualReservationData.special_requests),l(6),g("disabled",!e.valid)}}function Qe(s,t){if(s&1&&(i(0,"option",89),o(1),r()),s&2){let e=t.$implicit,n=d(2);g("value",e)("disabled",n.selectedTable&&e>n.selectedTable.capacity),l(),B(" ",e," ",e===1?"persona":"persone"," ",n.selectedTable&&e>n.selectedTable.capacity?" (Troppe persone)":""," ")}}function Ue(s,t){if(s&1){let e=w();i(0,"button",91),p("click",function(){u(e);let a=d(2);return m(a.deleteReservation())}),i(1,"span",5),o(2,"delete"),r(),o(3," Elimina Prenotazione "),r()}}function He(s,t){if(s&1){let e=w();i(0,"div",72),p("click",function(){u(e);let a=d();return m(a.closeEditReservationModal())}),i(1,"div",73),p("click",function(a){return u(e),m(a.stopPropagation())}),i(2,"div",56)(3,"h2",57)(4,"span",5),o(5,"edit"),r(),o(6),r(),i(7,"button",58),p("click",function(){u(e);let a=d();return m(a.closeEditReservationModal())}),i(8,"span",5),o(9,"close"),r()()(),i(10,"div",59)(11,"form",74,1),p("ngSubmit",function(){u(e);let a=d();return m(a.updateReservation())}),i(13,"div",75)(14,"label",18),o(15,"Nome Cliente *"),r(),i(16,"input",76),S("ngModelChange",function(a){u(e);let c=d();return x(c.editingReservation.customer_name,a)||(c.editingReservation.customer_name=a),m(a)}),r()(),i(17,"div",75)(18,"label",18),o(19,"Telefono *"),r(),i(20,"input",77),S("ngModelChange",function(a){u(e);let c=d();return x(c.editingReservation.customer_phone,a)||(c.editingReservation.customer_phone=a),m(a)}),r()(),i(21,"div",78)(22,"div",75)(23,"label",18),o(24,"Data *"),r(),i(25,"input",79),S("ngModelChange",function(a){u(e);let c=d();return x(c.editingReservation.reservation_date,a)||(c.editingReservation.reservation_date=a),m(a)}),r()(),i(26,"div",75)(27,"label",18),o(28,"Orario *"),r(),i(29,"input",80),S("ngModelChange",function(a){u(e);let c=d();return x(c.editingReservation.reservation_time,a)||(c.editingReservation.reservation_time=a),m(a)}),r()()(),i(30,"div",75)(31,"label",18),o(32,"Numero Persone *"),r(),i(33,"select",81),S("ngModelChange",function(a){u(e);let c=d();return x(c.editingReservation.party_size,a)||(c.editingReservation.party_size=a),m(a)}),h(34,Qe,2,5,"option",82),r(),i(35,"div",83),o(36),r()(),i(37,"div",75)(38,"label",18),o(39,"Note Speciali"),r(),i(40,"textarea",84),S("ngModelChange",function(a){u(e);let c=d();return x(c.editingReservation.special_requests,a)||(c.editingReservation.special_requests=a),m(a)}),r()()()(),i(41,"div",85)(42,"div",27),h(43,Ue,4,0,"button",90),i(44,"button",87),p("click",function(){u(e);let a=d();return m(a.closeEditReservationModal())}),o(45," Annulla "),r(),i(46,"button",88),p("click",function(){u(e);let a=d();return m(a.updateReservation())}),i(47,"span",5),o(48,"save"),r(),o(49," Salva Modifiche "),r()()()()()}if(s&2){let e=L(12),n=d();l(6),b(" Modifica Prenotazione - Tavolo ",n.selectedTable==null?null:n.selectedTable.table_number," "),l(10),f("ngModel",n.editingReservation.customer_name),l(4),f("ngModel",n.editingReservation.customer_phone),l(5),f("ngModel",n.editingReservation.reservation_date),l(4),f("ngModel",n.editingReservation.reservation_time),l(4),f("ngModel",n.editingReservation.party_size),l(),g("ngForOf",$(11,ke)),l(2),b(" Capacit\xE0 massima tavolo: ",(n.selectedTable==null?null:n.selectedTable.capacity)||0," persone "),l(4),f("ngModel",n.editingReservation.special_requests),l(3),g("ngIf",n.isReservationDeletable(n.editingReservation)),l(3),g("disabled",!e.valid)}}function Ge(s,t){if(s&1&&(i(0,"div",110),o(1),O(2,"slice"),r()),s&2){let e=d().$implicit;l(),V(" ",ne(2,2,e.description,0,80),"",e.description.length>80?"...":""," ")}}function Ye(s,t){if(s&1){let e=w();i(0,"div",106),p("click",function(){let a=u(e).$implicit,c=d(2);return m(c.addDishAndContinue(a))}),i(1,"div",107)(2,"strong"),o(3),r(),i(4,"span",108),o(5),O(6,"number"),r()(),h(7,Ge,3,6,"div",109),r()}if(s&2){let e=t.$implicit;l(3),M(e.name),l(2),b("\u20AC",E(6,3,e.base_price,"1.2-2")),l(2),g("ngIf",e.description)}}function Je(s,t){if(s&1&&(i(0,"div",111)(1,"div",112)(2,"span",5),o(3,"event"),r(),i(4,"div",113)(5,"span",114),o(6,"Prenotazione:"),r(),i(7,"span",115),o(8),r()()()()),s&2){let e=d(2);l(8),V(" ",e.selectedTableStatus==null?null:e.selectedTableStatus.currentReservation.customer_name," - ",e.selectedTableStatus==null?null:e.selectedTableStatus.currentReservation.party_size," persone ")}}function Ke(s,t){if(s&1){let e=w();i(0,"div",118)(1,"div",107)(2,"strong"),o(3),r(),i(4,"span",119),o(5),O(6,"number"),r()(),i(7,"div",120)(8,"button",121),p("click",function(){let a=u(e).$implicit,c=d(3);return m(c.updateOrderItemQuantity(a,-1))}),o(9,"-"),r(),i(10,"span",122),o(11),r(),i(12,"button",121),p("click",function(){let a=u(e).$implicit,c=d(3);return m(c.updateOrderItemQuantity(a,1))}),o(13,"+"),r(),i(14,"button",123),p("click",function(){let a=u(e).index,c=d(3);return m(c.removeOrderItem(a))}),i(15,"span",5),o(16,"delete"),r()()()()}if(s&2){let e=t.$implicit;l(3),M(e.dish_name),l(2),b("\u20AC",E(6,3,e.total_price,"1.2-2")),l(6),M(e.quantity)}}function Xe(s,t){if(s&1&&(i(0,"div",116),h(1,Ke,17,6,"div",117),r()),s&2){let e=d(2);l(),g("ngForOf",e.newOrderData.items)}}function Ze(s,t){s&1&&(i(0,"div",124)(1,"p",8),o(2,"Nessun piatto aggiunto"),r(),i(3,"p",125),o(4,"Clicca sui piatti dal menu per aggiungerli"),r()())}function et(s,t){if(s&1&&(i(0,"div",126)(1,"strong"),o(2),O(3,"number"),r()()),s&2){let e=d(2);l(2),b("Totale: \u20AC",E(3,1,e.orderTotal,"1.2-2"))}}function tt(s,t){s&1&&(i(0,"div",127)(1,"p",125)(2,"span",5),o(3,"info"),r(),o(4," Clicca sui piatti dal menu per aggiungerli all'ordine "),r()())}function nt(s,t){if(s&1){let e=w();i(0,"div",72),p("click",function(){u(e);let a=d();return m(a.closeCreateOrderModal())}),i(1,"div",92),p("click",function(a){return u(e),m(a.stopPropagation())}),i(2,"div",56)(3,"h2",57)(4,"span",5),o(5,"restaurant"),r(),o(6),r(),i(7,"button",58),p("click",function(){u(e);let a=d();return m(a.closeCreateOrderModal())}),i(8,"span",5),o(9,"close"),r()()(),i(10,"div",59)(11,"div",93)(12,"div",94)(13,"h4",95)(14,"span",5),o(15,"restaurant_menu"),r(),o(16," Menu Disponibile "),r(),i(17,"div",96),h(18,Ye,8,6,"div",97),r()(),i(19,"div",98)(20,"h4",95)(21,"span",5),o(22,"receipt"),r(),o(23," Riepilogo Ordine "),r(),h(24,Je,9,2,"div",99)(25,Xe,2,1,"div",100)(26,Ze,5,0,"div",101)(27,et,4,4,"div",102),i(28,"div",103)(29,"button",104),p("click",function(){u(e);let a=d();return m(a.addDishesToOrder())}),i(30,"span",5),o(31,"add"),r(),o(32," Aggiungi "),r(),i(33,"button",28),p("click",function(){u(e);let a=d();return m(a.closeCreateOrderModal())}),i(34,"span",5),o(35,"check"),r(),o(36," Chiudi "),r()(),h(37,tt,5,0,"div",105),r()()()()()}if(s&2){let e=d();l(6),V(" ",e.editingOrder?e.isAddingToExistingOrder?"Aggiungi all'Ordine":"Modifica Ordine":"Nuovo Ordine"," - Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number," "),l(12),g("ngForOf",e.dishes),l(6),g("ngIf",e.selectedTableStatus==null?null:e.selectedTableStatus.currentReservation),l(),g("ngIf",e.newOrderData.items.length>0),l(),g("ngIf",e.newOrderData.items.length===0),l(),g("ngIf",e.newOrderData.items.length>0),l(2),g("disabled",e.newOrderData.items.length===0),l(8),g("ngIf",e.newOrderData.items.length===0)}}function it(s,t){s&1&&(i(0,"span",131),o(1," Pronto per il conto "),r())}function rt(s,t){if(s&1&&(i(0,"div",136)(1,"div",107)(2,"span",137),o(3),r(),i(4,"span",138),o(5),r()(),i(6,"div",139)(7,"span",140),o(8),r(),i(9,"span",119),o(10),O(11,"number"),r()()()),s&2){let e=t.$implicit,n=d(3);l(3),M(e.dish_name||"Piatto"),l(),k(n.getOrderStatusColor(e.status)),l(),b(" ",n.getOrderStatusText(e.status)," "),l(3),b("x",e.quantity),l(2),b("\u20AC",E(11,6,e.total_price,"1.2-2"))}}function at(s,t){if(s&1&&(i(0,"div")(1,"div",132)(2,"div",112)(3,"span",5),o(4,"info"),r(),i(5,"div",113)(6,"span",114),o(7,"Stato Ordine:"),r(),i(8,"span",133),o(9),r()()(),i(10,"div",112)(11,"span",5),o(12,"schedule"),r(),i(13,"div",113)(14,"span",114),o(15,"Creato il:"),r(),i(16,"span",115),o(17),O(18,"date"),r()()()(),i(19,"div",134)(20,"h4",95)(21,"span",5),o(22,"restaurant_menu"),r(),o(23," Piatti Ordinati "),i(24,"small"),o(25),r()(),h(26,rt,12,9,"div",135),r(),i(27,"div",126)(28,"strong"),o(29),O(30,"number"),r()()()),s&2){let e=t.ngIf,n=d(2);l(8),k(n.getOrderStatusColor(n.getOverallOrderStatus(e))),l(),b(" ",n.getOrderStatusText(n.getOverallOrderStatus(e))," "),l(8),M(E(18,8,e.created_at,"dd/MM/yyyy HH:mm")),l(8),V("(",n.getServedItemsCount(e),"/",e.order_items==null?null:e.order_items.length," serviti)"),l(),g("ngForOf",e.order_items),l(3),b("Totale: \u20AC",E(30,11,n.getCurrentOrderTotal(),"1.2-2"))}}function ot(s,t){if(s&1){let e=w();i(0,"div",72),p("click",function(){u(e);let a=d();return m(a.closeOrderDetailsModal())}),i(1,"div",73),p("click",function(a){return u(e),m(a.stopPropagation())}),i(2,"div",56)(3,"h2",57)(4,"span",5),o(5,"receipt_long"),r(),o(6),h(7,it,2,0,"span",128),r(),i(8,"button",58),p("click",function(){u(e);let a=d();return m(a.closeOrderDetailsModal())}),i(9,"span",5),o(10,"close"),r()()(),i(11,"div",59),h(12,at,31,14,"div",129),r(),i(13,"div",85)(14,"button",67),p("click",function(){u(e);let a=d();return m(a.closeOrderAndCreateBill())}),i(15,"span",5),o(16,"receipt"),r(),o(17),r(),i(18,"button",130),p("click",function(){u(e);let a=d();return m(a.freeTableManually())}),i(19,"span",5),o(20,"clear"),r(),o(21," Libera Tavolo (Senza Chiudere) "),r()()()()}if(s&2){let e=d();l(6),b(" Dettagli Ordine - Tavolo ",e.selectedTable==null?null:e.selectedTable.table_number," "),l(),g("ngIf",e.getOverallOrderStatus(e.selectedTableStatus==null?null:e.selectedTableStatus.currentOrder)==="ready_for_bill"),l(5),g("ngIf",e.selectedTableStatus==null?null:e.selectedTableStatus.currentOrder),l(2),N("pulse",e.getOverallOrderStatus(e.selectedTableStatus==null?null:e.selectedTableStatus.currentOrder)==="ready_for_bill"),l(3),b(" ",e.getOverallOrderStatus(e.selectedTableStatus==null?null:e.selectedTableStatus.currentOrder)==="ready_for_bill"?"CHIUDI CONTO":"Chiudi Conto"," ")}}var Ee=class s{mapContainer;floorPlanService=C(Pe);tableService=C(Oe);reservationService=C(A);orderService=C(z);dishService=C(Me);authService=C(me);router=C(de);shiftService=C(ye);tableStatusService=C(q);notificationService=C(Te);notificationSubscription;isEnteringFullscreen=!1;floorPlans=[];currentFloorPlan=null;tables=[];tableStatuses=[];reservations=[];activeOrders=[];dishes=[];editingOrder=null;showEditReservationModal=!1;editingReservation=null;isFullscreen=!1;_orderTotal=0;get freeTablesCount(){return this.tableStatuses.filter(t=>t.status==="free").length}get reservedTablesCount(){return this.tableStatuses.filter(t=>t.status==="reserved").length}get occupiedTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied").length}get totalTablesCount(){return this.tableStatuses.length}get orderTotal(){return this._orderTotal}selectedTable=null;selectedTableStatus=null;showManualReservationModal=!1;showCreateOrderModal=!1;showOrderDetailsModal=!1;showQuickActionsModal=!1;manualReservationData={customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",party_size:2,special_requests:""};newOrderData={customer_name:"",customer_phone:"",order_type:"dine_in",notes:"",items:[]};searchTerm="";statusFilter="all";isAddingToExistingOrder=!1;subscriptions=new Y;ngOnInit(){console.log("\u{1F3C1} TableMap initialized"),this.loadData(),this.setupSubscriptions(),this.handleFullscreenChange=this.handleFullscreenChange.bind(this),document.addEventListener("fullscreenchange",this.handleFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange)}ngAfterViewInit(){console.log("\u2705 Map container after view init:",{mapContainer:this.mapContainer,nativeElement:this.mapContainer?.nativeElement,inDOM:this.mapContainer?.nativeElement?document.body.contains(this.mapContainer.nativeElement):!1}),setTimeout(()=>{console.log("\u{1F50D} Final map container check:",{mapContainer:this.mapContainer,nativeElement:this.mapContainer?.nativeElement,inDOM:this.mapContainer?.nativeElement?document.body.contains(this.mapContainer.nativeElement):!1,clientWidth:this.mapContainer?.nativeElement?.clientWidth,clientHeight:this.mapContainer?.nativeElement?.clientHeight})},500)}handleFullscreenChange(){let t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,e=t===this.mapContainer?.nativeElement,n=document.querySelector(".table-map-container"),a=document.body.classList.contains("fullscreen-mode")||(n?n.classList.contains("fullscreen-mode"):!1);this.isFullscreen=e||a,console.log("\u{1F504} Fullscreen change detected:",{isFullscreen:this.isFullscreen,fullscreenElement:t,isMapContainerFullscreen:e,isCSSFullscreen:a,mapContainer:this.mapContainer?.nativeElement})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.notificationSubscription&&this.notificationSubscription.unsubscribe(),this.isFullscreen&&this.exitFullscreen(),document.removeEventListener("fullscreenchange",this.handleFullscreenChange),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange)}checkAuth(){return _(this,null,function*(){try{let t=this.authService.currentUserValue;return t?(console.log("\u2705 User authenticated:",t.id),!0):(console.error("\u274C No authenticated user"),!1)}catch(t){return console.error("\u274C Auth check failed:",t),!1}})}checkAndUpdateExpiredReservations(){return _(this,null,function*(){try{let t=new Date().toISOString().split("T")[0],{data:e,error:n}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").select("*").eq("reservation_date",t).in("status",["pending","confirmed"]);if(n)throw n;for(let a of e||[])if(!this.tableStatusService.isReservationActive(a)){let{error:c}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").update({status:"completed",updated_at:new Date().toISOString()}).eq("id",a.id);c&&console.error("Error updating expired reservation:",c)}}catch(t){console.error("\u274C Error checking expired reservations:",t)}})}loadData(){return _(this,null,function*(){if(!(yield this.checkAuth())){alert("Errore di autenticazione. Per favore, effettua il login nuovamente.");return}try{console.log("\u{1F504} Loading all data..."),yield Promise.all([this.floorPlanService.loadFloorPlans(),this.tableService.loadData(),this.dishService.loadDishes(),this.loadReservations(),this.loadActiveOrders()]),yield this.checkAndUpdateExpiredReservations(),yield this.updateTableStatuses(),console.log("\u2705 All data loaded successfully")}catch(e){console.error("\u{1F4A5} Error loading data:",e)}})}setupSubscriptions(){this.subscriptions.add(this.floorPlanService.floorPlans$.subscribe(t=>{this.floorPlans=t,t.length>0&&!this.currentFloorPlan&&(this.currentFloorPlan=t[0],this.loadTablesForFloorPlan())})),this.subscriptions.add(this.tableService.data$.subscribe(()=>{this.loadTablesForFloorPlan()})),this.subscriptions.add(this.dishService.data$.subscribe(t=>{this.dishes=t.filter(e=>e.status==="available")}))}loadTablesForFloorPlan(){if(!this.currentFloorPlan){this.tables=[],this.tableStatuses=[];return}this.tables=this.tableService.getTablesByFloorPlan(this.currentFloorPlan.id),this.updateTableStatuses()}updateTableStatuses(){return _(this,null,function*(){if(console.log("\u{1F504} Aggiornamento stati tavoli..."),!this.tables||this.tables.length===0){console.log("\u274C Nessun tavolo da aggiornare");return}try{this.tableStatuses=yield this.tableStatusService.calculateTableStatus(this.tables),this.selectedTable&&(this.selectedTableStatus=this.tableStatuses.find(t=>t.table.id===this.selectedTable?.id)||null),console.log("\u2705 Stati tavoli aggiornati:",this.tableStatuses.length),console.log("\u{1F4CA} Distribuzione stati:"),console.log("  - Liberi:",this.tableStatuses.filter(t=>t.status==="free").length),console.log("  - Prenotati:",this.tableStatuses.filter(t=>t.status==="reserved").length),console.log("  - Occupati:",this.tableStatuses.filter(t=>t.status==="occupied").length)}catch(t){console.error("\u274C Errore aggiornamento stati tavoli:",t)}})}isOrderActive(t){return this.tableStatusService.isOrderActive(t)}isReservationActive(t){return this.tableStatusService.isReservationActive(t)}loadReservations(){return _(this,null,function*(){try{let t=new Date().toISOString().split("T")[0],{data:e,error:n}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").select("*").eq("reservation_date",t).in("status",["pending","confirmed"]);if(n)throw n;this.reservations=e||[]}catch(t){console.error("\u274C Error loading reservations:",t)}})}loadActiveOrders(){return _(this,null,function*(){try{console.log("\u{1F504} Loading active orders...");let t=yield this.orderService.forceRefreshActiveOrders();Array.isArray(t)?(this.activeOrders=t,console.log("\u2705 Active orders loaded:",this.activeOrders.length)):this.activeOrders=[]}catch(t){console.error("\u274C Error loading active orders:",t),this.activeOrders=[]}})}onTableClick(t){this.selectedTable=t.table,this.selectedTableStatus=t,this.showQuickActionsModal=!0}deselectTable(){this.selectedTable=null,this.selectedTableStatus=null,this.showQuickActionsModal=!1}openManualReservationModal(){if(!this.selectedTable)return;let t=new Date;this.manualReservationData={customer_name:"",customer_phone:"",reservation_date:t.toISOString().split("T")[0],reservation_time:t.toTimeString().split(" ")[0].substring(0,5),party_size:this.selectedTable.capacity||2,special_requests:""},this.showQuickActionsModal=!1,this.showManualReservationModal=!0}closeManualReservationModal(){this.showManualReservationModal=!1}createManualReservation(){return _(this,null,function*(){if(this.selectedTable){if(this.manualReservationData.party_size>this.selectedTable.capacity){alert(`Il tavolo pu\xF2 ospitare al massimo ${this.selectedTable.capacity} persone.`);return}try{let t={restaurant_id:this.selectedTable.restaurant_id,table_id:this.selectedTable.id,reservation_date:this.manualReservationData.reservation_date,reservation_time:this.manualReservationData.reservation_time,party_size:this.manualReservationData.party_size,special_requests:this.manualReservationData.special_requests,status:"confirmed",customer_id:null,customer_name:this.manualReservationData.customer_name,customer_phone:this.manualReservationData.customer_phone};console.log("\u{1F4DD} Creating manual reservation:",t);let{data:e,error:n}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").insert(t).select().single();if(n)throw console.error("\u274C Error creating manual reservation:",n),n;console.log("\u2705 Manual reservation created:",e),this.closeManualReservationModal(),yield this.loadReservations(),this.updateTableStatuses(),alert("Prenotazione creata con successo!")}catch(t){console.error("\u274C Error creating manual reservation:",t),alert("Errore durante la creazione della prenotazione: "+t.message)}}})}getTableClass(t){let e=["table-element",`shape-${t.table.shape}`];return e.push(t.status),this.selectedTable?.id===t.table.id&&e.push("selected"),e.join(" ")}getTableStyle(t){let e=t.shape==="rectangle"||t.shape==="square"?"8px":"50%";return{left:t.position_x+"px",top:t.position_y+"px",width:t.width+"px",height:t.height+"px","border-radius":e,transform:`rotate(${t.rotation}deg)`}}getStatusText(t){return{free:"Libero",reserved:"Prenotato",occupied:"Occupato",needs_attention:"Da controllare"}[t]||t}getStatusColorClass(t){return`status-${t}`}getFilteredTables(){let t=this.tableStatuses;return this.statusFilter!=="all"&&(t=t.filter(e=>e.status===this.statusFilter)),this.searchTerm&&(t=t.filter(e=>e.table.table_number.toLowerCase().includes(this.searchTerm.toLowerCase())||e.table.table_name.toLowerCase().includes(this.searchTerm.toLowerCase()))),t}onFloorPlanSelect(t){this.currentFloorPlan=t,this.loadTablesForFloorPlan(),this.deselectTable()}formatTime(t){return t?t.substring(0,5):""}getCurrentOrderTotal(){return this.selectedTableStatus?.currentOrder?.order_items?this.selectedTableStatus.currentOrder.order_items.reduce((t,e)=>t+e.total_price,0):0}toggleFullscreen(){this.isFullscreen?this.exitFullscreen():this.enterFullscreen()}enterFullscreen(){return _(this,null,function*(){if(this.isFullscreen){yield this.exitFullscreen();return}try{if(!this.mapContainer?.nativeElement){console.warn("\u274C Map container not available");let e=document.querySelector(".table-map-container");if(e){console.log("\u{1F504} Using main container as fallback"),yield this.enterFullscreenForElement(e);return}alert("Impossibile attivare la modalit\xE0 schermo intero. Elemento non trovato.");return}let t=this.mapContainer.nativeElement;if(!document.body.contains(t)){console.warn("\u274C Map container not in DOM"),alert("Elemento mappa non trovato nel DOM");return}console.log("\u{1F5A5}\uFE0F Entering fullscreen for element:",t),yield this.enterFullscreenForElement(t)}catch(t){console.error("\u274C Error entering fullscreen:",t),this.activateCSSFullscreen()}})}enterFullscreenForElement(t){return _(this,null,function*(){try{if(t.requestFullscreen)yield t.requestFullscreen();else if(t.webkitRequestFullscreen)yield t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)yield t.mozRequestFullScreen();else if(t.msRequestFullscreen)yield t.msRequestFullscreen();else{console.warn("Fullscreen API not supported, using CSS fallback"),this.activateCSSFullscreen();return}this.isFullscreen=!0,console.log("\u2705 Fullscreen entered successfully")}catch(e){throw console.error("\u274C Error in enterFullscreenForElement:",e),e}})}activateCSSFullscreen(){console.log("\u{1F504} Activating CSS fullscreen fallback");let t=document.querySelector(".table-map-container");t?(t.classList.add("fullscreen-mode"),this.isFullscreen=!0,console.log("\u2705 CSS fullscreen activated")):console.error("\u274C Cannot activate CSS fullscreen: container not found")}exitFullscreen(){return _(this,null,function*(){try{document.exitFullscreen?yield document.exitFullscreen():document.webkitExitFullscreen?yield document.webkitExitFullscreen():document.mozCancelFullScreen?yield document.mozCancelFullScreen():document.msExitFullscreen&&(yield document.msExitFullscreen()),this.deactivateCSSFullscreen(),this.isFullscreen=!1,console.log("\u2705 Fullscreen exited successfully")}catch(t){console.error("\u274C Error exiting fullscreen:",t),this.deactivateCSSFullscreen(),this.isFullscreen=!1}})}deactivateCSSFullscreen(){let t=document.querySelector(".table-map-container");t&&t.classList.remove("fullscreen-mode")}openCreateOrderModal(){this.initializeNewOrderData(),this.showCreateOrderModal=!0,this.showQuickActionsModal=!1}openEditReservationModal(){this.selectedTableStatus?.currentReservation&&(this.editingReservation=D({},this.selectedTableStatus.currentReservation),this.showEditReservationModal=!0,this.showQuickActionsModal=!1)}openOrderDetails(){this.showOrderDetailsModal=!0,this.showQuickActionsModal=!1}closeEditReservationModal(){this.showEditReservationModal=!1,this.editingReservation=null}closeCreateOrderModal(){this.showCreateOrderModal=!1,this.newOrderData={customer_name:"",customer_phone:"",order_type:"dine_in",notes:"",items:[]},this.editingOrder=null,this.isAddingToExistingOrder=!1}closeOrderDetailsModal(){this.showOrderDetailsModal=!1}isReservationDeletable(t){if(!t?.reservation_date||!t?.reservation_time)return!1;try{return new Date(`${t.reservation_date}T${t.reservation_time}`)>new Date}catch(e){return console.error("Errore nel parsing della data:",e),!1}}addDishAndContinue(t){this.addDishToOrder(t)}updateOrderItemQuantity(t,e){let n=t.quantity+e;n<=0?this.removeOrderItemFromList(t):(t.quantity=n,t.total_price=t.unit_price*n),this.calculateOrderTotal()}removeOrderItem(t){this.newOrderData.items.splice(t,1),this.calculateOrderTotal()}initializeNewOrderData(){this.newOrderData={customer_name:"",customer_phone:"",order_type:"dine_in",notes:"",items:[]},this.isAddingToExistingOrder=!!this.selectedTableStatus?.currentOrder,this.editingOrder=this.selectedTableStatus?.currentOrder||null,this.isAddingToExistingOrder&&this.selectedTableStatus?.currentReservation&&(this.newOrderData.customer_name=this.selectedTableStatus.currentReservation.customer_name,this.newOrderData.customer_phone=this.selectedTableStatus.currentReservation.customer_phone)}calculateOrderTotal(){this._orderTotal=this.newOrderData.items.reduce((t,e)=>t+e.quantity*e.unit_price,0)}addDishToOrder(t){let e=this.newOrderData.items.find(n=>n.dish_id===t.id);e?(e.quantity+=1,e.total_price=e.unit_price*e.quantity):this.newOrderData.items.push({dish_id:t.id,dish_name:t.name,unit_price:t.base_price,quantity:1,total_price:t.base_price}),this.calculateOrderTotal()}removeOrderItemFromList(t){let e=this.newOrderData.items.findIndex(n=>n.dish_id===t.dish_id);e!==-1&&this.newOrderData.items.splice(e,1),this.calculateOrderTotal()}closeOrderAndCreateBill(){return _(this,null,function*(){if(!this.selectedTableStatus?.currentOrder){alert("Nessun ordine attivo per questo tavolo");return}let t=this.selectedTableStatus.currentOrder.id,e=this.selectedTable?.id;if(!e){console.error("\u274C Table ID is undefined, cannot refresh table status");return}this.debugOrderFlow(t);try{if(console.log(`\u{1F9FE} Closing order ${t} for table ${this.selectedTable?.table_number}`),!(yield this.completeOrder(t)))throw new Error("Failed to complete order");console.log("\u2705 Order closed successfully");let a=yield this.getOrderWithDetails(t);if(!a)throw new Error("Failed to fetch order details for bill");let c=this.prepareBillData(a);this.showBillToUser(c),yield this.updateInventoryFromOrder(a),yield this.forceRefreshTableStatus(e),this.closeOrderDetailsModal(),this.closeCreateOrderModal(),this.deselectTable(),setTimeout(()=>{this.verifyTableFreed(e)},1500)}catch(n){console.error("\u274C Error closing order and creating bill:",n),alert("Errore durante la chiusura del conto: "+n.message)}})}completeOrder(t){return _(this,null,function*(){try{let{error:e}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").update({status:"completed",updated_at:new Date().toISOString()}).eq("id",t);if(e)throw e;return!0}catch(e){return console.error("\u274C Error completing order:",e),!1}})}getOrderWithDetails(t){return _(this,null,function*(){try{let{data:e,error:n}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").select(`
        *,
        order_items (
          *,
          dish:dishes (
            name,
            base_price
          )
        ),
        table:tables (
          table_number,
          table_name
        )
      `).eq("id",t).single();if(n)throw n;return e}catch(e){return console.error("\u274C Error fetching order details:",e),null}})}prepareBillData(t){let e=t.order_items.map(y=>({name:y.dish?.name||"Prodotto",quantity:y.quantity,unitPrice:y.unit_price,totalPrice:y.total_price||y.quantity*y.unit_price})),n=e.reduce((y,P)=>y+P.totalPrice,0),a=t.tax_amount||0,c=t.discount_amount||0,v=t.total_amount||n+a-c;return{orderNumber:t.order_number,tableNumber:t.table?.table_number||this.selectedTable?.table_number,tableName:t.table?.table_name||this.selectedTable?.table_name,customerName:t.customer_name||"Cliente",customerPhone:t.customer_phone||"",date:new Date().toLocaleString("it-IT"),items:e,subtotal:n,taxAmount:a,discountAmount:c,totalAmount:v,paymentMethod:"Contanti"}}showBillToUser(t){let e=window.open("","_blank");e?(e.document.write(this.generateBillHTML(t)),e.document.close(),setTimeout(()=>{e.print()},500)):this.showBillInModal(t)}generateBillHTML(t){return`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Scontrino - Ordine ${t.orderNumber}</title>
      <style>
        body { 
          font-family: 'Courier New', monospace;
          font-size: 12px;
          margin: 0;
          padding: 10px;
          max-width: 300px;
        }
        .header { 
          text-align: center; 
          margin-bottom: 15px;
          border-bottom: 1px dashed #000;
          padding-bottom: 10px;
        }
        .restaurant-name { 
          font-weight: bold; 
          font-size: 14px;
        }
        .bill-info { 
          margin: 10px 0;
        }
        .items-table { 
          width: 100%; 
          border-collapse: collapse;
          margin: 10px 0;
        }
        .items-table th, 
        .items-table td { 
          padding: 3px 0;
          border-bottom: 1px dotted #ccc;
        }
        .items-table .quantity { 
          width: 20px; 
          text-align: center;
        }
        .items-table .name { 
          text-align: left;
        }
        .items-table .price { 
          text-align: right; 
          width: 70px;
        }
        .totals { 
          margin-top: 15px;
          border-top: 1px dashed #000;
          padding-top: 10px;
        }
        .total-row { 
          display: flex; 
          justify-content: space-between;
          margin: 3px 0;
        }
        .grand-total { 
          font-weight: bold; 
          font-size: 14px;
          border-top: 2px solid #000;
          padding-top: 5px;
        }
        .footer { 
          text-align: center; 
          margin-top: 20px;
          font-size: 10px;
        }
        @media print {
          body { margin: 0; }
          .no-print { display: none; }
        }
      </style>
    </head>
    <body>
      <div class="header">
        <div class="restaurant-name">IL TUO RISTORANTE</div>
        <div>Scontrino Fiscale</div>
      </div>
      
      <div class="bill-info">
        <div>Ordine: ${t.orderNumber}</div>
        <div>Tavolo: ${t.tableNumber} - ${t.tableName}</div>
        <div>Cliente: ${t.customerName}</div>
        <div>Data: ${t.date}</div>
      </div>
      
      <table class="items-table">
        <thead>
          <tr>
            <th class="quantity">Q.t\xE0</th>
            <th class="name">Descrizione</th>
            <th class="price">Importo</th>
          </tr>
        </thead>
        <tbody>
          ${t.items.map(e=>`
            <tr>
              <td class="quantity">${e.quantity}</td>
              <td class="name">${e.name}</td>
              <td class="price">\u20AC${e.totalPrice.toFixed(2)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      
      <div class="totals">
        <div class="total-row">
          <span>Subtotale:</span>
          <span>\u20AC${t.subtotal.toFixed(2)}</span>
        </div>
        ${t.taxAmount>0?`
        <div class="total-row">
          <span>IVA:</span>
          <span>\u20AC${t.taxAmount.toFixed(2)}</span>
        </div>
        `:""}
        ${t.discountAmount>0?`
        <div class="total-row">
          <span>Sconto:</span>
          <span>-\u20AC${t.discountAmount.toFixed(2)}</span>
        </div>
        `:""}
        <div class="total-row grand-total">
          <span>TOTALE:</span>
          <span>\u20AC${t.totalAmount.toFixed(2)}</span>
        </div>
      </div>
      
      <div class="footer">
        <div>Grazie e arrivederci!</div>
        <div>${new Date().getFullYear()} - Il Tuo Ristorante</div>
      </div>
      
      <div class="no-print" style="margin-top: 20px; text-align: center;">
        <button onclick="window.print()" style="padding: 10px 20px; font-size: 14px;">
          Stampa Scontrino
        </button>
        <button onclick="window.close()" style="padding: 10px 20px; font-size: 14px; margin-left: 10px;">
          Chiudi
        </button>
      </div>
    </body>
    </html>
  `}showBillInModal(t){let e=`
    <div style="font-family: monospace; padding: 20px;">
      <h3>SCONTRINO - Ordine ${t.orderNumber}</h3>
      <p><strong>Tavolo:</strong> ${t.tableNumber}</p>
      <p><strong>Cliente:</strong> ${t.customerName}</p>
      <p><strong>Data:</strong> ${t.date}</p>
      <hr>
      ${t.items.map(n=>`
        <p>${n.quantity}x ${n.name} - \u20AC${n.totalPrice.toFixed(2)}</p>
      `).join("")}
      <hr>
      <p><strong>TOTALE: \u20AC${t.totalAmount.toFixed(2)}</strong></p>
    </div>
  `;alert("Scontrino pronto per la stampa! Controlla la nuova finestra o la cronologia di stampa.")}updateInventoryFromOrder(t){return _(this,null,function*(){try{console.log("\u{1F4E6} Updating inventory from order...");for(let e of t.order_items)console.log(`Updating inventory for dish: ${e.dish_id}, quantity: ${e.quantity}`);console.log("\u2705 Inventory updated successfully")}catch(e){console.error("\u274C Error updating inventory:",e)}})}forceRefreshTableStatus(t){return _(this,null,function*(){try{console.log("\u{1F504} Force refreshing table status for:",t),yield this.loadActiveOrders(),yield this.updateTableStatuses();let e=this.tableStatuses.find(n=>n.table.id===t);console.log("\u2705 Table status after refresh:",e?.status)}catch(e){console.error("\u274C Error refreshing table status:",e)}})}verifyTableFreed(t){return _(this,null,function*(){try{let e=this.tableStatuses.find(n=>n.table.id===t);e&&e.status==="free"?console.log("\u2705 Table successfully freed:",t):(console.warn("\u26A0\uFE0F Table might not be freed properly:",t),yield this.forceRefreshAllData())}catch(e){console.error("\u274C Error verifying table freedom:",e)}})}debugOrderFlow(t){console.log("\u{1F50D} DEBUG Order Flow:"),console.log("  - Selected Table:",this.selectedTable?.table_number),console.log("  - Order ID:",t),console.log("  - Current Status:",this.selectedTableStatus?.status),console.log("  - Has Order:",!!this.selectedTableStatus?.currentOrder)}freeTableManually(){return _(this,null,function*(){if(this.selectedTable)try{if(this.selectedTableStatus?.currentOrder){let{error:t}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").update({status:"completed",updated_at:new Date().toISOString()}).eq("id",this.selectedTableStatus.currentOrder.id);if(t)throw t}yield this.loadData(),this.deselectTable(),this.showOrderDetailsModal=!1,this.showQuickActionsModal=!1,console.log("\u2705 Tavolo liberato manualmente")}catch(t){console.error("\u274C Errore nel liberare il tavolo:",t),alert("Errore durante la liberazione del tavolo")}})}updateReservation(){return _(this,null,function*(){if(this.editingReservation)try{let{error:t}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").update(G(D({},this.editingReservation),{updated_at:new Date().toISOString()})).eq("id",this.editingReservation.id);if(t)throw t;yield this.loadData(),this.closeEditReservationModal(),this.deselectTable(),console.log("\u2705 Prenotazione aggiornata")}catch(t){console.error("\u274C Errore nell'aggiornamento della prenotazione:",t),alert("Errore durante l'aggiornamento della prenotazione")}})}deleteReservation(){return _(this,null,function*(){if(this.editingReservation&&this.isReservationDeletable(this.editingReservation))try{let{error:t}=yield this.reservationService.supabaseService.getSupabaseClient().from("reservations").delete().eq("id",this.editingReservation.id);if(t)throw t;yield this.loadData(),this.closeEditReservationModal(),this.deselectTable(),console.log("\u2705 Prenotazione eliminata")}catch(t){console.error("\u274C Errore nell'eliminazione della prenotazione:",t),alert("Errore durante l'eliminazione della prenotazione")}else alert("Impossibile eliminare questa prenotazione")})}addDishesToOrder(){return _(this,null,function*(){if(this.newOrderData.items.length===0){alert("Aggiungi almeno un piatto all'ordine");return}try{let t=this.authService.currentUserValue;if(!t)throw new Error("Utente non autenticato");let{data:e}=yield this.orderService.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",t.id).limit(1);if(!e||e.length===0)throw new Error("Nessun ristorante trovato");let n=e[0].id;if(this.isAddingToExistingOrder&&this.selectedTableStatus?.currentOrder){let a=this.newOrderData.items.map(v=>({order_id:this.selectedTableStatus.currentOrder.id,dish_id:v.dish_id,quantity:v.quantity,unit_price:v.unit_price})),{error:c}=yield this.orderService.supabaseService.getSupabaseClient().from("order_items").insert(a);if(c)throw c;console.log("\u2705 Piatti aggiunti all'ordine esistente")}else{let a={restaurant_id:n,customer_id:t.id,order_number:`ORD-${Date.now()}`,order_type:"dine_in",status:"received",subtotal:this.orderTotal,tax_amount:0,discount_amount:0,total_amount:this.orderTotal,table_id:this.selectedTable?.id,customer_name:this.newOrderData.customer_name||"Cliente",customer_phone:this.newOrderData.customer_phone||""};console.log("\u{1F4E6} Creazione ordine per tavolo:",this.selectedTable?.id);let{data:c,error:v}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").insert(a).select().single();if(v)throw console.error("\u274C Errore creazione ordine:",v),v;let y=this.newOrderData.items.map(T=>({order_id:c.id,dish_id:T.dish_id,quantity:T.quantity,unit_price:T.unit_price})),{error:P}=yield this.orderService.supabaseService.getSupabaseClient().from("order_items").insert(y);if(P)throw P;console.log("\u2705 Nuovo ordine creato con ID:",c.id)}yield this.forceRefreshAllData(),this.closeCreateOrderModal()}catch(t){console.error("\u274C Errore nella creazione/aggiornamento dell'ordine:",t),alert("Errore durante la creazione dell'ordine: "+t.message)}})}forceRefreshAllData(){return _(this,null,function*(){try{console.log("\u{1F504} Forzando refresh completo dati..."),yield this.loadReservations(),yield this.loadActiveOrders(),yield this.updateTableStatuses(),this.tables=[...this.tables],this.tableStatuses=[...this.tableStatuses],console.log("\u2705 Refresh completato")}catch(t){console.error("\u274C Errore nel refresh:",t)}})}debugTableStructure(){return _(this,null,function*(){try{let{data:t,error:e}=yield this.orderService.supabaseService.getSupabaseClient().from("orders").select("*").limit(1);e?console.error("\u274C Errore nel fetch struttura:",e):console.log("\u{1F50D} Struttura tabella orders:",t)}catch(t){console.error("\u274C Errore debug:",t)}})}getOverallOrderStatus(t){if(!t||!t.order_items||t.order_items.length===0)return t?.status||"received";let e=this.orderService.calculateOverallOrderStatus(t.order_items);return e==="served"&&this.orderService.areAllItemsServed(t)?"ready_for_bill":e}getOrderStatusText(t){return{waiting:"In Attesa",preparing:"In Preparazione",ready:"Pronto",served:"Servito",ready_for_bill:"Pronto per conto",out_of_stock:"Esaurito",received:"Ricevuto"}[t]||t}getOrderStatusColor(t){return{waiting:"warning",preparing:"preparing",ready:"success",served:"secondary",ready_for_bill:"success",out_of_stock:"danger",received:"info"}[t]||"secondary"}getServedItemsCount(t){return!t||!t.order_items?0:t.order_items.filter(e=>e.status==="served").length}refreshSingleOrder(t){return _(this,null,function*(){try{yield this.loadActiveOrders(),yield this.updateTableStatuses(),this.selectedTableStatus?.currentOrder?.id===t&&(this.selectedTableStatus=D({},this.selectedTableStatus))}catch(e){console.error("Error refreshing single order:",e)}})}get readyForBillTablesCount(){return this.tableStatuses.filter(t=>t.status==="occupied"&&t.currentOrder&&this.orderService.areAllItemsServed(t.currentOrder)).length}safeToggleFullscreen(){return _(this,null,function*(){if(this.isEnteringFullscreen){console.log("\u26A0\uFE0F Fullscreen operation already in progress");return}this.isEnteringFullscreen=!0;try{this.isFullscreen?yield this.exitFullscreen():yield this.enterFullscreen()}catch(t){console.error("\u274C Error in safeToggleFullscreen:",t),alert("Errore durante la modifica della modalit\xE0 schermo intero: "+t.message)}finally{setTimeout(()=>{this.isEnteringFullscreen=!1},1e3)}})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=K({type:s,selectors:[["app-table-map"]],viewQuery:function(e,n){if(e&1&&X(Re,5),e&2){let a;Z(a=ee())&&(n.mapContainer=a.first)}},decls:118,vars:25,consts:[["mapContainer",""],["reservationForm","ngForm"],[1,"table-map-container","page-container"],[1,"section-header"],[1,"header-icon"],[1,"material-icons"],[1,"section-titles"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-content"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"filters-section"],[1,"filters-container"],[1,"filter-group"],[1,"form-label"],[1,"form-input",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-input",3,"ngModelChange","ngModel"],["value","all"],["value","free"],["value","reserved"],["value","occupied"],["type","text","placeholder","Numero o nome tavolo...",1,"form-input",3,"ngModelChange","ngModel"],[1,"actions-container"],[1,"promethea-button","primary",3,"click"],[1,"map-section"],[1,"form-section"],[1,"map-legend"],[1,"legend-item"],[1,"legend-color","free"],[1,"legend-color","reserved"],[1,"legend-color","occupied"],[1,"fullscreen-btn",3,"click"],[1,"canvas-container"],[1,"floor-plan-canvas"],[1,"grid-overlay"],["class","table-element",3,"class","ngStyle","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","modal-overlay quick-actions",3,"click",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"ngValue"],[1,"table-element",3,"click","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-details"],[1,"table-capacity"],[1,"table-status-badge"],["class","table-info",4,"ngIf"],[1,"table-info"],[1,"empty-state"],[1,"modal-overlay","quick-actions",3,"click"],[1,"modal-container","quick-actions",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"modal-close",3,"click"],[1,"modal-body"],[1,"quick-actions-content"],[1,"status-info"],[1,"chip"],[1,"action-buttons"],["class","multiple-actions",4,"ngIf"],["class","emergency-actions",4,"ngIf"],[1,"multiple-actions"],[1,"promethea-button","success",3,"click"],[1,"promethea-button","secondary",3,"click"],[1,"promethea-button",3,"click"],[1,"emergency-actions"],[1,"promethea-button","ghost",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-md",3,"click"],[1,"generic-form",3,"ngSubmit"],[1,"form-group"],["type","text","name","customer_name","required","","placeholder","Inserisci il nome del cliente",1,"form-input",3,"ngModelChange","ngModel"],["type","tel","name","customer_phone","required","","placeholder","Inserisci il telefono",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-row"],["type","date","name","reservation_date","required","",1,"form-input",3,"ngModelChange","ngModel"],["type","time","name","reservation_time","required","",1,"form-input",3,"ngModelChange","ngModel"],["name","party_size","required","",1,"form-input",3,"ngModelChange","ngModel"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"form-text"],["name","special_requests","rows","3","placeholder","Note o richieste speciali...",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"right-actions"],["type","button",1,"promethea-button","secondary",3,"click"],["type","submit",1,"promethea-button","primary",3,"click","disabled"],[3,"value","disabled"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],["type","button",1,"promethea-button","danger",3,"click"],[1,"modal-container","modal-lg",3,"click"],[1,"order-creation-layout"],[1,"menu-section"],[1,"subsection-title"],[1,"dishes-grid"],["class","dish-card",3,"click",4,"ngFor","ngForOf"],[1,"order-summary-section"],["class","reservation-info",4,"ngIf"],["class","order-items",4,"ngIf"],["class","empty-order",4,"ngIf"],["class","order-total",4,"ngIf"],[1,"order-actions"],[1,"promethea-button","success",3,"click","disabled"],["class","instructions",4,"ngIf"],[1,"dish-card",3,"click"],[1,"item-info"],[1,"dish-price"],["class","dish-description text-muted",4,"ngIf"],[1,"dish-description","text-muted"],[1,"reservation-info"],[1,"info-item"],[1,"contact-info"],[1,"info-label"],[1,"info-value"],[1,"order-items"],["class","order-item",4,"ngFor","ngForOf"],[1,"order-item"],[1,"item-price"],[1,"item-controls"],[1,"quantity-btn",3,"click"],[1,"quantity"],[1,"remove-btn",3,"click"],[1,"empty-order"],[1,"text-muted","small"],[1,"order-total"],[1,"instructions"],["class","chip success","style","margin-left: 10px;",4,"ngIf"],[4,"ngIf"],[1,"promethea-button","warning",3,"click"],[1,"chip","success",2,"margin-left","10px"],[1,"order-info"],[1,"info-value","chip"],[1,"order-items-list"],["class","order-item-detail",4,"ngFor","ngForOf"],[1,"order-item-detail"],[1,"item-name"],[1,"item-status","chip","small"],[1,"item-details"],[1,"item-quantity"]],template:function(e,n){if(e&1){let a=w();i(0,"div",2)(1,"div",3)(2,"div",4)(3,"span",5),o(4,"map"),r()(),i(5,"div",6)(6,"h1",7),o(7,"Mappa Tavoli - Gestione Ristorante"),r(),i(8,"p",8),o(9,"Gestisci prenotazioni e ordini in tempo reale"),r()()(),i(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"span",5),o(15,"event_available"),r(),i(16,"div",13),o(17,"Tavoli Liberi"),r()(),i(18,"div",14),o(19),r()()(),i(20,"div",10)(21,"div",11)(22,"div",12)(23,"span",5),o(24,"event"),r(),i(25,"div",13),o(26,"Prenotati"),r()(),i(27,"div",14),o(28),r()()(),i(29,"div",10)(30,"div",11)(31,"div",12)(32,"span",5),o(33,"restaurant"),r(),i(34,"div",13),o(35,"Occupati"),r()(),i(36,"div",14),o(37),r()()(),i(38,"div",10)(39,"div",11)(40,"div",12)(41,"span",5),o(42,"table_restaurant"),r(),i(43,"div",13),o(44,"Tavoli Totali"),r()(),i(45,"div",14),o(46),r()()(),i(47,"div",10)(48,"div",11)(49,"div",12)(50,"span",5),o(51,"receipt"),r(),i(52,"div",13),o(53,"Pronti per conto"),r()(),i(54,"div",14),o(55),r()()()(),i(56,"div",15)(57,"div",16)(58,"div",17)(59,"label",18),o(60,"Mappa:"),r(),i(61,"select",19),S("ngModelChange",function(v){return u(a),x(n.currentFloorPlan,v)||(n.currentFloorPlan=v),m(v)}),p("change",function(){return u(a),m(n.onFloorPlanSelect(n.currentFloorPlan))}),h(62,Ve,2,2,"option",20),r()(),i(63,"div",17)(64,"label",18),o(65,"Stato:"),r(),i(66,"select",21),S("ngModelChange",function(v){return u(a),x(n.statusFilter,v)||(n.statusFilter=v),m(v)}),i(67,"option",22),o(68,"Tutti gli stati"),r(),i(69,"option",23),o(70,"Libero"),r(),i(71,"option",24),o(72,"Prenotato"),r(),i(73,"option",25),o(74,"Occupato"),r()()(),i(75,"div",17)(76,"label",18),o(77,"Cerca:"),r(),i(78,"input",26),S("ngModelChange",function(v){return u(a),x(n.searchTerm,v)||(n.searchTerm=v),m(v)}),r()()(),i(79,"div",27)(80,"button",28),p("click",function(){return u(a),m(n.loadData())}),i(81,"span",5),o(82,"refresh"),r(),o(83," Aggiorna "),r()()(),i(84,"div",29,0)(86,"div",30)(87,"div",12)(88,"h2",13),o(89),r(),i(90,"div",31)(91,"div",32),R(92,"div",33),i(93,"span"),o(94,"Libero"),r()(),i(95,"div",32),R(96,"div",34),i(97,"span"),o(98,"Prenotato"),r()(),i(99,"div",32),R(100,"div",35),i(101,"span"),o(102,"Occupato"),r()()(),i(103,"button",36),p("click",function(){return u(a),m(n.safeToggleFullscreen())}),i(104,"span",5),o(105),r(),o(106),r()(),i(107,"div",11)(108,"div",37)(109,"div",38),R(110,"div",39),h(111,ze,11,10,"div",40)(112,Ae,7,0,"div",41),r()()()(),h(113,Be,18,8,"div",42)(114,je,50,11,"div",43)(115,He,50,12,"div",43)(116,nt,38,9,"div",43)(117,ot,22,6,"div",43),r()()}e&2&&(l(19),M(n.freeTablesCount),l(9),M(n.reservedTablesCount),l(9),M(n.occupiedTablesCount),l(9),M(n.totalTablesCount),l(9),M(n.readyForBillTablesCount),l(6),f("ngModel",n.currentFloorPlan),l(),g("ngForOf",n.floorPlans),l(4),f("ngModel",n.statusFilter),l(12),f("ngModel",n.searchTerm),l(11),M((n.currentFloorPlan==null?null:n.currentFloorPlan.name)||"Mappa"),l(14),N("active",n.isFullscreen),l(2),b(" ",n.isFullscreen?"fullscreen_exit":"fullscreen"," "),l(),b(" ",n.isFullscreen?"Esci":"Schermo intero",`
`),l(3),te("width",(n.currentFloorPlan==null?null:n.currentFloorPlan.width)||1e3,"px")("height",(n.currentFloorPlan==null?null:n.currentFloorPlan.height)||800,"px"),l(2),g("ngForOf",n.getFilteredTables()),l(),g("ngIf",n.getFilteredTables().length===0),l(),g("ngIf",n.showQuickActionsModal),l(),g("ngIf",n.showManualReservationModal),l(),g("ngIf",n.showEditReservationModal),l(),g("ngIf",n.showCreateOrderModal),l(),g("ngIf",n.showOrderDetailsModal))},dependencies:[ce,ie,re,ae,we,he,xe,Se,pe,fe,ge,_e,Ce,be,ve,se,le,oe],styles:[".table-map-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-lg)}.stats-grid.grid-cards[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--gutter-md)}.stat-card.card[_ngcontent-%COMP%]{flex-direction:row;align-items:center;padding:var(--gutter-md);gap:var(--gutter-md);min-height:100px}.stat-icon[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.stat-icon.free[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 15%,transparent)}.stat-icon.reserved[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 15%,transparent)}.stat-icon.occupied[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 15%,transparent)}.stat-icon.total[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--text-color) 15%,transparent)}.stat-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:24px;color:var(--text-color)}.stat-content[_ngcontent-%COMP%]{flex:1}.stat-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:var(--fs-md);line-height:1}.stat-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:var(--fs-sm)}.map-section[_ngcontent-%COMP%]{width:100%;height:70vh;min-height:600px;display:flex;flex-direction:column}.canvas-container[_ngcontent-%COMP%]{border:1px solid var(--smoke-color-1);border-radius:12px;background:var(--background);overflow:auto}.floor-plan-canvas[_ngcontent-%COMP%]{position:relative;background:color-mix(in srgb,var(--background) 98%,white);min-width:min-content;min-height:min-content;margin:var(--gutter-md)}.grid-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-image:linear-gradient(var(--smoke-color-1) 1px,transparent 1px),linear-gradient(90deg,var(--smoke-color-1) 1px,transparent 1px);background-size:40px 40px;opacity:.3;pointer-events:none}.table-element[_ngcontent-%COMP%]{position:absolute;border:2px solid;border-radius:12px;cursor:pointer;transition:all .3s cubic-bezier(.2,.9,.2,1);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px var(--shadow);min-width:80px;min-height:80px}.table-element[_ngcontent-%COMP%]:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 8px 20px var(--shadow2)}.table-element.free[_ngcontent-%COMP%]{border-color:#10b981;background:color-mix(in srgb,#10b981 8%,transparent)}.table-element.reserved[_ngcontent-%COMP%]{border-color:#f59e0b;background:color-mix(in srgb,#f59e0b 8%,transparent)}.table-element.occupied[_ngcontent-%COMP%]{border-color:#ef4444;background:color-mix(in srgb,#ef4444 8%,transparent)}.table-element.selected[_ngcontent-%COMP%]{border-width:3px;box-shadow:0 0 0 3px color-mix(in srgb,var(--primary) 20%,transparent),0 8px 25px var(--shadow2);z-index:100}.table-content[_ngcontent-%COMP%]{text-align:center;padding:8px 4px;width:100%;display:flex;flex-direction:column;gap:2px}.table-number[_ngcontent-%COMP%]{font-weight:800;font-size:14px;color:var(--text-color);line-height:1;margin-bottom:2px}.table-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:4px;padding:0 4px;margin-bottom:2px}.table-capacity[_ngcontent-%COMP%]{font-size:10px;color:var(--text-muted);font-weight:600;line-height:1}.table-status-badge[_ngcontent-%COMP%]{font-size:9px;font-weight:700;text-transform:uppercase;line-height:1;padding:2px 4px;border-radius:4px}.status-free[_ngcontent-%COMP%]{color:#10b981;background:color-mix(in srgb,#10b981 15%,transparent)}.status-reserved[_ngcontent-%COMP%]{color:#f59e0b;background:color-mix(in srgb,#f59e0b 15%,transparent)}.status-occupied[_ngcontent-%COMP%]{color:#ef4444;background:color-mix(in srgb,#ef4444 15%,transparent)}.status-needs-attention[_ngcontent-%COMP%]{color:#8b5cf6;background:color-mix(in srgb,#8b5cf6 15%,transparent)}.table-info[_ngcontent-%COMP%]{font-size:8px;color:var(--text-muted);line-height:1.1;padding:0 4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.map-legend[_ngcontent-%COMP%]{display:flex;gap:var(--gutter-md);flex-wrap:wrap;align-items:center}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:4px 8px;border-radius:6px;background:var(--smoke-color-1)}.legend-color[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:4px;border:2px solid;flex-shrink:0}.legend-color.free[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 15%,transparent);border-color:#10b981}.legend-color.reserved[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 15%,transparent);border-color:#f59e0b}.legend-color.occupied[_ngcontent-%COMP%]{background:color-mix(in srgb,#ef4444 15%,transparent);border-color:#ef4444}.legend-color.selected[_ngcontent-%COMP%]{background:var(--primary);border-color:var(--primary)}.quick-actions-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md)}.quick-actions-content[_ngcontent-%COMP%]   .multiple-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.quick-actions-content[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-md)}.emergency-actions[_ngcontent-%COMP%]{border-top:1px solid var(--smoke-color-1);padding-top:var(--gutter-md);margin-top:var(--gutter-sm)}.order-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}@media (max-width: 768px){.stats-grid.grid-cards[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}.stat-card.card[_ngcontent-%COMP%]{min-height:80px;padding:var(--gutter-sm)}.stat-icon[_ngcontent-%COMP%]{width:44px;height:44px}.map-legend[_ngcontent-%COMP%]{justify-content:center}.table-details[_ngcontent-%COMP%]{flex-direction:column;gap:2px}.table-content[_ngcontent-%COMP%]{padding:6px 3px;gap:1px}.table-number[_ngcontent-%COMP%]{font-size:12px}.table-capacity[_ngcontent-%COMP%], .table-status-badge[_ngcontent-%COMP%]{font-size:8px}}@media (max-width: 480px){.stats-grid.grid-cards[_ngcontent-%COMP%]{grid-template-columns:1fr}.map-legend[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:var(--gutter-sm)}.table-element[_ngcontent-%COMP%]{min-width:70px;min-height:70px}}.fullscreen-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:6px;margin-right:12px;border-radius:8px;display:flex;align-items:center;transition:.2s}.fullscreen-btn[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1)}[_ngcontent-%COMP%]:fullscreen   .modal[_ngcontent-%COMP%]{position:fixed;z-index:999999}.table-element.small-table[_ngcontent-%COMP%]{min-width:60px;min-height:60px}.table-element.small-table[_ngcontent-%COMP%]   .table-content[_ngcontent-%COMP%]{padding:4px 2px;gap:1px}.table-element.small-table[_ngcontent-%COMP%]   .table-number[_ngcontent-%COMP%]{font-size:11px}.table-element.small-table[_ngcontent-%COMP%]   .table-capacity[_ngcontent-%COMP%], .table-element.small-table[_ngcontent-%COMP%]   .table-status-badge[_ngcontent-%COMP%]{font-size:7px}.table-element.small-table[_ngcontent-%COMP%]   .table-info[_ngcontent-%COMP%]{font-size:6px}@media (max-width: 480px){.table-info[_ngcontent-%COMP%]{display:none}}.canvas-container[_ngcontent-%COMP%]:fullscreen{width:100vw;height:100vh;background:var(--background);display:flex;align-items:center;justify-content:center;padding:20px}.canvas-container[_ngcontent-%COMP%]:fullscreen   .floor-plan-canvas[_ngcontent-%COMP%]{margin:0;border:2px solid var(--smoke-color-1);border-radius:12px;box-shadow:0 8px 32px var(--shadow2);max-width:95%;max-height:95%}[_ngcontent-%COMP%]:fullscreen   .fullscreen-controls[_ngcontent-%COMP%]{z-index:10001!important}.fullscreen-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;background:var(--background);border:1px solid var(--smoke-color-1);border-radius:8px;color:var(--text-color);cursor:pointer;transition:all .3s ease;font-size:var(--fs-sm);font-weight:500}.fullscreen-btn[_ngcontent-%COMP%]:hover{background:var(--smoke-color-1);border-color:var(--primary);color:var(--primary)}.fullscreen-btn.active[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-color:var(--primary)}.fullscreen-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:18px}.fullscreen-controls[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;z-index:10010;display:none}.canvas-container[_ngcontent-%COMP%]:fullscreen ~ .fullscreen-controls[_ngcontent-%COMP%], .canvas-container[_ngcontent-%COMP%]:-webkit-full-screen ~ .fullscreen-controls[_ngcontent-%COMP%], .canvas-container[_ngcontent-%COMP%]:-moz-full-screen ~ .fullscreen-controls[_ngcontent-%COMP%], .canvas-container[_ngcontent-%COMP%]:-ms-fullscreen ~ .fullscreen-controls[_ngcontent-%COMP%]{display:block}[_ngcontent-%COMP%]:fullscreen   .modal-overlay[_ngcontent-%COMP%], [_ngcontent-%COMP%]:-webkit-full-screen   .modal-overlay[_ngcontent-%COMP%], [_ngcontent-%COMP%]:-moz-full-screen   .modal-overlay[_ngcontent-%COMP%], [_ngcontent-%COMP%]:-ms-fullscreen   .modal-overlay[_ngcontent-%COMP%]{z-index:10020!important}.canvas-container[_ngcontent-%COMP%]:fullscreen{background:var(--background)}.canvas-container[_ngcontent-%COMP%]:fullscreen   .floor-plan-canvas[_ngcontent-%COMP%]{max-width:95%;max-height:95%}.card-title[_ngcontent-%COMP%]{margin:0}@media (max-width: 768px){.fullscreen-btn[_ngcontent-%COMP%]{padding:6px 12px;font-size:.8rem}.fullscreen-btn[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:16px}.canvas-container[_ngcontent-%COMP%]:fullscreen   .floor-plan-canvas[_ngcontent-%COMP%]{max-width:98%;max-height:98%}}.canvas-container[_ngcontent-%COMP%]:-webkit-full-screen{width:100vw;height:100vh;background:var(--background)}.canvas-container[_ngcontent-%COMP%]:-moz-full-screen{width:100vw;height:100vh;background:var(--background)}.canvas-container[_ngcontent-%COMP%]:-ms-fullscreen{width:100vw;height:100vh;background:var(--background)}.card-number[_ngcontent-%COMP%]{text-align:center}.item-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:var(--gutter-sm);align-items:center;padding:var(--gutter-sm)}.dish-description[_ngcontent-%COMP%]{padding:0 var(--gutter-sm)}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10000;margin:0;border-radius:0;background:var(--background)}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;background:var(--background);z-index:10001;padding:var(--gutter-md);border-bottom:1px solid var(--smoke-color-1);box-shadow:0 2px 10px var(--shadow)}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{position:fixed;inset:80px 0 0;padding:0}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--background);overflow:auto}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{transform-origin:center center;transition:transform .3s ease;border:2px solid var(--smoke-color-1);border-radius:12px;background:var(--background);box-shadow:0 8px 32px var(--shadow2)}.fullscreen-btn.active[_ngcontent-%COMP%]{background:var(--primary);color:#fff}.fullscreen-btn.active[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--primary) 90%,black)}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%] ~ .modal-overlay[_ngcontent-%COMP%]{z-index:10002}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%] ~ .modal-overlay[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]{z-index:10003}.canvas-container[_ngcontent-%COMP%]:fullscreen{background:var(--background);display:flex;align-items:center;justify-content:center;padding:20px}.canvas-container[_ngcontent-%COMP%]:fullscreen   .floor-plan-canvas[_ngcontent-%COMP%]{max-width:95%;max-height:95%;box-shadow:0 10px 40px var(--shadow2)}.canvas-container[_ngcontent-%COMP%]:-webkit-full-screen{background:var(--background);display:flex;align-items:center;justify-content:center;padding:20px}.canvas-container[_ngcontent-%COMP%]:-moz-full-screen{background:var(--background);display:flex;align-items:center;justify-content:center;padding:20px}.canvas-container[_ngcontent-%COMP%]:-ms-fullscreen{background:var(--background);display:flex;align-items:center;justify-content:center;padding:20px}@keyframes _ngcontent-%COMP%_fullscreenEnter{0%{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fullscreenEnter .3s ease-out}@media (max-width: 768px){.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:var(--gutter-sm);flex-wrap:wrap;gap:var(--gutter-sm)}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{top:120px}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .map-legend[_ngcontent-%COMP%]{order:3;width:100%;justify-content:center;margin-top:var(--gutter-sm)}}.map-section[_ngcontent-%COMP%]   .card.fullscreen-mode[_ngcontent-%COMP%]   .table-element[_ngcontent-%COMP%]:hover{transform:scale(1.05);z-index:10;box-shadow:0 4px 20px var(--shadow2)}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--smoke-color-1);border-radius:4px}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--primary);border-radius:4px}.canvas-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:color-mix(in srgb,var(--primary) 80%,black)}.map-section.fullscreen-mode[_ngcontent-%COMP%]{position:fixed!important;top:0!important;left:0!important;width:100vw!important;height:100vh!important;z-index:9999!important;background:var(--background);padding:20px;margin:0!important}.map-section.fullscreen-mode[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{height:100%!important;margin:0!important;border:none!important;box-shadow:none!important}.map-section.fullscreen-mode[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{height:calc(100vh - 100px)!important;padding:0!important}.map-section.fullscreen-mode[_ngcontent-%COMP%]   .canvas-container[_ngcontent-%COMP%]{height:100%!important;width:100%!important}.map-section.fullscreen-mode[_ngcontent-%COMP%]   .floor-plan-canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-width:none!important;max-height:none!important;border:2px solid #ddd}.map-section[_ngcontent-%COMP%]:fullscreen{width:100vw!important;height:100vh!important;background:var(--background);padding:20px}.map-section[_ngcontent-%COMP%]:fullscreen   .card[_ngcontent-%COMP%]{height:100%!important;margin:0!important;border:none!important}.map-section[_ngcontent-%COMP%]:fullscreen   .card-content[_ngcontent-%COMP%]{height:calc(100vh - 100px)!important}.map-section[_ngcontent-%COMP%]:fullscreen   .canvas-container[_ngcontent-%COMP%]{height:100%!important}.map-section[_ngcontent-%COMP%]:-webkit-full-screen{width:100vw!important;height:100vh!important;background:var(--background);padding:20px}.map-section[_ngcontent-%COMP%]:-moz-full-screen{width:100vw!important;height:100vh!important;background:var(--background);padding:20px}.map-section[_ngcontent-%COMP%]:-ms-fullscreen{width:100vw!important;height:100vh!important;background:var(--background);padding:20px}.map-section.fullscreen-mode[_ngcontent-%COMP%]   .modal-overlay[_ngcontent-%COMP%], .map-section[_ngcontent-%COMP%]:fullscreen   .modal-overlay[_ngcontent-%COMP%]{position:fixed!important;z-index:10000!important}.fullscreen-controls[_ngcontent-%COMP%]{display:none}.map-section.fullscreen-mode[_ngcontent-%COMP%]   .fullscreen-controls[_ngcontent-%COMP%], .map-section[_ngcontent-%COMP%]:fullscreen   .fullscreen-controls[_ngcontent-%COMP%]{display:block;position:fixed;bottom:20px;right:20px;z-index:10001}"]})};export{Ee as TableMap};
