import{a as ie}from"./chunk-JB4EPMR7.js";import{a as oe}from"./chunk-6YDTSELL.js";import{a as ne}from"./chunk-SKQHRKMJ.js";import{a as te}from"./chunk-QUWZEZHV.js";import{a as z,b as U,c as C,d as G,e as L,f as B,i as Q,j as W,m as $,n as Y,o as R,p as j,q as H,r as J,s as K,u as X,w as Z,y as ee}from"./chunk-XWCDBJ2K.js";import{c as T,d as D,i as A,l as q,o as M,q as O}from"./chunk-COP7W333.js";import{A as P,Fb as N,Ib as l,Ja as s,Jb as I,Kb as u,Lb as k,Wb as h,Yb as y,Za as V,cb as p,ga as F,h as S,kb as d,la as _,lb as r,ma as f,mb as n,nb as b,tb as E,wb as v,yb as m}from"./chunk-2FS7XGGJ.js";function le(a,t){a&1&&(r(0,"span"),l(1,"(Predefinita)"),n())}function se(a,t){if(a&1&&(r(0,"option",44),l(1),p(2,le,2,0,"span",45),n()),a&2){let e=t.$implicit;d("value",e.id),s(),u(" ",e.name," "),s(),d("ngIf",e.is_default)}}function de(a,t){a&1&&(r(0,"div",46),l(1," La categoria \xE8 obbligatoria "),n())}function ce(a,t){if(a&1){let e=E();r(0,"div",10)(1,"label",38)(2,"span",3),l(3,"category"),n(),l(4," Categoria * "),n(),r(5,"div",18)(6,"select",39)(7,"option",40),l(8,"Seleziona una categoria"),n(),p(9,se,3,3,"option",41),n(),r(10,"button",42),v("click",function(){_(e);let o=m();return f(o.toggleNewCategoryForm())}),r(11,"span",3),l(12,"add"),n()()(),p(13,de,2,0,"div",43),n()}if(a&2){let e,i=m();s(6),d("disabled",i.showNewCategoryForm),s(3),d("ngForOf",i.categories),s(),d("disabled",i.showNewCategoryForm),s(3),d("ngIf",((e=i.foodCostForm.get("category_id"))==null?null:e.invalid)&&((e=i.foodCostForm.get("category_id"))==null?null:e.touched))}}function me(a,t){if(a&1&&(r(0,"option",44),l(1),n()),a&2){let e=t.$implicit;d("value",e.id),s(),k(" ",e.name," (",e.symbol,") ")}}function ue(a,t){a&1&&(r(0,"div",46),l(1," L'unit\xE0 di misura \xE8 obbligatoria "),n())}function ge(a,t){if(a&1){let e=E();r(0,"div",10)(1,"label",47)(2,"span",3),l(3,"straighten"),n(),l(4," Unit\xE0 di Misura * "),n(),r(5,"select",48),v("change",function(){_(e);let o=m();return f(o.manualCalculateCost())}),r(6,"option",40),l(7,"Seleziona unit\xE0"),n(),p(8,me,2,3,"option",41),n(),p(9,ue,2,0,"div",43),n()}if(a&2){let e,i=m();s(8),d("ngForOf",i.filteredUnits),s(),d("ngIf",((e=i.foodCostForm.get("unit_id"))==null?null:e.invalid)&&((e=i.foodCostForm.get("unit_id"))==null?null:e.touched))}}function pe(a,t){if(a&1){let e=E();r(0,"div",9)(1,"div",10)(2,"label",49)(3,"span",3),l(4,"timer"),n(),l(5," Tempo di Preparazione (minuti) "),n(),b(6,"input",50),n(),r(7,"div",10)(8,"label",51)(9,"span",3),l(10,"euro"),n(),l(11," Prezzo di Vendita * "),n(),r(12,"input",52),v("change",function(){_(e);let o=m();return f(o.manualCalculateCost())}),n()()()}}function _e(a,t){if(a&1&&(r(0,"small",5),l(1),n()),a&2){let e,i=m(2);s(),u(" in ",i.getUnitSymbol((e=i.foodCostForm.get("unit_id"))==null?null:e.value)," ")}}function fe(a,t){if(a&1&&(r(0,"span"),l(1),h(2,"number"),n()),a&2){let e=m(3);s(),u(" (\u2248 ",y(2,1,e.totalWeightGrams/1e3,"1.3-3")," kg) ")}}function ve(a,t){if(a&1&&(r(0,"div",59),l(1),h(2,"number"),p(3,fe,3,4,"span",45),n()),a&2){let e,i=m(2);s(),u(" Peso totale ingredienti: ",y(2,2,i.totalWeightGrams,"1.0-0")," g "),s(2),d("ngIf",i.getUnitSymbol((e=i.foodCostForm.get("unit_id"))==null?null:e.value)==="kg")}}function Ce(a,t){a&1&&(r(0,"div",46),l(1," La quantit\xE0 prodotta deve essere maggiore di 0 "),n())}function he(a,t){if(a&1){let e=E();r(0,"div",9)(1,"div",10)(2,"label",53)(3,"span",3),l(4,"numbers"),n(),l(5," Quantit\xE0 Prodotta * "),n(),r(6,"input",54),v("change",function(){_(e);let o=m();return f(o.manualCalculateCost())}),n(),p(7,_e,2,1,"small",55)(8,ve,4,5,"div",56)(9,Ce,2,0,"div",43),n(),r(10,"div",10)(11,"label",57)(12,"span",3),l(13,"euro"),n(),l(14),n(),b(15,"input",58),n()()}if(a&2){let e,i,o,c,g=m();s(7),d("ngIf",(e=g.foodCostForm.get("unit_id"))==null?null:e.value),s(),d("ngIf",g.totalWeightGrams>0&&((i=g.foodCostForm.get("unit_id"))==null?null:i.value)),s(),d("ngIf",((o=g.foodCostForm.get("yield_quantity"))==null?null:o.invalid)&&((o=g.foodCostForm.get("yield_quantity"))==null?null:o.touched)),s(5),u(" Costo per ",g.getUnitSymbol((c=g.foodCostForm.get("unit_id"))==null?null:c.value)||"unit\xE0"," ")}}function ye(a,t){if(a&1&&(r(0,"span"),l(1),h(2,"number"),n()),a&2){let e=m().$implicit;s(),k(" (\u20AC",y(2,2,e.cost_per_unit,"1.2-2"),"/",e.units.symbol,") ")}}function xe(a,t){if(a&1&&(r(0,"option",44),l(1),p(2,ye,3,5,"span",45),n()),a&2){let e=t.$implicit;d("value",e.name),s(),u(" ",e.name," "),s(),d("ngIf",e.unit_id&&e.units)}}function be(a,t){if(a&1&&(r(0,"option",44),l(1),n()),a&2){let e=t.$implicit;d("value",e.id),s(),u(" ",e.name," ")}}function Fe(a,t){if(a&1&&(r(0,"span",68),l(1),n()),a&2){let e,i=m().$implicit,o=m();s(),u(" ",o.getQuantityUnitLabel((e=i.get("ingredient_id"))==null?null:e.value)," ")}}function Ee(a,t){if(a&1){let e=E();r(0,"div",60)(1,"div",23)(2,"input",61),v("input",function(o){let c=_(e).index,g=m();return f(g.onIngredientSelected(o,c))})("blur",function(o){let c=_(e).index,g=m();return f(g.onIngredientSelected(o,c))})("change",function(){_(e);let o=m();return f(o.manualCalculateCost())}),n(),r(3,"datalist",62),p(4,xe,3,3,"option",41),n(),r(5,"select",63)(6,"option",40),l(7,"Seleziona un ingrediente"),n(),p(8,be,2,2,"option",41),n()(),r(9,"div",24)(10,"div",64)(11,"input",65),v("change",function(){_(e);let o=m();return f(o.manualCalculateCost())}),n(),p(12,Fe,2,1,"span",66),n()(),r(13,"div",25),l(14),h(15,"number"),n(),r(16,"div",26)(17,"button",67),v("click",function(){let o=_(e).index,c=m();return f(c.removeIngredient(o))}),r(18,"span",3),l(19,"delete"),n()()()()}if(a&2){let e,i,o,c=t.$implicit,g=t.index,x=m();d("formGroupName",g),s(2),d("value",x.getIngredientName((e=c.get("ingredient_id"))==null?null:e.value)),s(2),d("ngForOf",x.ingredients),s(4),d("ngForOf",x.ingredients),s(4),d("ngIf",(i=c.get("ingredient_id"))==null?null:i.value),s(2),u(" \u20AC",y(15,6,(o=c.get("cost"))==null?null:o.value,"1.2-2")," ")}}function Se(a,t){if(a&1&&(r(0,"div",32)(1,"div",33),l(2),h(3,"number"),n(),r(4,"div",69),l(5," Food Cost "),n()()),a&2){let e=m();s(2),u("",y(3,5,e.getFoodCostPercentage(),"1.1-1"),"%"),s(2),N("text-red-500",e.getFoodCostPercentage()>35)("text-green-500",e.getFoodCostPercentage()<=35)}}function Ie(a,t){if(a&1&&(r(0,"div",32)(1,"div",33),l(2),h(3,"number"),n(),r(4,"div",34),l(5,"Prezzo Suggerito"),n()()),a&2){let e=m();s(2),u("\u20AC",y(3,1,e.suggestedPrice,"1.2-2"))}}function we(a,t){if(a&1&&(r(0,"div",32)(1,"div",33),l(2),h(3,"number"),n(),r(4,"div",34),l(5,"Margine"),n()()),a&2){let e,i=m();s(2),u("\u20AC",y(3,1,((e=i.foodCostForm.get("sellingPrice"))==null?null:e.value)-i.totalCost,"1.2-2"))}}function Pe(a,t){if(a&1&&(r(0,"div",32)(1,"div",33),l(2),h(3,"number"),n(),r(4,"div",34),l(5),n()()),a&2){let e,i,o=m();s(2),u("\u20AC",y(3,2,o.totalCost/(((e=o.foodCostForm.get("yield_quantity"))==null?null:e.value)||1),"1.3-3")),s(3),u("Costo per ",o.getUnitSymbol((i=o.foodCostForm.get("unit_id"))==null?null:i.value)||"unit\xE0")}}function ke(a,t){if(a&1&&(r(0,"div",32)(1,"div",33),l(2),h(3,"number"),n(),r(4,"div",34),l(5),n()()),a&2){let e,i,o=m();s(2),I(y(3,2,(e=o.foodCostForm.get("yield_quantity"))==null?null:e.value,"1.0-3")),s(3),u("",o.getUnitSymbol((i=o.foodCostForm.get("unit_id"))==null?null:i.value)||"unit\xE0"," prodotte")}}function Ve(a,t){a&1&&(r(0,"div",73)(1,"label",74),l(2,"Quantit\xE0 da acquistare"),n(),b(3,"input",75),n())}function Ne(a,t){if(a&1&&(r(0,"div",9)(1,"div",64),b(2,"input",70),r(3,"label",71)(4,"strong"),l(5,"Da acquistare"),n(),r(6,"div",5),l(7,"Segna questo ingrediente come da acquistare"),n()()(),p(8,Ve,4,0,"div",72),n()),a&2){let e,i=m();s(8),d("ngIf",(e=i.foodCostForm.get("to_buy"))==null?null:e.value)}}function Te(a,t){a&1&&(r(0,"div",46),l(1," Il nome \xE8 obbligatoria "),n())}function De(a,t){a&1&&(r(0,"span",3),l(1,"hourglass_empty"),n())}function Ae(a,t){a&1&&(r(0,"span",3),l(1,"check"),n())}function qe(a,t){if(a&1){let e=E();r(0,"div",76),v("click",function(){_(e);let o=m();return f(o.toggleNewCategoryForm())}),r(1,"div",77),v("click",function(o){return _(e),f(o.stopPropagation())}),r(2,"div",78)(3,"div",79)(4,"div",80)(5,"span",3),l(6,"add_circle"),n()(),r(7,"div")(8,"h1",4),l(9,"Nuova Categoria"),n()()(),r(10,"button",81),v("click",function(){_(e);let o=m();return f(o.toggleNewCategoryForm())}),r(11,"span",3),l(12,"close"),n()()(),r(13,"div",82)(14,"div",83)(15,"div",84)(16,"label",85),l(17,"Nome Categoria *"),n(),b(18,"input",86),p(19,Te,2,0,"div",43),n(),r(20,"div",84)(21,"label",87),l(22,"Descrizione"),n(),b(23,"textarea",88),n(),r(24,"div",89)(25,"label",90),b(26,"input",91),r(27,"div",92)(28,"strong"),l(29,"Imposta come categoria predefinita"),n(),r(30,"div",5),l(31,"Questa categoria sar\xE0 selezionata automaticamente per i nuovi piatti"),n()()()()()(),r(32,"div",93)(33,"button",94),v("click",function(){_(e);let o=m();return f(o.toggleNewCategoryForm())}),r(34,"span",3),l(35,"close"),n(),l(36," Annulla "),n(),r(37,"button",95),v("click",function(){_(e);let o=m();return f(o.onCreateCategory())}),p(38,De,2,0,"span",96)(39,Ae,2,0,"span",96),l(40),n()()()()}if(a&2){let e,i=m();s(14),d("formGroup",i.newCategoryForm),s(5),d("ngIf",((e=i.newCategoryForm.get("name"))==null?null:e.invalid)&&((e=i.newCategoryForm.get("name"))==null?null:e.touched)),s(14),d("disabled",i.isCreatingCategory),s(4),d("disabled",i.isCreatingCategory||i.newCategoryForm.invalid),s(),d("ngIf",i.isCreatingCategory),s(),d("ngIf",!i.isCreatingCategory),s(),u(" ",i.isCreatingCategory?"Creazione...":"Crea Categoria"," ")}}var re=class a{ingredientService=F(te);unitService=F(ie);dishService=F(ne);categoryService=F(oe);route=F(M);router=F(O);fb=F(Z);dishId;foodCostForm;ingredients=[];units=[];totalCost=0;suggestedPrice=0;isEditing=!1;currentDish=null;categories=[];showNewCategoryForm=!1;newCategoryForm;isCreatingCategory=!1;mode="dish";fromInventory=!1;selectedUnit=null;totalWeightGrams=0;calculatedYield=0;yieldManual=!1;constructor(){this.foodCostForm=this.fb.group({name:["",C.required],description:[""],sellingPrice:[0,[C.min(0)]],category_id:[""],preparation_time:[0,[C.min(0)]],unit_id:[""],yield_quantity:[0,[C.required,C.min(.001)]],to_buy:[!1],to_buy_quantity:[null],ingredients:this.fb.array([])}),this.newCategoryForm=this.fb.group({name:["",C.required],description:[""],is_default:[!1]})}ngOnInit(){this.ingredientService.data$.subscribe(t=>{this.ingredients=t,this.route.queryParams.subscribe(e=>{e.mode==="ingredient"?(this.mode="ingredient",this.fromInventory=e.fromInventory==="true",this.initializeForIngredient()):(this.mode="dish",this.route.paramMap.subscribe(i=>{let o=i.get("id");o?this.loadDishForEditing(o):this.ingredientsArray.length===0&&this.addIngredient()}))})}),this.unitService.units$.subscribe(t=>{if(this.units=t,this.mode==="ingredient"&&!this.foodCostForm.get("unit_id")?.value){let e=t.find(i=>i.symbol==="kg")||t[0];e&&(this.foodCostForm.patchValue({unit_id:e.id}),this.selectedUnit=e)}}),this.mode==="dish"&&this.categoryService.data$.subscribe(t=>{if(this.categories=t,t.length>0&&!this.foodCostForm.get("category_id")?.value){let e=t.find(i=>i.is_default)||t[0];this.foodCostForm.patchValue({category_id:e.id})}}),this.foodCostForm.get("unit_id")?.valueChanges.subscribe(t=>{this.selectedUnit=this.units.find(e=>e.id===t)||null,this.updateYieldQuantity()}),this.foodCostForm.get("yield_quantity")?.valueChanges.subscribe(()=>{this.yieldManual=!0,this.calculateCostPerUnit()})}loadDishForEditing(t){return S(this,null,function*(){try{let e=yield P(this.dishService.getDishById$(t));if(e)this.currentDish=e,this.isEditing=!0,this.populateFormWithDish(e);else{console.error("Piatto non trovato:",t),yield this.dishService.loadData();let i=yield P(this.dishService.getDishById$(t));i?(this.currentDish=i,this.isEditing=!0,this.populateFormWithDish(i)):(alert("Piatto non trovato"),this.router.navigate(["/food-cost"]))}}catch(e){console.error("Errore nel caricamento del piatto:",e),alert("Errore nel caricamento del piatto"),this.router.navigate(["/food-cost"])}})}populateFormWithDish(t){for(this.foodCostForm.patchValue({name:t.name,sellingPrice:t.base_price,category_id:t.category_id,description:t.description||"",preparation_time:t.preparation_time||0});this.ingredientsArray.length;)this.ingredientsArray.removeAt(0);t.ingredients_composition&&Array.isArray(t.ingredients_composition)?t.ingredients_composition.forEach(e=>{let i=this.fb.group({ingredient_id:[e.ingredient_id,C.required],quantity:[e.quantity,[C.required,C.min(0)]],cost:[e.cost||0]});this.ingredientsArray.push(i)}):this.addIngredient(),setTimeout(()=>{this.calculateCost()},100)}initializeForIngredient(){for(this.foodCostForm.reset(),this.foodCostForm.patchValue({unit_id:this.getDefaultUnitId(),yield_quantity:1,to_buy:!1,to_buy_quantity:null});this.ingredientsArray.length;)this.ingredientsArray.removeAt(0);this.addIngredient(),this.calculateCost()}getDefaultUnitId(){let t=this.units.find(i=>i.symbol==="kg"),e=this.units.find(i=>i.symbol==="pz");return t?.id||e?.id||""}updateYieldQuantity(){if(!(!this.selectedUnit||this.yieldManual)){if(this.selectedUnit.symbol==="kg")this.calculatedYield=this.totalWeightGrams/1e3;else if(this.selectedUnit.symbol==="g")this.calculatedYield=this.totalWeightGrams;else if(this.selectedUnit.symbol==="pz"){let t=this.foodCostForm.get("yield_quantity")?.value;this.calculatedYield=t>0?t:1}this.foodCostForm.patchValue({yield_quantity:this.calculatedYield},{emitEvent:!1})}}get ingredientsArray(){return this.foodCostForm.get("ingredients")}addIngredient(){let t=this.fb.group({ingredient_id:["",C.required],quantity:[0,[C.required,C.min(0)]],cost:[0]});this.ingredientsArray.push(t)}removeIngredient(t){this.ingredientsArray.removeAt(t),this.manualCalculateCost()}getIngredientUnitSymbol(t){let e=this.ingredients.find(o=>o.id===t);if(!e||!e.unit_id)return"";let i=this.unitService.getUnitById(e.unit_id);return i?i.symbol:""}calculateIngredientCost(t,e){if(!t||!t.unit_id||!t.units)return t.cost_per_unit*e;let i=t.units,o=e;switch(i.symbol){case"kg":o=e/1e3;break;case"L":o=e/1e3;break;case"g":case"mL":case"pz":o=e;break;default:o=e}return t.cost_per_unit*o}manualCalculateCost(){this.calculateCost()}calculateCost(){this.totalCost=0,this.totalWeightGrams=0,this.ingredientsArray.controls.forEach(e=>{let i=e.get("ingredient_id")?.value,o=e.get("quantity")?.value||0;if(i&&o>0){let c=this.ingredients.find(g=>g.id===i);if(c){let g=this.calculateIngredientCost(c,o);if(this.totalCost+=g,c.unit_id&&c.units){let x=c.units;x.type==="weight"&&(x.symbol==="kg"?this.totalWeightGrams+=o*1e3:x.symbol==="g"&&(this.totalWeightGrams+=o))}e.patchValue({cost:g},{emitEvent:!1})}}else e.patchValue({cost:0},{emitEvent:!1})}),this.mode==="ingredient"&&!this.yieldManual&&this.updateYieldQuantity();let t=this.calculateCostPerUnit();this.mode==="dish"&&this.calculateSuggestedPrice()}calculateCostPerUnit(){if(this.mode==="ingredient"){let t=this.foodCostForm.get("yield_quantity")?.value||1;return t>0?this.totalCost/t:0}return 0}calculateSuggestedPrice(){this.suggestedPrice=this.totalCost/.25}getFoodCostPercentage(){let t=this.foodCostForm.get("sellingPrice")?.value||0;return t>0?this.totalCost/t*100:0}getIngredientCost(t,e){let i=this.ingredients.find(o=>o.id===t);return i?this.calculateIngredientCost(i,e):0}onSubmit(){return S(this,null,function*(){this.foodCostForm.valid?this.mode==="dish"?yield this.saveDish():yield this.saveIngredient():(this.markFormGroupTouched(this.foodCostForm),alert("Compila tutti i campi obbligatori"))})}saveDish(){return S(this,null,function*(){let t=this.foodCostForm.value,e=[];this.ingredientsArray.controls.forEach(o=>{let c=o.get("ingredient_id")?.value,g=o.get("quantity")?.value||0;if(c&&g>0){let x=this.ingredients.find(w=>w.id===c);if(x){let w=this.calculateIngredientCost(x,g),ae=this.getQuantityUnitLabel(c);e.push({ingredient_id:c,quantity:g,cost:w,unit_symbol:ae})}}});let i={name:t.name,base_price:t.sellingPrice,food_cost:this.totalCost,ingredients_composition:e,delivery_price:t.sellingPrice,takeaway_price:t.sellingPrice,status:"available",description:t.description||"",preparation_time:t.preparation_time||0,category_id:t.category_id};try{if(this.isEditing&&this.currentDish){let o={name:t.name,base_price:t.sellingPrice,food_cost:this.totalCost,ingredients_composition:e,delivery_price:t.sellingPrice,takeaway_price:t.sellingPrice,status:"available",description:t.description||"",preparation_time:t.preparation_time||0,category_id:t.category_id};yield this.dishService.updateDish(this.currentDish.id,o),alert("Piatto aggiornato con successo!")}else(yield this.dishService.createDish(i))?(alert("Piatto creato con successo!"),this.resetForm()):alert("Errore nella creazione del piatto")}catch(o){console.error("Errore nel salvataggio:",o),alert("Errore nel salvataggio del piatto")}})}saveIngredient(){return S(this,null,function*(){let t=this.foodCostForm.value;try{let e=t.yield_quantity||1,i=this.totalCost/e,o={name:t.name,description:t.description||"",unit_id:t.unit_id,current_stock:0,minimum_stock:0,cost_per_unit:i,alert_enabled:!1,to_buy:t.to_buy||!1,to_buy_quantity:t.to_buy_quantity||null,is_active:!0,expiry_date:void 0,supplier_id:void 0,type_id:void 0,group_id:void 0};(yield this.ingredientService.createIngredient(o))?(alert("Ingrediente composto creato con successo!"),this.fromInventory?this.router.navigate(["/restaurant/inventory"]):this.resetForm()):alert("Errore nella creazione dell'ingrediente")}catch(e){console.error("Errore nella creazione dell'ingrediente:",e),alert("Errore nella creazione dell'ingrediente")}})}resetForm(){for(this.foodCostForm.reset();this.ingredientsArray.length;)this.ingredientsArray.removeAt(0);if(this.addIngredient(),this.totalCost=0,this.suggestedPrice=0,this.totalWeightGrams=0,this.yieldManual=!1,this.mode==="dish"){let t=this.categories.find(e=>e.is_default)||this.categories[0];t&&this.foodCostForm.patchValue({category_id:t.id})}else this.foodCostForm.patchValue({unit_id:this.getDefaultUnitId(),yield_quantity:1,to_buy:!1,to_buy_quantity:null})}markFormGroupTouched(t){Object.keys(t.controls).forEach(e=>{let i=t.get(e);i instanceof B?this.markFormGroupTouched(i):i?.markAsTouched()})}getQuantityUnitLabel(t){let e=this.ingredients.find(o=>o.id===t);if(!e||!e.unit_id||!e.units)return"pz";let i=e.units;switch(i.symbol){case"kg":return"g";case"L":return"mL";case"g":case"mL":case"pz":default:return i.symbol}}canSave(){let t=!!this.foodCostForm.get("name")?.valid,e=this.ingredientsArray.controls.some(i=>{let o=i.get("ingredient_id")?.value,c=Number(i.get("quantity")?.value??0);return!!o&&c>0});if(this.mode==="dish"){let o=(this.foodCostForm.get("sellingPrice")?.value??0)>0,c=!!this.foodCostForm.get("category_id")?.value&&!this.showNewCategoryForm;return t&&o&&c&&e}else{let i=!!this.foodCostForm.get("unit_id")?.value,o=this.foodCostForm.get("yield_quantity")?.value>0;return t&&i&&o&&e}}onIngredientSearch(t,e){let i=t.target.value.toLowerCase();if(i){let o=this.ingredients.filter(c=>c.name.toLowerCase().includes(i)||c.description?.toLowerCase().includes(i))}}onIngredientSelected(t,e){let i=t.target.value,o=this.ingredients.find(c=>c.name===i);o?(this.ingredientsArray.at(e).patchValue({ingredient_id:o.id},{emitEvent:!1}),this.manualCalculateCost()):(this.ingredientsArray.at(e).patchValue({ingredient_id:""},{emitEvent:!1}),this.manualCalculateCost())}getIngredientName(t){if(!t)return"";let e=this.ingredients.find(i=>i.id===t);return e?e.name:""}toggleNewCategoryForm(){this.showNewCategoryForm=!this.showNewCategoryForm,this.showNewCategoryForm||this.newCategoryForm.reset()}onCreateCategory(){return S(this,null,function*(){if(this.newCategoryForm.valid){this.isCreatingCategory=!0;try{let t={name:this.newCategoryForm.get("name")?.value?.trim(),description:this.newCategoryForm.get("description")?.value?.trim()||void 0,is_default:this.newCategoryForm.get("is_default")?.value||!1},e=yield this.categoryService.createCategory(t);e?(this.foodCostForm.patchValue({category_id:e.id}),this.showNewCategoryForm=!1,this.newCategoryForm.reset(),alert("Categoria creata con successo!")):alert("Impossibile creare la categoria. Controlla i permessi o riprova.")}catch(t){console.error("Errore durante creazione categoria:",t),alert(`Errore: ${t.message||"Errore sconosciuto"}`)}finally{this.isCreatingCategory=!1}}else this.markFormGroupTouched(this.newCategoryForm),alert("Compila tutti i campi obbligatori (almeno il nome)")})}get filteredUnits(){return this.units.filter(t=>t.symbol==="kg"||t.symbol==="g"||t.symbol==="L"||t.symbol==="mL"||t.symbol==="pz")}getUnitSymbol(t){let e=this.units.find(i=>i.id===t);return e?e.symbol:""}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=V({type:a,selectors:[["app-food-cost-calculator"]],inputs:{dishId:"dishId"},decls:80,vars:27,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons"],[1,"section-title"],[1,"text-muted"],[1,"flex","flex-col","gap-lg"],[1,"form-card"],[1,"flex","flex-col",3,"ngSubmit","formGroup"],[1,"form-row","mb-md"],[1,"form-group"],["for","name",1,"standard-label"],["id","name","formControlName","name","type","text",3,"placeholder"],["class","form-group",4,"ngIf"],["class","form-row mb-md",4,"ngIf"],["for","description",1,"standard-label"],["id","description","formControlName","description","rows","3",3,"placeholder"],[1,"section-header","piccolaheader"],[1,"flex","gap-sm","items-center"],[1,"section-title","m-0"],[1,"chip"],[1,"ingredients-container"],[1,"ingredients-header"],[1,"ingredient-col"],[1,"quantity-col"],[1,"cost-col"],[1,"action-col"],["formArrayName","ingredients",1,"ingredients-list"],["class","ingredient-row",3,"formGroupName",4,"ngFor","ngForOf"],[1,"modal-footer","p-md0"],["type","button",1,"promethea-button",3,"click"],[1,"costs-grid"],[1,"cost-item"],[1,"cost-value"],[1,"cost-label","text-muted"],["class","cost-item",4,"ngIf"],["type","submit",1,"promethea-button",3,"disabled"],["class","modal-overlay",3,"click",4,"ngIf"],["for","category_id",1,"standard-label"],["id","category_id","formControlName","category_id",1,"flex-1",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","button","title","Aggiungi nuova categoria",1,"icon-button",3,"click","disabled"],["class","text-red-500 text-sm",4,"ngIf"],[3,"value"],[4,"ngIf"],[1,"text-red-500","text-sm"],["for","unit_id",1,"standard-label"],["id","unit_id","formControlName","unit_id",1,"flex-1",3,"change"],["for","preparation_time",1,"standard-label"],["id","preparation_time","formControlName","preparation_time","type","number","min","0","placeholder","0"],["for","sellingPrice",1,"standard-label"],["id","sellingPrice","formControlName","sellingPrice","type","number","step","0.01","min","0","placeholder","0.00",3,"change"],["for","yield_quantity",1,"standard-label"],["id","yield_quantity","formControlName","yield_quantity","type","number","step","0.001","min","0.001","placeholder","0",3,"change"],["class","text-muted",4,"ngIf"],["class","text-xs text-blue-600 mt-1",4,"ngIf"],["for","cost_per_unit",1,"standard-label"],["id","cost_per_unit","formControlName","cost_per_unit","type","number","step","0.001","min","0","readonly","",1,"bg-gray-100"],[1,"text-xs","text-blue-600","mt-1"],[1,"ingredient-row",3,"formGroupName"],["list","ingredientsList","placeholder","Cerca ingrediente...",1,"searchable-select",3,"input","blur","change","value"],["id","ingredientsList"],["formControlName","ingredient_id",1,"hidden"],[1,"flex","items-center","gap-sm"],["formControlName","quantity","type","number","step","0.001","min","0","placeholder","0",3,"change"],["class","text-muted text-sm whitespace-nowrap",4,"ngIf"],["type","button","title","Rimuovi ingrediente",1,"icon-button",3,"click"],[1,"text-muted","text-sm","whitespace-nowrap"],[1,"cost-label"],["type","checkbox","id","to_buy","formControlName","to_buy"],["for","to_buy",1,"checkbox-label"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["for","to_buy_quantity",1,"standard-label"],["id","to_buy_quantity","formControlName","to_buy_quantity","type","number","min","0","step","0.001","placeholder","0"],[1,"modal-overlay",3,"click"],[1,"modal-container","modal-md",3,"click"],[1,"modal-header"],[1,"flex"],[1,"header-icon"],["type","button",1,"icon-button",3,"click"],[1,"modal-content"],[1,"form-card",3,"formGroup"],[1,"form-row","mb-lg"],["for","newCategoryName",1,"standard-label"],["id","newCategoryName","formControlName","name","type","text","placeholder","Inserisci il nome della categoria","autofocus",""],["for","newCategoryDescription",1,"standard-label"],["id","newCategoryDescription","formControlName","description","rows","3","placeholder","Descrizione della categoria (opzionale)"],[1,"flex","flex-col","gap-sm"],[1,"checkbox-label"],["type","checkbox","formControlName","is_default"],[1,"checkbox-content"],[1,"modal-footer"],["type","button",1,"promethea-button","ghost",3,"click","disabled"],["type","button",1,"promethea-button",3,"click","disabled"],["class","material-icons",4,"ngIf"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4),n(),r(5,"h1",4),l(6),n()(),r(7,"p",5),l(8),n()(),r(9,"div",6)(10,"div",7)(11,"form",8),v("ngSubmit",function(){return i.onSubmit()}),r(12,"div",9)(13,"div",10)(14,"label",11)(15,"span",3),l(16,"restaurant"),n(),l(17),n(),b(18,"input",12),n(),p(19,ce,14,4,"div",13)(20,ge,10,2,"div",13),n(),p(21,pe,13,0,"div",14)(22,he,16,4,"div",14),r(23,"div",9)(24,"label",15)(25,"span",3),l(26,"description"),n(),l(27," Descrizione "),n(),b(28,"textarea",16),n(),r(29,"div",17)(30,"div",18)(31,"span",3),l(32,"list"),n(),r(33,"h2",19),l(34,"Ingredienti"),n(),r(35,"span",20),l(36),n()()(),r(37,"div",21)(38,"div",22)(39,"div",23),l(40,"Ingrediente"),n(),r(41,"div",24),l(42,"Quantit\xE0"),n(),r(43,"div",25),l(44,"Costo"),n(),r(45,"div",26),l(46,"Azioni"),n()(),r(47,"div",27),p(48,Ee,20,9,"div",28),n()(),r(49,"div",29)(50,"button",30),v("click",function(){return i.addIngredient()}),r(51,"span",3),l(52,"add"),n(),l(53," Aggiungi Ingrediente "),n()(),r(54,"div",7)(55,"div",17)(56,"div",18)(57,"span",3),l(58,"analytics"),n(),r(59,"h2",19),l(60,"Riepilogo"),n()()(),r(61,"div",31)(62,"div",32)(63,"div",33),l(64),h(65,"number"),n(),r(66,"div",34),l(67,"Costo Totale"),n()(),p(68,Se,6,8,"div",35)(69,Ie,6,4,"div",35)(70,we,6,4,"div",35)(71,Pe,6,5,"div",35)(72,ke,6,5,"div",35),n()(),p(73,Ne,9,1,"div",14),r(74,"div",29)(75,"button",36)(76,"span",3),l(77),n(),l(78),n()()()()()(),p(79,qe,41,7,"div",37)),e&2&&(s(4),I(i.isEditing?"edit":"calculate"),s(2),u(" ",i.mode==="ingredient"?"Crea Ingrediente Composto":i.isEditing?"Modifica Piatto":"Calcolo Food Cost"," "),s(2),u(" ",i.mode==="ingredient"?"Calcola il costo di produzione di un ingrediente":i.isEditing?"Modifica il piatto esistente":"Calcola il costo degli ingredienti e il prezzo di vendita ottimale"," "),s(3),d("formGroup",i.foodCostForm),s(6),u(" ",i.mode==="ingredient"?"Nome Ingrediente *":"Nome Piatto *"," "),s(),d("placeholder",i.mode==="ingredient"?"Inserisci il nome dell'ingrediente":"Inserisci il nome del piatto"),s(),d("ngIf",i.mode==="dish"),s(),d("ngIf",i.mode==="ingredient"),s(),d("ngIf",i.mode==="dish"),s(),d("ngIf",i.mode==="ingredient"),s(6),d("placeholder",i.mode==="ingredient"?"Descrizione dell'ingrediente (opzionale)":"Descrizione del piatto (opzionale)"),s(8),u("",i.ingredientsArray.length," ingredienti"),s(12),d("ngForOf",i.ingredientsArray.controls),s(16),u("\u20AC",y(65,24,i.totalCost,"1.2-2")),s(4),d("ngIf",i.mode==="dish"),s(),d("ngIf",i.mode==="dish"),s(),d("ngIf",i.mode==="dish"),s(),d("ngIf",i.mode==="ingredient"),s(),d("ngIf",i.mode==="ingredient"),s(),d("ngIf",i.mode==="ingredient"),s(2),d("disabled",!i.canSave()),s(2),I(i.isEditing?"update":"save"),s(),u(" ",i.mode==="ingredient"?"Crea Ingrediente":i.isEditing?"Aggiorna Piatto":"Salva Piatto"," "),s(),d("ngIf",i.showNewCategoryForm))},dependencies:[q,T,D,ee,Q,J,K,U,W,z,H,G,L,X,$,j,Y,R,A],styles:[".piccolaheader[_ngcontent-%COMP%]{background:var(--smoke-1);min-height:auto}.piccolaheader[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%], .piccolaheader[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:var(--fs-md)}.ingredients-container[_ngcontent-%COMP%]{border:1px solid var(--smoke-1);border-radius:12px;overflow:hidden;margin-bottom:var(--gap-md)}.ingredients-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:var(--gap-md);padding:var(--gap-md);background:var(--smoke-1);font-weight:600;font-size:var(--fs-sm)}.ingredients-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.ingredient-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:var(--gap-md);padding:var(--gap-md);align-items:center;border-bottom:1px solid var(--smoke-1);transition:all .2s ease}.ingredient-row[_ngcontent-%COMP%]:hover{background:var(--smoke-1)}.ingredient-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.ingredient-col[_ngcontent-%COMP%]{min-width:0}.quantity-col[_ngcontent-%COMP%]{min-width:120px}.cost-col[_ngcontent-%COMP%]{min-width:80px;font-weight:600;text-align:center}.costs-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:var(--gap-md);margin-top:var(--gap-md)}.cost-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;padding:var(--gap-md);background:var(--background);border:1px solid var(--smoke-1);border-radius:12px;transition:all .2s ease}.cost-item[_ngcontent-%COMP%]:hover{border-color:var(--secondary);transform:translateY(-2px)}.cost-value[_ngcontent-%COMP%]{font-size:var(--fs-md);font-weight:700;margin-bottom:var(--gap-sm)}.cost-label[_ngcontent-%COMP%]{font-size:var(--fs-sm)}.searchable-select[_ngcontent-%COMP%]{width:100%}.hidden[_ngcontent-%COMP%]{display:none!important}@media (max-width: 768px){.ingredients-header[_ngcontent-%COMP%], .ingredient-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gap-sm)}.ingredients-header[_ngcontent-%COMP%]{display:none}.ingredient-row[_ngcontent-%COMP%]{padding:var(--gap-md);border:1px solid var(--smoke-1);border-radius:8px;margin-bottom:var(--gap-sm)}.costs-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 480px){.costs-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.checkbox-label[_ngcontent-%COMP%]{align-items:center}"]})};export{re as a};
