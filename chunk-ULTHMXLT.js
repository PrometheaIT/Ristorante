import{a as d}from"./chunk-D2EHDSLL.js";import{Z as u,ua as c}from"./chunk-QIXMMTC2.js";import{a as i,b as s,j as a}from"./chunk-4ZZIO3ZI.js";var b=class n extends d{getTableName(){return"restaurant_floor_plans"}tableShapes=[{id:"rect",name:"Rettangolare",type:"rectangle",default_width:120,default_height:80,icon:"rectangle"},{id:"circle",name:"Rotondo",type:"circle",default_width:100,default_height:100,icon:"circle"},{id:"square",name:"Quadrato",type:"square",default_width:100,default_height:100,icon:"square"}];loadData(){return a(this,null,function*(){try{let e=yield this.getCurrentRestaurantId();if(!e)return;let{data:t,error:r}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).select("*").eq("restaurant_id",e).order("created_at",{ascending:!1});if(r)throw r;this.dataSubject.next(t||[])}catch(e){console.error(`Error loading ${this.getTableName()}:`,e),this.errorSubject.next(e.message),this.dataSubject.next([])}})}updateFloorPlan(e,t){return a(this,null,function*(){try{let r=s(i({},t),{updated_at:new Date().toISOString()}),{error:o}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).update(r).eq("id",e);if(o)throw o;return yield this.loadData(),!0}catch(r){return console.error("\u274C Error updating floor plan:",r),!1}})}loadFloorPlans(){return a(this,null,function*(){return this.loadData()})}getTableShapes(){return this.tableShapes}getTableShapeById(e){return this.tableShapes.find(t=>t.id===e)}createFloorPlan(e){return a(this,null,function*(){try{let t=yield this.getCurrentRestaurantId();if(!t)return null;let r=s(i({},e),{restaurant_id:t,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),{data:o,error:l}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).insert(r).select().single();if(l)throw l;return yield this.loadData(),o}catch(t){return console.error("Error creating floor plan:",t),null}})}deleteFloorPlan(e){return a(this,null,function*(){try{yield this.supabaseService.getSupabaseClient().from("tables").update({floor_plan_id:null}).eq("floor_plan_id",e);let{error:t}=yield this.supabaseService.getSupabaseClient().from(this.getTableName()).delete().eq("id",e);if(t)throw t;return yield this.loadData(),!0}catch(t){return console.error("Error deleting floor plan:",t),!1}})}getDefaultDimensions(){let e=window.innerWidth<768;return{width:e?800:1e3,height:e?600:800}}getMergedTableName(e){return`Tavolo Unito ${e.map(r=>r.table_number).join("-")}`}getMergedTableNumber(e){return`U${e.map(t=>t.table_number).join("")}`}getTotalCapacity(e){return e.reduce((t,r)=>t+r.capacity,0)}getPreviewBorderRadius(e,t){return e==="circle"?"50%":t+"px"}getPreviewBorderRadiusValue(e,t){return e==="circle"?"50% (automatico)":t+"px"}getSelectedTableNumbers(e){return e.map(t=>t.table_number).join("-")}setCurrentVersion(e,t){return a(this,null,function*(){try{let{error:r}=yield this.supabaseService.getSupabaseClient().from("restaurant_floor_plans").update({current_version:t,updated_at:new Date().toISOString()}).eq("id",e);if(r)throw r;return!0}catch(r){return console.error("\u274C Error setting current version:",r),!1}})}static \u0275fac=(()=>{let e;return function(r){return(e||(e=c(n)))(r||n)}})();static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};export{b as a};
