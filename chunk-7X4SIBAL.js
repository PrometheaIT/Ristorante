import{a as M}from"./chunk-XMFPU2G7.js";import"./chunk-AMYEPXIV.js";import"./chunk-SY2ZWW6D.js";import{d as I}from"./chunk-TB7INTC7.js";import"./chunk-Q3EITIAW.js";import"./chunk-RC3HHTXM.js";import{r as w,v as T}from"./chunk-MPTEMNWF.js";import{Ia as g,Ib as r,Jb as d,Kb as c,La as a,Va as h,Vb as u,Xb as x,_a as p,ca as v,gb as _,la as y,ma as P,mb as l,ob as S,pb as E,qb as o,rb as n,sb as C,vb as U,yb as b,zb as s}from"./chunk-5BU4UD4M.js";import{g as f}from"./chunk-RA2WU32H.js";var z=(t,i)=>i.notification_id;function N(t,i){t&1&&(o(0,"div",2)(1,"span",6),r(2,"autorenew"),n(),o(3,"span",7),r(4,"Caricamento promozioni..."),n()())}function O(t,i){if(t&1&&(o(0,"div",3)(1,"span",8),r(2,"error"),n(),o(3,"span"),r(4),n()()),t&2){let e=s();a(4),d(e.error)}}function j(t,i){t&1&&(o(0,"div",4)(1,"span",8),r(2,"inbox"),n(),o(3,"p",7),r(4,"Non hai ancora ricevuto promozioni."),n(),o(5,"p"),r(6,"Segui i tuoi ristoranti preferiti per ricevere offerte esclusive!"),n()())}function V(t,i){if(t&1&&C(0,"img",12),t&2){let e=s().$implicit;_("src",e.restaurant.logo_url,g)}}function k(t,i){t&1&&(o(0,"span",8),r(1,"restaurant"),n())}function B(t,i){if(t&1&&C(0,"img",14),t&2){let e=s().$implicit;_("src",e.promotion.image_url,g)}}function A(t,i){if(t&1&&(o(0,"span",20),r(1),n()),t&2){let e=s().$implicit;a(),c("min. ",e.promotion.min_order_amount,"\u20AC")}}function R(t,i){if(t&1&&(r(0),u(1,"date")),t&2){let e=s().$implicit;c(" al ",x(1,1,e.promotion.valid_until,"dd/MM/yyyy")," ")}}function q(t,i){t&1&&r(0," a tempo indeterminato ")}function G(t,i){t&1&&(o(0,"span",23),r(1,"Scaduta"),n())}function H(t,i){if(t&1){let e=U();o(0,"div",9)(1,"div",10)(2,"div",11),p(3,V,1,1,"img",12)(4,k,2,0,"span",8),n(),o(5,"span",13),r(6),n()(),p(7,B,1,1,"img",14),o(8,"h3",15),r(9),n(),o(10,"p",16),r(11),n(),o(12,"div",17)(13,"div",18)(14,"span",19),r(15),n(),p(16,A,2,1,"span",20),n(),o(17,"div",21)(18,"span",22),r(19,"event"),n(),o(20,"span"),r(21),u(22,"date"),p(23,R,2,4)(24,q,1,0),n()(),p(25,G,2,0,"span",23),n(),o(26,"div",24)(27,"span",25),r(28),u(29,"date"),n(),o(30,"button",26),b("click",function(){let $=y(e).$implicit,D=s(2);return P(D.usePromotion($.promotion))}),o(31,"span",8),r(32,"sell"),n(),r(33," Usa promozione "),n()()()}if(t&2){let e=i.$implicit,m=s(2);a(3),l(e.restaurant.logo_url?3:4),a(3),d(e.restaurant.name),a(),l(e.promotion.image_url?7:-1),a(2),d(e.promotion.name),a(2),d(e.promotion.description),a(4),d(m.formatDiscount(e.promotion)),a(),l(e.promotion.min_order_amount?16:-1),a(5),c(" Valida dal ",x(22,12,e.promotion.valid_from,"dd/MM/yyyy")," "),a(2),l(e.promotion.valid_until?23:24),a(2),l(m.isExpired(e.promotion.valid_until)?25:-1),a(3),c("Ricevuta il ",x(29,15,e.sent_at,"dd/MM/yyyy"),""),a(2),_("disabled",m.isExpired(e.promotion.valid_until))}}function J(t,i){if(t&1&&(o(0,"div",5),S(1,H,34,18,"div",9,z),n()),t&2){let e=s();a(),E(e.promotions)}}var F=class t{promoNotifService=v(M);authService=v(I);promotions=[];loading=!1;error=null;ngOnInit(){return f(this,null,function*(){if(!this.authService.currentUserValue){this.error="Devi essere autenticato";return}yield this.loadPromotions()})}loadPromotions(){return f(this,null,function*(){this.loading=!0,this.error=null;try{this.promotions=yield this.promoNotifService.getMyPromotions()}catch(i){this.error=i.message||"Errore nel caricamento delle promozioni",console.error(i)}finally{this.loading=!1}})}formatDiscount(i){if(i.type==="percentage"){let e=`${i.discount_value}%`;return i.max_discount_amount&&(e+=` (max ${i.max_discount_amount}\u20AC)`),e}else return`${i.discount_value}\u20AC`}isExpired(i){return i?new Date(i)<new Date:!1}usePromotion(i){console.log("Usa promozione",i)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=h({type:t,selectors:[["app-user-promotions"]],decls:6,vars:4,consts:[[1,"page-container"],[1,"p-lg"],[1,"flex","justify-center","p-lg"],[1,"info-message"],[1,"empty-state","p-lg"],[1,"grid-cards"],[1,"material-icons","animate-spin"],[1,"text-muted"],[1,"material-icons"],[1,"card"],[1,"flex","items-center","gap-sm","mb-sm"],[1,"avatartondo","small"],["alt","logo",1,"avatar-img",3,"src"],[1,"font-bold"],["alt","promo",1,"w-100","rounded","mb-sm",2,"max-height","150px","object-fit","cover",3,"src"],[1,"card-title"],[1,"text-muted","text-mini","mb-sm"],[1,"flex","flex-col","gap-mini","mb-sm"],[1,"flex","items-center","gap-sm"],[1,"chip"],[1,"chip-mini"],[1,"flex","items-center","gap-sm","text-mini"],[1,"material-icons","text-muted"],[1,"chip","warning"],[1,"card-footer"],[1,"text-mini","text-muted"],[1,"promethea-button",3,"click","disabled"]],template:function(e,m){e&1&&(o(0,"div",0)(1,"div",1),p(2,N,5,0,"div",2)(3,O,5,1,"div",3)(4,j,7,0,"div",4)(5,J,3,0,"div",5),n()()),e&2&&(a(2),l(m.loading?2:-1),a(),l(m.error?3:-1),a(),l(!m.loading&&!m.error&&m.promotions.length===0?4:-1),a(),l(!m.loading&&m.promotions.length>0?5:-1))},dependencies:[T,w],styles:[".avatartondo.small[_ngcontent-%COMP%]{width:calc(var(--fs-sm) * 2);height:calc(var(--fs-sm) * 2)}.avatar-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:50%}.card-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:var(--gap-sm)}"]})};export{F as UserPromotionsComponent};
