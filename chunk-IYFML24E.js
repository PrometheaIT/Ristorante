import{a as O,b as L,c as g,d as I,e as F,i as T,m as N,p as R,w as D,y as A}from"./chunk-7VSFVQGQ.js";import{b as S}from"./chunk-TAPIY3IR.js";import{a as P,b as k}from"./chunk-HZAFCD3S.js";import{d as C,m as w,r as M,s as E}from"./chunk-VYE6ILYG.js";import{$a as d,Bb as f,Eb as i,Fb as y,Ga as s,Gb as v,Wa as _,da as c,g as x,hb as l,ib as n,jb as t,kb as p,sb as h,ub as u}from"./chunk-3SWAHN2Y.js";function j(a,o){a&1&&(n(0,"span"),i(1,"L'email \xE8 obbligatoria"),t())}function q(a,o){a&1&&(n(0,"span"),i(1,"Inserisci un'email valida"),t())}function Y(a,o){if(a&1&&(n(0,"div",39)(1,"span",13),i(2,"error"),t(),d(3,j,2,0,"span",40)(4,q,2,0,"span",40),t()),a&2){let e=u();s(3),l("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.required),s(),l("ngIf",e.email==null||e.email.errors==null?null:e.email.errors.email)}}function B(a,o){a&1&&(n(0,"span"),i(1,"La password \xE8 obbligatoria"),t())}function z(a,o){a&1&&(n(0,"span"),i(1,"Minimo 6 caratteri"),t())}function U(a,o){if(a&1&&(n(0,"div",41)(1,"span",13),i(2,"error"),t(),d(3,B,2,0,"span",40)(4,z,2,0,"span",40),t()),a&2){let e=u();s(3),l("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.required),s(),l("ngIf",e.password==null||e.password.errors==null?null:e.password.errors.minlength)}}function $(a,o){if(a&1&&(n(0,"div",42)(1,"span",43),i(2),t(),i(3),t()),a&2){let e=u();f("text-red-500",!e.errorMessage.includes("effettuato"))("text-green-500",e.errorMessage.includes("effettuato")),s(2),v(" ",e.errorMessage.includes("effettuato")?"check_circle":"warning"," "),s(),v(" ",e.errorMessage," ")}}function H(a,o){a&1&&p(0,"span",44)}function J(a,o){a&1&&(n(0,"span",13),i(1,"login"),t())}var G=class a{fb=c(D);authService=c(S);router=c(M);supabaseService=c(k);loginForm;isLoading=!1;errorMessage="";showPassword=!1;constructor(){this.loginForm=this.fb.group({email:["",[g.required,g.email]],password:["",[g.required,g.minLength(6)]],rememberMe:[!1]}),this.isProduction||this.prefillDemoCredentials()}onSubmit(){return x(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="";let{email:o,password:e,rememberMe:r}=this.loginForm.value;try{let m=yield this.authService.login(o,e,r);if(m.error){let b=m.error instanceof Error?m.error.message:String(m.error);this.errorMessage=this.getErrorMessage(b)}else if(m.data?.user){console.log("\u2705 Login effettuato con successo");let b=this.authService.getCurrentContext(),V={staff:"Dipendente",supplier:"Fornitore",customer:"Cliente"};this.errorMessage=`Accesso effettuato come ${V[b]}! Reindirizzamento...`,setTimeout(()=>{this.navigateBasedOnContext()},1e3)}}catch(m){console.error("Login error:",m),this.errorMessage="Errore durante il login. Riprova pi\xF9 tardi."}finally{this.isLoading=!1}})}checkStaffMembership(o){return x(this,null,function*(){try{let{data:e,error:r}=yield this.supabaseService.getSupabaseClient().from("restaurant_staff").select("*").eq("email",o.toLowerCase()).in("invitation_status",["accepted","pending"]);e&&e.length>0?console.log("\u{1F3AF} Utente trovato come staff member:",e):console.log("\u2139\uFE0F Utente non \xE8 staff member")}catch(e){console.log("\u2139\uFE0F Errore nel controllo staff membership:",e)}})}navigateBasedOnContext(){switch(this.authService.getCurrentContext()){case"staff":this.router.navigate(["/restaurant/dashboard"]);break;case"supplier":this.router.navigate(["/supplier/dashboard"]);break;case"customer":default:this.router.navigate(["/customer"]);break}}togglePasswordVisibility(){this.showPassword=!this.showPassword}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(o=>{this.loginForm.get(o)?.markAsTouched()})}getErrorMessage(o){return{"Invalid login credentials":"Email o password non validi.","Email not confirmed":"Email non confermata. Controlla la tua casella di posta.","Invalid email":"Email non valida.","Network error":"Errore di rete. Controlla la tua connessione.","Email rate limit exceeded":"Troppi tentativi. Riprova pi\xF9 tardi."}[o]||`Errore: ${o}`}prefillDemoCredentials(){console.log("Modalit\xE0 sviluppo: credenziali demo disponibili")}useDemoCredentials(o){o==="restaurant"?this.loginForm.patchValue({email:"ristorante@demo.com",password:"demodemo"}):this.loginForm.patchValue({email:"cliente@demo.com",password:"demodemo"})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}get isProduction(){return P.production}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=_({type:a,selectors:[["app-login"]],decls:68,vars:14,consts:[[1,"gradient-container"],[1,"sparkle"],[1,"floating-blob"],[1,"form-card","modal-md"],[1,"section-header","border-b-2","border-[var(--smoke-1)]","pb-lg","text-center"],[1,"flex","flex-col","items-center","gap-md"],[1,"material-icons","fs-lg","text-[var(--tertiary)]"],[1,"flex","flex-col","items-center"],[1,"text-md","font-bold","text-[var(--tertiary)]","m-0"],[1,"text-muted","m-0"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-group","mb-lg"],[1,"standard-label"],[1,"material-icons"],["id","email","formControlName","email","type","email","placeholder","tua.email@esempio.com"],["class","text-muted",4,"ngIf"],[1,"flex","gap-sm","items-center"],["id","password","formControlName","password","placeholder","La tua password",1,"pr-[50px]",3,"type"],[1,"flex","gap-sm"],["type","button",1,"icon-button","absolute","right-sm","top-1/2","-translate-y-1/2","bg-transparent","border-none","text-[var(--text-muted)]","hover:text-[var(--primary)]",3,"click"],["class","p-sm my-sm rounded flex items-center gap-sm bg-[color-mix(in srgb,#ef444410%,transparent)] text-red-500 border border-[color-mix(in srgb,#ef444430%,transparent)]",4,"ngIf"],[1,"flex","justify-between","items-center","my-md"],[1,"checkbox-label","hover:bg-[var(--smoke-1)]"],["type","checkbox","formControlName","rememberMe"],[1,"checkbox-content"],["class","text-muted text-md mb-lg",3,"text-red-500","text-green-500",4,"ngIf"],[1,"flex","items-center","flex-col"],["type","submit",1,"promethea-button","w-full","hover-lift",3,"disabled"],["class","loading-spinner",4,"ngIf"],["class","material-icons",4,"ngIf"],[1,"my-xl","relative","text-center","p-md","mb-lg",2,"border-bottom","1px solid var(--smoke-1)"],[1,"absolute","inset-x-0","top-1/2","h-px","bg-[var(--smoke-1)]"],[1,"text-muted","mb-md","flex","flex-col","items-center"],[1,"text-center"],[1,"flex","gap-md","justify-center","flex-wrap"],["routerLink","/register/restaurant",1,"promethea-button","flex-1"],["routerLink","/register/supplier",1,"promethea-button","flex-1"],[1,"mt-lg","flex","flex-col","items-center"],["routerLink","/register/customer",1,"promethea-button","w-full"],[1,"text-muted"],[4,"ngIf"],[1,"p-sm","my-sm","rounded","flex","items-center","gap-sm","bg-[color-mix(in","srgb,#ef444410%,transparent)]","text-red-500","border","border-[color-mix(in","srgb,#ef444430%,transparent)]"],[1,"text-muted","text-md","mb-lg"],[1,"material-icons","text-md"],[1,"loading-spinner"]],template:function(e,r){e&1&&(n(0,"div",0),p(1,"div",1)(2,"div",1)(3,"div",1)(4,"div",2),n(5,"div",3)(6,"div",4)(7,"div",5)(8,"span",6),i(9,"restaurant"),t(),n(10,"div",7)(11,"h1",8),i(12,"Bentornato"),t(),n(13,"p",9),i(14,"Accedi al tuo account"),t()()()(),n(15,"form",10),h("ngSubmit",function(){return r.onSubmit()}),n(16,"div",11)(17,"label",12)(18,"span",13),i(19,"email"),t(),i(20," Email * "),t(),p(21,"input",14),d(22,Y,5,2,"div",15),t(),n(23,"div",11)(24,"label",12)(25,"span",13),i(26,"lock"),t(),i(27," Password * "),t(),n(28,"div",16),p(29,"input",17),n(30,"div",18)(31,"button",19),h("click",function(){return r.togglePasswordVisibility()}),n(32,"span",13),i(33),t()()()(),d(34,U,5,2,"div",20),t(),n(35,"div",21)(36,"label",22),p(37,"input",23),n(38,"div",24)(39,"strong"),i(40,"Ricordami"),t()()()(),d(41,$,4,6,"div",25),n(42,"div",26)(43,"button",27),d(44,H,1,0,"span",28)(45,J,2,0,"span",29),i(46),t()(),n(47,"div",30),p(48,"div",31),n(49,"span",32),i(50,"oppure"),t()(),n(51,"div",33)(52,"p",32),i(53,"Non hai un account?"),t(),n(54,"div",34)(55,"a",35)(56,"span",13),i(57,"restaurant"),t(),i(58," Registra Ristorante "),t(),n(59,"a",36)(60,"span",13),i(61,"local_shipping"),t(),i(62," Registrati come Fornitore "),t()(),n(63,"div",37)(64,"a",38)(65,"span",13),i(66,"person"),t(),i(67," Registrati come Cliente "),t()()()()()()),e&2&&(s(15),l("formGroup",r.loginForm),s(6),f("error",(r.email==null?null:r.email.invalid)&&(r.email==null?null:r.email.touched)),s(),l("ngIf",(r.email==null?null:r.email.invalid)&&(r.email==null?null:r.email.touched)),s(7),f("error",(r.password==null?null:r.password.invalid)&&(r.password==null?null:r.password.touched)),l("type",r.showPassword?"text":"password"),s(4),y(r.showPassword?"visibility_off":"visibility"),s(),l("ngIf",(r.password==null?null:r.password.invalid)&&(r.password==null?null:r.password.touched)),s(7),l("ngIf",r.errorMessage),s(2),l("disabled",r.isLoading||r.loginForm.invalid),s(),l("ngIf",r.isLoading),s(),l("ngIf",!r.isLoading),s(),v(" ",r.isLoading?"Accesso in corso...":"Accedi"," "))},dependencies:[w,C,A,T,L,O,I,F,N,R,E],styles:['[_nghost-%COMP%]{display:block;width:100%}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gap-sm)}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 3px color-mix(in srgb,#ef4444 20%,transparent)}@media (max-width: 768px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gap-sm)}}input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted);opacity:.7}input[_ngcontent-%COMP%]:focus{border-color:var(--primary);box-shadow:0 0 0 3px color-mix(in srgb,var(--primary) 20%,transparent);transform:translateY(-1px)}.password-toggle[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:var(--gap-sm);border-radius:8px;transition:all .2s ease;position:absolute;right:var(--gap-sm);top:50%;transform:translateY(-50%)}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary);background:var(--smoke-1)}@media (max-width: 480px){.form-card[_ngcontent-%COMP%]{margin:var(--gap-md) auto;border-radius:16px}.section-header[_ngcontent-%COMP%]{padding:var(--gap-md)}}.gradient-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--background);padding:var(--gutter-sm);position:relative;overflow:hidden}.gradient-container[_ngcontent-%COMP%]:before, .gradient-container[_ngcontent-%COMP%]:after, .gradient-container[_ngcontent-%COMP%]   .floating-blob[_ngcontent-%COMP%]{content:"";position:absolute;border-radius:50%;filter:blur(90px);opacity:.22;pointer-events:none;animation:vapor 28s ease-in-out infinite}.gradient-container[_ngcontent-%COMP%]:before{width:700px;height:700px;background:radial-gradient(circle at 30%,var(--primary) 0%,transparent 65%);top:-20%;left:-15%;animation-delay:0s}.gradient-container[_ngcontent-%COMP%]:after{width:600px;height:600px;background:radial-gradient(circle at 40%,var(--secondary) 0%,transparent 70%);bottom:-10%;right:-10%;animation-delay:-9s}.gradient-container[_ngcontent-%COMP%]   .floating-blob[_ngcontent-%COMP%]{width:700px;height:700px;background:radial-gradient(circle at 30% 40%,var(--tertiary) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-14s;opacity:.15;filter:blur(100px)}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0) translate(0) rotate(0)}33%{transform:translateY(-40px) translate(30px) rotate(120deg)}66%{transform:translateY(30px) translate(-40px) rotate(240deg)}}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]{position:absolute;width:4px;height:4px;background:var(--secondary);border-radius:50%;opacity:0;animation:_ngcontent-%COMP%_sparkle 8s linear infinite}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(1){top:20%;left:15%;animation-delay:1s}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(2){top:70%;right:20%;animation-delay:3s}.gradient-container[_ngcontent-%COMP%]   .sparkle[_ngcontent-%COMP%]:nth-child(3){bottom:30%;left:30%;animation-delay:5s}@keyframes _ngcontent-%COMP%_sparkle{0%,to{opacity:0;transform:scale(0)}50%{opacity:.8;transform:scale(1)}}.gradient-container[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{border-radius:var(--fs-md)}']})};export{G as Login};
