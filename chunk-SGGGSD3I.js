import{a as te}from"./chunk-MBX6IFDR.js";import{a as L,b as $,c as v,d as j,e as q,h as B,i as U,m as H,p as J,q as K,r as Q,s as X,w as Y,x as Z,y as ee}from"./chunk-7VSFVQGQ.js";import{b as G}from"./chunk-IHSWM4ZR.js";import{b as W}from"./chunk-FBJM6ARG.js";import{c as D,d as z,m as A}from"./chunk-VYE6ILYG.js";import{$a as g,Bb as T,Db as P,Eb as r,Fb as I,Ga as s,Gb as x,Hb as N,Jb as y,Kb as w,Lb as E,Ob as C,Ra as M,Wa as O,da as R,g as h,hb as d,ia as u,ib as n,ja as p,jb as t,kb as _,pb as S,sb as f,ub as m}from"./chunk-3SWAHN2Y.js";var V=()=>({standalone:!0});function ne(l,i){if(l&1&&(n(0,"option",37),r(1),t()),l&2){let e=i.$implicit;d("value",e),s(),I(e)}}function re(l,i){if(l&1){let e=S();n(0,"button",50),f("click",function(){u(e);let o=m().index,c=m();return p(c.deleteShift(o))}),n(1,"span",13),r(2,"delete"),t()()}}function ae(l,i){if(l&1&&(n(0,"span",43),r(1),t()),l&2){let e=i.$implicit,a=i.index,o=m().$implicit,c=m();T("active",c.isDaySelected(o.days_of_week,a)),s(),x(" ",e," ")}}function oe(l,i){if(l&1){let e=S();n(0,"div",38)(1,"div",39)(2,"div",40)(3,"h3",41),r(4),t(),n(5,"div",42)(6,"span",43)(7,"span",44),r(8,"access_time"),t(),r(9),t(),n(10,"span",43),r(11),t()()(),n(12,"div",2)(13,"button",45),f("click",function(){let o=u(e).index,c=m();return p(c.toggleShiftActive(o))}),n(14,"span",13),r(15),t()(),n(16,"button",46),f("click",function(){let o=u(e).index,c=m();return p(c.editShift(o))}),n(17,"span",13),r(18,"edit"),t()(),g(19,re,3,0,"button",47),t()(),n(20,"div",48),g(21,ae,2,3,"span",49),t()()}if(l&2){let e=i.$implicit,a=m();s(4),I(e.name),s(5),N(" ",e.start_time.substring(0,5)," - ",e.end_time.substring(0,5)," "),s(),P(e.is_active?"active":"warning"),s(),x(" ",e.is_active?"Attivo":"Disattivato"," "),s(2),T("text-green-500",!e.is_active)("text-orange-500",e.is_active),d("title",e.is_active?"Disattiva turno":"Attiva turno"),s(2),x(" ",e.is_active?"pause":"play_arrow"," "),s(4),d("ngIf",a.shifts.length>1),s(2),d("ngForOf",a.weekDays)}}function se(l,i){if(l&1){let e=S();n(0,"button",51),f("click",function(){u(e);let o=m();return p(o.addNewShift())}),n(1,"span",13),r(2,"add"),t(),r(3," Aggiungi Nuovo Turno "),t()}}function le(l,i){l&1&&(n(0,"span",13),r(1,"sync"),t())}function ce(l,i){l&1&&(n(0,"span",13),r(1,"save"),t())}function de(l,i){l&1&&(n(0,"span"),r(1,"Salvataggio..."),t())}function me(l,i){l&1&&(n(0,"span"),r(1,"Salva Impostazioni"),t())}function ue(l,i){if(l&1){let e=S();n(0,"label",24)(1,"input",65),f("change",function(o){let c=u(e).index,k=m(2);return p(k.toggleCurrentShiftDay(c,o))}),t(),n(2,"div",26)(3,"strong"),r(4),t()()()}if(l&2){let e=i.$implicit,a=i.index,o=m(2);s(),d("checked",o.isDaySelected(o.currentShift.days_of_week,a)),s(3),I(e)}}function pe(l,i){if(l&1){let e=S();n(0,"div",52),f("click",function(){u(e);let o=m();return p(o.closeShiftModal())}),n(1,"div",53),f("click",function(o){return u(e),p(o.stopPropagation())}),n(2,"div",54)(3,"h2",55)(4,"span",13),r(5,"schedule"),t(),r(6),t(),n(7,"button",56),f("click",function(){u(e);let o=m();return p(o.closeShiftModal())}),n(8,"span",13),r(9,"close"),t()()(),n(10,"div",57)(11,"div",7)(12,"div",8)(13,"label",12)(14,"span",13),r(15,"badge"),t(),r(16," Nome Turno * "),t(),n(17,"input",58),E("ngModelChange",function(o){u(e);let c=m();return w(c.currentShift.name,o)||(c.currentShift.name=o),p(o)}),t()(),n(18,"div",8)(19,"div",11)(20,"label",12)(21,"span",13),r(22,"schedule"),t(),r(23," Ora Inizio * "),t(),n(24,"input",59),E("ngModelChange",function(o){u(e);let c=m();return w(c.currentShift.start_time,o)||(c.currentShift.start_time=o),p(o)}),t()(),n(25,"div",11)(26,"label",12)(27,"span",13),r(28,"schedule"),t(),r(29," Ora Fine * "),t(),n(30,"input",59),E("ngModelChange",function(o){u(e);let c=m();return w(c.currentShift.end_time,o)||(c.currentShift.end_time=o),p(o)}),t()()(),n(31,"div",8)(32,"label",24)(33,"input",60),E("ngModelChange",function(o){u(e);let c=m();return w(c.currentShift.is_active,o)||(c.currentShift.is_active=o),p(o)}),t(),n(34,"div",26)(35,"strong"),r(36,"Turno attivo"),t(),n(37,"div",5),r(38,"Il turno sar\xE0 disponibile per le prenotazioni"),t()()()(),n(39,"div",40)(40,"label",12)(41,"span",13),r(42,"event"),t(),r(43," Giorni Attivi * "),t(),n(44,"div",61),g(45,ue,5,2,"label",62),t()()()(),n(46,"div",63)(47,"button",51),f("click",function(){u(e);let o=m();return p(o.closeShiftModal())}),n(48,"span",13),r(49,"close"),t(),r(50," Annulla "),t(),n(51,"button",64),f("click",function(){u(e);let o=m();return p(o.saveShift())}),n(52,"span",13),r(53,"save"),t(),r(54),t()()()()}if(l&2){let e=m();s(6),x(" ",e.editingShift==="new"?"Aggiungi Nuovo Turno":"Modifica Turno"," "),s(11),y("ngModel",e.currentShift.name),d("ngModelOptions",C(12,V)),s(7),y("ngModel",e.currentShift.start_time),d("ngModelOptions",C(13,V)),s(6),y("ngModel",e.currentShift.end_time),d("ngModelOptions",C(14,V)),s(3),y("ngModel",e.currentShift.is_active),d("ngModelOptions",C(15,V)),s(12),d("ngForOf",e.weekDays),s(6),d("disabled",!e.isCurrentShiftValid()),s(3),x(" ",e.editingShift==="new"?"Aggiungi Turno":"Salva Modifiche"," ")}}var ie=class l{constructor(i,e,a){this.fb=i;this.supabaseService=e;this.auth=a;this.supabaseClient=this.supabaseService.getSupabaseClient()}settingsForm;loading=!1;restaurantId;logoPreview;coverPreview;showShiftModal=!1;shiftService=R(te);shiftsSubscription;shifts=[];editingShift=null;currentShift=this.createEmptyShift();weekDays=["Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato","Domenica"];cuisineTypes=["Italiana","Giapponese","Cinese","Indiana","Messicana","Francese","Spagnola","Thailandese","Greca","Americana","Vegetariana","Vegana"];supabaseClient;ngOnInit(){return h(this,null,function*(){this.initForm(),yield this.loadRestaurantData(),this.setupShiftsSubscription()})}ngOnDestroy(){this.shiftsSubscription&&this.shiftsSubscription.unsubscribe()}setupShiftsSubscription(){this.shiftsSubscription=this.shiftService.shifts$.subscribe(i=>{this.shifts=i})}initForm(){this.settingsForm=this.fb.group({name:["",[v.required,v.minLength(2)]],description:[""],address:["",v.required],phone:["",[v.required,v.pattern(/^\+?\d{8,15}$/)]],email:["",[v.required,v.email]],cuisine_type:[""],accepts_delivery:[!1],accepts_takeaway:[!1],allow_table_selection:[!1],is_active:[!0]})}loadRestaurantData(){return h(this,null,function*(){this.loading=!0;try{let i=this.auth.currentUserValue;if(!i)throw new Error("Utente non loggato");let{data:e,error:a}=yield this.supabaseClient.from("restaurants").select("*").eq("owner_id",i.id).single();if(a)throw a;if(!e)throw new Error("Ristorante non trovato");this.restaurantId=e.id,this.patchForm(e),this.logoPreview=e.logo_url||void 0,this.coverPreview=e.cover_image_url||void 0}catch(i){alert("Errore caricamento: "+(i.message||"Impossibile caricare i dati")),console.error(i)}finally{this.loading=!1}})}patchForm(i){this.settingsForm.patchValue({name:i.name,description:i.description||"",address:i.address,phone:i.phone,email:i.email,cuisine_type:i.cuisine_type||"",accepts_delivery:i.accepts_delivery,accepts_takeaway:i.accepts_takeaway,allow_table_selection:i.allow_table_selection,is_active:i.is_active})}createEmptyShift(){return{name:"",start_time:"12:00",end_time:"15:00",days_of_week:[1,2,3,4,5,6,7],is_active:!0}}addNewShift(){this.editingShift="new",this.currentShift=this.createEmptyShift(),this.showShiftModal=!0}editShift(i){this.editingShift=i;let e=this.shifts[i];this.currentShift={name:e.name,start_time:e.start_time,end_time:e.end_time,days_of_week:[...e.days_of_week],is_active:e.is_active},this.showShiftModal=!0}closeShiftModal(){this.showShiftModal=!1,this.editingShift=null}saveShift(){return h(this,null,function*(){if(!(!this.isCurrentShiftValid()||!this.restaurantId)){this.loading=!0;try{if(this.editingShift==="new")if(yield this.shiftService.createShift(this.currentShift))alert("Turno creato con successo!"),this.closeShiftModal();else throw new Error("Errore nella creazione del turno");else if(typeof this.editingShift=="number"){let i=this.shifts[this.editingShift].id;if(yield this.shiftService.updateShift(i,this.currentShift))alert("Turno aggiornato con successo!"),this.closeShiftModal();else throw new Error("Errore nell'aggiornamento del turno")}}catch(i){alert("Errore salvataggio turno: "+i.message),console.error(i)}finally{this.loading=!1}}})}deleteShift(i){return h(this,null,function*(){if(!confirm("Sei sicuro di voler eliminare questo turno?"))return;let e=this.shifts[i].id;if(e){this.loading=!0;try{if(yield this.shiftService.deleteShift(e))alert("Turno eliminato con successo!");else throw new Error("Errore nell'eliminazione del turno")}catch(a){alert("Errore eliminazione turno: "+a.message),console.error(a)}finally{this.loading=!1}}})}toggleCurrentShiftDay(i,e){let a=e.target.checked,o=i+1;a?this.currentShift.days_of_week.includes(o)||this.currentShift.days_of_week.push(o):this.currentShift.days_of_week=this.currentShift.days_of_week.filter(c=>c!==o)}isCurrentShiftValid(){return!!(this.currentShift.name&&this.currentShift.start_time&&this.currentShift.end_time&&this.currentShift.days_of_week.length>0)}isDaySelected(i,e){let a=e+1;return i.includes(a)}onFileSelect(i,e){return h(this,null,function*(){let a=i.target;if(!a.files?.length||!this.restaurantId)return;let o=a.files[0],c=5*1024*1024;if(o.size>c){alert("Immagine troppo grande (max 5MB)");return}let k=`restaurants/${this.restaurantId}/${e}s/${Date.now()}_${o.name}`;this.loading=!0;try{let{error:b}=yield this.supabaseClient.storage.from("restaurant-images").upload(k,o,{upsert:!0});if(b)throw b;let{data:{publicUrl:F}}=this.supabaseClient.storage.from("restaurant-images").getPublicUrl(k);e==="logo"?this.logoPreview=F:this.coverPreview=F,alert(`${e==="logo"?"Logo":"Copertina"} caricata!`)}catch(b){alert("Errore upload: "+b.message),console.error(b)}finally{this.loading=!1}})}onSubmit(){return h(this,null,function*(){if(!(this.settingsForm.invalid||!this.restaurantId)){this.loading=!0;try{let i=this.settingsForm.value,e={name:i.name,description:i.description||null,address:i.address,phone:i.phone,email:i.email,cuisine_type:i.cuisine_type||null,accepts_delivery:i.accepts_delivery,accepts_takeaway:i.accepts_takeaway,allow_table_selection:i.allow_table_selection,is_active:i.is_active,updated_at:new Date().toISOString()};this.logoPreview&&(e.logo_url=this.logoPreview),this.coverPreview&&(e.cover_image_url=this.coverPreview);let{error:a}=yield this.supabaseClient.from("restaurants").update(e).eq("id",this.restaurantId);if(a)throw a;alert("Impostazioni salvate con successo!")}catch(i){alert("Errore salvataggio: "+i.message),console.error(i)}finally{this.loading=!1}}})}toggleShiftActive(i){return h(this,null,function*(){let e=this.shifts[i],a=!e.is_active;if(confirm(`Sei sicuro di voler ${a?"attivare":"disattivare"} il turno "${e.name}"?`)){this.loading=!0;try{if(!(yield this.shiftService.updateShift(e.id,{is_active:a})))throw new Error(`Errore nella ${a?"attivazione":"disattivazione"} del turno`);alert(`Turno "${e.name}" ${a?"attivato":"disattivato"} con successo!`)}catch(o){alert(`Errore: ${o.message}`),console.error(o)}finally{this.loading=!1}}})}toggleRestaurantActive(){return h(this,null,function*(){if(!this.restaurantId)return;let i=this.settingsForm.get("is_active")?.value,e=!i;if(!i&&!confirm(`Sei sicuro di voler disattivare il ristorante?

I clienti non potranno pi\xF9 vederlo n\xE9 effettuare ordini fino a quando non lo riattiverai.`)){this.settingsForm.patchValue({is_active:e},{emitEvent:!1});return}this.loading=!0;try{let{error:a}=yield this.supabaseClient.from("restaurants").update({is_active:i,updated_at:new Date().toISOString()}).eq("id",this.restaurantId);if(a)throw a;alert(i?"Ristorante riattivato! Ora \xE8 visibile ai clienti.":"Ristorante disattivato correttamente.")}catch(a){alert("Errore: "+a.message),this.settingsForm.patchValue({is_active:e},{emitEvent:!1})}finally{this.loading=!1}})}static \u0275fac=function(e){return new(e||l)(M(Y),M(W),M(G))};static \u0275cmp=O({type:l,selectors:[["app-restaurant-settings"]],decls:115,vars:10,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"flex","flex-col","gap-sm",3,"ngSubmit","formGroup"],[1,"form-card"],[1,"form-row","mb-md"],[1,"material-icons","text-md"],[1,"text-md","font-semibold","m-0"],[1,"form-group"],[1,"standard-label"],[1,"material-icons"],["type","text","formControlName","name","placeholder","Es: Trattoria da Mario"],["type","email","formControlName","email","placeholder","info@ristorante.it"],["type","tel","formControlName","phone","placeholder","+39 123 456 7890"],["formControlName","cuisine_type"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","address","placeholder","Via Roma 123, Milano"],["formControlName","description","rows","3","placeholder","Racconta la storia del tuo ristorante..."],[1,"flex","items-center","gap-sm","mb-md"],[1,"flex","flex-col","gap-md"],[1,"checkbox-label"],["type","checkbox","formControlName","accepts_delivery"],[1,"checkbox-content"],["type","checkbox","formControlName","accepts_takeaway"],["type","checkbox","formControlName","allow_table_selection"],["type","checkbox","formControlName","is_active",3,"change"],["class","shift-item",4,"ngFor","ngForOf"],["type","button","class","promethea-button ghost",3,"click",4,"ngIf"],[1,"modal-footer","p-md0"],["type","submit",1,"promethea-button",3,"disabled"],["class","material-icons",4,"ngIf"],[4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value"],[1,"shift-item"],[1,"flex","justify-between","items-start","mb-sm","p-sm"],[1,"flex","flex-col","gap-sm"],[1,"font-semibold","text-md"],[1,"flex","flex-wrap","gap-sm"],[1,"chip"],[1,"material-icons","text-sm"],["type","button",1,"icon-button",3,"click","title"],["type","button","title","Modifica turno",1,"icon-button",3,"click"],["type","button","class","icon-button","title","Elimina turno",3,"click",4,"ngIf"],[1,"flex","flex-wrap","gap-sm","mt-sm","p-sm0"],["class","chip",3,"active",4,"ngFor","ngForOf"],["type","button","title","Elimina turno",1,"icon-button",3,"click"],["type","button",1,"promethea-button","ghost",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],[1,"section-title","m-0"],[1,"icon-button",3,"click"],[1,"modal-content"],["type","text","placeholder","Es: Pranzo, Cena","autofocus","",3,"ngModelChange","ngModel","ngModelOptions"],["type","time",3,"ngModelChange","ngModel","ngModelOptions"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[1,"grid-cards"],["class","checkbox-label",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"promethea-button",3,"click","disabled"],["type","checkbox",3,"change","checked"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),r(4,"settings"),t(),n(5,"h1",4),r(6,"Impostazioni Ristorante"),t()(),n(7,"p",5),r(8,"Gestisci le informazioni e i servizi del tuo ristorante"),t()(),n(9,"form",6),f("ngSubmit",function(){return a.onSubmit()}),n(10,"div",7)(11,"div",8)(12,"span",9),r(13,"info"),t(),n(14,"h2",10),r(15,"Informazioni Base"),t()(),n(16,"div",8)(17,"div",11)(18,"label",12)(19,"span",13),r(20,"restaurant"),t(),r(21," Nome Ristorante * "),t(),_(22,"input",14),t()(),n(23,"div",8)(24,"div",11)(25,"label",12)(26,"span",13),r(27,"email"),t(),r(28," Email * "),t(),_(29,"input",15),t(),n(30,"div",11)(31,"label",12)(32,"span",13),r(33,"phone"),t(),r(34," Telefono * "),t(),_(35,"input",16),t()(),n(36,"div",8)(37,"div",11)(38,"label",12)(39,"span",13),r(40,"local_dining"),t(),r(41," Tipo di Cucina "),t(),n(42,"select",17)(43,"option",18),r(44,"Seleziona..."),t(),g(45,ne,2,2,"option",19),t()(),n(46,"div",11)(47,"label",12)(48,"span",13),r(49,"location_on"),t(),r(50," Indirizzo * "),t(),_(51,"input",20),t()(),n(52,"div",8)(53,"label",12)(54,"span",13),r(55,"description"),t(),r(56," Descrizione "),t(),_(57,"textarea",21),t()(),n(58,"div",7)(59,"div",22)(60,"span",9),r(61,"room_service"),t(),n(62,"h2",10),r(63,"Servizi Offerti"),t()(),n(64,"div",23)(65,"label",24),_(66,"input",25),n(67,"div",26)(68,"strong"),r(69,"Consegna a domicilio"),t(),n(70,"div",5),r(71,"I clienti possono ordinare con consegna"),t()()(),n(72,"label",24),_(73,"input",27),n(74,"div",26)(75,"strong"),r(76,"Asporto"),t(),n(77,"div",5),r(78,"I clienti possono ritirare in loco"),t()()(),n(79,"label",24),_(80,"input",28),n(81,"div",26)(82,"strong"),r(83,"Prenotazione tavolo"),t(),n(84,"div",5),r(85,"I clienti possono scegliere il tavolo"),t()()()()(),n(86,"div",7)(87,"div",22)(88,"span",9),r(89,"visibility"),t(),n(90,"h2",10),r(91,"Stato Ristorante"),t()(),n(92,"label",24)(93,"input",29),f("change",function(){return a.toggleRestaurantActive()}),t(),n(94,"div",26)(95,"strong"),r(96,"Ristorante attivo"),t(),n(97,"div",5),r(98,"Visibile ai clienti e accettazione ordini"),t()()()(),n(99,"div",7)(100,"div",22)(101,"span",9),r(102,"schedule"),t(),n(103,"h2",10),r(104,"Turni di Lavoro"),t()(),n(105,"div",23),g(106,oe,22,14,"div",30)(107,se,4,0,"button",31),t()(),n(108,"div",32)(109,"button",33),g(110,le,2,0,"span",34)(111,ce,2,0,"span",34)(112,de,2,0,"span",35)(113,me,2,0,"span",35),t()()()(),g(114,pe,55,16,"div",36)),e&2&&(s(9),d("formGroup",a.settingsForm),s(36),d("ngForOf",a.cuisineTypes),s(61),d("ngForOf",a.shifts),s(),d("ngIf",a.editingShift===null),s(2),d("disabled",a.loading||a.settingsForm.invalid),s(),d("ngIf",a.loading),s(),d("ngIf",!a.loading),s(),d("ngIf",a.loading),s(),d("ngIf",!a.loading),s(),d("ngIf",a.showShiftModal))},dependencies:[A,D,z,ee,U,Q,X,$,L,K,j,q,H,J,Z,B],styles:[".shift-item[_ngcontent-%COMP%]{padding:var(--gap-md);border:1px solid var(--smoke-1);border-radius:12px;transition:all .2s ease}.shift-item[_ngcontent-%COMP%]:hover{border-color:var(--secondary);background:var(--smoke-1)}.shift-form[_ngcontent-%COMP%]{border:2px solid var(--smoke-2)}.chip.warning[_ngcontent-%COMP%]{background:color-mix(in srgb,#f59e0b 20%,transparent);color:#f59e0b}.text-green-500[_ngcontent-%COMP%]{color:#10b981}.text-orange-500[_ngcontent-%COMP%]{color:#f59e0b}.material-icons[_ngcontent-%COMP%]{transition:all .2s ease}@media (max-width: 768px){.shift-item[_ngcontent-%COMP%]{padding:var(--gap-sm)}.shift-item[_ngcontent-%COMP%]   .flex-wrap[_ngcontent-%COMP%]{justify-content:flex-start}}@media (max-width: 480px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr}.md\\\\[_ngcontent-%COMP%]:col-span-2{grid-column:1}}"]})};export{ie as RestaurantSettings};
