import{b as h}from"./chunk-ISGJYCJJ.js";import{b as f}from"./chunk-NPOGW2A3.js";import{V as S,_ as n,g as d}from"./chunk-UNLQURJ5.js";import{a as l,b as c,j as o}from"./chunk-4ZZIO3ZI.js";var m=class s{supabaseService=n(f);authService=n(h);suppliersSubject=new d([]);suppliers$=this.suppliersSubject.asObservable();loadSuppliers(){return o(this,null,function*(){try{let r=this.authService.currentUserValue;if(!r){console.error("No user authenticated");return}let{data:e,error:t}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",r.id).limit(1);if(t||!e?.length){console.error("\u274C No restaurant found for user:",r.id);return}let a=e[0].id,{data:u,error:i}=yield this.supabaseService.getSupabaseClient().from("suppliers").select("*").eq("restaurant_id",a).order("company_name");if(i)throw i;this.suppliersSubject.next(u||[])}catch(r){console.error("Error loading suppliers:",r)}})}createSupplier(r){return o(this,null,function*(){try{let e=this.authService.currentUserValue;if(!e)return console.error("No user authenticated"),null;let{data:t,error:a}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",e.id).limit(1);if(a||!t?.length)return console.error("\u274C No restaurant found for user:",e.id),null;let u=t[0].id,i=c(l({},r),{restaurant_id:u,user_id:r.user_id||null,is_platform_supplier:r.is_platform_supplier??!1,is_approved:r.is_approved??!0}),{data:v,error:p}=yield this.supabaseService.getSupabaseClient().from("suppliers").insert(i).select().single();if(p)throw p;return yield this.loadSuppliers(),v}catch(e){return console.error("Error creating supplier:",e),null}})}getSuppliers(){return this.suppliersSubject.value}getSupplierById(r){return this.suppliersSubject.value.find(e=>e.id===r)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=S({token:s,factory:s.\u0275fac,providedIn:"root"})};export{m as a};
