import{a as L,b as k,c as u,d as P,e as I,i as F,k as T,n as N,u as O,w as R}from"./chunk-Y4TUQNZC.js";import{a as C}from"./chunk-KNL3CWA3.js";import{e as _,k as y,t as E,u as S,z as M}from"./chunk-DCWKKS33.js";import{Db as v,Eb as g,La as s,Nb as f,Qb as i,Rb as h,Sb as x,ab as w,ea as c,f as b,fb as d,qb as l,rb as r,sb as e,tb as p}from"./chunk-K5RDB55Y.js";function G(o,a){o&1&&(r(0,"span"),i(1,"L'email \xE8 obbligatoria"),e())}function V(o,a){o&1&&(r(0,"span"),i(1,"Inserisci un'email valida"),e())}function z(o,a){if(o&1&&(r(0,"div",37)(1,"span",11),i(2,"error"),e(),d(3,G,2,0,"span",38)(4,V,2,0,"span",38),e()),o&2){let n=g();s(3),l("ngIf",n.email==null||n.email.errors==null?null:n.email.errors.required),s(),l("ngIf",n.email==null||n.email.errors==null?null:n.email.errors.email)}}function j(o,a){o&1&&(r(0,"span"),i(1,"La password \xE8 obbligatoria"),e())}function q(o,a){o&1&&(r(0,"span"),i(1,"Minimo 6 caratteri"),e())}function Y(o,a){if(o&1&&(r(0,"div",37)(1,"span",11),i(2,"error"),e(),d(3,j,2,0,"span",38)(4,q,2,0,"span",38),e()),o&2){let n=g();s(3),l("ngIf",n.password==null||n.password.errors==null?null:n.password.errors.required),s(),l("ngIf",n.password==null||n.password.errors==null?null:n.password.errors.minlength)}}function B(o,a){if(o&1&&(r(0,"div",39)(1,"span",11),i(2),e(),i(3),e()),o&2){let n=g();f("error",!n.errorMessage.includes("effettuato"))("success",n.errorMessage.includes("effettuato")),s(2),x(" ",n.errorMessage.includes("effettuato")?"check_circle":"warning"," "),s(),x(" ",n.errorMessage," ")}}function $(o,a){o&1&&p(0,"span",40)}function H(o,a){o&1&&(r(0,"span",11),i(1,"login"),e())}var A=class o{fb=c(O);authService=c(C);router=c(E);loginForm;isLoading=!1;errorMessage="";showPassword=!1;constructor(){this.loginForm=this.fb.group({email:["",[u.required,u.email]],password:["",[u.required,u.minLength(6)]],rememberMe:[!1]}),this.isProduction||this.prefillDemoCredentials()}onSubmit(){return b(this,null,function*(){if(this.loginForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="";let{email:a,password:n,rememberMe:t}=this.loginForm.value;try{let m=yield this.authService.login(a,n,t);if(m.error){let D=m.error instanceof Error?m.error.message:String(m.error);this.errorMessage=this.getErrorMessage(D)}else m.data?.user&&(console.log("Login effettuato con successo"),this.errorMessage="Accesso effettuato! Reindirizzamento...")}catch(m){console.error("Login error:",m),this.errorMessage="Errore durante il login. Riprova pi\xF9 tardi."}finally{this.isLoading=!1}})}togglePasswordVisibility(){this.showPassword=!this.showPassword}markFormGroupTouched(){Object.keys(this.loginForm.controls).forEach(a=>{this.loginForm.get(a)?.markAsTouched()})}getErrorMessage(a){return{"Invalid login credentials":"Email o password non validi.","Email not confirmed":"Email non confermata. Controlla la tua casella di posta.","Invalid email":"Email non valida.","Network error":"Errore di rete. Controlla la tua connessione.","Email rate limit exceeded":"Troppi tentativi. Riprova pi\xF9 tardi."}[a]||`Errore: ${a}`}prefillDemoCredentials(){console.log("Modalit\xE0 sviluppo: credenziali demo disponibili")}useDemoCredentials(a){a==="restaurant"?this.loginForm.patchValue({email:"ristorante@demo.com",password:"demodemo"}):this.loginForm.patchValue({email:"cliente@demo.com",password:"demodemo"})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}get isProduction(){return M.production}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=w({type:o,selectors:[["app-login"]],decls:65,vars:14,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","440px","width","100%","margin","var(--gutter-xl) auto"],[1,"section-header",2,"border-bottom","2px solid var(--smoke-color-1)","padding-bottom","var(--gutter-lg)","text-align","center"],[2,"display","flex","flex-direction","column","align-items","center","gap","var(--gutter-md)","width","100%"],[1,"material-icons",2,"font-size","var(--fs-lg)","color","var(--primary)"],[1,"section-titles"],[2,"margin","0","font-size","var(--fs-md)"],[1,"text-muted",2,"margin","0"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","email",1,"form-label"],[1,"material-icons"],["id","email","formControlName","email","type","email","placeholder","tua.email@esempio.com"],["class","status-message error",4,"ngIf"],["for","password",1,"form-label"],[2,"position","relative"],["id","password","formControlName","password","placeholder","La tua password",2,"padding-right","50px",3,"type"],["type","button",1,"icon-button",2,"position","absolute","right","var(--gutter-sm)","top","50%","transform","translateY(-50%)","background","none","border","none","color","var(--text-muted)","cursor","pointer",3,"click"],[2,"display","flex","justify-content","space-between","align-items","center","margin","var(--gutter-md) 0"],[1,"checkbox-label"],["id","rememberMe","formControlName","rememberMe","type","checkbox"],["routerLink","/forgot-password",1,"link",2,"font-size","var(--fs-sm)"],["class","status-message",3,"error","success",4,"ngIf"],["type","submit",1,"promethea-button",2,"width","100%","margin-top","var(--gutter-md)",3,"disabled"],["class","loading-spinner","style","width: 16px; height: 16px; border-width: 2px;",4,"ngIf"],["class","material-icons",4,"ngIf"],[1,"form-footer",2,"margin","var(--gutter-lg) 0"],[2,"display","flex","align-items","center","gap","var(--gutter-md)","width","100%"],[2,"flex","1","height","1px","background","var(--smoke-color-1)"],[1,"text-muted",2,"font-size","var(--fs-sm)"],[2,"text-align","center"],[1,"text-muted",2,"margin-bottom","var(--gutter-md)"],[1,"actions-container"],["routerLink","/register/restaurant",1,"promethea-button","outline",2,"justify-content","center"],["routerLink","/register/supplier",1,"promethea-button","secondary",2,"justify-content","center"],[1,"actions-container",2,"margin-top","var(--gutter-md)","align-items","center","flex-direction","column"],["routerLink","/register/customer",1,"promethea-button","secondary",2,"justify-content","center"],[1,"status-message","error"],[4,"ngIf"],[1,"status-message"],[1,"loading-spinner",2,"width","16px","height","16px","border-width","2px"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),i(5,"restaurant"),e(),r(6,"div",5)(7,"h1",6),i(8,"Bentornato"),e(),r(9,"p",7),i(10,"Accedi al tuo account"),e()()()(),r(11,"form",8),v("ngSubmit",function(){return t.onSubmit()}),r(12,"div",9)(13,"label",10)(14,"span",11),i(15,"email"),e(),i(16," Email * "),e(),p(17,"input",12),d(18,z,5,2,"div",13),e(),r(19,"div",9)(20,"label",14)(21,"span",11),i(22,"lock"),e(),i(23," Password * "),e(),r(24,"div",15),p(25,"input",16),r(26,"button",17),v("click",function(){return t.togglePasswordVisibility()}),r(27,"span",11),i(28),e()()(),d(29,Y,5,2,"div",13),e(),r(30,"div",18)(31,"label",19),p(32,"input",20),i(33," Ricordami "),e(),r(34,"a",21),i(35," Password dimenticata? "),e()(),d(36,B,4,6,"div",22),r(37,"button",23),d(38,$,1,0,"span",24)(39,H,2,0,"span",25),r(40,"span"),i(41),e()(),r(42,"div",26)(43,"div",27),p(44,"div",28),r(45,"span",29),i(46,"oppure"),e(),p(47,"div",28),e()(),r(48,"div",30)(49,"p",31),i(50," Non hai un account? "),e(),r(51,"div",32)(52,"a",33)(53,"span",11),i(54,"restaurant"),e(),i(55," Registra Ristorante "),e(),r(56,"a",34)(57,"span",11),i(58,"local_shipping"),e(),i(59," Registrati come Fornitore "),e()(),r(60,"div",35)(61,"a",36)(62,"span",11),i(63,"person"),e(),i(64," Registrati come Cliente "),e()()()()()()),n&2&&(s(11),l("formGroup",t.loginForm),s(6),f("error",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),s(),l("ngIf",(t.email==null?null:t.email.invalid)&&(t.email==null?null:t.email.touched)),s(7),f("error",(t.password==null?null:t.password.invalid)&&(t.password==null?null:t.password.touched)),l("type",t.showPassword?"text":"password"),s(3),h(t.showPassword?"visibility_off":"visibility"),s(),l("ngIf",(t.password==null?null:t.password.invalid)&&(t.password==null?null:t.password.touched)),s(7),l("ngIf",t.errorMessage),s(),l("disabled",t.isLoading||t.loginForm.invalid),s(),l("ngIf",t.isLoading),s(),l("ngIf",!t.isLoading),s(2),h(t.isLoading?"Accesso in corso...":"Accedi"))},dependencies:[y,_,R,F,k,L,P,I,T,N,S],styles:["[_nghost-%COMP%]{display:block;width:100%}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--gutter-sm)}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 3px color-mix(in srgb,#ef4444 20%,transparent)}@media (max-width: 768px){.grid-form[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:var(--gutter-sm)}}input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted);opacity:.7}input[_ngcontent-%COMP%]:focus{border-color:var(--primary);box-shadow:0 0 0 3px color-mix(in srgb,var(--primary) 20%,transparent);transform:translateY(-1px)}.password-toggle[_ngcontent-%COMP%]{background:none;border:none;color:var(--text-muted);cursor:pointer;padding:var(--gutter-sm);border-radius:8px;transition:all .2s ease;position:absolute;right:var(--gutter-sm);top:50%;transform:translateY(-50%)}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--primary);background:var(--smoke-color-1)}@media (max-width: 480px){.form-card[_ngcontent-%COMP%]{margin:var(--gutter-md) auto;border-radius:16px}.section-header[_ngcontent-%COMP%]{padding:var(--gutter-md)}}"]})};export{A as Login};
