import{b as d,d as g}from"./chunk-M5ABBUWH.js";import{Z as c,ca as l,ic as r,pa as o}from"./chunk-QIXMMTC2.js";import{j as a}from"./chunk-4ZZIO3ZI.js";var h=[{id:"welcome",title:"Benvenuto su Promethea!",description:"Sei nel posto giusto per gestire il tuo ristorante in modo semplice e completo. Ti mostriamo in pochi passi tutto quello che puoi fare.",icon:"sparkles"},{id:"dashboard",title:"Dashboard & Report",description:"Panoramica del ristorante",icon:"layout-dashboard",route:"/restaurant/dashboard",tooltipTarget:'[data-tutorial="dashboard"]',tooltipPosition:"right",subSteps:[{tooltipTarget:'[data-tutorial="dashboard-reservation"]',tooltipPosition:"bottom",title:"Prenotazioni del giorno",description:"Qui vedi le prenotazioni di oggi, confrontato con ieri e con la media settimanale."},{tooltipTarget:'[data-tutorial="dashboard-orders"]',tooltipPosition:"bottom",title:"Ordini in tempo reale",description:"Numero di ordini aperti in questo momento. Clicca per gestirli direttamente."},{tooltipTarget:'[data-tutorial="dashboard-top-dishes"]',tooltipPosition:"right",title:"Piatti pi\xF9 venduti",description:"I tuoi bestseller di oggi. Utile per pianificare la produzione cucina."}]},{id:"inventory",title:"Ingredienti & Inventario",description:"Tieni il magazzino sempre aggiornato. Gli ingredienti alimentano il food cost di ogni piatto.",icon:"package",route:"/restaurant/inventory",tooltipTarget:'[data-tutorial="inventory"]',tooltipPosition:"right",requiredPermission:"manage_inventory",subSteps:[{tooltipTarget:'[data-tutorial="inventory-total"]',tooltipPosition:"bottom",title:"Totale ingredienti",description:"Il numero totale di ingredienti nel tuo inventario. Clicca per vedere il dettaglio."},{tooltipTarget:'[data-tutorial="inventory-low-stock"]',tooltipPosition:"bottom",title:"Scorte basse",description:"Ingredienti sotto la soglia minima. Tienili sempre monitorati per non trovarti senza."},{tooltipTarget:'[data-tutorial="inventory-shopping-list"]',tooltipPosition:"left",title:"Lista della spesa",description:"Segna la lista della spesa in base alle scorte basse. Un click nella tabella per aggiungere gli ingredienti e sei pronto per l'ordine."},{tooltipTarget:'[data-tutorial="inventory-search"]',tooltipPosition:"top",title:"Cerca e filtra",description:"Cerca un ingrediente per nome o filtra per categoria e fornitore per trovarlo subito."},{tooltipTarget:'[data-tutorial="inventory-table"]',tooltipPosition:"top",title:"Tabella ingredienti",description:"Tutti i tuoi ingredienti con quantit\xE0, unit\xE0, soglia minima e costo. Modificali direttamente dalla riga."}]},{id:"menu",title:"Crea il tuo menu digitale",description:"Aggiungi piatti, categorie e varianti. Il food cost si calcola automaticamente.",icon:"utensils",route:"/restaurant/menu",tooltipTarget:'[data-tutorial="menu"]',tooltipPosition:"right",requiredPermission:"manage_menu",subSteps:[{tooltipTarget:'[data-tutorial="menu-total-dishes"]',tooltipPosition:"bottom",title:"Totale piatti",description:"Il numero di piatti nel menu attivo. Si aggiorna in tempo reale in base ai filtri applicati."},{tooltipTarget:'[data-tutorial="menu-avg-price"]',tooltipPosition:"bottom",title:"Prezzo medio",description:"Il prezzo medio dei piatti filtrati. Utile per capire il posizionamento del tuo menu."},{tooltipTarget:'[data-tutorial="menu-avg-margin"]',tooltipPosition:"bottom",title:"Margine medio",description:"Il margine medio calcolato sui piatti visibili. Pi\xF9 \xE8 alto, meglio \xE8 per il tuo business."},{tooltipTarget:'[data-tutorial="menu-avg-foodcost"]',tooltipPosition:"bottom",title:"Food cost medio",description:"La percentuale media di food cost. L'obiettivo standard \xE8 tenerlo sotto il 30%."},{tooltipTarget:'[data-tutorial="menu-selector"]',tooltipPosition:"bottom",title:"Gestisci i tuoi menu",description:"Seleziona un menu esistente, creane uno nuovo, impostalo come preferito o attivo. Puoi avere menu diversi per pranzo, cena o stagione."},{tooltipTarget:'[data-tutorial="menu-print"]',tooltipPosition:"bottom",title:"Stampa il menu",description:"Stampa la versione staff con food cost e margini, oppure la versione cliente standard o personalizzata."},{tooltipTarget:'[data-tutorial="menu-chart"]',tooltipPosition:"top",title:"Grafico food cost",description:"Visualizza food cost e margine di ogni piatto in un istogramma. Ordina per nome o per food cost per trovare subito i piatti meno redditizi."},{tooltipTarget:'[data-tutorial="menu-filters"]',tooltipPosition:"bottom",title:"Cerca e filtra i piatti",description:"Filtra per categoria, stato o prezzo. Usa i bottoni per aggiungere un nuovo piatto, una bevanda o resettare i filtri."},{tooltipTarget:'[data-tutorial="menu-table"]',tooltipPosition:"top",title:"Tabella piatti",description:"Tutti i tuoi piatti con prezzo, food cost e margine. Clicca su una riga per modificarla o eliminarla."}]},{id:"recipe",title:"Aggiungi le ricette",description:"Salva le ricette dei tuoi piatti con specifiche tecniche per il team.",icon:"scroll-text",route:"/restaurant/recipe",tooltipTarget:'[data-tutorial="recipe"]',tooltipPosition:"right",requiredPermission:"manage_inventory",subSteps:[{tooltipTarget:'[data-tutorial="recipe-search"]',tooltipPosition:"bottom",title:"Cerca ricette",description:"Filtra le ricette per nome o categoria. Le ricette vengono create automaticamente quando aggiungi un piatto nel menu."},{tooltipTarget:'[data-tutorial="recipe-list"]',tooltipPosition:"top",title:"Lista ricette",description:"Tutte le tue ricette in un colpo d'occhio. Clicca su una ricetta per aprirla e aggiungere le specifiche di preparazione generali o per singolo ingrediente."}]},{id:"floor-plan",title:"Mappa Ristorante",description:"Crea la mappa delle tue sale e gestisci i tavoli prenotabili.",icon:"table-2",route:"/restaurant/floor-plan",tooltipTarget:'[data-tutorial="floor-plan"]',tooltipPosition:"right",requiredPermission:"view_table_map",subSteps:[{tooltipTarget:'[data-tutorial="floor-plan-selector"]',tooltipPosition:"bottom",title:"Seleziona la sala",description:"Ogni mappa rappresenta una sala del tuo ristorante. Puoi avere pi\xF9 versioni della stessa sala per gestire cambi di layout frequenti."},{tooltipTarget:'[data-tutorial="floor-plan-new"]',tooltipPosition:"left",title:"Crea una nuova sala",description:"Dai un nome alla sala, scegli le dimensioni della mappa e inizia a disegnare i tavoli. Puoi creare sala interna, esterna, terrazza e molto altro."},{tooltipTarget:'[data-tutorial="floor-plan-editor"]',tooltipPosition:"top",title:"Editor tavoli",description:"Disegna i tavoli in forma quadrata, rettangolare o tonda. Per ogni tavolo puoi impostare nome, numero, capienza, se \xE8 prenotabile online e puoi unire pi\xF9 tavoli in uno grande."}]},{id:"table-map",title:"Gestisci comande e ordini",description:"Ricevi e gestisci le comande dal tavolo in tempo reale. Ogni ordine viene inviato automaticamente alla cucina.",icon:"utensils-crossed",route:"/restaurant/table-map",tooltipTarget:'[data-tutorial="table-map"]',tooltipPosition:"right",requiredPermission:"manage_reservations"},{id:"order-editor",title:"Prendi un ordine",description:"Da qui puoi inserire le ordinazioni dei clienti, specificando quantit\xE0, note e varianti. L\u2019ordine viene inviato direttamente in cucina.",icon:"shopping-cart",route:"/restaurant/table-map",tooltipTarget:'[data-tutorial="order-editor"]',tooltipPosition:"right",requiredPermission:"manage_reservations"},{id:"staff",title:"Gestisci il personale",description:"Aggiungi il tuo staff, assegna ruoli e permessi personalizzati. Ogni membro accede solo alle sezioni di sua competenza.",icon:"users",route:"/restaurant/staff-management",tooltipTarget:'[data-tutorial="staff"]',tooltipPosition:"right",requiredPermission:"manage_staff"},{id:"restaurant-settings",title:"Configura il tuo ristorante",description:"Inserisci nome, indirizzo, orari e contatti. Questi dati saranno visibili ai clienti e usati da tutti i moduli.",icon:"settings",route:"/restaurant/settings",tooltipTarget:'[data-tutorial="restaurant-settings"]',tooltipPosition:"right",requiredPermission:"manage_restaurant_settings"}],S=[{id:"welcome",title:"Benvenuto su Promethea!",description:"Scopri i migliori ristoranti della tua zona, ordina direttamente dal tavolo o prenota il tuo posto preferito.",icon:"sparkles"},{id:"discover",title:"Scopri i ristoranti vicino a te",description:"Cerca ristoranti per cucina, zona o valutazione. Ogni locale ha il suo menu digitale sempre aggiornato.",icon:"utensils",route:"/customer/restaurant/restaurant-list",tooltipTarget:'[data-tutorial="discover"]',tooltipPosition:"right"},{id:"order",title:"I tuoi ordini",description:"Scansiona il QR code al tavolo per ordinare direttamente, oppure prenota in anticipo con pochi tocchi.",icon:"shopping-bag",route:"/customer/orders",tooltipTarget:'[data-tutorial="order"]',tooltipPosition:"right"},{id:"profile",title:"Il tuo profilo e preferenze",description:"Salva i tuoi ristoranti preferiti, gestisci le allergie alimentari e consulta lo storico dei tuoi ordini.",icon:"user",route:"/customer/profile-user",tooltipTarget:'[data-tutorial="profile"]',tooltipPosition:"right"}],m=class s{authService=l(g);supabaseService=l(d);_isVisible=o(!1);_currentStep=o(0);_phase=o("modal");_type=o("customer");_showSkipConfirm=o(!1);_refreshTrigger=o(0);refreshSignal=this._refreshTrigger.asReadonly();isVisible=this._isVisible.asReadonly();currentStep=this._currentStep.asReadonly();phase=this._phase.asReadonly();type=this._type.asReadonly();showSkipConfirm=this._showSkipConfirm.asReadonly();_currentSubStep=o(0);currentSubStep=this._currentSubStep.asReadonly();_isIntroStep=o(!1);isIntroStep=this._isIntroStep.asReadonly();steps=r(()=>{let t=this._type()==="business"?h:S;return this._getVisibleSteps(t)});refreshTooltip(){this._refreshTrigger.update(t=>t+1)}currentStepData=r(()=>{let t=this.steps(),e=this._currentStep();return t[e]??null});isLastStep=r(()=>this._currentStep()===this.steps().length-1);progress=r(()=>Math.round((this._currentStep()+1)/this.steps().length*100));checkAndStart(){return a(this,null,function*(){if(this._isVisible())return;let t=this.authService.currentUserValue;if(!t)return;let i=this.authService.getCurrentContext()==="staff"?"business":"customer",n=i==="business"?"tutorial_business_completed":"tutorial_customer_completed";try{let{data:p,error:u}=yield this.supabaseService.getSupabaseClient().from("users").select(n).eq("id",t.id).single();if(u)throw u;if(p?.[n]===!0)return}catch{if(console.warn("[Tutorial] Impossibile leggere il flag, uso cache locale"),t[n]===!0)return}this._type.set(i),this._currentStep.set(0),this._phase.set("modal"),this._showSkipConfirm.set(!1),this._isVisible.set(!0)})}nextStep(){if(this._phase()==="modal"){if(this.isLastStep()){this._phase.set("tooltip"),this._currentStep.set(0),this._currentSubStep.set(0);let t=this.steps()[0];this._isIntroStep.set((t?.subSteps?.length??0)>0)}else this._currentStep.update(t=>t+1);return}if(this._phase()==="tooltip"){if(this._isIntroStep()){this._isIntroStep.set(!1);return}if(!this.isLastSubStep()){this._currentSubStep.update(t=>t+1);return}if(this._currentSubStep.set(0),this.isLastStep())this.completeTutorial();else{this._currentStep.update(e=>e+1);let t=this.steps()[this._currentStep()];this._isIntroStep.set((t?.subSteps?.length??0)>0)}}}prevStep(){if(this._phase()==="tooltip"){if(!this._isIntroStep()&&this._currentSubStep()===0&&(this.currentStepData()?.subSteps?.length??0)>0){this._isIntroStep.set(!0);return}if(this._isIntroStep()){if(this._currentStep()>0){this._currentStep.update(i=>i-1);let e=(this.steps()[this._currentStep()]?.subSteps?.length??1)-1;this._currentSubStep.set(Math.max(0,e)),this._isIntroStep.set(!1)}return}if(this._currentSubStep()>0){this._currentSubStep.update(t=>t-1);return}if(this._currentStep()>0){this._currentStep.update(i=>i-1);let e=(this.steps()[this._currentStep()]?.subSteps?.length??1)-1;this._currentSubStep.set(Math.max(0,e))}}}requestSkip(){this._showSkipConfirm.set(!0)}cancelSkip(){this._showSkipConfirm.set(!1)}confirmSkip(){this._showSkipConfirm.set(!1),this.completeTutorial()}completeTutorial(){return a(this,null,function*(){this._isVisible.set(!1),this._phase.set("done"),yield this.saveCompletionFlag()})}saveCompletionFlag(){return a(this,null,function*(){let t=this.authService.currentUserValue;if(!t)return;let e=this._type()==="business"?"tutorial_business_completed":"tutorial_customer_completed";try{let{error:i}=yield this.supabaseService.getSupabaseClient().from("users").update({[e]:!0}).eq("id",t.id);i?console.error("\u274C Errore salvataggio tutorial flag:",i):t[e]=!0}catch(i){console.error("\u274C Eccezione salvataggio tutorial flag:",i)}})}restartTutorial(t){this._type.set(t),this._currentStep.set(0),this._phase.set("modal"),this._showSkipConfirm.set(!1),this._isVisible.set(!0)}_getVisibleSteps(t){return t.filter(e=>e.requiredPermission?this.authService.hasPermission(e.requiredPermission):!0)}currentTooltipData=r(()=>{let t=this.currentStepData();return t?this._isIntroStep()?{tooltipTarget:void 0,tooltipPosition:void 0,title:t.title,description:t.description}:t.subSteps&&t.subSteps.length>0?t.subSteps[this._currentSubStep()]??null:{tooltipTarget:t.tooltipTarget,tooltipPosition:t.tooltipPosition,title:t.title,description:t.description}:null});hasSubSteps=r(()=>(this.currentStepData()?.subSteps?.length??0)>0);isLastSubStep=r(()=>{let t=this.currentStepData();return t?.subSteps?.length?this._currentSubStep()===t.subSteps.length-1:!0});subStepProgress=r(()=>{let t=this.currentStepData();return t?.subSteps?.length?{current:this._currentSubStep()+1,total:t.subSteps.length}:null});static \u0275fac=function(e){return new(e||s)};static \u0275prov=c({token:s,factory:s.\u0275fac,providedIn:"root"})};export{m as a};
