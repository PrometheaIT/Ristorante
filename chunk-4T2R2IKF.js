import{b as C}from"./chunk-LKHJ66WT.js";import"./chunk-GKNZLVDN.js";import{a as U}from"./chunk-57RGVMRV.js";import{a as y}from"./chunk-7QR2BAVO.js";import{a as w}from"./chunk-UCL3U7HJ.js";import"./chunk-5BFIQ7BP.js";import{a as O}from"./chunk-7V5YPNIB.js";import{a as L}from"./chunk-KNL3CWA3.js";import{A as $,d as N,e as j,i as _,k as z}from"./chunk-DCWKKS33.js";import{$ as k,Eb as f,G as D,La as a,M as R,Mb as F,Nb as u,Pb as S,Qb as n,Rb as c,Sb as m,Tb as b,Zb as A,ab as T,ea as p,f as l,fb as h,g as M,m as E,qb as v,rb as e,sb as t,y as I}from"./chunk-K5RDB55Y.js";var x=class s{supabaseService=p($);authService=p(L);reviewsSubject=new E([]);reviews$=this.reviewsSubject.asObservable();constructor(){this.authService.currentUser$.pipe(D(r=>!!r),R(1)).subscribe(()=>{this.loadReviews()})}loadReviews(){return l(this,null,function*(){try{let r=this.authService.currentUserValue;if(!r){console.log("No user found");return}let{data:i,error:o}=yield this.supabaseService.getSupabaseClient().from("restaurants").select("id").eq("owner_id",r.id).limit(1);if(o||!i||i.length===0){console.error("\u274C No restaurant found for user:",r.id);return}let d=i[0].id,{data:g,error:P}=yield this.supabaseService.getSupabaseClient().from("reviews").select("*").eq("restaurant_id",d).order("created_at",{ascending:!1});if(P){console.error("Error loading reviews:",P);return}console.log("Reviews loaded:",g?.length),this.reviewsSubject.next(g||[])}catch(r){console.error("Error in loadReviews:",r)}})}getAverageRating(){let r=this.reviewsSubject.value;if(r.length===0)return{average:0,count:0};let o=r.reduce((d,g)=>d+g.rating,0)/r.length;return{average:Math.round(o*10)/10,count:r.length}}static \u0275fac=function(i){return new(i||s)};static \u0275prov=k({token:s,factory:s.\u0275fac,providedIn:"root"})};function B(s,r){if(s&1&&(e(0,"div",25)(1,"div",26)(2,"div",27),n(3),t()(),e(4,"div",28),n(5),t()()),s&2){let i=r.$implicit,o=f();a(),F("height",i.amount/o.maxSales*100+"%"),a(2),m("\u20AC",o.formatNumber(i.amount,"1.0-0")),a(2),c(i.day)}}function H(s,r){if(s&1&&(e(0,"div",29)(1,"div",30),n(2),t(),e(3,"div",31)(4,"strong"),n(5),t(),e(6,"span",4),n(7),t()(),e(8,"div",32),n(9),t()()),s&2){let i=r.$implicit,o=r.index,d=f();a(2),c(o+1),a(3),c(i.name),a(2),m("",i.orders," ordini"),a(2),m("\u20AC",d.formatNumber(i.revenue,"1.0-0"))}}function G(s,r){s&1&&(e(0,"div",33)(1,"span",2),n(2,"restaurant_menu"),t(),e(3,"p"),n(4,"Nessun piatto venduto ancora"),t()())}function W(s,r){if(s&1&&(e(0,"div",34)(1,"div",35)(2,"strong"),n(3),t()(),e(4,"div",36)(5,"span"),n(6),t(),e(7,"span",4),n(8),t()(),e(9,"span",37),n(10),t()()),s&2){let i=r.$implicit;a(3),c(i.time),a(3),c(i.customer_name),a(2),b("",i.party_size," persone \u2022 ",i.table),a(),S(i.status),a(),c(i.status)}}function J(s,r){s&1&&(e(0,"div",33)(1,"span",2),n(2,"event_available"),t(),e(3,"p"),n(4,"Nessuna prenotazione in arrivo"),t()())}function K(s,r){if(s&1&&(e(0,"div",38)(1,"div",39)(2,"strong"),n(3),t(),e(4,"span",37),n(5),t()(),e(6,"div",40)(7,"span"),n(8),t(),e(9,"span",4),n(10),t()(),e(11,"div",41),n(12),t()()),s&2){let i=r.$implicit,o=f();a(3),m("#",i.order_number),a(),S(i.status),a(),c(i.status),a(3),m("",i.items," articoli"),a(2),m("\u20AC",o.formatNumber(i.total)),a(2),c(i.time)}}function Q(s,r){s&1&&(e(0,"div",33)(1,"span",2),n(2,"check_circle"),t(),e(3,"p"),n(4,"Nessun ordine in corso"),t()())}function X(s,r){if(s&1&&(e(0,"div",42)(1,"div",43)(2,"span",2),n(3,"warning"),t()(),e(4,"div",44)(5,"strong"),n(6),t(),e(7,"span",4),n(8),t()(),e(9,"div",45),n(10),t()()),s&2){let i=r.$implicit;a(2),u("warning",i.priority==="high")("info",i.priority==="medium"),a(4),c(i.ingredient_name),a(2),b("Scorta: ",i.current_stock," ",i.unit),a(),u("error",i.priority==="high"),a(),b(" ",i.current_stock,"/",i.minimum_stock," ")}}function Y(s,r){s&1&&(e(0,"div",33)(1,"span",2),n(2,"inventory_2"),t(),e(3,"p"),n(4,"Nessun alert inventario"),t()())}var V=class s{todayOrders=0;todayRevenue=0;todayReservations=0;upcomingReservations=0;lowStockIngredients=0;averageRating=0;totalReviews=0;salesData=[];topDishes=[];upcomingReservationsList=[];currentOrders=[];inventoryAlerts=[];subscriptions=new M;decimalPipe=p(_);ingredientService=p(y);orderService=p(C);reservationService=p(w);reviewService=p(x);dishService=p(O);loadingService=p(U);ngOnInit(){return l(this,null,function*(){this.loadingService.start();try{yield this.loadAllData(),this.subscriptions.add(I([this.ingredientService.ingredients$,this.orderService.orders$,this.reservationService.reservations$,this.reviewService.reviews$,this.dishService.dishes$]).subscribe(([r,i,o,d,g])=>{this.updateDashboardData()}))}catch(r){console.error("Error loading dashboard data:",r)}finally{this.loadingService.stop()}})}loadAllData(){return l(this,null,function*(){try{yield Promise.all([this.ingredientService.loadIngredients(),this.orderService.loadOrders(),this.reservationService.loadReservations(),this.reviewService.loadReviews(),this.dishService.loadDishes()]),yield this.updateDashboardData()}catch(r){throw console.error("Error loading dashboard data:",r),r}})}updateDashboardData(){return l(this,null,function*(){yield this.loadTodayOrders(),yield this.loadTodayReservations(),this.loadLowStockIngredients(),this.loadAverageRating(),yield this.loadSalesData(),yield this.loadTopDishes(),this.loadUpcomingReservations(),yield this.loadCurrentOrders(),this.loadInventoryAlerts()})}loadTodayOrders(){return l(this,null,function*(){let{count:r,revenue:i}=yield this.orderService.getTodayOrders();this.todayOrders=r,this.todayRevenue=i})}loadTodayReservations(){return l(this,null,function*(){let r=this.reservationService.getTodayReservations();this.todayReservations=r.length,this.upcomingReservations=this.reservationService.getUpcomingReservations().length})}loadLowStockIngredients(){this.lowStockIngredients=this.ingredientService.getLowStockIngredients().length}loadAverageRating(){let{average:r,count:i}=this.reviewService.getAverageRating();this.averageRating=r,this.totalReviews=i}loadSalesData(){return l(this,null,function*(){this.salesData=yield this.orderService.getLast7DaysSales()})}loadTopDishes(){return l(this,null,function*(){this.topDishes=yield this.orderService.getTopDishes(5)})}loadUpcomingReservations(){this.upcomingReservationsList=this.reservationService.getUpcomingReservationsForDashboard(4)}loadCurrentOrders(){return l(this,null,function*(){let r=this.orderService.getCurrentOrders(),i=yield Promise.all(r.slice(0,4).map(o=>l(this,null,function*(){let d=yield this.orderService.getOrderItemsCount(o.id);return{order_number:o.order_number,items:d,total:o.total_amount,status:o.status,time:this.formatTimeSince(o.created_at)}})));this.currentOrders=i})}loadInventoryAlerts(){let r=this.ingredientService.getLowStockIngredients();this.inventoryAlerts=r.slice(0,4).map(i=>({ingredient_name:i.name,current_stock:i.current_stock,minimum_stock:i.minimum_stock,unit:i.units?.symbol||"",priority:i.current_stock<=i.minimum_stock*.5?"high":"medium"}))}formatTimeSince(r){let i=new Date,o=new Date(r),d=Math.floor((i.getTime()-o.getTime())/6e4);return d<1?"Ora":d<60?`${d} min`:`${Math.floor(d/60)} h`}get maxSales(){return this.salesData.length===0?1:Math.max(...this.salesData.map(r=>r.amount),1)}formatNumber(r,i="1.2-2"){return this.decimalPipe.transform(r,i)||"0"}ngOnDestroy(){this.subscriptions.unsubscribe(),this.loadingService.stop()}static \u0275fac=function(i){return new(i||s)};static \u0275cmp=T({type:s,selectors:[["app-dashboard"]],features:[A([_,y,C,w,x,O])],decls:96,vars:20,consts:[[1,"page-container"],[1,"section-header"],[1,"material-icons"],[1,"section-titles"],[1,"text-muted"],[1,"grid-cards"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"card-number"],[1,"card-subtitle"],[1,"section-card"],[1,"sales-chart"],[1,"chart-bars"],["class","chart-bar-container",4,"ngFor","ngForOf"],[1,"dashboard-grid"],[1,"top-dishes"],["class","dish-item",4,"ngFor","ngForOf"],["class","empty-state-small",4,"ngIf"],[1,"reservations-list"],["class","reservation-item",4,"ngFor","ngForOf"],[1,"orders-list"],["class","order-item",4,"ngFor","ngForOf"],[1,"alerts-list"],["class","alert-item",4,"ngFor","ngForOf"],[1,"chart-bar-container"],[1,"chart-bar"],[1,"bar-amount"],[1,"bar-label"],[1,"dish-item"],[1,"dish-rank"],[1,"dish-info"],[1,"dish-revenue"],[1,"empty-state-small"],[1,"reservation-item"],[1,"reservation-time"],[1,"reservation-details"],[1,"chip"],[1,"order-item"],[1,"order-header"],[1,"order-details"],[1,"order-time"],[1,"alert-item"],[1,"alert-icon"],[1,"alert-content"],[1,"alert-stock"]],template:function(i,o){i&1&&(e(0,"div",0)(1,"div",1)(2,"span",2),n(3,"dashboard"),t(),e(4,"div",3)(5,"h1"),n(6,"Dashboard Ristorante"),t(),e(7,"p",4),n(8,"Panoramica completa delle attivit\xE0 del tuo ristorante"),t()()(),e(9,"div",5)(10,"div",6)(11,"div",7)(12,"span",2),n(13,"receipt"),t(),e(14,"h3",8),n(15,"Ordini Oggi"),t()(),e(16,"div",9),n(17),t(),e(18,"div",10),n(19),t()(),e(20,"div",6)(21,"div",7)(22,"span",2),n(23,"event_available"),t(),e(24,"h3",8),n(25,"Prenotazioni Oggi"),t()(),e(26,"div",9),n(27),t(),e(28,"div",10),n(29),t()(),e(30,"div",6)(31,"div",7)(32,"span",2),n(33,"warning"),t(),e(34,"h3",8),n(35,"Scorte Basse"),t()(),e(36,"div",9),n(37),t(),e(38,"div",10),n(39," Attenzione necessaria "),t()(),e(40,"div",6)(41,"div",7)(42,"span",2),n(43,"star"),t(),e(44,"h3",8),n(45,"Valutazione Media"),t()(),e(46,"div",9),n(47),t(),e(48,"div",10),n(49),t()()(),e(50,"div",11)(51,"div",7)(52,"span",2),n(53,"trending_up"),t(),e(54,"h3",8),n(55,"Andamento Vendite Ultimi 7 Giorni"),t()(),e(56,"div",12)(57,"div",13),h(58,B,6,4,"div",14),t()()(),e(59,"div",15)(60,"div",11)(61,"div",7)(62,"span",2),n(63,"local_fire_department"),t(),e(64,"h3",8),n(65,"Piatti Pi\xF9 Venduti"),t()(),e(66,"div",16),h(67,H,10,4,"div",17)(68,G,5,0,"div",18),t()(),e(69,"div",11)(70,"div",7)(71,"span",2),n(72,"schedule"),t(),e(73,"h3",8),n(74,"Prossime Prenotazioni"),t()(),e(75,"div",19),h(76,W,11,7,"div",20)(77,J,5,0,"div",18),t()(),e(78,"div",11)(79,"div",7)(80,"span",2),n(81,"restaurant"),t(),e(82,"h3",8),n(83,"Ordini in Corso"),t()(),e(84,"div",21),h(85,K,13,7,"div",22)(86,Q,5,0,"div",18),t()(),e(87,"div",11)(88,"div",7)(89,"span",2),n(90,"notification_important"),t(),e(91,"h3",8),n(92,"Alert Inventario"),t()(),e(93,"div",23),h(94,X,11,11,"div",24)(95,Y,5,0,"div",18),t()()()()),i&2&&(a(17),c(o.todayOrders),a(2),m("\u20AC",o.formatNumber(o.todayRevenue)),a(8),c(o.todayReservations),a(2),m("",o.upcomingReservations," in arrivo"),a(7),u("error",o.lowStockIngredients>0),a(),m(" ",o.lowStockIngredients," "),a(),u("error",o.lowStockIngredients>0),a(9),m("",o.averageRating,"/5"),a(2),m("",o.totalReviews," recensioni"),a(9),v("ngForOf",o.salesData),a(9),v("ngForOf",o.topDishes),a(),v("ngIf",o.topDishes.length===0),a(8),v("ngForOf",o.upcomingReservationsList),a(),v("ngIf",o.upcomingReservationsList.length===0),a(8),v("ngForOf",o.currentOrders),a(),v("ngIf",o.currentOrders.length===0),a(8),v("ngForOf",o.inventoryAlerts),a(),v("ngIf",o.inventoryAlerts.length===0))},dependencies:[z,N,j],styles:[".dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px}.section-card[_ngcontent-%COMP%]{background:var(--card-bg);border-radius:12px;padding:24px;border:1px solid var(--border-color)}.sales-chart[_ngcontent-%COMP%]{margin-top:16px}.chart-bars[_ngcontent-%COMP%]{display:flex;align-items:end;gap:16px;height:200px;padding:20px 0}.chart-bar-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;height:100%}.chart-bar[_ngcontent-%COMP%]{background:linear-gradient(180deg,var(--primary-color) 0%,var(--primary-dark) 100%);border-radius:8px 8px 0 0;width:40px;min-height:40px;position:relative;transition:all .3s ease}.chart-bar[_ngcontent-%COMP%]:hover{opacity:.8;transform:scale(1.05)}.bar-amount[_ngcontent-%COMP%]{position:absolute;top:-25px;left:50%;transform:translate(-50%);background:var(--text-color);color:var(--bg-color);padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600;white-space:nowrap}.bar-label[_ngcontent-%COMP%]{margin-top:8px;font-weight:600;color:var(--text-muted);font-size:12px}.top-dishes[_ngcontent-%COMP%]{margin-top:16px}.dish-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.dish-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dish-rank[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;margin-right:12px}.dish-info[_ngcontent-%COMP%]{flex:1}.dish-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:2px}.dish-revenue[_ngcontent-%COMP%]{font-weight:600;color:var(--success-color)}.reservations-list[_ngcontent-%COMP%]{margin-top:16px}.reservation-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.reservation-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.reservation-time[_ngcontent-%COMP%]{min-width:60px;margin-right:16px}.reservation-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.orders-list[_ngcontent-%COMP%]{margin-top:16px}.order-item[_ngcontent-%COMP%]{padding:12px 0;border-bottom:1px solid var(--border-light)}.order-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:between;align-items:center;margin-bottom:4px}.order-details[_ngcontent-%COMP%]{display:flex;justify-content:between;margin-bottom:4px}.order-time[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted)}.alerts-list[_ngcontent-%COMP%]{margin-top:16px}.alert-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-light)}.alert-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.alert-icon[_ngcontent-%COMP%]{margin-right:12px}.alert-icon[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{color:var(--warning-color)}.alert-icon[_ngcontent-%COMP%]   .material-icons.warning[_ngcontent-%COMP%]{color:var(--error-color)}.alert-icon[_ngcontent-%COMP%]   .material-icons.info[_ngcontent-%COMP%]{color:var(--info-color)}.alert-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.alert-stock[_ngcontent-%COMP%]{font-weight:600}.alert-stock.error[_ngcontent-%COMP%]{color:var(--error-color)}.chip[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:600;text-transform:capitalize}.chip.confirmed[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success-color)}.chip.pending[_ngcontent-%COMP%]{background:var(--warning-light);color:var(--warning-color)}.chip.preparing[_ngcontent-%COMP%]{background:var(--info-light);color:var(--info-color)}.chip.ready[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success-color)}@media (max-width: 768px){.dashboard-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.chart-bars[_ngcontent-%COMP%]{gap:8px}.chart-bar[_ngcontent-%COMP%]{width:30px}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid var(--border-light);border-top:4px solid var(--primary-color);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.empty-state-small[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center;color:var(--text-muted)}.empty-state-small[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px;opacity:.5}.empty-state-small[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}"]})};export{V as Dashboard};
