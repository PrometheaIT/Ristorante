import{a as F,b as P,c as m,d as z,e as A,i as L,l as D,o as k,v as M,x as q}from"./chunk-77SKEQNN.js";import{a as C}from"./chunk-KNL3CWA3.js";import{e as S,k as w,r as R,t as I,u as T}from"./chunk-DCWKKS33.js";import{Db as x,Eb as u,La as s,Nb as c,Qb as r,Rb as b,Sb as h,_b as y,ab as N,ea as v,f as E,fb as p,qb as o,rb as l,sb as e,tb as d}from"./chunk-K5RDB55Y.js";var j=()=>["/login"];function B(a,n){a&1&&(l(0,"span"),r(1,"Il nome \xE8 obbligatorio"),e())}function H(a,n){a&1&&(l(0,"span"),r(1,"Il nome non pu\xF2 superare i 20 caratteri"),e())}function Q(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,B,2,0,"span",34)(4,H,2,0,"span",34),e()),a&2){let t=u();s(3),o("ngIf",t.firstName==null||t.firstName.errors==null?null:t.firstName.errors.required),s(),o("ngIf",t.firstName==null||t.firstName.errors==null?null:t.firstName.errors.maxlength)}}function W(a,n){a&1&&(l(0,"span"),r(1,"Il cognome \xE8 obbligatorio"),e())}function $(a,n){a&1&&(l(0,"span"),r(1,"Il cognome non pu\xF2 superare i 20 caratteri"),e())}function J(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,W,2,0,"span",34)(4,$,2,0,"span",34),e()),a&2){let t=u();s(3),o("ngIf",t.lastName==null||t.lastName.errors==null?null:t.lastName.errors.required),s(),o("ngIf",t.lastName==null||t.lastName.errors==null?null:t.lastName.errors.maxlength)}}function K(a,n){a&1&&(l(0,"span"),r(1,"L'email \xE8 obbligatoria"),e())}function X(a,n){a&1&&(l(0,"span"),r(1,"Inserisci un'email valida"),e())}function Y(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,K,2,0,"span",34)(4,X,2,0,"span",34),e()),a&2){let t=u();s(3),o("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.required),s(),o("ngIf",t.email==null||t.email.errors==null?null:t.email.errors.email)}}function Z(a,n){a&1&&(l(0,"span"),r(1,"La password \xE8 obbligatoria"),e())}function ee(a,n){a&1&&(l(0,"span"),r(1,"Minimo 6 caratteri"),e())}function te(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,Z,2,0,"span",34)(4,ee,2,0,"span",34),e()),a&2){let t=u();s(3),o("ngIf",t.password==null||t.password.errors==null?null:t.password.errors.required),s(),o("ngIf",t.password==null||t.password.errors==null?null:t.password.errors.minlength)}}function ie(a,n){a&1&&(l(0,"span"),r(1,"Conferma la password"),e())}function re(a,n){a&1&&(l(0,"span"),r(1,"Le password non coincidono"),e())}function ae(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,ie,2,0,"span",34)(4,re,2,0,"span",34),e()),a&2){let t=u();s(3),o("ngIf",t.confirmPassword==null||t.confirmPassword.errors==null?null:t.confirmPassword.errors.required),s(),o("ngIf",t.registerForm.errors==null?null:t.registerForm.errors.passwordMismatch)}}function ne(a,n){a&1&&(l(0,"span"),r(1,"Il nome dell'azienda \xE8 obbligatorio"),e())}function le(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,ne,2,0,"span",34),e()),a&2){let t=u(2);s(3),o("ngIf",t.companyName==null||t.companyName.errors==null?null:t.companyName.errors.required)}}function se(a,n){if(a&1&&(l(0,"div",8)(1,"h2",9)(2,"span",10),r(3,"local_shipping"),e(),r(4," Informazioni Fornitore "),e(),l(5,"div",11)(6,"div",35)(7,"label",36)(8,"span",10),r(9,"business"),e(),r(10," Nome Azienda * "),e(),d(11,"input",37),p(12,le,4,1,"div",15),e()(),l(13,"div",11)(14,"div",12)(15,"label",38)(16,"span",10),r(17,"person"),e(),r(18," Nome Contatto "),e(),d(19,"input",39),e(),l(20,"div",12)(21,"label",40)(22,"span",10),r(23,"business_center"),e(),r(24," Telefono Azienda "),e(),d(25,"input",41),e()(),l(26,"div",12)(27,"label",42)(28,"span",10),r(29,"location_on"),e(),r(30," Indirizzo Azienda "),e(),d(31,"textarea",43),e(),l(32,"div",12)(33,"label",44)(34,"span",10),r(35,"description"),e(),r(36," Descrizione Attivit\xE0 "),e(),d(37,"textarea",45),e()()),a&2){let t=u();s(11),c("error",(t.companyName==null?null:t.companyName.invalid)&&((t.companyName==null?null:t.companyName.touched)||t.submitted)),s(),o("ngIf",(t.companyName==null?null:t.companyName.invalid)&&((t.companyName==null?null:t.companyName.touched)||t.submitted))}}function oe(a,n){a&1&&(l(0,"span"),r(1,"Il nome del ristorante \xE8 obbligatorio"),e())}function me(a,n){a&1&&(l(0,"span"),r(1,"Il nome non pu\xF2 superare i 100 caratteri"),e())}function de(a,n){if(a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),p(3,oe,2,0,"span",34)(4,me,2,0,"span",34),e()),a&2){let t=u(2);s(3),o("ngIf",t.restaurantName==null||t.restaurantName.errors==null?null:t.restaurantName.errors.required),s(),o("ngIf",t.restaurantName==null||t.restaurantName.errors==null?null:t.restaurantName.errors.maxlength)}}function pe(a,n){a&1&&(l(0,"div",33)(1,"span",10),r(2,"error"),e(),r(3," Inserisci un'email valida "),e())}function ue(a,n){if(a&1&&(l(0,"div",8)(1,"h2",9)(2,"span",10),r(3,"business"),e(),r(4," Informazioni Ristorante "),e(),l(5,"div",11)(6,"div",35)(7,"label",46)(8,"span",10),r(9,"restaurant_menu"),e(),r(10," Nome Ristorante * "),e(),d(11,"input",47),p(12,de,5,2,"div",15),e()(),l(13,"div",11)(14,"div",12)(15,"label",48)(16,"span",10),r(17,"location_on"),e(),r(18," Indirizzo "),e(),d(19,"input",49),e(),l(20,"div",12)(21,"label",50)(22,"span",10),r(23,"business_center"),e(),r(24," Telefono Ristorante "),e(),d(25,"input",51),e()(),l(26,"div",11)(27,"div",12)(28,"label",52)(29,"span",10),r(30,"alternate_email"),e(),r(31," Email Ristorante "),e(),d(32,"input",53),p(33,pe,4,0,"div",15),e(),l(34,"div",12)(35,"label",54)(36,"span",10),r(37,"emoji_food_beverage"),e(),r(38," Tipo di Cucina "),e(),d(39,"input",55),e()(),l(40,"div",12)(41,"label",56)(42,"span",10),r(43,"description"),e(),r(44," Descrizione "),e(),d(45,"textarea",57),e()()),a&2){let t=u();s(11),c("error",(t.restaurantName==null?null:t.restaurantName.invalid)&&((t.restaurantName==null?null:t.restaurantName.touched)||t.submitted)),s(),o("ngIf",(t.restaurantName==null?null:t.restaurantName.invalid)&&((t.restaurantName==null?null:t.restaurantName.touched)||t.submitted)),s(20),c("error",(t.restaurantEmail==null?null:t.restaurantEmail.invalid)&&((t.restaurantEmail==null?null:t.restaurantEmail.touched)||t.submitted)),s(),o("ngIf",(t.restaurantEmail==null?null:t.restaurantEmail.invalid)&&((t.restaurantEmail==null?null:t.restaurantEmail.touched)||t.submitted))}}function ce(a,n){a&1&&(l(0,"div",8)(1,"h2",9)(2,"span",10),r(3,"settings"),e(),r(4," Servizi Offerti "),e(),l(5,"div",58)(6,"label",59),d(7,"input",60),l(8,"div")(9,"strong"),r(10,"Permetti selezione tavolo"),e(),l(11,"div",61),r(12," I clienti potranno scegliere il tavolo specifico al momento della prenotazione "),e()()(),l(13,"label",59),d(14,"input",62),l(15,"div")(16,"strong"),r(17,"Servizio Delivery"),e(),l(18,"div",61),r(19," Offri la consegna a domicilio direttamente dal tuo ristorante "),e()()(),l(20,"label",59),d(21,"input",63),l(22,"div")(23,"strong"),r(24,"Servizio Takeaway"),e(),l(25,"div",61),r(26," Permetti ai clienti di ordinare e ritirare al ristorante "),e()()()()())}function fe(a,n){if(a&1&&(l(0,"div",64)(1,"span",10),r(2,"warning"),e(),r(3),e()),a&2){let t=u();s(3),h(" ",t.errorMessage," ")}}function ge(a,n){a&1&&d(0,"span",65)}function ve(a,n){a&1&&(l(0,"span",10),r(1,"app_registration"),e())}var V=class a{registerForm;isLoading=!1;errorMessage="";submitted=!1;isRestaurant=!1;isCustomer=!1;isSupplier=!1;fb=v(M);authService=v(C);router=v(I);route=v(R);ngOnInit(){let n=this.route.snapshot.paramMap.get("role"),t=this.route.snapshot.queryParamMap.get("role"),i="";try{let _=(this.router.url||"").split("?")[0].split("/").filter(O=>O.length>0);i=_.length?_[_.length-1]:""}catch{i=""}let f=(n??t??i??"customer").toLowerCase();this.isRestaurant=/restaurant/.test(f)||/owner/.test(f),this.isCustomer=/customer/.test(f),this.isSupplier=/supplier/.test(f);let G=this.isRestaurant?"restaurant_owner":this.isSupplier?"supplier":"customer";this.registerForm=this.fb.group({email:["",[m.required,m.email]],password:["",[m.required,m.minLength(6)]],confirmPassword:["",[m.required]],firstName:["",[m.required,m.maxLength(20)]],lastName:["",[m.required,m.maxLength(20)]],phone:["",[m.maxLength(20)]],role:[G,[m.required]],restaurantName:["",this.isRestaurant?[m.required,m.maxLength(100)]:[]],restaurantAddress:["",this.isRestaurant?[m.maxLength(200)]:[]],restaurantPhone:["",this.isRestaurant?[m.maxLength(20)]:[]],restaurantEmail:["",this.isRestaurant?[m.email,m.maxLength(100)]:[]],restaurantDescription:["",this.isRestaurant?[m.maxLength(500)]:[]],cuisineType:["",this.isRestaurant?[m.maxLength(50)]:[]],allowTableSelection:[!1],acceptsDelivery:[!1],acceptsTakeaway:[!1],companyName:["",this.isSupplier?[m.required,m.maxLength(100)]:[]],contactName:["",this.isSupplier?[m.maxLength(50)]:[]],supplierPhone:["",this.isSupplier?[m.maxLength(20)]:[]],supplierAddress:["",this.isSupplier?[m.maxLength(200)]:[]],supplierDescription:["",this.isSupplier?[m.maxLength(500)]:[]]},{validators:this.passwordMatchValidator}),this.disableUnnecessaryValidators()}passwordMatchValidator(n){let t=n.get("password")?.value,i=n.get("confirmPassword")?.value;return t===i?null:{passwordMismatch:!0}}disableUnnecessaryValidators(){this.isRestaurant||["restaurantName","restaurantAddress","restaurantPhone","restaurantEmail","restaurantDescription","cuisineType"].forEach(t=>{let i=this.registerForm.get(t);i&&(i.clearValidators(),i.updateValueAndValidity())}),this.isSupplier||["companyName","supplierAddress","supplierDescription"].forEach(t=>{let i=this.registerForm.get(t);i&&(i.clearValidators(),i.updateValueAndValidity())})}onSubmit(){return E(this,null,function*(){if(console.log("\u{1F504} onSubmit()"),this.submitted=!0,this.registerForm.invalid){this.markFormGroupTouched(),console.log("\u274C Form invalido \u2014 interrompo");return}this.isLoading=!0,this.errorMessage="";let n=this.registerForm.value,t=n.role,i={email:n.email,password:n.password,user_data:{first_name:n.firstName,last_name:n.lastName,phone:n.phone,role:t},restaurant_data:t==="restaurant_owner"?{name:n.restaurantName,address:n.restaurantAddress,phone:n.restaurantPhone,email:n.restaurantEmail,description:n.restaurantDescription,cuisine_type:n.cuisineType,allow_table_selection:!!n.allowTableSelection,accepts_delivery:!!n.acceptsDelivery,accepts_takeaway:!!n.acceptsTakeaway}:void 0,supplier_data:t==="supplier"?{company_name:n.companyName,contact_name:n.contactName,email:n.email,phone:n.supplierPhone||n.phone,address:n.supplierAddress,description:n.supplierDescription}:void 0};console.log("\u{1F4E4} registerData:",i);try{let g=yield this.authService.register(i);if(console.log("\u{1F4E5} result:",g),g.error){let f=g.error;f.includes("User account is being prepared")||f.includes("User account not ready")?(this.errorMessage="Account creato. Il profilo fornitore sar\xE0 creato al primo login.",setTimeout(()=>this.router.navigate(["/login"]),3e3)):this.errorMessage=this.getErrorMessage(f)}else t==="restaurant_owner"?(this.errorMessage="Account e ristorante creati con successo! Reindirizzamento...",setTimeout(()=>this.router.navigate(["/restaurant/dashboard"]),1500)):t==="supplier"?(this.errorMessage="Account fornitore creato con successo! Reindirizzamento...",setTimeout(()=>this.router.navigate(["/supplier/dashboard"]),1500)):(this.errorMessage="Account creato con successo! Reindirizzamento...",setTimeout(()=>this.router.navigate(["/customer"]),1500))}catch(g){console.error("Registration error:",g),this.errorMessage="Errore durante la registrazione. Riprova pi\xF9 tardi."}finally{this.isLoading=!1}})}markFormGroupTouched(){Object.keys(this.registerForm.controls).forEach(n=>{this.registerForm.get(n)?.markAsTouched()})}getErrorMessage(n){return{"User already registered":"Utente gi\xE0 registrato con questa email.","Invalid email":"Email non valida.","Weak password":"Password troppo debole. Usa almeno 6 caratteri.","User table error":"Errore durante la creazione dell'account. Riprova.","Restaurant creation failed":"Errore durante la creazione del ristorante.","Supplier creation failed":"Errore durante la creazione del profilo fornitore."}[n]??`Errore: ${n}`}get email(){return this.registerForm.get("email")}get password(){return this.registerForm.get("password")}get confirmPassword(){return this.registerForm.get("confirmPassword")}get firstName(){return this.registerForm.get("firstName")}get lastName(){return this.registerForm.get("lastName")}get restaurantName(){return this.registerForm.get("restaurantName")}get restaurantEmail(){return this.registerForm.get("restaurantEmail")}get companyName(){return this.registerForm.get("companyName")}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=N({type:a,selectors:[["app-register"]],decls:74,vars:29,consts:[[1,"gradient-container"],[1,"form-card",2,"max-width","800px","width","100%","margin","var(--gutter-xl) auto"],[1,"section-header",2,"border-bottom","2px solid var(--smoke-color-1)","padding-bottom","var(--gutter-lg)"],[1,"material-icons",2,"font-size","var(--fs-lg)","color","var(--primary)"],[1,"section-titles"],[2,"margin","0","text-align","left","font-size","var(--fs-md)"],[1,"text-muted",2,"margin","0"],[1,"generic-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"section-title"],[1,"material-icons"],[1,"grid-form"],[1,"form-group"],["for","firstName",1,"form-label"],["id","firstName","formControlName","firstName","type","text","placeholder","Il tuo nome"],["class","status-message error",4,"ngIf"],["for","lastName",1,"form-label"],["id","lastName","formControlName","lastName","type","text","placeholder","Il tuo cognome"],["for","email",1,"form-label"],["id","email","formControlName","email","type","email","placeholder","tua.email@esempio.com"],["for","phone",1,"form-label"],["id","phone","formControlName","phone","type","tel","placeholder","+39 123 456 7890"],["for","password",1,"form-label"],["id","password","formControlName","password","type","password","placeholder","Almeno 6 caratteri"],["for","confirmPassword",1,"form-label"],["id","confirmPassword","formControlName","confirmPassword","type","password","placeholder","Ripeti la password"],["class","form-section",4,"ngIf"],["class","status-message error","style","margin: 0;",4,"ngIf"],[1,"form-actions"],[1,"link",2,"display","flex","align-items","center","gap","var(--gutter-sm)",3,"routerLink"],["type","submit",1,"promethea-button",2,"min-width","200px",3,"disabled"],["class","loading-spinner","style","width: 16px; height: 16px; border-width: 2px;",4,"ngIf"],["class","material-icons",4,"ngIf"],[1,"status-message","error"],[4,"ngIf"],[1,"form-group",2,"grid-column","1 / -1"],["for","companyName",1,"form-label"],["id","companyName","formControlName","companyName","type","text","placeholder","Il nome della tua azienda"],["for","contactName",1,"form-label"],["id","contactName","formControlName","contactName","type","text","placeholder","Nome del referente"],["for","supplierPhone",1,"form-label"],["id","supplierPhone","formControlName","supplierPhone","type","tel","placeholder","Telefono dell'azienda"],["for","supplierAddress",1,"form-label"],["id","supplierAddress","formControlName","supplierAddress","rows","2","placeholder","Indirizzo completo dell'azienda"],["for","supplierDescription",1,"form-label"],["id","supplierDescription","formControlName","supplierDescription","rows","3","placeholder","Descrivi la tua attivit\xE0..."],["for","restaurantName",1,"form-label"],["id","restaurantName","formControlName","restaurantName","type","text","placeholder","Il nome del tuo ristorante"],["for","restaurantAddress",1,"form-label"],["id","restaurantAddress","formControlName","restaurantAddress","type","text","placeholder","Indirizzo completo"],["for","restaurantPhone",1,"form-label"],["id","restaurantPhone","formControlName","restaurantPhone","type","tel","placeholder","Telefono del ristorante"],["for","restaurantEmail",1,"form-label"],["id","restaurantEmail","formControlName","restaurantEmail","type","email","placeholder","email@ristorante.com"],["for","cuisineType",1,"form-label"],["id","cuisineType","formControlName","cuisineType","type","text","placeholder","Es: Italiana, Giapponese..."],["for","restaurantDescription",1,"form-label"],["id","restaurantDescription","formControlName","restaurantDescription","rows","3","placeholder","Descrivi il tuo ristorante..."],[1,"notifications-grid"],[1,"checkbox-label","large"],["id","allowTableSelection","formControlName","allowTableSelection","type","checkbox"],[1,"text-muted",2,"margin-top","4px"],["id","acceptsDelivery","formControlName","acceptsDelivery","type","checkbox"],["id","acceptsTakeaway","formControlName","acceptsTakeaway","type","checkbox"],[1,"status-message","error",2,"margin","0"],[1,"loading-spinner",2,"width","16px","height","16px","border-width","2px"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),r(4),e(),l(5,"div",4)(6,"h1",5),r(7),e(),l(8,"p",6),r(9),e()()(),l(10,"form",7),x("ngSubmit",function(){return i.onSubmit()}),l(11,"div",8)(12,"h2",9)(13,"span",10),r(14,"person"),e(),r(15," Informazioni Account "),e(),l(16,"div",11)(17,"div",12)(18,"label",13)(19,"span",10),r(20,"badge"),e(),r(21," Nome * "),e(),d(22,"input",14),p(23,Q,5,2,"div",15),e(),l(24,"div",12)(25,"label",16)(26,"span",10),r(27,"badge"),e(),r(28," Cognome * "),e(),d(29,"input",17),p(30,J,5,2,"div",15),e()(),l(31,"div",11)(32,"div",12)(33,"label",18)(34,"span",10),r(35,"email"),e(),r(36," Email * "),e(),d(37,"input",19),p(38,Y,5,2,"div",15),e(),l(39,"div",12)(40,"label",20)(41,"span",10),r(42,"phone"),e(),r(43," Telefono "),e(),d(44,"input",21),e()(),l(45,"div",11)(46,"div",12)(47,"label",22)(48,"span",10),r(49,"lock"),e(),r(50," Password * "),e(),d(51,"input",23),p(52,te,5,2,"div",15),e(),l(53,"div",12)(54,"label",24)(55,"span",10),r(56,"lock_reset"),e(),r(57," Conferma Password * "),e(),d(58,"input",25),p(59,ae,5,2,"div",15),e()()(),p(60,se,38,3,"div",26)(61,ue,46,6,"div",26)(62,ce,27,0,"div",26)(63,fe,4,1,"div",27),l(64,"div",28)(65,"a",29)(66,"span",10),r(67,"arrow_back"),e(),r(68," Hai gi\xE0 un account? Accedi "),e(),l(69,"button",30),p(70,ge,1,0,"span",31)(71,ve,2,0,"span",32),l(72,"span"),r(73),e()()()()()()),t&2&&(s(4),h(" ",i.isRestaurant?"restaurant":i.isSupplier?"local_shipping":"person"," "),s(3),h(" ",i.isRestaurant?"Registra il tuo Ristorante":i.isSupplier?"Registrati come Fornitore":"Registrati come Cliente"," "),s(2),h(" ",i.isRestaurant?"Crea il tuo account business e inizia a gestire il tuo ristorante":i.isSupplier?"Crea il tuo account fornitore e gestisci i tuoi prodotti":"Crea il tuo account e inizia a ordinare"," "),s(),o("formGroup",i.registerForm),s(12),c("error",(i.firstName==null?null:i.firstName.invalid)&&((i.firstName==null?null:i.firstName.touched)||i.submitted)),s(),o("ngIf",(i.firstName==null?null:i.firstName.invalid)&&((i.firstName==null?null:i.firstName.touched)||i.submitted)),s(6),c("error",(i.lastName==null?null:i.lastName.invalid)&&((i.lastName==null?null:i.lastName.touched)||i.submitted)),s(),o("ngIf",(i.lastName==null?null:i.lastName.invalid)&&((i.lastName==null?null:i.lastName.touched)||i.submitted)),s(7),c("error",(i.email==null?null:i.email.invalid)&&((i.email==null?null:i.email.touched)||i.submitted)),s(),o("ngIf",(i.email==null?null:i.email.invalid)&&((i.email==null?null:i.email.touched)||i.submitted)),s(13),c("error",(i.password==null?null:i.password.invalid)&&((i.password==null?null:i.password.touched)||i.submitted)),s(),o("ngIf",(i.password==null?null:i.password.invalid)&&((i.password==null?null:i.password.touched)||i.submitted)),s(6),c("error",((i.confirmPassword==null?null:i.confirmPassword.invalid)||(i.registerForm.errors==null?null:i.registerForm.errors.passwordMismatch))&&((i.confirmPassword==null?null:i.confirmPassword.touched)||i.submitted)),s(),o("ngIf",((i.confirmPassword==null?null:i.confirmPassword.invalid)||(i.registerForm.errors==null?null:i.registerForm.errors.passwordMismatch))&&((i.confirmPassword==null?null:i.confirmPassword.touched)||i.submitted)),s(),o("ngIf",i.isSupplier),s(),o("ngIf",i.isRestaurant),s(),o("ngIf",i.isRestaurant),s(),o("ngIf",i.errorMessage),s(2),o("routerLink",y(28,j)),s(4),o("disabled",i.isLoading),s(),o("ngIf",i.isLoading),s(),o("ngIf",!i.isLoading),s(2),b(i.isLoading?"Registrazione in corso...":"Registrati"))},dependencies:[w,S,q,L,P,F,z,A,D,k,T],encapsulation:2})};export{V as Register};
