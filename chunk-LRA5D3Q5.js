import{a as K}from"./chunk-RDK7LK33.js";import{a as Z}from"./chunk-6YDTSELL.js";import{a as Y}from"./chunk-SKQHRKMJ.js";import{a as Q}from"./chunk-QUWZEZHV.js";import{a as U}from"./chunk-OILXJW2J.js";import"./chunk-GO2X6ET2.js";import"./chunk-MTC3TSRZ.js";import{b as ge,d as _e,h as he,j as fe,q as ve,r as Me,s as xe,u as ye,x as Se}from"./chunk-XWCDBJ2K.js";import{b as q}from"./chunk-PMU7JIES.js";import{c as se,d as le,h as ce,i as de,k as ue,l as me,q as pe}from"./chunk-COP7W333.js";import{A as ee,B as re,Fb as P,Hb as W,Ib as o,Ja as c,Jb as E,Kb as _,Lb as $,Ob as D,Pb as w,Qb as C,Wb as x,Yb as y,Za as ae,Zb as R,a as O,b as z,ba as k,cb as h,ga as M,h as m,kb as d,la as f,lb as n,ma as v,mb as r,nb as oe,o as ne,rb as T,sb as B,tb as S,va as L,wb as p,yb as u}from"./chunk-2FS7XGGJ.js";var H=class s extends U{supabase=M(q);getTableName(){return"menu_dishes"}loadData(t){return m(this,null,function*(){try{this.loadingSubject.next(!0),this.errorSubject.next(null);let e=this.supabase.getSupabaseClient().from(this.getTableName()).select("*");t&&Object.keys(t).forEach(l=>{let g=t[l];g!=null&&(e=e.eq(l,g))});let{data:i,error:a}=yield e;if(a)throw a;this.dataSubject.next(i??[])}catch(e){console.error(`Error loading ${this.getTableName()}:`,e),this.errorSubject.next(e.message??"Errore sconosciuto"),this.dataSubject.next([])}finally{this.loadingSubject.next(!1)}})}create(t){return m(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let e=new Date().toISOString(),i=z(O({},t),{created_at:e,updated_at:e});console.log("\u{1F4E4} PAYLOAD PER INSERT menu_dishes:"),console.log("- menu_id:",i.menu_id),console.log("- dish_id:",i.dish_id),console.log("- category_id:",i.category_id),console.log("- display_order:",i.display_order),console.log("- is_active:",i.is_active),console.log("- created_at:",i.created_at),console.log("\u{1F4CB} Payload completo:",JSON.stringify(i,null,2));let{data:a,error:l}=yield this.supabase.getSupabaseClient().from(this.getTableName()).insert(i).select().single();if(l)throw console.error("\u274C ERRORE SUPABASE DETTAGLIATO:",l),console.error("\u274C Codice:",l.code),console.error("\u274C Messaggio:",l.message),console.error("\u274C Dettagli:",l.details),console.error("\u274C Hint:",l.hint),l.code==="23505"?(console.error("\u274C VIOLAZIONE VINCOLO UNIQUE: il piatto \xE8 gi\xE0 in questo menu"),new Error("Il piatto \xE8 gi\xE0 presente in questo menu")):l.code==="23503"?(console.error("\u274C VIOLAZIONE FOREIGN KEY: menu_id o dish_id non esistono"),new Error("Menu o piatto non trovato")):l;return console.log("\u2705 INSERT RIUSCITO:",a),t.menu_id?yield this.loadData({menu_id:t.menu_id}):yield this.loadData(),a}catch(e){return console.error("\u274C ERRORE COMPLETO durante create:",e),this.errorSubject.next(e.message??"Errore creazione"),null}finally{this.loadingSubject.next(!1)}})}update(t,e){return m(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let{error:i}=yield this.supabase.getSupabaseClient().from(this.getTableName()).update(z(O({},e),{updated_at:new Date().toISOString()})).eq("id",t);if(i)throw i;return yield this.loadData(),!0}catch(i){return this.errorSubject.next(i.message??"Errore aggiornamento"),!1}finally{this.loadingSubject.next(!1)}})}delete(t){return m(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let{error:e}=yield this.supabase.getSupabaseClient().from(this.getTableName()).delete().eq("id",t);if(e)throw e;return yield this.loadData(),!0}catch(e){return this.errorSubject.next(e.message??"Errore eliminazione"),!1}finally{this.loadingSubject.next(!1)}})}getDishesByMenu$(t){return this.data$.pipe(re(e=>e.filter(i=>i.menu_id===t)))}addDishToMenu(t,e,i,a=0){return m(this,null,function*(){let l;i==null||i.trim()===""?l=void 0:l=i;let g={menu_id:t,dish_id:e,display_order:a,is_active:!0};return l!==void 0&&(g.category_id=l),console.log("\u2795 Aggiungo piatto al menu:",g),this.create(g)})}removeDishFromMenu(t){return m(this,null,function*(){return this.delete(t)})}updateDishOrder(t,e){return m(this,null,function*(){return this.update(t,{display_order:e})})}loadDishesForMenu(t){return m(this,null,function*(){return this.loadData({menu_id:t})})}getDishesWithDetailsByMenu(t){return m(this,null,function*(){try{let{data:e,error:i}=yield this.supabase.getSupabaseClient().from("menu_dishes").select(`
        *,
        dish:dishes!dish_id (*)
      `).eq("menu_id",t).eq("is_active",!0).order("display_order");if(i)throw i;return(e||[]).filter(a=>a.dish&&!a.dish.deleted_at)}catch(e){return console.error("Error fetching dishes for menu:",e),[]}})}removeAllDishesFromMenu(t){return m(this,null,function*(){this.loadingSubject.next(!0),this.errorSubject.next(null);try{let{error:e}=yield this.supabase.getSupabaseClient().from(this.getTableName()).delete().eq("menu_id",t);if(e)throw e;return yield this.loadData(),!0}catch(e){return console.error("\u274C Errore eliminazione piatti dal menu:",e),this.errorSubject.next(e.message??"Errore eliminazione piatti dal menu"),!1}finally{this.loadingSubject.next(!1)}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=L(s)))(i||s)}})();static \u0275prov=k({token:s,factory:s.\u0275fac,providedIn:"root"})};var F=class s extends U{getTableName(){return"ingredient_groups"}drinkGroupIds=["2fe735fb-5e1f-4dd6-8ec6-5e4e4d79d03d","bb2e6dc6-2932-4c03-abb7-bd0c5877625d","8fe1a885-1755-4baf-8c66-1603d4378909"];drinkGroupNames=["Analcolici","Caff\xE8 e T\xE8","Vini e Alcolici"];ensureDrinkGroupsExist(){return m(this,null,function*(){console.log("Gruppi bevande verificati:",this.drinkGroupNames)})}getDrinkGroupIds(){return m(this,null,function*(){return this.drinkGroupIds})}getDrinkGroupDetails(){return m(this,null,function*(){return[{id:"2fe735fb-5e1f-4dd6-8ec6-5e4e4d79d03d",name:"Analcolici"},{id:"bb2e6dc6-2932-4c03-abb7-bd0c5877625d",name:"Caff\xE8 e T\xE8"},{id:"8fe1a885-1755-4baf-8c66-1603d4378909",name:"Vini e Alcolici"}]})}getDrinkTypeFromGroup(t){return{"2fe735fb-5e1f-4dd6-8ec6-5e4e4d79d03d":"non_alcoholic","bb2e6dc6-2932-4c03-abb7-bd0c5877625d":"non_alcoholic","8fe1a885-1755-4baf-8c66-1603d4378909":"alcoholic"}[t]||"non_alcoholic"}getGroupName(t){return{"2fe735fb-5e1f-4dd6-8ec6-5e4e4d79d03d":"Analcolici","bb2e6dc6-2932-4c03-abb7-bd0c5877625d":"Caff\xE8 e T\xE8","8fe1a885-1755-4baf-8c66-1603d4378909":"Vini e Alcolici"}[t]||"Sconosciuto"}static \u0275fac=(()=>{let t;return function(i){return(t||(t=L(s)))(i||s)}})();static \u0275prov=k({token:s,factory:s.\u0275fac,providedIn:"root"})};var j=class s{drinkIngredientsSubject=new ne([]);drinkIngredients$=this.drinkIngredientsSubject.asObservable();drinkGroupIds=[];ingredientService=M(Q);drinkGroupService=M(F);supabaseService=M(q);initialize(){return m(this,null,function*(){yield this.drinkGroupService.ensureDrinkGroupsExist(),this.drinkGroupIds=yield this.drinkGroupService.getDrinkGroupIds(),this.ingredientService.data$.subscribe(t=>{let e=t.filter(i=>i.group_id&&this.drinkGroupIds.includes(i.group_id));this.drinkIngredientsSubject.next(e)})})}getDrinkIngredients(){return this.drinkIngredientsSubject.value}markAsDrink(t,e){return m(this,null,function*(){try{let i=this.supabaseService.getSupabaseClient();if(!this.drinkGroupIds.includes(e))return console.error(`Gruppo di bevanda non valido: ${e}`),!1;let{error:a}=yield i.from("ingredients").update({group_id:e}).eq("id",t);return a?(console.error("Errore nell'aggiornamento dell'ingrediente:",a),!1):(yield this.ingredientService.loadData(),!0)}catch(i){return console.error("Errore nel contrassegnare come bevanda:",i),!1}})}getDrinkIngredientsByType(){let t=this.getDrinkIngredients(),e={alcoholic:[],non_alcoholic:[]};return t.forEach(i=>{this.drinkGroupService.getDrinkTypeFromGroup(i.group_id)==="alcoholic"?e.alcoholic.push(i):e.non_alcoholic.push(i)}),e}getGroupNameForIngredient(t){return this.drinkGroupService.getGroupName(t.group_id)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=k({token:s,factory:s.\u0275fac,providedIn:"root"})};var X=class s{dishService=M(Y);categoryService=M(Z);menuService=M(K);drinkIngredientService=M(j);drinkGroupService=M(F);createBeverageFromIngredient(t,e,i){return m(this,null,function*(){let a=this.drinkIngredientService.getDrinkIngredients().find(V=>V.id===t);if(!a)throw new Error("Ingrediente non trovato");let l=this.drinkGroupService.getGroupName(a.group_id),g="Bevande";l==="Vini e Alcolici"&&(g="Alcolici");let I=yield this.findOrCreateCategory(g),A=this.drinkGroupService.getDrinkTypeFromGroup(a.group_id),G=yield this.dishService.createDish({name:`[Bev] ${a.name}`,description:`${l} - Prodotto confezionato`,base_price:e,food_cost:a.cost_per_unit||0,category_id:I.id,status:"available",preparation_time:0,extended_data:{type:"beverage",drink_type:A,beverage_group:l,group_id:a.group_id,volume:a.volume||null}});return G&&i&&(yield this.menuService.addDishToMenu(i,G.id,I.id,0)),G})}findOrCreateCategory(t){return m(this,null,function*(){try{let i=(yield ee(this.categoryService.data$)).find(a=>a.name===t);if(!i){let a=yield this.categoryService.createCategory({name:t,description:`Categoria per ${t.toLowerCase()}`});a?i=a:(console.warn(`Impossibile creare la categoria "${t}", creo una temporanea`),i={id:`temp-${Date.now()}`,restaurant_id:(yield ee(this.categoryService.getRestaurantId$()))||"",name:t,description:`Categoria per ${t.toLowerCase()}`,order_index:999,is_default:!1,created_at:new Date().toISOString()})}return i}catch(e){return console.error(`Errore nel trovare/creare la categoria "${t}":`,e),{id:`error-${Date.now()}`,restaurant_id:"",name:t,description:`Categoria per ${t.toLowerCase()}`,order_index:999,is_default:!1,created_at:new Date().toISOString()}}})}createAlcoholicBeverage(t,e){return m(this,null,function*(){let i="";switch(t.type){case"vino":i="Vini";break;case"birra":i="Birre";break;case"superalcolico":i="Superalcolici";break;case"cocktail":i="Cocktail";break}let a=yield this.findOrCreateCategory(i),l=yield this.dishService.createDish({name:t.name,description:t.description||`${t.type} - ${t.grapeVariety||""} ${t.vintageYear||""}`.trim(),base_price:t.price,food_cost:t.cost,category_id:a.id,status:"available",preparation_time:t.type==="cocktail"?5:0,extended_data:{type:"alcoholic_beverage",beverage_type:t.type,volume:t.volume,alcohol_content:t.alcoholContent,vintage_year:t.vintageYear,grape_variety:t.grapeVariety}});return l&&e&&(yield this.menuService.addDishToMenu(e,l.id,a.id,0)),l})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=k({token:s,factory:s.\u0275fac,providedIn:"root"})};function we(s,t){if(s&1&&(n(0,"option",69),o(1),r()),s&2){let e=t.$implicit;d("value",e.id),c(),$(" ",e.name," ",e.is_default?"(Default)":""," ")}}function Ce(s,t){if(s&1){let e=S();n(0,"div",70)(1,"div",12)(2,"input",71),C("ngModelChange",function(a){f(e);let l=u();return w(l.editedMenuName,a)||(l.editedMenuName=a),v(a)}),p("keyup.enter",function(){f(e);let a=u();return v(a.saveMenuName())})("keyup.escape",function(){f(e);let a=u();return v(a.cancelEditMenuName())}),r(),n(3,"div",2)(4,"button",72),p("click",function(){f(e);let a=u();return v(a.saveMenuName())}),n(5,"span",16),o(6,"check"),r()(),n(7,"button",73),p("click",function(){f(e);let a=u();return v(a.cancelEditMenuName())}),n(8,"span",16),o(9,"close"),r()()()(),n(10,"div",74),o(11," Premi Invio per salvare, Esc per annullare "),r()()}if(s&2){let e=u();c(2),D("ngModel",e.editedMenuName)}}function Ee(s,t){if(s&1){let e=S();n(0,"div",75)(1,"label",76)(2,"input",77),p("change",function(){f(e);let a=u();return v(a.toggleMenuType())}),r(),n(3,"span",78),o(4,"Menu Specifico (Dedicato)"),r()()()}if(s&2){let e=u();c(2),d("checked",e.currentMenu.type==="dedicated")("disabled",e.currentMenu.is_default)}}function Ie(s,t){s&1&&(n(0,"div",79),o(1," Questo menu \xE8 dedicato a una specifica prenotazione o evento. "),r())}function ke(s,t){s&1&&(n(0,"div",80),o(1," Attenzione: Il menu di default non pu\xF2 essere specifico. Seleziona un altro menu come default prima di impostare questo come specifico. "),r())}function Te(s,t){s&1&&(n(0,"span",81)(1,"span",60),o(2,"event"),r(),o(3," Specifico "),r())}function Be(s,t){s&1&&(n(0,"span",82)(1,"span",60),o(2,"public"),r(),o(3," Globale "),r())}function Pe(s,t){if(s&1){let e=S();n(0,"div",23)(1,"div",10)(2,"label",76)(3,"input",77),p("change",function(){f(e);let a=u();return v(a.toggleMenuFavorite())}),r(),n(4,"span",78),o(5," Preferito "),n(6,"span",83),o(7,"star"),r()()()(),n(8,"div",10)(9,"label",76)(10,"input",77),p("change",function(){f(e);let a=u();return v(a.toggleMenuActive())}),r(),n(11,"span",78),o(12," Attivo "),n(13,"span",84),o(14,"check_circle"),r()()()()()}if(s&2){let e=u();c(3),d("checked",e.currentMenu.is_favorite)("disabled",e.currentMenu.is_default),c(7),d("checked",e.currentMenu.is_active)("disabled",e.currentMenu.is_default)}}function Fe(s,t){s&1&&(n(0,"span",82),o(1,"Default"),r())}function Ae(s,t){s&1&&(n(0,"span",87),o(1,"Non attivo"),r())}function Ve(s,t){if(s&1&&(n(0,"div",28)(1,"span",85),o(2,"info"),r(),n(3,"span",5),o(4),r(),h(5,Fe,2,0,"span",31)(6,Ae,2,0,"span",86),r()),s&2){let e=u();c(4),E(e.currentMenu.description||"Nessuna descrizione"),c(),d("ngIf",e.currentMenu.is_default),c(),d("ngIf",!e.currentMenu.is_active)}}function Ne(s,t){if(s&1){let e=S();n(0,"div",23)(1,"div",10)(2,"label",76)(3,"input",77),p("change",function(){f(e);let a=u();return v(a.toggleMenuDefault())}),r(),n(4,"span",78),o(5," Default "),n(6,"span",88),o(7,"flag"),r()()()()()}if(s&2){let e=u();c(3),d("checked",e.currentMenu.is_default)("disabled",e.currentMenu.is_default)}}function Oe(s,t){if(s&1&&(n(0,"option",69),o(1),r()),s&2){let e=t.$implicit;d("value",e.id),c(),_(" ",e.name," ")}}function ze(s,t){if(s&1&&(n(0,"span",16),o(1),r()),s&2){let e=u();c(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function $e(s,t){if(s&1&&(n(0,"span",16),o(1),r()),s&2){let e=u();c(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function Ge(s,t){if(s&1&&(n(0,"span",16),o(1),r()),s&2){let e=u();c(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function je(s,t){if(s&1&&(n(0,"span",16),o(1),r()),s&2){let e=u();c(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function We(s,t){if(s&1&&(n(0,"span",16),o(1),r()),s&2){let e=u();c(),_(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function Le(s,t){if(s&1&&(n(0,"div",97)(1,"span",98),o(2,"delete"),r(),n(3,"span",99),o(4),x(5,"date"),r()()),s&2){let e=u().$implicit;c(4),_(" Eliminato il ",y(5,1,e.deleted_at,"dd/MM/yyyy")," ")}}function Re(s,t){s&1&&(n(0,"div",97)(1,"span",100),o(2,"warning"),r(),n(3,"span",101),o(4," Senza menu "),r()())}function qe(s,t){if(s&1&&(n(0,"div",102),o(1),x(2,"slice"),r()),s&2){let e=u().$implicit;c(),$(" ",R(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function Ue(s,t){if(s&1&&(n(0,"span",5),o(1),r()),s&2){let e=u().$implicit;c(),_(" ",e.preparation_time," min ")}}function Qe(s,t){s&1&&(n(0,"span",5),o(1,"-"),r())}function Ye(s,t){if(s&1){let e=S();T(0),n(1,"button",103),p("click",function(){f(e);let a=u().$implicit,l=u(2);return v(l.showCopyMenuDialog(a))}),n(2,"span",16),o(3,"content_copy"),r()(),n(4,"button",104),p("click",function(){f(e);let a=u().$implicit,l=u(2);return v(l.showMoveMenuDialog(a))}),n(5,"span",16),o(6,"open_with"),r()(),n(7,"button",105),p("click",function(){f(e);let a=u().$implicit,l=u(2);return v(l.confirmDeleteDish(a))}),n(8,"span",16),o(9,"delete"),r()(),B()}if(s&2){let e=u().$implicit,i=u(2);c(),d("disabled",!e.id||!i.menus||i.menus.length===0),c(3),d("disabled",!e.id||!i.menus||i.menus.length===0||i.menus.length===1)}}function Ze(s,t){if(s&1){let e=S();T(0),n(1,"button",106),p("click",function(){f(e);let a=u().$implicit,l=u(2);return v(l.confirmRestoreDish(a))}),n(2,"span",16),o(3,"restore"),r()(),B()}}function Ke(s,t){if(s&1){let e=S();n(0,"tr")(1,"td"),h(2,Le,6,4,"div",90)(3,Re,5,0,"div",90),n(4,"div",28)(5,"div",91)(6,"strong",92),p("click",function(){let a=f(e).$implicit,l=u(2);return v(l.editDish(a.id))}),o(7),r(),h(8,qe,3,6,"div",93),r()()(),n(9,"td"),o(10),r(),n(11,"td")(12,"strong"),o(13),x(14,"number"),r()(),n(15,"td"),o(16),x(17,"number"),r(),n(18,"td")(19,"span"),o(20),x(21,"number"),r()(),n(22,"td")(23,"select",94),p("ngModelChange",function(a){let l=f(e).$implicit,g=u(2);return v(g.updateDishStatus(l,a))}),n(24,"option",51),o(25,"Disponibile"),r(),n(26,"option",52),o(27,"Non disponibile"),r(),n(28,"option",53),o(29,"Esaurito"),r()()(),n(30,"td"),h(31,Ue,2,1,"span",95)(32,Qe,2,0,"span",95),r(),n(33,"td")(34,"div",96),h(35,Ye,10,2,"ng-container",67)(36,Ze,4,0,"ng-container",67),r()()()}if(s&2){let e=t.$implicit,i=u(2);P("opacity-60",e.deleted_at)("bg-gray-50",e.deleted_at),c(2),d("ngIf",e.deleted_at),c(),d("ngIf",!e.deleted_at&&i.isDishWithoutMenu(e.id)),c(4),_(" ",e.name," "),c(),d("ngIf",e.description),c(2),E(i.getCategoryName(e.category_id||"")),c(3),_("\u20AC",y(14,25,e.base_price,"1.2-2")),c(3),_("",y(17,28,i.calculateFoodCostPercentage(e),"1.0-1"),"%"),c(3),W(i.calculateMargin(e)>=0?"text-muted":"error"),c(),_(" \u20AC",y(21,31,i.calculateMargin(e),"1.2-2")," "),c(3),P("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),d("ngModel",e.status),c(8),d("ngIf",e.preparation_time),c(),d("ngIf",!e.preparation_time),c(3),d("ngIf",!e.deleted_at),c(),d("ngIf",e.deleted_at)}}function He(s,t){if(s&1&&(T(0),h(1,Ke,37,34,"tr",89),B()),s&2){let e=u();c(),d("ngForOf",e.filteredDishes)}}function Je(s,t){if(s&1&&(n(0,"tr",109)(1,"td",110)(2,"div",111)(3,"span",40),o(4,"folder"),r(),n(5,"div",112),o(6),r(),n(7,"span",113),o(8),r()()()()),s&2){let e=u().$implicit,i=u(2);c(6),E(e.name),c(2),_(" ",i.getDishesByCategory(e.id).length," piatti ")}}function Xe(s,t){if(s&1&&(n(0,"div",97)(1,"span",98),o(2,"delete"),r(),n(3,"span",99),o(4),x(5,"date"),r()()),s&2){let e=u().$implicit;c(4),_(" Eliminato il ",y(5,1,e.deleted_at,"dd/MM/yyyy")," ")}}function et(s,t){s&1&&(n(0,"div",97)(1,"span",100),o(2,"warning"),r(),n(3,"span",101),o(4," Senza menu "),r()())}function tt(s,t){if(s&1&&(n(0,"div",102),o(1),x(2,"slice"),r()),s&2){let e=u().$implicit;c(),$(" ",R(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function it(s,t){if(s&1&&(n(0,"span",5),o(1),r()),s&2){let e=u().$implicit;c(),_(" ",e.preparation_time," min ")}}function nt(s,t){s&1&&(n(0,"span",5),o(1,"-"),r())}function rt(s,t){if(s&1){let e=S();T(0),n(1,"button",103),p("click",function(){f(e);let a=u().$implicit,l=u(3);return v(l.showCopyMenuDialog(a))}),n(2,"span",16),o(3,"content_copy"),r()(),n(4,"button",104),p("click",function(){f(e);let a=u().$implicit,l=u(3);return v(l.showMoveMenuDialog(a))}),n(5,"span",16),o(6,"open_with"),r()(),n(7,"button",105),p("click",function(){f(e);let a=u().$implicit,l=u(3);return v(l.confirmDeleteDish(a))}),n(8,"span",16),o(9,"delete"),r()(),B()}if(s&2){let e=u().$implicit,i=u(3);c(),d("disabled",!e.id||!i.menus||i.menus.length===0),c(3),d("disabled",!e.id||!i.menus||i.menus.length===0||i.menus.length===1)}}function at(s,t){if(s&1){let e=S();T(0),n(1,"button",106),p("click",function(){f(e);let a=u().$implicit,l=u(3);return v(l.confirmRestoreDish(a))}),n(2,"span",16),o(3,"restore"),r()(),B()}}function ot(s,t){if(s&1){let e=S();n(0,"tr")(1,"td"),h(2,Xe,6,4,"div",90)(3,et,5,0,"div",90),n(4,"div",28)(5,"div",91)(6,"strong",92),p("click",function(){let a=f(e).$implicit,l=u(3);return v(l.editDish(a.id))}),o(7),r(),h(8,tt,3,6,"div",93),r()()(),n(9,"td"),o(10),r(),n(11,"td")(12,"strong"),o(13),x(14,"number"),r()(),n(15,"td"),o(16),x(17,"number"),r(),n(18,"td")(19,"span"),o(20),x(21,"number"),r()(),n(22,"td")(23,"select",94),p("ngModelChange",function(a){let l=f(e).$implicit,g=u(3);return v(g.updateDishStatus(l,a))}),n(24,"option",51),o(25,"Disponibile"),r(),n(26,"option",52),o(27,"Non disponibile"),r(),n(28,"option",53),o(29,"Esaurito"),r()()(),n(30,"td"),h(31,it,2,1,"span",95)(32,nt,2,0,"span",95),r(),n(33,"td")(34,"div",96),h(35,rt,10,2,"ng-container",67)(36,at,4,0,"ng-container",67),r()()()}if(s&2){let e=t.$implicit,i=u(3);P("opacity-60",e.deleted_at)("bg-gray-50",e.deleted_at),c(2),d("ngIf",e.deleted_at),c(),d("ngIf",!e.deleted_at&&i.isDishWithoutMenu(e.id)),c(4),_(" ",e.name," "),c(),d("ngIf",e.description),c(2),E(i.getCategoryName(e.category_id||"")),c(3),_("\u20AC",y(14,25,e.base_price,"1.2-2")),c(3),_("",y(17,28,i.calculateFoodCostPercentage(e),"1.0-1"),"%"),c(3),W(i.calculateMargin(e)>=0?"text-muted":"error"),c(),_(" \u20AC",y(21,31,i.calculateMargin(e),"1.2-2")," "),c(3),P("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),d("ngModel",e.status),c(8),d("ngIf",e.preparation_time),c(),d("ngIf",!e.preparation_time),c(3),d("ngIf",!e.deleted_at),c(),d("ngIf",e.deleted_at)}}function st(s,t){if(s&1&&(T(0),h(1,Je,9,2,"tr",108)(2,ot,37,34,"tr",89),B()),s&2){let e=t.$implicit,i=u(2);c(),d("ngIf",i.getDishesByCategory(e.id).length>0),c(),d("ngForOf",i.getDishesByCategory(e.id))}}function lt(s,t){if(s&1&&(n(0,"tr",109)(1,"td",114)(2,"div",115)(3,"span",16),o(4,"folder_open"),r(),o(5," Senza Categoria "),n(6,"span",116),o(7),r()()()()),s&2){let e=u(2);c(7),_(" ",e.getDishesByCategory("").length," piatti ")}}function ct(s,t){if(s&1&&(n(0,"div",97)(1,"span",98),o(2,"delete"),r(),n(3,"span",99),o(4),x(5,"date"),r()()),s&2){let e=u().$implicit;c(4),_(" Eliminato il ",y(5,1,e.deleted_at,"dd/MM/yyyy")," ")}}function dt(s,t){s&1&&(n(0,"div",97)(1,"span",100),o(2,"warning"),r(),n(3,"span",101),o(4," Senza menu "),r()())}function ut(s,t){if(s&1&&(n(0,"div",102),o(1),x(2,"slice"),r()),s&2){let e=u().$implicit;c(),$(" ",R(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function mt(s,t){if(s&1&&(n(0,"span",5),o(1),r()),s&2){let e=u().$implicit;c(),_(" ",e.preparation_time," min ")}}function pt(s,t){s&1&&(n(0,"span",5),o(1,"-"),r())}function gt(s,t){if(s&1){let e=S();n(0,"tr")(1,"td"),h(2,ct,6,4,"div",90)(3,dt,5,0,"div",90),n(4,"div",28)(5,"div",91)(6,"strong",92),p("click",function(){let a=f(e).$implicit,l=u(2);return v(l.editDish(a.id))}),o(7),r(),h(8,ut,3,6,"div",93),r()()(),n(9,"td",5),o(10,"-"),r(),n(11,"td")(12,"strong"),o(13),x(14,"number"),r()(),n(15,"td"),o(16),x(17,"number"),r(),n(18,"td")(19,"span"),o(20),x(21,"number"),r()(),n(22,"td")(23,"span"),o(24),x(25,"number"),r()(),n(26,"td")(27,"span",113),o(28),r()(),n(29,"td"),h(30,mt,2,1,"span",95)(31,pt,2,0,"span",95),r()()}if(s&2){let e=t.$implicit,i=u(2);P("opacity-60",e.deleted_at)("bg-gray-50",e.deleted_at),c(2),d("ngIf",e.deleted_at),c(),d("ngIf",!e.deleted_at&&i.isDishWithoutMenu(e.id)),c(4),_(" ",e.name," "),c(),d("ngIf",e.description),c(5),_("\u20AC",y(14,23,e.base_price,"1.2-2")),c(3),_("\u20AC",y(17,26,e.food_cost,"1.2-2")),c(3),W(i.calculateMargin(e)>=0?"text-muted":"error"),c(),_(" \u20AC",y(21,29,i.calculateMargin(e),"1.2-2")," "),c(3),W(i.calculateMarginPercentage(e)>=0?"text-muted":"error"),c(),_(" ",y(25,32,i.calculateMarginPercentage(e),"1.0-0"),"% "),c(3),P("active",e.status==="available")("inactive",e.status!=="available"),c(),_(" ",i.getStatusText(e.status)," "),c(2),d("ngIf",e.preparation_time),c(),d("ngIf",!e.preparation_time)}}function _t(s,t){if(s&1&&(T(0),h(1,st,3,2,"ng-container",107)(2,lt,8,1,"tr",108)(3,gt,32,35,"tr",89),B()),s&2){let e=u();c(),d("ngForOf",e.categories),c(),d("ngIf",e.getDishesByCategory("").length>0),c(),d("ngForOf",e.getDishesByCategory(""))}}function ht(s,t){s&1&&(n(0,"tr")(1,"td",117)(2,"div",118)(3,"span",16),o(4,"search_off"),r(),n(5,"h3"),o(6,"Nessun piatto trovato"),r(),n(7,"p"),o(8,"Prova a modificare i filtri di ricerca o aggiungi un nuovo piatto"),r()()()())}function ft(s,t){if(s&1&&(n(0,"option",69),o(1),x(2,"number"),r()),s&2){let e=t.$implicit;d("value",e.id),c(),$(" ",e.name," - \u20AC",y(2,3,e.cost_per_unit,"1.2-2")," ")}}function vt(s,t){if(s&1){let e=S();n(0,"div",119)(1,"div",120)(2,"div",121)(3,"div",28)(4,"span",16),o(5,"local_drink"),r(),n(6,"h2",8),o(7,"Aggiungi Bevanda"),r()(),n(8,"button",122),p("click",function(){f(e);let a=u();return v(a.closeAddDrinkDialog())}),n(9,"span",16),o(10,"close"),r()()(),n(11,"div",123)(12,"div",10)(13,"label",11)(14,"span",16),o(15,"local_bar"),r(),o(16," Seleziona Bevanda "),r(),n(17,"select",124),C("ngModelChange",function(a){f(e);let l=u();return w(l.selectedDrinkIngredient,a)||(l.selectedDrinkIngredient=a),v(a)}),n(18,"option",125),o(19,"Seleziona una bevanda..."),r(),h(20,ft,3,6,"option",14),r()(),n(21,"div",10)(22,"label",11)(23,"span",16),o(24,"euro"),r(),o(25," Prezzo di Vendita "),r(),n(26,"input",126),C("ngModelChange",function(a){f(e);let l=u();return w(l.drinkPrice,a)||(l.drinkPrice=a),v(a)}),r()()(),n(27,"div",127)(28,"button",59),p("click",function(){f(e);let a=u();return v(a.closeAddDrinkDialog())}),o(29," Annulla "),r(),n(30,"button",128),p("click",function(){f(e);let a=u();return v(a.addDrinkFromIngredient())}),n(31,"span",16),o(32,"add"),r(),o(33," Aggiungi "),r()()()()}if(s&2){let e=u();c(17),D("ngModel",e.selectedDrinkIngredient),c(3),d("ngForOf",e.drinkIngredientService.getDrinkIngredients()),c(6),D("ngModel",e.drinkPrice),c(4),d("disabled",!e.selectedDrinkIngredient||!e.drinkPrice)}}function Mt(s,t){if(s&1&&(n(0,"option",69),o(1),r()),s&2){let e=t.$implicit;d("value",e.id),c(),$(" ",e.name," ",e.is_default?"(Default)":""," ")}}function xt(s,t){s&1&&(n(0,"span",136),o(1,"refresh"),r())}function yt(s,t){s&1&&(n(0,"span",16),o(1,"check"),r())}function St(s,t){if(s&1){let e=S();n(0,"div",119)(1,"div",120)(2,"div",121)(3,"div",28)(4,"span",16),o(5),r(),n(6,"h2",8),o(7),r()(),n(8,"button",129),p("click",function(){f(e);let a=u();return v(a.closeMoveDialog())}),n(9,"span",16),o(10,"close"),r()()(),n(11,"div",123)(12,"div",130)(13,"span",16),o(14,"info"),r(),n(15,"div")(16,"strong"),o(17),r(),oe(18,"br"),n(19,"span",5),o(20),r()()(),n(21,"div",10)(22,"label",11)(23,"span",16),o(24,"restaurant_menu"),r(),o(25," Menu di destinazione "),r(),n(26,"select",131),C("ngModelChange",function(a){f(e);let l=u();return w(l.selectedTargetMenuId,a)||(l.selectedTargetMenuId=a),v(a)}),n(27,"option",125),o(28,"Seleziona un menu..."),r(),h(29,Mt,2,3,"option",14),r()(),n(30,"div",132)(31,"div",133)(32,"span",16),o(33,"info"),r(),o(34),r()()(),n(35,"div",127)(36,"button",134),p("click",function(){f(e);let a=u();return v(a.closeMoveDialog())}),o(37," Annulla "),r(),n(38,"button",128),p("click",function(){f(e);let a=u();return v(a.moveDishToMenu())}),h(39,xt,2,0,"span",135)(40,yt,2,0,"span",65),o(41),r()()()()}if(s&2){let e=u();c(5),E(e.isCopyMode?"content_copy":"drive_file_move"),c(2),E(e.isCopyMode?"Copia Piatto":"Sposta Piatto"),c(),d("disabled",e.isMoving),c(9),E(e.dishToMove==null?null:e.dishToMove.name),c(3),_(" ",e.isCopyMode?"Seleziona il menu in cui copiare il piatto":"Seleziona il menu di destinazione"),c(6),D("ngModel",e.selectedTargetMenuId),d("disabled",e.isMoving),c(3),d("ngForOf",e.getAvailableMenusForMove()),c(5),_(" ",e.isCopyMode?"Il piatto verr\xE0 copiato nel menu selezionato.":"Il piatto verr\xE0 spostato nel menu selezionato e rimosso dal menu corrente."," "),c(2),d("disabled",e.isMoving),c(2),d("disabled",!e.selectedTargetMenuId||e.isMoving),c(),d("ngIf",e.isMoving),c(),d("ngIf",!e.isMoving),c(),_(" ",e.isMoving?e.isCopyMode?"Copia...":"Spostamento...":e.isCopyMode?"Copia":"Sposta"," ")}}var be=class s{dishService=M(Y);categoryService=M(Z);router=M(pe);menuDishService=M(H);menuService=M(K);drinkIngredientService=M(j);drinkGroupService=M(F);ingredientService=M(Q);beverageService=M(X);isEditingMenuName=!1;editedMenuName="";isCopyMode=!1;isSpecificMenu=!1;showDeletedDishes=!1;sortedCategories=[];dishes=[];categories=[];menus=[];selectedMenuId=null;currentMenu=null;filteredDishes=[];menuDishes=[];viewMode="menu-only";drinkIngredients=[];drinkTypes=[];showMarkAsDrinkDialog=!1;ingredientToMarkAsDrink=null;selectedDrinkType="";showAddDrinkDialog=!1;selectedDrinkIngredient=null;drinkPrice=null;drinkGroupDetails=[];selectedDrinkGroup="";showMoveDialog=!1;dishToMove=null;selectedTargetMenuId=null;isMoving=!1;stats={totalDishes:0,totalCategories:0,averagePrice:0,averageFoodCostPercentage:0,averageMarginPercentage:0,averageMargin:0};searchTerm="";selectedCategory="all";statusFilter="all";priceRange={min:null,max:null};sortField="category";sortDirection="asc";ngOnInit(){return m(this,null,function*(){this.loadData(),yield this.drinkIngredientService.initialize()})}loadData(){return m(this,null,function*(){try{yield Promise.all([this.dishService.loadData(),this.categoryService.loadData(),this.menuService.loadData(),this.menuDishService.loadData()]),this.dishService.data$.subscribe(t=>{this.dishes=t,this.applyFilters(),this.calculateStats()}),this.menuDishService.data$.subscribe(t=>{console.log("\u{1F4E5} menuDishService data$ updated (TUTTI i menuDishes):",t.length),this.menuDishes=t,this.currentMenu&&this.applyFilters()}),this.categoryService.data$.subscribe(t=>{this.categories=t,this.sortedCategories=[...t].sort((e,i)=>e.name.localeCompare(i.name)),this.calculateStats()}),this.menuService.data$.subscribe(t=>{if(this.menus=t.map(e=>z(O({},e),{type:e.type||"global"})),this.menus.length>0){let e=this.menus.find(i=>i.is_default)||this.menus[0];this.selectedMenuId=e.id,this.currentMenu=e,this.syncCheckboxState(),this.applyFilters()}})}catch(t){console.error("Errore nel caricamento dei dati:",t)}})}calculateStats(){let t=this.filteredDishes;if(!t||t.length===0){this.stats={totalDishes:0,totalCategories:0,averagePrice:0,averageFoodCostPercentage:0,averageMarginPercentage:0,averageMargin:0};return}let e=t.length,a=new Set(t.map(b=>b.category_id).filter(b=>b)).size,l=t.reduce((b,N)=>b+(N.base_price||0),0),g=e>0?l/e:0,I=t.reduce((b,N)=>b+(N.base_price-N.food_cost),0),A=e>0?I/e:0,G=t.filter(b=>b.base_price>0),V=G.length,te=0,ie=0;V>0&&G.forEach(b=>{let N=b.food_cost/b.base_price*100,De=100-N;te+=N,ie+=De}),this.stats={totalDishes:e,totalCategories:a,averagePrice:g,averageFoodCostPercentage:V>0?te/V:0,averageMarginPercentage:V>0?ie/V:0,averageMargin:A},console.log("\u{1F4CA} Statistiche piatti visibili:",{visibleDishesCount:t.length,totalDishesInSystem:this.dishes.length,viewMode:this.viewMode,currentMenu:this.currentMenu?.name,stats:this.stats})}applyFilters(){if(!this.dishes||this.dishes.length===0){this.filteredDishes=[];return}let t=this.dishes.filter(e=>this.showDeletedDishes?!0:!e.deleted_at);if(this.currentMenu&&this.viewMode==="menu-only"){let e=this.menuDishes.filter(i=>i.menu_id===this.currentMenu.id&&i.is_active).map(i=>i.dish_id);t=t.filter(i=>e.includes(i.id))}else if(this.viewMode==="without-menu"){let e=this.menuDishes.filter(a=>a.is_active).map(a=>a.dish_id),i=[...new Set(e)];t=t.filter(a=>!i.includes(a.id))}t=this.applyCommonFilters(t),t=this.sortDishes(t),this.filteredDishes=[...t],this.calculateStats()}applyCommonFilters(t){let e=[...t];if(this.searchTerm.trim()){let i=this.searchTerm.toLowerCase();e=e.filter(a=>a.name.toLowerCase().includes(i)||a.description&&a.description.toLowerCase().includes(i))}return this.selectedCategory&&this.selectedCategory!=="all"&&(e=e.filter(i=>i.category_id===this.selectedCategory)),this.statusFilter&&this.statusFilter!=="all"&&(e=e.filter(i=>i.status===this.statusFilter)),this.priceRange.min!==null&&(e=e.filter(i=>i.base_price>=this.priceRange.min)),this.priceRange.max!==null&&(e=e.filter(i=>i.base_price<=this.priceRange.max)),e}sortDishes(t){return t.length?[...t].sort((e,i)=>{let a,l;switch(this.sortField){case"name":a=e.name.toLowerCase(),l=i.name.toLowerCase();break;case"category":a=this.getCategoryName(e.category_id||"").toLowerCase(),l=this.getCategoryName(i.category_id||"").toLowerCase(),a===l&&(a=e.name.toLowerCase(),l=i.name.toLowerCase());break;case"price":a=e.base_price,l=i.base_price;break;case"food_cost_percentage":a=this.calculateFoodCostPercentage(e),l=this.calculateFoodCostPercentage(i);break;case"margin":a=this.calculateMargin(e),l=this.calculateMargin(i);break;default:a=e.name.toLowerCase(),l=i.name.toLowerCase()}return a<l?this.sortDirection==="asc"?-1:1:a>l?this.sortDirection==="asc"?1:-1:0}):t}getViewModeStats(){let t=this.dishes.filter(l=>this.showDeletedDishes?!0:!l.deleted_at),e=new Set(this.menuDishes.filter(l=>l.is_active).map(l=>l.dish_id)),i=0;if(this.currentMenu){let l=new Set(this.menuDishes.filter(g=>g.menu_id===this.currentMenu.id&&g.is_active).map(g=>g.dish_id));i=t.filter(g=>l.has(g.id)).length}let a=t.filter(l=>!e.has(l.id)).length;return{"menu-only":i,"all-dishes":t.length,"without-menu":a}}getDishesWithoutMenu(){let t=this.menuDishes.filter(e=>e.is_active).map(e=>e.dish_id);return this.dishes.filter(e=>!t.includes(e.id)&&(this.showDeletedDishes?!0:!e.deleted_at))}onSort(t){this.sortField===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=t,this.sortDirection="asc"),this.applyFilters()}getCategoryName(t){return this.categories.find(i=>i.id===t)?.name||"Senza categoria"}calculateMargin(t){return t.base_price-t.food_cost}calculateMarginPercentage(t){return t.base_price===0?0:(t.base_price-t.food_cost)/t.base_price*100}getDishesByCategory(t){return this.filteredDishes.filter(e=>e.category_id===t)}resetFilters(){this.searchTerm="",this.selectedCategory="all",this.statusFilter="all",this.priceRange={min:null,max:null},this.sortField="category",this.sortDirection="asc",this.applyFilters()}getStatusText(t){return{available:"Disponibile",unavailable:"Non disponibile",out_of_stock:"Esaurito"}[t]||t}editDish(t){this.router.navigate(["/food-cost-calculator",t])}createNewDish(){this.router.navigate(["/food-cost"])}calculateFoodCostPercentage(t){return!t.base_price||t.base_price===0?0:t.food_cost/t.base_price*100}updateDishStatus(t,e){return m(this,null,function*(){try{let i=t.status;e==="available"||e==="unavailable"||e==="out_of_stock"?(t.status=e,(yield this.dishService.updateDish(t.id,{status:e}))?(console.log(`Stato piatto ${t.name} aggiornato a: ${e}`),this.calculateStats()):(t.status=i,console.error("Errore nell'aggiornamento dello stato del piatto"),alert("Errore durante l'aggiornamento dello stato. Riprova."))):(console.error("Stato non valido:",e),alert("Stato non valido selezionato."))}catch(i){console.error("Errore durante l'aggiornamento dello stato:",i),alert("Errore durante l'aggiornamento dello stato.")}})}confirmDeleteDish(t){return m(this,null,function*(){let e=`Sei sicuro di voler eliminare il piatto "${t.name}"?

Questa azione non pu\xF2 essere annullata.`;confirm(e)&&(yield this.deleteDish(t.id))})}deleteDish(t){return m(this,null,function*(){try{(yield this.dishService.deleteDish(t))?console.log("\u2705 Piatto eliminato con successo"):alert("Errore durante l'eliminazione del piatto")}catch(e){console.error("\u274C Errore durante l'eliminazione:",e),alert("Errore durante l'eliminazione del piatto")}})}loadMenuDishes(){return m(this,null,function*(){this.currentMenu&&(this.menuDishes=yield this.menuDishService.getDishesWithDetailsByMenu(this.currentMenu.id))})}changeMenu(t){let e=this.menus.find(i=>i.id===t);e&&!e.is_active&&!e.is_default&&!confirm(`\u26A0\uFE0F Attenzione: il menu "${e.name}" \xE8 disattivato.
Vuoi comunque selezionarlo?`)||(this.selectedMenuId=t,this.currentMenu=e||null,this.currentMenu?(this.syncCheckboxState(),this.applyFilters()):this.isSpecificMenu=!1)}createNewMenu(){return m(this,null,function*(){let t=prompt("Nome del nuovo menu:");if(t){let e=prompt("Descrizione (opzionale):"),i=confirm("Impostare come menu di default?"),a=confirm("\xC8 un menu specifico (dedicato)?"),l=e||void 0,g;a?g=yield this.menuService.createDedicatedMenu(t,l):g=yield this.menuService.createMenu(t,l,i),g&&(this.currentMenu=g,this.syncCheckboxState(),this.selectedMenuId=g.id,this.loadMenuDishes(),yield this.menuService.loadData())}})}toggleDishInMenu(t){return m(this,null,function*(){if(!this.currentMenu)return;let e=this.menuDishes.find(i=>i.menu_id===this.currentMenu.id&&i.dish_id===t.id);if(e)yield this.menuService.removeDishFromMenu(e.id);else{let i=yield this.menuDishService.addDishToMenu(this.currentMenu.id,t.id,t.category_id||"");i&&(this.menuDishes=[...this.menuDishes,i])}this.applyFilters()})}loadAvailableDishes(){return m(this,null,function*(){yield this.dishService.loadData()})}isDishInCurrentMenu(t){return this.currentMenu?this.menuDishes.some(e=>e.menu_id===this.currentMenu.id&&e.dish_id===t&&e.is_active):!1}compareMenus(t,e){return t&&e?t.id===e.id:t===e}closeMoveDialog(){this.showMoveDialog=!1,this.dishToMove=null,this.selectedTargetMenuId=null,this.isMoving=!1}moveDishToMenu(){return m(this,null,function*(){if(console.log("\u{1F680} moveDishToMenu chiamato - isCopyMode:",this.isCopyMode),!this.dishToMove||!this.selectedTargetMenuId){console.error("\u274C Dati mancanti");return}let t=this.menus.find(e=>e.id===this.selectedTargetMenuId);if(!t){alert("Menu di destinazione non trovato!");return}this.isMoving=!0;try{if(this.isCopyMode){console.log("\u{1F4CB} MODALIT\xC0 COPIA: clono il piatto");let e=yield this.dishService.cloneDish(this.dishToMove.id,t.name);if(!e)throw new Error("Errore nella clonazione del piatto");if(console.log("\u2705 Piatto clonato:",e.id,e.name),this.menuDishes.some(l=>l&&l.menu_id===this.selectedTargetMenuId&&l.dish_id===e.id&&l.is_active)){alert(`Il piatto clonato \xE8 gi\xE0 nel menu "${t.name}"`),this.closeMoveDialog();return}let a=yield this.menuService.addDishToMenu(this.selectedTargetMenuId,e.id,e.category_id||"",0);if(a){console.log("\u2705 Piatto clonato aggiunto al menu"),this.menuDishes=[...this.menuDishes,a],yield this.menuService.loadMenuDishes(this.selectedTargetMenuId),yield this.dishService.loadData(),this.applyFilters(),alert(`\u2705 Piatto "${this.dishToMove.name}" COPIATO (come "${e.name}") e aggiunto al menu "${t.name}"`),this.closeMoveDialog();return}else throw new Error("Errore nell'aggiunta del piatto clonato al menu")}else{if(console.log("\u{1F504} MODALIT\xC0 SPOSTA: sposto il piatto esistente"),this.menuDishes.some(a=>a&&a.menu_id===this.selectedTargetMenuId&&a.dish_id===this.dishToMove.id&&a.is_active)){alert(`Il piatto "${this.dishToMove.name}" \xE8 gi\xE0 nel menu "${t.name}"`),this.closeMoveDialog();return}let i=this.menuDishes.find(a=>a&&a.dish_id===this.dishToMove.id&&a.is_active);if(i)if(console.log("\u{1F4CB} Record trovato per lo spostamento:",i.id),yield this.menuService.updateMenuDish(i.id,{menu_id:this.selectedTargetMenuId})){console.log("\u2705 Record aggiornato con nuovo menu_id"),this.menuDishes=this.menuDishes.map(l=>l&&l.id===i.id?z(O({},l),{menu_id:this.selectedTargetMenuId}):l),i.menu_id&&(yield this.menuService.loadMenuDishes(i.menu_id)),yield this.menuService.loadMenuDishes(this.selectedTargetMenuId),this.applyFilters(),alert(`\u2705 Piatto "${this.dishToMove.name}" SPOSTATO al menu "${t.name}"`),this.closeMoveDialog();return}else throw new Error("Errore nell'aggiornamento del record");else{console.log("\u2795 Il piatto non \xE8 in nessun menu, lo aggiungo al menu di destinazione");let a=yield this.menuService.addDishToMenu(this.selectedTargetMenuId,this.dishToMove.id,this.dishToMove.category_id||"",0);if(a){console.log("\u2705 Piatto aggiunto al menu di destinazione"),this.menuDishes=[...this.menuDishes,a],yield this.menuService.loadMenuDishes(this.selectedTargetMenuId),this.applyFilters(),alert(`\u2705 Piatto "${this.dishToMove.name}" AGGIUNTO al menu "${t.name}"`),this.closeMoveDialog();return}else throw new Error("Errore nell'aggiunta del piatto al menu")}}}catch(e){console.error("\u274C Errore:",e);let i=this.isCopyMode?"copia":"spostamento";alert(`\u274C Errore durante la ${i} del piatto: ${e.message||"Errore sconosciuto"}`)}finally{this.isMoving=!1}})}getAvailableMenusForMove(){if(this.dishToMove&&!this.isCopyMode){let t=this.getMenuForDish(this.dishToMove.id);if(t)return this.menus.filter(e=>e.id!==t.id)}return this.menus}showDishesWithoutMenu(){this.setViewMode("without-menu")}setViewMode(t){this.viewMode=t,this.applyFilters(),t==="without-menu"&&setTimeout(()=>{let e=document.querySelector(".piatti-senza-menu");e&&e.scrollIntoView({behavior:"smooth"})},100)}startEditMenuName(){this.currentMenu&&(this.editedMenuName=this.currentMenu.name,this.isEditingMenuName=!0)}saveMenuName(){return m(this,null,function*(){this.currentMenu&&this.editedMenuName.trim()&&((yield this.menuService.updateMenu(this.currentMenu.id,{name:this.editedMenuName}))?(this.isEditingMenuName=!1,yield this.menuService.loadData(),this.changeMenu(this.currentMenu.id)):alert("Errore durante il salvataggio del nome menu."))})}cancelEditMenuName(){this.isEditingMenuName=!1,this.editedMenuName=""}showCopyMenuDialog(t){console.log("\u{1F535} MODAL COPIA attivato per:",t.name),this.dishToMove=t,this.selectedTargetMenuId=null,this.showMoveDialog=!0,this.isCopyMode=!0;let e=this.getMenuForDish(t.id);console.log("\u{1F535} Piatto attualmente in menu:",e?.name||"Nessun menu")}showMoveMenuDialog(t){console.log("\u{1F534} MODAL SPOSTA attivato per:",t.name),this.dishToMove=t,this.selectedTargetMenuId=null,this.showMoveDialog=!0,this.isCopyMode=!1;let e=this.getMenuForDish(t.id);console.log("\u{1F534} DEBUG showMoveMenuDialog:",{dishId:t.id,dishName:t.name,currentMenu:e?.name||"Nessun menu",currentMenuId:e?.id,totalMenus:this.menus.length,menuNames:this.menus.map(a=>a.name)});let i=this.getAvailableMenusForMove();console.log("\u{1F534} Menu disponibili per spostamento:",i.map(a=>a.name)),i.length===0&&(console.warn("\u26A0\uFE0F Nessun menu disponibile per lo spostamento!"),setTimeout(()=>{alert("Non ci sono altri menu disponibili per lo spostamento."),this.closeMoveDialog()},100))}toggleMenuType(){return m(this,null,function*(){if(!this.currentMenu||this.currentMenu.is_default)return;let t=this.currentMenu.type==="global"?"dedicated":"global";try{if(yield this.menuService.updateMenu(this.currentMenu.id,{type:t})){let i=z(O({},this.currentMenu),{type:t});this.currentMenu=i;let a=this.menus.findIndex(l=>l.id===this.currentMenu.id);a!==-1&&(this.menus[a]=i),this.isSpecificMenu=t==="dedicated",yield this.menuService.loadData(),console.log(`\u2705 Menu "${this.currentMenu.name}" impostato come ${t}`)}else alert("Errore durante l'aggiornamento del tipo menu")}catch(e){console.error("Errore nel toggle menu type:",e)}})}syncCheckboxState(){this.currentMenu?this.isSpecificMenu=this.currentMenu.type==="dedicated":this.isSpecificMenu=!1}toggleShowDeletedDishes(){return m(this,null,function*(){if(this.showDeletedDishes=!this.showDeletedDishes,this.showDeletedDishes){let t=yield this.dishService.getAllDishesIncludingDeleted();this.dishes=t}else yield this.dishService.loadData();this.applyFilters(),this.calculateStats()})}isDishWithoutMenu(t){return!t||this.dishes.find(i=>i.id===t)?.deleted_at&&!this.showDeletedDishes?!1:!this.existsDishInAnyMenu(t)}getDeletedDishesCount(){return this.dishes.filter(t=>t.deleted_at).length}getDishesWithoutMenuRespectingDeleted(){let t=this.menuDishes.filter(i=>i.is_active===!0).map(i=>i.dish_id),e=[...new Set(t)];return console.log("\u{1F50D} Piatti con menu:",e.length),console.log("\u{1F50D} Piatti totali:",this.dishes.length),this.dishes.filter(i=>{let a=e.includes(i.id),l=this.showDeletedDishes?!0:!i.deleted_at;return!a&&l})}confirmRestoreDish(t){return m(this,null,function*(){let e=`Sei sicuro di voler ripristinare il piatto "${t.name}"?

Il piatto torner\xE0 disponibile nel sistema.`;confirm(e)&&(yield this.restoreDish(t.id))})}restoreDish(t){return m(this,null,function*(){try{if(yield this.dishService.restoreDish(t)){console.log("\u2705 Piatto ripristinato con successo");let i=this.dishes.findIndex(l=>l.id===t);i!==-1&&(this.dishes[i].deleted_at=null,this.dishes[i].status="available"),!this.dishes.some(l=>l.deleted_at)&&this.showDeletedDishes?(this.showDeletedDishes=!1,yield this.dishService.loadData()):this.applyFilters(),this.calculateStats(),alert("\u2705 Piatto ripristinato con successo!")}else alert("\u274C Errore durante il ripristino del piatto")}catch(e){console.error("\u274C Errore durante il ripristino:",e),alert("Errore durante il ripristino del piatto")}})}hasDeletedDishes(){return this.dishes.some(t=>t.deleted_at)}refreshAllData(){return m(this,null,function*(){try{console.log("\u{1F504} Ricarica completa dei dati..."),yield Promise.all([this.dishService.loadData(),this.categoryService.loadData(),this.menuService.loadData(),this.menuDishService.loadData()]),this.currentMenu&&(yield this.menuDishService.loadDishesForMenu(this.currentMenu.id)),this.applyFilters(),this.calculateStats(),console.log("\u2705 Dati ricaricati con successo")}catch(t){console.error("\u274C Errore durante il refresh dei dati:",t)}})}onDeleteMenu(t){return m(this,null,function*(){if(!t)return;if(t.is_default){alert("\u274C Non puoi eliminare il menu di default. Imposta prima un altro menu come default.");return}let i=confirm(`Sei sicuro di voler eliminare il menu "${t.name}"?

Clicca:
\u2022 "OK" per eliminare anche tutti i piatti del menu
\u2022 "Annulla" per eliminare solo il menu (i piatti rimarranno nel sistema ma senza menu)`);try{if(i){if(!confirm(`ATTENZIONE: Stai per eliminare il menu "${t.name}" e TUTTI i suoi piatti.
Questa azione non pu\xF2 essere annullata.

Sei assolutamente sicuro?`))return;let I=this.menuDishes.filter(A=>A.menu_id===t.id);for(let A of I)yield this.dishService.deleteDish(A.dish_id)}let a=this.menuDishes.filter(g=>g.menu_id===t.id);for(let g of a)yield this.menuDishService.delete(g.id);if(yield this.menuService.delete(t.id)){if(yield this.loadData(),this.menus.length>0){let g=this.menus.find(I=>I.is_default)||this.menus[0];this.changeMenu(g.id)}else this.currentMenu=null,this.selectedMenuId=null;alert(`\u2705 Menu "${t.name}" eliminato con successo!`)}else alert("\u274C Errore durante l'eliminazione del menu")}catch(a){console.error("\u274C Errore durante l'eliminazione del menu:",a),alert("Errore durante l'eliminazione del menu")}})}getMenuForDish(t){if(!t||!this.menuDishes||!this.menus)return null;let e=this.menuDishes.find(i=>i.dish_id===t&&i.is_active);return e&&this.menus.find(i=>i.id===e.menu_id)||null}existsDishInAnyMenu(t){return!t||!this.menuDishes||this.menuDishes.length===0?!1:this.menuDishes.some(e=>e.dish_id===t&&e.is_active===!0)}isSortingByNonCategoryField(){return["name","price","food_cost_percentage","margin"].includes(this.sortField)}toggleMenuFavorite(){return m(this,null,function*(){if(!(!this.currentMenu||this.currentMenu.is_default))try{let t=!this.currentMenu.is_favorite;if(yield this.menuService.updateMenu(this.currentMenu.id,{is_favorite:t})){this.currentMenu.is_favorite=t;let i=this.menus.findIndex(a=>a.id===this.currentMenu.id);i!==-1&&(this.menus[i].is_favorite=t),console.log(`\u2705 Menu "${this.currentMenu.name}" ${t?"aggiunto ai":"rimosso dai"} preferiti`)}else alert("\u274C Errore durante l'aggiornamento del menu")}catch(t){console.error("\u274C Errore toggleMenuFavorite:",t),alert("Errore durante l'aggiornamento del menu")}})}toggleMenuActive(){return m(this,null,function*(){if(!this.currentMenu||this.currentMenu.is_default){alert("\u26A0\uFE0F Il menu di default non pu\xF2 essere disattivato");return}try{let t=!this.currentMenu.is_active,e=t?`Attivare il menu "${this.currentMenu.name}"?`:`Disattivare il menu "${this.currentMenu.name}"?

I piatti rimarranno nel sistema ma non saranno visibili nei selettori.`;if(!confirm(e))return;let i;if(t||(i=this.menus.find(l=>l.is_active&&l.id!==this.currentMenu.id&&!l.is_default),i||(i=this.menus.find(l=>l.is_default)),!i&&this.menus.length>0&&(i=this.menus[0])),yield this.menuService.updateMenu(this.currentMenu.id,{is_active:t})){this.currentMenu.is_active=t;let l=this.menus.findIndex(g=>g.id===this.currentMenu.id);l!==-1&&(this.menus[l].is_active=t),!t&&i&&(this.selectedMenuId=i.id,this.currentMenu=i,this.syncCheckboxState(),this.applyFilters(),setTimeout(()=>{this.selectedMenuId=i.id},0)),!t&&!i&&(alert("\u26A0\uFE0F Attenzione: questo era l'ultimo menu attivo!"),this.selectedMenuId=null,this.currentMenu=null,this.isSpecificMenu=!1,this.applyFilters()),console.log(`\u2705 Menu "${this.currentMenu?.name}" ${t?"attivato":"disattivato"}`)}else alert("\u274C Errore durante l'aggiornamento del menu")}catch(t){console.error("\u274C Errore toggleMenuActive:",t),alert("Errore durante l'aggiornamento del menu")}})}toggleMenuDefault(){return m(this,null,function*(){if(!(!this.currentMenu||this.currentMenu.is_default))try{let t=`Impostare il menu "${this.currentMenu.name}" come menu di default?

Attenzione: Questo menu diventer\xE0 il menu principale del ristorante.
Il menu default corrente verr\xE0 automaticamente impostato come non default.`;if(!confirm(t))return;if(yield this.menuService.setAsDefault(this.currentMenu.id)){let i=this.menus.find(l=>l.is_default&&l.id!==this.currentMenu.id);i&&(i.is_default=!1),this.currentMenu.is_default=!0;let a=this.menus.findIndex(l=>l.id===this.currentMenu.id);a!==-1&&(this.menus[a].is_default=!0),this.currentMenu.is_active=!0,this.currentMenu.type="global",this.isSpecificMenu=!1,yield this.menuService.loadData(),console.log(`\u2705 Menu "${this.currentMenu.name}" impostato come default`),alert(`\u2705 Menu "${this.currentMenu.name}" impostato come menu di default!`)}else alert("\u274C Errore durante l'impostazione del menu come default")}catch(t){console.error("\u274C Errore toggleMenuDefault:",t),alert("Errore durante l'impostazione del menu come default")}})}setupDrinkSubscriptions(){this.drinkIngredientService.drinkIngredients$.subscribe(t=>{this.drinkIngredients=t}),this.loadDrinkGroupDetails()}loadDrinkGroupDetails(){return m(this,null,function*(){this.drinkGroupDetails=yield this.drinkGroupService.getDrinkGroupDetails()})}loadDrinkTypes(){return m(this,null,function*(){this.drinkTypes=["Bibite Analcoliche","Acqua","Vini","Birre","Superalcolici","Cocktail","Bevande Calde"]})}openMarkAsDrinkDialog(t){this.ingredientToMarkAsDrink=t,this.selectedDrinkGroup="",this.showMarkAsDrinkDialog=!0}markIngredientAsDrink(){return m(this,null,function*(){if(!this.ingredientToMarkAsDrink||!this.selectedDrinkGroup)return;(yield this.drinkIngredientService.markAsDrink(this.ingredientToMarkAsDrink.id,this.selectedDrinkGroup))?(alert("Ingrediente contrassegnato come bevanda!"),this.closeMarkAsDrinkDialog(),yield this.ingredientService.loadData()):alert("Errore nel contrassegnare come bevanda")})}getDrinkGroupName(t){return this.drinkIngredientService.getGroupNameForIngredient(t)}closeMarkAsDrinkDialog(){this.showMarkAsDrinkDialog=!1,this.ingredientToMarkAsDrink=null,this.selectedDrinkType=""}openAddDrinkDialog(){return m(this,null,function*(){yield this.drinkIngredientService.initialize(),this.selectedDrinkIngredient=null,this.drinkPrice=null,this.showAddDrinkDialog=!0})}navigateToWineList(){this.router.navigate(["/wine-list"])}closeAddDrinkDialog(){this.showAddDrinkDialog=!1,this.selectedDrinkIngredient=null,this.drinkPrice=null}addDrinkFromIngredient(){return m(this,null,function*(){if(!this.selectedDrinkIngredient||!this.drinkPrice||!this.currentMenu){alert("Seleziona una bevanda e inserisci un prezzo");return}try{(yield this.beverageService.createBeverageFromIngredient(this.selectedDrinkIngredient,this.drinkPrice,this.currentMenu.id))&&(alert("Bevanda aggiunta con successo!"),this.closeAddDrinkDialog(),yield this.refreshAllData())}catch(t){console.error("Errore:",t),alert("Errore nell'aggiunta della bevanda")}})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=ae({type:s,selectors:[["app-menu-builder"]],decls:215,vars:53,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"form-card","mb-lg"],[1,"flex","flex-col"],[1,"section-title","m-0"],[1,"form-row","mt-lg"],[1,"form-group"],[1,"standard-label"],[1,"flex","gap-sm","items-center"],[1,"form-select",3,"ngModelChange","change","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["title","Modifica nome menu",1,"icon-button",3,"click","disabled"],[1,"material-icons"],["class","mt-sm",4,"ngIf"],[1,"form-group","m-0"],[1,"w-full",3,"ngModelChange","change","ngModel"],["value","menu-only"],["value","all-dishes"],["value","without-menu"],[1,"form-row","mt-sm"],["class","mt-sm flex items-center gap-sm",4,"ngIf"],["class","text-xs text-muted mt-sm ml-6",4,"ngIf"],["class","text-xs text-warning mt-sm ml-6",4,"ngIf"],[1,"flex","flex-wrap","gap-sm","justify-between"],[1,"flex","items-center","gap-sm"],[1,"material-icons","text-muted","text-sm","ml-xs",3,"title"],["class","chip success ml-md",4,"ngIf"],["class","chip ml-md",4,"ngIf"],["class","form-row mt-sm",4,"ngIf"],["class","flex items-center gap-sm",4,"ngIf"],[1,"flex","flex-wrap","gap-sm",2,"justify-content","flex-end"],[1,"promethea-button",3,"click"],["title","Elimina menu",1,"promethea-button","ghost",3,"click","disabled"],[1,"grid-cards","p-sm02"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","justify-center","flex"],[1,"text-muted","card-footer"],[1,"text-md","font-bold","text-primary","text-amber-500","justify-center","flex"],[1,"form-card","m-sm02"],[1,"flex","justify-between","items-end","gap-md","flex-wrap"],[1,"form-row"],["type","text","placeholder","Cerca per nome o descrizione...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value","all"],["value","available"],["value","unavailable"],["value","out_of_stock"],[2,"display","flex","gap","var(--gap-sm)"],["type","number","placeholder","Min",3,"ngModelChange","input","ngModel"],[2,"align-self","center"],["type","number","placeholder","Max",3,"ngModelChange","input","ngModel"],[1,"modal-footer","p-sm"],[1,"promethea-button","ghost",3,"click"],[1,"material-icons","text-sm"],[1,"table-section"],[1,"bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"crm-table"],[2,"cursor","pointer",3,"click"],["class","material-icons",4,"ngIf"],[2,"width","100px"],[4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"mt-sm"],["type","text","placeholder","Nuovo nome menu","autofocus","",1,"form-input",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],["title","Salva",1,"icon-button","success",3,"click"],["title","Annulla",1,"icon-button",3,"click"],[1,"text-sm","text-muted","mt-sm"],[1,"mt-sm","flex","items-center","gap-sm"],[1,"flex","items-center","gap-sm","cursor-pointer"],["type","checkbox",1,"form-checkbox",3,"change","checked","disabled"],[1,"ml-xs","text-sm"],[1,"text-xs","text-muted","mt-sm","ml-6"],[1,"text-xs","text-warning","mt-sm","ml-6"],[1,"chip","success","ml-md"],[1,"chip","ml-md"],[1,"material-icons","text-yellow-500","text-sm"],[1,"material-icons","text-green-500","text-sm"],[1,"material-icons","text-muted"],["class","chip error ml-md",4,"ngIf"],[1,"chip","error","ml-md"],[1,"material-icons","text-blue-500","text-sm"],[3,"opacity-60","bg-gray-50",4,"ngFor","ngForOf"],["class","flex items-center gap-sm mb-1",4,"ngIf"],[1,"nomedescpiatto"],[1,"link",3,"click"],["class","text-muted","style","font-size: 0.8rem;",4,"ngIf"],[1,"status-select",3,"ngModelChange","ngModel"],["class","text-muted",4,"ngIf"],[1,"flex","gap-sm",2,"justify-content","flex-end"],[1,"flex","items-center","gap-sm","mb-1"],[1,"material-icons","text-red-500","text-sm"],[1,"text-xs","text-red-600","font-medium"],[1,"material-icons","text-amber-500","text-sm"],[1,"text-xs","text-amber-600","font-medium"],[1,"text-muted",2,"font-size","0.8rem"],["title","Copia in altro menu",1,"promethea-button","small","copy-button","ghost",3,"click","disabled"],["title","Sposta in altro menu",1,"promethea-button","small","move-button","success",3,"click","disabled"],["title","Elimina piatto",1,"promethea-button","danger","small",3,"click"],["title","Ripristina piatto",1,"promethea-button","success","small",3,"click"],[4,"ngFor","ngForOf"],["class","category-header",4,"ngIf"],[1,"category-header"],["colspan","8",2,"background","var(--smoke-color-2)","font-weight","800"],[1,"text-md","flex","gap-md",2,"margin","0","border","none"],[1,"text-primary"],[1,"chip"],["colspan","8",2,"background","var(--smoke-1)","font-weight","800"],[1,"section-title",2,"margin","0","border","none"],[1,"chip",2,"margin-left","auto"],["colspan","8",1,"empty-state-row"],[1,"empty-state"],[1,"modal-overlay"],[1,"modal-container","modal-sm"],[1,"modal-header"],[1,"icon-button",3,"click"],[1,"modal-content","p-md"],[1,"form-select",3,"ngModelChange","ngModel"],["value","","disabled",""],["type","number","placeholder","Inserisci prezzo","min","0","step","0.01",1,"form-input",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"promethea-button",3,"click","disabled"],[1,"icon-button",3,"click","disabled"],[1,"info-message","mb-md"],[3,"ngModelChange","ngModel","disabled"],[1,"flex","gap-sm","mt-sm"],[1,"text-muted","text-mini"],[1,"promethea-button","ghost",3,"click","disabled"],["class","material-icons animate-spin",4,"ngIf"],[1,"material-icons","animate-spin"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),o(4,"dashboard"),r(),n(5,"h1",4),o(6,"Men\xF9"),r()(),n(7,"p",5),o(8,"Panoramica completa delle attivit\xE0 del tuo ristorante"),r()(),n(9,"div",6)(10,"div",7)(11,"h2",8),o(12,"Gestione Menu"),r(),n(13,"div",9)(14,"div",10)(15,"label",11),o(16,"Menu"),r(),n(17,"div",12)(18,"select",13),C("ngModelChange",function(l){return w(i.selectedMenuId,l)||(i.selectedMenuId=l),l}),p("change",function(){return i.changeMenu(i.selectedMenuId)}),h(19,we,2,3,"option",14),r(),n(20,"div",2)(21,"button",15),p("click",function(){return i.startEditMenuName()}),n(22,"span",16),o(23,"edit"),r()()()(),h(24,Ce,12,1,"div",17),r(),n(25,"div",18)(26,"label",11),o(27,"Visualizzazione:"),r(),n(28,"select",19),C("ngModelChange",function(l){return w(i.viewMode,l)||(i.viewMode=l),l}),p("change",function(){return i.setViewMode(i.viewMode)}),n(29,"option",20),o(30,"Solo questo menu"),r(),n(31,"option",21),o(32,"Tutti i piatti"),r(),n(33,"option",22),o(34,"Piatti senza menu"),r()()()()(),n(35,"div",23)(36,"div",10),h(37,Ee,5,2,"div",24)(38,Ie,2,0,"div",25)(39,ke,2,0,"div",26),r(),n(40,"div",10)(41,"div",27)(42,"div",5),o(43),r(),n(44,"div",28)(45,"span",29),o(46," info "),r(),h(47,Te,4,0,"span",30)(48,Be,4,0,"span",31),r()()()(),h(49,Pe,15,4,"div",32),n(50,"div",23)(51,"div",10),h(52,Ve,7,3,"div",33),r()(),h(53,Ne,8,2,"div",32),n(54,"div",23)(55,"div",10)(56,"div",34)(57,"button",35),p("click",function(){return i.createNewMenu()}),n(58,"span",16),o(59,"add"),r(),o(60," Nuovo Menu "),r(),n(61,"button",36),p("click",function(){return i.onDeleteMenu(i.currentMenu)}),n(62,"span",16),o(63,"delete"),r(),o(64," Elimina "),r()()()()(),n(65,"div",37)(66,"div",38)(67,"div",39)(68,"span",40),o(69,"restaurant"),r(),n(70,"h3",41),o(71,"Totale Piatti"),r()(),n(72,"div",42),o(73),r(),n(74,"span",43),o(75,"Piatti nel men\xF9"),r()(),n(76,"div",38)(77,"div",39)(78,"span",40),o(79,"category"),r(),n(80,"h3",41),o(81,"Categorie"),r()(),n(82,"div",44),o(83),r(),n(84,"span",43),o(85,"Categorie attive"),r()(),n(86,"div",38)(87,"div",39)(88,"span",40),o(89,"euro"),r(),n(90,"h3",41),o(91,"Prezzo Medio"),r()(),n(92,"div",44),o(93),x(94,"number"),r(),n(95,"span",43),o(96,"Prezzo medio piatto"),r()(),n(97,"div",38)(98,"div",39)(99,"span",40),o(100,"trending_up"),r(),n(101,"h3",41),o(102,"Margine Medio"),r()(),n(103,"div",42),o(104),x(105,"number"),r(),n(106,"span",43),o(107,"Margine medio"),r()(),n(108,"div",38)(109,"div",39)(110,"span",40),o(111,"account_balance"),r(),n(112,"h3",41),o(113,"Food Cost Medio"),r()(),n(114,"div",42),o(115),x(116,"number"),r(),n(117,"span",43),o(118,"Food cost medio (in %)"),r()()(),n(119,"div",45)(120,"div",46)(121,"div",47)(122,"div",10)(123,"label",11)(124,"span",16),o(125,"search"),r(),o(126," Cerca "),r(),n(127,"input",48),C("ngModelChange",function(l){return w(i.searchTerm,l)||(i.searchTerm=l),l}),p("input",function(){return i.applyFilters()}),r()(),n(128,"div",10)(129,"label",11)(130,"span",16),o(131,"category"),r(),o(132," Categoria "),r(),n(133,"select",49),C("ngModelChange",function(l){return w(i.selectedCategory,l)||(i.selectedCategory=l),l}),p("change",function(){return i.applyFilters()}),n(134,"option",50),o(135,"Tutte le categorie"),r(),h(136,Oe,2,2,"option",14),r()()(),n(137,"div",47)(138,"div",10)(139,"label",11)(140,"span",16),o(141,"visibility"),r(),o(142," Stato "),r(),n(143,"select",49),C("ngModelChange",function(l){return w(i.statusFilter,l)||(i.statusFilter=l),l}),p("change",function(){return i.applyFilters()}),n(144,"option",50),o(145,"Tutti gli stati"),r(),n(146,"option",51),o(147,"Disponibile"),r(),n(148,"option",52),o(149,"Non disponibile"),r(),n(150,"option",53),o(151,"Esaurito"),r()()(),n(152,"div",10)(153,"label",11)(154,"span",16),o(155,"euro"),r(),o(156," Prezzo "),r(),n(157,"div",54)(158,"input",55),C("ngModelChange",function(l){return w(i.priceRange.min,l)||(i.priceRange.min=l),l}),p("input",function(){return i.applyFilters()}),r(),n(159,"span",56),o(160,"-"),r(),n(161,"input",57),C("ngModelChange",function(l){return w(i.priceRange.max,l)||(i.priceRange.max=l),l}),p("input",function(){return i.applyFilters()}),r()()()()()(),n(162,"div",58)(163,"button",35),p("click",function(){return i.createNewDish()}),n(164,"span",16),o(165,"add"),r(),o(166," Nuovo Piatto "),r(),n(167,"button",59),p("click",function(){return i.resetFilters()}),n(168,"span",16),o(169,"refresh"),r(),o(170," Reset Filtri "),r(),n(171,"button",59),p("click",function(){return i.toggleShowDeletedDishes()}),n(172,"span",60),o(173),r(),o(174),r(),n(175,"button",35),p("click",function(){return i.openAddDrinkDialog()}),n(176,"span",16),o(177,"local_drink"),r(),o(178," Aggiungi Bevanda "),r(),n(179,"button",35),p("click",function(){return i.navigateToWineList()}),n(180,"span",16),o(181,"wine_bar"),r(),o(182," Carta Vini "),r()(),n(183,"div",61)(184,"div",62)(185,"table",63)(186,"thead")(187,"tr")(188,"th",64),p("click",function(){return i.onSort("name")}),o(189," Nome "),h(190,ze,2,1,"span",65),r(),n(191,"th",64),p("click",function(){return i.onSort("category")}),o(192," Categoria "),h(193,$e,2,1,"span",65),r(),n(194,"th",64),p("click",function(){return i.onSort("price")}),o(195," Prezzo "),h(196,Ge,2,1,"span",65),r(),n(197,"th",64),p("click",function(){return i.onSort("food_cost_percentage")}),o(198," FC % "),h(199,je,2,1,"span",65),r(),n(200,"th",64),p("click",function(){return i.onSort("margin")}),o(201," Margine (\u20AC) "),h(202,We,2,1,"span",65),r(),n(203,"th"),o(204,"Stato"),r(),n(205,"th"),o(206,"Tempo Prep."),r(),n(207,"th",66),o(208,"Azioni"),r()()(),n(209,"tbody"),h(210,He,2,1,"ng-container",67)(211,_t,4,3,"ng-container",67)(212,ht,9,0,"tr",67),r()()()(),h(213,vt,34,4,"div",68)(214,St,42,14,"div",68),r()),e&2&&(c(18),D("ngModel",i.selectedMenuId),d("disabled",i.menus.length===0||i.isEditingMenuName),c(),d("ngForOf",i.menus),c(2),d("disabled",!i.currentMenu||i.isEditingMenuName),c(3),d("ngIf",i.isEditingMenuName&&i.currentMenu),c(4),D("ngModel",i.viewMode),c(9),d("ngIf",i.currentMenu),c(),d("ngIf",(i.currentMenu==null?null:i.currentMenu.type)==="dedicated"),c(),d("ngIf",(i.currentMenu==null?null:i.currentMenu.is_default)&&(i.currentMenu==null?null:i.currentMenu.type)==="dedicated"),c(4),_(" ",i.getViewModeStats()[i.viewMode]," piatto/i "),c(2),d("title",i.currentMenu!=null&&i.currentMenu.is_default?"Il menu di default non pu\xF2 essere specifico":"Menu dedicato a una specifica prenotazione/evento"),c(2),d("ngIf",(i.currentMenu==null?null:i.currentMenu.type)==="dedicated"),c(),d("ngIf",(i.currentMenu==null?null:i.currentMenu.type)==="global"&&!(i.currentMenu!=null&&i.currentMenu.is_default)),c(),d("ngIf",i.currentMenu),c(3),d("ngIf",i.currentMenu),c(),d("ngIf",i.currentMenu),c(8),d("disabled",!i.currentMenu||i.isEditingMenuName),c(12),E(i.stats.totalDishes),c(10),E(i.stats.totalCategories),c(10),_("\u20AC",y(94,44,i.stats.averagePrice,"1.2-2")),c(11),_(" \u20AC",y(105,47,i.stats.averageMargin,"1.2-2")," "),c(11),_(" ",y(116,50,i.stats.averageFoodCostPercentage,"1.0-1"),"% "),c(12),D("ngModel",i.searchTerm),c(6),D("ngModel",i.selectedCategory),c(3),d("ngForOf",i.categories),c(7),D("ngModel",i.statusFilter),c(15),D("ngModel",i.priceRange.min),c(3),D("ngModel",i.priceRange.max),c(10),P("bg-red-100",i.showDeletedDishes)("text-red-700",i.showDeletedDishes),c(2),_(" ",i.showDeletedDishes?"visibility_off":"delete"," "),c(),_(" ",i.showDeletedDishes?"Nascondi Eliminati":"Mostra Eliminati"," "),c(16),d("ngIf",i.sortField==="name"),c(3),d("ngIf",i.sortField==="category"),c(3),d("ngIf",i.sortField==="price"),c(3),d("ngIf",i.sortField==="food_cost_percentage"),c(3),d("ngIf",i.sortField==="margin"),c(8),d("ngIf",i.isSortingByNonCategoryField()),c(),d("ngIf",!i.isSortingByNonCategoryField()),c(),d("ngIf",i.filteredDishes.length===0),c(),d("ngIf",i.showAddDrinkDialog),c(),d("ngIf",i.showMoveDialog))},dependencies:[me,se,le,Se,Me,xe,ge,fe,ve,_e,ye,he,ue,de,ce],styles:[".category-header[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.category-header[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gap-md)!important}.crm-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(.category-header):hover{background:var(--smoke-1)}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.nomedescpiatto[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:calc(var(--gap-sm) / 2)}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.crm-table[_ngcontent-%COMP%]{min-width:800px}}.status-select.available[_ngcontent-%COMP%]{border-color:var(--success-color, #28a745)}.status-select.unavailable[_ngcontent-%COMP%]{border-color:var(--warning-color, #ffc107)}.status-select.out_of_stock[_ngcontent-%COMP%]{border-color:var(--danger-color, #dc3545)}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}.chip.active[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.chip.inactive[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}.text-warning[_ngcontent-%COMP%]{color:#f59e0b!important}.pianti-senza-menu-section[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(245,158,11,.1),transparent);border-left:4px solid #f59e0b}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}to{transform:scale(1)}}.move-button[_ngcontent-%COMP%]:hover{animation:_ngcontent-%COMP%_pulse .5s ease-in-out}tr.opacity-60[_ngcontent-%COMP%]{opacity:.8}tr.bg-gray-50[_ngcontent-%COMP%]{background-color:var(--smoke-1);border:1px solid var(--shadow-1)}tr.no-category-divider[_ngcontent-%COMP%]{border-top:1px solid #e5e7eb}tr.no-category-divider[_ngcontent-%COMP%]:first-child{border-top:none}.category-header[_ngcontent-%COMP%]:not(.category-header){display:none}"]})};export{be as MenuBuilder};
