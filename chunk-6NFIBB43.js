import{a as Ae}from"./chunk-ULTHMXLT.js";import{a as j}from"./chunk-AN6WNCZG.js";import"./chunk-D2EHDSLL.js";import"./chunk-Z3UXT6XE.js";import{db as Re,eb as We}from"./chunk-4Q6XQXJD.js";import{a as xe,b as Te,d as Pe,e as we,g as Me,h as Ee,i as Fe,j as ye,l as Ce,q as Ve,r as De,s as Ie,t as ke,u as Ne,x as ze}from"./chunk-D6L6OQLW.js";import{b as X,d as Se}from"./chunk-M5ABBUWH.js";import"./chunk-TSK5DXKO.js";import{j as ve,k as be,n as fe,u as _e}from"./chunk-WSJCHGNS.js";import{Bb as m,Fb as ie,Gb as ne,Ha as c,Hb as ae,Jb as q,Kb as H,Mb as he,Nb as l,Ob as O,Pb as E,Qb as B,Ra as ce,Rb as oe,Sb as ue,Tb as I,Ub as k,Vb as N,Xa as de,Z as A,_b as ge,a as se,ab as w,ca as y,hb as me,ia as h,ic as T,ja as u,jc as pe,nb as g,ob as a,pa as V,pb as r,qb as D,wb as M,zb as v}from"./chunk-QIXMMTC2.js";import{a as b,b as f,c as le,j as S}from"./chunk-4ZZIO3ZI.js";var Z=class s{supabaseService=y(X);mergeTables(t,e,i,n){return S(this,null,function*(){try{let o=t.map(P=>P.id),d={restaurant_id:n,floor_plan_id:i,table_name:e.table_name,table_number:e.table_number,capacity:e.capacity,shape:"rectangle",position_x:e.position_x,position_y:e.position_y,width:e.width,height:e.height,rotation:0,is_active:!0,is_online_bookable:!0,is_merged:!1,parent_table_id:null,merged_tables_ids:o},{data:p,error:_}=yield this.supabaseService.getSupabaseClient().from("tables").insert(d).select().single();if(_)throw _;for(let P of t){let x={is_online_bookable:!1,is_merged:!0,parent_table_id:p.id},{error:z}=yield this.supabaseService.getSupabaseClient().from("tables").update(x).eq("id",P.id);if(z)throw z}return p}catch(o){return console.error("\u274C Error merging tables:",o),null}})}splitMergedTable(t){return S(this,null,function*(){try{console.log("\u{1F50D} Cerco tavoli figli per:",t.id);let{data:e,error:i}=yield this.supabaseService.getSupabaseClient().from("tables").select("*").eq("parent_table_id",t.id);if(i)throw console.error("\u274C Errore nel fetch dei tavoli figli:",i),i;console.log("\u{1F4CB} Tavoli figli trovati:",e?.length);for(let o of e||[]){let d={is_online_bookable:!0,is_merged:!1,parent_table_id:null};console.log("\u{1F504} Ripristino tavolo:",o.table_number);let{error:p}=yield this.supabaseService.getSupabaseClient().from("tables").update(d).eq("id",o.id);if(p)throw console.error("\u274C Errore nell'aggiornamento del tavolo:",p),p}console.log("\u{1F5D1}\uFE0F Elimino tavolo unito principale:",t.id);let{error:n}=yield this.supabaseService.getSupabaseClient().from("tables").delete().eq("id",t.id);if(n)throw console.error("\u274C Errore nell'eliminazione del tavolo unito:",n),n;return console.log("\u2705 Separazione completata con successo"),!0}catch(e){return console.error("\u274C Error splitting merged table:",e),!1}})}getMergedTableChildren(t){return S(this,null,function*(){try{let{data:e,error:i}=yield this.supabaseService.getSupabaseClient().from("tables").select("*").eq("parent_table_id",t);if(i)throw i;return e||[]}catch(e){return console.error("\u274C Error fetching merged table children:",e),[]}})}static \u0275fac=function(e){return new(e||s)};static \u0275prov=A({token:s,factory:s.\u0275fac,providedIn:"root"})};var L=class s{isEditMode=T(()=>this.state().isEditMode);currentVersion=T(()=>this.state().currentVersion);activeVersion=T(()=>this.state().activeVersion);state=V({floorPlans:[],currentFloorPlan:null,tables:[],selectedTable:null,selectedTables:[],isDrawing:!1,isMergeMode:!1,isEditMode:!1,currentVersion:1,activeVersion:1,showTableModal:!1,showEditTableModal:!1,showMergeModal:!1,showDimensionsModal:!1,tableForm:this.getDefaultTableForm()});floorPlans=T(()=>this.state().floorPlans);currentFloorPlan=T(()=>this.state().currentFloorPlan);tables=T(()=>this.state().tables);selectedTable=T(()=>this.state().selectedTable);selectedTables=T(()=>this.state().selectedTables);isDrawing=T(()=>this.state().isDrawing);isMergeMode=T(()=>this.state().isMergeMode);showTableModal=T(()=>this.state().showTableModal);showEditTableModal=T(()=>this.state().showEditTableModal);showMergeModal=T(()=>this.state().showMergeModal);showDimensionsModal=T(()=>this.state().showDimensionsModal);tableForm=T(()=>this.state().tableForm);setFloorPlans(t){this.state.update(e=>f(b({},e),{floorPlans:t}))}setCurrentFloorPlan(t){this.state.update(e=>f(b({},e),{currentFloorPlan:t}))}setTables(t){console.log("\u{1F535} setTables chiamato con",t.length,"tavoli"),this.state.update(e=>f(b({},e),{tables:t}))}setSelectedTable(t){this.state.update(e=>f(b({},e),{selectedTable:t}))}setSelectedTables(t){this.state.update(e=>f(b({},e),{selectedTables:t}))}setIsDrawing(t){this.state.update(e=>f(b({},e),{isDrawing:t}))}setIsMergeMode(t){this.state.update(e=>f(b({},e),{isMergeMode:t}))}setShowTableModal(t){this.state.update(e=>f(b({},e),{showTableModal:t}))}setShowEditTableModal(t){this.state.update(e=>f(b({},e),{showEditTableModal:t}))}setShowMergeModal(t){this.state.update(e=>f(b({},e),{showMergeModal:t}))}setShowDimensionsModal(t){this.state.update(e=>f(b({},e),{showDimensionsModal:t}))}updateTableForm(t){this.state.update(e=>f(b({},e),{tableForm:b(b({},e.tableForm),t)}))}resetTableForm(){this.state.update(t=>f(b({},t),{tableForm:this.getDefaultTableForm()}))}addToSelectedTables(t){this.state.update(e=>f(b({},e),{selectedTables:[...e.selectedTables,t]}))}removeFromSelectedTables(t){this.state.update(e=>f(b({},e),{selectedTables:e.selectedTables.filter(i=>i.id!==t)}))}clearSelectedTables(){this.state.update(t=>f(b({},t),{selectedTables:[]}))}initializeTableFormForShape(t){let e=this.state().tableForm;switch(t){case"circle":e.borderRadius=50,e.gridHeight=e.gridWidth,e.height=e.width;break;case"square":e.borderRadius=12,e.gridHeight=e.gridWidth,e.height=e.width;break;case"rectangle":e.borderRadius=8;break}e.shape=t,this.state.update(i=>f(b({},i),{tableForm:b({},e)}))}updateAutoTableNumber(t){this.state.update(e=>f(b({},e),{tableForm:f(b({},e.tableForm),{tableNumber:t.toString()})}))}resetState(){this.state.set({floorPlans:[],currentFloorPlan:null,tables:[],selectedTable:null,selectedTables:[],isDrawing:!1,isMergeMode:!1,showTableModal:!1,showEditTableModal:!1,showMergeModal:!1,showDimensionsModal:!1,tableForm:this.getDefaultTableForm(),isEditMode:!1,currentVersion:1,activeVersion:1})}getDefaultTableForm(){return{shape:"rectangle",gridWidth:6,gridHeight:4,width:120,height:80,capacity:2,borderRadius:8,tableName:"",tableNumber:"",isOnlineBookable:!0,isMerged:!1}}resetForNewFloorPlan(){this.state.update(t=>f(b({},t),{tables:[],selectedTable:null,selectedTables:[],isDrawing:!1,isMergeMode:!1,showTableModal:!1,showEditTableModal:!1,showMergeModal:!1,showDimensionsModal:!1}))}setIsEditMode(t){this.state.update(e=>f(b({},e),{isEditMode:t}))}setCurrentVersion(t){this.state.update(e=>f(b({},e),{currentVersion:t}))}setActiveVersion(t){this.state.update(e=>f(b({},e),{activeVersion:t}))}static \u0275fac=function(e){return new(e||s)};static \u0275prov=A({token:s,factory:s.\u0275fac,providedIn:"root"})};var U=class s{stateService=y(L);tableService=y(j);dragState=null;rafId=null;startTableDrag(t,e,i,n=1){let o=this.tableService.getTables(),d=o.find(C=>C.id===t);if(!d){console.error("\u274C Tavolo non trovato:",t);return}let p=i.getBoundingClientRect(),_=(e.clientX-p.left)/n,P=(e.clientY-p.top)/n;console.log("\u{1F7E2} START DRAG per tavolo:",d.table_number,"scale:",n);let x=this.getTablesInMergeGroup(d,o),z=new Map(x.map(C=>[C.id,{x:C.position_x,y:C.position_y}])),F=C=>{this.dragState?.isDragging&&(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.handlePointerMove(i,C,o,n)}))},R=()=>this.handlePointerUp();this.dragState={isDragging:!0,startX:_,startY:P,initialPositions:z,moveHandler:F,upHandler:R},document.addEventListener("pointermove",F),document.addEventListener("pointerup",R,{once:!0});let W=e.target;if(W)try{W.setPointerCapture(e.pointerId),W.style.touchAction="none"}catch{console.warn("Pointer capture not supported")}}handlePointerMove(t,e,i,n){if(!this.dragState?.isDragging)return;let o=t.getBoundingClientRect(),d=(e.clientX-o.left)/n,p=(e.clientY-o.top)/n,_=d-this.dragState.startX,P=p-this.dragState.startY,x=this.stateService.currentFloorPlan();if(!x)return;let z=this.stateService.tables().map(F=>{let R=this.dragState.initialPositions.get(F.id);if(!R)return F;let W=R.x+_,C=R.y+P;W=Math.round(W/20)*20,C=Math.round(C/20)*20;let K=x.width-F.width,J=x.height-F.height,G=Math.max(0,Math.min(W,K)),Y=Math.max(0,Math.min(C,J)),ee=f(b({},F),{position_x:G,position_y:Y}),te=Array.from(this.dragState.initialPositions.keys());return this.tableService.checkTableOverlap(ee,te)?F:f(b({},F),{position_x:G,position_y:Y})});this.stateService.setTables(z)}handlePointerUp(){return S(this,null,function*(){if(!this.dragState?.isDragging)return;console.log("\u{1F7E2} HANDLE POINTER UP - Saving final positions");let t=[];for(let[e,i]of this.dragState.initialPositions){let n=this.stateService.tables().find(o=>o.id===e);n&&(n.position_x!==i.x||n.position_y!==i.y)&&(console.log(`\u{1F4BE} Saving table ${n.table_number}: (${i.x}, ${i.y}) \u2192 (${n.position_x}, ${n.position_y})`),t.push(this.tableService.updateTable(e,{position_x:n.position_x,position_y:n.position_y})))}try{yield Promise.all(t),console.log("\u2705 All table positions saved successfully")}catch(e){console.error("\u274C Error saving table positions:",e)}this.cleanupDrag()})}cleanupDrag(){this.dragState?.moveHandler&&document.removeEventListener("pointermove",this.dragState.moveHandler),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.dragState=null}getTablesInMergeGroup(t,e){let i=[t];if(t.merged_tables_ids&&t.merged_tables_ids.length>0&&!t.parent_table_id)t.merged_tables_ids.forEach(n=>{let o=e.find(d=>d.id===n);o&&i.push(o)});else if(t.parent_table_id){let n=e.find(o=>o.id===t.parent_table_id);n&&(i.find(o=>o.id===n.id)||i.push(n),n.merged_tables_ids&&n.merged_tables_ids.forEach(o=>{if(o!==t.id){let d=e.find(p=>p.id===o);d&&!i.find(p=>p.id===d.id)&&i.push(d)}}))}return i}handleCanvasClick(t,e){if(!this.stateService.isDrawing())return null;let i=e.getBoundingClientRect(),n=t.clientX-i.left,o=t.clientY-i.top,d=n,p=o;return d=Math.round(n/20)*20,p=Math.round(o/20)*20,{x:d,y:p}}areTablesAdjacent(t,e,i=0){let n=t.position_x,o=t.position_x+t.width,d=t.position_y,p=t.position_y+t.height,_=e.position_x,P=e.position_x+e.width,x=e.position_y,z=e.position_y+e.height,F=2,R=n-i-F,W=o+i+F,C=d-i-F,K=p+i+F,J=_-F,G=P+F,Y=x-F,ee=z+F,te=R<=G&&W>=J,re=C<=ee&&K>=Y;return te&&re}areSelectedTablesAdjacent(t,e){if(t.length<2)return!0;let i=new Map;t.forEach(d=>{i.set(d.id,[])});for(let d=0;d<t.length;d++)for(let p=d+1;p<t.length;p++)this.areTablesAdjacent(t[d],t[p])&&(i.get(t[d].id).push(t[p].id),i.get(t[p].id).push(t[d].id));let n=new Set,o=[t[0].id];for(;o.length>0;){let d=o.shift();n.has(d)||(n.add(d),(i.get(d)||[]).forEach(_=>{n.has(_)||o.push(_)}))}return n.size===t.length}getAdjacentTablesToSelection(t,e){if(t.length===0)return[];let i=[],n=t.map(o=>o.id);return e.forEach(o=>{if(!(n.includes(o.id)||o.is_merged)){for(let d of t)if(this.areTablesAdjacent(o,d)){i.push(o);break}}}),i}showAdjacencyWarning(t,e){let i=`Il Tavolo ${t.table_number} non \xE8 vicino ai tavoli selezionati. 
  Seleziona solo tavoli che si toccano tra loro.`;alert(i)}findTableAtPosition(t,e,i){for(let o of t){let d=o.position_x,p=o.position_x+o.width,_=o.position_y,P=o.position_y+o.height;if(e>=d-15&&e<=p+15&&i>=_-15&&i<=P+15)return o}return null}findAdjacentGroups(t){let e=[],i=new Set;for(let n of t)if(!i.has(n.id)){let o=this.findConnectedTables(n,t,i);o.length>1&&e.push(o)}return e}findConnectedTables(t,e,i){let n=[],o=[t];for(;o.length>0;){let d=o.shift();if(!i.has(d.id)){i.add(d.id),n.push(d);for(let p of e)!i.has(p.id)&&p.id!==d.id&&this.areTablesAdjacent(d,p,0)&&o.push(p)}}return n}static \u0275fac=function(e){return new(e||s)};static \u0275prov=A({token:s,factory:s.\u0275fac,providedIn:"root"})};var Q=class s{tableService=y(j);rotateTable(t,e){return S(this,null,function*(){try{let i=this.getMainTableForRotation(t);if(!i)return console.error("\u274C Tavolo non valido per la rotazione"),!1;console.log(`\u{1F504} Rotazione tavolo ${i.table_number} di ${e}\xB0`);let n=(i.rotation+e)%360;return(yield this.tableService.rotateTable(i.id,n))?(console.log("\u2705 Tavolo ruotato con successo"),!0):(console.error("\u274C Errore nel salvataggio della rotazione"),!1)}catch(i){return console.error("\u274C Errore nella rotazione:",i),!1}})}rotateToAngle(t,e){let i=t.rotation||0;return(e-i+180)%360-180}getMainTableForRotation(t){return t.parent_table_id&&this.tableService.getTables().find(i=>i.id===t.parent_table_id)||t}static \u0275fac=function(e){return new(e||s)};static \u0275prov=A({token:s,factory:s.\u0275fac,providedIn:"root"})};var Oe=["floorPlanCanvas"],Be=["canvasContainer"],je=(s,t,e)=>({"width.px":s,"height.px":t,"border-radius":e});function Le(s,t){if(s&1&&(a(0,"option",47),l(1),r()),s&2){let e=t.$implicit;g("ngValue",e.id),c(),oe(" ",e.name," (",e.width,"\xD7",e.height,") ")}}function qe(s,t){if(s&1){let e=M();a(0,"div",48)(1,"div",8)(2,"input",49),N("ngModelChange",function(n){h(e);let o=m();return k(o.editedFloorPlanName,n)||(o.editedFloorPlanName=n),u(n)}),v("keyup.enter",function(){h(e);let n=m();return u(n.saveFloorPlanName())})("keyup.escape",function(){h(e);let n=m();return u(n.cancelEditFloorPlanName())}),r(),a(3,"div",12)(4,"button",50),v("click",function(){h(e);let n=m();return u(n.saveFloorPlanName())}),a(5,"span",14),l(6,"check"),r()(),a(7,"button",51),v("click",function(){h(e);let n=m();return u(n.cancelEditFloorPlanName())}),a(8,"span",14),l(9,"close"),r()()()(),a(10,"div",52),l(11," Premi Invio per salvare, Esc per annullare "),r()()}if(s&2){let e=m();c(2),I("ngModel",e.editedFloorPlanName)}}function Ge(s,t){if(s&1&&(a(0,"option",58),l(1),r()),s&2){let e=t.$implicit,i=m(2);g("value",e),c(),B(" Versione ",e," ",e===i.floorPlanStateService.activeVersion()?"(attiva)":""," ")}}function Ye(s,t){if(s&1){let e=M();a(0,"button",59),v("click",function(){h(e);let n=m(2);return u(n.publishVersion(n.floorPlanStateService.currentVersion()))}),D(1,"lucide-angular",60),r()}s&2&&(c(),g("size",20))}function Xe(s,t){if(s&1){let e=M();a(0,"button",61),v("click",function(){h(e);let n=m(2);return u(n.deleteVersion(n.floorPlanStateService.currentVersion()))}),D(1,"lucide-angular",20),r()}s&2&&(c(),g("size",20))}function Ze(s,t){if(s&1){let e=M();a(0,"div",6)(1,"label",7),l(2,"Versione"),r(),a(3,"div",8)(4,"select",53),v("ngModelChange",function(n){h(e);let o=m();return u(o.onVersionChange(n))}),w(5,Ge,2,3,"option",54),r(),a(6,"button",55),v("click",function(){h(e);let n=m();return u(n.createNewVersion())}),D(7,"lucide-angular",16),r(),w(8,Ye,2,1,"button",56)(9,Xe,2,1,"button",57),r()()}if(s&2){let e=m();c(4),g("ngModel",e.floorPlanStateService.currentVersion()),c(),g("ngForOf",e.availableVersions()),c(2),g("size",20),c(),g("ngIf",e.floorPlanStateService.currentVersion()!==e.floorPlanStateService.activeVersion()),c(),g("ngIf",e.availableVersions().length>1&&e.floorPlanStateService.currentVersion()!==e.floorPlanStateService.activeVersion())}}function $e(s,t){if(s&1){let e=M();a(0,"div",12)(1,"button",74),v("click",function(){h(e);let n=m(2);return u(n.rotateToAngle(0))}),a(2,"span",14),l(3,"north"),r()(),a(4,"button",75),v("click",function(){h(e);let n=m(2);return u(n.rotateToAngle(90))}),a(5,"span",14),l(6,"east"),r()(),a(7,"button",76),v("click",function(){h(e);let n=m(2);return u(n.rotateToAngle(180))}),a(8,"span",14),l(9,"south"),r()(),a(10,"button",77),v("click",function(){h(e);let n=m(2);return u(n.rotateToAngle(270))}),a(11,"span",14),l(12,"west"),r()()()}}function Ue(s,t){if(s&1){let e=M();a(0,"div",62)(1,"div",63)(2,"div",12)(3,"span",14),l(4,"rotate_right"),r(),a(5,"div")(6,"label",7),l(7,"Rotazione Tavolo"),r()()(),a(8,"div",8),w(9,$e,13,0,"div",64),a(10,"div",65)(11,"button",66),v("click",function(){h(e);let n=m();return u(n.rotateSelectedTable(-30))}),a(12,"span",14),l(13,"rotate_left"),r()(),a(14,"div",67)(15,"span",68),l(16),r(),a(17,"span",69),l(18,"Rotazione"),r()(),a(19,"button",70),v("click",function(){h(e);let n=m();return u(n.rotateSelectedTable(30))}),a(20,"span",14),l(21,"rotate_right"),r()()(),a(22,"button",71),v("click",function(){h(e);let n=m();return u(n.rotateToAngle(0))}),a(23,"span",14),l(24,"restart_alt"),r()()()(),a(25,"div",72)(26,"span",73),l(27,"info"),r(),l(28," Premi Ctrl + rotellina del mouse per ruotare di \xB15\xB0 "),r()()}if(s&2){let e=m();c(9),g("ngIf",!e.isMobileView()),c(2),g("disabled",e.isRotating),c(5),E("",e.selectedTable().rotation||0,"\xB0"),c(3),g("disabled",e.isRotating),c(3),g("disabled",e.isRotating)}}function Qe(s,t){s&1&&(a(0,"span",85),l(1," Unito "),r())}function Ke(s,t){if(s&1){let e=M();a(0,"button",86),v("click",function(){h(e);let n=m(2);return u(n.onSplitTable(n.selectedTable()))}),a(1,"span",14),l(2,"call_split"),r(),l(3," Separa "),r()}}function Je(s,t){if(s&1){let e=M();a(0,"div",78)(1,"div",79)(2,"div",4)(3,"strong"),l(4,"Tavolo Selezionato"),r(),a(5,"div",12)(6,"span",31),l(7),r(),w(8,Qe,2,0,"span",80),r()(),a(9,"div",81)(10,"button",82),v("click",function(){h(e);let n=m();return u(n.openEditTableModal())}),a(11,"span",14),l(12,"edit"),r(),l(13," Modifica "),r(),w(14,Ke,4,0,"button",83),a(15,"button",84),v("click",function(){h(e);let n=m();return u(n.deselectAll())}),a(16,"span",14),l(17,"close"),r(),l(18," Deseleziona "),r()()()()}if(s&2){let e=m();c(7),B(" Tavolo ",e.selectedTable().table_number," - ",e.selectedTable().capacity," persone "),c(),g("ngIf",e.selectedTable().merged_tables_ids&&e.selectedTable().merged_tables_ids.length>0),c(6),g("ngIf",e.selectedTable().merged_tables_ids&&e.selectedTable().merged_tables_ids.length>0)}}function et(s,t){s&1&&(a(0,"div",31),l(1," Seleziona 2-4 tavoli confinanti da unire "),r())}function tt(s,t){if(s&1&&(a(0,"span",99),l(1),r()),s&2){let e=m(3);c(),E(" (",e.getSelectedTableNumbers(),") ")}}function it(s,t){if(s&1&&(a(0,"div",31),l(1),w(2,tt,2,1,"span",98),r()),s&2){let e=m(2);c(),E(" Tavoli selezionati: ",e.selectedTables().length," "),c(),g("ngIf",e.selectedTables().length>0)}}function nt(s,t){if(s&1&&(a(0,"span"),l(1),r()),s&2){let e=m(2);c(),E("(",e.selectedTables().length,")")}}function at(s,t){if(s&1){let e=M();a(0,"div",100)(1,"div",101)(2,"span",102),l(3,"info"),r(),a(4,"div",103)(5,"p",25),l(6),r()(),a(7,"button",104),v("click",function(){h(e);let n=m(2);return u(n.highlightMessage.set(null))}),a(8,"span",14),l(9,"close"),r()()()()}if(s&2){let e=m(2);c(5),H("text-warning",!0),c(),E(" ",e.highlightMessage()," ")}}function ot(s,t){s&1&&(a(0,"div",105),D(1,"lucide-angular",106),l(2," Seleziona un altro tavolo adiacente per unire "),r())}function rt(s,t){s&1&&(a(0,"div",107)(1,"span",14),l(2,"warning"),r(),l(3," I tavoli selezionati non sono tutti adiacenti tra loro "),r())}function lt(s,t){if(s&1&&(a(0,"div",108)(1,"span",14),l(2,"check_circle"),r(),l(3),r()),s&2){let e=m(2);c(3),E(" Tavoli pronti per l'unione! Capacit\xE0 totale: ",e.getTotalCapacity()," persone ")}}function st(s,t){if(s&1){let e=M();a(0,"div",87)(1,"div",88)(2,"strong"),l(3,"Modalit\xE0 Unione Tavoli"),r(),w(4,et,2,0,"div",89)(5,it,3,2,"div",89),r(),a(6,"div",81)(7,"button",84),v("click",function(){h(e);let n=m();return u(n.highlightAdjacentTables())}),a(8,"span",14),l(9,"highlight"),r(),l(10," Mostra vicini "),r(),a(11,"button",90),v("click",function(){h(e);let n=m();return u(n.openMergeModal())}),a(12,"span",14),l(13,"merge"),r(),l(14," Crea tavolo unito "),w(15,nt,2,1,"span",91),r(),a(16,"button",92),v("click",function(){h(e);let n=m();return u(n.floorPlanStateService.clearSelectedTables())}),a(17,"span",14),l(18,"clear"),r(),l(19," Deseleziona "),r()(),w(20,at,10,3,"div",93),a(21,"div",94),w(22,ot,3,0,"div",95)(23,rt,4,0,"div",96)(24,lt,4,1,"div",97),r()()}if(s&2){let e=m();c(4),g("ngIf",e.selectedTables().length===0),c(),g("ngIf",e.selectedTables().length>0),c(6),H("active",e.canMergeTables()),g("disabled",!e.canMergeTables()),c(4),g("ngIf",e.selectedTables().length>0),c(),g("disabled",e.selectedTables().length===0),c(4),g("ngIf",e.highlightMessage()),c(2),g("ngIf",e.selectedTables().length===1),c(),g("ngIf",e.selectedTables().length>1&&!e.canMergeTables()),c(),g("ngIf",e.canMergeTables())}}function ct(s,t){s&1&&(a(0,"div",109)(1,"span",14),l(2,"touch_app"),r(),l(3," Clicca sulla mappa per posizionare il tavolo "),r())}function dt(s,t){if(s&1&&D(0,"div",116),s&2){let e=m(2);q("background-size",e.visualGridSize()+"px "+e.visualGridSize())}}function mt(s,t){if(s&1){let e=M();a(0,"div",117),v("pointerdown",function(n){let o=h(e).$implicit,d=m(2);return u(d.onTablePointerDown(n,o))}),a(1,"div",118)(2,"div",119),l(3),r(),a(4,"div",120),l(5),r()()()}if(s&2){let e=t.$implicit,i=m(2);he(i.getTableClass(e)),g("ngStyle",i.getTableStyle(e)),me("data-table-id",e.id),c(3),O(e.table_number),c(2),E("",e.capacity," p")}}function ht(s,t){s&1&&(a(0,"div",121)(1,"span",14),l(2,"table_restaurant"),r(),a(3,"h3"),l(4,"Nessun tavolo configurato"),r(),a(5,"p"),l(6,'Clicca su "Aggiungi" per creare il primo tavolo'),r()())}function ut(s,t){if(s&1&&(a(0,"div",110)(1,"div",111,1),D(3,"div",112),w(4,dt,1,2,"div",113)(5,mt,6,6,"div",114)(6,ht,7,0,"div",115),r()()),s&2){let e=m();q("width",e.floorPlanWidth()*e.canvasScale(),"px")("height",e.floorPlanHeight()*e.canvasScale(),"px"),c(),q("width",e.floorPlanWidth(),"px")("height",e.floorPlanHeight(),"px")("transform","scale("+e.canvasScale()+")")("transform-origin","0 0"),c(3),g("ngIf",e.snapToGrid),c(),g("ngForOf",e.tables())("ngForTrackBy",e.trackByTableId),c(),g("ngIf",e.tables().length===0)}}function gt(s,t){if(s&1){let e=M();a(0,"div",122)(1,"span",14),l(2,"map"),r(),a(3,"h3"),l(4,"Nessuna mappa selezionata"),r(),a(5,"p"),l(6,"Crea una nuova mappa o seleziona una esistente"),r(),a(7,"button",123),v("click",function(){h(e);let n=m();return u(n.createNewFloorPlan())}),D(8,"lucide-angular",16),l(9," Crea Nuova Mappa "),r()()}s&2&&(c(8),g("size",20))}function pt(s,t){if(s&1){let e=M();a(0,"div",147),v("click",function(){let n=h(e).$implicit,o=m(2);return u(o.onShapeSelect(n))}),a(1,"div",148)(2,"span",14),l(3),r(),a(4,"strong"),l(5),r()()()}if(s&2){let e=t.$implicit,i=m(2);H("active",i.floorPlanStateService.tableForm().shape===e.type),c(3),O(e.icon),c(2),O(e.name)}}function vt(s,t){if(s&1){let e=M();a(0,"div",6)(1,"label",7),l(2,"Larghezza (quadrati)"),r(),a(3,"input",149),v("ngModelChange",function(n){h(e);let o=m(2);return u(o.onGridWidthChange(n))}),r(),a(4,"span",31),l(5),r()()}if(s&2){let e=m(2);c(3),g("ngModel",e.floorPlanStateService.tableForm().gridWidth)("disabled",e.floorPlanStateService.tableForm().shape==="circle"||e.floorPlanStateService.tableForm().shape==="square"),c(2),E("1 quadrato = ",e.gridSize,"px")}}function bt(s,t){if(s&1){let e=M();a(0,"div",6)(1,"label",7),l(2,"Altezza (quadrati)"),r(),a(3,"input",150),v("ngModelChange",function(n){h(e);let o=m(2);return u(o.onGridHeightChange(n))}),r(),a(4,"span",31),l(5),r()()}if(s&2){let e=m(2);c(3),g("ngModel",e.floorPlanStateService.tableForm().gridHeight)("disabled",e.floorPlanStateService.tableForm().shape==="circle"||e.tableForm().isMerged!==void 0&&e.tableForm().isMerged),c(2),E("1 quadrato = ",e.gridSize,"px")}}function ft(s,t){if(s&1){let e=M();a(0,"div",6)(1,"label",7),l(2,"Larghezza (px)"),r(),a(3,"input",151),v("ngModelChange",function(n){h(e);let o=m(2);return u(o.onWidthChange(n))}),r(),a(4,"span",31),l(5,"Min: 20px, Max: 1000px"),r()()}if(s&2){let e=m(2);c(3),g("ngModel",e.floorPlanStateService.tableForm().width)("disabled",e.floorPlanStateService.tableForm().shape==="circle")}}function _t(s,t){if(s&1){let e=M();a(0,"div",6)(1,"label",7),l(2,"Altezza (px)"),r(),a(3,"input",152),v("ngModelChange",function(n){h(e);let o=m(2);return u(o.onHeightChange(n))}),r(),a(4,"span",31),l(5,"Min: 20px, Max: 1000px"),r()()}if(s&2){let e=m(2);c(3),g("ngModel",e.floorPlanStateService.tableForm().height)("disabled",e.floorPlanStateService.tableForm().shape==="circle"||e.floorPlanStateService.tableForm().shape==="square")}}function St(s,t){if(s&1){let e=M();a(0,"div",6)(1,"label",7),l(2,"Border Radius (px)"),r(),a(3,"input",153),v("ngModelChange",function(n){h(e);let o=m(2);return u(o.onBorderRadiusChange(n))}),r(),a(4,"div",154)(5,"span"),l(6,"0px (spigoli vivi)"),r(),a(7,"span")(8,"strong"),l(9),r()(),a(10,"span"),l(11,"50px (molto arrotondato)"),r()()()}if(s&2){let e=m(2);c(3),g("ngModel",e.floorPlanStateService.tableForm().borderRadius),c(6),E("",e.floorPlanStateService.tableForm().borderRadius,"px")}}function xt(s,t){s&1&&(a(0,"div",6)(1,"div",155),D(2,"lucide-angular",106),a(3,"span"),l(4,"Per i tavoli circolari il border radius \xE8 automaticamente impostato al 50%"),r()()())}function Tt(s,t){if(s&1&&(a(0,"div",156),l(1),r()),s&2){let e=m(2);c(),ue(" DEBUG: width=",e.previewWidth(),", height=",e.previewHeight(),", shape=",e.floorPlanStateService.tableForm().shape,", borderRadius=",e.floorPlanStateService.tableForm().borderRadius," ")}}function Pt(s,t){if(s&1){let e=M();a(0,"button",157),v("click",function(){h(e);let n=m(2);return u(n.onDeleteTable())}),D(1,"lucide-angular",20),l(2," Elimina "),r()}s&2&&(c(),g("size",20))}function wt(s,t){if(s&1){let e=M();a(0,"div",124)(1,"div",125)(2,"div",126)(3,"div",101)(4,"div",127)(5,"span",14),l(6),r()(),a(7,"div")(8,"h1",128),l(9),r()()(),a(10,"button",15),v("click",function(){h(e);let n=m();return u(n.floorPlanStateService.setShowTableModal(!1))}),a(11,"span",14),l(12,"close"),r()()(),a(13,"div",4)(14,"form")(15,"div",3)(16,"div",129)(17,"label",7),l(18,"Forma del Tavolo"),r(),a(19,"div",130),w(20,pt,6,4,"div",131),r()(),a(21,"div",132)(22,"div",6)(23,"label",7),l(24,"Numero Tavolo"),r(),a(25,"input",133),N("ngModelChange",function(n){h(e);let o=m();return k(o.floorPlanStateService.tableForm().tableNumber,n)||(o.floorPlanStateService.tableForm().tableNumber=n),u(n)}),r()(),a(26,"div",6)(27,"label",7),l(28,"Capacit\xE0"),r(),a(29,"input",134),N("ngModelChange",function(n){h(e);let o=m();return k(o.floorPlanStateService.tableForm().capacity,n)||(o.floorPlanStateService.tableForm().capacity=n),u(n)}),r()()(),a(30,"div",132)(31,"div",6)(32,"label",7),l(33,"Nome Tavolo (opzionale)"),r(),a(34,"input",135),N("ngModelChange",function(n){h(e);let o=m();return k(o.floorPlanStateService.tableForm().tableName,n)||(o.floorPlanStateService.tableForm().tableName=n),u(n)}),r()(),a(35,"div",6)(36,"label",136)(37,"input",137),N("ngModelChange",function(n){h(e);let o=m();return k(o.floorPlanStateService.tableForm().isOnlineBookable,n)||(o.floorPlanStateService.tableForm().isOnlineBookable=n),u(n)}),r(),a(38,"div",30)(39,"strong"),l(40,"Prenotabile online"),r(),a(41,"span",31),l(42,"Se deselezionato, prenotabile solo dal personale"),r()()()()(),a(43,"div",132),w(44,vt,6,3,"div",22)(45,bt,6,3,"div",22)(46,ft,6,2,"div",22)(47,_t,6,2,"div",22),r(),a(48,"div",132),w(49,St,12,2,"div",22)(50,xt,5,0,"div",22),r(),a(51,"div",138)(52,"strong"),l(53,"Anteprima"),r(),a(54,"div",139)(55,"div",140)(56,"div",141)(57,"span",119),l(58),r(),a(59,"span",120),l(60),r()()()(),a(61,"div",142),l(62),r(),w(63,Tt,2,4,"div",143),r()(),a(64,"div",81)(65,"button",144),v("click",function(){h(e);let n=m();return u(n.floorPlanStateService.setShowTableModal(!1))}),l(66," Annulla "),r(),a(67,"button",145),v("click",function(){h(e);let n=m();return u(n.onSaveTable())}),a(68,"span",14),l(69),r(),l(70),r(),w(71,Pt,3,1,"button",146),r()()()()()}if(s&2){let e=m();c(6),O(e.modalMode()==="create"?"add_circle":"edit"),c(3),E(" ",e.modalMode()==="create"?"Crea Nuovo Tavolo":"Modifica Tavolo"," "),c(11),g("ngForOf",e.tableShapes),c(5),I("ngModel",e.floorPlanStateService.tableForm().tableNumber),c(4),I("ngModel",e.floorPlanStateService.tableForm().capacity),c(5),I("ngModel",e.floorPlanStateService.tableForm().tableName),c(3),I("ngModel",e.floorPlanStateService.tableForm().isOnlineBookable),c(7),g("ngIf",e.modalMode()==="create"),c(),g("ngIf",e.modalMode()==="create"),c(),g("ngIf",e.modalMode()==="edit"),c(),g("ngIf",e.modalMode()==="edit"),c(2),g("ngIf",e.floorPlanStateService.tableForm().shape!=="circle"),c(),g("ngIf",e.floorPlanStateService.tableForm().shape==="circle"),c(5),H("shape-circle",e.floorPlanStateService.tableForm().shape==="circle"),g("ngStyle",ge(25,je,e.previewWidth(),e.previewHeight(),e.previewBorderRadius())),c(3),O(e.floorPlanStateService.tableForm().tableNumber||"1"),c(2),E("",e.floorPlanStateService.tableForm().capacity," p"),c(2),oe(" ",e.previewWidth()," \xD7 ",e.previewHeight()," px | Border Radius: ",e.floorPlanStateService.tableForm().shape==="circle"?"50% (automatico)":e.floorPlanStateService.tableForm().borderRadius+"px"," "),c(),g("ngIf",!1),c(6),O(e.modalMode()==="create"?"add":"save"),c(),E(" ",e.modalMode()==="create"?"Crea Tavolo":"Aggiorna Tavolo"," "),c(),g("ngIf",e.modalMode()==="edit")}}function Mt(s,t){if(s&1){let e=M();a(0,"div",124)(1,"div",125)(2,"div",126)(3,"div",158)(4,"div",127)(5,"span",159),l(6,"aspect_ratio"),r()(),a(7,"h1",160),l(8,"Dimensioni Sala"),r()(),a(9,"button",15),v("click",function(){h(e);let n=m();return u(n.onCancelDimensionsModal())}),a(10,"span",14),l(11,"close"),r()()(),a(12,"div",161)(13,"form",162)(14,"div",132)(15,"div",6)(16,"label",7),l(17,"Larghezza (px)"),r(),a(18,"input",163),N("ngModelChange",function(n){h(e);let o=m();return k(o.dimensionsForm.width,n)||(o.dimensionsForm.width=n),u(n)}),r(),a(19,"span",31),l(20,"Min: 500px, Max: 5000px"),r()(),a(21,"div",6)(22,"label",7),l(23,"Altezza (px)"),r(),a(24,"input",164),N("ngModelChange",function(n){h(e);let o=m();return k(o.dimensionsForm.height,n)||(o.dimensionsForm.height=n),u(n)}),r(),a(25,"span",31),l(26,"Min: 500px, Max: 5000px"),r()()(),a(27,"div",129)(28,"label",165),l(29,"Dimensioni Predefinite"),r(),a(30,"div",12)(31,"button",166),v("click",function(){h(e);let n=m();return u(n.setDimensions(1e3,800))}),l(32," Piccola (1000\xD7800) "),r(),a(33,"button",166),v("click",function(){h(e);let n=m();return u(n.setDimensions(1500,1200))}),l(34," Media (1500\xD71200) "),r(),a(35,"button",166),v("click",function(){h(e);let n=m();return u(n.setDimensions(2e3,1600))}),l(36," Grande (2000\xD71600) "),r()()(),a(37,"div",138)(38,"strong",167),l(39,"Anteprima Dimensioni"),r(),a(40,"div",168)(41,"div",169)(42,"div",170),l(43),r()()()(),a(44,"div",81)(45,"button",144),v("click",function(){h(e);let n=m();return u(n.onCancelDimensionsModal())}),l(46," Annulla "),r(),a(47,"button",145),v("click",function(){h(e);let n=m();return u(n.onSaveDimensions())}),D(48,"lucide-angular",171),l(49," Salva Dimensioni "),r()()()()()()}if(s&2){let e=m();c(18),I("ngModel",e.dimensionsForm.width),c(6),I("ngModel",e.dimensionsForm.height),c(17),q("width",e.dimensionsForm.width*.1,"px")("height",e.dimensionsForm.height*.1,"px"),c(2),B(" ",e.dimensionsForm.width," \xD7 ",e.dimensionsForm.height," px ")}}function Et(s,t){if(s&1&&(a(0,"div",178)(1,"span",14),l(2,"table_restaurant"),r(),a(3,"div",103)(4,"strong"),l(5),r(),a(6,"div",31),l(7),r()()()),s&2){let e=t.$implicit;c(5),E("Tavolo ",e.table_number),c(2),E("",e.capacity," persone")}}function Ft(s,t){if(s&1){let e=M();a(0,"div",124)(1,"div",125)(2,"div",126)(3,"div",101)(4,"div",127)(5,"span",14),l(6,"merge"),r()(),a(7,"div")(8,"h1",128),l(9,"Unisci Tavoli"),r()()(),a(10,"button",15),v("click",function(){h(e);let n=m();return u(n.closeMergeModal())}),a(11,"span",14),l(12,"close"),r()()(),a(13,"div")(14,"form",162)(15,"div",3)(16,"div",129)(17,"label",7),l(18,"Tavoli da unire"),r(),a(19,"div",172),w(20,Et,8,2,"div",173),r()(),a(21,"div",132)(22,"div",6)(23,"label",7),l(24,"Numero Nuovo Tavolo"),r(),a(25,"input",174),N("ngModelChange",function(n){h(e);let o=m();return k(o.mergeForm.tableNumber,n)||(o.mergeForm.tableNumber=n),u(n)}),r()(),a(26,"div",6)(27,"label",7),l(28,"Capacit\xE0 Totale"),r(),a(29,"input",175),N("ngModelChange",function(n){h(e);let o=m();return k(o.mergeForm.capacity,n)||(o.mergeForm.capacity=n),u(n)}),r()()(),a(30,"div",129)(31,"label",7),l(32,"Nome Tavolo Unito"),r(),a(33,"input",176),N("ngModelChange",function(n){h(e);let o=m();return k(o.mergeForm.tableName,n)||(o.mergeForm.tableName=n),u(n)}),r()(),a(34,"div",177)(35,"div",6)(36,"span"),l(37),r()(),a(38,"div",6)(39,"span"),l(40),r()()()(),a(41,"div",81)(42,"button",144),v("click",function(){h(e);let n=m();return u(n.closeMergeModal())}),l(43," Annulla "),r(),a(44,"button",145),v("click",function(){h(e);let n=m();return u(n.onMergeTables())}),a(45,"span",14),l(46,"merge"),r(),l(47," Crea Tavolo Unito "),r()()()()()()}if(s&2){let e=m();c(20),g("ngForOf",e.selectedTables()),c(5),I("ngModel",e.mergeForm.tableNumber),c(4),I("ngModel",e.mergeForm.capacity),c(4),I("ngModel",e.mergeForm.tableName),c(4),E("Capacit\xE0 originale: ",e.getTotalCapacity()," "),c(3),E("Nuova capacit\xE0: ",e.mergeForm.capacity)}}var He=class s{floorPlanService=y(Ae);tableService=y(j);floorPlanInteractionService=y(U);floorPlanStateService=y(L);tableMergeService=y(Z);authService=y(Se);supabaseService=y(X);tableRotationService=y(Q);renderer=y(ce);canvasRef;containerRef;isDragging=!1;isRotating=!1;resizeObserver;destroyed=!1;subscriptions=new se;highlightMessage=V(null);canvasReady=!1;refreshTrigger=V(0);canvasScale=V(1);containerWidth=V(0);containerHeight=V(0);isMobileView=V(!1);userZoomed=V(!1);floorPlanWidth=T(()=>this.currentFloorPlan()?.width||1e3);floorPlanHeight=T(()=>this.currentFloorPlan()?.height||800);visualWidth=T(()=>this.floorPlanWidth()*this.canvasScale());visualHeight=T(()=>this.floorPlanHeight()*this.canvasScale());floorPlans=this.floorPlanStateService.floorPlans;currentFloorPlan=this.floorPlanStateService.currentFloorPlan;tables=this.floorPlanStateService.tables;selectedTable=this.floorPlanStateService.selectedTable;selectedTables=this.floorPlanStateService.selectedTables;isDrawing=this.floorPlanStateService.isDrawing;isMergeMode=this.floorPlanStateService.isMergeMode;showTableModal=this.floorPlanStateService.showTableModal;showEditTableModal=this.floorPlanStateService.showEditTableModal;showMergeModal=this.floorPlanStateService.showMergeModal;showDimensionsModal=this.floorPlanStateService.showDimensionsModal;tableForm=this.floorPlanStateService.tableForm;currentFloorPlanId=T(()=>this.currentFloorPlan()?.id||null);gridSize=20;snapToGrid=!0;isLargeText=!1;isEditingFloorPlanName=!1;modalMode=V("create");currentTableId=V(null);availableVersions=T(()=>{this.refreshTrigger();let t=this.currentFloorPlan();if(!t)return[];let e=new Set;return this.tableService.getTablesByFloorPlan(t.id).forEach(i=>{i.version&&e.add(i.version)}),Array.from(e).sort((i,n)=>i-n)});modalPosition={x:0,y:0};dimensionsForm={width:1e3,height:800};mergeForm={tableName:"",tableNumber:"",capacity:4};editingFloorPlan=null;editedFloorPlanName="";tableShapes=[];visualGridSize=T(()=>20/this.canvasScale());constructor(){pe(()=>{console.log("\u{1F440} Signal tables cambiato:",this.tables().length);let t=this.currentFloorPlan(),e=this.canvasRef?.nativeElement,i=this.containerRef?.nativeElement;t&&e&&i&&!this.canvasReady&&(console.log("\u{1F58C}\uFE0F Canvas pronto, inizializzo interazioni"),this.canvasReady=!0,this.setupCanvasInteractions(),this.setupResponsiveCanvas(),this.setupPinchToZoom(),this.updateCanvasDimensions())})}ngOnInit(){return S(this,null,function*(){console.log("\u{1F3C1} FloorPlanEditor ngOnInit"),this.tableShapes=this.floorPlanService.getTableShapes(),yield this.loadInitialData(),this.subscriptions.add(this.floorPlanService.data$.subscribe(e=>{if(this.floorPlanStateService.setFloorPlans(e),e.length>0){let i=this.currentFloorPlan();if(!i||!e.find(n=>n.id===i.id)){let n=e[0];this.floorPlanStateService.setCurrentFloorPlan(n),this.floorPlanStateService.setCurrentVersion(n.current_version),this.floorPlanStateService.setActiveVersion(n.current_version),this.loadTablesForFloorPlan()}}else e.length===0&&this.createDefaultFloorPlan()})),this.subscriptions.add(this.tableService.data$.subscribe(()=>{this.isDragging||(this.loadTablesForFloorPlan(),this.refreshTrigger.update(e=>e+1))}));let t=this.generateNextTableNumber();this.floorPlanStateService.updateAutoTableNumber(t)})}loadInitialData(){return S(this,null,function*(){try{yield this.floorPlanService.loadData(),yield this.tableService.loadData()}catch(t){console.error("\u{1F4A5} Error in loadInitialData:",t)}})}ngAfterViewInit(){setTimeout(()=>this.updateCanvasDimensions(),0)}ngOnDestroy(){this.subscriptions.unsubscribe(),this.resizeObserver&&this.resizeObserver.disconnect(),this.destroyed=!0}setupResponsiveCanvas(){let t=this.containerRef?.nativeElement;t&&(this.resizeObserver=new ResizeObserver(e=>{for(let i of e)this.containerWidth.set(i.contentRect.width),this.containerHeight.set(i.contentRect.height),this.isMobileView.set(i.contentRect.width<768),this.updateCanvasDimensions()}),this.resizeObserver.observe(t))}canvasWidth=V(1e3);canvasHeight=V(800);updateCanvasDimensions(){let t=this.containerWidth(),e=this.containerHeight();if(t===0||e===0)return;let i=this.currentFloorPlan();if(i){if(!this.userZoomed()){let n=this.isMobileView()?20:40,o=t-n,d=e-n,p=o/i.width,_=d/i.height,P=Math.min(p,_);P=Math.max(.1,Math.min(P,2)),this.canvasScale.set(P)}this.canvasWidth.set(i.width),this.canvasHeight.set(i.height),console.log("\u{1F4D0} Canvas updated:",{userZoomed:this.userZoomed(),container:`${t}x${e}`,floorPlan:`${i.width}x${i.height}`,scale:this.canvasScale(),visual:`${this.visualWidth()}x${this.visualHeight()}`})}}refreshCanvasSize(){this.updateCanvasDimensions()}zoomIn(){let t=this.canvasScale(),e=Math.min(t*1.2,3);this.canvasScale.set(e),this.userZoomed.set(!0),setTimeout(()=>{this.adjustScrollAfterZoom(t,e)},10)}zoomOut(){let t=this.canvasScale(),e=Math.max(t*.8,.1);this.canvasScale.set(e),this.userZoomed.set(!0),setTimeout(()=>{this.adjustScrollAfterZoom(t,e)},10)}adjustScrollAfterZoom(t,e){let i=this.containerRef?.nativeElement;if(!i)return;let n=i.scrollLeft+i.clientWidth/2,o=i.scrollTop+i.clientHeight/2,d=n*e/t-i.clientWidth/2,p=o*e/t-i.clientHeight/2;i.scrollLeft=Math.max(0,d),i.scrollTop=Math.max(0,p)}resetCanvasZoom(){this.userZoomed.set(!1),this.updateCanvasDimensions()}loadTablesForFloorPlan(){let t=this.currentFloorPlan();if(!t){this.floorPlanStateService.setTables([]);return}let e=this.floorPlanStateService.currentVersion();console.log(`\u{1F4E5} Caricamento tavoli per mappa ${t.name}, versione ${e}`);let i=this.tableService.getVisibleTablesByFloorPlan(t.id,e);console.log("\u{1F4E6} Tavoli ricevuti:",i.map(o=>({id:o.id,version:o.version,type:typeof o.version}))),console.log(`\u{1F4E6} Tavoli caricati: ${i.length}`),this.floorPlanStateService.setTables(i),console.log("\u2705 Dopo setTables, valore attuale dal servizio:",this.floorPlanStateService.tables().length);let n=this.selectedTable();if(n){let o=i.find(d=>d.id===n.id);o?this.floorPlanStateService.setSelectedTable(o):this.floorPlanStateService.setSelectedTable(null)}}onFloorPlanSelect(t){this.isEditingFloorPlanName&&this.cancelEditFloorPlanName(),this.userZoomed.set(!1),this.floorPlanStateService.setCurrentFloorPlan(t),this.floorPlanStateService.setCurrentVersion(t.current_version),this.floorPlanStateService.setActiveVersion(t.current_version),this.loadTablesForFloorPlan(),this.deselectAll(),this.cancelEditFloorPlan(),setTimeout(()=>this.updateCanvasDimensions(),50)}onFloorPlanSelectById(t){let e=this.floorPlans().find(i=>i.id===t);e&&this.onFloorPlanSelect(e)}selectTable(t){if(this.isMergeMode()){this.toggleTableSelection(t);return}this.deselectAll(),this.floorPlanStateService.setSelectedTable(t)}deselectAll(){this.floorPlanStateService.setSelectedTable(null),this.floorPlanStateService.setShowEditTableModal(!1)}onCreateTable(){return S(this,null,function*(){let t=this.currentFloorPlan(),e=yield this.authService.getCurrentStaffRestaurantId();if(!t||!e){console.error("\u274C Missing required data");return}try{let i=this.tableForm(),n={shape:i.shape,width:i.gridWidth*this.gridSize,height:i.gridHeight*this.gridSize,border_radius:i.borderRadius},o=this.tableService.validateTableDimensions(n),d={restaurant_id:e,floor_plan_id:t.id,table_name:i.tableName||`Tavolo ${i.tableNumber}`,table_number:i.tableNumber,capacity:i.capacity,shape:i.shape,position_x:this.modalPosition.x,position_y:this.modalPosition.y,width:o.width,height:o.height,rotation:0,is_active:!0,is_online_bookable:i.isOnlineBookable,is_merged:!1,parent_table_id:null,merged_tables_ids:[],border_radius:i.borderRadius};if(this.tableService.checkTableOverlap(d)){alert("Il tavolo si sovrappone a un altro tavolo. Scegli una posizione diversa.");return}console.log("\u{1F4DD} Creating table:",d),(yield this.tableService.createTable(d))?(console.log("\u2705 Table created successfully"),this.floorPlanStateService.setShowTableModal(!1),this.floorPlanStateService.setIsDrawing(!1)):console.error("\u274C Table creation failed")}catch(i){console.error("\u{1F4A5} Error creating table:",i)}})}onUpdateTable(){return S(this,null,function*(){let t=this.currentTableId();if(!(!t||!this.currentFloorPlan()))try{let e=this.tableForm(),i=this.currentFloorPlan(),n={id:t,shape:e.shape,width:e.width,height:e.height,border_radius:e.borderRadius,position_x:0,position_y:0},o=this.tableService.validateTableDimensions(n),p=this.tableService.getTables().find(R=>R.id===t);if(!p)return;if(p.position_x<0||p.position_y<0||p.position_x+o.width>i.width||p.position_y+o.height>i.height){alert("Il tavolo esce dai confini della mappa. Riduci le dimensioni o sposta il tavolo.");return}let P={shape:e.shape,width:o.width,height:o.height,border_radius:e.borderRadius,table_name:e.tableName,table_number:e.tableNumber,capacity:e.capacity,is_online_bookable:e.isOnlineBookable},x=b(b({},p),P);if(this.tableService.checkTableOverlap(x,t)){alert("Il tavolo si sovrappone a un altro tavolo. Modifica le dimensioni o la posizione.");return}(yield this.tableService.updateTable(t,P))?(console.log("\u2705 Tavolo aggiornato con successo"),this.floorPlanStateService.setShowTableModal(!1),this.deselectAll()):console.error("\u274C Errore nell'aggiornamento del tavolo")}catch(e){console.error("\u274C Error updating table:",e)}})}onDeleteTable(){return S(this,null,function*(){let t=this.selectedTable();if(t&&confirm("Sei sicuro di voler eliminare questo tavolo?"))try{(yield this.tableService.deleteTable(t.id))&&this.deselectAll()}catch(e){console.error("\u274C Error deleting table:",e)}})}onCancelCreateTable(){this.floorPlanStateService.setShowTableModal(!1),this.floorPlanStateService.setIsDrawing(!1)}createNewFloorPlan(){return S(this,null,function*(){let t=yield this.authService.getCurrentStaffRestaurantId();if(t)try{let e=this.floorPlanService.getDefaultDimensions(),i={restaurant_id:t,name:`Mappa ${this.floorPlans().length+1}`,width:e.width,height:e.height,is_active:!0,current_version:1},n=yield this.floorPlanService.createFloorPlan(i);n&&(this.floorPlanStateService.resetForNewFloorPlan(),this.floorPlanStateService.setCurrentFloorPlan(n),this.floorPlanStateService.setTables([]),this.userZoomed.set(!1),setTimeout(()=>{this.openDimensionsModal(),setTimeout(()=>this.updateCanvasDimensions(),50)},100))}catch(e){console.error("\u{1F4A5} Error creating floor plan:",e)}})}onDeleteFloorPlan(t,e){return S(this,null,function*(){if(e.stopPropagation(),!!confirm(`Sei sicuro di voler eliminare la mappa "${t.name}"?`))try{if((yield this.floorPlanService.deleteFloorPlan(t.id))&&this.currentFloorPlan()?.id===t.id){let n=this.floorPlans().find(o=>o.id!==t.id)||null;this.floorPlanStateService.setCurrentFloorPlan(n),this.loadTablesForFloorPlan()}}catch(i){console.error("\u{1F4A5} Error deleting floor plan:",i)}})}rotateSelectedTable(t=30){return S(this,null,function*(){let e=this.selectedTable();if(!(!e||this.isRotating)){this.isRotating=!0;try{if(!(yield this.tableRotationService.rotateTable(e,t)))throw new Error("Errore nel salvataggio della rotazione")}catch(i){console.error("\u274C Errore nella rotazione:",i),yield this.tableService.loadData(),this.loadTablesForFloorPlan()}finally{this.isRotating=!1}}})}rotateToAngle(t){let e=this.selectedTable();if(!e||this.isRotating)return;let i=this.tableRotationService.rotateToAngle(e,t);this.rotateSelectedTable(i)}onMouseWheel(t){if(!(!this.selectedTable()||this.isDrawing())&&t.ctrlKey){t.preventDefault();let e=t.deltaY>0?-5:5;this.rotateSelectedTable(e)}}toggleDrawingMode(){this.floorPlanStateService.setIsDrawing(!this.isDrawing()),this.isDrawing()||this.deselectAll()}toggleMergeMode(){let t=this.isMergeMode();this.floorPlanStateService.setIsMergeMode(!t),t?this.floorPlanStateService.clearSelectedTables():this.floorPlanStateService.setSelectedTables([]),this.deselectAll()}setDrawingMode(t){this.floorPlanStateService.setIsDrawing(t)}closeMergeModal(){this.floorPlanStateService.setShowMergeModal(!1)}toggleTableSelection(t){if(console.log("\u{1F4F1} toggleTableSelection chiamato per tavolo",t.table_number),!this.isMergeMode()||t.is_merged)return;let e=this.selectedTables();e.findIndex(n=>n.id===t.id)>-1?this.floorPlanStateService.removeFromSelectedTables(t.id):e.length===0||e.some(n=>this.floorPlanInteractionService.areTablesAdjacent(n,t))?e.length<4&&this.floorPlanStateService.addToSelectedTables(t):this.floorPlanInteractionService.showAdjacencyWarning(t,e)}canMergeTables(){let t=this.selectedTables();return t.length>=2&&t.length<=4&&t.every(i=>!i.is_merged)&&this.floorPlanInteractionService.areSelectedTablesAdjacent(t,this.tables())}openMergeModal(){this.canMergeTables()&&(this.mergeForm={tableName:this.floorPlanService.getMergedTableName(this.selectedTables()),tableNumber:this.floorPlanService.getMergedTableNumber(this.selectedTables()),capacity:this.floorPlanService.getTotalCapacity(this.selectedTables())},this.floorPlanStateService.setShowMergeModal(!0))}onMergeTables(){return S(this,null,function*(){let t=this.currentFloorPlan(),e=yield this.authService.getCurrentStaffRestaurantId();if(!(!t||!e||!this.canMergeTables()))try{let i=this.selectedTables(),n=Math.min(...i.map(x=>x.position_x)),o=Math.min(...i.map(x=>x.position_y)),d=Math.max(...i.map(x=>x.position_x+x.width)),p=Math.max(...i.map(x=>x.position_y+x.height)),_={table_name:this.mergeForm.tableName,table_number:this.mergeForm.tableNumber,capacity:this.mergeForm.capacity,position_x:n,position_y:o,width:d-n,height:p-o};(yield this.tableMergeService.mergeTables(i,_,t.id,e))&&(this.floorPlanStateService.setShowMergeModal(!1),this.floorPlanStateService.setIsMergeMode(!1),this.floorPlanStateService.clearSelectedTables(),yield this.tableService.loadData(),this.loadTablesForFloorPlan())}catch(i){console.error("\u274C Error merging tables:",i)}})}onSplitTable(t){return S(this,null,function*(){if(!t.merged_tables_ids||t.merged_tables_ids.length===0){console.log("\u274C Questo tavolo non \xE8 un tavolo unito");return}if(confirm("Sei sicuro di voler separare questo tavolo?"))try{console.log("\u{1F527} Separando tavolo unito:",t.table_number),(yield this.tableMergeService.splitMergedTable(t))?(console.log("\u2705 Tavolo separato con successo"),yield this.tableService.loadData(),this.loadTablesForFloorPlan(),this.deselectAll()):(console.error("\u274C Errore durante la separazione del tavolo"),alert("Errore durante la separazione del tavolo. Riprova."))}catch(e){console.error("\u274C Error splitting table:",e),alert("Errore durante la separazione del tavolo: "+e.message)}})}openDimensionsModal(){let t=this.currentFloorPlan();t&&(this.dimensionsForm={width:t.width,height:t.height},console.log("\u{1F4CF} Opening dimensions modal for:",{floorPlanId:t.id,name:t.name,currentTables:this.tables().length,dimensions:this.dimensionsForm}),this.floorPlanStateService.setShowDimensionsModal(!0))}onCancelDimensionsModal(){this.floorPlanStateService.setShowDimensionsModal(!1)}onSaveDimensions(){return S(this,null,function*(){let t=this.currentFloorPlan();if(t)try{let e=this.tables().filter(n=>n.floor_plan_id===t.id);if(e.length>0){let n=e.filter(o=>o.position_x+o.width>this.dimensionsForm.width||o.position_y+o.height>this.dimensionsForm.height);if(n.length>0){if(!confirm(`${n.length} tavolo(i) escono dai nuovi bordi della mappa. Vuoi continuare? I tavoli verranno spostati automaticamente.`))return;for(let d of n)d.position_x=Math.min(d.position_x,this.dimensionsForm.width-d.width),d.position_y=Math.min(d.position_y,this.dimensionsForm.height-d.height),yield this.tableService.updateTable(d.id,{position_x:d.position_x,position_y:d.position_y})}}if(yield this.floorPlanService.updateFloorPlan(t.id,{width:this.dimensionsForm.width,height:this.dimensionsForm.height})){let n=b(b({},t),this.dimensionsForm);this.floorPlanStateService.setCurrentFloorPlan(n),this.floorPlanStateService.setShowDimensionsModal(!1),this.updateCanvasDimensions(),console.log("\u2705 Dimensioni mappa aggiornate con successo")}}catch(e){console.error("\u274C Error updating floor plan dimensions:",e)}})}setDimensions(t,e){this.dimensionsForm.width=t,this.dimensionsForm.height=e}startEditFloorPlan(t,e){e.stopPropagation(),t&&(this.editingFloorPlan=t,this.editedFloorPlanName=t.name)}cancelEditFloorPlan(){this.editingFloorPlan=null}createDefaultFloorPlan(){return S(this,null,function*(){let t=yield this.authService.getCurrentStaffRestaurantId();if(t)try{let e=this.floorPlanService.getDefaultDimensions(),i={restaurant_id:t,name:"Mappa Principale",width:e.width,height:e.height,is_active:!0,current_version:1},n=yield this.floorPlanService.createFloorPlan(i);n&&this.floorPlanStateService.setCurrentFloorPlan(n)}catch(e){console.error("\u{1F4A5} Error creating default floor plan:",e)}})}generateNextTableNumber(){return this.tableService.generateNextTableNumber(this.tables())}highlightAdjacentTables(){console.log("\u{1F3AF} Mostra vicini - Inizio"),this.highlightMessage.set(null);let t=this.tables();if(t.length<2){this.highlightMessage.set("Ci sono meno di 2 tavoli nella mappa. Aggiungi altri tavoli per vedere quelli vicini."),console.warn("\u26A0\uFE0F Meno di 2 tavoli nella mappa");return}console.log("\u{1F4CA} Tavoli totali:",t.length);let i=this.findAdjacentTableGroups(t).filter(o=>o.length>1);if(i.length===0){this.highlightMessage.set("Non ci sono tavoli vicini tra loro in questa mappa. Sposta i tavoli pi\xF9 vicini per poterli unire."),console.warn("\u26A0\uFE0F Nessun gruppo di tavoli adiacenti trovato");return}console.log(`\u{1F50D} Trovati ${i.length} gruppi di tavoli adiacenti`);let n=0;i.forEach(o=>{n+=o.length}),this.highlightMessage.set(`Trovati ${i.length} gruppi di tavoli adiacenti (${n} tavoli totali). L'evidenziazione verr\xE0 rimossa tra 5 secondi.`),i.forEach(o=>{o.forEach(d=>{this.highlightTable(d)})}),setTimeout(()=>{this.clearAllHighlights(),setTimeout(()=>{this.highlightMessage.set(null)},500)},5e3)}findAdjacentTableGroups(t){let e=[],i=new Set;for(let n of t)if(!i.has(n.id)){let o=this.findConnectedTables(n,t,i);e.push(o)}return e.filter(n=>n.length>0)}findConnectedTables(t,e,i){let n=[],o=[t];for(;o.length>0;){let d=o.shift();if(!i.has(d.id)){i.add(d.id),n.push(d);for(let p of e)!i.has(p.id)&&p.id!==d.id&&this.floorPlanInteractionService.areTablesAdjacent(d,p,0)&&o.push(p)}}return n}highlightTable(t){let e=document.querySelector(`[data-table-id="${t.id}"]`);e?(e.classList.add("adjacent-highlight"),console.log(`\u2705 Evidenziato tavolo ${t.table_number}`)):console.warn(`\u26A0\uFE0F Tavolo ${t.table_number} non trovato nel DOM`)}clearAllHighlights(){document.querySelectorAll(".adjacent-highlight").forEach(e=>{e.classList.remove("adjacent-highlight")}),console.log("\u{1F9F9} Evidenziazioni rimosse")}getPreviewBorderRadius(){let t=this.tableForm();return this.floorPlanService.getPreviewBorderRadius(t.shape,t.borderRadius)}getPreviewBorderRadiusValue(){let t=this.tableForm();return this.floorPlanService.getPreviewBorderRadiusValue(t.shape,t.borderRadius)}getEditPreviewBorderRadius(){let t=this.selectedTable();return t?this.floorPlanService.getPreviewBorderRadius(t.shape,t.border_radius??8):"8px"}getEditPreviewBorderRadiusValue(){let t=this.selectedTable();return t?this.floorPlanService.getPreviewBorderRadiusValue(t.shape,t.border_radius??8):"8px"}getSelectedTableNumbers(){return this.floorPlanService.getSelectedTableNumbers(this.selectedTables())}getTableElement(t){if(!this.canvasRef?.nativeElement)return null;let e=this.canvasRef.nativeElement.querySelector(`[data-table-id="${t.id}"]`);return e||null}setupCanvasInteractions(){let t=this.canvasRef.nativeElement;this.renderer.listen(t,"click",e=>this.onCanvasClick(e)),this.renderer.listen(t,"pointerdown",e=>this.onCanvasPointerDown(e)),this.renderer.listen(t,"touchstart",e=>{this.onCanvasTouchStart(e)},{passive:!1}),this.renderer.listen(document,"pointermove",()=>{this.isDragging&&t.classList.add("dragging-active")}),this.renderer.listen(document,"pointerup",()=>{this.isDragging=!1,t.classList.remove("dragging-active")})}onCanvasPointerDown(t){if(this.isDrawing())return;let i=t.target.closest(".table-element");if(i){this.isDragging=!0;let n=i.getAttribute("data-table-id"),o=this.tables().find(d=>d.id===n);o&&(console.log("\u{1F7E2} START DRAG for table:",o.table_number),i.classList.add("dragging"),i.style.transition="none",this.selectTable(o),this.floorPlanInteractionService.startTableDrag(o.id,t,this.canvasRef.nativeElement,this.canvasScale()))}else this.deselectAll();t.preventDefault(),t.stopPropagation()}onCanvasTouchStart(t){if(this.isDrawing())return;let i=t.target.closest(".table-element");if(i){t.cancelable&&t.preventDefault();let n=i.getAttribute("data-table-id"),o=this.tables().find(d=>d.id===n);if(o)if(this.selectTable(o),t.cancelable){this.isDragging=!0;let d=t.touches[0],p=new PointerEvent("pointerdown",{clientX:d.clientX,clientY:d.clientY,pointerId:1});i.classList.add("dragging"),i.style.transition="none",this.floorPlanInteractionService.startTableDrag(o.id,p,this.canvasRef.nativeElement)}else console.log("\u{1F4F1} Touch event non cancellabile, solo selezione")}else this.deselectAll()}setupPinchToZoom(){if(!this.canvasRef?.nativeElement){console.warn("Canvas ref non disponibile per pinch-to-zoom, rimando l'inizializzazione"),setTimeout(()=>this.setupPinchToZoom(),100);return}let t=this.canvasRef.nativeElement,e=0,i=0;this.renderer.listen(t,"touchstart",n=>{if(n.touches.length===2){n.preventDefault();let o=n.touches[0],d=n.touches[1];e=Math.hypot(d.clientX-o.clientX,d.clientY-o.clientY),i=this.canvasScale()}},{passive:!1}),this.renderer.listen(t,"touchmove",n=>{if(n.touches.length===2){n.preventDefault();let o=n.touches[0],d=n.touches[1],p=Math.hypot(d.clientX-o.clientX,d.clientY-o.clientY);if(e>0){let _=p/e,P=i*_,x=Math.max(.3,Math.min(P,3));this.canvasScale.set(x),this.updateCanvasDimensions()}}},{passive:!1}),this.renderer.listen(t,"touchend",()=>{e=0,i=0})}toggleSize(){this.isLargeText=!this.isLargeText}trackByTableId(t,e){return e.id}trackByFloorPlanId(t,e){return e.id}logCanvasInfo(){console.log("\u{1F4D0} Canvas Info:",{floorPlanWidth:this.floorPlanWidth(),floorPlanHeight:this.floorPlanHeight(),canvasScale:this.canvasScale(),visualWidth:this.visualWidth(),visualHeight:this.visualHeight(),isMobile:this.isMobileView()})}onDimensionChange(){if(this.modalMode()==="edit"){let t=this.floorPlanStateService.tableForm();(t.shape==="circle"||t.shape==="square")&&this.floorPlanStateService.updateTableForm({height:t.width,gridHeight:Math.round(t.width/this.gridSize)})}}onGridDimensionChange(){if(this.modalMode()==="create"){let t=this.floorPlanStateService.tableForm(),e=t.gridWidth*this.gridSize,i=t.gridHeight*this.gridSize;if(t.shape==="circle"||t.shape==="square"){let n=t.gridWidth*this.gridSize;this.floorPlanStateService.updateTableForm({width:e,height:n,gridHeight:t.gridWidth})}else this.floorPlanStateService.updateTableForm({width:e,height:i})}}startEditFloorPlanName(){let t=this.currentFloorPlan();t&&(this.isEditingFloorPlanName=!0,this.editedFloorPlanName=t.name)}saveFloorPlanName(){return S(this,null,function*(){let t=this.currentFloorPlan();if(!(!t||!this.editedFloorPlanName.trim()))try{if(yield this.floorPlanService.updateFloorPlan(t.id,{name:this.editedFloorPlanName})){let i=f(b({},t),{name:this.editedFloorPlanName});this.floorPlanStateService.setCurrentFloorPlan(i),yield this.floorPlanService.loadData(),this.isEditingFloorPlanName=!1,this.editedFloorPlanName=""}}catch(e){console.error("\u274C Error saving floor plan name:",e)}})}cancelEditFloorPlanName(){this.isEditingFloorPlanName=!1,this.editedFloorPlanName=""}getScrollDimensions(){let t=this.containerRef?.nativeElement,e=this.canvasRef?.nativeElement;if(!t||!e)return{scrollWidth:0,scrollHeight:0};let i=this.floorPlanWidth()*this.canvasScale(),n=this.floorPlanHeight()*this.canvasScale(),o=t.clientWidth,d=t.clientHeight,p=Math.max(0,i-o),_=Math.max(0,n-d);return{scrollWidth:p,scrollHeight:_,canScroll:p>0||_>0}}getTotalCapacity(){return this.floorPlanService.getTotalCapacity(this.selectedTables())}getTableStyle(t){return this.tableService.getTableStyle(t)}getTableClass(t){let i=[this.tableService.getTableClass(t,this.selectedTable(),this.selectedTables(),this.isMergeMode())];return this.isMergeMode()&&this.selectedTables().some(n=>n.id===t.id)&&i.push("merge-selected"),i.join(" ")}getMergedTableName(){return this.floorPlanService.getMergedTableName(this.selectedTables())}getMergedTableNumber(){return this.floorPlanService.getMergedTableNumber(this.selectedTables())}areTablesAdjacent(t,e){return this.floorPlanInteractionService.areTablesAdjacent(t,e)}areSelectedTablesAdjacent(){return this.floorPlanInteractionService.areSelectedTablesAdjacent(this.selectedTables(),this.tables())}showAdjacencyWarning(t){this.floorPlanInteractionService.showAdjacencyWarning(t,this.selectedTables())}testHighlight(){if(console.log("\u{1F526} TEST HIGHLIGHT - Verifica tavoli nel DOM:"),!this.canvasRef?.nativeElement){console.error("\u274C Canvas non trovato");return}let t=this.canvasRef.nativeElement.querySelectorAll(".table-element");if(console.log(`Tavoli nel DOM: ${t.length}`),t.length>0){let i=t[0];i.style.border="5px solid red !important",i.style.boxShadow="0 0 20px red !important",console.log("\u2705 Primo tavolo evidenziato (stile diretto)"),i.classList.add("test-highlight"),console.log("\u2705 Aggiunta classe test-highlight")}let e=this.floorPlanInteractionService.getAdjacentTablesToSelection(this.selectedTables(),this.tables());console.log("Tavoli adiacenti dal servizio:",e.map(i=>i.table_number))}previewWidth=T(()=>{let t=this.floorPlanStateService.tableForm(),e=this.modalMode(),i=e==="create"?t.gridWidth*this.gridSize:t.width;return console.log("\u{1F4CF} previewWidth calcolato:",{mode:e,gridWidth:t.gridWidth,width:t.width,gridSize:this.gridSize,result:i}),i});previewHeight=T(()=>{let t=this.floorPlanStateService.tableForm(),e=this.modalMode(),i;return e==="create"?i=t.gridHeight*this.gridSize:i=t.height,console.log("\u{1F4CF} previewHeight calcolato:",{mode:e,gridHeight:t.gridHeight,height:t.height,result:i}),i});previewBorderRadius=T(()=>{let t=this.floorPlanStateService.tableForm(),e;return t.shape==="circle"?e="50%":e=`${t.borderRadius}px`,console.log("\u{1F504} previewBorderRadius calcolato:",{shape:t.shape,borderRadius:t.borderRadius,result:e}),e});updatePreview(){console.log("\u{1F504} Aggiorno anteprima...");let t=this.floorPlanStateService.tableForm();this.floorPlanStateService.updateTableForm(b({},t))}openCreateTableModal(t){this.modalMode.set("create"),this.modalPosition=t,this.currentTableId.set(null),this.floorPlanStateService.resetTableForm(),this.floorPlanStateService.setShowTableModal(!0)}openEditTableModal(t){let e=t||this.selectedTable();if(!e)return;this.modalMode.set("edit"),this.currentTableId.set(e.id);let i=e.is_merged||e.merged_tables_ids&&e.merged_tables_ids.length>0,n=Math.round(e.width/this.gridSize),o=Math.round(e.height/this.gridSize);this.floorPlanStateService.updateTableForm({shape:e.shape,gridWidth:n,gridHeight:o,width:e.width,height:e.height,borderRadius:e.border_radius||8,tableNumber:e.table_number,capacity:e.capacity,tableName:e.table_name||"",isOnlineBookable:e.is_online_bookable,isMerged:i}),this.floorPlanStateService.setShowTableModal(!0),i&&setTimeout(()=>{alert("\u26A0\uFE0F Questo tavolo \xE8 unito. Per modificare le dimensioni, separalo prima.")},100)}onSaveTable(){return S(this,null,function*(){if(this.modalMode()==="edit"&&this.tableForm().isMerged){let t=this.tableForm(),i=this.tableService.getTables().find(n=>n.id===this.currentTableId());if(i&&(t.width!==i.width||t.height!==i.height)){alert("\u274C Non puoi modificare le dimensioni di un tavolo unito. Separalo prima.");return}}this.modalMode()==="create"?yield this.onCreateTable():yield this.onUpdateTable()})}onCanvasClick(t){if(!this.isDrawing()||!this.currentFloorPlan())return;let i=this.canvasRef.nativeElement.getBoundingClientRect(),n=this.canvasScale(),o=(t.clientX-i.left)/n,d=(t.clientY-i.top)/n,p=this.snapToGrid?Math.round(o/this.gridSize)*this.gridSize:o,_=this.snapToGrid?Math.round(d/this.gridSize)*this.gridSize:d,P=this.floorPlanWidth()-40,x=this.floorPlanHeight()-40,z=Math.min(Math.max(p,0),P),F=Math.min(Math.max(_,0),x);this.openCreateTableModal({x:z,y:F}),t.stopPropagation()}onGridWidthChange(t){let e=this.floorPlanStateService.tableForm();this.floorPlanStateService.updateTableForm({gridWidth:t});let i=t*this.gridSize;e.shape==="circle"||e.shape==="square"?this.floorPlanStateService.updateTableForm({width:i,height:i,gridHeight:t}):this.floorPlanStateService.updateTableForm({width:i})}onGridHeightChange(t){let e=this.floorPlanStateService.tableForm();if(this.floorPlanStateService.updateTableForm({gridHeight:t}),e.shape!=="circle"&&e.shape!=="square"){let i=t*this.gridSize;this.floorPlanStateService.updateTableForm({height:i})}}onWidthChange(t){let e=this.floorPlanStateService.tableForm();this.floorPlanStateService.updateTableForm({width:t}),e.shape==="circle"||e.shape==="square"?this.floorPlanStateService.updateTableForm({height:t,gridWidth:Math.round(t/this.gridSize),gridHeight:Math.round(t/this.gridSize)}):this.floorPlanStateService.updateTableForm({gridWidth:Math.round(t/this.gridSize)})}onHeightChange(t){let e=this.floorPlanStateService.tableForm();e.shape!=="circle"&&e.shape!=="square"&&this.floorPlanStateService.updateTableForm({height:t,gridHeight:Math.round(t/this.gridSize)})}onBorderRadiusChange(t){this.floorPlanStateService.updateTableForm({borderRadius:t})}onShapeSelect(t){console.log("\u{1F3AF} Cambio forma a:",t.type),this.floorPlanStateService.initializeTableFormForShape(t.type),setTimeout(()=>{let e=this.floorPlanStateService.tableForm();if(this.modalMode()==="create"){let i=e.gridWidth*this.gridSize,n=e.gridHeight*this.gridSize;e.shape==="circle"||e.shape==="square"?this.floorPlanStateService.updateTableForm({width:i,height:i,gridHeight:e.gridWidth}):this.floorPlanStateService.updateTableForm({width:i,height:n})}else(e.shape==="circle"||e.shape==="square")&&this.floorPlanStateService.updateTableForm({height:e.width,gridHeight:Math.round(e.width/this.gridSize)})},0)}onTablePointerDown(t,e){if(t.stopPropagation(),t.preventDefault(),!this.isDrawing()){if(this.isMergeMode()){this.toggleTableSelection(e);return}if(this.selectTable(e),this.floorPlanStateService.isEditMode()){this.isDragging=!0;let i=t.target;i&&(i.classList.add("dragging"),i.style.transition="none"),this.floorPlanInteractionService.startTableDrag(e.id,t,this.canvasRef.nativeElement,this.canvasScale())}}}onVersionChange(t){return S(this,null,function*(){this.floorPlanStateService.setCurrentVersion(t),yield this.tableService.loadData();let e=this.currentFloorPlan();e&&(console.log("\u{1F4CA} Dopo loadData, tavoli totali nel servizio:",this.tableService.getTables().length),console.log("\u{1F4CA} Tavoli per questo floorPlan:",this.tableService.getTablesByFloorPlan(e.id).map(i=>({id:i.id,version:i.version})))),this.loadTablesForFloorPlan()})}setCurrentVersion(t,e){return S(this,null,function*(){try{let{error:i}=yield this.supabaseService.getSupabaseClient().from("restaurant_floor_plans").update({current_version:e,updated_at:new Date().toISOString()}).eq("id",t);if(i)throw i;return!0}catch(i){return console.error("\u274C Error setting current version:",i),!1}})}publishVersion(t){return S(this,null,function*(){let e=this.currentFloorPlan();if(!e)return;(yield this.floorPlanService.setCurrentVersion(e.id,t))&&(this.floorPlanStateService.setActiveVersion(t),yield this.tableService.loadData(),this.loadTablesForFloorPlan())})}createNewVersion(){return S(this,null,function*(){let t=this.currentFloorPlan();if(!t)return;let e=yield this.tableService.getNextVersion(t.id);console.log("\u{1F195} Nuova versione:",{nextVersion:e,planId:t.id});let i=this.tableService.getTablesByFloorPlan(t.id,this.floorPlanStateService.currentVersion());console.log("\u{1F4CB} Tavoli da duplicare:",i.length);for(let o of i){console.log("\u{1F504} Duplicazione tavolo",o.table_number);let n=o,{id:d,created_at:p}=n,_=le(n,["id","created_at"]),P=f(b({},_),{version:e}),x=yield this.tableService.createTable(P);console.log("\u2705 Risultato creazione:",x)}yield this.tableService.loadData(),this.refreshTrigger.update(o=>o+1),this.floorPlanStateService.setCurrentVersion(e),this.loadTablesForFloorPlan()})}deleteVersion(t){return S(this,null,function*(){let e=this.currentFloorPlan();if(!e)return;if(t===this.floorPlanStateService.activeVersion()){alert("Non puoi eliminare la versione attiva.");return}if(confirm(`Sei sicuro di voler eliminare la versione ${t}?`))try{let n=this.tableService.getTablesByFloorPlan(e.id,t);for(let o of n)yield this.tableService.deleteTable(o.id);yield this.tableService.loadData(),this.refreshTrigger.update(o=>o+1),this.floorPlanStateService.currentVersion()===t&&this.floorPlanStateService.setCurrentVersion(this.floorPlanStateService.activeVersion()),this.loadTablesForFloorPlan()}catch(n){console.error("\u274C Errore durante l'eliminazione della versione:",n),alert("Errore durante l'eliminazione. Riprova.")}})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=de({type:s,selectors:[["app-floor-plan"]],viewQuery:function(e,i){if(e&1&&(ie(Oe,5),ie(Be,5)),e&2){let n;ne(n=ae())&&(i.canvasRef=n.first),ne(n=ae())&&(i.containerRef=n.first)}},hostBindings:function(e,i){e&1&&v("wheel",function(o){return i.onMouseWheel(o)})},decls:93,vars:38,consts:[["canvasContainer",""],["floorPlanCanvas",""],[1,"page-container"],[1,"form-card"],[1,"flex","flex-col"],["data-tutorial","floor-plan-selector",1,"form-row","mb-md"],[1,"form-group"],[1,"standard-label"],[1,"flex","gap-sm","items-center"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],[1,"flex","gap-sm"],["title","Modifica nome mappa",1,"icon-button",3,"click","disabled"],[1,"material-icons"],[1,"icon-button",3,"click"],["name","plus",3,"size"],[1,"icon-button",3,"click","disabled"],["name","proportions",3,"size"],["title","Elimina mappa",1,"icon-button",3,"click","disabled"],["name","trash-2",3,"size"],["class","mt-sm",4,"ngIf"],["class","form-group",4,"ngIf"],[1,"form-row"],["title","Zoom -",1,"icon-button",3,"click"],[1,"text-sm"],["title","Zoom +",1,"icon-button",3,"click"],["title","Reset zoom",1,"icon-button",3,"click"],[1,"checkbox-label","ml-sm"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"checkbox-content"],[1,"text-muted"],["class","form-group mt-md",4,"ngIf"],["class","rounded mb-sm p-sm","style","background-color: var(--smoke-1); ",4,"ngIf"],["class","flex flex-wrap gap-md mt-lg",4,"ngIf"],["data-tutorial","floor-plan-editor",1,"form-group"],[1,"modal-footer",2,"justify-content","flex-start"],[1,"promethea-button",3,"click"],[1,"promethea-button","ghost",3,"click"],[1,"canvas-container"],["class","drawing-tooltip",4,"ngIf"],["class","canvas-wrapper",3,"width","height",4,"ngIf"],["class","empty-floorplan",4,"ngIf"],[1,"bg-smoke","rounded","p-md","mt-sm","flex","justify-between","flex-wrap","gap-md"],[1,"flex","flex-col","gap-sm","align-center"],[1,"font-bold"],["class","modal-overlay",4,"ngIf"],[3,"ngValue"],[1,"mt-sm"],["type","text","placeholder","Nuovo nome mappa","autofocus","",1,"form-input",3,"ngModelChange","keyup.enter","keyup.escape","ngModel"],["title","Salva",1,"icon-button","success",3,"click"],["title","Annulla",1,"icon-button",3,"click"],[1,"text-sm","text-muted","mt-sm"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["title","Crea nuova versione come bozza",1,"icon-button",3,"click"],["class","icon-button","title","Rendi questa versione attiva",3,"click",4,"ngIf"],["class","icon-button","title","Elimina questa versione",3,"click",4,"ngIf"],[3,"value"],["title","Rendi questa versione attiva",1,"icon-button",3,"click"],["name","external-link",3,"size"],["title","Elimina questa versione",1,"icon-button",3,"click"],[1,"form-group","mt-md"],[1,"flex","justify-between","flex-col","flex-wrap"],["class","flex gap-sm",4,"ngIf"],[1,"flex","items-center","gap-sm","border-l","pl-sm"],["title","Ruota di -30\xB0",1,"icon-button",3,"click","disabled"],[1,"flex","flex-col","items-center"],[1,"text-sm","font-bold"],[1,"text-mini","text-muted"],["title","Ruota di +30\xB0",1,"icon-button",3,"click","disabled"],["title","Reset rotazione a 0\xB0",1,"icon-button",3,"click","disabled"],[1,"text-mini","text-muted","mt-sm"],[1,"material-icons","text-mini"],["title","0\xB0",1,"icon-button",3,"click"],["title","90\xB0",1,"icon-button",3,"click"],["title","180\xB0",1,"icon-button",3,"click"],["title","270\xB0",1,"icon-button",3,"click"],[1,"rounded","mb-sm","p-sm",2,"background-color","var(--smoke-1)"],[1,"flex","justify-between","flex-wrap","gap-md"],["class","chip active small ml-sm",4,"ngIf"],[1,"modal-footer"],[1,"promethea-button","primary","small",3,"click"],["class","promethea-button warning small",3,"click",4,"ngIf"],[1,"promethea-button","ghost","small",3,"click"],[1,"chip","active","small","ml-sm"],[1,"promethea-button","warning","small",3,"click"],[1,"flex","flex-wrap","gap-md","mt-lg"],[1,"flex","flex-col","gap-md"],["class","text-muted",4,"ngIf"],[1,"promethea-button","small",3,"click","disabled"],[4,"ngIf"],[1,"promethea-button","ghost","small",3,"click","disabled"],["class","mt-lg",4,"ngIf"],[1,"mt-sm","mb-sm"],["class","alert alert-info",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","ml-sm",4,"ngIf"],[1,"ml-sm"],[1,"mt-lg"],[1,"flex","items-center","gap-sm"],[1,"material-icons","text-warning"],[1,"flex-1"],[1,"icon-button","small",3,"click"],[1,"alert","alert-info"],["name","info"],[1,"alert","alert-warning"],[1,"alert","alert-success"],[1,"drawing-tooltip"],[1,"canvas-wrapper"],[1,"floor-plan-canvas"],[1,"canvas-background"],["class","grid-overlay",3,"background-size",4,"ngIf"],["class","table-element",3,"class","ngStyle","pointerdown",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],[1,"grid-overlay"],[1,"table-element",3,"pointerdown","ngStyle"],[1,"table-content"],[1,"table-number"],[1,"table-capacity"],[1,"empty-state"],[1,"empty-floorplan"],[1,"promethea-button","primary","mt-md",3,"click"],[1,"modal-overlay"],[1,"modal-container","modal-md"],[1,"modal-header"],[1,"header-icon"],[1,"section-title"],[1,"form-group","mb-lg"],[1,"grid-cards","mb-md"],["class","card text-center hover-lift",3,"active","click",4,"ngFor","ngForOf"],[1,"form-row","mb-lg"],["type","text","name","tableNumber","placeholder","Es: 1",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","capacity","min","1","max","100",1,"form-input",3,"ngModelChange","ngModel"],["type","text","name","tableName","placeholder","Es: Tavolo finestra",1,"form-input",3,"ngModelChange","ngModel"],[1,"checkbox-label"],["type","checkbox","name","isOnlineBookable",3,"ngModelChange","ngModel"],[1,"form-card","text-center"],[1,"flex","justify-center","mt-md"],[1,"table-preview",3,"ngStyle"],[1,"preview-content"],[1,"text-muted","mt-sm","mt-lg","justify-center","flex"],["class","text-xs text-muted mt-2",4,"ngIf"],["type","button",1,"promethea-button","ghost",3,"click"],["type","button",1,"promethea-button",3,"click"],["type","button","class","promethea-button danger",3,"click",4,"ngIf"],[1,"card","text-center","hover-lift",3,"click"],[1,"flex","flex-col","items-center","gap-sm"],["type","number","name","gridWidth","min","2","max","20",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","number","name","gridHeight","min","2","max","20",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","number","name","width","min","20","max","1000","step","10",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","number","name","height","min","20","max","1000","step","10",1,"form-input",3,"ngModelChange","ngModel","disabled"],["type","range","name","borderRadius","min","0","max","50","step","1",1,"form-input",3,"ngModelChange","ngModel"],[1,"flex","justify-between","text-sm","text-muted"],[1,"info-message"],[1,"text-xs","text-muted","mt-2"],["type","button",1,"promethea-button","danger",3,"click"],[1,"flex","items-center","gap-md"],[1,"material-icons","text-lg"],[1,"section-title","modal-header-title"],[1,"p-lg"],[1,"generic-form"],["type","number","name","floorPlanWidth","min","500","max","5000","step","50",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","floorPlanHeight","min","500","max","5000","step","50",1,"form-input",3,"ngModelChange","ngModel"],[1,"standard-label","mb-md"],["type","button",1,"promethea-button","ghost","x-small",3,"click"],[1,"font-semibold"],[1,"flex","justify-center","mt-lg"],[1,"dimension-preview","border","shadow-card","rounded-lg","bg-smoke"],[1,"text-muted","p-sm"],["name","save"],[1,"flex","flex-col","gap-sm"],["class","flex items-center gap-sm p-sm border rounded",4,"ngFor","ngForOf"],["type","text","name","mergedTableNumber","placeholder","Es: U123",1,"form-input",3,"ngModelChange","ngModel"],["type","number","name","mergedTableCapacity","min","2","max","50",1,"form-input",3,"ngModelChange","ngModel"],["type","text","name","mergedTableName","placeholder","Es: Tavolo Unito per Gruppo",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-row","mt-lg"],[1,"flex","items-center","gap-sm","p-sm","border","rounded"]],template:function(e,i){if(e&1){let n=M();a(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"label",7),l(6,"Mappa"),r(),a(7,"div",8)(8,"select",9),v("ngModelChange",function(d){return h(n),u(i.onFloorPlanSelectById(d))}),a(9,"option",10),l(10,"Seleziona mappa"),r(),w(11,Le,2,4,"option",11),r(),a(12,"div",12)(13,"button",13),v("click",function(){return h(n),u(i.startEditFloorPlanName())}),a(14,"span",14),l(15,"edit"),r()(),a(16,"button",15),v("click",function(){return h(n),u(i.createNewFloorPlan())}),D(17,"lucide-angular",16),r(),a(18,"button",17),v("click",function(){return h(n),u(i.openDimensionsModal())}),D(19,"lucide-angular",18),r(),a(20,"button",19),v("click",function(d){return h(n),u(i.onDeleteFloorPlan(i.currentFloorPlan(),d))}),D(21,"lucide-angular",20),r()()(),w(22,qe,12,1,"div",21),r(),w(23,Ze,10,5,"div",22),r(),a(24,"div",23)(25,"div",6)(26,"label",7),l(27,"Zoom"),r(),a(28,"div",8)(29,"button",24),v("click",function(){return h(n),u(i.zoomOut())}),a(30,"span",14),l(31,"zoom_out"),r()(),a(32,"span",25),l(33),r(),a(34,"button",26),v("click",function(){return h(n),u(i.zoomIn())}),a(35,"span",14),l(36,"zoom_in"),r()(),a(37,"button",27),v("click",function(){return h(n),u(i.resetCanvasZoom())}),a(38,"span",14),l(39,"refresh"),r()(),a(40,"label",28)(41,"input",29),N("ngModelChange",function(d){return h(n),k(i.snapToGrid,d)||(i.snapToGrid=d),u(d)}),v("change",function(){return h(n),u(i.refreshCanvasSize())}),r(),a(42,"div",30)(43,"span",31),l(44),r()()()()(),w(45,Ue,29,5,"div",32),r(),w(46,Je,19,4,"div",33)(47,st,25,11,"div",34),r(),a(48,"div",35)(49,"label",7),l(50,"Tavoli"),r(),a(51,"div",36)(52,"button",37),v("click",function(){return h(n),u(i.toggleDrawingMode())}),a(53,"span",14),l(54,"add_circle"),r(),l(55),r(),a(56,"button",37),v("click",function(){return h(n),u(i.floorPlanStateService.setIsEditMode(!i.floorPlanStateService.isEditMode()))}),a(57,"span",14),l(58,"edit"),r(),l(59),r(),a(60,"button",38),v("click",function(){return h(n),u(i.toggleMergeMode())}),a(61,"span",14),l(62,"merge"),r(),l(63),r()()(),a(64,"div",39,0),w(66,ct,4,0,"div",40)(67,ut,7,16,"div",41)(68,gt,10,1,"div",42),r(),a(69,"div",43)(70,"div",44)(71,"span",31),l(72,"Dimensioni mappa:"),r(),a(73,"span",45),l(74),r()(),a(75,"div",44)(76,"span",31),l(77,"Visualizzato:"),r(),a(78,"span",45),l(79),r()(),a(80,"div",44)(81,"span",31),l(82,"Scala:"),r(),a(83,"span",45),l(84),r()(),a(85,"div",44)(86,"span",31),l(87,"Tavoli:"),r(),a(88,"span",45),l(89),r()()()()(),w(90,wt,72,29,"div",46)(91,Mt,50,8,"div",46)(92,Ft,48,6,"div",46)}e&2&&(c(8),g("ngModel",i.currentFloorPlanId())("disabled",i.floorPlans().length===0||i.isEditingFloorPlanName),c(3),g("ngForOf",i.floorPlans()),c(2),g("disabled",!i.currentFloorPlan()||i.isEditingFloorPlanName),c(4),g("size",20),c(),g("disabled",!i.currentFloorPlan()),c(),g("size",20),c(),g("disabled",!i.currentFloorPlan()||i.isEditingFloorPlanName),c(),g("size",20),c(),g("ngIf",i.isEditingFloorPlanName&&i.currentFloorPlan()),c(),g("ngIf",i.currentFloorPlan()),c(10),E("",(i.canvasScale()*100).toFixed(0),"%"),c(8),I("ngModel",i.snapToGrid),c(3),E("Griglia (",i.gridSize,"px)"),c(),g("ngIf",i.selectedTable()&&!i.isDrawing()&&i.floorPlanStateService.isEditMode()),c(),g("ngIf",i.selectedTable()&&!i.isDrawing()),c(),g("ngIf",i.isMergeMode()),c(5),H("active",i.isDrawing()),c(3),E(" ",i.isDrawing()?"Annulla":"Aggiungi"," "),c(),H("active",i.floorPlanStateService.isEditMode()),c(3),E(" ",i.floorPlanStateService.isEditMode()?"Modifica attiva":"Modifica"," "),c(),H("active",i.isMergeMode()),c(3),E(" ",i.isMergeMode()?"Annulla":"Unisci"," "),c(3),g("ngIf",i.isDrawing()),c(),g("ngIf",i.currentFloorPlan()),c(),g("ngIf",!i.currentFloorPlan()),c(6),B("",i.floorPlanWidth()," \xD7 ",i.floorPlanHeight()," px"),c(5),B("",i.visualWidth().toFixed(0)," \xD7 ",i.visualHeight().toFixed(0)," px"),c(5),E("",(i.canvasScale()*100).toFixed(0),"%"),c(5),O(i.tables().length),c(),g("ngIf",i.showTableModal()),c(),g("ngIf",i.showDimensionsModal()),c(),g("ngIf",i.showMergeModal()))},dependencies:[_e,ve,be,fe,ze,Fe,De,Ie,Te,ye,Ce,xe,Ve,Pe,we,Ne,ke,Ee,Me,We,Re],styles:[".canvas-container[_ngcontent-%COMP%]{position:relative;width:100%;height:100vh;min-height:400px;border:2px solid var(--smoke-1);border-radius:12px;background-color:var(--background);overflow:auto!important;-webkit-overflow-scrolling:touch!important;padding:var(--gap-sm);box-sizing:border-box;contain:content}.canvas-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;min-width:100%;min-height:100%}.floor-plan-canvas[_ngcontent-%COMP%]{position:relative;background-color:var(--background);box-shadow:0 4px 12px var(--smoke-1);border-radius:8px;transform-origin:0 0;overflow:visible;margin:0;isolation:isolate;contain:layout paint}@media (max-width: 768px){.canvas-container[_ngcontent-%COMP%]{height:50vh;min-height:300px;max-height:500px;padding:8px}}.table-element[_ngcontent-%COMP%]{touch-action:manipulation;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;transition:none}.table-content[_ngcontent-%COMP%]{text-align:center;padding:var(--gap-sm);width:100%;display:flex;flex-direction:column;gap:calc(var(--gap-sm) / 2)}.table-number[_ngcontent-%COMP%]{font-weight:800;font-size:var(--fs-sm);color:var(--text-color);line-height:1}.table-capacity[_ngcontent-%COMP%]{font-size:calc(var(--fs-sm) * .8);color:var(--text-muted);display:flex;justify-content:center;font-weight:600;line-height:1}@media (max-width: 768px){.canvas-container[_ngcontent-%COMP%]{height:60vh;min-height:400px;max-height:600px;padding:8px}}.table-element.adjacent-highlight[_ngcontent-%COMP%]{border:3px solid #FFD700!important;box-shadow:0 0 0 2px #ffd70080,0 0 20px 5px #ffd700b3!important;z-index:999!important;animation:_ngcontent-%COMP%_pulse-yellow 1.5s infinite alternate!important;transform:scale(1.02)!important;transition:all .3s ease!important}@keyframes _ngcontent-%COMP%_pulse-yellow{0%{box-shadow:0 0 0 2px #ffd70080,0 0 20px 5px #ffd700b3}to{box-shadow:0 0 0 4px #ffd700cc,0 0 30px 10px #ffd700e6}}.table-element.merge-selected.adjacent-highlight[_ngcontent-%COMP%]{border:3px double #FFD700!important;box-shadow:0 0 0 3px #ffd7004d,0 0 25px 8px #ffd70099,inset 0 0 15px #ffd70066!important}.merge-selected[_ngcontent-%COMP%]{border:3px solid var(--secondary)}.table-preview[_ngcontent-%COMP%]{background-color:var(--vetro);border:2px solid var(--smoke-1);display:flex;align-items:center;justify-content:center;margin:0 auto;transition:all .3s ease;position:relative;overflow:hidden}.table-preview.shape-circle[_ngcontent-%COMP%]{border-radius:50%!important}.preview-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:calc(var(--gap-sm) / 2);pointer-events:none}.preview-content[_ngcontent-%COMP%]   .table-number[_ngcontent-%COMP%]{font-weight:800;font-size:var(--fs-sm);color:var(--text-color);line-height:1}.preview-content[_ngcontent-%COMP%]   .table-capacity[_ngcontent-%COMP%]{font-size:calc(var(--fs-sm) * .8);color:var(--text-muted);font-weight:600;line-height:1}.modal-md[_ngcontent-%COMP%]   .table-preview[_ngcontent-%COMP%]{max-width:200px;max-height:200px}.drawing-tooltip[_ngcontent-%COMP%]{position:absolute;top:20px;left:50%;transform:translate(-50%);background:var(--primary);color:#fff;padding:10px 20px;border-radius:30px;box-shadow:0 4px 12px #0003;z-index:100;display:flex;align-items:center;gap:8px;animation:_ngcontent-%COMP%_pulse 1.5s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:.8;transform:translate(-50%) scale(1)}50%{opacity:1;transform:translate(-50%) scale(1.05)}to{opacity:.8;transform:translate(-50%) scale(1)}}"]})};export{He as FloorPlanEditor};
