import{a as X}from"./chunk-KEWRM4FP.js";import{b as $,d as j,h as Q,j as q,q as G,r as H,s as J,x as K}from"./chunk-XXXLA76A.js";import{a as U}from"./chunk-RRGMY4FC.js";import"./chunk-GS53O7WG.js";import"./chunk-EBEBQMEP.js";import"./chunk-N3KHNVQY.js";import{d as N,e as R,l as V,m as W,n as A,s as L}from"./chunk-I5JNAJO4.js";import{Bb as O,Cb as z,Eb as D,Hb as u,Jb as m,Oa as o,Qb as T,Sb as w,Tb as n,Ub as B,Vb as d,Wb as F,Yb as v,Zb as S,_b as b,cb as k,g as y,hb as _,jc as g,la as E,lc as f,mc as I,qa as M,ra as C,vb as p,wb as i,xb as t}from"./chunk-HCHBVVTJ.js";function Z(l,a){if(l&1&&(i(0,"option",43),n(1),t()),l&2){let e=a.$implicit;p("value",e.id),o(),d(" ",e.name," ")}}function ee(l,a){if(l&1&&(i(0,"span",18),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function te(l,a){if(l&1&&(i(0,"span",18),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ie(l,a){if(l&1&&(i(0,"span",18),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ne(l,a){if(l&1&&(i(0,"span",18),n(1),t()),l&2){let e=m();o(),d(" ",e.sortDirection==="asc"?"arrow_upward":"arrow_downward"," ")}}function ae(l,a){if(l&1&&(i(0,"tr",44)(1,"td",45)(2,"div",46)(3,"span",18),n(4,"folder"),t(),n(5),i(6,"span",47),n(7),t()()()()),l&2){let e=m().$implicit,r=m();o(5),d(" ",e.name," "),o(2),d(" ",r.getDishesByCategory(e.id).length," piatti ")}}function re(l,a){if(l&1&&(i(0,"div",55),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),F(" ",I(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function oe(l,a){if(l&1&&(i(0,"span",5),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function le(l,a){l&1&&(i(0,"span",5),n(1,"-"),t())}function se(l,a){if(l&1){let e=D();i(0,"tr")(1,"td")(2,"div",48)(3,"div",49)(4,"strong",50),u("click",function(){let c=M(e).$implicit,s=m(2);return C(s.editDish(c.id))}),n(5),t(),_(6,re,3,6,"div",51),t()()(),i(7,"td"),n(8),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"select",52),u("ngModelChange",function(c){let s=M(e).$implicit,h=m(2);return C(h.updateDishStatus(s,c))}),i(22,"option",23),n(23,"Disponibile"),t(),i(24,"option",24),n(25,"Non disponibile"),t(),i(26,"option",25),n(27,"Esaurito"),t()()(),i(28,"td"),_(29,oe,2,1,"span",53)(30,le,2,0,"span",53),t(),i(31,"td")(32,"button",54),u("click",function(){let c=M(e).$implicit,s=m(2);return C(s.confirmDeleteDish(c))}),i(33,"span",18),n(34,"delete"),t(),n(35," Elimina "),t()()()}if(l&2){let e=a.$implicit,r=m(2);o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(2),B(r.getCategoryName(e.category_id||"")),o(3),d("\u20AC",f(12,17,e.base_price,"1.2-2")),o(3),d("",f(15,20,r.calculateFoodCostPercentage(e),"1.0-1"),"%"),o(3),w(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",f(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),T("available",e.status==="available")("unavailable",e.status==="unavailable")("out_of_stock",e.status==="out_of_stock"),p("ngModel",e.status),o(8),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function ce(l,a){if(l&1&&(O(0),_(1,ae,8,2,"tr",41)(2,se,36,26,"tr",40),z()),l&2){let e=a.$implicit,r=m();o(),p("ngIf",r.getDishesByCategory(e.id).length>0),o(),p("ngForOf",r.getDishesByCategory(e.id))}}function de(l,a){if(l&1&&(i(0,"tr",44)(1,"td",56)(2,"div",57)(3,"span",18),n(4,"folder_open"),t(),n(5," Senza Categoria "),i(6,"span",58),n(7),t()()()()),l&2){let e=m();o(7),d(" ",e.getDishesByCategory("").length," piatti ")}}function pe(l,a){if(l&1&&(i(0,"div",55),n(1),g(2,"slice"),t()),l&2){let e=m().$implicit;o(),F(" ",I(2,2,e.description,0,100),"",e.description.length>100?"...":""," ")}}function me(l,a){if(l&1&&(i(0,"span",5),n(1),t()),l&2){let e=m().$implicit;o(),d(" ",e.preparation_time," min ")}}function ue(l,a){l&1&&(i(0,"span",5),n(1,"-"),t())}function ge(l,a){if(l&1){let e=D();i(0,"tr")(1,"td")(2,"div",48)(3,"div",49)(4,"strong",50),u("click",function(){let c=M(e).$implicit,s=m();return C(s.editDish(c.id))}),n(5),t(),_(6,pe,3,6,"div",51),t()()(),i(7,"td",5),n(8,"-"),t(),i(9,"td")(10,"strong"),n(11),g(12,"number"),t()(),i(13,"td"),n(14),g(15,"number"),t(),i(16,"td")(17,"span"),n(18),g(19,"number"),t()(),i(20,"td")(21,"span"),n(22),g(23,"number"),t()(),i(24,"td")(25,"span",47),n(26),t()(),i(27,"td"),_(28,me,2,1,"span",53)(29,ue,2,0,"span",53),t()()}if(l&2){let e=a.$implicit,r=m();o(5),d(" ",e.name," "),o(),p("ngIf",e.description),o(5),d("\u20AC",f(12,17,e.base_price,"1.2-2")),o(3),d("\u20AC",f(15,20,e.food_cost,"1.2-2")),o(3),w(r.calculateMargin(e)>=0?"text-muted":"error"),o(),d(" \u20AC",f(19,23,r.calculateMargin(e),"1.2-2")," "),o(3),w(r.calculateMarginPercentage(e)>=0?"text-muted":"error"),o(),d(" ",f(23,26,r.calculateMarginPercentage(e),"1.0-0"),"% "),o(3),T("active",e.status==="available")("inactive",e.status!=="available"),o(),d(" ",r.getStatusText(e.status)," "),o(2),p("ngIf",e.preparation_time),o(),p("ngIf",!e.preparation_time)}}function _e(l,a){l&1&&(i(0,"tr")(1,"td",59)(2,"div",60)(3,"span",18),n(4,"search_off"),t(),i(5,"h3"),n(6,"Nessun piatto trovato"),t(),i(7,"p"),n(8,"Prova a modificare i filtri di ricerca o aggiungi un nuovo piatto"),t()()()())}var Y=class l{dishService=E(U);categoryService=E(X);router=E(L);dishes=[];categories=[];filteredDishes=[];stats={totalDishes:0,totalCategories:0,averageFoodCost:0,averageMargin:0,averagePrice:0};searchTerm="";selectedCategory="all";statusFilter="all";priceRange={min:null,max:null};sortField="name";sortDirection="asc";ngOnInit(){this.loadData()}loadData(){return y(this,null,function*(){yield this.dishService.loadData(),yield this.categoryService.loadData(),this.dishService.data$.subscribe(a=>{this.dishes=a,this.applyFilters(),this.calculateStats()}),this.categoryService.data$.subscribe(a=>{this.categories=a,this.calculateStats()})})}calculateStats(){let a=this.dishes.length,e=this.categories.length,r=this.dishes.reduce((h,x)=>h+(x.food_cost||0),0),c=this.dishes.reduce((h,x)=>h+(x.base_price||0),0),s=this.dishes.reduce((h,x)=>{let P=(x.base_price||0)-(x.food_cost||0);return h+(P>0?P:0)},0);this.stats={totalDishes:a,totalCategories:e,averageFoodCost:a>0?r/a:0,averageMargin:a>0?s/a:0,averagePrice:a>0?c/a:0}}applyFilters(){let a=[...this.dishes];this.searchTerm&&(a=a.filter(e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase())||e.description?.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.selectedCategory!=="all"&&(a=a.filter(e=>e.category_id===this.selectedCategory)),this.statusFilter!=="all"&&(a=a.filter(e=>e.status===this.statusFilter)),this.priceRange.min!==null&&(a=a.filter(e=>e.base_price>=this.priceRange.min)),this.priceRange.max!==null&&(a=a.filter(e=>e.base_price<=this.priceRange.max)),a.sort((e,r)=>{let c,s;switch(this.sortField){case"name":c=e.name.toLowerCase(),s=r.name.toLowerCase();break;case"price":c=e.base_price,s=r.base_price;break;case"food_cost":c=e.food_cost,s=r.food_cost;break;case"margin":c=e.base_price-e.food_cost,s=r.base_price-r.food_cost;break;default:c=e.name.toLowerCase(),s=r.name.toLowerCase()}return c<s?this.sortDirection==="asc"?-1:1:c>s?this.sortDirection==="asc"?1:-1:0}),this.filteredDishes=a}onSort(a){this.sortField===a?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortField=a,this.sortDirection="asc"),a==="food_cost_percentage"&&(this.sortField="food_cost"),this.applyFilters()}getCategoryName(a){return this.categories.find(r=>r.id===a)?.name||"Senza categoria"}calculateMargin(a){return a.base_price-a.food_cost}calculateMarginPercentage(a){return a.base_price===0?0:(a.base_price-a.food_cost)/a.base_price*100}getDishesByCategory(a){return this.filteredDishes.filter(e=>e.category_id===a)}resetFilters(){this.searchTerm="",this.selectedCategory="all",this.statusFilter="all",this.priceRange={min:null,max:null},this.applyFilters()}getStatusText(a){return{available:"Disponibile",unavailable:"Non disponibile",out_of_stock:"Esaurito"}[a]||a}editDish(a){this.router.navigate(["/food-cost-calculator",a])}createNewDish(){this.router.navigate(["/food-cost-calculator"])}calculateFoodCostPercentage(a){return!a.base_price||a.base_price===0?0:a.food_cost/a.base_price*100}updateDishStatus(a,e){return y(this,null,function*(){try{let r=a.status;e==="available"||e==="unavailable"||e==="out_of_stock"?(a.status=e,(yield this.dishService.updateDish(a.id,{status:e}))?(console.log(`Stato piatto ${a.name} aggiornato a: ${e}`),this.calculateStats()):(a.status=r,console.error("Errore nell'aggiornamento dello stato del piatto"),alert("Errore durante l'aggiornamento dello stato. Riprova."))):(console.error("Stato non valido:",e),alert("Stato non valido selezionato."))}catch(r){console.error("Errore durante l'aggiornamento dello stato:",r),alert("Errore durante l'aggiornamento dello stato.")}})}confirmDeleteDish(a){return y(this,null,function*(){let e=`Sei sicuro di voler eliminare il piatto "${a.name}"?

Questa azione non pu\xF2 essere annullata.`;confirm(e)&&(yield this.deleteDish(a.id))})}deleteDish(a){return y(this,null,function*(){try{(yield this.dishService.deleteDish(a))?console.log("\u2705 Piatto eliminato con successo"):alert("Errore durante l'eliminazione del piatto")}catch(e){console.error("\u274C Errore durante l'eliminazione:",e),alert("Errore durante l'eliminazione del piatto")}})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=k({type:l,selectors:[["app-menu-builder"]],decls:150,vars:28,consts:[[1,"page-container"],[1,"section-header"],[1,"flex","gap-sm"],[1,"material-icons","fs-lg"],[1,"section-title"],[1,"text-muted"],[1,"grid-cards","p-sm02"],[1,"card"],[1,"flex","items-center","gap-sm","mb-md"],[1,"material-icons","text-primary","text-md"],[1,"card-title"],[1,"text-md","font-bold","text-primary","text-amber-500","justify-center","flex"],[1,"text-muted","card-footer"],[1,"form-card","m-sm02"],[1,"flex","justify-between","items-end","gap-md","flex-wrap"],[1,"form-row"],[1,"form-group"],[1,"standard-label"],[1,"material-icons"],["type","text","placeholder","Cerca per nome o descrizione...",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","change","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["value","available"],["value","unavailable"],["value","out_of_stock"],[2,"display","flex","gap","var(--gap-sm)"],["type","number","placeholder","Min",3,"ngModelChange","input","ngModel"],[2,"align-self","center"],["type","number","placeholder","Max",3,"ngModelChange","input","ngModel"],[1,"modal-footer",2,"margin","0"],[1,"promethea-button","ghost",3,"click"],[1,"modal-footer","p-sm"],[1,"promethea-button",3,"click"],[1,"table-section"],[1,"bg-body","border","rounded-lg","overflow-hidden","shadow-card","backdrop-blur"],[1,"crm-table"],[2,"cursor","pointer",3,"click"],["class","material-icons",4,"ngIf"],[2,"width","100px"],[4,"ngFor","ngForOf"],["class","category-header",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"category-header"],["colspan","8",2,"background","var(--smoke-color-2)","font-weight","800"],[1,"text-md","flex","gap-md",2,"margin","0","border","none"],[1,"chip"],[1,"flex","items-center","gap-sm"],[1,"nomedescpiatto"],[1,"link",3,"click"],["class","text-muted","style","font-size: 0.8rem;",4,"ngIf"],[1,"status-select",3,"ngModelChange","ngModel"],["class","text-muted",4,"ngIf"],["title","Elimina piatto",1,"promethea-button","danger","small",3,"click"],[1,"text-muted",2,"font-size","0.8rem"],["colspan","8",2,"background","var(--smoke-1)","font-weight","800"],[1,"section-title",2,"margin","0","border","none"],[1,"chip",2,"margin-left","auto"],["colspan","8",1,"empty-state-row"],[1,"empty-state"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"dashboard"),t(),i(5,"h1",4),n(6,"Men\xF9"),t()(),i(7,"p",5),n(8,"Panoramica completa delle attivit\xE0 del tuo ristorante"),t()(),i(9,"div",6)(10,"div",7)(11,"div",8)(12,"span",9),n(13,"restaurant"),t(),i(14,"h3",10),n(15,"Totale Piatti"),t()(),i(16,"div",11),n(17),t(),i(18,"span",12),n(19,"Piatti nel men\xF9"),t()(),i(20,"div",7)(21,"div",8)(22,"span",9),n(23,"category"),t(),i(24,"h3",10),n(25,"Categorie"),t()(),i(26,"div",11),n(27),t(),i(28,"span",12),n(29,"Categorie attive"),t()(),i(30,"div",7)(31,"div",8)(32,"span",9),n(33,"euro"),t(),i(34,"h3",10),n(35,"Prezzo Medio"),t()(),i(36,"div",11),n(37),g(38,"number"),t(),i(39,"span",12),n(40,"Prezzo medio piatto"),t()(),i(41,"div",7)(42,"div",8)(43,"span",9),n(44,"trending_up"),t(),i(45,"h3",10),n(46,"Margine Medio"),t()(),i(47,"div",11),n(48),g(49,"number"),t(),i(50,"span",12),n(51,"Margine medio piatto"),t()(),i(52,"div",7)(53,"div",8)(54,"span",9),n(55,"account_balance"),t(),i(56,"h3",10),n(57,"Food Cost Medio"),t()(),i(58,"div",11),n(59),g(60,"number"),t(),i(61,"span",12),n(62,"Costo medio piatto"),t()()(),i(63,"div",13)(64,"div",14)(65,"div",15)(66,"div",16)(67,"label",17)(68,"span",18),n(69,"search"),t(),n(70," Cerca "),t(),i(71,"input",19),b("ngModelChange",function(s){return S(r.searchTerm,s)||(r.searchTerm=s),s}),u("input",function(){return r.applyFilters()}),t()(),i(72,"div",16)(73,"label",17)(74,"span",18),n(75,"category"),t(),n(76," Categoria "),t(),i(77,"select",20),b("ngModelChange",function(s){return S(r.selectedCategory,s)||(r.selectedCategory=s),s}),u("change",function(){return r.applyFilters()}),i(78,"option",21),n(79,"Tutte le categorie"),t(),_(80,Z,2,2,"option",22),t()()(),i(81,"div",15)(82,"div",16)(83,"label",17)(84,"span",18),n(85,"visibility"),t(),n(86," Stato "),t(),i(87,"select",20),b("ngModelChange",function(s){return S(r.statusFilter,s)||(r.statusFilter=s),s}),u("change",function(){return r.applyFilters()}),i(88,"option",21),n(89,"Tutti gli stati"),t(),i(90,"option",23),n(91,"Disponibile"),t(),i(92,"option",24),n(93,"Non disponibile"),t(),i(94,"option",25),n(95,"Esaurito"),t()()(),i(96,"div",16)(97,"label",17)(98,"span",18),n(99,"euro"),t(),n(100," Prezzo "),t(),i(101,"div",26)(102,"input",27),b("ngModelChange",function(s){return S(r.priceRange.min,s)||(r.priceRange.min=s),s}),u("input",function(){return r.applyFilters()}),t(),i(103,"span",28),n(104,"-"),t(),i(105,"input",29),b("ngModelChange",function(s){return S(r.priceRange.max,s)||(r.priceRange.max=s),s}),u("input",function(){return r.applyFilters()}),t()()()(),i(106,"div",30)(107,"button",31),u("click",function(){return r.resetFilters()}),i(108,"span",18),n(109,"refresh"),t(),n(110," Reset "),t()()()(),i(111,"div",32)(112,"button",33),u("click",function(){return r.createNewDish()}),i(113,"span",18),n(114,"add"),t(),n(115," Nuovo Piatto "),t(),i(116,"button",31),u("click",function(){return r.resetFilters()}),i(117,"span",18),n(118,"refresh"),t(),n(119," Reset Filtri "),t()(),i(120,"div",34)(121,"div",35)(122,"table",36)(123,"thead")(124,"tr")(125,"th",37),u("click",function(){return r.onSort("name")}),n(126," Nome "),_(127,ee,2,1,"span",38),t(),i(128,"th"),n(129,"Categoria"),t(),i(130,"th",37),u("click",function(){return r.onSort("price")}),n(131," Prezzo "),_(132,te,2,1,"span",38),t(),i(133,"th",37),u("click",function(){return r.onSort("food_cost_percentage")}),n(134," Food Cost % "),_(135,ie,2,1,"span",38),t(),i(136,"th",37),u("click",function(){return r.onSort("margin")}),n(137," Margine (\u20AC) "),_(138,ne,2,1,"span",38),t(),i(139,"th"),n(140,"Stato"),t(),i(141,"th"),n(142,"Tempo Prep."),t(),i(143,"th",39),n(144,"Azioni"),t()()(),i(145,"tbody"),_(146,ce,3,2,"ng-container",40)(147,de,8,1,"tr",41)(148,ge,30,29,"tr",40)(149,_e,9,0,"tr",42),t()()()()()),e&2&&(o(17),B(r.stats.totalDishes),o(10),B(r.stats.totalCategories),o(10),d("\u20AC",f(38,19,r.stats.averagePrice,"1.2-2")),o(11),d("\u20AC",f(49,22,r.stats.averageMargin,"1.2-2")),o(11),d("\u20AC",f(60,25,r.stats.averageFoodCost,"1.2-2")),o(12),v("ngModel",r.searchTerm),o(6),v("ngModel",r.selectedCategory),o(3),p("ngForOf",r.categories),o(7),v("ngModel",r.statusFilter),o(15),v("ngModel",r.priceRange.min),o(3),v("ngModel",r.priceRange.max),o(22),p("ngIf",r.sortField==="name"),o(5),p("ngIf",r.sortField==="price"),o(3),p("ngIf",r.sortField==="food_cost_percentage"),o(3),p("ngIf",r.sortField==="margin"),o(8),p("ngForOf",r.categories),o(),p("ngIf",r.getDishesByCategory("").length>0),o(),p("ngForOf",r.getDishesByCategory("")),o(),p("ngIf",r.filteredDishes.length===0))},dependencies:[A,N,R,K,H,J,$,q,G,j,Q,W,V],styles:[".category-header[_ngcontent-%COMP%]{border-left:4px solid var(--primary)}.category-header[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--gap-md)!important}.crm-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:not(.category-header):hover{background:var(--smoke-1)}.chip.active[_ngcontent-%COMP%]{background:color-mix(in srgb,#10b981 20%,transparent);color:#10b981}.chip.inactive[_ngcontent-%COMP%]{background:color-mix(in srgb,#6b7280 20%,transparent);color:#6b7280}.nomedescpiatto[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:calc(var(--gap-sm) / 2)}@media (max-width: 768px){.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filter-group[_ngcontent-%COMP%]{min-width:100%}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.crm-table[_ngcontent-%COMP%]{min-width:800px}}.status-select.available[_ngcontent-%COMP%]{border-color:var(--success-color, #28a745)}.status-select.unavailable[_ngcontent-%COMP%]{border-color:var(--warning-color, #ffc107)}.status-select.out_of_stock[_ngcontent-%COMP%]{border-color:var(--danger-color, #dc3545)}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 2px #007bff40}.chip.active[_ngcontent-%COMP%]{background-color:var(--success-color);color:#fff}.chip.inactive[_ngcontent-%COMP%]{background-color:var(--danger-color);color:#fff}"]})};export{Y as MenuBuilder};
